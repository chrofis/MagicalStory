import{c as K,u as W,a as X,b as Z,j as e,e as _,T as J,E as Q}from"./index-DAglKkS8.js";import{u as Y,b as n}from"./vendor-react-k5uhsfqB.js";import{s as B,N as ee}from"./Textarea-19J2mQ5w.js";import{b as I}from"./api-MTtDq-uw.js";import{B as D,M as te}from"./Pricing-BAZVwCuY.js";import{T as se}from"./trash-2-CS0iaBNY.js";import"./vendor-firebase-Ksn6Afo7.js";import"./check-CSHhSamw.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=K("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),j=Z("MyStories");let m={data:null,total:0,timestamp:0};const ie=300*1e3,re=6,G=18;function oe({story:t,language:a,onView:v,onDelete:c,formatDate:h,isSelected:x,onToggleSelect:S,onLoadCover:u,t:y}){const[p,P]=n.useState(!1),[w,N]=n.useState(!1),[l,A]=n.useState(!1),[k,o]=n.useState(!1),f=n.useRef(null);return n.useEffect(()=>{const g=new IntersectionObserver(([L])=>{L.isIntersecting&&(A(!0),g.disconnect())},{rootMargin:"100px"});return f.current&&g.observe(f.current),()=>g.disconnect()},[]),n.useEffect(()=>{l&&t.hasThumbnail&&!t.thumbnail&&!k&&(o(!0),u(t.id))},[l,t.hasThumbnail,t.thumbnail,t.id,k,u]),e.jsxs("div",{ref:f,className:`bg-white rounded-xl shadow-md overflow-hidden transition-all flex flex-col hover:shadow-lg ${t.isPartial?"ring-2 ring-amber-400":""} ${x?"ring-8 ring-green-500":""}`,children:[e.jsxs("div",{className:"relative",children:[l&&t.thumbnail&&!w?e.jsxs("div",{className:"relative w-full h-48 bg-gray-100",children:[!p&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 spinner"})}),e.jsx("img",{src:t.thumbnail,alt:t.title,className:`w-full h-48 object-cover transition-opacity duration-300 ${p?"opacity-100":"opacity-0"}`,onLoad:()=>P(!0),onError:()=>N(!0)})]}):!l||t.hasThumbnail&&!t.thumbnail&&!w?e.jsx("div",{className:"relative w-full h-48 bg-gray-100 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 spinner"})}):e.jsx("div",{className:"relative w-full h-48 bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center",children:e.jsx(D,{className:"w-12 h-12 text-indigo-300"})}),t.isPartial&&e.jsxs("div",{className:"absolute top-2 left-2 bg-amber-500 text-white px-2 py-1 rounded-md text-xs font-medium flex items-center gap-1",children:[e.jsx(J,{size:12}),a==="de"?"Teilweise":a==="fr"?"Partiel":"Partial"]}),e.jsx("button",{onClick:g=>{g.stopPropagation(),c()},className:"absolute top-2 right-2 p-2 bg-white/90 text-red-600 hover:bg-red-100 rounded-lg shadow-sm",children:e.jsx(se,{size:16})})]}),e.jsxs("div",{className:"p-4 flex flex-col flex-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-2",children:t.title}),t.isPartial?e.jsxs("p",{className:"text-sm text-amber-600 mb-3",children:[t.generatedPages||0,"/",t.totalPages||t.pages," ",a==="de"?"Seiten generiert":a==="fr"?"pages générées":"pages generated"," • ",h(t.created_at||t.createdAt)]}):e.jsxs("p",{className:"text-sm text-gray-500 mb-3",children:[t.pages," ",a==="de"?"Seiten":"pages"," • ",h(t.created_at||t.createdAt)]})]}),e.jsxs("div",{className:"flex gap-2 mt-auto",children:[e.jsxs("button",{onClick:g=>{g.stopPropagation(),v()},className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[e.jsx(Q,{size:18}),a==="de"?"Ansehen":a==="fr"?"Voir":"View"]}),!t.isPartial&&e.jsx("button",{onClick:g=>{g.stopPropagation(),S()},className:`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${x?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"}`,children:x?y.remove:y.add})]})]})]})}function fe(){const t=Y(),{language:a}=W(),{isAuthenticated:v}=X(),[c,h]=n.useState([]),[x,S]=n.useState(!0),[u,y]=n.useState(!1),[p,P]=n.useState(!1),[w,N]=n.useState(0),[l,A]=n.useState(new Set),k={en:{myStories:"My Stories",createStory:"Create Story",noStories:"No stories created yet",seePricing:"See Pricing",selectHint:"Select stories to create a book",selected:"selected",pages:"pages",createBook:"Create Book",tooManyPages:"Too many pages (max 100)",add:"Add",remove:"Remove",loadAll:"Load All"},de:{myStories:"Meine Geschichten",createStory:"Geschichte erstellen",noStories:"Noch keine Geschichten erstellt",seePricing:"Preise ansehen",selectHint:"Wähle Geschichten, um ein Buch zu erstellen",selected:"ausgewählt",pages:"Seiten",createBook:"Buch erstellen",tooManyPages:"Zu viele Seiten (max. 100)",add:"Hinzufügen",remove:"Entfernen",loadAll:"Alle laden"},fr:{myStories:"Mes histoires",createStory:"Créer une histoire",noStories:"Aucune histoire créée",seePricing:"Voir les tarifs",selectHint:"Sélectionnez des histoires pour créer un livre",selected:"sélectionné(s)",pages:"pages",createBook:"Créer le livre",tooManyPages:"Trop de pages (max 100)",add:"Ajouter",remove:"Retirer",loadAll:"Tout charger"}},o=k[a]||k.en;n.useEffect(()=>{if(!v){t("/");return}f()},[v,t]);const f=async(s={})=>{const{loadMore:i=!1,loadAll:r=!1}=s;j.debug("Loading stories...",{loadMore:i,loadAll:r});try{const d=Date.now();if(!i&&!r&&m.data&&d-m.timestamp<ie){j.debug("Using cached stories"),h(m.data),N(m.total),P(m.data.length<m.total),S(!1);return}i||r?y(!0):S(!0);const C=i||r?c.length:0,U=r?1e3:re,{stories:O,pagination:M}=await B.getStories({limit:U,offset:C});j.info("Loaded stories:",O.length,"total:",M.total);const E=O;i||r?h(q=>{const R=[...q,...E];return m={data:R,total:M.total,timestamp:d},R}):(h(E),m={data:E,total:M.total,timestamp:d}),N(M.total),P(M.hasMore)}catch(d){j.error("Failed to load stories:",d)}finally{S(!1),y(!1)}};n.useEffect(()=>{!x&&!u&&p&&c.length<G&&c.length>0&&f({loadMore:!0})},[c.length,p,x,u]);const g=n.useCallback(async s=>{try{const i=await B.getStoryCover(s);i&&(h(r=>r.map(d=>d.id===s?{...d,thumbnail:i}:d)),m.data&&(m.data=m.data.map(r=>r.id===s?{...r,thumbnail:i}:r)))}catch(i){j.error("Failed to load cover for story:",s,i)}},[]),L=async s=>{if(confirm(a==="de"?"Diese Geschichte wirklich löschen?":a==="fr"?"Voulez-vous vraiment supprimer cette histoire?":"Are you sure you want to delete this story?"))try{await B.deleteStory(s);const r=c.filter(d=>d.id!==s);h(r),N(d=>Math.max(0,d-1)),m={data:r,total:Math.max(0,w-1),timestamp:Date.now()},A(d=>{const C=new Set(d);return C.delete(s),C})}catch(r){j.error("Failed to delete story:",r),alert(a==="de"?"Geschichte konnte nicht gelöscht werden. Bitte versuche es erneut.":a==="fr"?"Impossible de supprimer l'histoire. Veuillez réessayer.":"Failed to delete story. Please try again.")}},H=n.useCallback(s=>{if(!s)return"";try{return new Date(s).toLocaleDateString(a==="de"?"de-DE":a==="fr"?"fr-FR":"en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return""}},[a]),V=s=>{A(i=>{const r=new Set(i);return r.has(s)?r.delete(s):r.add(s),r})},z=n.useMemo(()=>c.filter(s=>l.has(s.id)),[c,l]),T=n.useMemo(()=>z.reduce((s,i)=>s+i.pages,0),[z]),b=T>te,F=()=>{const s=z.map(i=>({id:i.id,title:i.title,pages:i.pages,thumbnail:i.thumbnail}));t("/book-builder",{state:{selectedStories:s}})};if(!v)return e.jsx(_,{fullScreen:!0});const $=c.filter(s=>!s.isPartial).length>=1;return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsx(ee,{currentStep:0}),e.jsxs("div",{className:"px-4 md:px-8 py-8 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(D,{size:28}),o.myStories]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("button",{onClick:()=>t("/pricing"),className:"flex items-center gap-2 px-4 py-2 border-2 border-gray-300 text-gray-600 rounded-lg hover:border-indigo-400 hover:text-indigo-600 hover:bg-indigo-50 font-medium transition-colors",children:[e.jsx(ae,{size:18}),o.seePricing]}),$&&e.jsxs("button",{onClick:F,disabled:l.size===0||b,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(I,{size:18}),o.createBook,l.size>0&&e.jsx("span",{className:"bg-white text-indigo-600 text-xs px-2 py-0.5 rounded-full",children:l.size})]}),e.jsx("button",{onClick:()=>t("/create"),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold transition-colors",children:o.createStory})]})]}),c.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6 flex items-center gap-3",children:[e.jsx(I,{size:20,className:"text-blue-600 flex-shrink-0"}),e.jsx("p",{className:"text-blue-800 text-sm",children:o.selectHint}),l.size>0&&e.jsxs("span",{className:`ml-auto text-sm font-medium ${b?"text-red-600":"text-blue-600"}`,children:[l.size," ",o.selected," • ",T," ",o.pages,b&&` (${o.tooManyPages})`]})]}),x?e.jsx(_,{message:a==="de"?"Laden...":a==="fr"?"Chargement...":"Loading..."}):c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:o.noStories}),e.jsx("button",{onClick:()=>t("/create"),className:"mt-4 px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700",children:o.createStory})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:c.map(s=>e.jsx(oe,{story:s,language:a,onView:()=>t(`/create?storyId=${s.id}`),onDelete:()=>L(s.id),formatDate:H,isSelected:l.has(s.id),onToggleSelect:()=>V(s.id),onLoadCover:g,t:{add:o.add,remove:o.remove}},s.id))}),p&&c.length>=G&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx("button",{onClick:()=>f({loadAll:!0}),disabled:u,className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold transition-colors disabled:opacity-50",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 spinner"}),a==="de"?"Laden...":a==="fr"?"Chargement...":"Loading..."]}):e.jsxs(e.Fragment,{children:[o.loadAll," (",w-c.length," ",a==="de"?"weitere":a==="fr"?"autres":"more",")"]})})})]}),l.size>0&&e.jsx("div",{className:"h-24"})]}),l.size>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[l.size," ",o.selected," • ",T," ",o.pages]}),b&&e.jsxs("span",{className:"text-red-600 font-medium",children:["(",o.tooManyPages,")"]})]}),e.jsxs("button",{onClick:F,disabled:b,className:`flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-colors ${b?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:[e.jsx(I,{size:20}),o.createBook]})]})})]})}export{fe as default};
