import{c as lt,b as st,d as yn,j as e,X as ns,u as gt,a as sn,L as Lt,T as vn,C as An,E as $i,e as Ti,f as Fi,s as at,g as zi}from"./index-DPE4toha.js";import{b as d,L as Pn,u as Ii,e as Bi}from"./vendor-react-CqfXSjHo.js";import{U as ir,B as Ps,I as Dn}from"./Input-BTLmTySL.js";import{S as Ei,A as $n,N as Mi}from"./Textarea-BpGpk4qO.js";import{C as Li}from"./circle-x-D931dVO4.js";import{C as Ri}from"./clock-BLleeXkx.js";import{M as ei,H as Gi,C as Nr,R as ps,F as Gr,P as Xa,a as Hi,I as Tn,b as Oi,c as _i}from"./Modal-DDITlX-Q.js";import{D as en,C as Ft}from"./download-trT-Y4vQ.js";import{C as tn}from"./chevron-right-DKpXtNNC.js";import{P as jn}from"./palette-pFwRvh9F.js";import{B as qi}from"./book-CKBJb6He.js";import{C as Vr}from"./check-DoTCUpPW.js";import{S as Fn}from"./shopping-cart-DCzqgTjR.js";import{B as Qa}from"./book-open-BuP0qXBR.js";import{S as Mt}from"./sparkles-BgXtZB_o.js";import{T as Vi}from"./trash-2-rea8l2-E.js";import{A as Hr}from"./arrow-right-DtMDz0WW.js";import{C as Wi}from"./camera-DJTT_KGx.js";import{A as zn}from"./arrow-left-CPLuLLoJ.js";import"./vendor-firebase-DTVMaYMy.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ki=lt("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ui=lt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ji=lt("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zi=lt("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=lt("Images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qi=lt("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yi=lt("Link2Off",[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xi=lt("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=lt("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const el=lt("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tl=lt("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=lt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=lt("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=lt("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sl=lt("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=lt("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=lt("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=lt("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=lt("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=lt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=lt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rl=lt("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=lt("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),al={async login(t,a){const n=await st.post("/api/auth/login",{username:t,password:a},{skipAuth:!0}),p={id:n.user.id,username:n.user.username,email:n.user.email,role:n.user.role,credits:n.user.credits};return{token:n.token,user:p}},async register(t,a,n){return st.post("/api/auth/register",{username:t,password:a,email:n},{skipAuth:!0})},async loginWithFirebase(t){const a=await st.post("/api/auth/firebase",{idToken:t},{skipAuth:!0}),n={id:a.user.id,username:a.user.username,email:a.user.email,role:a.user.role,credits:a.user.credits};return{token:a.token,user:n}},async getQuota(){const t=await st.get("/api/user/quota");return{storyQuota:t.storyQuota,storiesGenerated:t.storiesGenerated,remaining:t.remaining}},async getCredits(){const t=await st.get("/api/user/quota");return{credits:t.credits,unlimited:t.unlimited}},async updateEmail(t){await st.put("/api/user/update-email",{email:t})},async getShippingAddress(){try{return await st.get("/api/user/shipping-address")}catch{return null}},async updateShippingAddress(t){await st.put("/api/user/shipping-address",t)}},ve=yn("CharacterService");function rn(t){if(!t)return;const a=parseInt(t,10);if(!(isNaN(a)||a<0))return a<=1?"infant":a<=2?"toddler":a<=4?"preschooler":a<=6?"kindergartner":a<=8?"young-school-age":a<=10?"school-age":a<=12?"preteen":a<=14?"young-teen":a<=17?"teenager":a<=25?"young-adult":a<=39?"adult":a<=59?"middle-aged":a<=75?"senior":"elderly"}function cn(t){const a={height:t.height,build:t.build,face:t.other_features||t.otherFeatures,eyeColor:t.eye_color||t.eyeColor,hairColor:t.hair_color||t.hairColor,hairLength:t.hair_length||t.hairLength,hairStyle:t.hair_style||t.hairStyle,facialHair:t.facial_hair||t.facialHair,skinTone:t.skin_tone||t.skinTone,skinUndertone:t.skin_undertone||t.skinUndertone,skinToneHex:t.skin_tone_hex||t.skinToneHex,hair:t.hair_color||t.hairColor,other:t.other,detailedHairAnalysis:t.detailed_hair_analysis||t.detailedHairAnalysis,apparentAge:t.apparent_age||t.apparentAge},n=t.age_category||t.ageCategory||rn(t.age);return{id:t.id,name:t.name,gender:t.gender,age:t.age,ageCategory:n,physical:a.height||a.build||a.face||a.eyeColor||a.hairColor||a.hairLength||a.hairStyle||a.facialHair||a.skinTone||a.hair||a.other||a.detailedHairAnalysis||a.apparentAge?a:void 0,physicalTraitsSource:t.physical_traits_source||t.physicalTraitsSource,traits:{strengths:t.strengths||[],flaws:t.flaws||t.weaknesses||[],challenges:t.challenges||t.fears||[],specialDetails:t.special_details||t.specialDetails},photos:{original:t.photo_url||t.photoUrl,face:t.thumbnail_url||t.thumbnailUrl,body:t.body_photo_url||t.bodyPhotoUrl,bodyNoBg:t.body_no_bg_url||t.bodyNoBgUrl,faceBox:t.face_box||t.faceBox,bodyBox:t.body_box||t.bodyBox},avatars:t.avatars||t.clothing_avatars||t.clothingAvatars,clothing:t.clothing||t.structured_clothing||t.structuredClothing?{current:t.clothing,structured:t.structured_clothing||t.structuredClothing}:void 0,generatedOutfits:t.generated_outfits||t.generatedOutfits}}function Mn(t){var n,p,r,f,x,o,C,$,b,v,B,h,k,L,R,E,se,q,u,z,J,_,Y,I;const a=t.ageCategory||rn(t.age);return{id:t.id,name:t.name,gender:t.gender,age:t.age,age_category:a,apparent_age:(n=t.physical)==null?void 0:n.apparentAge,height:(p=t.physical)==null?void 0:p.height,build:(r=t.physical)==null?void 0:r.build,eye_color:(f=t.physical)==null?void 0:f.eyeColor,hair_color:(x=t.physical)==null?void 0:x.hairColor,hair_length:(o=t.physical)==null?void 0:o.hairLength,hair_style:(C=t.physical)==null?void 0:C.hairStyle,facial_hair:($=t.physical)==null?void 0:$.facialHair,skin_tone:(b=t.physical)==null?void 0:b.skinTone,skin_undertone:(v=t.physical)==null?void 0:v.skinUndertone,skin_tone_hex:(B=t.physical)==null?void 0:B.skinToneHex,other_features:(h=t.physical)==null?void 0:h.face,other:(k=t.physical)==null?void 0:k.other,detailed_hair_analysis:(L=t.physical)==null?void 0:L.detailedHairAnalysis,physical_traits_source:t.physicalTraitsSource,face_box:(R=t.photos)==null?void 0:R.faceBox,body_box:(E=t.photos)==null?void 0:E.bodyBox,strengths:(se=t.traits)==null?void 0:se.strengths,flaws:(q=t.traits)==null?void 0:q.flaws,challenges:(u=t.traits)==null?void 0:u.challenges,special_details:(z=t.traits)==null?void 0:z.specialDetails,weaknesses:(J=t.traits)==null?void 0:J.flaws,fears:(_=t.traits)==null?void 0:_.challenges,clothing:(Y=t.clothing)==null?void 0:Y.current,structured_clothing:(I=t.clothing)==null?void 0:I.structured,generated_outfits:t.generatedOutfits}}function nl(t){return!t||t.length===0?[]:typeof t[0]=="string"?t.map(a=>({forward:a,inverse:a})):t}const Ze={async getCharacters(t=!1){const a=t?"/api/characters?includeAllAvatars=true":"/api/characters";return((await st.get(a)).characters||[]).map(cn)},async getCharacterData(t=!1){const a=t?"/api/characters?includeAllAvatars=true":"/api/characters",n=await st.get(a);return{characters:(n.characters||[]).map(cn),relationships:n.relationships||{},relationshipTexts:n.relationshipTexts||{},customRelationships:nl(n.customRelationships),customStrengths:n.customStrengths||[],customWeaknesses:n.customWeaknesses||[],customFears:n.customFears||[]}},async saveCharacters(t){await st.post("/api/characters",{characters:t.map(Mn)})},async saveCharacterData(t,a){const n=r=>{var x,o,C,$;const f=Mn(r);return a!=null&&a.includePhotos&&(f.photo_url=(x=r.photos)==null?void 0:x.original,f.thumbnail_url=(o=r.photos)==null?void 0:o.face,f.body_photo_url=(C=r.photos)==null?void 0:C.body,f.body_no_bg_url=($=r.photos)==null?void 0:$.bodyNoBg),f},p={characters:t.characters.map(n),relationships:t.relationships,relationshipTexts:t.relationshipTexts,customRelationships:t.customRelationships,customStrengths:t.customStrengths,customWeaknesses:t.customWeaknesses,customFears:t.customFears};await st.post("/api/characters",p)},async deleteCharacter(t){try{const a=await st.delete(`/api/characters/${t}`);return ve.success(`Deleted character ${t}: ${a.message}`),{success:!0}}catch(a){return ve.error(`Failed to delete character ${t}:`,a),{success:!1,error:String(a)}}},async loadCharacterAvatars(t){try{const a=await st.get(`/api/characters/${t}/avatars`);return ve.info(`Loaded full avatars for character ${t}`),a.avatars||null}catch(a){return ve.error(`Failed to load avatars for character ${t}:`,a),null}},async loadFullCharacter(t){try{const a=await st.get(`/api/characters/${t}/full`);return a.character?(ve.info(`Loaded full data for character ${t}`),cn(a.character)):null}catch(a){return ve.error(`Failed to load full data for character ${t}:`,a),null}},async generateAvatarOptions(t,a){try{return await st.post("/api/generate-avatar-options",{facePhoto:t,gender:a,category:"standard"})}catch(n){const p=n instanceof Error?n.message:"Unknown error";return{success:!1,options:[],error:p}}},async generateClothingAvatars(t,a){var n,p,r,f,x,o,C,$,b,v,B;try{const h=parseInt(t.age)||10,k=t.gender||"child";let L;k==="male"?L=h>=18?"man":"boy":k==="female"?L=h>=18?"woman":"girl":L=h>=18?"person":"child";let E=`${((n=t.name)==null?void 0:n.trim())||`This ${L}`} is a ${h}-year-old ${L}`;t.physical&&(t.physical.hair&&(E+=`, ${t.physical.hair}`),t.physical.face&&(E+=`, ${t.physical.face}`),t.physical.build&&(E+=`, ${t.physical.build}`),t.physical.other&&(E+=`, ${t.physical.other}`));const se=((p=t.photos)==null?void 0:p.bodyNoBg)||((r=t.photos)==null?void 0:r.body)||((f=t.photos)==null?void 0:f.face)||((x=t.photos)==null?void 0:x.original);ve.info(`ðŸŽ¨ Generating clothing avatars for ${t.name||"unnamed"} (id: ${t.id})`);const q=await st.post("/api/generate-clothing-avatars?async=true",{characterId:t.id,facePhoto:se,physicalDescription:E,name:t.name,age:t.age,apparentAge:(o=t.physical)==null?void 0:o.apparentAge,gender:t.gender,build:(C=t.physical)==null?void 0:C.build,clothing:($=t.clothing)==null?void 0:$.structured,avatarModel:a==null?void 0:a.avatarModel});if(q.async&&q.jobId){ve.info(`Avatar job started: ${q.jobId}, polling for completion...`);const z=60,J=2e3;for(let _=0;_<z;_++){await new Promise(I=>setTimeout(I,J));const Y=await st.get(`/api/avatar-jobs/${q.jobId}`);if(Y.status==="complete"&&Y.clothingAvatars){ve.success(`Avatar job ${q.jobId} completed after ${(_+1)*2}s`);const I=Y.clothingAvatars.extractedTraits,re=(b=Y.clothingAvatars.structuredClothing)==null?void 0:b.standard;return ve.info(`ðŸ” [DEBUG] extractedTraits: ${(v=JSON.stringify(I))==null?void 0:v.substring(0,100)}`),ve.info(`ðŸ” [DEBUG] extractedClothing: ${JSON.stringify(re)}`),ve.info(`ðŸ” [DEBUG] structuredClothing keys: ${Object.keys(Y.clothingAvatars.structuredClothing||{})}`),{success:!0,avatars:Y.clothingAvatars,extractedTraits:I,extractedClothing:re}}if(Y.status==="failed")return ve.error(`Avatar job failed: ${Y.error}`),{success:!1,error:Y.error};_%5===0&&ve.info(`Avatar job ${q.jobId}: ${Y.message||Y.status} (${Y.progress||0}%)`)}return{success:!1,error:"Avatar generation timed out"}}const u=q;if(u.success&&u.clothingAvatars){ve.success(`Clothing avatars generated for ${t.name}`);const z=u.clothingAvatars.extractedTraits,J=(B=u.clothingAvatars.structuredClothing)==null?void 0:B.standard;return z&&ve.info(`Extracted traits: ${JSON.stringify(z)}`),J&&ve.info(`Extracted clothing: ${JSON.stringify(J)}`),{success:!0,avatars:u.clothingAvatars,extractedTraits:z,extractedClothing:J}}else return ve.error(`Failed to generate avatars: ${u.error}`),{success:!1,error:u.error}}catch(h){return ve.error("Clothing avatar generation failed:",h),{success:!1,error:String(h)}}},async generateClothingAvatarsWithTraits(t){var a,n,p,r,f,x,o,C,$,b,v,B,h,k,L,R,E,se;try{const q=parseInt(t.age)||10,u=t.gender||"child";let z;u==="male"?z=q>=18?"man":"boy":u==="female"?z=q>=18?"woman":"girl":z=q>=18?"person":"child";let _=`${((a=t.name)==null?void 0:a.trim())||`This ${z}`} is a ${q}-year-old ${z}`;t.physical&&(t.physical.hair&&(_+=`, ${t.physical.hair}`),t.physical.face&&(_+=`, ${t.physical.face}`),t.physical.build&&(_+=`, ${t.physical.build}`),t.physical.other&&(_+=`, ${t.physical.other}`));const Y=((n=t.photos)==null?void 0:n.bodyNoBg)||((p=t.photos)==null?void 0:p.body)||((r=t.photos)==null?void 0:r.face)||((f=t.photos)==null?void 0:f.original),I=(x=t.photos)!=null&&x.bodyNoBg?"bodyNoBg":(o=t.photos)!=null&&o.body?"body":(C=t.photos)!=null&&C.face?"face":"original",re=Y?Math.round(Y.length/1024):0,fe=Y==null?void 0:Y.startsWith("data:image/png");ve.info(`ðŸŽ¨ Generating clothing avatars WITH TRAITS for ${t.name} (id: ${t.id})`),ve.info(`ðŸ“¸ Photo source: ${I}, size: ${re}KB, format: ${fe?"PNG":"JPEG"}`),ve.info(`ðŸ“¸ Available photos: bodyNoBg=${!!(($=t.photos)!=null&&$.bodyNoBg)}, body=${!!((b=t.photos)!=null&&b.body)}, face=${!!((v=t.photos)!=null&&v.face)}, original=${!!((B=t.photos)!=null&&B.original)}`),ve.info(`Physical traits: ${JSON.stringify(t.physical)}`);const xe=t.physicalTraitsSource||{};ve.info(`Physical traits source: ${JSON.stringify(xe)}`),ve.info(`Physical skinTone value: '${(h=t.physical)==null?void 0:h.skinTone}', source: '${xe.skinTone}'`),ve.info(`Physical hairStyle value: '${(k=t.physical)==null?void 0:k.hairStyle}', source: '${xe.hairStyle}'`);const ae={};t.physical&&(xe.eyeColor==="user"&&t.physical.eyeColor&&(ae.eyeColor=t.physical.eyeColor),xe.hairColor==="user"&&t.physical.hairColor&&(ae.hairColor=t.physical.hairColor),xe.hairLength==="user"&&t.physical.hairLength&&(ae.hairLength=t.physical.hairLength),xe.hairStyle==="user"&&t.physical.hairStyle&&(ae.hairStyle=t.physical.hairStyle),xe.build==="user"&&t.physical.build&&(ae.build=t.physical.build),xe.skinTone==="user"&&t.physical.skinTone&&(ae.skinTone=t.physical.skinTone,t.physical.skinToneHex&&(ae.skinToneHex=t.physical.skinToneHex)),xe.face==="user"&&t.physical.face&&(ae.face=t.physical.face),xe.facialHair==="user"&&t.physical.facialHair&&(ae.facialHair=t.physical.facialHair),xe.other==="user"&&t.physical.other&&(ae.other=t.physical.other));const he=Object.keys(ae).length>0;ve.info(`Physical traits to send (user-edited only): ${he?JSON.stringify(ae):"none"}`);const Se=t.clothingSource||{},ne={};(L=t.clothing)!=null&&L.structured&&(Se.upperBody==="user"&&t.clothing.structured.upperBody&&(ne.upperBody=t.clothing.structured.upperBody),Se.lowerBody==="user"&&t.clothing.structured.lowerBody&&(ne.lowerBody=t.clothing.structured.lowerBody),Se.shoes==="user"&&t.clothing.structured.shoes&&(ne.shoes=t.clothing.structured.shoes),Se.fullBody==="user"&&t.clothing.structured.fullBody&&(ne.fullBody=t.clothing.structured.fullBody));const c=Object.keys(ne).length>0;ve.info(`Clothing to send (user-edited only): ${c?JSON.stringify(ne):"none"}`);const Te=await st.post("/api/generate-clothing-avatars?async=true",{characterId:t.id,facePhoto:Y,physicalDescription:_,name:t.name,age:t.age,apparentAge:(R=t.physical)==null?void 0:R.apparentAge,gender:t.gender,build:ae.build||"average",physicalTraits:he?ae:void 0,clothing:c?ne:void 0});if(Te.async&&Te.jobId){ve.info(`Avatar job started: ${Te.jobId}, polling for completion...`);const O=60,pe=2e3;for(let Be=0;Be<O;Be++){await new Promise(de=>setTimeout(de,pe));const me=await st.get(`/api/avatar-jobs/${Te.jobId}`);if(me.status==="complete"&&me.clothingAvatars){ve.success(`Avatar job ${Te.jobId} completed after ${(Be+1)*2}s`);const de=me.clothingAvatars.extractedTraits,K=(E=me.clothingAvatars.structuredClothing)==null?void 0:E.standard;return{success:!0,avatars:me.clothingAvatars,extractedTraits:de,extractedClothing:K}}if(me.status==="failed")return ve.error(`Avatar job failed: ${me.error}`),{success:!1,error:me.error};Be%5===0&&ve.info(`Avatar job ${Te.jobId}: ${me.message||me.status} (${me.progress||0}%)`)}return{success:!1,error:"Avatar generation timed out"}}if(Te.success&&Te.clothingAvatars){ve.success(`Clothing avatars WITH TRAITS generated for ${t.name}`);const O=Te.clothingAvatars.extractedTraits,pe=(se=Te.clothingAvatars.structuredClothing)==null?void 0:se.standard;return{success:!0,avatars:Te.clothingAvatars,extractedTraits:O,extractedClothing:pe}}else return ve.error(`Failed to generate avatars with traits: ${Te.error}`),{success:!1,error:Te.error}}catch(q){return ve.error("Clothing avatar generation with traits failed:",q),{success:!1,error:String(q)}}},async analyzePhoto(t,a,n,p,r){var f,x,o,C,$,b,v,B,h,k,L,R,E,se,q,u,z,J,_,Y;try{const I=await st.post("/api/analyze-photo",{imageData:t,language:a,selectedFaceId:n,cachedFaces:p,existingCharacterId:r});if(!I.success)return{success:!1,error:I.error};if(I.multipleFacesDetected&&I.faces)return ve.info(`Multiple faces detected (${I.faceCount}), showing selection UI`),{success:!0,multipleFacesDetected:!0,faceCount:I.faceCount,faces:I.faces};const re={height:(f=I.attributes)==null?void 0:f.height,build:(x=I.attributes)==null?void 0:x.build,face:(o=I.attributes)==null?void 0:o.face,eyeColor:((C=I.attributes)==null?void 0:C.eye_color)||(($=I.attributes)==null?void 0:$.eyeColor),hairColor:((b=I.attributes)==null?void 0:b.hair_color)||((v=I.attributes)==null?void 0:v.hairColor),hairLength:((B=I.attributes)==null?void 0:B.hair_length)||((h=I.attributes)==null?void 0:h.hairLength),hairStyle:((k=I.attributes)==null?void 0:k.hair_style)||((L=I.attributes)==null?void 0:L.hairStyle),hair:((R=I.attributes)==null?void 0:R.hair_color)||((E=I.attributes)==null?void 0:E.hairColor),other:(se=I.attributes)==null?void 0:se.other_features};return{success:I.success,characterId:I.characterId,multipleFacesDetected:!1,faceCount:I.faceCount,photos:{face:I.faceThumbnail,body:I.bodyCrop,bodyNoBg:I.bodyNoBg,faceBox:I.faceBox,bodyBox:I.bodyBox},age:(q=I.attributes)==null?void 0:q.age,apparentAge:(u=I.attributes)==null?void 0:u.apparent_age,gender:(z=I.attributes)==null?void 0:z.gender,physical:re.height||re.build||re.face||re.eyeColor||re.hairColor||re.hairLength||re.hairStyle||re.hair||re.other?re:void 0,clothing:(J=I.attributes)!=null&&J.clothing||(_=I.attributes)!=null&&_.clothingStyle||(Y=I.attributes)!=null&&Y.clothingColors?{current:I.attributes.clothing,style:I.attributes.clothingStyle||I.attributes.clothingColors}:void 0,_debug:I._debug}}catch(I){return ve.error("Photo analysis failed:",I),{success:!1,error:"unknown_error"}}},needsAvatars(t){var r,f,x,o;if(!!!((r=t.photos)!=null&&r.original||(f=t.photos)!=null&&f.face||(x=t.photos)!=null&&x.body||(o=t.photos)!=null&&o.bodyNoBg))return!1;const n=t.avatars;return n?n.status==="generating"||n.status==="pending"?!1:n.status==="failed"?!0:!!!(n.winter||n.standard||n.summer||n.formal||n.hasFullAvatars):!0},async generateAndSaveAvatarForCharacter(t,a,n){var r,f,x,o,C,$,b,v,B,h,k,L,R,E,se,q,u,z,J,_;const p={characterId:t.id,characterName:t.name,success:!1};try{if(!!!((r=t.photos)!=null&&r.original||(f=t.photos)!=null&&f.face||(x=t.photos)!=null&&x.body||(o=t.photos)!=null&&o.bodyNoBg))return p.skipped=!0,p.skipReason="No photo available",p;a==null||a("generating",`Generating avatars for ${t.name}...`),ve.info(`ðŸŽ¨ Generating avatars for ${t.name} (id: ${t.id})${n!=null&&n.avatarModel?`, model: ${n.avatarModel}`:""}`);const I=await Ze.generateClothingAvatars(t,n);if(!I.success||!I.avatars)return p.error=I.error||"Avatar generation failed",a==null||a("error",p.error),p;p.avatars=I.avatars,p.extractedTraits=I.extractedTraits,p.extractedClothing=I.extractedClothing,a==null||a("saving",`Fetching updated data for ${t.name}...`);let re=null;const fe=30;for(let xe=0;xe<fe;xe++){if(xe>0){const ae=Math.min(500*Math.pow(1.2,xe),3e3);ve.info(`[AVATAR] Retry ${xe+1}/${fe}: waiting ${Math.round(ae)}ms for avatar data...`),await new Promise(he=>setTimeout(he,ae))}if(re=await Ze.loadFullCharacter(t.id),(C=re==null?void 0:re.avatars)!=null&&C.standard||($=re==null?void 0:re.avatars)!=null&&$.winter||(b=re==null?void 0:re.avatars)!=null&&b.summer){ve.info(`[AVATAR] Got fresh data with avatars on attempt ${xe+1}`);break}}return re?(p.character=re,(v=re.avatars)!=null&&v.standard||(B=re.avatars)!=null&&B.winter||(h=re.avatars)!=null&&h.summer||ve.warn(`âš ï¸ Fresh DB data for ${t.name} missing avatars after ${fe} retries - server may not have saved them`),ve.info(`ðŸ“‹ Using server-saved data for ${t.name}`)):(ve.error(`âŒ Character ${t.name} (id: ${t.id}) not found in DB after avatar job - avatars lost!`),p.character={...t,avatars:{status:"failed"},physical:I.extractedTraits?{...t.physical,apparentAge:I.extractedTraits.apparentAge||((k=t.physical)==null?void 0:k.apparentAge),build:I.extractedTraits.build||((L=t.physical)==null?void 0:L.build),eyeColor:I.extractedTraits.eyeColor||((R=t.physical)==null?void 0:R.eyeColor),eyeColorHex:I.extractedTraits.eyeColorHex||((E=t.physical)==null?void 0:E.eyeColorHex),hairColor:I.extractedTraits.hairColor||((se=t.physical)==null?void 0:se.hairColor),hairColorHex:I.extractedTraits.hairColorHex||((q=t.physical)==null?void 0:q.hairColorHex),hairLength:I.extractedTraits.hairLength||((u=t.physical)==null?void 0:u.hairLength),hairStyle:I.extractedTraits.hairStyle||((z=t.physical)==null?void 0:z.hairStyle),skinTone:I.extractedTraits.skinTone||((J=t.physical)==null?void 0:J.skinTone),skinToneHex:I.extractedTraits.skinToneHex||((_=t.physical)==null?void 0:_.skinToneHex)}:t.physical,clothing:I.extractedClothing?{...t.clothing,structured:{upperBody:I.extractedClothing.upperBody||void 0,lowerBody:I.extractedClothing.lowerBody||void 0,shoes:I.extractedClothing.shoes||void 0,fullBody:I.extractedClothing.fullBody||void 0}}:t.clothing}),p.success=!0,a==null||a("complete",`Avatars saved for ${t.name}`),ve.success(`âœ… Avatars generated and saved for ${t.name}`),p}catch(Y){return p.error=String(Y),a==null||a("error",p.error),ve.error(`Failed to generate/save avatars for ${t.name}:`,Y),p}},async generateAvatarsForCharacters(t,a){const{forceRegenerate:n=!1,maxConcurrent:p=2,onProgress:r}=a||{};ve.info("ðŸŽ¨ Starting batch avatar generation...");const f=await Ze.getCharacterData();let x;if(t&&t.length>0?x=f.characters.filter(B=>t.includes(B.id)):x=f.characters.filter(B=>{var h,k;return n?!!((h=B.photos)!=null&&h.original||(k=B.photos)!=null&&k.face):Ze.needsAvatars(B)}),x.length===0)return ve.info("No characters need avatar generation"),{results:[],successCount:0,failCount:0,skipCount:0};ve.info(`Processing ${x.length} characters for avatar generation`);const o=[],C=new Map;for(let B=0;B<x.length;B+=p){const k=x.slice(B,B+p).map(async R=>{var se,q,u,z,J;const E={characterId:R.id,characterName:R.name,success:!1};try{if(!!!((se=R.photos)!=null&&se.original||(q=R.photos)!=null&&q.face||(u=R.photos)!=null&&u.body||(z=R.photos)!=null&&z.bodyNoBg))return E.skipped=!0,E.skipReason="No photo available",E;if(!n&&((J=R.avatars)!=null&&J.winter))return E.skipped=!0,E.skipReason="Avatars already exist",E;r==null||r(R.id,"generating",`Generating avatars for ${R.name}...`),ve.info(`ðŸŽ¨ Generating avatars for ${R.name}...`);const Y=await Ze.generateClothingAvatars(R);return!Y.success||!Y.avatars?(E.error=Y.error||"Avatar generation failed",r==null||r(R.id,"error",E.error),E):(E.avatars=Y.avatars,E.success=!0,C.set(R.id,{...R,avatars:Y.avatars}),r==null||r(R.id,"complete",`Avatars generated for ${R.name}`),ve.success(`âœ… Avatars generated for ${R.name}`),E)}catch(_){return E.error=String(_),r==null||r(R.id,"error",E.error),ve.error(`Failed to generate avatars for ${R.name}:`,_),E}}),L=await Promise.all(k);o.push(...L)}if(C.size>0){ve.info(`ðŸ’¾ Saving ${C.size} character avatar updates...`);const B=await Ze.getCharacterData(),h=B.characters.map(k=>C.get(k.id)||k);await Ze.saveCharacterData({...B,characters:h}),ve.success(`ðŸ’¾ Saved character data for ${C.size} characters`)}const $=o.filter(B=>B.success).length,b=o.filter(B=>!B.success&&!B.skipped).length,v=o.filter(B=>B.skipped).length;return ve.info(`Avatar generation complete: ${$} success, ${b} failed, ${v} skipped`),{results:o,successCount:$,failCount:b,skipCount:v}},async regenerateAvatarsForCharacter(t,a,n){ve.info(`ðŸ”„ Regenerating avatars for character ${t}...`);const r=(await Ze.getCharacterData()).characters.find(x=>x.id===t);if(!r)return{characterId:t,characterName:"Unknown",success:!1,error:"Character not found"};const f={...r,avatars:{status:"pending"}};return Ze.generateAndSaveAvatarForCharacter(f,a?(x,o)=>a(x,o):void 0,n)}},Ln={sm:"h-1",md:"h-2",lg:"h-3"},il={default:"bg-indigo-600",success:"bg-green-500",warning:"bg-yellow-500",gradient:"bg-gradient-to-r from-indigo-500 to-indigo-600"};function ll({value:t,max:a=100,label:n,showPercentage:p=!1,size:r="md",variant:f="gradient",className:x=""}){const o=Math.min(Math.max(t/a*100,0),100);return e.jsxs("div",{className:x,children:[(n||p)&&e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n&&e.jsx("span",{className:"text-sm font-medium text-gray-700",children:n}),p&&e.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(o),"%"]})]}),e.jsx("div",{className:`w-full bg-gray-200 rounded-full overflow-hidden ${Ln[r]}`,children:e.jsx("div",{className:`${Ln[r]} ${il[f]} rounded-full transition-all duration-500 ease-out`,style:{width:`${o}%`}})})]})}const ar=yn("ImageLoad");function Ka({src:t,alt:a,className:n,label:p}){const[r,f]=d.useState(!0),[x,o]=d.useState(null),C=d.useRef(0),$=d.useRef(null);d.useEffect(()=>{t&&t.length>100?(C.current=Date.now(),ar.info(`â³ Loading ${p||a}`,{isBase64:t==null?void 0:t.startsWith("data:"),sizeKB:Math.round(t.length*3/4/1024)})):C.current=0,f(!0),o(null)},[t,a,p]);const b=()=>{if(f(!1),C.current===0){ar.info(`âœ… Loaded ${p||a} (placeholder/empty)`);return}const B=Date.now()-C.current;o(B);const k=(t==null?void 0:t.startsWith("data:"))?Math.round(t.length*3/4/1024):null,L=$.current?`${$.current.naturalWidth}x${$.current.naturalHeight}`:"unknown";B<100?ar.success(`âœ… Loaded ${p||a} in ${B}ms`,{sizeKB:k,naturalSize:L}):B<500?ar.info(`âœ… Loaded ${p||a} in ${B}ms`,{sizeKB:k,naturalSize:L}):B<2e3?ar.warn(`âš ï¸ Slow load: ${p||a} took ${B}ms`,{sizeKB:k,naturalSize:L}):ar.error(`ðŸ¢ Very slow: ${p||a} took ${B}ms`,{sizeKB:k,naturalSize:L}),B>1e3&&ol({type:"slow_image_load",label:p||a,loadTimeMs:B,sizeKB:k,naturalSize:L,userAgent:navigator.userAgent,timestamp:new Date().toISOString()})},v=()=>{if(f(!1),C.current===0){ar.error(`âŒ Failed to load ${p||a} (no data received)`);return}const B=Date.now()-C.current;ar.error(`âŒ Failed to load ${p||a} after ${B}ms`)};return e.jsx("img",{ref:$,src:t,alt:a,className:n,onLoad:b,onError:v,draggable:!1})}async function ol(t){try{await fetch("/api/log-error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errorType:"Performance",message:`Slow image load: ${t.label} took ${t.loadTimeMs}ms`,userAgent:t.userAgent,timestamp:t.timestamp,url:window.location.href})})}catch{}}function dl({step:t,text:a}){const n=`wizard_helper_dismissed_${t}`,[p,r]=d.useState(()=>localStorage.getItem(n)==="true");d.useEffect(()=>{const x=localStorage.getItem(n)==="true";r(x)},[t,n]);const f=()=>{localStorage.setItem(n,"true"),r(!0)};return p?null:e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg px-3 py-2 md:px-4 md:py-3 mb-4 flex items-start gap-2 md:gap-3",children:[e.jsx("p",{className:"text-sm text-indigo-700 flex-1",children:a}),e.jsx("button",{onClick:f,className:"text-indigo-400 hover:text-indigo-600 transition-colors flex-shrink-0 p-0.5","aria-label":"Dismiss",children:e.jsx(ns,{size:16})})]})}function cl({current:t,total:a,message:n,isGenerating:p=!0,coverImages:r,jobId:f,onCancel:x,onMinimize:o,characters:C=[],isStalled:$=!1,onDismissStalled:b,isImpersonating:v=!1}){const{language:B}=gt(),{user:h}=sn(),k=(h==null?void 0:h.role)==="admin"||v,[L,R]=d.useState(!1),[E,se]=d.useState(0),q=[{en:"{name} is getting ready for their big adventure...",de:"{name} macht sich bereit fÃ¼r das grosse Abenteuer...",fr:"{name} se prÃ©pare pour sa grande aventure..."},{en:"{name} is practicing their hero pose...",de:"{name} Ã¼bt gerade die Heldenpose...",fr:"{name} s'entraÃ®ne Ã  prendre la pose du hÃ©ros..."},{en:"{name} can't wait to see what happens next!",de:"{name} kann es kaum erwarten zu sehen, was als NÃ¤chstes passiert!",fr:"{name} a hÃ¢te de voir ce qui va se passer !"},{en:"{name} is warming up for the adventure ahead...",de:"{name} wÃ¤rmt sich fÃ¼r das bevorstehende Abenteuer auf...",fr:"{name} s'Ã©chauffe pour l'aventure Ã  venir..."},{en:"{name} just found a magic feather! Adding it to the story...",de:"{name} hat gerade eine Zauberfeder gefunden! Wir fÃ¼gen sie der Geschichte hinzu...",fr:"{name} vient de trouver une plume magique ! On l'ajoute au rÃ©cit..."},{en:"{name} is whispering secrets to the story wizard...",de:"{name} flÃ¼stert dem Geschichtenzauberer Geheimnisse zu...",fr:"{name} chuchote des secrets au magicien des histoires..."},{en:"{name} is peeking around the corner to see what's coming...",de:"{name} schaut um die Ecke, um zu sehen, was kommt...",fr:"{name} jette un coup d'Å“il au coin pour voir ce qui arrive..."},{en:"{name} is doing a little happy dance!",de:"{name} macht einen kleinen Freudentanz!",fr:"{name} fait une petite danse de joie !"},{en:"{name} is collecting stars for the story...",de:"{name} sammelt Sterne fÃ¼r die Geschichte...",fr:"{name} collectionne des Ã©toiles pour le rÃ©cit..."},{en:"{name} just met a friendly dragon! Making friends...",de:"{name} hat gerade einen freundlichen Drachen getroffen! Sie werden Freunde...",fr:"{name} vient de rencontrer un dragon amical ! Ils deviennent amis..."}],u=d.useRef({}),[z,J]=d.useState(null),_=d.useMemo(()=>C.filter(me=>{var K;const de=me.avatars;return de&&(((K=de.faceThumbnails)==null?void 0:K.standard)||de.standard||de.summer||de.winter||de.formal||de.hasFullAvatars)}),[C]),Y=me=>{var Fe;const de=me.avatars;if(!de)return"";if((Fe=de.faceThumbnails)!=null&&Fe.standard)return de.faceThumbnails.standard;const K=[];return de.standard&&K.push(de.standard),de.summer&&K.push(de.summer),de.winter&&K.push(de.winter),de.formal&&K.push(de.formal),K[Math.floor(Math.random()*K.length)]||""},I=d.useMemo(()=>{const me=[{type:"message",key:"timeInfo"},{type:"message",key:"tipCharacters"},{type:"message",key:"emailInfo"},{type:"message",key:"tipStoryPlot"},{type:"message",key:"canClose"},{type:"message",key:"tipLocations"},{type:"message",key:"tipArtStyle"}];if(_.length===0)return me;const de=[],K=Math.max(me.length,_.length);for(let Fe=0;Fe<K;Fe++)de.push(me[Fe%me.length]),de.push({type:"character",char:_[Fe%_.length]});return de},[_]);if(d.useEffect(()=>{if(I.length<=1)return;const me=setInterval(()=>{se(de=>(de+1)%I.length)},8e3);return()=>clearInterval(me)},[I.length]),d.useEffect(()=>{if(I.length===0)return;const me=I[E];if(me.type==="character"){const de=me.char,K=Y(de),T=((u.current[de.id]??-1)+1)%q.length;u.current[de.id]=T;const X=q[T],be=(B==="de"?X.de:B==="fr"?X.fr:X.en).replace("{name}",de.name);J({avatarUrl:K,message:be})}else J(null)},[E,I,B]),!p||a===0)return null;const re=a===100?t:Math.round(t/a*100),fe=me=>{if(me)return typeof me=="string"?me:me.imageData},xe=fe(r==null?void 0:r.frontCover),ae=fe(r==null?void 0:r.initialPage),he=fe(r==null?void 0:r.backCover),Se=!!xe,ne=!!ae,c=!!he,Te=Se||ne||c,O={en:{title:"Creating Your Story!",timeInfo:"Your story will start to display in about 1 minute. The full story can take up to 10 minutes.",emailInfo:"You will receive an email when your story is ready.",canClose:"You can wait here or close the browser - your story will keep generating.",tipCharacters:"The better you describe your characters, the more fun the story becomes!",tipStoryPlot:'"Story Plot / Story Details" lets you craft your own personal adventure.',tipLocations:'Add your hometown and favorite places to "Story Plot / Story Details" for a personal touch.',tipArtStyle:"What's your favorite art style? For picture books, watercolor works great!",coversPreview:"Cover Preview",frontCover:"Front",initialPage:"Inside",backCover:"Back",cancelJob:"Cancel Generation",cancelling:"Cancelling...",stalled:"Generation seems stuck",stalledDesc:"No progress for a while. This can happen due to high server load.",continueWaiting:"Keep Waiting",continueInBackground:"Continue in Background"},de:{title:"Geschichte wird erstellt!",timeInfo:"Deine Geschichte wird in etwa 1 Minute angezeigt. Die Erstellung der vollstÃ¤ndigen Geschichte kann bis zu 10 Minuten dauern.",emailInfo:"Du erhÃ¤ltst eine E-Mail, wenn deine Geschichte bereit ist.",canClose:"Du kannst hier warten oder den Browser schliessen - deine Geschichte wird weiter generiert.",tipCharacters:"Je besser du deine Charaktere beschreibst, desto lustiger wird die Geschichte!",tipStoryPlot:'Mit "Handlung / Angaben zur Geschichte" kannst du dein ganz persÃ¶nliches Abenteuer gestalten.',tipLocations:'FÃ¼ge deinen Heimatort und Lieblingsorte zu "Handlung / Angaben zur Geschichte" hinzu fÃ¼r eine persÃ¶nliche Note.',tipArtStyle:"Was ist dein Lieblings-Kunststil? FÃ¼r BilderbÃ¼cher funktioniert Aquarell besonders gut!",coversPreview:"Cover-Vorschau",frontCover:"Vorne",initialPage:"Innen",backCover:"Hinten",cancelJob:"Generierung abbrechen",cancelling:"Wird abgebrochen...",stalled:"Generierung scheint hÃ¤ngen zu bleiben",stalledDesc:"Seit einer Weile kein Fortschritt. Dies kann bei hoher Serverlast passieren.",continueWaiting:"Weiter warten",continueInBackground:"Im Hintergrund fortsetzen"},fr:{title:"CrÃ©ation de votre histoire!",timeInfo:"Votre rÃ©cit commencera Ã  s'afficher dans environ 1 minute. Le rÃ©cit complet peut prendre jusqu'Ã  10 minutes.",emailInfo:"Vous recevrez un email quand votre rÃ©cit sera prÃªt.",canClose:"Vous pouvez attendre ici ou fermer le navigateur - votre rÃ©cit continuera Ã  Ãªtre gÃ©nÃ©rÃ©.",tipCharacters:"Mieux vous dÃ©crivez vos personnages, plus le rÃ©cit sera amusant !",tipStoryPlot:'"Intrigue / Contexte du rÃ©cit" vous permet de crÃ©er votre propre aventure personnelle.',tipLocations:'Ajoutez votre ville et vos endroits prÃ©fÃ©rÃ©s Ã  "Intrigue / Contexte du rÃ©cit" pour une touche personnelle.',tipArtStyle:"Quel est votre style artistique prÃ©fÃ©rÃ© ? Pour les livres d'images, l'aquarelle fonctionne trÃ¨s bien !",coversPreview:"AperÃ§u des couvertures",frontCover:"Avant",initialPage:"IntÃ©rieur",backCover:"ArriÃ¨re",cancelJob:"Annuler la gÃ©nÃ©ration",cancelling:"Annulation...",stalled:"La gÃ©nÃ©ration semble bloquÃ©e",stalledDesc:"Aucun progrÃ¨s depuis un moment. Cela peut arriver en cas de forte charge serveur.",continueWaiting:"Continuer Ã  attendre",continueInBackground:"Continuer en arriÃ¨re-plan"}},pe=O[B]||O.en,Be=({imageData:me,label:de,isReady:K})=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`w-16 h-16 md:w-20 md:h-20 rounded-lg overflow-hidden border-2 ${K?"border-green-400":"border-gray-200"} bg-gray-100 flex items-center justify-center`,children:K&&me?e.jsx("img",{src:me,alt:de,className:"w-full h-full object-cover"}):e.jsx(Lt,{size:20,className:"animate-spin text-gray-400"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[K&&e.jsx(An,{size:12,className:"text-green-500"}),e.jsx("span",{className:`text-xs ${K?"text-green-600 font-medium":"text-gray-400"}`,children:de})]})]});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`bg-white rounded-2xl shadow-xl w-full p-6 md:p-8 ${Te?"max-w-lg":"max-w-md"}`,children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"relative inline-block mb-3",children:[e.jsx(Lt,{size:48,className:"animate-spin text-indigo-600"}),e.jsx("span",{className:"absolute -top-1 -right-1 text-xl",children:"âœ¨"})]}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-800",children:pe.title})]}),!Te&&I.length>0&&e.jsx("div",{className:"mb-6 min-h-[220px] flex items-center justify-center",children:(()=>{const me=I[E];if(me.type==="character"&&z)return e.jsxs("div",{className:"flex flex-col items-center gap-3 animate-fade-in",children:[e.jsx("div",{className:"w-32 h-44 md:w-40 md:h-52 rounded-xl overflow-hidden border-4 border-indigo-200 shadow-lg bg-gradient-to-b from-indigo-50 to-purple-50",children:e.jsx("img",{src:z.avatarUrl,alt:me.char.name,className:"w-full h-full object-contain"})}),e.jsx("p",{className:"text-sm text-center text-gray-600 max-w-xs italic",children:z.message})]},`char-${me.char.id}-${E}`);if(me.type==="message"){const de=me.key,K=pe[de]||"",Fe=de==="timeInfo"?e.jsx(Ri,{size:20,className:"text-indigo-500 shrink-0"}):de==="emailInfo"?e.jsx(ei,{size:20,className:"text-indigo-500 shrink-0"}):e.jsx(An,{size:20,className:"text-indigo-500 shrink-0"});return e.jsxs("div",{className:"flex items-start gap-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 max-w-sm animate-fade-in",children:[Fe,e.jsx("p",{className:"text-sm text-gray-700",children:K})]})}return null})()}),Te&&e.jsxs("div",{className:"mb-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-indigo-700 text-center mb-3",children:pe.coversPreview}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(Be,{imageData:xe,label:pe.frontCover,isReady:Se}),e.jsx(Be,{imageData:ae,label:pe.initialPage,isReady:ne}),e.jsx(Be,{imageData:he,label:pe.backCover,isReady:c})]})]}),Te&&e.jsxs("div",{className:"mb-4 text-center",children:[e.jsxs("p",{className:"text-sm text-gray-600 flex items-center justify-center gap-2",children:[e.jsx(Lt,{size:14,className:"animate-spin text-indigo-500"}),B==="de"?"Bilder fÃ¼r die Seiten werden jetzt erstellt...":B==="fr"?"CrÃ©ation des images pour les pages en cours...":"Now generating images for the pages..."]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:B==="de"?"Dies kann einige Minuten dauern. Du kannst den Browser schliessen.":B==="fr"?"Cela peut prendre quelques minutes. Vous pouvez fermer le navigateur.":"This may take a few minutes. You can close the browser."})]}),e.jsx("div",{className:"mb-4",children:e.jsx(ll,{value:re,max:100,showPercentage:!0,size:"lg"})}),o&&e.jsx("button",{onClick:o,className:"w-full mb-4 px-4 py-2.5 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded-lg font-medium transition-colors text-sm",children:pe.continueInBackground}),$&&e.jsx("div",{className:"mb-4 bg-amber-50 border border-amber-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(vn,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-amber-800 mb-1",children:pe.stalled}),e.jsx("p",{className:"text-sm text-amber-700 mb-3",children:pe.stalledDesc}),e.jsxs("div",{className:"flex gap-2",children:[b&&e.jsx("button",{onClick:b,className:"px-3 py-1.5 bg-amber-100 hover:bg-amber-200 text-amber-800 rounded-lg text-sm font-medium transition-colors",children:pe.continueWaiting}),x&&e.jsx("button",{onClick:()=>{if(!L){R(!0);try{x()}finally{R(!1)}}},disabled:L,className:"px-3 py-1.5 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:L?pe.cancelling:pe.cancelJob})]})]})]})}),k&&f&&x&&e.jsxs("button",{onClick:async()=>{if(!L){R(!0);try{x()}finally{R(!1)}}},disabled:L,className:"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:[L?e.jsx(Lt,{size:16,className:"animate-spin"}):e.jsx(Li,{size:16}),L?pe.cancelling:pe.cancelJob]})]})})}function xn(t,a){const n=new Blob([t],{type:"text/plain;charset=utf-8"}),p=URL.createObjectURL(n),r=document.createElement("a");r.href=p,r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(p)}function pn(t,a=0){const n="  ".repeat(a);if(t==null)return`${n}null`;if(typeof t=="boolean")return`${n}${t?"YES":"NO"}`;if(typeof t=="number")return`${n}${t}`;if(typeof t=="string")return`${n}${t}`;if(Array.isArray(t))return t.length===0?`${n}[]`:t.map((p,r)=>`${n}[${r}]: ${pn(p,0)}`).join(`
`);if(typeof t=="object"){const p=Object.entries(t);return p.length===0?`${n}{}`:p.map(([r,f])=>{const x=pn(f,a+1);return typeof f=="object"&&f!==null?`${n}${r}:
${x}`:`${n}${r}: ${x.trim()}`}).join(`
`)}return`${n}${String(t)}`}function Rn({data:t,language:a,title:n}){const[p,r]=d.useState(new Set);if(!t)return e.jsx("div",{className:"text-gray-400 italic text-sm",children:a==="de"?"Keine Daten":"No data"});let f=t;if(typeof t=="string")try{f=JSON.parse(t)}catch{return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-1",children:e.jsxs("button",{onClick:()=>xn(t,`${n||"evaluation"}.txt`),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1",title:"Download as text file",children:[e.jsx(en,{size:12})," Download"]})}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap bg-gray-50 p-3 rounded max-h-80 overflow-auto font-mono",children:t})]})}const x=$=>{const b=new Set(p);b.has($)?b.delete($):b.add($),r(b)},o=()=>{const $=pn(f);xn($,`${n||"evaluation"}.txt`)},C=($,b,v=0)=>{const B=p.has($);if(b==null)return e.jsx("span",{className:"text-gray-400",children:"null"});if(typeof b=="boolean")return e.jsx("span",{className:b?"text-green-600 font-medium":"text-red-600 font-medium",children:b?"âœ“":"âœ—"});if(typeof b=="number"){const h=b>=70?"text-green-600":b>=50?"text-yellow-600":"text-red-600";return e.jsx("span",{className:`font-bold ${h}`,children:b})}if(typeof b=="string")return b.length>100?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>x($),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[B?e.jsx(Ft,{size:14}):e.jsx(tn,{size:14}),B?"Collapse":`Show (${b.length} chars)`]}),B&&e.jsx("div",{className:"mt-1 p-2 bg-gray-100 rounded text-sm whitespace-pre-wrap font-mono",children:b})]}):e.jsx("span",{className:"text-gray-700",children:b});if(Array.isArray(b))return b.length===0?e.jsx("span",{className:"text-gray-400",children:"[]"}):e.jsx("div",{className:"ml-2 border-l-2 border-gray-200 pl-2",children:b.map((h,k)=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"text-gray-400 text-xs",children:["[",k,"]"]})," ",C(`${$}.${k}`,h,v+1)]},k))});if(typeof b=="object"){const h=Object.entries(b);return h.length===0?e.jsx("span",{className:"text-gray-400",children:"{}"}):v>0?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>x($),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[B?e.jsx(Ft,{size:14}):e.jsx(tn,{size:14}),B?"Collapse":`{${h.length} fields}`]}),B&&e.jsx("div",{className:"ml-2 mt-1 border-l-2 border-gray-200 pl-2",children:h.map(([k,L])=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-600",children:[k,":"]})," ",C(`${$}.${k}`,L,v+1)]},k))})]}):e.jsx("div",{className:"space-y-1",children:h.map(([k,L])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-600 min-w-[100px]",children:[k,":"]}),e.jsx("div",{className:"flex-1",children:C(`${$}.${k}`,L,v+1)})]},k))})}return e.jsx("span",{children:String(b)})};return e.jsxs("div",{className:"text-sm space-y-1 max-h-96 overflow-auto",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("button",{onClick:o,className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-1 bg-blue-50 rounded hover:bg-blue-100",title:"Download as text file",children:[e.jsx(en,{size:12})," Download"]})}),C("root",f)]})}function ml({beforeImage:t,maskImage:a,onEnlarge:n}){return e.jsxs("div",{className:"relative w-40 h-40 cursor-pointer hover:ring-2 hover:ring-amber-400 rounded overflow-hidden border",onClick:()=>n(t,"Before with Mask"),children:[e.jsx("img",{src:t,alt:"Before",className:"w-full h-full object-contain"}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:{backgroundImage:`url(${a})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",mixBlendMode:"multiply",opacity:.5}}),e.jsx("img",{src:a,alt:"Mask overlay",className:"absolute inset-0 w-full h-full object-contain pointer-events-none",style:{mixBlendMode:"screen",opacity:.7,filter:"sepia(1) saturate(5) hue-rotate(-50deg)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent text-white text-[10px] text-center py-1 font-medium",children:"ðŸŽ¯ Edit Area"})]})}function Or({retryHistory:t,totalAttempts:a,language:n,onRevertRepair:p}){const[r,f]=d.useState(null);if(!t||t.length===0)return null;const x=t.filter(o=>o.type==="auto_repair").length;return e.jsxs(e.Fragment,{children:[r&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>f(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("div",{className:"absolute -top-8 left-0 text-white text-sm",children:r.title}),e.jsx("img",{src:r.src,alt:r.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute -top-8 right-0 text-white hover:text-gray-300",onClick:()=>f(null),children:"âœ• Close"})]})}),e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Gi,{size:14}),n==="de"?"Generierungshistorie":n==="fr"?"Historique de gÃ©nÃ©ration":"Generation History",x>0&&e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded",children:["ðŸ”§ ",x," ",n==="de"?"Reparatur":"repair",x>1?n==="de"?"en":"s":""]})]}),e.jsxs("span",{className:"text-purple-600",children:[a," ",n==="de"?"Versuche":n==="fr"?"tentatives":"attempts"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:t.map((o,C)=>{var $,b;return e.jsxs("div",{className:`border rounded-lg p-3 ${o.type==="auto_repair"?"bg-amber-50 border-amber-300":C===t.length-1?"bg-green-50 border-green-300":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-sm",children:[o.type==="auto_repair"?e.jsx("span",{className:"text-amber-700",children:"ðŸ”§ Auto-Repair"}):e.jsx(e.Fragment,{children:n==="de"?`Versuch ${o.attempt}`:n==="fr"?`Tentative ${o.attempt}`:`Attempt ${o.attempt}`}),o.type==="text_edit"&&e.jsx("span",{className:"text-xs ml-2 text-blue-600",children:"(text edit)"}),o.type==="text_edit_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(text edit failed)"}),o.type==="auto_repair_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(auto-repair failed)"}),C===t.length-1&&o.type!=="auto_repair"&&e.jsx("span",{className:"text-xs ml-2 text-green-600 font-bold",children:"âœ“ USED"})]}),o.type==="auto_repair"&&o.preRepairScore!==void 0&&o.postRepairScore!==void 0?e.jsxs("span",{className:"font-bold text-sm",children:[e.jsxs("span",{className:o.preRepairScore>=70?"text-green-600":o.preRepairScore>=50?"text-yellow-600":"text-red-600",children:[o.preRepairScore,"%"]}),e.jsx("span",{className:"text-gray-400 mx-1",children:"â†’"}),e.jsxs("span",{className:o.postRepairScore>=70?"text-green-600":o.postRepairScore>=50?"text-yellow-600":"text-red-600",children:[o.postRepairScore,"%"]})]}):o.score!==void 0&&e.jsxs("span",{className:`font-bold ${o.score>=70?"text-green-600":o.score>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(o.score),"%"]})]}),o.error&&e.jsxs("div",{className:"text-xs text-red-600 mb-2",children:["Error: ",o.error]}),o.textIssue&&o.textIssue!=="NONE"&&e.jsxs("div",{className:"text-xs text-orange-600 mb-2",children:["Text issue: ",o.textIssue,o.expectedText&&e.jsxs("span",{className:"block",children:['Expected: "',o.expectedText,'"']}),o.actualText&&e.jsxs("span",{className:"block",children:['Actual: "',o.actualText,'"']})]}),o.type==="auto_repair"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[o.fixTargetsCount&&e.jsxs("div",{className:"text-xs text-amber-700",children:["Fixed ",o.fixTargetsCount," target",o.fixTargetsCount>1?"s":""]}),p&&((b=($=o.repairDetails)==null?void 0:$[0])==null?void 0:b.beforeImage)&&o.postRepairScore!==void 0&&o.preRepairScore!==void 0&&o.postRepairScore<=o.preRepairScore&&e.jsxs("button",{onClick:()=>p(C,o.repairDetails[0].beforeImage),className:"text-xs px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded border border-red-300 transition-colors",children:["â†©ï¸ ",n==="de"?"ZurÃ¼cksetzen":"Revert to Original"]})]}),o.postRepairScore!==void 0&&o.preRepairScore!==void 0&&o.postRepairScore<o.preRepairScore&&e.jsxs("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded border border-red-200",children:["âš ï¸ ",n==="de"?`Bewertung verschlechtert: ${o.preRepairScore}% â†’ ${o.postRepairScore}%`:`Score decreased: ${o.preRepairScore}% â†’ ${o.postRepairScore}%`]}),e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["ðŸ“Š ",n==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-red-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-red-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 px-2 py-0.5 rounded",children:"Before"}),e.jsxs("span",{className:"text-red-600",children:[o.preRepairScore,"%"]})]}),e.jsx(Rn,{data:o.preRepairEval||o.reasoning,language:n,title:`evaluation-before-attempt-${C}`})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-green-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded",children:"After"}),e.jsxs("span",{className:"text-green-600",children:[o.postRepairScore,"%"]})]}),e.jsx(Rn,{data:o.postRepairEval,language:n,title:`evaluation-after-attempt-${C}`})]})]})]}),o.repairDetails&&o.repairDetails.length>0&&e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["ðŸ–¼ï¸ ",n==="de"?"Reparatur-Details":"Repair Details"," (",o.repairDetails.length,")"]}),e.jsx("div",{className:"mt-3 space-y-3",children:o.repairDetails.map((v,B)=>{var h,k;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-medium text-amber-800 text-base",children:v.description}),v.modelId&&e.jsx("span",{className:"text-xs text-gray-400 bg-gray-100 px-2 py-0.5 rounded",children:v.modelId})]}),e.jsxs("details",{className:"mb-3",children:[e.jsxs("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700 text-sm flex items-center gap-2",children:["Show fix prompt",e.jsxs("button",{onClick:L=>{L.stopPropagation(),xn(v.fullPrompt||v.fixPrompt||"",`fix-prompt-${B}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(en,{size:10})," Download"]})]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded text-sm text-gray-600 whitespace-pre-wrap font-mono max-h-96 overflow-auto",children:v.fullPrompt||v.fixPrompt})]}),e.jsxs("div",{className:"flex gap-4 items-start",children:[v.beforeImage&&v.maskImage?e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before + Mask"}),e.jsx(ml,{beforeImage:v.beforeImage,maskImage:v.maskImage,onEnlarge:(L,R)=>f({src:L,title:R})})]}):v.beforeImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before"}),e.jsx("img",{src:v.beforeImage,alt:"Before",className:"w-32 h-32 object-contain border rounded cursor-pointer hover:ring-2 hover:ring-amber-400",onClick:()=>f({src:v.beforeImage,title:"Before Repair"})})]}),e.jsx("div",{className:"flex items-center h-32 text-gray-400 text-2xl",children:"â†’"}),v.afterImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"After"}),e.jsx("img",{src:v.afterImage,alt:"After",className:"w-32 h-32 object-contain border-2 border-green-300 rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>f({src:v.afterImage,title:"After Repair"})})]})]}),v.verification&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded border text-sm",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"ðŸ” Verification:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[v.verification.lpips&&e.jsxs("div",{className:`p-2 rounded ${v.verification.lpips.changed?"bg-green-100":"bg-yellow-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LPIPS: "}),e.jsx("span",{className:v.verification.lpips.changed?"text-green-700":"text-yellow-700",children:(h=v.verification.lpips.lpipsScore)==null?void 0:h.toFixed(4)}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",v.verification.lpips.changed?"âœ“ changed":"âš  unchanged",")"]})]}),v.verification.llm&&e.jsxs("div",{className:`p-2 rounded ${v.verification.llm.fixed?"bg-green-100":"bg-red-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LLM: "}),e.jsx("span",{className:v.verification.llm.fixed?"text-green-700":"text-red-700",children:v.verification.llm.fixed?"âœ“ Fixed":"âœ— Not fixed"}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",Math.round(v.verification.llm.confidence*100),"%)"]})]})]}),((k=v.verification.llm)==null?void 0:k.explanation)&&e.jsx("div",{className:"mt-2 text-gray-600 text-sm italic",children:v.verification.llm.explanation})]})]},B)})})]})]}),o.type!=="auto_repair"&&o.reasoning?e.jsxs("details",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("summary",{className:"cursor-pointer",children:"Feedback"}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap bg-gray-50 p-3 rounded text-sm overflow-auto max-h-60 font-mono",children:o.reasoning})]}):o.type!=="auto_repair"&&o.score===0&&e.jsx("div",{className:"text-sm text-gray-500 italic mb-2",children:n==="de"?"QualitÃ¤tsbewertung fehlgeschlagen":n==="fr"?"Ã‰valuation de qualitÃ© Ã©chouÃ©e":"Quality evaluation failed"}),o.imageData&&o.type!=="auto_repair"&&e.jsxs("details",{children:[e.jsx("summary",{className:"cursor-pointer text-sm text-blue-600",children:n==="de"?"Bild anzeigen":n==="fr"?"Voir image":"View image"}),e.jsx("img",{src:o.imageData,alt:`Attempt ${o.attempt}`,className:`mt-2 w-full rounded border ${C===t.length-1?"border-green-300":"border-gray-200 opacity-75"}`})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(o.timestamp).toLocaleTimeString()})]},C)})})]})]})}function fn({src:t,alt:a,onClose:n}){const p=d.useCallback(r=>{r.key==="Escape"&&n()},[n]);return d.useEffect(()=>(t&&(document.addEventListener("keydown",p),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",p),document.body.style.overflow="unset"}),[t,p]),t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm cursor-pointer",onClick:n,children:[e.jsx("button",{onClick:n,className:"absolute top-4 right-4 p-2 rounded-full bg-black/50 hover:bg-black/70 text-white transition-colors z-10","aria-label":"Close",children:e.jsx(ns,{size:24})}),e.jsx("img",{src:t,alt:a||"Enlarged image",className:"max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl",onClick:r=>r.stopPropagation()})]}):null}function ua({referencePhotos:t,landmarkPhotos:a,language:n}){var B;const[p,r]=d.useState(null),f=t&&t.length>0,x=a&&a.length>0;if(!f&&!x)return null;const o=((t==null?void 0:t.length)||0)+((a==null?void 0:a.length)||0),C=h=>{switch(h){case"bodyNoBg":case"body-no-bg":return n==="de"?"GanzkÃ¶rper (freigestellt)":n==="fr"?"Corps entier (dÃ©tourÃ©)":"Full body (no bg)";case"body":return n==="de"?"GanzkÃ¶rper":n==="fr"?"Corps entier":"Full body";case"face":return n==="de"?"Gesicht":n==="fr"?"Visage":"Face only";case"clothing-winter":return n==="de"?"Winter-Avatar":n==="fr"?"Avatar hiver":"Winter avatar";case"clothing-summer":return n==="de"?"Sommer-Avatar":n==="fr"?"Avatar Ã©tÃ©":"Summer avatar";case"clothing-formal":return n==="de"?"Formell-Avatar":n==="fr"?"Avatar formel":"Formal avatar";case"clothing-standard":return n==="de"?"Standard-Avatar":n==="fr"?"Avatar standard":"Standard avatar";case"none":return n==="de"?"Kein Foto":n==="fr"?"Pas de photo":"No photo";default:return h}},$=h=>{switch(h){case"bodyNoBg":case"body-no-bg":return"bg-green-100 text-green-700 border-green-300";case"body":return"bg-blue-100 text-blue-700 border-blue-300";case"face":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"clothing-winter":return"bg-cyan-100 text-cyan-700 border-cyan-300";case"clothing-summer":return"bg-orange-100 text-orange-700 border-orange-300";case"clothing-formal":return"bg-purple-100 text-purple-700 border-purple-300";case"clothing-standard":return"bg-teal-100 text-teal-700 border-teal-300";case"none":return"bg-red-100 text-red-700 border-red-300";default:return"bg-gray-100 text-gray-700 border-gray-300"}},b=(B=t.find(h=>h.clothingCategory))==null?void 0:B.clothingCategory,v=h=>{if(!h)return"";switch(h){case"winter":return n==="de"?"Winter":n==="fr"?"Hiver":"Winter";case"summer":return n==="de"?"Sommer":n==="fr"?"Ã‰tÃ©":"Summer";case"formal":return n==="de"?"Formell":n==="fr"?"Formel":"Formal";case"standard":return"Standard";default:return h}};return e.jsxs("details",{className:"bg-pink-50 border border-pink-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-900 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“¸"}),n==="de"?"Referenzfotos":n==="fr"?"Photos de rÃ©fÃ©rence":"Reference Photos",e.jsxs("span",{className:"text-xs text-pink-600",children:["(",o,")"]}),b&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-pink-200 text-pink-800 text-xs rounded",children:["ðŸ‘• ",v(b)]}),x&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-amber-200 text-amber-800 text-xs rounded",children:["ðŸ“ ",a.length," ",n==="de"?"Wahrzeichen":"Landmark"]})]}),f&&e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2",children:t.map((h,k)=>e.jsxs("div",{className:"bg-white rounded-lg p-2 border border-pink-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:h.name}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap ${$(h.photoType)}`,children:C(h.photoType)})]}),h.photoUrl&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:h.photoUrl,alt:`${h.name} - ${C(h.photoType)}`,className:`w-full max-h-32 object-contain rounded border bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity ${h.isStyled?"border-purple-400 ring-2 ring-purple-200":"border-gray-200"}`,onClick:()=>r(h.photoUrl),title:"Click to enlarge"}),h.isStyled&&e.jsx("span",{className:"absolute top-1 right-1 px-1 py-0.5 text-[9px] font-bold bg-purple-500 text-white rounded",children:"ðŸŽ¨ STYLED"})]}),h.photoHash&&e.jsxs("div",{className:"mt-1 text-[9px] font-mono text-gray-500 bg-gray-100 px-1 py-0.5 rounded text-center",children:["ðŸ” ",h.photoHash]})]})]},k))}),x&&e.jsxs("div",{className:f?"mt-4 pt-3 border-t border-pink-200":"mt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-amber-700 mb-2 flex items-center gap-1",children:["ðŸ“ ",n==="de"?"Wahrzeichen-Referenzfotos":n==="fr"?"Photos de monuments":"Landmark Reference Photos"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:a.map((h,k)=>e.jsxs("div",{className:"bg-amber-50 rounded-lg p-2 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:h.name}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap bg-amber-100 text-amber-700 border-amber-300",children:"ðŸ“ LANDMARK"})]}),h.photoData&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:h.photoData,alt:`${h.name} landmark`,className:"w-full max-h-32 object-contain rounded border border-amber-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>r(h.photoData),title:"Click to enlarge"})}),h.attribution&&e.jsxs("div",{className:"mt-1 text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 rounded truncate",title:h.attribution,children:["ðŸ“· ",h.attribution]}),h.source&&e.jsxs("div",{className:"mt-0.5 text-[9px] text-gray-400",children:["Source: ",h.source]})]})]},k))})]}),e.jsx(fn,{src:p,onClose:()=>r(null)})]})}function ul({pageNumber:t,scene:a,onSceneChange:n,onClose:p,onRegenerate:r,isRegenerating:f,imageRegenerationCost:x,characters:o=[],selectedCharacterIds:C=[],onCharacterSelectionChange:$,consistencyRegen:b}){const{language:v}=gt(),[B,h]=d.useState(!1),[k,L]=d.useState(!1),R=E=>{$&&(C.includes(E)?$(C.filter(se=>se!==E)):$([...C,E]))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(wt,{size:20}),v==="de"?`Szene bearbeiten - Seite ${t}`:v==="fr"?`Modifier la scÃ¨ne - Page ${t}`:`Edit Scene - Page ${t}`]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:v==="de"?"Bearbeiten Sie die Szenenbeschreibung und wÃ¤hlen Sie die Charaktere aus.":v==="fr"?"Modifiez la description de la scÃ¨ne et sÃ©lectionnez les personnages.":"Edit the scene description and select the characters."})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[o.length>0&&$&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ir,{size:16}),v==="de"?"Charaktere in dieser Szene:":v==="fr"?"Personnages dans cette scÃ¨ne:":"Characters in this scene:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.map(E=>{const se=C.includes(E.id);return e.jsxs("button",{type:"button",onClick:()=>R(E.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${se?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[E.photoUrl&&e.jsx("img",{src:E.photoUrl,alt:E.name,className:"w-8 h-8 rounded-full object-cover"}),e.jsx("span",{className:"font-medium",children:E.name}),se&&e.jsx("span",{className:"text-indigo-500",children:"âœ“"})]},E.id)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:v==="de"?"WÃ¤hlen Sie die Charaktere aus, die im Bild erscheinen sollen.":v==="fr"?"SÃ©lectionnez les personnages qui doivent apparaÃ®tre dans l'image.":"Select the characters that should appear in the image."})]}),b&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(vn,{className:"text-amber-600",size:20}),e.jsx("h4",{className:"font-semibold text-amber-800",children:v==="de"?"Konsistenz-Korrektur angewendet":v==="fr"?"Correction de cohÃ©rence appliquÃ©e":"Consistency Fix Applied"}),e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded",children:["Score: ",b.score,"%"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-amber-700 mb-2",children:v==="de"?"Behobene Probleme:":v==="fr"?"ProblÃ¨mes corrigÃ©s:":"Issues Fixed:"}),e.jsx("ul",{className:"text-sm text-amber-900 space-y-1",children:b.issues.map((E,se)=>e.jsxs("li",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[E.type.toUpperCase(),E.characterInvolved&&` (${E.characterInvolved})`,":"]}),e.jsx("span",{className:"text-amber-700 ml-2",children:E.description}),e.jsxs("span",{className:"text-amber-600 ml-2 text-xs",children:["â†’ ",E.recommendation]})]},se))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1 text-center",children:"Original"}),e.jsx("img",{src:b.originalImage,alt:"Original",className:"w-full rounded-lg border border-gray-300",draggable:!1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-600 mb-1 text-center",children:v==="de"?"Korrigiert":v==="fr"?"CorrigÃ©":"Fixed"}),e.jsx("img",{src:b.fixedImage,alt:"Fixed",className:"w-full rounded-lg border-2 border-green-500",draggable:!1})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>h(!B),className:"flex items-center gap-1 text-xs text-gray-600 hover:text-gray-800",children:[B?e.jsx(Nr,{size:14}):e.jsx(Ft,{size:14}),v==="de"?"Original-Prompt":v==="fr"?"Prompt original":"Original Prompt"]}),B&&e.jsx("pre",{className:"text-xs bg-gray-100 p-2 rounded overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:b.originalPrompt}),e.jsxs("button",{onClick:()=>L(!k),className:"flex items-center gap-1 text-xs text-green-600 hover:text-green-800",children:[k?e.jsx(Nr,{size:14}):e.jsx(Ft,{size:14}),v==="de"?"Korrigierter Prompt (mit Korrekturen)":v==="fr"?"Prompt corrigÃ© (avec corrections)":"Fixed Prompt (with corrections)"]}),k&&e.jsx("pre",{className:"text-xs bg-green-50 p-2 rounded border border-green-200 overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:b.fixedPrompt})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xs text-gray-400",children:v==="de"?`Korrigiert am ${new Date(b.timestamp).toLocaleString()}`:v==="fr"?`CorrigÃ© le ${new Date(b.timestamp).toLocaleString()}`:`Fixed at ${new Date(b.timestamp).toLocaleString()}`}),b.clothing&&e.jsxs("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded",children:["ðŸŽ¨ ",b.clothing]})]}),b.avatarsUsed&&b.avatarsUsed.length>0&&e.jsxs("div",{className:"mt-3 p-2 bg-blue-50 rounded border border-blue-200",children:[e.jsx("p",{className:"text-xs font-medium text-blue-700 mb-1",children:v==="de"?"Verwendete Avatare:":v==="fr"?"Avatars utilisÃ©s:":"Avatars used:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.avatarsUsed.map((E,se)=>e.jsxs("span",{className:`text-xs px-2 py-1 rounded ${E.hasPhoto?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:[E.name,E.category&&E.category!=="standard"&&e.jsxs("span",{className:"ml-1 opacity-75",children:["(",E.category,")"]}),!E.hasPhoto&&" âš ï¸"]},se))})]}),b.retryHistory&&b.retryHistory.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(Or,{retryHistory:b.retryHistory,totalAttempts:b.totalAttempts||1,language:v})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:v==="de"?"Szenenbeschreibung:":v==="fr"?"Description de la scÃ¨ne:":"Scene description:"}),e.jsx("textarea",{value:a,onChange:E=>n(E.target.value),className:"w-full h-40 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y",placeholder:v==="de"?"Beschreiben Sie die Szene...":v==="fr"?"DÃ©crivez la scÃ¨ne...":"Describe the scene..."}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:v==="de"?"Tipp: Beschreiben Sie die Aktionen und die Umgebung. Die ausgewÃ¤hlten Charaktere werden automatisch hinzugefÃ¼gt.":v==="fr"?"Conseil: DÃ©crivez les actions et l'environnement. Les personnages sÃ©lectionnÃ©s seront ajoutÃ©s automatiquement.":"Tip: Describe the actions and the environment. Selected characters will be added automatically."})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:C.length>0&&e.jsx("span",{children:v==="de"?`${C.length} Charakter(e) ausgewÃ¤hlt`:v==="fr"?`${C.length} personnage(s) sÃ©lectionnÃ©(s)`:`${C.length} character(s) selected`})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:p,disabled:f,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700 font-medium disabled:opacity-50 order-2 sm:order-1",children:v==="de"?"Abbrechen":v==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:r,disabled:f||!a.trim(),className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 order-1 sm:order-2 ${f||!a.trim()?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:f?e.jsxs(e.Fragment,{children:[e.jsx(ps,{size:16,className:"animate-spin"}),v==="de"?"Generiere...":v==="fr"?"GÃ©nÃ©ration...":"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{size:16}),v==="de"?"Neu generieren":v==="fr"?"RÃ©gÃ©nÃ©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",x,")"]})]})})]})]})]})})}function gl({pageNumber:t,versions:a,onClose:n,onSelectVersion:p,developerMode:r=!1}){const{language:f}=gt();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ga,{size:20}),f==="de"?`Bildversionen - Seite ${t}`:f==="fr"?`Versions d'image - Page ${t}`:`Image Versions - Page ${t}`]}),e.jsx("button",{onClick:n,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(ns,{size:20})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:a.map((x,o)=>e.jsxs("div",{className:`relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${x.isActive?"border-green-500 ring-2 ring-green-200":"border-gray-200 hover:border-indigo-300"}`,onClick:()=>p(t,o),children:[e.jsx("img",{src:x.imageData,alt:`Version ${o+1}`,className:"w-full aspect-square object-cover"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:o===0?"Original":`V${o+1}`}),x.isActive&&e.jsx("span",{className:"bg-green-500 px-2 py-0.5 rounded text-[10px] font-bold",children:f==="de"?"Aktiv":f==="fr"?"Actif":"Active"})]}),e.jsx("div",{className:"text-[10px] text-gray-300 mt-1",children:new Date(x.createdAt).toLocaleDateString()})]})]},o))}),r&&a.length>1&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-700",children:f==="de"?"Szenen- und Prompt-Vergleich":f==="fr"?"Comparaison de scÃ¨nes et prompts":"Scene & Prompt Comparison"}),a.map((x,o)=>e.jsxs("details",{className:`rounded-lg p-3 ${x.isActive?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-medium text-gray-700",children:[o===0?"Original":`V${o+1}`,x.isActive&&e.jsx("span",{className:"ml-2 text-green-600 text-xs",children:"(Active)"})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[x.userInput&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-purple-700",children:f==="de"?"Benutzer-Eingabe:":f==="fr"?"EntrÃ©e utilisateur:":"User Input:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-purple-50 p-2 rounded border border-purple-200 max-h-24 overflow-y-auto",children:x.userInput})]}),x.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-amber-700",children:f==="de"?"Erweiterte Szene:":f==="fr"?"ScÃ¨ne Ã©tendue:":"Expanded Scene:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-24 overflow-y-auto",children:x.description})]}),x.prompt&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-blue-700",children:f==="de"?"API-Prompt:":f==="fr"?"Prompt API:":"API Prompt:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-32 overflow-y-auto",children:x.prompt})]}),x.modelId&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Model: ",x.modelId]})]})]},o))]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 text-sm text-gray-500",children:f==="de"?"Klicken Sie auf ein Bild, um es auszuwÃ¤hlen":f==="fr"?"Cliquez sur une image pour la sÃ©lectionner":"Click an image to select it"})]})})}function hl({src:t,title:a,onClose:n}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:n,children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] bg-white rounded-lg overflow-hidden",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:a}),e.jsx("button",{onClick:n,className:"text-gray-500 hover:text-gray-700 p-1",children:e.jsx(ns,{size:20})})]}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsx("img",{src:t,alt:a,className:"max-w-full max-h-[80vh] object-contain mx-auto"})})]})})}const Gn={en:{adventure:"Adventure","life-challenge":"Life Challenge",educational:"Educational",historical:"Historical"},de:{adventure:"Abenteuer","life-challenge":"Lebensherausforderung",educational:"Bildung",historical:"Historisch"},fr:{adventure:"Aventure","life-challenge":"DÃ©fi de vie",educational:"Ã‰ducatif",historical:"Historique"}},Hn={en:{"1st-grade":"Picture Book (1st Grade)",standard:"Standard",advanced:"Advanced"},de:{"1st-grade":"Bilderbuch (1. Klasse)",standard:"Standard",advanced:"Fortgeschritten"},fr:{"1st-grade":"Livre illustrÃ© (1Ã¨re annÃ©e)",standard:"Standard",advanced:"AvancÃ©"}},xl={"de-CH":"Schweizerdeutsch","de-DE":"Deutsch (Deutschland)",en:"English",fr:"FranÃ§ais"};function pl({settings:t,language:a}){var h,k;const[n,p]=d.useState(!1),r=L=>{const R={en:{title:"Story Info",category:"Category",topic:"Topic",theme:"Theme",storyType:"Story Type",storyDetails:"Story Idea",artStyle:"Art Style",language:"Language",readingLevel:"Reading Level",pages:"Length",dedication:"Dedication",mainCharacters:"Main Characters",otherCharacters:"Other Characters",relationships:"Relationships",season:"Season",location:"Location",noData:"Not specified",spring:"Spring",summer:"Summer",autumn:"Autumn",winter:"Winter"},de:{title:"Story-Info",category:"Kategorie",topic:"Thema",theme:"Thema",storyType:"Story-Typ",storyDetails:"Story-Idee",artStyle:"Kunststil",language:"Sprache",readingLevel:"Lesestufe",pages:"LÃ¤nge",dedication:"Widmung",mainCharacters:"Hauptfiguren",otherCharacters:"Andere Figuren",relationships:"Beziehungen",season:"Jahreszeit",location:"Ort",noData:"Nicht angegeben",spring:"FrÃ¼hling",summer:"Sommer",autumn:"Herbst",winter:"Winter"},fr:{title:"Info histoire",category:"CatÃ©gorie",topic:"Sujet",theme:"ThÃ¨me",storyType:"Type d'histoire",storyDetails:"IdÃ©e d'histoire",artStyle:"Style artistique",language:"Langue",readingLevel:"Niveau de lecture",pages:"Longueur",dedication:"DÃ©dicace",mainCharacters:"Personnages principaux",otherCharacters:"Autres personnages",relationships:"Relations",season:"Saison",location:"Lieu",noData:"Non spÃ©cifiÃ©",spring:"Printemps",summer:"Ã‰tÃ©",autumn:"Automne",winter:"Hiver"}};return(R[a]||R.en)[L]||L},f=L=>(Gn[a]||Gn.en)[L]||L,x=L=>(Hn[a]||Hn.en)[L]||L,o=(L,R)=>L==null||L===""?e.jsx("span",{className:"text-gray-400 italic",children:r("noData")}):e.jsx("span",{className:"text-gray-800",children:L}),C=t.mainCharacters||[],$=((h=t.characters)==null?void 0:h.filter(L=>C.includes(L.id)))||[],b=((k=t.characters)==null?void 0:k.filter(L=>!C.includes(L.id)))||[],v=L=>r(L)||L,B=()=>{if(!t.userLocation)return null;const L=[t.userLocation.city,t.userLocation.region,t.userLocation.country].filter(Boolean);return L.length>0?L.join(", "):null};return e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>p(!n),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-amber-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ei,{size:16,className:"text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-800",children:r("title")}),e.jsx("span",{className:"text-xs bg-amber-200 text-amber-700 px-2 py-0.5 rounded",children:"DEV"})]}),n?e.jsx(Ft,{size:18,className:"text-amber-600"}):e.jsx(tn,{size:18,className:"text-amber-600"})]}),n&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[$.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(dn,{size:12}),r("mainCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:$.map(L=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-indigo-100 text-indigo-800 border border-indigo-200",children:[e.jsx(dn,{size:10}),e.jsx("span",{children:L.name})]},L.id))})]}),b.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(ir,{size:12}),r("otherCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(L=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700 border border-gray-200",children:[e.jsx(dn,{size:10}),e.jsx("span",{children:L.name})]},L.id))})]}),t.relationships&&Object.keys(t.relationships).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-2",children:r("relationships")}),e.jsx("div",{className:"text-xs bg-white/50 p-2 rounded border border-amber-100 space-y-1",children:Object.entries(t.relationships).map(([L,R])=>{var z,J;const[E,se]=L.split("-").map(_=>parseInt(_,10)),q=(z=t.characters)==null?void 0:z.find(_=>_.id===E),u=(J=t.characters)==null?void 0:J.find(_=>_.id===se);return!q||!u?null:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-amber-600 font-medium whitespace-nowrap",children:[q.name," â†’ ",u.name,":"]}),e.jsx("span",{className:"text-gray-700",children:R})]},L)})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(Zi,{size:12}),r("language")]}),e.jsx("div",{className:"text-sm",children:t.language?xl[t.language]||t.language:o(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:r("readingLevel")}),e.jsx("div",{className:"text-sm",children:t.languageLevel?x(t.languageLevel):o(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:r("pages")}),e.jsx("div",{className:"text-sm",children:t.pages?`${t.pages} ${a==="de"?"Seiten":"pages"}`:o(void 0)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:r("season")}),e.jsx("div",{className:"text-sm",children:t.season?v(t.season):o(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:r("location")}),e.jsx("div",{className:"text-sm",children:B()||o(void 0)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(jn,{size:12}),r("artStyle")]}),e.jsx("div",{className:"text-sm capitalize",children:o(t.artStyle)})]})]}),t.storyDetails&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(Gr,{size:12}),r("storyDetails")]}),e.jsx("div",{className:"text-sm bg-white/50 p-2 rounded border border-amber-100 whitespace-pre-wrap",children:t.storyDetails})]}),(t.storyCategory||t.storyTheme||t.storyTopic)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-amber-100",children:[t.storyCategory&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(qi,{size:12}),r("category")]}),e.jsx("div",{className:"text-sm",children:f(t.storyCategory)})]}),(t.storyTheme||t.storyTopic)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:t.storyCategory==="adventure"?r("theme"):r("topic")}),e.jsx("div",{className:"text-sm",children:t.storyCategory==="adventure"?t.storyTheme:t.storyTopic})]})]})]})]})}function fl({storyId:t,onShareStatusChange:a}){const{language:n}=gt(),[p,r]=d.useState(!1),[f,x]=d.useState(null),[o,C]=d.useState(!1),[$,b]=d.useState(!1),[v,B]=d.useState(null),h={share:n==="de"?"Teilen":n==="fr"?"Partager":"Share",shareStory:n==="de"?"Geschichte teilen":n==="fr"?"Partager l'histoire":"Share Story",enableSharing:n==="de"?"Link aktivieren":n==="fr"?"Activer le lien":"Enable sharing",disableSharing:n==="de"?"Link deaktivieren":n==="fr"?"DÃ©sactiver le lien":"Disable sharing",copyLink:n==="de"?"Link kopieren":n==="fr"?"Copier le lien":"Copy link",copied:n==="de"?"Kopiert!":n==="fr"?"CopiÃ©!":"Copied!",shareWhatsApp:n==="de"?"Per WhatsApp teilen":n==="fr"?"Partager sur WhatsApp":"Share on WhatsApp",sharingEnabled:n==="de"?"Teilen aktiv":n==="fr"?"Partage actif":"Sharing enabled",sharingDisabled:n==="de"?"Teilen inaktiv":n==="fr"?"Partage inactif":"Sharing disabled",anyoneWithLink:n==="de"?"Jeder mit dem Link kann die Geschichte lesen":n==="fr"?"Toute personne avec le lien peut lire l'histoire":"Anyone with the link can read the story",errorLoading:n==="de"?"Fehler beim Laden":n==="fr"?"Erreur de chargement":"Error loading"};d.useEffect(()=>{p&&!f&&k()},[p]);const k=async()=>{C(!0),B(null);try{const se=await fetch(`/api/stories/${t}/share-status`,{credentials:"include"});if(!se.ok)throw new Error("Failed to fetch status");const q=await se.json();x(q)}catch{B(h.errorLoading)}finally{C(!1)}},L=async()=>{C(!0),B(null);try{const q=(f==null?void 0:f.isShared)?"DELETE":"POST",u=await fetch(`/api/stories/${t}/share`,{method:q,credentials:"include"});if(!u.ok)throw new Error("Failed to toggle sharing");const z=await u.json();x({isShared:z.isShared,shareToken:z.shareToken,shareUrl:z.shareUrl}),a==null||a(z.isShared)}catch{B("Failed to update sharing")}finally{C(!1)}},R=async()=>{if(f!=null&&f.shareUrl)try{await navigator.clipboard.writeText(f.shareUrl),b(!0),setTimeout(()=>b(!1),2e3)}catch{const q=document.createElement("textarea");q.value=f.shareUrl,document.body.appendChild(q),q.select(),document.execCommand("copy"),document.body.removeChild(q),b(!0),setTimeout(()=>b(!1),2e3)}},E=()=>{if(!(f!=null&&f.shareUrl))return;const se=encodeURIComponent(f.shareUrl);window.open(`https://wa.me/?text=${se}`,"_blank")};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>r(!p),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-lg hover:from-blue-600 hover:to-indigo-600 transition-all shadow-md hover:shadow-lg",title:h.share,children:[e.jsx(In,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:h.share}),(f==null?void 0:f.isShared)&&e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-xl border border-gray-200 z-50 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(In,{className:"w-5 h-5 text-blue-600"}),h.shareStory]})}),e.jsx("div",{className:"p-4 space-y-4",children:o&&!f?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Lt,{className:"w-6 h-6 animate-spin text-blue-500"})}):v?e.jsx("div",{className:"text-red-500 text-sm py-2",children:v}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[f!=null&&f.isShared?e.jsx(Xi,{className:"w-5 h-5 text-green-500"}):e.jsx(Yi,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:f!=null&&f.isShared?"text-green-700":"text-gray-600",children:f!=null&&f.isShared?h.sharingEnabled:h.sharingDisabled})]}),e.jsx("button",{onClick:L,disabled:o,className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${f!=null&&f.isShared?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"} disabled:opacity-50`,children:o?e.jsx(Lt,{className:"w-4 h-4 animate-spin"}):f!=null&&f.isShared?h.disableSharing:h.enableSharing})]}),(f==null?void 0:f.isShared)&&f.shareUrl&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500",children:h.anyoneWithLink}),e.jsx("button",{onClick:R,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:$?e.jsxs(e.Fragment,{children:[e.jsx(Vr,{className:"w-4 h-4 text-green-500"}),h.copied]}):e.jsxs(e.Fragment,{children:[e.jsx(Ui,{className:"w-4 h-4"}),h.copyLink]})}),e.jsxs("button",{onClick:E,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors",children:[e.jsx(tl,{className:"w-4 h-4"}),h.shareWhatsApp]})]})]})})]})]})]})}function bl({title:t,story:a,outline:n,outlinePrompt:p,outlineModelId:r,outlineUsage:f,storyTextPrompts:x=[],visualBible:o,sceneImages:C,sceneDescriptions:$=[],coverImages:b,regeneratingCovers:v=new Set,languageLevel:B="standard",storyLanguage:h,isGenerating:k=!1,onDownloadPdf:L,onAddToBook:R,onPrintBook:E,onCreateAnother:se,onDownloadTxt:q,onRegenerateImage:u,onRegenerateCover:z,characters:J=[],onEditImage:_,onEditCover:Y,onRepairImage:I,onRevertRepair:re,onVisualBibleChange:fe,storyId:xe,developerMode:ae=!1,styledAvatarGeneration:he=[],costumedAvatarGeneration:Se=[],generationLog:ne=[],finalChecksReport:c,clothingRequirements:Te,isPartial:O=!1,failureReason:pe,generatedPages:Be,totalPages:me,progressiveMode:de=!1,progressiveData:K,completedPageImages:Fe={},originalStory:T,onSaveStoryText:X,onSaveTitleChange:Ae,userCredits:be=0,imageRegenerationCost:He=5,isImpersonating:Rt=!1,onSelectImageVersion:Ut,generationSettings:Gt}){var Zs,ft,Fs,es,zs;const{t:Os,language:i}=gt(),Z=h?h.startsWith("de")?"de":h:i,Pe=Rt||be===-1||be>=He,[ye,Ye]=d.useState(null),[Ve,$e]=d.useState(""),[rt,Ie]=d.useState(!1),[Pt,Ke]=d.useState(a),[is,Jt]=d.useState(!1),[Ds,xt]=d.useState(!1),[Dt,Ce]=d.useState(t||""),[Oe,lr]=d.useState(!1),[mt,A]=d.useState(null),[De,ls]=d.useState(null),[,_s]=d.useState(!1),[zt,fs]=d.useState(new Set),[St,dt]=d.useState(null),[Zt,os]=d.useState(null),[$s,tt]=d.useState(null),[ds,bs]=d.useState("square"),[cs,Qt]=d.useState(!1);d.useEffect(()=>{rt||Ke(a)},[a,rt]),d.useEffect(()=>{Ds||Ce(t||"")},[t,Ds]);const wr=async()=>{if(X){Jt(!0);try{await X(Pt),Ie(!1)}catch(s){console.error("Failed to save story text:",s)}finally{Jt(!1)}}},qs=async()=>{if(!(!Ae||!Dt.trim())){lr(!0);try{await Ae(Dt.trim()),xt(!1)}catch(s){console.error("Failed to save title:",s)}finally{lr(!1)}}},Sr=()=>{Ke(a),Ie(!1)},Vs=async s=>{if(!(!I||Zt!==null)){os(s);try{await I(s)}catch(P){console.error("Failed to repair image:",P)}finally{os(null)}}},or=(s,P)=>{const N=Pt.split(/(?=---\s*(?:Page|Seite)\s+\d+\s*---|(?=##\s*(?:Page|Seite)\s+\d+))/i);let Q=0;for(let ue=0;ue<N.length;ue++)if(/^(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i.test(N[ue].trim())){Q=ue;break}const g=Q+s;if(g<N.length){const ue=N[g].match(/^(---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i),Ee=ue?ue[0]:"";N[g]=Ee+`
`+P.trim()+`
`}Ke(N.join(""))},ms=s=>{const P=C.find(N=>N.pageNumber===s);return(P==null?void 0:P.imageVersions)||[]},Ws=async(s,P)=>{if(Ut)try{await Ut(s,P),A(null)}catch(N){console.error("Failed to select image version:",N)}},dr=s=>{if(!s)return"";let P;if(typeof s!="string"){const ue=s;if(ue.output)if(typeof ue.output=="string")P=ue.output;else if(typeof ue.output=="object"){const Ee=ue.output.translatedSummary||ue.output.imageSummary||"";if(Ee)return Ee;P=JSON.stringify(s)}else P=JSON.stringify(s);else P=JSON.stringify(s)}else P=s;if(P.trim().startsWith("{"))try{const ue=JSON.parse(P);if(ue.output){if(typeof ue.output=="string")P=ue.output;else if(typeof ue.output=="object"){const Ee=ue.output.translatedSummary||ue.output.imageSummary;if(Ee)return Ee}}}catch{}const N=P.match(/(?:#{1,3}\s*)?(?:\*\*)?6\.?\s*(?:\*\*)?\s*\*?\*?(Image Summary|Bildzusammenfassung|RÃ©sumÃ© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*\*?\*?\s*:?\s*\n?([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n---|\n```|$)/i);if(N&&N[2]&&N[2].trim())return N[2].trim();const Q=P.match(/(?:#{1,3}\s*)?\*?\*?(Image Summary|Bildzusammenfassung|RÃ©sumÃ© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*:?\s*\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n\*\*|\n#{1,3}\s|$)/i);if(Q&&Q[2]&&Q[2].trim())return Q[2].trim();if(!P.includes("**")&&P.length<1e3)return P.trim();const g=P.match(/\*?\*?(Image Summary|Bildzusammenfassung|RÃ©sumÃ© de l['']Image)\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:\*\*)?\d+\.\s*\*\*|\n\s*\*\*\d+\.|$)/i);return g&&g[2]&&g[2].trim()?g[2].trim():P.substring(0,500).trim()+"..."},Ks=s=>{if(!s||!J.length)return J.map(Q=>Q.id);let P;if(typeof s!="string"){const Q=s;P=Q.output&&typeof Q.output=="string"?Q.output:JSON.stringify(s)}else P=s;if(P.trim().startsWith("{"))try{const Q=JSON.parse(P);Q.output&&typeof Q.output=="string"&&(P=Q.output)}catch{}const N=P.toLowerCase();return J.filter(Q=>N.includes(Q.name.toLowerCase())).map(Q=>Q.id)},ys=s=>{const P=C.find(Ee=>Ee.pageNumber===s),N=$.find(Ee=>Ee.pageNumber===s),Q=(P==null?void 0:P.description)||(N==null?void 0:N.description)||"",g=(N==null?void 0:N.translatedSummary)||(N==null?void 0:N.imageSummary)||dr(Q),ue=Ks(Q);ls({pageNumber:s,scene:g,selectedCharacterIds:ue})},Us=async()=>{if(!De||!u)return;const s=De.pageNumber,P=De.scene,N=De.selectedCharacterIds;ls(null),fs(Q=>new Set(Q).add(s)),_s(!0);try{await u(s,P,N)}catch(Q){console.error("Failed to regenerate image:",Q)}finally{fs(Q=>{const g=new Set(Q);return g.delete(s),g}),fs(Q=>(Q.size===0&&_s(!1),Q))}},vs=s=>{let P="";if(s==="front"&&(b!=null&&b.frontCover)){const N=b.frontCover;P=typeof N=="object"&&N.description||""}else if(s==="initial"&&(b!=null&&b.initialPage)){const N=b.initialPage;P=typeof N=="object"&&N.description||""}else if(s==="back"&&(b!=null&&b.backCover)){const N=b.backCover;P=typeof N=="object"&&N.description||""}dt({coverType:s,scene:P})},Js=async()=>{if(!St||!z)return;const{coverType:s,scene:P}=St;dt(null);try{await z(s,P)}catch(N){console.error("Failed to regenerate cover:",N)}},ct=(s,P,N,Q)=>{Ye({type:s,id:P,field:N}),$e(Q||"")},Yt=()=>{if(!ye||!o||!fe)return;const{type:s,id:P,field:N}=ye,Q={...o};if(s==="secondaryCharacter")Q.secondaryCharacters=(Q.secondaryCharacters||[]).map(g=>g.id===P?{...g,[N]:Ve}:g);else if(s==="animal")Q.animals=(Q.animals||[]).map(g=>g.id===P?{...g,[N]:Ve}:g);else if(s==="artifact")Q.artifacts=(Q.artifacts||[]).map(g=>g.id===P?{...g,[N]:Ve}:g);else if(s==="location")Q.locations=(Q.locations||[]).map(g=>g.id===P?{...g,[N]:Ve}:g);else if(s==="mainCharacter"){const g=parseInt(P);Q.mainCharacters=(Q.mainCharacters||[]).map(ue=>ue.id!==g?ue:N==="physical.face"?{...ue,physical:{...ue.physical,face:Ve}}:N==="physical.hair"?{...ue,physical:{...ue.physical,hair:Ve}}:N==="physical.build"?{...ue,physical:{...ue.physical,build:Ve}}:ue)}fe(Q),Ye(null),$e("")},bt=()=>{Ye(null),$e("")},Ht=(s=>s?s.split(/(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i).slice(1).filter(N=>N.trim().length>0):[])(rt?Pt:a),Ot=C.length>0,Ts=B==="1st-grade",ws=(()=>{if(!de)return Ht.length;if(Ht.length===0)return 0;let s=1;for(let P=2;P<=Ht.length;P++){const N=P-1;if(C.some(g=>g.pageNumber===N&&g.imageData)||!!Fe[N])s=P;else break}return s})(),mr=(K==null?void 0:K.totalPages)||Ht.length,pt=(K==null?void 0:K.totalScenes)||C.length||Math.ceil(mr/(Ts?1:2)),yt=s=>s?typeof s=="string"?s:s.imageData||null:null,ot=s=>s?typeof s=="string"?{imageData:s}:s:null,_t=s=>{var Q;const P=(Q=$.find(g=>g.pageNumber===s))==null?void 0:Q.description;if(P)return P;const N=C.find(g=>g.pageNumber===s);return N==null?void 0:N.description},vt=s=>{var P;return(P=$.find(N=>N.pageNumber===s))==null?void 0:P.outlineExtract},Xt=s=>{var P;return(P=$.find(N=>N.pageNumber===s))==null?void 0:P.scenePrompt},jt=s=>{var P;return(P=$.find(N=>N.pageNumber===s))==null?void 0:P.textModelId};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center gap-2",children:Ds?e.jsxs("div",{className:"flex items-center gap-2 w-full max-w-2xl",children:[e.jsx("input",{type:"text",value:Dt,onChange:s=>Ce(s.target.value),className:"flex-1 text-2xl md:text-3xl font-bold text-gray-800 text-center border-2 border-indigo-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-500",autoFocus:!0,onKeyDown:s=>{s.key==="Enter"&&qs(),s.key==="Escape"&&(Ce(t||""),xt(!1))}}),e.jsx("button",{onClick:qs,disabled:Oe||!Dt.trim(),className:"p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50",title:i==="de"?"Speichern":i==="fr"?"Sauvegarder":"Save",children:Oe?e.jsx(ma,{className:"animate-spin",size:20}):e.jsx(As,{size:20})}),e.jsx("button",{onClick:()=>{Ce(t||""),xt(!1)},disabled:Oe,className:"p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",title:i==="de"?"Abbrechen":i==="fr"?"Annuler":"Cancel",children:e.jsx(ns,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-800 text-center",children:t||Os.yourStory}),Ae&&!k&&e.jsx("button",{onClick:()=>xt(!0),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:i==="de"?"Titel bearbeiten":i==="fr"?"Modifier le titre":"Edit title",children:e.jsx(wt,{size:18})})]})}),O&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-400 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-amber-500 text-2xl",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-amber-800",children:i==="de"?"UnvollstÃ¤ndige Geschichte":i==="fr"?"Histoire incomplÃ¨te":"Incomplete Story"}),e.jsx("p",{className:"text-amber-700 text-sm mt-1",children:i==="de"?`Diese Geschichte konnte nicht vollstÃ¤ndig generiert werden. ${Be||C.length} von ${me||"unbekannt"} Seiten wurden erstellt.`:i==="fr"?`Cette histoire n'a pas pu Ãªtre gÃ©nÃ©rÃ©e complÃ¨tement. ${Be||C.length} sur ${me||"inconnu"} pages ont Ã©tÃ© crÃ©Ã©es.`:`This story could not be fully generated. ${Be||C.length} of ${me||"unknown"} pages were created.`}),pe&&ae&&e.jsxs("details",{className:"mt-2 text-sm",children:[e.jsx("summary",{className:"cursor-pointer text-amber-600 hover:text-amber-700",children:i==="de"?"Fehlerdetails":i==="fr"?"DÃ©tails de l'erreur":"Error details"}),e.jsx("p",{className:"mt-1 bg-amber-100 p-2 rounded text-amber-800 font-mono text-xs",children:pe})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[Ot&&xe&&R&&e.jsxs("button",{onClick:R,disabled:k,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Fn,{size:16})," ",i==="de"?"Buch erstellen":i==="fr"?"CrÃ©er le livre":"Create Book"]}),Ot&&L&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>Qt(!cs),disabled:k,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Gr,{size:16}),i==="de"?"PDF herunterladen":i==="fr"?"TÃ©lÃ©charger PDF":"Download PDF",e.jsx(Ft,{size:14,className:`transition-transform ${cs?"rotate-180":""}`})]}),cs&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:ds==="square",onChange:()=>bs("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20Ã—20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:ds==="A4",onChange:()=>bs("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21Ã—28cm)"})]})]}),e.jsx("button",{onClick:()=>{L(ds),Qt(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:i==="de"?"Herunterladen":i==="fr"?"TÃ©lÃ©charger":"Download"})]})]}),X&&!rt&&e.jsxs("button",{onClick:()=>Ie(!0),disabled:k,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(wt,{size:16})," ",i==="de"?"Text bearbeiten":i==="fr"?"Modifier le texte":"Edit Text"]}),se&&e.jsxs("button",{onClick:se,disabled:k,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xa,{size:16})," ",i==="de"?"Neue Geschichte":i==="fr"?"Nouvelle histoire":"New Story"]}),Ot&&xe&&!k&&e.jsx(fl,{storyId:xe})]}),ae&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[q&&e.jsxs("button",{onClick:q,className:"bg-gray-500 text-white px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 hover:bg-gray-600",children:[e.jsx(en,{size:14})," TXT"]}),Ot&&xe&&E&&e.jsxs("button",{onClick:E,disabled:k,className:`bg-yellow-500 text-black px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 ${k?"opacity-50 cursor-not-allowed":"hover:bg-yellow-600"}`,children:[e.jsx(Qa,{size:14})," Print (DEV)"]})]}),ae&&Gt&&e.jsx("div",{className:"mt-4",children:e.jsx(pl,{settings:Gt,language:i})}),ae&&e.jsxs("div",{className:"space-y-4 mt-6",children:[n&&e.jsxs("details",{className:"bg-purple-50 border-2 border-purple-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-purple-800 hover:text-purple-900 flex items-center gap-2",children:[e.jsx(Gr,{size:20}),Ts?i==="de"?"VollstÃ¤ndige API-Ausgabe (Kombiniert)":i==="fr"?"Sortie API complÃ¨te (CombinÃ©e)":"Full API Output (Combined)":i==="de"?"VollstÃ¤ndige API-Ausgabe (Outline)":i==="fr"?"Sortie API complÃ¨te (Plan)":"Full API Output (Outline)",r&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-purple-600",children:["(",r,")"]}),f&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-purple-500",children:["[",f.input_tokens.toLocaleString()," in / ",f.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[p&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:i==="de"?"ðŸ“¤ Prompt (Eingabe)":i==="fr"?"ðŸ“¤ Prompt (EntrÃ©e)":"ðŸ“¤ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:p})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:Ts?i==="de"?"ðŸ“¥ API-Antwort (Kombiniert)":i==="fr"?"ðŸ“¥ RÃ©ponse API (CombinÃ©e)":"ðŸ“¥ API Response (Combined)":i==="de"?"ðŸ“¥ API-Antwort (Outline)":i==="fr"?"ðŸ“¥ RÃ©ponse API (Plan)":"ðŸ“¥ API Response (Outline)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:n})]})]})]}),a&&x.length>0&&e.jsxs("details",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(Qa,{size:20}),i==="de"?"VollstÃ¤ndige API-Ausgabe (Story-Text)":i==="fr"?"Sortie API complÃ¨te (Texte)":"Full API Output (Story Text)",((Zs=x[0])==null?void 0:Zs.modelId)&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-amber-600",children:["(",x[0].modelId,")"]}),((ft=x[0])==null?void 0:ft.usage)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-500",children:["[",x[0].usage.input_tokens.toLocaleString()," in / ",x[0].usage.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:i==="de"?"ðŸ“¤ Prompt (Eingabe)":i==="fr"?"ðŸ“¤ Prompt (EntrÃ©e)":"ðŸ“¤ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((Fs=x[0])==null?void 0:Fs.prompt)||"No prompt available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:i==="de"?"ðŸ“¥ Rohe API-Antwort (ungefiltert)":i==="fr"?"ðŸ“¥ RÃ©ponse API brute (non filtrÃ©e)":"ðŸ“¥ Raw API Response (unfiltered)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((es=x[0])==null?void 0:es.rawResponse)||a})]})]})]}),o&&e.jsxs("details",{className:"bg-rose-50 border-2 border-rose-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-rose-800 hover:text-rose-900 flex items-center gap-2",children:[e.jsx(Qa,{size:20}),i==="de"?"Visual Bible (Wiederkehrende Elemente)":i==="fr"?"Bible Visuelle (Ã‰lÃ©ments RÃ©currents)":"Visual Bible (Recurring Elements)",o.changeLog&&o.changeLog.length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-rose-200 text-rose-800 rounded-full text-xs font-medium",children:[o.changeLog.length," ",i==="de"?"Ã„nderungen":i==="fr"?"changements":"changes"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[o.mainCharacters&&o.mainCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-purple-300 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-purple-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ‘—"}),i==="de"?"Hauptcharaktere (Style Profile)":i==="fr"?"Personnages Principaux (Profil Style)":"Main Characters (Style Profile)"]}),e.jsx("div",{className:"space-y-3",children:o.mainCharacters.map(s=>{var P,N,Q,g;return e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-sm",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-800 hover:text-purple-900",children:[s.name,Object.keys(s.generatedOutfits||{}).length>0&&e.jsxs("span",{className:"ml-2 px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:[Object.keys(s.generatedOutfits).length," ",i==="de"?"Outfits":i==="fr"?"tenues":"outfits"]})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Physical:"}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[((P=s.physical)==null?void 0:P.skinTone)||"N/A"," | ",((N=s.physical)==null?void 0:N.hair)||"N/A"," | ",((Q=s.physical)==null?void 0:Q.build)||"N/A",((g=s.physical)==null?void 0:g.other)&&` | ${s.physical.other}`]})]}),s.generatedOutfits&&Object.keys(s.generatedOutfits).length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-200",children:[e.jsx("span",{className:"font-medium text-gray-600 text-xs",children:"Generated Outfits:"}),e.jsx("div",{className:"mt-1 space-y-1",children:Object.entries(s.generatedOutfits).map(([ue,Ee])=>{var ut;return e.jsxs("div",{className:"bg-white p-1.5 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-purple-600",children:["Page ",ue,":"]}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[(ut=Ee.outfit)==null?void 0:ut.substring(0,80),"..."]}),e.jsx("span",{className:`ml-1 px-1 py-0.5 rounded text-[10px] ${Ee.setting==="outdoor-cold"?"bg-blue-100 text-blue-700":Ee.setting==="outdoor-warm"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:Ee.setting})]},ue)})})]})]})]},s.id)})})]}),o.secondaryCharacters&&o.secondaryCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:i==="de"?"Nebencharaktere":i==="fr"?"Personnages Secondaires":"Secondary Characters"}),e.jsx("div",{className:"space-y-2",children:o.secondaryCharacters.map(s=>{var P;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),((P=s.appearsInPages)==null?void 0:P.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(ye==null?void 0:ye.type)==="secondaryCharacter"&&(ye==null?void 0:ye.id)===s.id&&(ye==null?void 0:ye.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:Ve,onChange:N=>$e(N.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Yt,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(As,{size:12})," Save"]}),e.jsxs("button",{onClick:bt,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(ns,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),ae&&fe&&e.jsx("button",{onClick:()=>ct("secondaryCharacter",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(wt,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id)})})]}),o.animals.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:i==="de"?"Tiere & Wesen":i==="fr"?"Animaux & CrÃ©atures":"Animals & Creatures"}),e.jsx("div",{className:"space-y-2",children:o.animals.map(s=>{var P;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),((P=s.appearsInPages)==null?void 0:P.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(ye==null?void 0:ye.type)==="animal"&&(ye==null?void 0:ye.id)===s.id&&(ye==null?void 0:ye.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:Ve,onChange:N=>$e(N.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Yt,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(As,{size:12})," Save"]}),e.jsxs("button",{onClick:bt,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(ns,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),ae&&fe&&e.jsx("button",{onClick:()=>ct("animal",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(wt,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id)})})]}),o.artifacts.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:i==="de"?"Artefakte & Objekte":i==="fr"?"Artefacts & Objets":"Artifacts & Objects"}),e.jsx("div",{className:"space-y-2",children:o.artifacts.map(s=>{var P;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),((P=s.appearsInPages)==null?void 0:P.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(ye==null?void 0:ye.type)==="artifact"&&(ye==null?void 0:ye.id)===s.id&&(ye==null?void 0:ye.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:Ve,onChange:N=>$e(N.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Yt,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(As,{size:12})," Save"]}),e.jsxs("button",{onClick:bt,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(ns,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),ae&&fe&&e.jsx("button",{onClick:()=>ct("artifact",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(wt,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id)})})]}),o.locations.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:i==="de"?"Wiederkehrende Orte":i==="fr"?"Lieux RÃ©currents":"Recurring Locations"}),e.jsx("div",{className:"space-y-2",children:o.locations.map(s=>{var P;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.isRealLandmark&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-amber-100 text-amber-700 font-semibold",children:"ðŸ“ LANDMARK"}),s.photoFetchStatus==="success"&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-green-100 text-green-700",children:"ðŸ“· Photo"}),((P=s.appearsInPages)==null?void 0:P.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),s.isRealLandmark&&s.landmarkQuery&&e.jsxs("div",{className:"text-amber-700 text-xs mt-1",children:["Landmark: ",e.jsx("span",{className:"font-mono bg-amber-50 px-1 rounded",children:s.landmarkQuery})]}),(ye==null?void 0:ye.type)==="location"&&(ye==null?void 0:ye.id)===s.id&&(ye==null?void 0:ye.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:Ve,onChange:N=>$e(N.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Yt,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(As,{size:12})," Save"]}),e.jsxs("button",{onClick:bt,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(ns,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),ae&&fe&&e.jsx("button",{onClick:()=>ct("location",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(wt,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]}),s.referencePhotoData&&e.jsxs("div",{className:"mt-2 border border-amber-200 rounded overflow-hidden",children:[e.jsx("img",{src:s.referencePhotoData,alt:`${s.name} reference`,className:"w-full max-h-32 object-contain bg-gray-50"}),s.photoAttribution&&e.jsxs("div",{className:"text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 truncate",children:["ðŸ“· ",s.photoAttribution]})]})]},s.id)})})]}),o.vehicles&&o.vehicles.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:i==="de"?"Fahrzeuge":i==="fr"?"VÃ©hicules":"Vehicles"}),e.jsx("div",{className:"space-y-2",children:o.vehicles.map(s=>{var P;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),((P=s.appearsInPages)==null?void 0:P.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:s.description}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id)})})]}),o.clothing&&o.clothing.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:i==="de"?"Kleidung & KostÃ¼me":i==="fr"?"VÃªtements & Costumes":"Clothing & Costumes"}),e.jsx("div",{className:"space-y-2",children:o.clothing.map(s=>{var P;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.wornBy&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:["worn by ",s.wornBy]}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),((P=s.appearsInPages)==null?void 0:P.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:s.description}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id)})})]}),o.changeLog&&o.changeLog.length>0&&e.jsxs("details",{className:"bg-white border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-bold text-amber-700 hover:text-amber-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“"}),i==="de"?"Ã„nderungsprotokoll":i==="fr"?"Journal des Modifications":"Change Log",e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-amber-100 text-amber-700 rounded text-xs",children:o.changeLog.length})]}),e.jsx("div",{className:"mt-2 space-y-1 max-h-64 overflow-y-auto",children:o.changeLog.slice().reverse().map((s,P)=>{var N;return e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs border-l-2 border-amber-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${s.type==="mainCharacter"?"bg-purple-100 text-purple-700":s.type==="secondaryCharacter"?"bg-rose-100 text-rose-700":s.type==="generatedOutfit"?"bg-green-100 text-green-700":s.type==="animal"?"bg-orange-100 text-orange-700":s.type==="artifact"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:s.type}),e.jsx("span",{className:"font-semibold text-amber-800",children:s.element}),e.jsxs("span",{className:"text-gray-500",children:[Z==="de"?"Seite":"Page"," ",s.page]})]}),e.jsxs("div",{className:"mt-1 text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:[s.change,":"]}),e.jsxs("span",{className:"ml-1 text-gray-700",children:[(N=s.after)==null?void 0:N.substring(0,100),s.after&&s.after.length>100?"...":""]})]}),s.before&&e.jsxs("div",{className:"text-gray-400 line-through text-[10px] mt-0.5",children:[i==="de"?"Vorher":i==="fr"?"Avant":"Before",": ",s.before.substring(0,50),"..."]}),e.jsx("div",{className:"text-gray-400 text-[10px] mt-0.5",children:new Date(s.timestamp).toLocaleTimeString()})]},P)})})]}),(!o.mainCharacters||o.mainCharacters.length===0)&&(!o.secondaryCharacters||o.secondaryCharacters.length===0)&&(!o.animals||o.animals.length===0)&&(!o.artifacts||o.artifacts.length===0)&&(!o.locations||o.locations.length===0)&&(!o.vehicles||o.vehicles.length===0)&&(!o.clothing||o.clothing.length===0)&&e.jsx("div",{className:"text-gray-500 text-sm italic",children:i==="de"?"Keine wiederkehrenden Elemente gefunden":i==="fr"?"Aucun Ã©lÃ©ment rÃ©current trouvÃ©":"No recurring elements found in this story"})]})]}),Te&&Object.keys(Te).length>0&&e.jsxs("details",{className:"bg-teal-50 border-2 border-teal-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-teal-800 hover:text-teal-900 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ‘”"}),i==="de"?`Kleidungsanforderungen (${Object.keys(Te).length} Charaktere)`:i==="fr"?`Exigences vestimentaires (${Object.keys(Te).length} personnages)`:`Clothing Requirements (${Object.keys(Te).length} characters)`]}),e.jsx("div",{className:"mt-4 space-y-3",children:Object.entries(Te).map(([s,P])=>{var N,Q,g,ue,Ee,ut,qt,It,Ss,ts,Ne,Nt,ur,Is,ss;return e.jsxs("div",{className:"bg-white border border-teal-200 rounded-lg p-3",children:[e.jsx("h4",{className:"font-bold text-teal-700 mb-2",children:s}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${(N=P.standard)!=null&&N.used?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(Q=P.standard)!=null&&Q.used?"âœ…":"â¬œ"," Standard"]}),((g=P.standard)==null?void 0:g.used)&&((ue=P.standard)==null?void 0:ue.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:P.standard.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(Ee=P.winter)!=null&&Ee.used?"bg-blue-50 border border-blue-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(ut=P.winter)!=null&&ut.used?"â„ï¸":"â¬œ"," Winter"]}),((qt=P.winter)==null?void 0:qt.used)&&((It=P.winter)==null?void 0:It.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:P.winter.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(Ss=P.summer)!=null&&Ss.used?"bg-yellow-50 border border-yellow-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(ts=P.summer)!=null&&ts.used?"â˜€ï¸":"â¬œ"," Summer"]}),((Ne=P.summer)==null?void 0:Ne.used)&&((Nt=P.summer)==null?void 0:Nt.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:P.summer.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(ur=P.costumed)!=null&&ur.used?"bg-purple-50 border border-purple-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(Is=P.costumed)!=null&&Is.used?"ðŸŽ­":"â¬œ"," Costumed"]}),((ss=P.costumed)==null?void 0:ss.used)&&e.jsxs("div",{className:"text-gray-600 mt-1",children:[P.costumed.costume&&e.jsxs("span",{className:"font-medium",children:[P.costumed.costume,": "]}),P.costumed.description]})]})]})]},s)})})]}),he&&he.length>0&&e.jsxs("details",{className:"bg-pink-50 border-2 border-pink-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-pink-800 hover:text-pink-900 flex items-center gap-2",children:[e.jsx(ga,{size:20}),i==="de"?`Stilisierte Avatare (${he.length})`:i==="fr"?`Avatars stylisÃ©s (${he.length})`:`Styled Avatars (${he.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:he.map((s,P)=>{var N,Q;return e.jsxs("details",{className:`border rounded-lg p-3 ${s.success?"bg-white border-pink-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.success?"bg-green-500":"bg-red-500"}`}),s.characterName," - ",s.artStyle," (",s.clothingCategory||"standard",")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(s.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Face Photo"}),(N=s.inputs.facePhoto)!=null&&N.imageData?e.jsx("img",{src:s.inputs.facePhoto.imageData,alt:"Face",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>tt({src:s.inputs.facePhoto.imageData,title:"Face Photo"}),title:`${s.inputs.facePhoto.sizeKB} KB - Click to enlarge`}):s.inputs.facePhoto?e.jsxs("span",{className:"text-blue-600 text-[10px]",children:[s.inputs.facePhoto.sizeKB," KB"]}):e.jsx("span",{className:"text-gray-400 italic text-[10px]",children:"N/A"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Original Avatar"}),(Q=s.inputs.originalAvatar)!=null&&Q.imageData?e.jsx("img",{src:s.inputs.originalAvatar.imageData,alt:"Avatar",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>tt({src:s.inputs.originalAvatar.imageData,title:"Original Avatar"}),title:`${s.inputs.originalAvatar.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-blue-600 text-[10px]",children:[s.inputs.originalAvatar.sizeKB," KB"]})]}),s.inputs.styleSample&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Style Sample"}),s.inputs.styleSample.imageData?e.jsx("img",{src:s.inputs.styleSample.imageData,alt:"Style",className:"w-16 h-16 object-cover rounded border border-purple-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>tt({src:s.inputs.styleSample.imageData,title:"Style Sample"}),title:`${s.inputs.styleSample.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-purple-600 text-[10px]",children:[s.inputs.styleSample.sizeKB," KB"]})]})]})]}),s.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",s.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-48 overflow-y-auto",children:s.prompt})]}),s.success&&s.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2 flex flex-col items-start",children:s.output.imageData?e.jsx("img",{src:s.output.imageData,alt:"Output",className:"w-24 h-24 object-cover rounded border border-green-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>tt({src:s.output.imageData,title:"Styled Avatar Output"}),title:`${s.output.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-green-600",children:[s.output.sizeKB," KB"]})})]}),!s.success&&s.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:s.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(s.timestamp).toLocaleString()]})]})]},P)})})]}),Se&&Se.length>0&&e.jsxs("details",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-orange-800 hover:text-orange-900 flex items-center gap-2",children:[e.jsx(ga,{size:20}),i==="de"?`KostÃ¼m-Avatare (${Se.length})`:i==="fr"?`Avatars costumÃ©s (${Se.length})`:`Costumed Avatars (${Se.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:Se.map((s,P)=>{var N,Q,g;return e.jsxs("details",{className:`border rounded-lg p-3 ${s.success?"bg-white border-orange-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 hover:text-orange-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.success?"bg-green-500":"bg-red-500"}`}),s.characterName," - ",s.costumeType," (",s.artStyle,")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(s.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[s.costumeDescription&&e.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-yellow-700",children:"Costume:"}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.costumeDescription})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Face Photo"}),(N=s.inputs.facePhoto)!=null&&N.imageData?e.jsx("img",{src:s.inputs.facePhoto.imageData,alt:"Face",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>tt({src:s.inputs.facePhoto.imageData,title:"Face Photo"}),title:`${s.inputs.facePhoto.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-blue-600 text-[10px]",children:[((Q=s.inputs.facePhoto)==null?void 0:Q.sizeKB)||0," KB"]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Standard Avatar"}),(g=s.inputs.standardAvatar)!=null&&g.imageData?e.jsx("img",{src:s.inputs.standardAvatar.imageData,alt:"Avatar",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>tt({src:s.inputs.standardAvatar.imageData,title:"Standard Avatar"}),title:`${s.inputs.standardAvatar.sizeKB} KB - Click to enlarge`}):e.jsx("span",{className:"text-gray-400 italic text-[10px]",children:"N/A"})]})]})]}),s.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",s.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-48 overflow-y-auto",children:s.prompt})]}),s.success&&s.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2 flex flex-col items-start",children:s.output.imageData?e.jsx("img",{src:s.output.imageData,alt:"Output",className:"w-24 h-24 object-cover rounded border border-green-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>tt({src:s.output.imageData,title:"Costumed Avatar Output"}),title:`${s.output.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-green-600",children:[s.output.sizeKB," KB"]})})]}),!s.success&&s.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:s.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(s.timestamp).toLocaleString()]})]})]},P)})})]}),ne&&ne.length>0&&e.jsxs("details",{className:"bg-slate-50 border-2 border-slate-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-slate-800 hover:text-slate-900 flex items-center gap-2",children:[e.jsx(Gr,{size:20}),i==="de"?`Generierungslog (${ne.length})`:i==="fr"?`Journal de gÃ©nÃ©ration (${ne.length})`:`Generation Log (${ne.length})`,ne.filter(s=>s.level==="warn").length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-yellow-200 text-yellow-800 text-xs rounded-full",children:[ne.filter(s=>s.level==="warn").length," warnings"]}),ne.filter(s=>s.level==="error").length>0&&e.jsxs("span",{className:"ml-1 px-2 py-0.5 bg-red-200 text-red-800 text-xs rounded-full",children:[ne.filter(s=>s.level==="error").length," errors"]})]}),e.jsx("div",{className:"mt-4 space-y-1 max-h-96 overflow-y-auto",children:ne.map((s,P)=>e.jsxs("div",{className:`text-xs p-2 rounded flex items-start gap-2 ${s.level==="error"?"bg-red-50 text-red-800":s.level==="warn"?"bg-yellow-50 text-yellow-800":s.level==="debug"?"bg-gray-50 text-gray-600":"bg-white text-slate-700"}`,children:[e.jsx("span",{className:"text-gray-400 font-mono text-[10px] whitespace-nowrap",children:new Date(s.timestamp).toLocaleTimeString()}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium whitespace-nowrap ${s.stage==="outline"?"bg-blue-100 text-blue-700":s.stage==="avatars"?"bg-purple-100 text-purple-700":s.stage==="scenes"?"bg-green-100 text-green-700":s.stage==="images"?"bg-orange-100 text-orange-700":s.stage==="covers"?"bg-pink-100 text-pink-700":"bg-gray-100 text-gray-700"}`,children:s.stage}),s.character&&e.jsxs("span",{className:"font-medium text-slate-600",children:["[",s.character,"]"]}),e.jsx("span",{className:"flex-1",children:s.message}),e.jsx("span",{className:"text-gray-400 text-[10px]",children:s.event})]},P))})]}),c&&e.jsxs("details",{className:`border-2 rounded-xl p-4 ${c.overallConsistent?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("summary",{className:`cursor-pointer text-lg font-bold flex items-center gap-2 ${c.overallConsistent?"text-green-800 hover:text-green-900":"text-amber-800 hover:text-amber-900"}`,children:[c.overallConsistent?"âœ“":"âš ï¸",i==="de"?`KonsistenzprÃ¼fung (${c.totalIssues} Probleme)`:i==="fr"?`VÃ©rification de cohÃ©rence (${c.totalIssues} problÃ¨mes)`:`Final Checks (${c.totalIssues} issues)`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700",children:c.summary}),c.imageChecks&&c.imageChecks.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:i==="de"?"Bildkonsistenz":i==="fr"?"CohÃ©rence des images":"Image Consistency"}),c.imageChecks.map((s,P)=>{var N,Q;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${s.consistent?"text-green-600":"text-amber-600"}`,children:s.consistent?"âœ“":"âš ï¸"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:s.type==="full"?"Full Check":s.type==="character"?`Character: ${s.characterName}`:s.type==="sequence"?"Sequence Check":s.type}),s.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",s.overallScore,"/10"]})]}),s.issues&&s.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:s.issues.map((g,ue)=>{var Ee,ut;return e.jsxs("div",{className:`text-xs p-2 rounded ${g.severity==="high"?"bg-red-50 border-l-4 border-red-400":g.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${g.severity==="high"?"bg-red-200 text-red-800":g.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:g.severity}),e.jsxs("span",{className:"text-gray-500",children:["Pages ",(Ee=g.images)==null?void 0:Ee.join(", ")]}),g.pagesToFix&&g.pagesToFix.length>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-orange-100 text-orange-700 rounded text-[10px]",children:["Fix: ",g.pagesToFix.join(", ")]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:(ut=g.type)==null?void 0:ut.replace(/_/g," ")}),g.characterInvolved&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded text-[10px]",children:g.characterInvolved})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:g.description}),g.details&&Object.keys(g.details).length>0&&e.jsx("div",{className:"mt-1 pl-2 border-l-2 border-gray-200",children:Object.entries(g.details).map(([qt,It])=>e.jsxs("p",{className:"text-gray-500 text-[10px]",children:[e.jsxs("span",{className:"font-medium",children:[qt,":"]})," ",It]},qt))}),g.canonicalVersion&&e.jsxs("p",{className:"text-blue-700 mt-1",children:["ðŸŽ¯ Target: ",g.canonicalVersion]}),g.recommendation&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:["ðŸ’¡ ",g.recommendation]})]},ue)})}),s.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:s.summary}),(s.evaluationPrompts||s.evaluationPrompt)&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:["ðŸ” View Evaluation Prompt",(((N=s.evaluationPrompts)==null?void 0:N.length)??0)>1?`s (${(Q=s.evaluationPrompts)==null?void 0:Q.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:(s.evaluationPrompts??(s.evaluationPrompt?[s.evaluationPrompt]:[])).map((g,ue)=>{var Ee;return e.jsxs("div",{children:[(((Ee=s.evaluationPrompts)==null?void 0:Ee.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-blue-700 mb-1",children:["Batch ",ue+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto bg-white p-2 rounded border",children:g})]},ue)})})]}),e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"ðŸ”§ View Parsed Result (Full JSON)"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-96 overflow-y-auto bg-white p-2 rounded border",children:JSON.stringify({type:s.type,characterName:s.characterName,consistent:s.consistent,overallScore:s.overallScore,issues:s.issues,summary:s.summary},null,2)})]}),s.rawResponses&&s.rawResponses.length>0&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:["ðŸ“ View Raw Response",s.rawResponses.length>1?`s (${s.rawResponses.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:s.rawResponses.map((g,ue)=>{var Ee;return e.jsxs("div",{children:[(((Ee=s.rawResponses)==null?void 0:Ee.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-purple-700 mb-1",children:["Batch ",ue+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto bg-white p-2 rounded border",children:g})]},ue)})})]})]},P)})]}),c.textCheck&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:i==="de"?"TextqualitÃ¤t":i==="fr"?"QualitÃ© du texte":"Text Quality"}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${c.textCheck.quality==="good"?"text-green-600":c.textCheck.quality==="needs_review"?"text-amber-600":"text-red-600"}`,children:c.textCheck.quality==="good"?"âœ“":"âš ï¸"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:c.textCheck.quality==="good"?"Good":c.textCheck.quality==="needs_review"?"Needs Review":"Has Issues"}),c.textCheck.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",c.textCheck.overallScore,"/10"]})]}),c.textCheck.issues&&c.textCheck.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:c.textCheck.issues.map((s,P)=>e.jsxs("div",{className:`text-xs p-2 rounded ${s.severity==="high"?"bg-red-50 border-l-4 border-red-400":s.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${s.severity==="high"?"bg-red-200 text-red-800":s.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:s.severity}),s.page&&e.jsxs("span",{className:"text-gray-500",children:["Page ",s.page]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:s.type})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:s.issue}),(s.originalText||s.text)&&e.jsxs("p",{className:"text-red-600 mt-1 line-through",children:['"',s.originalText||s.text,'"']}),s.correctedText&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:['âœ“ "',s.correctedText,'"']}),!s.correctedText&&s.suggestion&&e.jsxs("p",{className:"text-green-700 mt-1",children:["â†’ ",s.suggestion]})]},P))}),c.textCheck.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:c.textCheck.summary}),c.textCheck.fullOriginalText&&e.jsxs("details",{className:"mt-3 bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-gray-700",children:"ðŸ“„ View Original Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-600 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto",children:c.textCheck.fullOriginalText})]}),c.textCheck.fullCorrectedText&&e.jsxs("details",{className:"mt-3 bg-green-50 border border-green-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-green-800",children:"ðŸ“‹ View Full Corrected Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto",children:c.textCheck.fullCorrectedText})]}),c.textCheck.rawResponse&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:"ðŸ“ View Raw Response"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto",children:c.textCheck.rawResponse})]}),c.textCheck&&e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"ðŸ”§ View Parsed Result"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto",children:JSON.stringify({quality:c.textCheck.quality,overallScore:c.textCheck.overallScore,issues:c.textCheck.issues,summary:c.textCheck.summary,parseError:c.textCheck.parseError},null,2)})]}),c.textCheck.evaluationPrompt&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:"ðŸ” View Evaluation Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto",children:c.textCheck.evaluationPrompt})]})]})]}),c.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-2 text-xs text-red-700",children:["Error: ",c.error]})]})]}),$.length>0&&e.jsxs("details",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-green-800 hover:text-green-900 flex items-center gap-2",children:[e.jsx(Gr,{size:20}),i==="de"?`Alle Szenenbeschreibungen (${$.length})`:i==="fr"?`Toutes les descriptions de scÃ¨nes (${$.length})`:`All Scene Descriptions (${$.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:$.map(s=>{var P;return e.jsxs("details",{className:"bg-white border border-green-200 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-700 hover:text-green-800",children:Z==="de"?`Seite ${s.pageNumber}`:Z==="fr"?`Page ${s.pageNumber}`:`Page ${s.pageNumber}`}),e.jsxs("div",{className:"mt-2 space-y-2",children:[s.outlineExtract&&e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-amber-700",children:"Outline Extract:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:s.outlineExtract})]}),s.scenePrompt&&e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-purple-700",children:"Scene Prompt:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:s.scenePrompt})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Scene Description:"}),s.textModelId&&e.jsxs("span",{className:"ml-2 text-green-600",children:["(",s.textModelId,")"]}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:typeof s.description=="string"?s.description:((P=s.description)==null?void 0:P.text)||JSON.stringify(s.description)})]})]})]},s.pageNumber)})})]})]}),b&&yt(b.frontCover)&&(()=>{var P,N,Q;const s=ot(b.frontCover);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:Z==="de"?"Titelseite":Z==="fr"?"Couverture":"Front Cover"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ka,{src:yt(b.frontCover),alt:"Front Cover",className:"w-full rounded-lg shadow-lg",label:"Front Cover"}),v.has("frontCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(Lt,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),z&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>vs("front"),disabled:k||!Pe||v.has("frontCover"),className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k||!Pe||v.has("frontCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:Pe?"":i==="de"?"Nicht genug Credits":i==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(ps,{size:14}),i==="de"?"Bild neu generieren":i==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",He," ",i==="de"?"Credits":"credits",")"]})]})}),ae&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[Y&&e.jsxs("button",{onClick:()=>Y("front"),disabled:k,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(wt,{size:14})," ",i==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:i==="de"?"Szenenbeschreibung":i==="fr"?"Description de scÃ¨ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:typeof s.description=="string"?s.description:((P=s.description)==null?void 0:P.text)||JSON.stringify(s.description)})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[i==="de"?"API-Prompt":i==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:s.prompt})]}),((((N=s.referencePhotos)==null?void 0:N.length)??0)>0||(((Q=s.landmarkPhotos)==null?void 0:Q.length)??0)>0)&&e.jsx(ua,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,language:i}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[i==="de"?"QualitÃ¤tsbewertung":i==="fr"?"Score de qualitÃ©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:i==="de"?"Feedback:":i==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(Or,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:i})]})]})})(),b&&yt(b.initialPage)&&(()=>{var P,N,Q;const s=ot(b.initialPage);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:Z==="de"?"Widmungsseite":Z==="fr"?"Page de dÃ©dicace":"Dedication Page"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ka,{src:yt(b.initialPage),alt:"Dedication Page",className:"w-full rounded-lg shadow-lg",label:"Dedication Page"}),v.has("initialPage")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(Lt,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),z&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>vs("initial"),disabled:k||!Pe||v.has("initialPage"),className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k||!Pe||v.has("initialPage")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:Pe?"":i==="de"?"Nicht genug Credits":i==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(ps,{size:14}),i==="de"?"Bild neu generieren":i==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",He," ",i==="de"?"Credits":"credits",")"]})]})}),ae&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[Y&&e.jsxs("button",{onClick:()=>Y("initial"),disabled:k,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(wt,{size:14})," ",i==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:i==="de"?"Szenenbeschreibung":i==="fr"?"Description de scÃ¨ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:typeof s.description=="string"?s.description:((P=s.description)==null?void 0:P.text)||JSON.stringify(s.description)})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[i==="de"?"API-Prompt":i==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:s.prompt})]}),((((N=s.referencePhotos)==null?void 0:N.length)??0)>0||(((Q=s.landmarkPhotos)==null?void 0:Q.length)??0)>0)&&e.jsx(ua,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,language:i}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[i==="de"?"QualitÃ¤tsbewertung":i==="fr"?"Score de qualitÃ©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:i==="de"?"Feedback:":i==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(Or,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:i})]})]})})(),de&&!a&&(b==null?void 0:b.frontCover)&&e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-8 mt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-indigo-700",children:Z==="de"?"Geschichte wird erstellt...":Z==="fr"?"CrÃ©ation de l'histoire...":"Creating your story..."}),e.jsx("p",{className:"text-indigo-500 mt-2",children:Z==="de"?"Die Seiten werden gleich angezeigt":Z==="fr"?"Les pages seront bientÃ´t affichÃ©es":"Pages will appear shortly"})]})}),Ot&&a&&e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 text-center mb-6",children:t||(Z==="de"?"Ihre Geschichte":Z==="fr"?"Votre histoire":"Your Story")}),Ht.slice(0,de?ws:Ht.length).map((s,P)=>{var qt,It,Ss,ts;const N=P+1,Q=N,g=C.find(Ne=>Ne.pageNumber===Q),ue=de?Fe[Q]:void 0,Ee=!!(g!=null&&g.imageData||ue),ut=de&&N===ws&&!Ee;return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-4 text-center",children:Z==="de"?`Seite ${N}`:Z==="fr"?`Page ${N}`:`Page ${N}`}),Ts?e.jsxs("div",{className:"flex flex-col items-center max-w-2xl mx-auto",children:[ut?e.jsxs("div",{className:"w-full mb-4 aspect-[4/3] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-md flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-600 font-medium",children:Z==="de"?"Bild wird erstellt...":Z==="fr"?"CrÃ©ation de l'image...":"Creating image..."}),e.jsx("p",{className:"text-indigo-400 text-sm mt-1",children:Z==="de"?"Die nÃ¤chste Seite erscheint bald":Z==="fr"?"La page suivante arrive bientÃ´t":"Next page coming soon"})]}):g!=null&&g.imageData||ue?e.jsxs("div",{className:"w-full mb-4 relative",children:[e.jsx(Ka,{src:((g==null?void 0:g.imageData)||ue)??"",alt:`Scene for page ${N}`,className:`w-full rounded-lg shadow-md object-cover ${zt.has(N)?"opacity-50":""}`,label:`Page ${N}`}),zt.has(N)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(ma,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:i==="de"?"Neues Bild wird erstellt...":i==="fr"?"Nouvelle image en cours...":"Generating new image..."})]}),u&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>ys(N),disabled:k||zt.has(N)||!Pe,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k||zt.has(N)||!Pe?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:Pe?"":i==="de"?"Nicht genug Credits":i==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(ps,{size:14}),i==="de"?"Bild neu generieren":i==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",He," ",i==="de"?"Credits":"credits",")"]})]}),X&&e.jsxs("button",{onClick:()=>Ie(!0),disabled:k,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(wt,{size:14}),i==="de"?"Text bearbeiten":i==="fr"?"Modifier le texte":"Edit Text"]}),ms(N).length>1&&e.jsxs("button",{onClick:()=>A({pageNumber:N,versions:ms(N)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(ga,{size:14}),ms(N).length]})]})}),ae&&e.jsxs("div",{className:"mt-3 space-y-2",children:[_&&e.jsxs("button",{onClick:()=>_(N),disabled:k,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(wt,{size:14})," ",i==="de"?"Bearbeiten":"Edit"]}),I&&e.jsx("button",{onClick:()=>Vs(N),disabled:k||Zt!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k||Zt!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:i==="de"?"Physik-Fehler automatisch erkennen und reparieren":i==="fr"?"DÃ©tecter et rÃ©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:Zt===N?e.jsxs(e.Fragment,{children:[e.jsx(ma,{size:14,className:"animate-spin"}),i==="de"?"Repariere...":i==="fr"?"RÃ©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Wa,{size:14}),i==="de"?"Auto-Reparatur":i==="fr"?"Auto-RÃ©paration":"Auto-Repair"]})}),(g==null?void 0:g.repairHistory)&&g.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(Wa,{size:14}),i==="de"?"Reparatur-Historie":i==="fr"?"Historique de rÃ©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",g.repairHistory.length," ",i==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:g.repairHistory.map((Ne,Nt)=>e.jsxs("div",{className:`border rounded-lg p-3 ${Ne.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[i==="de"?`Reparatur ${Ne.attempt}`:`Repair ${Ne.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${Ne.success?"text-green-600":"text-red-600"}`,children:["(",Ne.success?"âœ“":"âœ—"," ",Ne.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:Ne.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:i==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:i==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",Ne.fixPrompt]}),Ne.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:i==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:Ne.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),Ne.beforeImage&&Ne.afterImage&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:i==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:Ne.beforeImage,alt:"Before repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>tt({src:Ne.beforeImage,title:i==="de"?"Vorher":"Before"}),title:i==="de"?"Klicken zum VergrÃ¶ÃŸern":"Click to enlarge"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:i==="de"?"Nachher:":"After:"}),e.jsx("img",{src:Ne.afterImage,alt:"After repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>tt({src:Ne.afterImage,title:i==="de"?"Nachher":"After"}),title:i==="de"?"Klicken zum VergrÃ¶ÃŸern":"Click to enlarge"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(Ne.timestamp).toLocaleTimeString()})]},Nt))})]}),vt(N)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:i==="de"?"Auszug aus Gliederung":i==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:vt(N)})]}),Xt(N)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:i==="de"?"Szenen-Prompt":i==="fr"?"Prompt de scÃ¨ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-64 overflow-y-auto",children:Xt(N)})]}),_t(N)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[i==="de"?"Szenenbeschreibung":i==="fr"?"Description de scÃ¨ne":"Scene Description",jt(N)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",jt(N),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:_t(N)})]}),(g==null?void 0:g.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[i==="de"?"API-Prompt":i==="fr"?"Prompt API":"API Prompt",(g==null?void 0:g.modelId)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",g.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:g==null?void 0:g.prompt})]}),((((qt=g==null?void 0:g.referencePhotos)==null?void 0:qt.length)??0)>0||(((It=g==null?void 0:g.landmarkPhotos)==null?void 0:It.length)??0)>0)&&g&&e.jsx(ua,{referencePhotos:g.referencePhotos||[],landmarkPhotos:g.landmarkPhotos,language:i}),(g==null?void 0:g.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[i==="de"?"QualitÃ¤tsbewertung":i==="fr"?"Score de qualitÃ©":"Quality Score",(g==null?void 0:g.qualityModelId)&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",g.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${((g==null?void 0:g.qualityScore)??0)>=70?"text-green-600":((g==null?void 0:g.qualityScore)??0)>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round((g==null?void 0:g.qualityScore)??0),"%"]})]}),(g==null?void 0:g.qualityReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:i==="de"?"Feedback:":i==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:g.qualityReasoning})]})]}),(g==null?void 0:g.retryHistory)&&g.retryHistory.length>0&&e.jsx(Or,{retryHistory:g.retryHistory,totalAttempts:(g==null?void 0:g.totalAttempts)||g.retryHistory.length,language:i,onRevertRepair:re?(Ne,Nt)=>re(g.pageNumber,Nt):void 0}),(g==null?void 0:g.wasRegenerated)&&(!(g!=null&&g.retryHistory)||g.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["ðŸ”„ ",i==="de"?"Bild regeneriert":i==="fr"?"Image rÃ©gÃ©nÃ©rÃ©e":"Image Regenerated"]}),(g==null?void 0:g.originalScore)!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(g.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:i==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige QualitÃ¤t hatte.":i==="fr"?"L'image a Ã©tÃ© automatiquement rÃ©gÃ©nÃ©rÃ©e car la premiÃ¨re version avait une qualitÃ© faible.":"Image was automatically regenerated because the first version had low quality."}),(g==null?void 0:g.originalImage)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:i==="de"?"Originalbild:":i==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:g.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),(g==null?void 0:g.originalReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:i==="de"?"Original Feedback:":i==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:g.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`w-full flex flex-col items-center justify-center rounded-lg p-8 mb-4 ${k?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:Z==="de"?"Bild wird noch erstellt...":Z==="fr"?"Image en cours de crÃ©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:Z==="de"?"Kein Bild fÃ¼r diese Seite":Z==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"w-full bg-indigo-50 rounded-lg p-6 border-2 border-indigo-200",children:rt?e.jsx("textarea",{value:s.trim(),onChange:Ne=>or(P,Ne.target.value),className:"w-full min-h-[400px] p-3 text-gray-800 leading-snug font-serif text-xl text-center bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:i==="de"?"Text eingeben...":i==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl text-center",children:s.trim()})})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 items-stretch",children:[g&&g.imageData?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:g.imageData,alt:`Scene for page ${N}`,className:`w-full rounded-lg shadow-md object-cover ${zt.has(N)?"opacity-50":""}`}),zt.has(N)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(ma,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:i==="de"?"Neues Bild wird erstellt...":i==="fr"?"Nouvelle image en cours...":"Generating new image..."})]})]}),u&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>ys(N),disabled:k||zt.has(N)||!Pe,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k||zt.has(N)||!Pe?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:Pe?"":i==="de"?"Nicht genug Credits":i==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(ps,{size:14}),i==="de"?"Bild neu generieren":i==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",He," ",i==="de"?"Credits":"credits",")"]})]}),X&&e.jsxs("button",{onClick:()=>Ie(!0),disabled:k,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(wt,{size:14}),i==="de"?"Text bearbeiten":i==="fr"?"Modifier le texte":"Edit Text"]}),ms(N).length>1&&e.jsxs("button",{onClick:()=>A({pageNumber:N,versions:ms(N)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(ga,{size:14}),ms(N).length]})]})}),ae&&e.jsxs("div",{className:"mt-3 space-y-2",children:[_&&e.jsxs("button",{onClick:()=>_(N),disabled:k,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(wt,{size:14})," ",i==="de"?"Bearbeiten":"Edit"]}),I&&e.jsx("button",{onClick:()=>Vs(N),disabled:k||Zt!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k||Zt!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:i==="de"?"Physik-Fehler automatisch erkennen und reparieren":i==="fr"?"DÃ©tecter et rÃ©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:Zt===N?e.jsxs(e.Fragment,{children:[e.jsx(ma,{size:14,className:"animate-spin"}),i==="de"?"Repariere...":i==="fr"?"RÃ©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Wa,{size:14}),i==="de"?"Auto-Reparatur":i==="fr"?"Auto-RÃ©paration":"Auto-Repair"]})}),(g==null?void 0:g.repairHistory)&&g.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(Wa,{size:14}),i==="de"?"Reparatur-Historie":i==="fr"?"Historique de rÃ©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",g.repairHistory.length," ",i==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:g.repairHistory.map((Ne,Nt)=>e.jsxs("div",{className:`border rounded-lg p-3 ${Ne.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[i==="de"?`Reparatur ${Ne.attempt}`:`Repair ${Ne.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${Ne.success?"text-green-600":"text-red-600"}`,children:["(",Ne.success?"âœ“":"âœ—"," ",Ne.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:Ne.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:i==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:i==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",Ne.fixPrompt]}),Ne.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:i==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:Ne.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),Ne.beforeImage&&Ne.afterImage&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:i==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:Ne.beforeImage,alt:"Before repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>tt({src:Ne.beforeImage,title:i==="de"?"Vorher":"Before"}),title:i==="de"?"Klicken zum VergrÃ¶ÃŸern":"Click to enlarge"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:i==="de"?"Nachher:":"After:"}),e.jsx("img",{src:Ne.afterImage,alt:"After repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>tt({src:Ne.afterImage,title:i==="de"?"Nachher":"After"}),title:i==="de"?"Klicken zum VergrÃ¶ÃŸern":"Click to enlarge"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(Ne.timestamp).toLocaleTimeString()})]},Nt))})]}),vt(N)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:i==="de"?"Auszug aus Gliederung":i==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:vt(N)})]}),Xt(N)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:i==="de"?"Szenen-Prompt":i==="fr"?"Prompt de scÃ¨ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-64 overflow-y-auto",children:Xt(N)})]}),_t(N)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[i==="de"?"Szenenbeschreibung":i==="fr"?"Description de scÃ¨ne":"Scene Description",jt(N)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",jt(N),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:_t(N)})]}),g.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[i==="de"?"API-Prompt":i==="fr"?"Prompt API":"API Prompt",g.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",g.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:g.prompt})]}),((((Ss=g.referencePhotos)==null?void 0:Ss.length)??0)>0||(((ts=g.landmarkPhotos)==null?void 0:ts.length)??0)>0)&&e.jsx(ua,{referencePhotos:g.referencePhotos||[],landmarkPhotos:g.landmarkPhotos,language:i}),g.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[i==="de"?"QualitÃ¤tsbewertung":i==="fr"?"Score de qualitÃ©":"Quality Score",g.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",g.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${g.qualityScore>=70?"text-green-600":g.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(g.qualityScore),"%"]})]}),g.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:i==="de"?"Feedback:":i==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:g.qualityReasoning})]})]}),g.retryHistory&&g.retryHistory.length>0&&e.jsx(Or,{retryHistory:g.retryHistory,totalAttempts:g.totalAttempts||g.retryHistory.length,language:i,onRevertRepair:re?(Ne,Nt)=>re(g.pageNumber,Nt):void 0}),g.wasRegenerated&&(!g.retryHistory||g.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["ðŸ”„ ",i==="de"?"Bild regeneriert":i==="fr"?"Image rÃ©gÃ©nÃ©rÃ©e":"Image Regenerated"]}),g.originalScore!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(g.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:i==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige QualitÃ¤t hatte.":i==="fr"?"L'image a Ã©tÃ© automatiquement rÃ©gÃ©nÃ©rÃ©e car la premiÃ¨re version avait une qualitÃ© faible.":"Image was automatically regenerated because the first version had low quality."}),g.originalImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:i==="de"?"Originalbild:":i==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:g.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),g.originalReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:i==="de"?"Original Feedback:":i==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:g.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`flex flex-col items-center justify-center rounded-lg p-8 ${k?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:Z==="de"?"Bild wird noch erstellt...":Z==="fr"?"Image en cours de crÃ©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:Z==="de"?"Kein Bild fÃ¼r diese Seite":Z==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"flex flex-col w-full h-full",children:rt?e.jsx("textarea",{value:s.trim(),onChange:Ne=>or(P,Ne.target.value),className:"w-full flex-1 min-h-[300px] p-4 text-gray-800 leading-snug font-serif text-xl bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:i==="de"?"Text eingeben...":i==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl",children:s.trim()})})})]})]},N)}),de&&Object.keys(Fe).length<pt&&e.jsx("div",{className:"p-6 text-center",children:e.jsxs("div",{className:"inline-flex flex-col items-center bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6 shadow-sm",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-700 font-semibold",children:Z==="de"?`Bild ${Object.keys(Fe).length} von ${pt}`:Z==="fr"?`Image ${Object.keys(Fe).length} sur ${pt}`:`Image ${Object.keys(Fe).length} of ${pt}`}),e.jsx("p",{className:"text-indigo-500 text-sm mt-1",children:Z==="de"?"Weitere Bilder werden geladen...":Z==="fr"?"Chargement des images suivantes...":"Loading more images..."})]})})]}),k&&a&&C.filter(s=>s.imageData).length<Ht.length&&e.jsx("div",{className:"mt-8 max-w-2xl mx-auto",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 border-dashed rounded-xl p-8",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-700 font-semibold",children:Z==="de"?"Weitere Seiten werden erstellt...":Z==="fr"?"CrÃ©ation des pages suivantes...":"Creating more pages..."})]})})}),b&&yt(b.backCover)&&(()=>{var P,N,Q;const s=ot(b.backCover);return e.jsxs("div",{className:"mt-8 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:Z==="de"?"RÃ¼ckseite":Z==="fr"?"QuatriÃ¨me de couverture":"Back Cover"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ka,{src:yt(b.backCover),alt:"Back Cover",className:"w-full rounded-lg shadow-lg",label:"Back Cover"}),v.has("backCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(Lt,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),z&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>vs("back"),disabled:k||!Pe||v.has("backCover"),className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k||!Pe||v.has("backCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:Pe?"":i==="de"?"Nicht genug Credits":i==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(ps,{size:14}),i==="de"?"Bild neu generieren":i==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",He," ",i==="de"?"Credits":"credits",")"]})]})}),ae&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[Y&&e.jsxs("button",{onClick:()=>Y("back"),disabled:k,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(wt,{size:14})," ",i==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:i==="de"?"Szenenbeschreibung":i==="fr"?"Description de scÃ¨ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:typeof s.description=="string"?s.description:((P=s.description)==null?void 0:P.text)||JSON.stringify(s.description)})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[i==="de"?"API-Prompt":i==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:s.prompt})]}),((((N=s.referencePhotos)==null?void 0:N.length)??0)>0||(((Q=s.landmarkPhotos)==null?void 0:Q.length)??0)>0)&&e.jsx(ua,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,language:i}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[i==="de"?"QualitÃ¤tsbewertung":i==="fr"?"Score de qualitÃ©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:i==="de"?"Feedback:":i==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(Or,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:i})]})]})})(),Ot&&a&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-4 mt-6",children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-3 text-center",children:i==="de"?"Was mÃ¶chten Sie als NÃ¤chstes tun?":i==="fr"?"Que souhaitez-vous faire ensuite ?":"What would you like to do next?"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[xe&&R&&e.jsxs("button",{onClick:R,disabled:k,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Fn,{size:16})," ",i==="de"?"Buch erstellen":i==="fr"?"CrÃ©er le livre":"Create Book"]}),L&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>Qt(!cs),disabled:k,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Gr,{size:16}),i==="de"?"PDF herunterladen":i==="fr"?"TÃ©lÃ©charger PDF":"Download PDF",e.jsx(Ft,{size:14,className:`transition-transform ${cs?"rotate-180":""}`})]}),cs&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:ds==="square",onChange:()=>bs("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20Ã—20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:ds==="A4",onChange:()=>bs("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21Ã—28cm)"})]})]}),e.jsx("button",{onClick:()=>{L(ds),Qt(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:i==="de"?"Herunterladen":i==="fr"?"TÃ©lÃ©charger":"Download"})]})]}),X&&!rt&&e.jsxs("button",{onClick:()=>Ie(!0),disabled:k,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(wt,{size:16})," ",i==="de"?"Text bearbeiten":i==="fr"?"Modifier le texte":"Edit Text"]}),se&&e.jsxs("button",{onClick:se,disabled:k,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${k?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xa,{size:16})," ",i==="de"?"Neue Geschichte":i==="fr"?"Nouvelle histoire":"New Story"]})]})]}),rt&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 shadow-lg p-3 md:p-4 z-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(wt,{size:18,className:"flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-sm md:text-base",children:i==="de"?"Bearbeitungsmodus":i==="fr"?"Mode Ã©dition":"Edit Mode"}),T&&e.jsxs("span",{className:"text-xs text-gray-500 hidden sm:inline",children:["(",i==="de"?"Original gespeichert":i==="fr"?"Original sauvegardÃ©":"Original saved",")"]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-center md:justify-end",children:[e.jsxs("button",{onClick:Sr,disabled:is,className:"px-3 md:px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(ns,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:i==="de"?"Abbrechen":i==="fr"?"Annuler":"Cancel"})]}),T&&Pt!==T&&e.jsxs("button",{onClick:()=>Ke(T),disabled:is,className:"px-3 md:px-4 py-2 border border-amber-400 text-amber-700 rounded-lg hover:bg-amber-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(Hi,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:i==="de"?"ZurÃ¼cksetzen":i==="fr"?"Restaurer":"Restore"})]}),e.jsxs("button",{onClick:wr,disabled:is,className:`px-3 md:px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-semibold flex items-center gap-1.5 ${is?"opacity-50 cursor-not-allowed":"hover:bg-green-600"}`,children:[e.jsx(As,{size:16}),is?i==="de"?"Speichern...":i==="fr"?"Sauvegarde...":"Saving...":i==="de"?"Speichern":i==="fr"?"Sauvegarder":"Save"]})]})]})}),De&&e.jsx(ul,{pageNumber:De.pageNumber,scene:De.scene,onSceneChange:s=>ls({...De,scene:s}),onClose:()=>ls(null),onRegenerate:Us,isRegenerating:zt.has(De.pageNumber),imageRegenerationCost:He,characters:J.map(s=>({id:s.id,name:s.name,photoUrl:s.photoData})),selectedCharacterIds:De.selectedCharacterIds,onCharacterSelectionChange:s=>ls({...De,selectedCharacterIds:s}),consistencyRegen:ae?(zs=C.find(s=>s.pageNumber===De.pageNumber))==null?void 0:zs.consistencyRegen:void 0}),St&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-lg w-full shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ps,{size:20}),i==="de"?"Cover bearbeiten":i==="fr"?"Modifier la couverture":"Edit Cover"," - ",St.coverType==="front"?i==="de"?"Titelseite":i==="fr"?"Couverture":"Front Cover":St.coverType==="initial"?i==="de"?"Einleitungsseite":i==="fr"?"Page de dÃ©dicace":"Dedication Page":i==="de"?"RÃ¼ckseite":i==="fr"?"Dos":"Back Cover"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:i==="de"?"Beschreibe was auf dem Bild zu sehen sein soll":i==="fr"?"DÃ©crivez ce que l'image doit montrer":"Describe what should be shown in the image"})]}),e.jsx("div",{className:"p-4",children:e.jsx("textarea",{value:St.scene,onChange:s=>dt({...St,scene:s.target.value}),placeholder:i==="de"?'z.B. "Die Hauptfigur steht vor einem magischen Schloss bei Sonnenuntergang"':i==="fr"?'par ex. "Le personnage principal devant un chÃ¢teau magique au coucher du soleil"':'e.g. "The main character standing in front of a magical castle at sunset"',className:"w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-none"})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>dt(null),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium",children:i==="de"?"Abbrechen":i==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{onClick:Js,disabled:v.has(St.coverType==="front"?"frontCover":St.coverType==="initial"?"initialPage":"backCover"),className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center gap-2 ${v.has(St.coverType==="front"?"frontCover":St.coverType==="initial"?"initialPage":"backCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:[e.jsx(ps,{size:16}),i==="de"?"Neu generieren":i==="fr"?"RÃ©gÃ©nÃ©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",He," ",i==="de"?"Credits":"credits",")"]})]})]})]})}),mt&&e.jsx(gl,{pageNumber:mt.pageNumber,versions:mt.versions,onClose:()=>A(null),onSelectVersion:Ws,developerMode:ae}),$s&&e.jsx(hl,{src:$s.src,title:$s.title,onClose:()=>tt(null)})]})}const Ua={"claude-sonnet":{provider:"anthropic",description:"Claude Sonnet 4.5 - Best narrative quality",descriptionDe:"Claude Sonnet 4.5 - Beste ErzÃ¤hlqualitÃ¤t",descriptionFr:"Claude Sonnet 4.5 - Meilleure qualitÃ© narrative"},"claude-haiku":{provider:"anthropic",description:"Claude Haiku 3.5 - Fast and cheap",descriptionDe:"Claude Haiku 3.5 - Schnell und gÃ¼nstig",descriptionFr:"Claude Haiku 3.5 - Rapide et Ã©conomique"},"gemini-2.5-pro":{provider:"google",description:"Gemini 2.5 Pro - High quality, large output",descriptionDe:"Gemini 2.5 Pro - Hohe QualitÃ¤t, grosse Ausgabe",descriptionFr:"Gemini 2.5 Pro - Haute qualitÃ©, grande sortie"},"gemini-2.5-flash":{provider:"google",description:"Gemini 2.5 Flash - Fast with large output",descriptionDe:"Gemini 2.5 Flash - Schnell mit grosser Ausgabe",descriptionFr:"Gemini 2.5 Flash - Rapide avec grande sortie"},"gemini-2.0-flash":{provider:"google",description:"Gemini 2.0 Flash - Very fast",descriptionDe:"Gemini 2.0 Flash - Sehr schnell",descriptionFr:"Gemini 2.0 Flash - TrÃ¨s rapide"}},On={"gemini-2.5-flash-image":{description:"Gemini 2.5 Flash Image - Fast scene generation",descriptionDe:"Gemini 2.5 Flash Image - Schnelle Szenengenerierung",descriptionFr:"Gemini 2.5 Flash Image - GÃ©nÃ©ration rapide de scÃ¨nes"},"gemini-3-pro-image-preview":{description:"Gemini 3 Pro Image - Higher quality (preview)",descriptionDe:"Gemini 3 Pro Image - HÃ¶here QualitÃ¤t (Vorschau)",descriptionFr:"Gemini 3 Pro Image - QualitÃ© supÃ©rieure (aperÃ§u)"},"flux-schnell":{description:"FLUX Schnell (Runware) - Ultra cheap ($0.0006/image)",descriptionDe:"FLUX Schnell (Runware) - Ultra gÃ¼nstig ($0.0006/Bild)",descriptionFr:"FLUX Schnell (Runware) - Ultra Ã©conomique ($0.0006/image)"},"flux-dev":{description:"FLUX Dev (Runware) - Better quality ($0.004/image)",descriptionDe:"FLUX Dev (Runware) - Bessere QualitÃ¤t ($0.004/Bild)",descriptionFr:"FLUX Dev (Runware) - Meilleure qualitÃ© ($0.004/image)"}},yl={"gemini-2.0-flash":{description:"Gemini 2.0 Flash - Fast evaluation",descriptionDe:"Gemini 2.0 Flash - Schnelle Bewertung",descriptionFr:"Gemini 2.0 Flash - Ã‰valuation rapide"},"gemini-2.5-flash":{description:"Gemini 2.5 Flash - More thorough",descriptionDe:"Gemini 2.5 Flash - GrÃ¼ndlicher",descriptionFr:"Gemini 2.5 Flash - Plus approfondi"}},vl={gemini:{description:"Google Gemini - Best quality (~$0.035/image)",descriptionDe:"Google Gemini - Beste QualitÃ¤t (~$0.035/Bild)",descriptionFr:"Google Gemini - Meilleure qualitÃ© (~$0.035/image)"},runware:{description:"FLUX Schnell - Ultra cheap for testing ($0.0006/image)",descriptionDe:"FLUX Schnell - Ultra gÃ¼nstig zum Testen ($0.0006/Bild)",descriptionFr:"FLUX Schnell - Ultra Ã©conomique pour tests ($0.0006/image)"}},jl={"gemini-2.5-flash-image":{description:"Gemini 2.5 Flash Image - Fast avatar generation",descriptionDe:"Gemini 2.5 Flash Image - Schnelle Avatar-Generierung",descriptionFr:"Gemini 2.5 Flash Image - GÃ©nÃ©ration rapide d'avatars"},"gemini-3-pro-image-preview":{description:"Gemini 3 Pro Image - Higher quality (preview)",descriptionDe:"Gemini 3 Pro Image - HÃ¶here QualitÃ¤t (Vorschau)",descriptionFr:"Gemini 3 Pro Image - QualitÃ© supÃ©rieure (aperÃ§u)"},"ace-plus-plus":{description:"ACE++ (Runware) - Cheap face-consistent avatars (~$0.005)",descriptionDe:"ACE++ (Runware) - GÃ¼nstige gesichtskonsistente Avatare (~$0.005)",descriptionFr:"ACE++ (Runware) - Avatars Ã©conomiques avec visage cohÃ©rent (~$0.005)"}};function Hs({label:t,icon:a,value:n,options:p,onChange:r,language:f}){const x=o=>f==="de"&&o.descriptionDe?o.descriptionDe:f==="fr"&&o.descriptionFr?o.descriptionFr:o.description;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("label",{className:"text-xs font-semibold text-gray-600 flex items-center gap-1",children:[a,t]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:n||"",onChange:o=>r(o.target.value||null),className:"w-full appearance-none bg-white border border-gray-300 rounded-lg px-3 py-2 pr-8 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:f==="de"?"Server-Standard":f==="fr"?"Par dÃ©faut serveur":"Server Default"}),Object.entries(p).map(([o,C])=>e.jsxs("option",{value:o,children:[o," ",C.provider?`(${C.provider})`:""]},o))]}),e.jsx(Ft,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),n&&p[n]&&e.jsx("p",{className:"text-[10px] text-gray-500 italic",children:x(p[n])})]})}function Nl({selections:t,onChange:a}){const{language:n}=gt(),p=(r,f)=>{a({...t,[r]:f})};return e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-400 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-yellow-800 mb-3 flex items-center gap-2",children:[e.jsx(Ji,{size:16}),n==="de"?"AI-Modell Auswahl (Dev)":n==="fr"?"SÃ©lection de modÃ¨le IA (Dev)":"AI Model Selection (Dev)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(Hs,{label:n==="de"?"Ideen-Modell":n==="fr"?"ModÃ¨le d'idÃ©es":"Idea Model",icon:e.jsx(Qi,{size:12}),value:t.ideaModel,options:Ua,onChange:r=>p("ideaModel",r),language:n}),e.jsx(Hs,{label:n==="de"?"Geschichte (Kombiniert)":n==="fr"?"Histoire (CombinÃ©)":"Story (Combined)",icon:e.jsx(Mt,{size:12}),value:t.outlineModel,options:Ua,onChange:r=>p("outlineModel",r),language:n}),e.jsx(Hs,{label:n==="de"?"Text-Modell":n==="fr"?"ModÃ¨le de texte":"Text Model",icon:e.jsx(Mt,{size:12}),value:t.textModel,options:Ua,onChange:r=>p("textModel",r),language:n}),e.jsx(Hs,{label:n==="de"?"Szenen-Modell":n==="fr"?"ModÃ¨le de scÃ¨ne":"Scene Description Model",icon:e.jsx(jn,{size:12}),value:t.sceneDescriptionModel,options:Ua,onChange:r=>p("sceneDescriptionModel",r),language:n}),e.jsx(Hs,{label:n==="de"?"Bild-Modell":n==="fr"?"ModÃ¨le d'image":"Image Model",icon:e.jsx(Tn,{size:12}),value:t.imageModel,options:On,onChange:r=>p("imageModel",r),language:n}),e.jsx(Hs,{label:n==="de"?"Cover-Modell":n==="fr"?"ModÃ¨le de couverture":"Cover Image Model",icon:e.jsx(hn,{size:12}),value:t.coverImageModel,options:On,onChange:r=>p("coverImageModel",r),language:n}),e.jsx(Hs,{label:n==="de"?"Bewertungs-Modell":n==="fr"?"ModÃ¨le d'Ã©valuation":"Quality Eval Model",icon:e.jsx($i,{size:12}),value:t.qualityModel,options:yl,onChange:r=>p("qualityModel",r),language:n}),e.jsx(Hs,{label:n==="de"?"Bild-Reparatur":n==="fr"?"RÃ©paration d'image":"Image Repair",icon:e.jsx(sl,{size:12}),value:t.imageBackend,options:vl,onChange:r=>p("imageBackend",r),language:n}),e.jsx(Hs,{label:n==="de"?"Avatar-Modell":n==="fr"?"ModÃ¨le d'avatar":"Avatar Model",icon:e.jsx(Tn,{size:12}),value:t.avatarModel,options:jl,onChange:r=>p("avatarModel",r),language:n})]}),e.jsx("p",{className:"text-[10px] text-yellow-700 mt-3 italic",children:n==="de"?'Hinweis: Nur sichtbar fÃ¼r Admin-Benutzer im Entwicklermodus. "Server-Standard" verwendet die Umgebungsvariablen-Konfiguration.':n==="fr"?`Note: Visible uniquement pour les utilisateurs admin en mode dÃ©veloppeur. "Par dÃ©faut serveur" utilise la configuration des variables d'environnement.`:'Note: Only visible to admin users in developer mode. "Server Default" uses the environment variable configuration.'})]})}const nr=[{id:"adventure",name:{en:"Adventure",de:"Abenteuer",fr:"Aventure"},description:{en:"Exciting journeys and heroic quests",de:"Spannende Reisen und heldenhafte Abenteuer",fr:"Voyages passionnants et quÃªtes hÃ©roÃ¯ques"},emoji:"ðŸ—¡ï¸"},{id:"life-challenge",name:{en:"Life Skills",de:"Lebensthemen",fr:"CompÃ©tences de vie"},description:{en:"Help overcome everyday challenges",de:"Hilfe bei alltÃ¤glichen Herausforderungen",fr:"Aide pour surmonter les dÃ©fis quotidiens"},emoji:"ðŸ’ª"},{id:"educational",name:{en:"Learning",de:"Lernen",fr:"Apprentissage"},description:{en:"Fun stories that teach something new",de:"Lustige Geschichten, die etwas Neues lehren",fr:"Histoires amusantes qui enseignent quelque chose de nouveau"},emoji:"ðŸ“š"},{id:"historical",name:{en:"History",de:"Geschichte",fr:"Histoire"},description:{en:"Experience real historical events",de:"Erlebe echte historische Ereignisse",fr:"Vivez de vrais Ã©vÃ©nements historiques"},emoji:"ðŸ›ï¸"},{id:"custom",name:{en:"Create Your Own",de:"Eigenes Thema",fr:"CrÃ©er le vÃ´tre"},description:{en:"Describe your own unique story idea",de:"Beschreibe deine eigene Geschichte",fr:"DÃ©cris ta propre idÃ©e d'histoire"},emoji:"âœ¨"}],wl=["pirate","knight","cowboy","ninja","wizard","dragon","superhero","detective","easter"],_n=[{id:"popular",name:{en:"Popular",de:"Beliebt",fr:"Populaires"}},{id:"historical",name:{en:"Historical Times",de:"Historische Zeiten",fr:"Ã‰poques historiques"}},{id:"fantasy",name:{en:"Fantasy & Magic",de:"Fantasie & Magie",fr:"Fantaisie & Magie"}},{id:"locations",name:{en:"Exploration",de:"Entdeckung",fr:"Exploration"}},{id:"professions",name:{en:"Heroes & Helpers",de:"Helden & Helfer",fr:"HÃ©ros & Aides"}},{id:"seasonal",name:{en:"Seasonal",de:"Jahreszeiten",fr:"Saisonnier"}},{id:"custom",name:{en:"Custom",de:"Eigenes Thema",fr:"PersonnalisÃ©"}}],Wr=[{id:"pirate",name:{en:"Pirate Adventure",de:"Piraten-Abenteuer",fr:"Aventure de Pirates"},emoji:"ðŸ´â€â˜ ï¸",group:"historical"},{id:"knight",name:{en:"Knights & Princess",de:"Ritter & Prinzessin",fr:"Chevaliers & Princesse"},emoji:"âš”ï¸",group:"historical"},{id:"cowboy",name:{en:"Cowboys & Indians",de:"Cowboys und Indianer",fr:"Cowboys et Indiens"},emoji:"ðŸ¤ ",group:"historical"},{id:"ninja",name:{en:"Secret Ninja",de:"Geheimer Ninja",fr:"Ninja Secret"},emoji:"ðŸ¥·",group:"historical"},{id:"viking",name:{en:"Viking Adventure",de:"Wikinger-Abenteuer",fr:"Aventure Viking"},emoji:"âš“",group:"historical"},{id:"roman",name:{en:"Ancient Rome",de:"Antikes Rom",fr:"Rome Antique"},emoji:"ðŸ›ï¸",group:"historical"},{id:"egyptian",name:{en:"Ancient Egypt",de:"Altes Ã„gypten",fr:"Ã‰gypte Ancienne"},emoji:"ðŸº",group:"historical"},{id:"greek",name:{en:"Ancient Greece",de:"Antikes Griechenland",fr:"GrÃ¨ce Antique"},emoji:"ðŸº",group:"historical"},{id:"caveman",name:{en:"Stone Age",de:"Steinzeit",fr:"Ã‚ge de Pierre"},emoji:"ðŸ¦´",group:"historical"},{id:"samurai",name:{en:"Samurai Adventure",de:"Samurai-Abenteuer",fr:"Aventure SamouraÃ¯"},emoji:"ðŸŽŒ",group:"historical"},{id:"wizard",name:{en:"Wizard & Witch",de:"Zauberer & Hexe",fr:"Sorcier & SorciÃ¨re"},emoji:"ðŸ§™",group:"fantasy"},{id:"dragon",name:{en:"Dragon Quest",de:"Drachen-Abenteuer",fr:"QuÃªte du Dragon"},emoji:"ðŸ‰",group:"fantasy"},{id:"unicorn",name:{en:"Magical Unicorn",de:"Magisches Einhorn",fr:"Licorne Magique"},emoji:"ðŸ¦„",group:"fantasy"},{id:"mermaid",name:{en:"Mermaid Adventure",de:"Meerjungfrauen-Abenteuer",fr:"Aventure de SirÃ¨ne"},emoji:"ðŸ§œâ€â™€ï¸",group:"fantasy"},{id:"dinosaur",name:{en:"Dinosaur World",de:"Dinosaurier-Welt",fr:"Monde des Dinosaures"},emoji:"ðŸ¦–",group:"fantasy"},{id:"superhero",name:{en:"Superhero",de:"Superheld",fr:"Super-hÃ©ros"},emoji:"ðŸ¦¸",group:"fantasy"},{id:"space",name:{en:"Space Explorer",de:"Weltraum-Entdecker",fr:"Explorateur Spatial"},emoji:"ðŸš€",group:"locations"},{id:"ocean",name:{en:"Ocean Explorer",de:"Ozean-Entdecker",fr:"Explorateur des OcÃ©ans"},emoji:"ðŸŒŠ",group:"locations"},{id:"jungle",name:{en:"Jungle Safari",de:"Dschungel-Safari",fr:"Safari dans la Jungle"},emoji:"ðŸŒ´",group:"locations"},{id:"farm",name:{en:"Farm Life",de:"Bauernhof-Leben",fr:"Vie Ã  la Ferme"},emoji:"ðŸ„",group:"locations"},{id:"forest",name:{en:"Forest Friends",de:"Waldfreunde",fr:"Amis de la ForÃªt"},emoji:"ðŸ¦Š",group:"locations"},{id:"fireman",name:{en:"Brave Firefighter",de:"Tapferer Feuerwehrmann",fr:"Pompier Courageux"},emoji:"ðŸš’",group:"professions"},{id:"doctor",name:{en:"Helpful Doctor",de:"Hilfreicher Arzt",fr:"Docteur Serviable"},emoji:"ðŸ‘¨â€âš•ï¸",group:"professions"},{id:"police",name:{en:"Police Officer",de:"Polizist",fr:"Policier"},emoji:"ðŸ‘®",group:"professions"},{id:"detective",name:{en:"Detective Mystery",de:"Detektiv-Geheimnis",fr:"MystÃ¨re DÃ©tective"},emoji:"ðŸ”",group:"professions"},{id:"christmas",name:{en:"Christmas Story",de:"Weihnachts-Geschichte",fr:"Histoire de NoÃ«l"},emoji:"ðŸŽ„",group:"seasonal"},{id:"newyear",name:{en:"New Year Story",de:"Neujahrs-Geschichte",fr:"Histoire du Nouvel An"},emoji:"ðŸŽ†",group:"seasonal"},{id:"easter",name:{en:"Easter Story",de:"Oster-Geschichte",fr:"Histoire de PÃ¢ques"},emoji:"ðŸ°",group:"seasonal"},{id:"halloween",name:{en:"Halloween Story",de:"Halloween-Geschichte",fr:"Histoire d'Halloween"},emoji:"ðŸŽƒ",group:"seasonal"},{id:"custom",name:{en:"Create Your Own",de:"Eigenes Thema",fr:"CrÃ©er le vÃ´tre"},emoji:"âœ¨",group:"custom"}],qr={name:{en:"Everyday Life",de:"Alltag",fr:"Vie Quotidienne"},emoji:"ðŸ "},ha=[{id:"potty-training",name:{en:"Potty Training",de:"TÃ¶pfchen-Training",fr:"Apprentissage du pot"},emoji:"ðŸš½",ageGroup:"toddler"},{id:"washing-hands",name:{en:"Washing Hands",de:"HÃ¤nde waschen",fr:"Se laver les mains"},emoji:"ðŸ§¼",ageGroup:"toddler"},{id:"brushing-teeth",name:{en:"Brushing Teeth",de:"ZÃ¤hne putzen",fr:"Se brosser les dents"},emoji:"ðŸª¥",ageGroup:"toddler"},{id:"eating-vegetables",name:{en:"Eating Vegetables",de:"GemÃ¼se essen",fr:"Manger des lÃ©gumes"},emoji:"ðŸ¥¦",ageGroup:"toddler"},{id:"going-to-bed",name:{en:"Going to Bed",de:"Ins Bett gehen",fr:"Aller au lit"},emoji:"ðŸ›ï¸",ageGroup:"toddler"},{id:"saying-goodbye",name:{en:"Saying Goodbye",de:"Abschied nehmen",fr:"Dire au revoir"},emoji:"ðŸ‘‹",ageGroup:"toddler"},{id:"no-pacifier",name:{en:"No More Pacifier",de:"Ohne Schnuller",fr:"Plus de tÃ©tine"},emoji:"ðŸ¼",ageGroup:"toddler"},{id:"cleaning-up",name:{en:"Cleaning Up Toys",de:"AufrÃ¤umen",fr:"Ranger les jouets"},emoji:"ðŸ§¹",ageGroup:"preschool"},{id:"sitting-still",name:{en:"Sitting Still",de:"Still sitzen",fr:"Rester tranquille"},emoji:"ðŸª‘",ageGroup:"preschool"},{id:"sharing",name:{en:"Learning to Share",de:"Teilen lernen",fr:"Apprendre Ã  partager"},emoji:"ðŸ¤",ageGroup:"preschool"},{id:"waiting-turn",name:{en:"Waiting Your Turn",de:"Warten kÃ¶nnen",fr:"Attendre son tour"},emoji:"â³",ageGroup:"preschool"},{id:"first-kindergarten",name:{en:"First Day of Kindergarten",de:"Erster Kindergartentag",fr:"Premier jour de maternelle"},emoji:"ðŸŽ’",ageGroup:"preschool"},{id:"making-friends",name:{en:"Making Friends",de:"Freunde finden",fr:"Se faire des amis"},emoji:"ðŸ‘«",ageGroup:"preschool"},{id:"being-brave",name:{en:"Being Brave",de:"Mutig sein",fr:"ÃŠtre courageux"},emoji:"ðŸ’ª",ageGroup:"preschool"},{id:"new-sibling",name:{en:"New Baby Sibling",de:"Neues Geschwisterchen",fr:"Nouveau bÃ©bÃ© dans la famille"},emoji:"ðŸ‘¶",ageGroup:"preschool"},{id:"first-school",name:{en:"First Day of School",de:"Erster Schultag",fr:"Premier jour d'Ã©cole"},emoji:"ðŸ«",ageGroup:"early-school"},{id:"homework",name:{en:"Doing Homework",de:"Hausaufgaben machen",fr:"Faire ses devoirs"},emoji:"ðŸ“",ageGroup:"early-school"},{id:"reading-alone",name:{en:"Learning to Read",de:"Lesen lernen",fr:"Apprendre Ã  lire"},emoji:"ðŸ“–",ageGroup:"early-school"},{id:"losing-game",name:{en:"Losing a Game",de:"Verlieren kÃ¶nnen",fr:"Savoir perdre"},emoji:"ðŸŽ¯",ageGroup:"early-school"},{id:"being-different",name:{en:"Being Different is OK",de:"Anders sein ist OK",fr:"ÃŠtre diffÃ©rent c'est bien"},emoji:"ðŸŒˆ",ageGroup:"early-school"},{id:"dealing-bully",name:{en:"Dealing with Bullies",de:"Mit HÃ¤nseleien umgehen",fr:"Faire face aux moqueries"},emoji:"ðŸ›¡ï¸",ageGroup:"early-school"},{id:"telling-truth",name:{en:"Telling the Truth",de:"Die Wahrheit sagen",fr:"Dire la vÃ©ritÃ©"},emoji:"âœ…",ageGroup:"early-school"},{id:"trying-new-things",name:{en:"Trying New Things",de:"Neues ausprobieren",fr:"Essayer de nouvelles choses"},emoji:"ðŸŒŸ",ageGroup:"early-school"},{id:"moving-house",name:{en:"Moving to a New Home",de:"Umzug",fr:"DÃ©mÃ©nagement"},emoji:"ðŸ ",ageGroup:"family"},{id:"going-vacation",name:{en:"Going on Vacation",de:"In den Urlaub fahren",fr:"Partir en vacances"},emoji:"âœˆï¸",ageGroup:"family"},{id:"parents-splitting",name:{en:"Parents Living Apart",de:"Eltern leben getrennt",fr:"Parents sÃ©parÃ©s"},emoji:"ðŸ’”",ageGroup:"family"},{id:"visiting-doctor",name:{en:"Going to the Doctor",de:"Arztbesuch",fr:"Visite chez le mÃ©decin"},emoji:"ðŸ¥",ageGroup:"family"},{id:"staying-hospital",name:{en:"Staying in Hospital",de:"Im Krankenhaus",fr:"SÃ©jour Ã  l'hÃ´pital"},emoji:"ðŸ©º",ageGroup:"family"},{id:"death-pet",name:{en:"Losing a Pet",de:"Haustier verlieren",fr:"Perte d'un animal"},emoji:"ðŸŒˆ",ageGroup:"family"},{id:"grandparent-sick",name:{en:"Grandparent is Sick",de:"Grosseltern sind krank",fr:"Grand-parent malade"},emoji:"â¤ï¸",ageGroup:"family"},{id:"money-saving",name:{en:"Saving Money",de:"Geld sparen",fr:"Ã‰conomiser de l'argent"},emoji:"ðŸ’°",ageGroup:"preteen"},{id:"spending-wisely",name:{en:"Spending Wisely",de:"Klug ausgeben",fr:"DÃ©penser intelligemment"},emoji:"ðŸ›’",ageGroup:"preteen"},{id:"screen-time",name:{en:"Screen Time Balance",de:"Bildschirmzeit-Balance",fr:"Ã‰quilibre du temps d'Ã©cran"},emoji:"ðŸ“±",ageGroup:"preteen"},{id:"peer-pressure",name:{en:"Peer Pressure",de:"Gruppenzwang",fr:"Pression des pairs"},emoji:"ðŸ‘¥",ageGroup:"preteen"},{id:"body-changes",name:{en:"Body Changes",de:"KÃ¶rperliche VerÃ¤nderungen",fr:"Changements corporels"},emoji:"ðŸŒ±",ageGroup:"preteen"},{id:"responsibility",name:{en:"Taking Responsibility",de:"Verantwortung Ã¼bernehmen",fr:"Prendre ses responsabilitÃ©s"},emoji:"ðŸŽ¯",ageGroup:"preteen"},{id:"managing-time",name:{en:"Managing Time",de:"Zeitmanagement",fr:"Gestion du temps"},emoji:"â°",ageGroup:"preteen"},{id:"online-safety",name:{en:"Online Safety",de:"Sicherheit im Internet",fr:"SÃ©curitÃ© en ligne"},emoji:"ðŸ”’",ageGroup:"preteen"}],Sl=["going-to-bed","cleaning-up","first-kindergarten","first-school","losing-game","dealing-bully","telling-truth","spending-wisely","moving-house","screen-time"],Cl=[{id:"popular",name:{en:"Popular",de:"Beliebt",fr:"Populaires"},ageRange:"all"},{id:"family",name:{en:"Family Changes",de:"Familien-VerÃ¤nderungen",fr:"Changements familiaux"},ageRange:"all"},{id:"toddler",name:{en:"Toddler (2-4)",de:"Kleinkind (2-4)",fr:"Tout-petit (2-4)"},ageRange:"2-4"},{id:"preschool",name:{en:"Preschool (4-6)",de:"Vorschule (4-6)",fr:"PrÃ©scolaire (4-6)"},ageRange:"4-6"},{id:"early-school",name:{en:"Early School (6-9)",de:"Grundschule (6-9)",fr:"Ã‰cole primaire (6-9)"},ageRange:"6-9"},{id:"preteen",name:{en:"Pre-Teen (9-12)",de:"VorpubertÃ¤t (9-12)",fr:"PrÃ©adolescent (9-12)"},ageRange:"9-12"}],xa=[{id:"alphabet",name:{en:"The Alphabet (ABC)",de:"Das Alphabet (ABC)",fr:"L'Alphabet (ABC)"},emoji:"ðŸ”¤",group:"letters"},{id:"vowels",name:{en:"Vowels (A, E, I, O, U)",de:"Vokale (A, E, I, O, U)",fr:"Voyelles (A, E, I, O, U)"},emoji:"ðŸ…°ï¸",group:"letters"},{id:"rhyming",name:{en:"Rhyming Words",de:"ReimwÃ¶rter",fr:"Mots qui riment"},emoji:"ðŸŽµ",group:"letters"},{id:"numbers-1-10",name:{en:"Numbers 1-10",de:"Zahlen 1-10",fr:"Nombres 1-10"},emoji:"ðŸ”¢",group:"numbers"},{id:"numbers-1-20",name:{en:"Numbers 1-20",de:"Zahlen 1-20",fr:"Nombres 1-20"},emoji:"ðŸ”¢",group:"numbers"},{id:"counting",name:{en:"Learning to Count",de:"ZÃ¤hlen lernen",fr:"Apprendre Ã  compter"},emoji:"âœ‹",group:"numbers"},{id:"shapes",name:{en:"Shapes",de:"Formen",fr:"Formes"},emoji:"ðŸ”·",group:"numbers"},{id:"addition",name:{en:"Simple Addition",de:"Einfaches Addieren",fr:"Addition simple"},emoji:"âž•",group:"numbers"},{id:"colors-basic",name:{en:"Basic Colors",de:"Grundfarben",fr:"Couleurs de base"},emoji:"ðŸŒˆ",group:"colors"},{id:"colors-mixing",name:{en:"Mixing Colors",de:"Farben mischen",fr:"MÃ©langer les couleurs"},emoji:"ðŸŽ¨",group:"colors"},{id:"planets",name:{en:"Planets & Space",de:"Planeten & Weltraum",fr:"PlanÃ¨tes & Espace"},emoji:"ðŸª",group:"science"},{id:"seasons",name:{en:"The Four Seasons",de:"Die vier Jahreszeiten",fr:"Les quatre saisons"},emoji:"ðŸ‚",group:"science"},{id:"weather",name:{en:"Weather",de:"Wetter",fr:"MÃ©tÃ©o"},emoji:"â›…",group:"science"},{id:"water-cycle",name:{en:"Water Cycle",de:"Wasserkreislauf",fr:"Cycle de l'eau"},emoji:"ðŸ’§",group:"science"},{id:"plants-grow",name:{en:"How Plants Grow",de:"Wie Pflanzen wachsen",fr:"Comment poussent les plantes"},emoji:"ðŸŒ±",group:"science"},{id:"day-night",name:{en:"Day and Night",de:"Tag und Nacht",fr:"Jour et nuit"},emoji:"ðŸŒ™",group:"science"},{id:"farm-animals",name:{en:"Farm Animals",de:"Bauernhoftiere",fr:"Animaux de la ferme"},emoji:"ðŸ·",group:"animals"},{id:"wild-animals",name:{en:"Wild Animals",de:"Wilde Tiere",fr:"Animaux sauvages"},emoji:"ðŸ¦",group:"animals"},{id:"ocean-animals",name:{en:"Ocean Animals",de:"Meerestiere",fr:"Animaux marins"},emoji:"ðŸ‹",group:"animals"},{id:"insects",name:{en:"Insects & Bugs",de:"Insekten & KÃ¤fer",fr:"Insectes"},emoji:"ðŸ›",group:"animals"},{id:"dinosaurs",name:{en:"Dinosaurs",de:"Dinosaurier",fr:"Dinosaures"},emoji:"ðŸ¦•",group:"animals"},{id:"body-parts",name:{en:"Body Parts",de:"KÃ¶rperteile",fr:"Parties du corps"},emoji:"ðŸ«€",group:"body"},{id:"five-senses",name:{en:"The Five Senses",de:"Die fÃ¼nf Sinne",fr:"Les cinq sens"},emoji:"ðŸ‘ï¸",group:"body"},{id:"healthy-eating",name:{en:"Healthy Eating",de:"Gesund essen",fr:"Manger sainement"},emoji:"ðŸ¥—",group:"body"},{id:"days-week",name:{en:"Days of the Week",de:"Wochentage",fr:"Jours de la semaine"},emoji:"ðŸ“…",group:"time"},{id:"months-year",name:{en:"Months of the Year",de:"Monate des Jahres",fr:"Mois de l'annÃ©e"},emoji:"ðŸ—“ï¸",group:"time"},{id:"telling-time",name:{en:"Telling Time",de:"Uhr lesen",fr:"Lire l'heure"},emoji:"ðŸ•",group:"time"},{id:"continents",name:{en:"Continents",de:"Kontinente",fr:"Continents"},emoji:"ðŸŒ",group:"geography"},{id:"countries-flags",name:{en:"Countries & Flags",de:"LÃ¤nder & Flaggen",fr:"Pays & Drapeaux"},emoji:"ðŸ³ï¸",group:"geography"},{id:"instruments",name:{en:"Musical Instruments",de:"Musikinstrumente",fr:"Instruments de musique"},emoji:"ðŸŽ¸",group:"arts"},{id:"famous-artists",name:{en:"Famous Artists",de:"BerÃ¼hmte KÃ¼nstler",fr:"Artistes cÃ©lÃ¨bres"},emoji:"ðŸ–¼ï¸",group:"arts"}],kl=["alphabet","numbers-1-10","rhyming","seasons","weather","water-cycle","farm-animals","five-senses","days-week","months-year"],Al=[{id:"popular",name:{en:"Popular",de:"Beliebt",fr:"Populaires"}},{id:"letters",name:{en:"Letters & Reading",de:"Buchstaben & Lesen",fr:"Lettres & Lecture"}},{id:"numbers",name:{en:"Numbers & Math",de:"Zahlen & Mathe",fr:"Nombres & Maths"}},{id:"colors",name:{en:"Colors",de:"Farben",fr:"Couleurs"}},{id:"science",name:{en:"Nature & Science",de:"Natur & Wissenschaft",fr:"Nature & Science"}},{id:"animals",name:{en:"Animals",de:"Tiere",fr:"Animaux"}},{id:"body",name:{en:"Body & Health",de:"KÃ¶rper & Gesundheit",fr:"Corps & SantÃ©"}},{id:"time",name:{en:"Time & Calendar",de:"Zeit & Kalender",fr:"Temps & Calendrier"}},{id:"geography",name:{en:"World & Geography",de:"Welt & Geografie",fr:"Monde & GÃ©ographie"}},{id:"arts",name:{en:"Music & Art",de:"Musik & Kunst",fr:"Musique & Art"}}],Pl=["wilhelm-tell","gotthard-tunnel","moon-landing","columbus-voyage","wright-brothers","lindbergh-flight","galapagos-darwin","berlin-wall-fall","golden-gate"],Dl=[{id:"popular",name:{en:"Popular",de:"Beliebt",fr:"Populaires"},icon:"â­"},{id:"swiss",name:{en:"Swiss History",de:"Schweizer Geschichte",fr:"Histoire Suisse"},icon:"ðŸ‡¨ðŸ‡­"},{id:"exploration",name:{en:"Exploration & Discovery",de:"Entdeckungen",fr:"Exploration & DÃ©couverte"},icon:"ðŸ§­"},{id:"science",name:{en:"Science & Medicine",de:"Wissenschaft & Medizin",fr:"Science & MÃ©decine"},icon:"ðŸ”¬"},{id:"invention",name:{en:"Inventions",de:"Erfindungen",fr:"Inventions"},icon:"ðŸ’¡"},{id:"rights",name:{en:"Human Rights & Freedom",de:"Menschenrechte & Freiheit",fr:"Droits humains & LibertÃ©"},icon:"âœŠ"},{id:"construction",name:{en:"Great Constructions",de:"Grosse Bauwerke",fr:"Grandes Constructions"},icon:"ðŸ—ï¸"},{id:"culture",name:{en:"Culture & Arts",de:"Kultur & Kunst",fr:"Culture & Arts"},icon:"ðŸŽ­"},{id:"archaeology",name:{en:"Archaeological Discoveries",de:"ArchÃ¤ologische Entdeckungen",fr:"DÃ©couvertes ArchÃ©ologiques"},icon:"ðŸº"}],pa=[{id:"swiss-founding",name:{en:"Founding of Switzerland (RÃ¼tlischwur)",de:"GrÃ¼ndung der Schweiz (RÃ¼tlischwur)",fr:"Fondation de la Suisse (Serment du GrÃ¼tli)"},shortName:{en:"RÃ¼tlischwur",de:"RÃ¼tlischwur",fr:"Serment du GrÃ¼tli"},emoji:"ðŸ¤",year:1291,category:"swiss"},{id:"wilhelm-tell",name:{en:"Wilhelm Tell and the Apple",de:"Wilhelm Tell und der Apfel",fr:"Guillaume Tell et la pomme"},shortName:{en:"Wilhelm Tell",de:"Wilhelm Tell",fr:"Guillaume Tell"},emoji:"ðŸ¹",year:1307,category:"swiss",mainPerson:"Wilhelm Tell"},{id:"battle-morgarten",name:{en:"Battle of Morgarten",de:"Schlacht am Morgarten",fr:"Bataille de Morgarten"},shortName:{en:"Morgarten",de:"Morgarten",fr:"Morgarten"},emoji:"âš”ï¸",year:1315,category:"swiss"},{id:"battle-sempach",name:{en:"Battle of Sempach (Winkelried)",de:"Schlacht bei Sempach (Winkelried)",fr:"Bataille de Sempach (Winkelried)"},shortName:{en:"Sempach",de:"Sempach",fr:"Sempach"},emoji:"ðŸ›¡ï¸",year:1386,category:"swiss",mainPerson:"Arnold von Winkelried"},{id:"swiss-reformation",name:{en:"Swiss Reformation (Zwingli)",de:"Schweizer Reformation (Zwingli)",fr:"RÃ©forme Suisse (Zwingli)"},shortName:{en:"Reformation",de:"Reformation",fr:"RÃ©forme"},emoji:"ðŸ“œ",year:1523,category:"swiss",mainPerson:"Huldrych Zwingli"},{id:"red-cross-founding",name:{en:"Henry Dunant Founds the Red Cross",de:"Henry Dunant grÃ¼ndet das Rote Kreuz",fr:"Henry Dunant fonde la Croix-Rouge"},shortName:{en:"Red Cross",de:"Rotes Kreuz",fr:"Croix-Rouge"},emoji:"â¤ï¸",year:1863,category:"swiss",mainPerson:"Henry Dunant"},{id:"general-dufour",name:{en:"General Dufour and Swiss Unity",de:"General Dufour und die Schweizer Einheit",fr:"GÃ©nÃ©ral Dufour et l'unitÃ© suisse"},shortName:{en:"General Dufour",de:"General Dufour",fr:"GÃ©nÃ©ral Dufour"},emoji:"ðŸŽ–ï¸",year:1847,category:"swiss",mainPerson:"Guillaume-Henri Dufour"},{id:"sonderbund-war",name:{en:"The Sonderbund War",de:"Der Sonderbundskrieg",fr:"La Guerre du Sonderbund"},shortName:{en:"Sonderbund",de:"Sonderbund",fr:"Sonderbund"},emoji:"ðŸ”ï¸",year:1847,category:"swiss"},{id:"swiss-constitution",name:{en:"Swiss Federal Constitution",de:"Schweizerische Bundesverfassung",fr:"Constitution fÃ©dÃ©rale suisse"},shortName:{en:"Constitution",de:"Bundesverfassung",fr:"Constitution"},emoji:"ðŸ“‹",year:1848,category:"swiss"},{id:"gotthard-tunnel",name:{en:"Building the Gotthard Tunnel",de:"Bau des Gotthardtunnels",fr:"Construction du tunnel du Gothard"},shortName:{en:"Gotthard Tunnel",de:"Gotthardtunnel Bau",fr:"Tunnel du Gothard"},emoji:"ðŸš‚",year:1882,category:"swiss"},{id:"swiss-ww1-neutrality",name:{en:"Swiss Neutrality in WWI",de:"Schweizer NeutralitÃ¤t im 1. Weltkrieg",fr:"NeutralitÃ© suisse pendant la PremiÃ¨re Guerre"},shortName:{en:"WWI Neutrality",de:"NeutralitÃ¤t 1. WK",fr:"NeutralitÃ© 1GM"},emoji:"ðŸ•Šï¸",year:1914,category:"swiss"},{id:"general-guisan",name:{en:"General Guisan and the RÃ¼tli Report",de:"General Guisan und der RÃ¼tlirapport",fr:"GÃ©nÃ©ral Guisan et le Rapport du GrÃ¼tli"},shortName:{en:"General Guisan",de:"General Guisan",fr:"GÃ©nÃ©ral Guisan"},emoji:"ðŸŽ–ï¸",year:1940,category:"swiss",mainPerson:"Henri Guisan"},{id:"swiss-ww2-neutrality",name:{en:"Switzerland in World War II",de:"Die Schweiz im 2. Weltkrieg",fr:"La Suisse pendant la Seconde Guerre"},shortName:{en:"WWII",de:"2. Weltkrieg",fr:"2Ã¨me GM"},emoji:"ðŸ”ï¸",year:1939,category:"swiss"},{id:"swiss-womens-vote",name:{en:"Swiss Women Win the Vote",de:"Schweizer Frauenstimmrecht",fr:"Droit de vote des femmes suisses"},shortName:{en:"Women's Vote",de:"Frauenstimmrecht",fr:"Vote des femmes"},emoji:"ðŸ—³ï¸",year:1971,category:"swiss"},{id:"moon-landing",name:{en:"First Moon Landing",de:"Erste Mondlandung",fr:"Premier pas sur la Lune"},shortName:{en:"Moon Landing",de:"Mondlandung",fr:"Alunissage"},emoji:"ðŸŒ™",year:1969,category:"exploration",mainPerson:"Neil Armstrong"},{id:"columbus-voyage",name:{en:"Columbus Reaches the Americas",de:"Kolumbus erreicht Amerika",fr:"Colomb atteint les AmÃ©riques"},shortName:{en:"Discovery of America",de:"Entdeckung Amerikas",fr:"DÃ©couverte de l'AmÃ©rique"},emoji:"â›µ",year:1492,category:"exploration",mainPerson:"Christopher Columbus"},{id:"wright-brothers",name:{en:"First Powered Flight",de:"Erster Motorflug",fr:"Premier vol motorisÃ©"},shortName:{en:"First Flight",de:"Erster Flug",fr:"Premier vol"},emoji:"âœˆï¸",year:1903,category:"exploration",mainPerson:"Wright Brothers"},{id:"lindbergh-flight",name:{en:"First Solo Atlantic Crossing",de:"Erster Atlantik-Soloflug",fr:"PremiÃ¨re traversÃ©e solitaire"},shortName:{en:"Atlantic Flight",de:"Atlantikflug",fr:"Vol Atlantique"},emoji:"ðŸ›©ï¸",year:1927,category:"exploration",mainPerson:"Charles Lindbergh"},{id:"everest-summit",name:{en:"First Everest Summit",de:"Erste Everest-Besteigung",fr:"Premier sommet de l'Everest"},shortName:{en:"Climbing Everest",de:"Everest-Besteigung",fr:"Ascension Everest"},emoji:"ðŸ”ï¸",year:1953,category:"exploration",mainPerson:"Edmund Hillary & Tenzing Norgay"},{id:"south-pole",name:{en:"First to the South Pole",de:"Erster am SÃ¼dpol",fr:"Premier au PÃ´le Sud"},shortName:{en:"South Pole",de:"SÃ¼dpol",fr:"PÃ´le Sud"},emoji:"â„ï¸",year:1911,category:"exploration",mainPerson:"Roald Amundsen"},{id:"magellan-circumnavigation",name:{en:"First Circumnavigation",de:"Erste Weltumsegelung",fr:"Premier tour du monde"},shortName:{en:"Around the World",de:"Weltumsegelung",fr:"Tour du monde"},emoji:"ðŸŒ",year:1522,category:"exploration",mainPerson:"Ferdinand Magellan"},{id:"mariana-trench",name:{en:"Deepest Ocean Dive",de:"Tiefster Meerstauchgang",fr:"PlongÃ©e la plus profonde"},shortName:{en:"Deep Sea Dive",de:"Tiefseetauchen",fr:"PlongÃ©e profonde"},emoji:"ðŸŒŠ",year:1960,category:"exploration",mainPerson:"Jacques Piccard"},{id:"electricity-discovery",name:{en:"Franklin's Kite Experiment",de:"Franklins Drachenexperiment",fr:"ExpÃ©rience du cerf-volant"},shortName:{en:"Electricity Discovery",de:"ElektrizitÃ¤t entdeckt",fr:"DÃ©couverte Ã©lectricitÃ©"},emoji:"âš¡",year:1752,category:"science",mainPerson:"Benjamin Franklin"},{id:"penicillin",name:{en:"Discovery of Penicillin",de:"Entdeckung des Penicillins",fr:"DÃ©couverte de la pÃ©nicilline"},shortName:{en:"Penicillin",de:"Penicillin",fr:"PÃ©nicilline"},emoji:"ðŸ’Š",year:1928,category:"science",mainPerson:"Alexander Fleming"},{id:"vaccine-discovery",name:{en:"First Vaccine",de:"Erste Impfung",fr:"Premier vaccin"},shortName:{en:"First Vaccine",de:"Erste Impfung",fr:"Premier vaccin"},emoji:"ðŸ’‰",year:1796,category:"science",mainPerson:"Edward Jenner"},{id:"dna-discovery",name:{en:"DNA Structure Discovered",de:"DNA-Struktur entdeckt",fr:"Structure ADN dÃ©couverte"},shortName:{en:"DNA Discovery",de:"DNA-Entdeckung",fr:"DÃ©couverte ADN"},emoji:"ðŸ§¬",year:1953,category:"science",mainPerson:"Watson & Crick"},{id:"dinosaur-discovery",name:{en:"First Dinosaur Named",de:"Erster Dinosaurier benannt",fr:"Premier dinosaure nommÃ©"},shortName:{en:"Dinosaur Discovery",de:"Dinosaurier-Entdeckung",fr:"DÃ©couverte dinosaure"},emoji:"ðŸ¦•",year:1824,category:"science",mainPerson:"William Buckland"},{id:"einstein-relativity",name:{en:"Einstein's Relativity",de:"Einsteins RelativitÃ¤tstheorie",fr:"RelativitÃ© d'Einstein"},shortName:{en:"Einstein's Theory",de:"Einsteins Theorie",fr:"ThÃ©orie d'Einstein"},emoji:"ðŸ§ ",year:1905,category:"science",mainPerson:"Albert Einstein"},{id:"galapagos-darwin",name:{en:"Darwin Visits GalÃ¡pagos",de:"Darwin auf GalÃ¡pagos",fr:"Darwin aux GalÃ¡pagos"},shortName:{en:"Darwin's Voyage",de:"Darwins Reise",fr:"Voyage de Darwin"},emoji:"ðŸ¢",year:1835,category:"science",mainPerson:"Charles Darwin"},{id:"first-heart-transplant",name:{en:"First Heart Transplant",de:"Erste Herztransplantation",fr:"PremiÃ¨re greffe cardiaque"},shortName:{en:"Heart Transplant",de:"Herztransplantation",fr:"Greffe cardiaque"},emoji:"â¤ï¸",year:1967,category:"science",mainPerson:"Christiaan Barnard"},{id:"human-genome",name:{en:"Human Genome Decoded",de:"Menschliches Genom entschlÃ¼sselt",fr:"GÃ©nome humain dÃ©codÃ©"},shortName:{en:"Genome Project",de:"Genom-Projekt",fr:"Projet GÃ©nome"},emoji:"ðŸ§ª",year:2003,category:"science"},{id:"hubble-launch",name:{en:"Hubble Telescope Launch",de:"Hubble-Teleskop Start",fr:"Lancement tÃ©lescope Hubble"},shortName:{en:"Hubble Telescope",de:"Hubble-Teleskop",fr:"TÃ©lescope Hubble"},emoji:"ðŸ”­",year:1990,category:"science"},{id:"telephone-invention",name:{en:"First Telephone Call",de:"Erster Telefonanruf",fr:"Premier appel tÃ©lÃ©phonique"},shortName:{en:"Telephone",de:"Telefon",fr:"TÃ©lÃ©phone"},emoji:"ðŸ“ž",year:1876,category:"invention",mainPerson:"Alexander Graham Bell"},{id:"light-bulb",name:{en:"Edison's Light Bulb",de:"Edisons GlÃ¼hbirne",fr:"Ampoule d'Edison"},shortName:{en:"Light Bulb",de:"GlÃ¼hbirne",fr:"Ampoule"},emoji:"ðŸ’¡",year:1879,category:"invention",mainPerson:"Thomas Edison"},{id:"printing-press",name:{en:"Gutenberg's Printing Press",de:"Gutenbergs Buchdruck",fr:"Presse de Gutenberg"},shortName:{en:"Printing Press",de:"Buchdruck",fr:"Imprimerie"},emoji:"ðŸ“–",year:1440,category:"invention",mainPerson:"Johannes Gutenberg"},{id:"internet-creation",name:{en:"Birth of the World Wide Web",de:"Geburt des World Wide Web",fr:"Naissance du Web"},shortName:{en:"The Web",de:"Das Internet",fr:"Le Web"},emoji:"ðŸŒ",year:1991,category:"invention",mainPerson:"Tim Berners-Lee"},{id:"emancipation",name:{en:"Abolition of Slavery",de:"Abschaffung der Sklaverei",fr:"Abolition de l'esclavage"},shortName:{en:"End of Slavery",de:"Ende der Sklaverei",fr:"Fin de l'esclavage"},emoji:"â›“ï¸",year:1865,category:"rights",mainPerson:"Abraham Lincoln"},{id:"womens-suffrage",name:{en:"Women Win the Vote",de:"Frauenwahlrecht",fr:"Droit de vote des femmes"},shortName:{en:"Women's Vote",de:"Frauenwahlrecht",fr:"Vote des femmes"},emoji:"ðŸ—³ï¸",year:1920,category:"rights"},{id:"rosa-parks",name:{en:"Rosa Parks & Bus Boycott",de:"Rosa Parks & Busboykott",fr:"Rosa Parks & Boycott des bus"},shortName:{en:"Rosa Parks",de:"Rosa Parks",fr:"Rosa Parks"},emoji:"ðŸšŒ",year:1955,category:"rights",mainPerson:"Rosa Parks"},{id:"berlin-wall-fall",name:{en:"Fall of the Berlin Wall",de:"Fall der Berliner Mauer",fr:"Chute du mur de Berlin"},shortName:{en:"Berlin Wall Fall",de:"Fall der Berliner Mauer",fr:"Chute du Mur de Berlin"},emoji:"ðŸ§±",year:1989,category:"rights"},{id:"mandela-freedom",name:{en:"Mandela Released",de:"Mandela befreit",fr:"Mandela libÃ©rÃ©"},shortName:{en:"Mandela Free",de:"Mandela frei",fr:"Mandela libre"},emoji:"âœŠ",year:1990,category:"rights",mainPerson:"Nelson Mandela"},{id:"pyramids",name:{en:"Building the Great Pyramids",de:"Bau der Pyramiden",fr:"Construction des Pyramides"},shortName:{en:"The Pyramids",de:"Die Pyramiden",fr:"Les Pyramides"},emoji:"ðŸ”º",year:"-2560",category:"construction"},{id:"eiffel-tower",name:{en:"Eiffel Tower Opens",de:"Eiffelturm erÃ¶ffnet",fr:"Tour Eiffel inaugurÃ©e"},shortName:{en:"Eiffel Tower",de:"Eiffelturm",fr:"Tour Eiffel"},emoji:"ðŸ—¼",year:1889,category:"construction",mainPerson:"Gustave Eiffel"},{id:"panama-canal",name:{en:"Panama Canal Opens",de:"Panamakanal erÃ¶ffnet",fr:"Canal de Panama inaugurÃ©"},shortName:{en:"Panama Canal",de:"Panamakanal",fr:"Canal de Panama"},emoji:"ðŸš¢",year:1914,category:"construction"},{id:"golden-gate",name:{en:"Building the Golden Gate Bridge",de:"Bau der Golden Gate Bridge",fr:"Construction du pont Golden Gate"},shortName:{en:"Golden Gate Bridge",de:"Bau der Golden Gate Bridge",fr:"Pont Golden Gate"},emoji:"ðŸŒ‰",year:1937,category:"construction"},{id:"channel-tunnel",name:{en:"Channel Tunnel Opens",de:"Eurotunnel erÃ¶ffnet",fr:"Tunnel sous la Manche"},shortName:{en:"Chunnel",de:"Eurotunnel",fr:"Eurotunnel"},emoji:"ðŸš‡",year:1994,category:"construction"},{id:"first-olympics",name:{en:"First Modern Olympics",de:"Erste moderne Olympiade",fr:"Premiers Jeux Olympiques modernes"},shortName:{en:"Modern Olympics",de:"Moderne Olympiade",fr:"Jeux modernes"},emoji:"ðŸ…",year:1896,category:"culture"},{id:"disneyland-opening",name:{en:"Disneyland Opens",de:"Disneyland erÃ¶ffnet",fr:"Disneyland ouvre"},shortName:{en:"Disneyland",de:"Disneyland",fr:"Disneyland"},emoji:"ðŸ°",year:1955,category:"culture",mainPerson:"Walt Disney"},{id:"first-movie",name:{en:"Birth of Cinema",de:"Geburt des Kinos",fr:"Naissance du cinÃ©ma"},shortName:{en:"First Movies",de:"Erste Filme",fr:"Premiers films"},emoji:"ðŸŽ¬",year:1895,category:"culture",mainPerson:"LumiÃ¨re Brothers"},{id:"first-zoo",name:{en:"First Modern Zoo Opens",de:"Erster moderner Zoo",fr:"Premier zoo moderne"},shortName:{en:"London Zoo",de:"London Zoo",fr:"Zoo de Londres"},emoji:"ðŸ¦",year:1828,category:"culture"},{id:"natural-history-museum",name:{en:"Natural History Museum Opens",de:"Naturhistorisches Museum",fr:"MusÃ©e d'Histoire Naturelle"},shortName:{en:"Natural History Museum",de:"Naturkundemuseum",fr:"MusÃ©e Histoire Naturelle"},emoji:"ðŸ›ï¸",year:1881,category:"culture"},{id:"king-tut",name:{en:"King Tut's Tomb Discovered",de:"Tutanchamuns Grab entdeckt",fr:"Tombeau de ToutÃ¢nkhamon"},shortName:{en:"King Tut",de:"Tutanchamun",fr:"ToutÃ¢nkhamon"},emoji:"ðŸ‘‘",year:1922,category:"archaeology",mainPerson:"Howard Carter"},{id:"pompeii-discovery",name:{en:"Rediscovery of Pompeii",de:"Wiederentdeckung von Pompeji",fr:"RedÃ©couverte de PompÃ©i"},shortName:{en:"Pompeii",de:"Pompeji",fr:"PompÃ©i"},emoji:"ðŸŒ‹",year:1748,category:"archaeology"},{id:"terracotta-army",name:{en:"Terracotta Army Discovered",de:"Terrakotta-Armee entdeckt",fr:"ArmÃ©e de terre cuite"},shortName:{en:"Terracotta Army",de:"Terrakotta-Armee",fr:"ArmÃ©e terre cuite"},emoji:"ðŸ—¿",year:1974,category:"archaeology"}];function mn(t){return t==="popular"?Wr.filter(a=>wl.includes(a.id)):Wr.filter(a=>a.group===t)}function $l(t){return t==="popular"?ha.filter(a=>Sl.includes(a.id)):ha.filter(a=>a.ageGroup===t)}function Tl(t){return t==="popular"?xa.filter(a=>kl.includes(a.id)):xa.filter(a=>a.group===t)}function Fl(t){return t==="popular"?pa.filter(a=>Pl.includes(a.id)):pa.filter(a=>a.category===t)}function zl({storyCategory:t,storyTopic:a,storyTheme:n,customThemeText:p="",onCategoryChange:r,onTopicChange:f,onThemeChange:x,onCustomThemeTextChange:o,onLegacyStoryTypeChange:C}){var c,Te,O,pe,Be,me,de,K,Fe;const{language:$}=gt(),b=$,[v,B]=d.useState([]),[h,k]=d.useState([]),[L,R]=d.useState([]),[E,se]=d.useState([]),q={en:{storyType:"Story Type",theme:"Theme",topic:"Topic",setting:"Setting",optionalTheme:"Optional: Add an adventure theme",optionalThemeDesc:"Make it a pirate, wizard, or other adventure story",noTheme:"No theme (realistic)",selectedCategory:"Story type",selectedTopic:"Topic",selectedTheme:"Theme",change:"Change",customThemePlaceholder:`Describe your story idea in detail...

For example:
- A story about learning to ride a bike
- An adventure in the Swiss mountains
- Meeting a friendly dragon who helps with homework`,customThemeLabel:"Your custom theme:"},de:{storyType:"Geschichte",theme:"Thema",topic:"Thema",setting:"Setting",optionalTheme:"Optional: Abenteuer-Thema hinzufÃ¼gen",optionalThemeDesc:"Als Piraten-, Zauberer- oder andere Abenteuergeschichte",noTheme:"Kein Thema (realistisch)",selectedCategory:"Geschichtsart",selectedTopic:"Thema",selectedTheme:"Setting",change:"Ã„ndern",customThemePlaceholder:`Beschreibe deine Geschichte hier...

Zum Beispiel:
- Eine Geschichte Ã¼ber das Fahrradfahren lernen
- Ein Abenteuer in den Schweizer Bergen
- Ein freundlicher Drache, der bei den Hausaufgaben hilft`,customThemeLabel:"Dein eigenes Thema:"},fr:{storyType:"Histoire",theme:"ThÃ¨me",topic:"Sujet",setting:"Cadre",optionalTheme:"Optionnel: Ajouter un thÃ¨me d'aventure",optionalThemeDesc:"En faire une histoire de pirate, sorcier, etc.",noTheme:"Pas de thÃ¨me (rÃ©aliste)",selectedCategory:"Type d'histoire",selectedTopic:"Sujet",selectedTheme:"ThÃ¨me",change:"Changer",customThemePlaceholder:`DÃ©cris ton idÃ©e d'histoire ici...

Par exemple:
- Une histoire sur l'apprentissage du vÃ©lo
- Une aventure dans les montagnes suisses
- Un dragon amical qui aide aux devoirs`,customThemeLabel:"Ton thÃ¨me personnalisÃ©:"}},u=q[b]||q.en,z=T=>{B(X=>X.includes(T)?X.filter(Ae=>Ae!==T):[...X,T])},J=T=>{k(X=>X.includes(T)?X.filter(Ae=>Ae!==T):[...X,T])},_=T=>{R(X=>X.includes(T)?X.filter(Ae=>Ae!==T):[...X,T])},Y=T=>{se(X=>X.includes(T)?X.filter(Ae=>Ae!==T):[...X,T])};d.useEffect(()=>{t==="adventure"?B(["popular"]):t==="life-challenge"?k(["popular"]):t==="educational"?R(["popular"]):t==="historical"&&se(["popular"])},[t]);const I=T=>{r(T),f(""),T==="adventure"?x(""):T==="custom"?(x("custom"),C("custom")):x("realistic")},re=T=>{x(T),C(T)},fe=T=>{f(T),C(n==="realistic"?T:n)},xe=T=>{x(T),C(T==="realistic"?a||"adventure":T)},ae=T=>{const X=nr.find(Ae=>Ae.id===T);return X?X.name[b]||X.name.en:T},he=T=>{if(T==="realistic")return qr.name[b]||qr.name.en;const X=Wr.find(Ae=>Ae.id===T);return X?X.name[b]||X.name.en:T},Se=T=>{const X=ha.find(He=>He.id===T);if(X)return X.name[b]||X.name.en;const Ae=xa.find(He=>He.id===T);if(Ae)return Ae.name[b]||Ae.name.en;const be=pa.find(He=>He.id===T);return be?be.name[b]||be.name.en:T};if(!t)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Mt,{className:"text-indigo-600",size:24}),u.storyType]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4",children:nr.map(T=>e.jsxs("button",{onClick:()=>I(T.id),className:`p-3 md:p-6 rounded-xl border-2 transition-all ${T.id==="custom"?"border-dashed border-purple-300 hover:border-purple-500 hover:bg-purple-50":"border-gray-200 hover:border-indigo-400 hover:bg-indigo-50"}`,children:[e.jsxs("div",{className:"flex md:hidden items-center gap-3",children:[e.jsx("div",{className:"text-3xl flex-shrink-0",children:T.emoji}),e.jsx("div",{className:`flex-1 text-center font-bold text-lg ${T.id==="custom"?"text-purple-700":"text-gray-800"}`,children:T.name[b]||T.name.en})]}),e.jsxs("div",{className:"hidden md:block text-left",children:[e.jsx("div",{className:"text-4xl mb-3",children:T.emoji}),e.jsx("div",{className:`font-bold text-lg ${T.id==="custom"?"text-purple-700":"text-gray-800"}`,children:T.name[b]||T.name.en}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:T.description[b]||T.description.en})]})]},T.id))})]});if(t==="adventure"&&!n)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 px-2 py-1 rounded",children:[(c=nr.find(T=>T.id===t))==null?void 0:c.emoji," ",ae(t)]}),e.jsx("button",{onClick:()=>r(""),className:"text-indigo-600 hover:underline",children:u.change})]}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Mt,{className:"text-indigo-600",size:24}),u.theme]}),e.jsx("div",{className:"space-y-3",children:_n.filter(T=>T.id!=="custom").map(T=>{const X=mn(T.id),Ae=v.includes(T.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>z(T.id),className:"w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("span",{className:"font-semibold text-gray-700 flex items-center gap-2",children:[T.id==="popular"&&e.jsx("span",{children:"â­"}),T.name[b]||T.name.en]}),Ae?e.jsx(Nr,{size:20}):e.jsx(Ft,{size:20})]}),Ae&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 p-3",children:X.map(be=>e.jsxs("button",{onClick:()=>re(be.id),className:"p-2 rounded-lg border border-gray-200 hover:border-indigo-400 hover:bg-indigo-50 transition-all text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:be.emoji}),e.jsx("div",{className:"font-semibold text-xs",children:be.name[b]||be.name.en})]},be.id))})]},T.id)})})]});if(t==="life-challenge"&&!a)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 px-2 py-1 rounded",children:[(Te=nr.find(T=>T.id===t))==null?void 0:Te.emoji," ",ae(t)]}),e.jsx("button",{onClick:()=>r(""),className:"text-indigo-600 hover:underline",children:u.change})]}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Mt,{className:"text-indigo-600",size:24}),u.topic]}),e.jsx("div",{className:"space-y-3",children:Cl.map(T=>{const X=$l(T.id),Ae=h.includes(T.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>J(T.id),className:"w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("span",{className:"font-semibold text-gray-700 flex items-center gap-2",children:[T.id==="popular"&&e.jsx("span",{children:"â­"}),T.name[b]||T.name.en]}),Ae?e.jsx(Nr,{size:20}):e.jsx(Ft,{size:20})]}),Ae&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 p-3",children:X.map(be=>e.jsxs("button",{onClick:()=>fe(be.id),className:"p-2 rounded-lg border border-gray-200 hover:border-indigo-400 hover:bg-indigo-50 transition-all text-left",children:[e.jsx("span",{className:"text-xl mr-2",children:be.emoji}),e.jsx("span",{className:"text-sm font-medium",children:be.name[b]||be.name.en})]},be.id))})]},T.id)})})]});if(t==="educational"&&!a)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 px-2 py-1 rounded",children:[(O=nr.find(T=>T.id===t))==null?void 0:O.emoji," ",ae(t)]}),e.jsx("button",{onClick:()=>r(""),className:"text-indigo-600 hover:underline",children:u.change})]}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Mt,{className:"text-indigo-600",size:24}),u.topic]}),e.jsx("div",{className:"space-y-3",children:Al.map(T=>{const X=Tl(T.id),Ae=L.includes(T.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>_(T.id),className:"w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("span",{className:"font-semibold text-gray-700 flex items-center gap-2",children:[T.id==="popular"&&e.jsx("span",{children:"â­"}),T.name[b]||T.name.en]}),Ae?e.jsx(Nr,{size:20}):e.jsx(Ft,{size:20})]}),Ae&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 p-3",children:X.map(be=>e.jsxs("button",{onClick:()=>fe(be.id),className:"p-2 rounded-lg border border-gray-200 hover:border-indigo-400 hover:bg-indigo-50 transition-all text-left",children:[e.jsx("span",{className:"text-xl mr-2",children:be.emoji}),e.jsx("span",{className:"text-sm font-medium",children:be.name[b]||be.name.en})]},be.id))})]},T.id)})})]});if(t==="historical"&&!a)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 px-2 py-1 rounded",children:[(pe=nr.find(T=>T.id===t))==null?void 0:pe.emoji," ",ae(t)]}),e.jsx("button",{onClick:()=>r(""),className:"text-indigo-600 hover:underline",children:u.change})]}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Mt,{className:"text-indigo-600",size:24}),b==="de"?"Historisches Ereignis":b==="fr"?"Ã‰vÃ©nement Historique":"Historical Event"]}),e.jsx("div",{className:"space-y-3",children:Dl.map(T=>{const X=Fl(T.id),Ae=E.includes(T.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>Y(T.id),className:"w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("span",{className:"font-semibold text-gray-700 flex items-center gap-2",children:[T.id==="swiss"?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 32 32",className:"rounded-sm",children:[e.jsx("rect",{width:"32",height:"32",fill:"#FF0000"}),e.jsx("rect",{x:"13",y:"6",width:"6",height:"20",fill:"white"}),e.jsx("rect",{x:"6",y:"13",width:"20",height:"6",fill:"white"})]}):e.jsx("span",{children:T.icon}),T.name[b]||T.name.en]}),Ae?e.jsx(Nr,{size:20}):e.jsx(Ft,{size:20})]}),Ae&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 p-3",children:X.map(be=>e.jsx("button",{onClick:()=>fe(be.id),className:"p-3 rounded-lg border border-gray-200 hover:border-indigo-400 hover:bg-indigo-50 transition-all text-left",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:be.emoji}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:be.shortName[b]||be.shortName.en}),e.jsxs("div",{className:"text-xs text-gray-500",children:[typeof be.year=="string"&&be.year.startsWith("-")?`${be.year.slice(1)} BC`:be.year,be.mainPerson&&` â€¢ ${be.mainPerson}`]})]})]})},be.id))})]},T.id)})})]});if((t==="life-challenge"||t==="educational")&&a&&n==="realistic"){const T=mn("popular");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 px-2 py-1 rounded",children:[(Be=nr.find(X=>X.id===t))==null?void 0:Be.emoji," ",ae(t)]}),e.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded",children:Se(a)}),e.jsx("button",{onClick:()=>f(""),className:"text-indigo-600 hover:underline",children:u.change})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-1",children:u.optionalTheme}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:u.optionalThemeDesc}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 lg:grid-cols-6 gap-2 mb-4",children:[e.jsxs("button",{onClick:()=>xe("realistic"),className:`p-2 rounded-lg border-2 transition-all ${n==="realistic"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:qr.emoji}),e.jsx("div",{className:"font-semibold text-xs",children:u.noTheme})]}),T.map(X=>e.jsxs("button",{onClick:()=>xe(X.id),className:`p-2 rounded-lg border-2 transition-all ${n===X.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:X.emoji}),e.jsx("div",{className:"font-semibold text-xs",children:X.name[b]||X.name.en})]},X.id))]}),e.jsx("div",{className:"space-y-2 border-t border-amber-200 pt-3",children:_n.filter(X=>X.id!=="popular"&&X.id!=="custom").map(X=>{const Ae=mn(X.id),be=v.includes(X.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",children:[e.jsxs("button",{onClick:()=>z(X.id),className:"w-full flex items-center justify-between p-2 bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"font-medium text-sm text-gray-700",children:X.name[b]||X.name.en}),be?e.jsx(Nr,{size:16}):e.jsx(Ft,{size:16})]}),be&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 p-2",children:Ae.map(He=>e.jsxs("button",{onClick:()=>xe(He.id),className:`p-2 rounded-lg border-2 transition-all text-center ${n===He.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"text-xl mb-1",children:He.emoji}),e.jsx("div",{className:"font-semibold text-xs",children:He.name[b]||He.name.en})]},He.id))})]},X.id)})})]})]})}const ne=nr.find(T=>T.id===t);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Mt,{className:"text-indigo-600",size:24}),u.storyType]}),e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border border-indigo-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:ne==null?void 0:ne.emoji}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:u.selectedCategory}),e.jsx("div",{className:"font-semibold",children:ae(t)})]})]}),e.jsx("button",{onClick:()=>r(""),className:"text-indigo-600 hover:underline text-sm",children:u.change})]}),a&&e.jsxs("div",{className:"flex items-center justify-between border-t border-indigo-100 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:((me=ha.find(T=>T.id===a))==null?void 0:me.emoji)||((de=xa.find(T=>T.id===a))==null?void 0:de.emoji)||((K=pa.find(T=>T.id===a))==null?void 0:K.emoji)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:u.selectedTopic}),e.jsx("div",{className:"font-semibold",children:Se(a)})]})]}),e.jsx("button",{onClick:()=>f(""),className:"text-indigo-600 hover:underline text-sm",children:u.change})]}),t!=="historical"&&t!=="custom"&&e.jsxs("div",{className:"flex items-center justify-between border-t border-indigo-100 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:n==="realistic"?qr.emoji:(Fe=Wr.find(T=>T.id===n))==null?void 0:Fe.emoji}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:u.selectedTheme}),e.jsx("div",{className:"font-semibold",children:he(n)})]})]}),e.jsx("button",{onClick:()=>{x(t==="adventure"?"":"realistic")},className:"text-indigo-600 hover:underline text-sm",children:u.change})]}),n==="custom"&&e.jsx("div",{className:"pt-3",children:e.jsx("textarea",{value:p,onChange:T=>o==null?void 0:o(T.target.value),placeholder:u.customThemePlaceholder,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-base resize-none",rows:6})})]})]})}const ti=[{id:"watercolor",name:{en:"Watercolor",de:"Aquarell",fr:"Aquarelle"},emoji:"ðŸŽ¨",image:"/images/water color style.jpg",description:{en:"Soft watercolor painting with flowing colors",de:"Sanfte Aquarellmalerei mit fliessenden Farben",fr:"Peinture aquarelle douce aux couleurs fluides"},prompt:"Traditional watercolor painting, textured paper, delicate color washes (wet-on-wet technique), soft edges, visible artistic brushstrokes, transparent and flowing colors"},{id:"concept",name:{en:"Concept Art",de:"Konzeptkunst",fr:"Art conceptuel"},emoji:"âœ¨",image:"/images/concept art style.jpg",description:{en:"Professional digital concept art",de:"Professionelle digitale Konzeptkunst",fr:"Art conceptuel numÃ©rique professionnel"},prompt:"Highly detailed digital concept art, dramatic lighting, epic composition, smooth rendering, focus on mood and atmosphere, wide-angle lens, matte painting aesthetic"},{id:"anime",name:{en:"Anime",de:"Anime",fr:"Anime"},emoji:"â­",image:"/images/anime style.jpg",description:{en:"Japanese anime style with expressive features",de:"Japanischer Anime-Stil mit ausdrucksstarken Features",fr:"Style anime japonais aux traits expressifs"},prompt:"Modern digital anime art, high detail, expressive large eyes, dynamic composition, detailed cel-shading, vibrant palette, style of Makoto Shinkai"},{id:"pixar",name:{en:"Pixar 3D",de:"Pixar 3D",fr:"Pixar 3D"},emoji:"ðŸŽ¬",image:"/images/pixar art style 2.jpg",description:{en:"Vibrant, warm Disney/Pixar style 3D animation",de:"Lebendige, warme Disney/Pixar 3D-Animation",fr:"Animation 3D Disney/Pixar vibrante et chaleureuse"},prompt:"3D render, Pixar cinematic style, natural eye proportion, subtle expression, highly detailed textures, octane render, volumetric lighting, vibrant colors, smooth shading, family-friendly"},{id:"cartoon",name:{en:"Cartoon",de:"Cartoon",fr:"Dessin animÃ©"},emoji:"ðŸŽ¨",image:"/images/cartoon style.jpg",description:{en:"Classic 2D cartoon style with bold colors",de:"Klassischer 2D-Cartoon-Stil mit krÃ¤ftigen Farben",fr:"Style cartoon 2D classique aux couleurs vives"},prompt:"2D cartoon style, bold black outlines, vibrant flat colors (minimal shading/cel-shading), smooth vector quality, classic Saturday morning animation aesthetic"},{id:"comic",name:{en:"Comic Book",de:"Comic",fr:"Bande dessinÃ©e"},emoji:"ðŸ’¥",image:"/images/comic book style.jpg",description:{en:"Comic book style with bold lines and halftone",de:"Comic-Stil mit krÃ¤ftigen Linien und Raster",fr:"Style bande dessinÃ©e avec lignes Ã©paisses et trames"},prompt:"Classic American comic book art, heavy black ink lines, dynamic composition, visible halftone/Ben-Day dots, vibrant CMYK colors, style of Jack Kirby/Jim Lee"},{id:"oil",name:{en:"Oil Painting",de:"Ã–lgemÃ¤lde",fr:"Peinture Ã  l'huile"},emoji:"ðŸ–¼ï¸",image:"/images/oil painting style.jpg",description:{en:"Classic oil painting with rich textures",de:"Klassisches Ã–lgemÃ¤lde mit reichen Texturen",fr:"Peinture Ã  l'huile classique aux textures riches"},prompt:"Classic oil painting style, visible impasto brushstrokes, rich texture, heavy pigment, chiaroscuro lighting, canvas texture, museum quality art"},{id:"steampunk",name:{en:"Steampunk",de:"Steampunk",fr:"Steampunk"},emoji:"âš™ï¸",image:"/images/steampunk style.jpg",description:{en:"Victorian-era inspired with gears and brass",de:"Von der viktorianischen Ã„ra inspiriert mit ZahnrÃ¤dern und Messing",fr:"InspirÃ© de l'Ã¨re victorienne avec engrenages et laiton"},prompt:"Steampunk graphic novel illustration, Victorian aesthetic, intricate gears, brass and copper mechanisms, leather textures, sepia/muted color palette, detailed linework"},{id:"cyber",name:{en:"Cyberpunk",de:"Cyberpunk",fr:"Cyberpunk"},emoji:"ðŸŒƒ",image:"/images/cyber punk style.jpg",description:{en:"Dark futuristic cyberpunk aesthetic",de:"Dunkle futuristische Cyberpunk-Ã„sthetik",fr:"EsthÃ©tique cyberpunk futuriste sombre"},prompt:"Cyberpunk aesthetic, neon reflections, rainy streets, chrome, dense complexity, high contrast, dark atmosphere, volumetric fog, graphic novel illustration"},{id:"chibi",name:{en:"Chibi",de:"Chibi",fr:"Chibi"},emoji:"ðŸŒ¸",image:"/images/chibi style.jpg",description:{en:"Cute chibi style with big heads and small bodies",de:"Niedlicher Chibi-Stil mit grossen KÃ¶pfen und kleinen KÃ¶rpern",fr:"Style chibi mignon avec grandes tÃªtes et petits corps"},prompt:"Chibi style, super deformed (SD) proportions, massive head, tiny body, kawaii aesthetic, adorable, smooth illustration, minimalist detail"},{id:"manga",name:{en:"Manga",de:"Manga",fr:"Manga"},emoji:"ðŸ“š",image:"/images/manga style.jpg",description:{en:"Japanese manga style, black and white with screentones",de:"Japanischer Manga-Stil, schwarz-weiss mit Rastern",fr:"Style manga japonais, noir et blanc avec trames"},prompt:"Traditional manga style, Japanese comic art, intricate detailed linework, black and white/monochrome, atmospheric screentones, dramatic lighting and composition"},{id:"pixel",name:{en:"Pixel Art",de:"Pixelkunst",fr:"Pixel art"},emoji:"ðŸ‘¾",image:"/images/pixel style.jpg",description:{en:"Retro 16-bit pixel art style",de:"Retro 16-Bit Pixelkunst-Stil",fr:"Style pixel art rÃ©tro 16 bits"},prompt:"16-bit pixel art style, low resolution, limited color palette, detailed sprite work, retro video game aesthetic, style of Final Fantasy VI"},{id:"lowpoly",name:{en:"Low Poly",de:"Low Poly",fr:"Low Poly"},emoji:"ðŸ”·",image:"/images/low poly 3-D style.jpg",description:{en:"Minimalist geometric 3D style",de:"Minimalistischer geometrischer 3D-Stil",fr:"Style 3D gÃ©omÃ©trique minimaliste"},prompt:"Low poly 3D model, isometric perspective, minimalist geometric shapes, vibrant solid colors, clear edges, retro video game aesthetic, style of Monument Valley"}];function Il({selectedStyle:t,onSelect:a}){const{language:n}=gt();return e.jsx("div",{id:"art-style-section",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 lg:grid-cols-7 gap-2",children:ti.map(p=>e.jsxs("button",{onClick:()=>a(p.id),className:`rounded-lg border-2 transition-all overflow-hidden flex flex-col bg-white ${t===p.id?"border-indigo-600 shadow-lg ring-2 ring-indigo-200":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"relative w-full h-32 overflow-hidden",children:e.jsx("img",{src:p.image,alt:p.name[n],className:"w-full h-full object-contain"})}),e.jsx("div",{className:"p-1.5 flex flex-col items-center text-center",children:e.jsx("div",{className:"font-bold text-xs text-gray-800",children:p.name[n]})})]},p.id))})})}const an=[{value:{en:"Best Friends with",de:"Beste Freunde mit",fr:"Meilleurs amis avec"},inverse:{en:"Best Friends with",de:"Beste Freunde mit",fr:"Meilleurs amis avec"}},{value:{en:"Friends with",de:"Freunde mit",fr:"Amis avec"},inverse:{en:"Friends with",de:"Freunde mit",fr:"Amis avec"}},{value:{en:"Married to",de:"Verheiratet mit",fr:"MariÃ©(e) Ã "},inverse:{en:"Married to",de:"Verheiratet mit",fr:"MariÃ©(e) Ã "}},{value:{en:"In a relationship with",de:"In einer Beziehung mit",fr:"En relation avec"},inverse:{en:"In a relationship with",de:"In einer Beziehung mit",fr:"En relation avec"}},{value:{en:"Older Sibling of",de:"Ã„lteres Geschwister von",fr:"FrÃ¨re/SÅ“ur aÃ®nÃ©(e) de"},inverse:{en:"Younger Sibling of",de:"JÃ¼ngeres Geschwister von",fr:"FrÃ¨re/SÅ“ur cadet(te) de"}},{value:{en:"Younger Sibling of",de:"JÃ¼ngeres Geschwister von",fr:"FrÃ¨re/SÅ“ur cadet(te) de"},inverse:{en:"Older Sibling of",de:"Ã„lteres Geschwister von",fr:"FrÃ¨re/SÅ“ur aÃ®nÃ©(e) de"}},{value:{en:"Parent of",de:"Elternteil von",fr:"Parent de"},inverse:{en:"Child of",de:"Kind von",fr:"Enfant de"}},{value:{en:"Child of",de:"Kind von",fr:"Enfant de"},inverse:{en:"Parent of",de:"Elternteil von",fr:"Parent de"}},{value:{en:"Rivals with",de:"Rivalen mit",fr:"Rivaux avec"},inverse:{en:"Rivals with",de:"Rivalen mit",fr:"Rivaux avec"}},{value:{en:"Neighbors with",de:"Nachbarn mit",fr:"Voisins avec"},inverse:{en:"Neighbors with",de:"Nachbarn mit",fr:"Voisins avec"}},{value:{en:"Not Known to",de:"Nicht bekannt mit",fr:"Pas connu de"},inverse:{en:"Not Known to",de:"Nicht bekannt mit",fr:"Pas connu de"}}];function si(t){const a=an.find(n=>n.value.en==="Not Known to");return a?a.value[t]:"Not Known to"}function bn(t){const a=an.find(n=>n.value.en==="Not Known to");return a?t===a.value.en||t===a.value.de||t===a.value.fr:!1}function ri(t,a,n=[]){for(const p of an)if(p.value[a]===t)return p.inverse[a];for(const p of n){if(p.forward===t)return p.inverse;if(p.inverse===t)return p.forward}return t}function Bl({characters:t,showSuccessMessage:a,mainCharacters:n=[],excludedCharacters:p=[],onCharacterRoleChange:r,onEdit:f,onDelete:x,onCreateAnother:o}){const{t:C,language:$}=gt(),[b,v]=d.useState(null),B=E=>p.includes(E)?"out":n.includes(E)?"main":"in",h={out:$==="de"?"Nicht dabei":$==="fr"?"Absent":"Out",in:$==="de"?"Dabei":$==="fr"?"PrÃ©sent":"In",main:$==="de"?"Hauptrolle":$==="fr"?"Principal":"Main"},k=E=>{v({id:E.id,name:E.name})},L=()=>{b&&(x(b.id),v(null))},R=()=>{v(null)};return t.length===0?null:e.jsxs("div",{className:"space-y-4",children:[a&&e.jsx("div",{className:"md:bg-green-50 md:border-2 md:border-green-400 md:rounded-xl p-4 animate-fade-in",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center",children:e.jsx(Vr,{size:20})}),e.jsx("h3",{className:"text-lg font-bold text-green-700",children:$==="de"?"Charakter erfolgreich erstellt!":$==="fr"?"Personnage cre avec succes!":"Character Created Successfully!"})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-2",children:[t.map(E=>{var Y,I,re,fe,xe,ae,he,Se;const se=B(E.id),q=se==="out",u=se==="in",z=se==="main",J=t.filter(ne=>!p.includes(ne.id)),_=!q&&J.length===1;return e.jsx("div",{className:`border rounded p-2 transition-all ${q?"border-dashed border-gray-300 bg-gray-50":z?"border-2 border-indigo-600 bg-indigo-50":"border-gray-200 bg-white"}`,children:e.jsxs("div",{className:"flex gap-3",children:[(((I=(Y=E.avatars)==null?void 0:Y.faceThumbnails)==null?void 0:I.standard)||((re=E.photos)==null?void 0:re.face)||((fe=E.photos)==null?void 0:fe.original))&&e.jsx("button",{onClick:()=>f(E),className:"flex-shrink-0 focus:outline-none focus:ring-2 focus:ring-indigo-400 rounded-full",title:C.editCharacter,children:e.jsx("img",{draggable:!1,src:((ae=(xe=E.avatars)==null?void 0:xe.faceThumbnails)==null?void 0:ae.standard)||((he=E.photos)==null?void 0:he.face)||((Se=E.photos)==null?void 0:Se.original),alt:E.name,className:`w-20 h-20 rounded-full object-cover object-top border-2 border-indigo-200 cursor-pointer hover:border-indigo-400 transition-colors ${q?"grayscale opacity-50":""}`})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-between",children:[e.jsxs("div",{className:`flex items-start justify-between gap-2 ${q?"opacity-50":""}`,children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h4",{className:"font-bold text-sm md:text-base truncate flex items-center gap-1",children:[E.name,z&&e.jsx(hn,{size:14,className:"text-indigo-600 fill-indigo-600 flex-shrink-0"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[E.gender==="male"?C.male:E.gender==="female"?C.female:C.other,","," ",E.age," ",$==="de"?"J":$==="fr"?"ans":"y"]})]}),e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>f(E),className:"bg-indigo-600 text-white p-1.5 rounded text-xs hover:bg-indigo-700",title:C.editCharacter,children:e.jsx(Oi,{size:14})}),e.jsx("button",{onClick:()=>k(E),className:"bg-red-500 text-white p-1.5 rounded text-xs hover:bg-red-600",title:C.deleteCharacter,children:e.jsx(Vi,{size:14})})]})]}),r&&e.jsxs("div",{className:"flex rounded overflow-hidden border border-gray-300 text-[10px] md:text-xs mt-1",children:[e.jsx("button",{onClick:()=>r(E.id,"out"),disabled:_,title:_?$==="de"?"Mindestens ein Charakter muss in der Geschichte sein":$==="fr"?"Au moins un personnage doit Ãªtre dans l'histoire":"At least one character must be in the story":void 0,className:`flex-1 px-1.5 py-1 font-medium transition-colors ${q?"bg-gray-500 text-white":_?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-600 hover:bg-gray-100"}`,children:h.out}),e.jsx("button",{onClick:()=>r(E.id,"in"),className:`flex-1 px-1.5 py-1 font-medium transition-colors border-l border-r border-gray-300 ${u?"bg-indigo-600 text-white":q?"bg-indigo-50 text-indigo-700 hover:bg-indigo-100":"bg-white text-gray-600 hover:bg-gray-100"}`,children:h.in}),e.jsxs("button",{onClick:()=>r(E.id,"main"),className:`flex-1 px-1.5 py-1 font-medium transition-colors flex items-center justify-center gap-0.5 ${z?"bg-indigo-600 text-white":q?"bg-indigo-50 text-indigo-700 hover:bg-indigo-100":"bg-white text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(hn,{size:10,className:z?"fill-white":""}),h.main]})]})]})]})},E.id)}),e.jsxs("button",{onClick:o,className:"border-2 border-dashed border-indigo-300 rounded p-4 flex flex-col items-center justify-center gap-2 hover:border-indigo-500 hover:bg-indigo-50 transition-colors min-h-[100px]",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx(Xa,{size:24,className:"text-indigo-600"})}),e.jsx("span",{className:"text-sm font-medium text-indigo-600",children:$==="de"?"Weiteren Charakter erstellen":$==="fr"?"CrÃ©er un autre personnage":"Create Another Character"})]})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"bg-red-100 text-red-600 rounded-full p-2",children:e.jsx(vn,{size:24})}),e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:$==="de"?"Charakter lÃ¶schen?":$==="fr"?"Supprimer le personnage?":"Delete Character?"})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:$==="de"?`MÃ¶chtest du "${b.name}" wirklich lÃ¶schen? Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.`:$==="fr"?`Voulez-vous vraiment supprimer "${b.name}"? Cette action est irrÃ©versible.`:`Are you sure you want to delete "${b.name}"? This action cannot be undone.`}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:R,className:"flex-1 px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:$==="de"?"Abbrechen":$==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:L,className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 font-medium",children:$==="de"?"LÃ¶schen":$==="fr"?"Supprimer":"Delete"})]})]})})]})}function Rr({label:t,traits:a,selectedTraits:n,onSelect:p,minRequired:r=0,allowCustom:f=!0,defaultExpanded:x=!1}){const{t:o,language:C}=gt(),[$,b]=d.useState(""),[v,B]=d.useState(x),[h,k]=d.useState([]),L=u=>{n.includes(u)?p(n.filter(z=>z!==u)):p([...n,u])},R=()=>{if($.trim()&&!n.includes($.trim())){const u=$.trim();k([...h,u]),p([...n,u]),b("")}},E=n.filter(u=>!a.includes(u)),se=[...new Set([...h,...E])],q=[...a,...se];return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>B(!v),className:"flex items-center gap-1 mb-2 group cursor-pointer text-left",children:[v?e.jsx(Ft,{size:18,className:"text-indigo-500"}):e.jsx(tn,{size:18,className:"text-gray-400 group-hover:text-indigo-500"}),e.jsx("span",{className:"text-lg font-semibold text-gray-800",children:t}),r>0&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-1",children:["(",o.selectAtLeast," ",r,")"]}),n.length>0&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-1",children:["- ",n.length," ",C==="de"?"gewÃ¤hlt":C==="fr"?"sÃ©lectionnÃ©":"selected"]})]}),!v&&n.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 ml-5",children:n.map(u=>e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-indigo-100 text-indigo-700 border border-indigo-200",children:u},u))}),!v&&n.length===0&&e.jsx("div",{className:"ml-5 text-sm text-gray-400 italic",children:C==="de"?"Klicken zum AuswÃ¤hlen...":C==="fr"?"Cliquer pour sÃ©lectionner...":"Click to select..."}),v&&e.jsxs("div",{className:"ml-5",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:q.map(u=>e.jsx("button",{onClick:()=>L(u),className:`px-3 py-1 rounded-full text-sm transition-colors ${n.includes(u)?"bg-indigo-500 text-white":"bg-gray-200 text-gray-800 hover:bg-gray-300"}`,children:u},u))}),f&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:$,onChange:u=>b(u.target.value),onKeyDown:u=>u.key==="Enter"&&R(),placeholder:C==="de"?"Eigene hinzufÃ¼gen...":C==="fr"?"Ajouter personnalisÃ©...":"Add custom...",className:"flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none"}),e.jsx("button",{onClick:R,disabled:!$.trim(),className:`flex-shrink-0 w-10 h-10 rounded-lg font-semibold flex items-center justify-center transition-colors ${$.trim()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:e.jsx(Xa,{size:18})})]})]})]})}function qn({character:t,allCharacters:a,relationships:n,relationshipTexts:p,onRelationshipChange:r,onRelationshipTextChange:f,customRelationships:x=[],onAddCustomRelationship:o}){var R,E,se,q;const{language:C}=gt(),$=C,b=a.filter(u=>u.id!==t.id);if(b.length===0)return null;const v=[...an,...x.map(u=>({value:{en:u.forward,de:u.forward,fr:u.forward},inverse:{en:u.inverse,de:u.inverse,fr:u.inverse}}))],B=(u,z,J)=>{if(J==="__CREATE_CUSTOM__"){const _=prompt(C==="de"?'Beziehung eingeben (z.B. "Onkel"):':C==="fr"?'Entrer la relation (ex. "oncle"):':'Enter relationship (e.g. "uncle"):');if(_&&_.trim()){const Y=prompt(C==="de"?`Was ist die umgekehrte Beziehung? (z.B. wenn "${_.trim()}" dann vielleicht "Neffe/Nichte"):`:C==="fr"?`Quelle est la relation inverse? (ex. si "${_.trim()}" alors peut-Ãªtre "neveu/niÃ¨ce"):`:`What is the inverse relationship? (e.g. if "${_.trim()}" then maybe "nephew/niece"):`);Y&&Y.trim()&&(o==null||o(_.trim(),Y.trim()),r(u,z,_.trim()))}}else r(u,z,J)},h=(u,z)=>u<z?`${u}-${z}`:`${z}-${u}`,k={relationships:C==="de"?"Beziehungen":C==="fr"?"Relations":"Relationships",detailsPlaceholder:C==="de"?"Details...":C==="fr"?"DÃ©tails...":"Details..."},L=((E=(R=t.avatars)==null?void 0:R.faceThumbnails)==null?void 0:E.standard)||((se=t.photos)==null?void 0:se.face)||((q=t.photos)==null?void 0:q.original);return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:k.relationships}),e.jsx("div",{className:"space-y-3",children:b.map(u=>{var ae,he,Se,ne;const z=`${t.id}-${u.id}`,J=`${u.id}-${t.id}`,_=n[z],Y=_&&!bn(_),I=_?ri(_,$,x):null,re=h(t.id,u.id),fe=p[re]||"",xe=((he=(ae=u.avatars)==null?void 0:ae.faceThumbnails)==null?void 0:he.standard)||((Se=u.photos)==null?void 0:Se.face)||((ne=u.photos)==null?void 0:ne.original);return e.jsx("div",{className:`rounded-lg p-3 md:p-4 w-full ${Y?"bg-blue-50 border-2 border-blue-300":"bg-white border-[3px] border-red-500"}`,children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4 w-full",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[L&&e.jsx("img",{draggable:!1,src:L,alt:t.name,className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold text-xs md:text-sm text-center max-w-[60px] sm:max-w-[80px] md:max-w-[100px] truncate",children:t.name})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsxs("select",{value:_||si($),onChange:c=>B(t.id,u.id,c.target.value),className:`w-full px-3 py-2 md:px-4 md:py-2.5 border rounded text-sm md:text-base font-medium text-center ${Y?"bg-blue-100 border-blue-400":"bg-white border-red-400 border-2"}`,children:[e.jsxs("option",{value:"__CREATE_CUSTOM__",children:["+ ",$==="de"?"Eigene":$==="fr"?"PersonnalisÃ©":"Custom"]}),v.map((c,Te)=>e.jsx("option",{value:c.value[$],children:c.value[$]},Te))]}),Y&&I&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Ki,{size:12,className:"text-blue-400"}),e.jsx("span",{children:u.name}),e.jsx("span",{className:"font-medium text-blue-600",children:I}),e.jsx("span",{children:t.name})]}),Y&&e.jsx("textarea",{value:fe,onChange:c=>{f(z,c.target.value),f(J,c.target.value)},placeholder:k.detailsPlaceholder,rows:2,className:"w-full px-3 py-2 md:px-4 md:py-3 border border-blue-300 rounded-lg text-sm md:text-base text-center bg-white resize-none focus:border-indigo-500 focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[xe&&e.jsx("img",{draggable:!1,src:xe,alt:u.name,className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold text-xs md:text-sm text-center max-w-[60px] sm:max-w-[80px] md:max-w-[100px] truncate",children:u.name})]})]})},u.id)})})]})}const El={en:["Cheerful","Kind","Caring","Funny","Forgiving","Protective","Loyal","Generous","Fair-minded","Honest","Confident","Brave","Trustworthy","Determined","Hardworking","Leader","Patient","Curious","Imaginative","Smart","Creative","Observant","Resourceful","Energetic","Fast","Strong","Adventurous"],de:["FrÃ¶hlich","Freundlich","Hilfsbereit","Lustig","Nachsichtig","BeschÃ¼tzend","Treu","GrosszÃ¼gig","Gerecht","Ehrlich","Selbstbewusst","Mutig","VertrauenswÃ¼rdig","Entschlossen","Fleissig","Leader","Geduldig","Neugierig","Fantasievoll","Klug","Kreativ","Aufmerksam","Einfallsreich","Energiegeladen","Schnell","Stark","Abenteuerlustig"],fr:["Joyeux","Gentil","AttentionnÃ©","DrÃ´le","Indulgent","Protecteur","Loyal","GÃ©nÃ©reux","Ã‰quitable","HonnÃªte","Confiant","Courageux","Digne de confiance","DÃ©terminÃ©","Travailleur","Leader","Patient","Curieux","Imaginatif","Intelligent","CrÃ©atif","Observateur","DÃ©brouillard","Ã‰nergique","Rapide","Fort","Aventureux"]},Ml={en:["Impatient","Distracted","Talkative","Whiny","Messy","Forgetful","Tattletale","Sore Loser","Stubborn","Lying","Bossy","Gullible","Jealous","Easily scared","Clingy","Quick-tempered","Selfish","Sneaky","Reckless","Shy","Clumsy","Lazy","Boastful","Indecisive","Perfectionist"],de:["Ungeduldig","Zerstreut","GesprÃ¤chig","Weinerlich","Unordentlich","Vergesslich","Petze","Schlechter Verlierer","Stur","LÃ¼gnerisch","Rechthaberisch","LeichtglÃ¤ubig","EifersÃ¼chtig","Ã„ngstlich","AnhÃ¤nglich","JÃ¤hzornig","Egoistisch","Hinterlistig","Leichtsinnig","SchÃ¼chtern","Tollpatschig","Faul","Prahlerisch","Unentschlossen","Perfektionist"],fr:["Impatient","Distrait","Bavard","Pleurnicheur","DÃ©sordonnÃ©","Oublieux","Rapporteur","Mauvais perdant","TÃªtu","Menteur","Autoritaire","CrÃ©dule","Jaloux","Facilement effrayÃ©","Collant","ColÃ©rique","Ã‰goÃ¯ste","Sournois","Imprudent","Timide","Maladroit","Paresseux","Vantard","IndÃ©cis","Perfectionniste"]},Ll={en:["Following rules","Controlling emotions","Sharing with others","Tests and grades","Making new friends","Speaking in public","Trying new things","Accepting and asking for help","Dealing with change","Standing up for oneself","Fear of the dark","Bad dreams and nightmares","Monsters, ghosts and things under the bed","Fear of being alone","Fear of getting lost","Doctors, dentists and shots","Fear of heights","Fear of spiders","Fear of loud noises"],de:["Regeln befolgen","GefÃ¼hle kontrollieren","Mit anderen teilen","PrÃ¼fungsangst","Neue Freunde finden","Vor anderen sprechen","Neues ausprobieren","Hilfe annehmen und darum bitten","Mit VerÃ¤nderungen umgehen","FÃ¼r sich einstehen","Angst vor der Dunkelheit","AlbtrÃ¤ume und schlechte TrÃ¤ume","Monster, Geister und Dinge unter dem Bett","Angst allein zu sein","Angst sich zu verlaufen","Ã„rzte, ZahnÃ¤rzte und Spritzen","HÃ¶henangst","Angst vor Spinnen","Angst vor lauten GerÃ¤uschen"],fr:["Suivre les rÃ¨gles","ContrÃ´ler ses Ã©motions","Partager avec les autres","Examens et notes","Se faire de nouveaux amis","Parler en public","Essayer de nouvelles choses","Accepter et demander de l'aide","GÃ©rer le changement","Se dÃ©fendre","Peur du noir","Cauchemars et mauvais rÃªves","Monstres, fantÃ´mes et choses sous le lit","Peur d'Ãªtre seul","Peur de se perdre","MÃ©decins, dentistes et piqÃ»res","Peur du vide","Peur des araignÃ©es","Peur des bruits forts"]},Vn=El,Wn=Ml,Kn=Ll,Rl=1440*60*1e3;function Ya(t){const a=`avatar_regen_${t}`,n=localStorage.getItem(a),p=Date.now();if(!n)return{canRegenerate:!0,waitSeconds:0,attempts:0};try{const{attempts:r,lastAttempt:f}=JSON.parse(n);if(p-f>Rl)return localStorage.removeItem(a),{canRegenerate:!0,waitSeconds:0,attempts:0};let x=0;r>=2&&r<4?x=30*1e3:r>=4&&r<6?x=60*1e3:r>=6&&r<8?x=120*1e3:r>=8&&r<10?x=300*1e3:r>=10&&(x=600*1e3);const o=p-f;return o>=x?{canRegenerate:!0,waitSeconds:0,attempts:r}:{canRegenerate:!1,waitSeconds:Math.ceil((x-o)/1e3),attempts:r}}catch{return{canRegenerate:!0,waitSeconds:0,attempts:0}}}function ai(t){const a=`avatar_regen_${t}`,n=localStorage.getItem(a),p=Date.now();let r=1;if(n)try{r=(JSON.parse(n).attempts||0)+1}catch{}localStorage.setItem(a,JSON.stringify({attempts:r,lastAttempt:p}))}function Gl(t){const[a,n]=d.useState(()=>Ya(t));d.useEffect(()=>{if(a.waitSeconds>0){const r=setInterval(()=>{n(Ya(t))},1e3);return()=>clearInterval(r)}},[a.waitSeconds,t]);const p=d.useCallback(()=>{ai(t),n(Ya(t))},[t]);return{...a,recordRegeneration:p}}const Hl=[{value:"infant",label:"Infant",labelDe:"SÃ¤ugling",labelFr:"Nourrisson"},{value:"toddler",label:"Toddler",labelDe:"Kleinkind",labelFr:"Bambin"},{value:"preschooler",label:"Preschooler",labelDe:"Vorschulkind",labelFr:"PrÃ©scolaire"},{value:"kindergartner",label:"Kindergartner",labelDe:"Kindergartenkind",labelFr:"Maternelle"},{value:"young-school-age",label:"Young School-Age",labelDe:"Junges Schulkind",labelFr:"Jeune Ã©colier"},{value:"school-age",label:"School-Age",labelDe:"Schulkind",labelFr:"Ã‰colier"},{value:"preteen",label:"Preteen",labelDe:"VorpubertÃ¤r",labelFr:"PrÃ©adolescent"},{value:"young-teen",label:"Young Teen",labelDe:"Junger Teen",labelFr:"Jeune ado"},{value:"teenager",label:"Teenager",labelDe:"Teenager",labelFr:"Adolescent"},{value:"young-adult",label:"Young Adult",labelDe:"Junger Erwachsener",labelFr:"Jeune adulte"},{value:"adult",label:"Adult",labelDe:"Erwachsener",labelFr:"Adulte"},{value:"middle-aged",label:"Middle-Aged",labelDe:"Mittleres Alter",labelFr:"Ã‚ge moyen"},{value:"senior",label:"Senior",labelDe:"Senior",labelFr:"Senior"},{value:"elderly",label:"Elderly",labelDe:"Hochbetagt",labelFr:"Ã‚gÃ©"}],Ol=[{value:"slim",label:"Slim",labelDe:"Schlank",labelFr:"Mince"},{value:"average",label:"Average",labelDe:"Durchschnitt",labelFr:"Moyen"},{value:"athletic",label:"Athletic",labelDe:"Athletisch",labelFr:"AthlÃ©tique"},{value:"stocky",label:"Stocky",labelDe:"StÃ¤mmig",labelFr:"Trapu"},{value:"petite",label:"Petite",labelDe:"Zierlich",labelFr:"Petit"},{value:"tall",label:"Tall",labelDe:"Gross",labelFr:"Grand"},{value:"heavy",label:"Heavy",labelDe:"KrÃ¤ftig",labelFr:"Corpulent"}],_l=[{value:"bald",label:"Bald",labelDe:"Glatze",labelFr:"Chauve"},{value:"balding",label:"Balding",labelDe:"Halbglatze",labelFr:"DÃ©garni"},{value:"thinning",label:"Thinning",labelDe:"DÃ¼nnes Haar",labelFr:"ClairsemÃ©"},{value:"buzz cut",label:"Buzz Cut",labelDe:"Sehr kurz",labelFr:"TrÃ¨s court"},{value:"cropped",label:"Cropped",labelDe:"Kurz",labelFr:"Court"},{value:"pixie",label:"Pixie",labelDe:"Pixie",labelFr:"Pixie"},{value:"ear-length",label:"Ear-Length",labelDe:"Ohrlang",labelFr:"Aux oreilles"},{value:"chin-length",label:"Chin-Length",labelDe:"Kinnlang",labelFr:"Au menton"},{value:"neck-length",label:"Neck-Length",labelDe:"Nackenlang",labelFr:"Au cou"},{value:"shoulder-length",label:"Shoulder-Length",labelDe:"Schulterlang",labelFr:"Aux Ã©paules"},{value:"armpit-length",label:"Armpit-Length",labelDe:"Achsellang",labelFr:"Aux aisselles"},{value:"mid-back",label:"Mid-Back",labelDe:"RÃ¼ckenmitte",labelFr:"Mi-dos"},{value:"waist-length",label:"Waist-Length",labelDe:"HÃ¼ftlang",labelFr:"Aux hanches"}],ql=[{value:"black",label:"Black",labelDe:"Schwarz",labelFr:"Noir"},{value:"dark brown",label:"Dark Brown",labelDe:"Dunkelbraun",labelFr:"Brun foncÃ©"},{value:"brown",label:"Brown",labelDe:"Braun",labelFr:"Brun"},{value:"light brown",label:"Light Brown",labelDe:"Hellbraun",labelFr:"ChÃ¢tain clair"},{value:"chestnut",label:"Chestnut",labelDe:"Kastanienbraun",labelFr:"ChÃ¢tain"},{value:"auburn",label:"Auburn",labelDe:"Rotbraun",labelFr:"Auburn"},{value:"red",label:"Red",labelDe:"Rot",labelFr:"Roux"},{value:"strawberry blonde",label:"Strawberry Blonde",labelDe:"Erdbeerblond",labelFr:"Blond vÃ©nitien"},{value:"dark blonde",label:"Dark Blonde",labelDe:"Dunkelblond",labelFr:"Blond foncÃ©"},{value:"blonde",label:"Blonde",labelDe:"Blond",labelFr:"Blond"},{value:"light blonde",label:"Light Blonde",labelDe:"Hellblond",labelFr:"Blond clair"},{value:"platinum blonde",label:"Platinum Blonde",labelDe:"Platinblond",labelFr:"Blond platine"},{value:"gray",label:"Gray",labelDe:"Grau",labelFr:"Gris"},{value:"silver",label:"Silver",labelDe:"Silber",labelFr:"ArgentÃ©"},{value:"white",label:"White",labelDe:"Weiss",labelFr:"Blanc"},{value:"salt and pepper",label:"Salt and Pepper",labelDe:"Graumeliert",labelFr:"Poivre et sel"}],Vl=[{value:"straight",label:"Straight",labelDe:"Glatt",labelFr:"Lisse"},{value:"wavy",label:"Wavy",labelDe:"Wellig",labelFr:"OndulÃ©"},{value:"curly",label:"Curly",labelDe:"Lockig",labelFr:"BouclÃ©"},{value:"coily",label:"Coily",labelDe:"Kraus",labelFr:"CrÃ©pu"},{value:"messy",label:"Messy",labelDe:"Zerzaust",labelFr:"Ã‰bouriffÃ©"},{value:"spiky",label:"Spiky",labelDe:"Stachelig",labelFr:"En pointes"},{value:"layered",label:"Layered",labelDe:"Gestuft",labelFr:"DÃ©gradÃ©"},{value:"slicked back",label:"Slicked Back",labelDe:"ZurÃ¼ckgekÃ¤mmt",labelFr:"PlaquÃ©"},{value:"loose",label:"Loose",labelDe:"Offen",labelFr:"LÃ¢che"},{value:"ponytail",label:"Ponytail",labelDe:"Pferdeschwanz",labelFr:"Queue de cheval"},{value:"braids",label:"Braids",labelDe:"ZÃ¶pfe",labelFr:"Tresses"},{value:"bun",label:"Bun",labelDe:"Dutt",labelFr:"Chignon"},{value:"pigtails",label:"Pigtails",labelDe:"ZÃ¶pfchen",labelFr:"Couettes"},{value:"bob",label:"Bob",labelDe:"Bob",labelFr:"CarrÃ©"},{value:"afro",label:"Afro",labelDe:"Afro",labelFr:"Afro"},{value:"mohawk",label:"Mohawk",labelDe:"Irokese",labelFr:"CrÃªte"},{value:"mullet",label:"Mullet",labelDe:"Vokuhila",labelFr:"Mulet"},{value:"undercut",label:"Undercut",labelDe:"Undercut",labelFr:"Undercut"},{value:"bangs",label:"Bangs",labelDe:"Pony",labelFr:"Frange"},{value:"side bangs",label:"Side Bangs",labelDe:"Seitenpony",labelFr:"Frange de cÃ´tÃ©"}],Wl=[{value:"none",label:"None",labelDe:"Keiner",labelFr:"Aucune"},{value:"clean-shaven",label:"Clean Shaven",labelDe:"Glatt rasiert",labelFr:"RasÃ© de prÃ¨s"},{value:"stubble",label:"Stubble",labelDe:"Stoppeln",labelFr:"Barbe de 3 jours"},{value:"mustache",label:"Mustache",labelDe:"Schnurrbart",labelFr:"Moustache"},{value:"goatee",label:"Goatee",labelDe:"Ziegenbart",labelFr:"Bouc"},{value:"short beard",label:"Short Beard",labelDe:"Kurzer Bart",labelFr:"Barbe courte"},{value:"full beard",label:"Full Beard",labelDe:"Vollbart",labelFr:"Barbe complÃ¨te"},{value:"long beard",label:"Long Beard",labelDe:"Langer Bart",labelFr:"Longue barbe"}];function un({label:t,value:a,placeholder:n,onChange:p,isChanged:r,isAiExtracted:f,isUserEdited:x,language:o}){const C=o==="de"?"Von dir bearbeitet - wird bei Neugenerierung beibehalten":o==="fr"?"ModifiÃ© par vous - sera conservÃ© lors de la rÃ©gÃ©nÃ©ration":"Edited by you - will be enforced on regeneration";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${f?"text-gray-400":"text-gray-600"}`,children:[t,":"]}),e.jsx("input",{type:"text",value:a,onChange:$=>p($.target.value),className:`flex-1 min-w-0 px-2 py-1 text-sm border rounded focus:outline-none focus:border-indigo-400 hover:border-gray-300 ${x?"border-blue-400 bg-blue-50 ring-1 ring-blue-200":r?"border-amber-400 bg-amber-50 text-amber-800":f?"border-gray-200 bg-gray-50 text-gray-500":"border-gray-200 bg-white"}`,placeholder:n}),x&&e.jsx("span",{className:"text-blue-500 text-xs cursor-help",title:C,children:"âœŽ"}),r&&!x&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed from previous photo",children:"â—"})]})}function Kl({character:t,language:a,updatePhysical:n,updateApparentAge:p,changedTraits:r,isAiExtracted:f}){var b,v,B,h,k,L,R,E,se,q;const x=f?"text-gray-400":"text-gray-600",o=u=>{var z;return((z=t.physicalTraitsSource)==null?void 0:z[u])==="user"},C=(u,z)=>`flex-1 min-w-0 px-2 py-1 text-sm border rounded focus:outline-none focus:border-indigo-400 hover:border-gray-300 ${z&&o(z)?"border-blue-400 bg-blue-50 ring-1 ring-blue-200":u?"border-amber-400 bg-amber-50":f?"border-gray-200 bg-gray-50 text-gray-500":"border-gray-200 bg-white"}`,$=({field:u})=>{if(!o(u))return null;const z=a==="de"?"Von dir bearbeitet - wird bei Neugenerierung beibehalten":a==="fr"?"ModifiÃ© par vous - sera conservÃ© lors de la rÃ©gÃ©nÃ©ration":"Edited by you - will be enforced on regeneration";return e.jsx("span",{className:"text-blue-500 text-xs cursor-help",title:z,children:"âœŽ"})};return e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1.5 text-xs",children:[e.jsx(un,{label:a==="de"?"Augenfarbe":a==="fr"?"Couleur des yeux":"Eye Color",value:((b=t.physical)==null?void 0:b.eyeColor)||"",placeholder:a==="de"?"z.B. blau":"e.g. blue",onChange:u=>n("eyeColor",u),isAiExtracted:f,isChanged:r==null?void 0:r.eyeColor,isUserEdited:o("eyeColor"),language:a}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${x}`,children:[a==="de"?"Visuelles Alter":a==="fr"?"Ã‚ge visuel":"Visual Age",":"]}),e.jsxs("select",{value:((v=t.physical)==null?void 0:v.apparentAge)||rn(t.age)||"",onChange:u=>p(u.target.value),className:C(r==null?void 0:r.apparentAge),children:[e.jsx("option",{value:"",children:"â€” Auto â€”"}),Hl.map(u=>e.jsx("option",{value:u.value,children:a==="de"?u.labelDe:a==="fr"?u.labelFr:u.label},u.value))]}),(r==null?void 0:r.apparentAge)&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"â—"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${x}`,children:[a==="de"?"Haarfarbe":a==="fr"?"Couleur":"Hair Color",":"]}),e.jsxs("select",{value:((B=t.physical)==null?void 0:B.hairColor)||"",onChange:u=>n("hairColor",u.target.value),className:C(r==null?void 0:r.hairColor,"hairColor"),children:[e.jsx("option",{value:"",children:a==="de"?"â€” WÃ¤hlen â€”":a==="fr"?"â€” Choisir â€”":"â€” Select â€”"}),ql.map(u=>e.jsx("option",{value:u.value,children:a==="de"?u.labelDe:a==="fr"?u.labelFr:u.label},u.value))]}),e.jsx($,{field:"hairColor"}),(r==null?void 0:r.hairColor)&&!o("hairColor")&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"â—"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${x}`,children:[a==="de"?"HaarlÃ¤nge":a==="fr"?"Longueur":"Hair Length",":"]}),e.jsxs("select",{value:((h=t.physical)==null?void 0:h.hairLength)||"",onChange:u=>n("hairLength",u.target.value),className:C(r==null?void 0:r.hairLength,"hairLength"),children:[e.jsx("option",{value:"",children:a==="de"?"â€” WÃ¤hlen â€”":a==="fr"?"â€” Choisir â€”":"â€” Select â€”"}),_l.map(u=>e.jsx("option",{value:u.value,children:a==="de"?u.labelDe:a==="fr"?u.labelFr:u.label},u.value))]}),e.jsx($,{field:"hairLength"}),(r==null?void 0:r.hairLength)&&!o("hairLength")&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"â—"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${x}`,children:[a==="de"?"Frisur":a==="fr"?"Coiffure":"Hair Style",":"]}),e.jsxs("select",{value:((k=t.physical)==null?void 0:k.hairStyle)||"",onChange:u=>n("hairStyle",u.target.value),className:C(r==null?void 0:r.hairStyle,"hairStyle"),children:[e.jsx("option",{value:"",children:a==="de"?"â€” WÃ¤hlen â€”":a==="fr"?"â€” Choisir â€”":"â€” Select â€”"}),Vl.map(u=>e.jsx("option",{value:u.value,children:a==="de"?u.labelDe:a==="fr"?u.labelFr:u.label},u.value))]}),e.jsx($,{field:"hairStyle"}),(r==null?void 0:r.hairStyle)&&!o("hairStyle")&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"â—"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${x}`,children:[a==="de"?"KÃ¶rperbau":a==="fr"?"Corpulence":"Build",":"]}),e.jsxs("select",{value:((L=t.physical)==null?void 0:L.build)||"",onChange:u=>n("build",u.target.value),className:C(r==null?void 0:r.build,"build"),children:[e.jsx("option",{value:"",children:a==="de"?"â€” WÃ¤hlen â€”":a==="fr"?"â€” Choisir â€”":"â€” Select â€”"}),Ol.map(u=>e.jsx("option",{value:u.value,children:a==="de"?u.labelDe:a==="fr"?u.labelFr:u.label},u.value))]}),e.jsx($,{field:"build"}),(r==null?void 0:r.build)&&!o("build")&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"â—"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${x}`,children:[a==="de"?"Hautton":a==="fr"?"Teint":"Skin Tone",":"]}),e.jsx("input",{type:"text",value:((R=t.physical)==null?void 0:R.skinTone)||"",placeholder:a==="de"?"z.B. hell, mittel":"e.g. fair, medium",onChange:u=>n("skinTone",u.target.value),className:`flex-1 min-w-0 px-2 py-1 text-sm border rounded focus:outline-none focus:border-indigo-400 hover:border-gray-300 ${o("skinTone")?"border-blue-400 bg-blue-50 ring-1 ring-blue-200":r!=null&&r.skinTone?"border-amber-400 bg-amber-50":f?"border-gray-200 bg-gray-50 text-gray-500":"border-gray-200 bg-white"}`}),e.jsx($,{field:"skinTone"}),(r==null?void 0:r.skinTone)&&!o("skinTone")&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"â—"})]}),t.gender!=="female"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${x}`,children:[a==="de"?"Bart":a==="fr"?"Barbe":"Facial Hair",":"]}),e.jsxs("select",{value:((E=t.physical)==null?void 0:E.facialHair)||"",onChange:u=>n("facialHair",u.target.value),className:C(r==null?void 0:r.facialHair,"facialHair"),children:[e.jsx("option",{value:"",children:a==="de"?"â€” WÃ¤hlen â€”":a==="fr"?"â€” Choisir â€”":"â€” Select â€”"}),Wl.map(u=>e.jsx("option",{value:u.value,children:a==="de"?u.labelDe:a==="fr"?u.labelFr:u.label},u.value))]}),e.jsx($,{field:"facialHair"}),(r==null?void 0:r.facialHair)&&!o("facialHair")&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"â—"})]}):e.jsx(un,{label:a==="de"?"Sonstiges":a==="fr"?"Autre":"Other",value:((se=t.physical)==null?void 0:se.other)||"",placeholder:a==="de"?"z.B. Brille":"e.g. glasses",onChange:u=>n("other",u),isAiExtracted:f,isChanged:r==null?void 0:r.other,isUserEdited:o("other"),language:a}),t.gender!=="female"&&e.jsx("div",{className:"col-span-2",children:e.jsx(un,{label:a==="de"?"Sonstiges":a==="fr"?"Autre":"Other",value:((q=t.physical)==null?void 0:q.other)||"",placeholder:a==="de"?"z.B. Brille":"e.g. glasses",onChange:u=>n("other",u),isAiExtracted:f,isChanged:r==null?void 0:r.other,isUserEdited:o("other"),language:a})})]})}function Un({character:t,allCharacters:a=[],onChange:n,onSave:p,onCancel:r,onPhotoChange:f,onSaveAndTryNewPhoto:x,onContinueToTraits:o,onContinueToCharacteristics:C,onContinueToRelationships:$,onContinueToAvatar:b,isNewCharacter:v=!1,onSaveAndGenerateAvatar:B,onSaveAndRegenerateWithTraits:h,onRegenerateAvatars:k,onRegenerateAvatarsWithTraits:L,isLoading:R,isAnalyzingPhoto:E,isGeneratingAvatar:se,isRegeneratingAvatars:q,isRegeneratingAvatarsWithTraits:u,step:z,developerMode:J,isImpersonating:_=!1,changedTraits:Y,photoAnalysisDebug:I,relationships:re={},relationshipTexts:fe={},onRelationshipChange:xe,onRelationshipTextChange:ae,customRelationships:he=[],onAddCustomRelationship:Se}){var A,De,ls,_s,zt,fs,St,dt,Zt,os,$s,tt,ds,bs,cs,Qt,wr,qs,Sr,Vs,or,ms,Ws,dr,Ks,ys,Us,vs,Js,ct,Yt,bt,cr,js,Ht,Ot,Ts,Ns,ws,mr,pt,yt,ot,_t,vt,Xt,jt,Zs,ft,Fs,es,zs,s,P,N,Q,g,ue,Ee,ut,qt,It,Ss,ts,Ne,Nt,ur,Is,ss,Bs,Cs,Es,Kr,Ms,fa,us,Ls,ba,Ur,ya,Jr,va,gr,ja,Cr,Na,kr,wa,Zr,Sa,hr,Ar,ks,Vt,Qs,Ca,Rs,Pr,gs,Gs,Ys,ka,Qr,Aa,Yr,Pa,Xr,Da,ea,$a,ta,Ta,sa,Fa,Xs,za,xr,Ia,Dr,Ba,$r,Ea,Tr,Ma,ra,La,pr,Fr,Bt,er,Wt,Ge,zr,Ir,fr,Ra,aa,Ga,na,Ha,ia,Oa;const{t:ne,language:c}=gt(),[Te,O]=d.useState(!1),[pe,Be]=d.useState(null),[me,de]=d.useState(!1),[K,Fe]=d.useState(!1),[T,X]=d.useState(!1),[Ae,be]=d.useState(null),[He,Rt]=d.useState(null),[Ut,Gt]=d.useState(null),[Os,i]=d.useState(!1);d.useEffect(()=>(me||T?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[me,T]);const Z=!!((De=(A=t.clothing)==null?void 0:A.structured)!=null&&De.upperBody||(_s=(ls=t.clothing)==null?void 0:ls.structured)!=null&&_s.lowerBody||(fs=(zt=t.clothing)==null?void 0:zt.structured)!=null&&fs.shoes||(dt=(St=t.clothing)==null?void 0:St.structured)!=null&&dt.fullBody),Pe=!!((Zt=t.avatars)!=null&&Zt.winter||(os=t.avatars)!=null&&os.standard||($s=t.avatars)!=null&&$s.summer),ye=w=>{var Me;const ie=(Me=w.target.files)==null?void 0:Me[0];ie&&(Z&&Pe?(be(ie),X(!0)):f(ie,!1)),w.target.value=""},Ye=w=>{Ae&&f(Ae,w),X(!1),be(null)},Ve=(w,ie)=>{n(w==="age"&&typeof ie=="string"?{...t,[w]:ie,ageCategory:rn(ie)}:{...t,[w]:ie})},$e=(w,ie)=>{n({...t,physical:{...t.physical,[w]:ie},physicalTraitsSource:{...t.physicalTraitsSource,[w]:"user"}})},rt=(w,ie)=>{n({...t,traits:{...t.traits,[w]:ie}})},{canRegenerate:Ie,waitSeconds:Pt,recordRegeneration:Ke}=Gl(t.id),is=()=>{Ie&&(Ke(),L==null||L())},Jt=async()=>{var Me,Le;const w=((Me=t.photos)==null?void 0:Me.body)||((Le=t.photos)==null?void 0:Le.original);if(!w)return;const ie=t.gender==="female"?"female":"male";i(!0),Rt(null),Gt(null);try{const ze=await Ze.generateAvatarOptions(w,ie);ze.success&&ze.options.length>0&&(Rt(ze.options),Gt(ze.options[0].id))}catch(ze){console.error("Failed to generate avatar options:",ze)}finally{i(!1)}},Ds=()=>{if(He&&Ut!==null){const w=He.find(ie=>ie.id===Ut);w&&(n({...t,avatars:{...t.avatars,standard:w.imageData,status:"complete",generatedAt:new Date().toISOString()}}),Rt(null),Gt(null))}},xt=t.name&&t.name.trim().length>=2&&t.gender&&t.age,Dt=t.name&&((tt=t.traits)==null?void 0:tt.strengths)&&t.traits.strengths.length>=3&&((ds=t.traits)==null?void 0:ds.flaws)&&t.traits.flaws.length>=2,Ce=Vn[c]||Vn.en,Oe=Wn[c]||Wn.en,lr=Kn[c]||Kn.en,mt=((cs=(bs=t.avatars)==null?void 0:bs.faceThumbnails)==null?void 0:cs.standard)||((Qt=t.photos)==null?void 0:Qt.face)||((wr=t.photos)==null?void 0:wr.original);if(z==="name")return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"flex-1 min-w-0 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[E?e.jsx("div",{className:"w-24 h-24 rounded-full bg-indigo-100 border-4 border-indigo-400 shadow-lg flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] text-indigo-600 font-medium",children:c==="de"?"Analysiere...":c==="fr"?"Analyse...":"Analyzing..."})]})}):mt?e.jsx("img",{draggable:!1,src:mt,alt:"Character",className:"w-24 h-24 rounded-full object-cover border-4 border-indigo-400 shadow-lg cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>Be(mt),title:c==="de"?"Klicken zum VergrÃ¶ssern":"Click to enlarge"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-200 border-4 border-gray-300 flex items-center justify-center",children:e.jsx(_r,{size:24,className:"text-gray-400"})}),e.jsxs("label",{className:"cursor-pointer bg-gray-200 text-gray-700 px-3 py-1.5 rounded-lg text-xs hover:bg-gray-300 flex items-center gap-1.5 font-semibold transition-colors",children:[e.jsx(_r,{size:12}),c==="de"?"Ã„ndern":c==="fr"?"Changer":"Change",e.jsx("input",{type:"file",accept:"image/*",onChange:ye,className:"hidden"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-semibold mb-1 text-gray-700",children:c==="de"?"Name":c==="fr"?"Nom":"Name"}),e.jsx("input",{type:"text",value:t.name,onChange:w=>Ve("name",w.target.value),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg text-lg focus:border-indigo-500 focus:outline-none",placeholder:ne.characterName,autoFocus:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[10px] font-semibold text-gray-600 mb-0.5",children:[ne.gender," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.gender||"",onChange:w=>Ve("gender",w.target.value),className:`w-full px-2 py-1.5 border rounded text-base focus:border-indigo-500 focus:outline-none ${t.gender?"border-gray-300":"border-red-300"}`,children:[e.jsx("option",{value:"",children:c==="de"?"â€” Bitte wÃ¤hlen â€”":c==="fr"?"â€” Veuillez choisir â€”":"â€” Please select â€”"}),e.jsx("option",{value:"male",children:ne.male}),e.jsx("option",{value:"female",children:ne.female}),e.jsx("option",{value:"other",children:ne.other})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[10px] font-semibold text-gray-600 mb-0.5",children:[ne.age," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:t.age,onChange:w=>Ve("age",w.target.value),className:`w-full px-2 py-1.5 border rounded text-base focus:border-indigo-500 focus:outline-none ${t.age?"border-gray-300":"border-red-300"}`,min:"1",max:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-600 mb-0.5",children:c==="de"?"GrÃ¶sse (cm)":c==="fr"?"Taille (cm)":"Height (cm)"}),e.jsx("input",{type:"number",value:((qs=t.physical)==null?void 0:qs.height)||"",onChange:w=>$e("height",w.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-base focus:border-indigo-500 focus:outline-none",placeholder:"170",min:"50",max:"250"})]})]})]})}),!xt&&((Sr=t.name)==null?void 0:Sr.trim().length)>=2&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:c==="de"?"Bitte Geschlecht und Alter eingeben":c==="fr"?"Veuillez entrer le sexe et l'Ã¢ge":"Please enter gender and age"}),e.jsxs("div",{className:"flex gap-3",children:[r&&e.jsx("button",{onClick:r,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:ne.cancel}),e.jsx(Ps,{onClick:o,disabled:!xt||R||E,loading:R,icon:Hr,className:r?"flex-1":"w-full",children:c==="de"?"Weiter":c==="fr"?"Suivant":"Next"})]})]});if(v&&z==="traits")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-gray-200",children:[mt&&e.jsx("img",{draggable:!1,src:mt,alt:t.name,className:"w-16 h-16 rounded-full object-cover border-2 border-indigo-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.gender==="male"?c==="de"?"MÃ¤nnlich":"Male":t.gender==="female"?c==="de"?"Weiblich":"Female":c==="de"?"Andere":"Other",", ",t.age," ",c==="de"?"Jahre":"years"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Rr,{label:ne.strengths,traits:Ce,selectedTraits:((Vs=t.traits)==null?void 0:Vs.strengths)||[],onSelect:w=>rt("strengths",w),minRequired:3,defaultExpanded:!0}),e.jsx(Rr,{label:c==="de"?"SchwÃ¤chen":c==="fr"?"DÃ©fauts":"Flaws",traits:Oe,selectedTraits:((or=t.traits)==null?void 0:or.flaws)||[],onSelect:w=>rt("flaws",w),minRequired:2,defaultExpanded:!0}),e.jsx(Rr,{label:c==="de"?"Konflikte / Herausforderungen":c==="fr"?"Conflits / DÃ©fis":"Conflicts / Challenges",traits:lr,selectedTraits:((ms=t.traits)==null?void 0:ms.challenges)||[],onSelect:w=>rt("challenges",w),defaultExpanded:!0})]}),e.jsxs("div",{className:"sticky bottom-0 left-0 right-0 bg-white pt-4 pb-2 -mx-4 px-4 md:relative md:mx-0 md:px-0 md:bg-transparent border-t border-gray-200 md:border-0 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] md:shadow-none",children:[!Dt&&e.jsx("p",{className:"text-sm text-red-500 text-center mb-3",children:ne.selectStrengthsFlaws}),e.jsxs("div",{className:"flex gap-3",children:[r&&e.jsx("button",{onClick:r,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:ne.cancel}),e.jsx(Ps,{onClick:C,disabled:!Dt||R,loading:R,icon:Hr,className:r?"flex-1":"w-full",children:c==="de"?"Weiter":c==="fr"?"Suivant":"Next"})]})]})]});if(v&&z==="characteristics")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-gray-200",children:[mt&&e.jsx("img",{draggable:!1,src:mt,alt:t.name,className:"w-16 h-16 rounded-full object-cover border-2 border-indigo-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.gender==="male"?c==="de"?"MÃ¤nnlich":"Male":t.gender==="female"?c==="de"?"Weiblich":"Female":c==="de"?"Andere":"Other",", ",t.age," ",c==="de"?"Jahre":"years"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold mb-2 text-gray-800",children:ne.specialDetails}),e.jsx("textarea",{value:((Ws=t.traits)==null?void 0:Ws.specialDetails)||"",onChange:w=>rt("specialDetails",w.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none",placeholder:ne.specialDetailsPlaceholder,rows:5}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:c==="de"?"FÃ¼ge hier besondere Details hinzu, die den Charakter einzigartig machen (optional).":c==="fr"?"Ajoutez ici des dÃ©tails spÃ©ciaux qui rendent le personnage unique (facultatif).":"Add any special details that make this character unique (optional)."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[r&&e.jsx("button",{onClick:r,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:ne.cancel}),e.jsx(Ps,{onClick:a.length>0?$:b,disabled:R,loading:R,icon:Hr,className:r?"flex-1":"w-full",children:c==="de"?"Weiter":c==="fr"?"Suivant":"Next"})]})]});if(v&&z==="relationships")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-gray-200",children:[mt&&e.jsx("img",{draggable:!1,src:mt,alt:t.name,className:"w-16 h-16 rounded-full object-cover border-2 border-indigo-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.gender==="male"?c==="de"?"MÃ¤nnlich":"Male":t.gender==="female"?c==="de"?"Weiblich":"Female":c==="de"?"Andere":"Other",", ",t.age," ",c==="de"?"Jahre":"years"]})]})]}),a.length>0&&xe&&ae?e.jsx(qn,{character:t,allCharacters:a,relationships:re,relationshipTexts:fe,onRelationshipChange:xe,onRelationshipTextChange:ae,customRelationships:he,onAddCustomRelationship:Se}):e.jsx("p",{className:"text-center text-gray-500 py-8",children:c==="de"?"Erstelle weitere Charaktere, um Beziehungen hinzuzufÃ¼gen.":c==="fr"?"CrÃ©ez d'autres personnages pour ajouter des relations.":"Create more characters to add relationships."}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[r&&e.jsx("button",{onClick:r,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:ne.cancel}),e.jsx(Ps,{onClick:b,disabled:R,loading:R,icon:Hr,className:r?"flex-1":"w-full",children:c==="de"?"Weiter":c==="fr"?"Suivant":"Next"})]})]});if(v&&z==="avatar"){const w=(dr=t.avatars)==null?void 0:dr.status,ie=((ys=(Ks=t.avatars)==null?void 0:Ks.faceThumbnails)==null?void 0:ys.standard)||((Us=t.avatars)==null?void 0:Us.standard)||((vs=t.avatars)==null?void 0:vs.winter)||((Js=t.avatars)==null?void 0:Js.summer),Me=!!ie||((ct=t.avatars)==null?void 0:ct.hasFullAvatars),Le=se||u||w==="generating",ze=w==="failed";return e.jsxs("div",{className:"space-y-6",children:[!Le&&e.jsx("div",{className:"text-center",children:e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:ze?c==="de"?"Erstellung fehlgeschlagen":c==="fr"?"Ã‰chec de la crÃ©ation":"Creation failed":c==="de"?`${t.name}`:c==="fr"?`${t.name}`:`${t.name}`})}),e.jsx("div",{className:"flex justify-center",children:Me?e.jsxs("div",{className:"relative",children:[e.jsx("img",{draggable:!1,src:ie,alt:`${t.name} avatar`,className:"w-64 h-80 object-contain rounded-lg bg-white shadow-lg border-2 border-indigo-200 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>Be(ie||null),title:c==="de"?"Klicken zum VergrÃ¶ssern":c==="fr"?"Cliquer pour agrandir":"Click to enlarge"}),Le&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 rounded-lg pointer-events-none",children:e.jsx("div",{className:"w-8 h-8 border-3 border-white border-t-transparent rounded-full animate-spin"})})]}):Le?e.jsxs("div",{className:"w-64 h-80 rounded-lg border-2 border-dashed border-indigo-300 bg-indigo-50 flex flex-col items-center justify-center p-4 text-center",children:[e.jsx("span",{className:"text-indigo-700 font-medium mb-2",children:c==="de"?`So wird ${t.name} in deiner Geschichte aussehen`:c==="fr"?`Voici comment ${t.name} apparaÃ®tra dans ton histoire`:`This is how ${t.name} will look in your story`}),e.jsx("div",{className:"w-10 h-10 border-3 border-indigo-500 border-t-transparent rounded-full animate-spin my-4"}),e.jsx("span",{className:"text-indigo-500 text-sm",children:c==="de"?"Du kannst warten oder direkt weiterfahren":c==="fr"?"Tu peux attendre ou continuer":"You can wait or continue"})]}):e.jsx("div",{className:"w-64 h-80 rounded-lg border-2 border-dashed border-gray-300 bg-gray-100 flex flex-col items-center justify-center",children:e.jsx("span",{className:"text-gray-400",children:ze?c==="de"?"Erstellung fehlgeschlagen":c==="fr"?"Ã‰chec de gÃ©nÃ©ration":"Creation failed":c==="de"?"Kein Bild":c==="fr"?"Pas d'image":"No image"})})}),e.jsxs("div",{className:"flex flex-col gap-3 max-w-md mx-auto",children:[Me&&!Le&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:p,disabled:R,className:"w-full px-6 py-4 text-lg font-bold bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-3 shadow-lg",children:[R?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Vr,{size:24}),c==="de"?"Weiter":c==="fr"?"Continuer":"Continue"]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:c==="de"?"Du kannst das Aussehen spÃ¤ter jederzeit anpassen":c==="fr"?"Tu peux modifier l'apparence plus tard":"You can modify the look later anytime"}),x&&e.jsxs("button",{onClick:x,className:"w-full px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(Wi,{size:16}),c==="de"?"Mit neuem Foto versuchen":c==="fr"?"Essayer avec une nouvelle photo":"Try with a new photo"]})]}),Le&&!ze&&e.jsxs("button",{onClick:p,disabled:R,className:"w-full px-6 py-4 text-base font-semibold bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[R?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Hr,{size:20}),c==="de"?"Weiter ohne zu warten":c==="fr"?"Continuer sans attendre":"Continue without waiting"]}),ze&&e.jsxs("button",{onClick:p,disabled:R,className:"w-full px-6 py-4 text-base font-semibold bg-gray-600 text-white rounded-xl hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[R?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(As,{size:20}),c==="de"?"Charakter trotzdem speichern":c==="fr"?"Enregistrer quand mÃªme":"Save character anyway"]})]}),e.jsx(fn,{src:pe,onClose:()=>Be(null)})]})}return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 lg:gap-6",children:[e.jsx("div",{className:"lg:w-60 flex-shrink-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex-shrink-0",children:E?e.jsx("div",{className:"w-14 h-14 rounded-full bg-indigo-100 border-2 border-indigo-400 flex items-center justify-center",children:e.jsx("div",{className:"w-5 h-5 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"})}):mt?e.jsx("img",{draggable:!1,src:mt,alt:t.name,className:"w-14 h-14 rounded-full object-cover border-2 border-indigo-400 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{var w;return Be(((w=t.avatars)==null?void 0:w.standard)||mt)},title:c==="de"?"Klicken zum VergrÃ¶ssern":"Click to enlarge"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-gray-200 border-2 border-gray-300 flex items-center justify-center",children:e.jsx(_r,{size:18,className:"text-gray-400"})})}),e.jsx("div",{className:"flex flex-col gap-1",children:K?e.jsx("input",{type:"text",value:t.name,onChange:w=>Ve("name",w.target.value),onBlur:()=>Fe(!1),onKeyDown:w=>{w.key==="Enter"&&Fe(!1),w.key==="Escape"&&Fe(!1)},className:"text-xl font-bold text-gray-800 border-b-2 border-indigo-500 bg-transparent focus:outline-none px-0 py-0",autoFocus:!0}):e.jsxs("h3",{className:"text-xl font-bold text-gray-800 cursor-pointer hover:text-indigo-600 flex items-center gap-1 group",onClick:()=>Fe(!0),title:c==="de"?"Klicken zum Bearbeiten":"Click to edit",children:[t.name,e.jsx(xs,{size:14,className:"text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]})})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-500 mb-0.5",children:ne.gender}),e.jsxs("select",{value:t.gender||"",onChange:w=>Ve("gender",w.target.value),className:"w-full px-1.5 py-1 border border-gray-300 rounded text-xs bg-white focus:border-indigo-500 focus:outline-none",children:[e.jsx("option",{value:"",children:c==="de"?"â€” Unbekannt â€”":c==="fr"?"â€” Inconnu â€”":"â€” Unknown â€”"}),e.jsx("option",{value:"male",children:ne.male}),e.jsx("option",{value:"female",children:ne.female}),e.jsx("option",{value:"other",children:ne.other})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-500 mb-0.5",children:ne.age}),e.jsx("input",{type:"number",value:t.age,onChange:w=>Ve("age",w.target.value),className:"w-full px-1.5 py-1 border border-gray-300 rounded text-xs focus:border-indigo-500 focus:outline-none",min:"1",max:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-500 mb-0.5",children:c==="de"?"GrÃ¶sse":c==="fr"?"Taille":"Height"}),e.jsx("input",{type:"number",value:((Yt=t.physical)==null?void 0:Yt.height)||"",onChange:w=>$e("height",w.target.value),className:"w-full px-1.5 py-1 border border-gray-300 rounded text-xs focus:border-indigo-500 focus:outline-none",placeholder:"cm",min:"50",max:"250"})]})]}),e.jsxs("div",{className:"flex flex-col items-center lg:items-start",children:[(()=>{var Le,ze,$t,Ct,Kt;const w=(Le=t.avatars)==null?void 0:Le.standard,ie=((ze=t.avatars)==null?void 0:ze.hasFullAvatars)&&!(($t=t.avatars)!=null&&$t.standard),Me=se||q||u||((Ct=t.avatars)==null?void 0:Ct.status)==="generating";return w?e.jsxs("div",{className:"relative",children:[e.jsx("img",{draggable:!1,src:w,alt:`${t.name} avatar`,className:`w-full max-w-[180px] lg:max-w-full aspect-[3/4] object-contain rounded-lg bg-white cursor-pointer hover:opacity-90 transition-opacity ${(Kt=t.avatars)!=null&&Kt.stale?"opacity-80":""}`,onClick:()=>O(!0),title:c==="de"?"Klicken zum VergrÃ¶ssern":"Click to enlarge"}),Me&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 rounded-lg",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}):e.jsx("div",{className:"w-full max-w-[180px] lg:max-w-full aspect-[3/4] rounded-lg border-2 border-dashed border-gray-300 bg-gray-100 flex flex-col items-center justify-center",children:Me||ie?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-indigo-600 font-medium px-2 text-center",children:c==="de"?ie?"LÃ¤dt...":"Wird erstellt...":ie?"Loading...":"Creating..."})]}):e.jsx("span",{className:"text-[10px] text-gray-400 text-center px-2",children:c==="de"?"Kein Bild":"No image"})})})(),Te&&(((bt=t.avatars)==null?void 0:bt.standard)||((js=(cr=t.avatars)==null?void 0:cr.faceThumbnails)==null?void 0:js.standard))&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75",onClick:()=>O(!1),children:[e.jsx("img",{draggable:!1,src:((Ht=t.avatars)==null?void 0:Ht.standard)||((Ts=(Ot=t.avatars)==null?void 0:Ot.faceThumbnails)==null?void 0:Ts.standard),alt:`${t.name} avatar`,className:"max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl",onClick:w=>w.stopPropagation()}),e.jsx("button",{className:"absolute top-4 right-4 text-white text-3xl hover:text-gray-300",onClick:()=>O(!1),children:"Ã—"})]}),e.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row gap-2 w-full",children:[e.jsxs("label",{className:"flex-1 px-4 py-3 text-sm font-medium bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center justify-center gap-2 cursor-pointer transition-colors",children:[e.jsx(_r,{size:16}),c==="de"?"Neues Foto":c==="fr"?"Nouvelle photo":"New Photo",e.jsx("input",{type:"file",accept:"image/*",onChange:ye,className:"hidden"})]}),e.jsxs("button",{onClick:()=>de(!0),className:"flex-1 px-4 py-3 text-sm font-medium bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center justify-center gap-2 transition-colors",children:[e.jsx(xs,{size:16}),c==="de"?"Anpassen":c==="fr"?"Modifier":"Modify"]})]}),e.jsxs("div",{className:"mt-1 space-y-1",children:[(J||_)&&e.jsxs("button",{onClick:is,disabled:!Ie||q||u||((Ns=t.avatars)==null?void 0:Ns.status)==="generating",className:"w-full px-2 py-1 text-[10px] font-medium bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1",title:Ie?void 0:`Wait ${Pt}s`,children:[e.jsx(ps,{size:10}),Ie?q||u?c==="de"?"Generiere...":"Generating...":c==="de"?"Neu generieren":"Regenerate":`${Pt}s`]}),(J||_)&&e.jsx("button",{onClick:Jt,disabled:Os||q||u||!((ws=t.photos)!=null&&ws.original),className:"w-full px-2 py-1 text-[10px] font-medium bg-purple-100 text-purple-700 rounded hover:bg-purple-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1",children:Os?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}),c==="de"?"Generiere 3...":"Generating 3..."]}):c==="de"?"3 Optionen generieren":"Generate 3 Options"})]}),(J||_)&&((pt=(mr=t.avatars)==null?void 0:mr.faceMatch)==null?void 0:pt.standard)&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsxs("summary",{className:`text-[10px] font-medium cursor-pointer ${t.avatars.faceMatch.standard.score>=6?"text-green-600":"text-red-600"}`,children:["Face eval: ",t.avatars.faceMatch.standard.score,"/10",t.avatars.faceMatch.standard.lpips&&e.jsxs("span",{className:`ml-2 ${t.avatars.faceMatch.standard.lpips.lpipsScore<.15?"text-green-600":t.avatars.faceMatch.standard.lpips.lpipsScore<.3?"text-yellow-600":"text-red-600"}`,children:["| LPIPS: ",(yt=t.avatars.faceMatch.standard.lpips.lpipsScore)==null?void 0:yt.toFixed(3)]}),t.avatars.faceMatch.standard.arcface&&e.jsxs("span",{className:`ml-2 ${t.avatars.faceMatch.standard.arcface.samePerson?"text-green-600":"text-red-600"}`,children:["| ID: ",((t.avatars.faceMatch.standard.arcface.similarity??0)*100).toFixed(0),"% (",t.avatars.faceMatch.standard.arcface.confidence,")"]})]}),e.jsxs("pre",{className:"mt-1 p-2 rounded text-[9px] whitespace-pre-wrap overflow-auto max-h-48 border bg-gray-100 border-gray-200",children:[t.avatars.faceMatch.standard.details,t.avatars.faceMatch.standard.lpips&&`

LPIPS Perceptual Similarity:
- Score: ${(ot=t.avatars.faceMatch.standard.lpips.lpipsScore)==null?void 0:ot.toFixed(4)}
- Interpretation: ${t.avatars.faceMatch.standard.lpips.interpretation}
- Note: 0 = identical, <0.15 = very similar, <0.30 = similar`,t.avatars.faceMatch.standard.arcface&&`

ArcFace Identity (style-invariant):
- Similarity: ${((t.avatars.faceMatch.standard.arcface.similarity??0)*100).toFixed(1)}%
- Same Person: ${t.avatars.faceMatch.standard.arcface.samePerson?"Yes":"No"}
- Confidence: ${t.avatars.faceMatch.standard.arcface.confidence}
- Note: Works photoâ†’anime, >60% = high confidence same person`]})]}),(J||_)&&((_t=t.avatars)==null?void 0:_t.clothing)&&Object.keys(t.avatars.clothing).length>0&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsxs("summary",{className:"text-[10px] font-medium cursor-pointer text-blue-600",children:["Clothing (",Object.keys(t.avatars.clothing).length," avatars)"]}),e.jsx("div",{className:"mt-1 p-2 rounded text-[9px] border bg-gray-100 border-gray-200 space-y-1",children:Object.entries(t.avatars.clothing).map(([w,ie])=>e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:[w,":"]})," ",ie]},w))})]}),(J||_)&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsx("summary",{className:"text-[10px] font-medium cursor-pointer text-purple-600",children:"Avatar Gen Input"}),e.jsx("div",{className:"mt-1 p-2 rounded text-[9px] border bg-purple-50 border-purple-200 space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold block mb-1",children:"Source Photo:"}),(vt=t.photos)!=null&&vt.face||(Xt=t.photos)!=null&&Xt.original?e.jsx("img",{draggable:!1,src:((jt=t.photos)==null?void 0:jt.face)||((Zs=t.photos)==null?void 0:Zs.original),alt:"Source",className:"w-16 h-16 object-cover rounded border"}):e.jsx("span",{className:"text-red-500",children:"No photo"}),e.jsx("span",{className:"block text-[8px] text-gray-500 mt-0.5",children:(ft=t.photos)!=null&&ft.face?"face crop":(Fs=t.photos)!=null&&Fs.original?"original":"none"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-semibold block mb-1",children:"User Trait Edits (sent to API):"}),(()=>{const w=t.physicalTraitsSource||{},ie=Object.entries(w).filter(([Me,Le])=>Le==="user").map(([Me])=>Me);return ie.length===0?e.jsx("span",{className:"text-gray-400",children:"None (using extracted)"}):e.jsx("ul",{className:"space-y-0.5",children:ie.map(Me=>{var Le;return e.jsxs("li",{className:"text-purple-700",children:[e.jsxs("span",{className:"font-medium",children:[Me,":"]})," ",((Le=t.physical)==null?void 0:Le[Me])||"?"]},Me)})})})()]})]})})]})]})]})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-4",children:[e.jsx(Rr,{label:ne.strengths,traits:Ce,selectedTraits:((es=t.traits)==null?void 0:es.strengths)||[],onSelect:w=>rt("strengths",w),minRequired:3}),e.jsx(Rr,{label:c==="de"?"SchwÃ¤chen":c==="fr"?"DÃ©fauts":"Flaws",traits:Oe,selectedTraits:((zs=t.traits)==null?void 0:zs.flaws)||[],onSelect:w=>rt("flaws",w),minRequired:2}),e.jsx(Rr,{label:c==="de"?"Konflikte / Herausforderungen":c==="fr"?"Conflits / DÃ©fis":"Conflicts / Challenges",traits:lr,selectedTraits:((s=t.traits)==null?void 0:s.challenges)||[],onSelect:w=>rt("challenges",w)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold mb-2 text-gray-800",children:ne.specialDetails}),e.jsx("textarea",{value:((P=t.traits)==null?void 0:P.specialDetails)||"",onChange:w=>rt("specialDetails",w.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none",placeholder:ne.specialDetailsPlaceholder,rows:3})]}),a.length>1&&xe&&ae&&e.jsx(qn,{character:t,allCharacters:a,relationships:re,relationshipTexts:fe,onRelationshipChange:xe,onRelationshipTextChange:ae,customRelationships:he,onAddCustomRelationship:Se})]})]}),(J||_)&&((N=t.photos)==null?void 0:N.bodyNoBg)&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-300 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-yellow-700 mb-2",children:["Body Crop (No Background) ",e.jsx("span",{className:"text-yellow-500 font-normal",children:"(click to download)"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{draggable:!1,src:t.photos.bodyNoBg,alt:`${t.name} body crop`,className:"max-h-48 object-contain rounded border border-gray-300 cursor-pointer hover:opacity-80 transition-opacity",style:{background:"repeating-conic-gradient(#ccc 0% 25%, #fff 0% 50%) 50% / 20px 20px"},onClick:()=>{const w=document.createElement("a");w.href=t.photos.bodyNoBg,w.download=`${t.name.replace(/\s+/g,"_")}_body_no_bg.png`,document.body.appendChild(w),w.click(),document.body.removeChild(w)},title:"Click to download"})})]}),(J||_)&&(I==null?void 0:I.rawResponse)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"text-xs font-semibold text-purple-700 cursor-pointer",children:["Raw Gemini Response (Photo Analysis)",I.error&&e.jsxs("span",{className:"text-red-500 ml-2",children:["âš ï¸ ",I.error]})]}),e.jsx("pre",{className:"mt-2 p-2 bg-white rounded text-[10px] whitespace-pre-wrap overflow-auto max-h-64 border border-purple-200 font-mono",children:I.rawResponse})]}),(J||_)&&e.jsxs("div",{className:"bg-teal-50 border border-teal-300 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-teal-700 mb-3 flex items-center gap-2",children:[c==="de"?"Kleidungs-Avatare":c==="fr"?"Avatars vestimentaires":"Clothing Avatars",((Q=t.avatars)==null?void 0:Q.status)==="generating"&&e.jsxs("span",{className:"text-xs font-normal text-teal-500 flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-teal-500 border-t-transparent rounded-full animate-spin"}),c==="de"?"Generierung lÃ¤uft...":"Generating..."]}),((g=t.avatars)==null?void 0:g.status)==="complete"&&!((ue=t.avatars)!=null&&ue.stale)&&e.jsx("span",{className:"text-xs font-normal text-green-600",children:c==="de"?"Fertig":c==="fr"?"TerminÃ©":"Complete"}),((Ee=t.avatars)==null?void 0:Ee.stale)&&e.jsxs("span",{className:"text-xs font-normal text-amber-600",children:["âš ï¸ ",c==="de"?"Von altem Foto":c==="fr"?"De l'ancienne photo":"From previous photo"]}),((ut=t.avatars)==null?void 0:ut.status)==="failed"&&e.jsx("span",{className:"text-xs font-normal text-red-600",children:c==="de"?"Fehlgeschlagen":c==="fr"?"Ã‰chouÃ©":"Failed"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:["winter","standard","summer"].map(w=>{var ie,Me,Le,ze,$t,Ct,Kt,kt,Tt,nt,br,tr,sr,Br,yr,Er,Mr,la;return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-600 mb-1 capitalize",children:[w==="winter"?"â„ï¸":w==="summer"?"â˜€ï¸":"ðŸ‘•",e.jsx("span",{className:"ml-0.5",children:c==="de"?w==="winter"?"Winter":w==="summer"?"Sommer":"Standard":w})]}),(ie=t.avatars)!=null&&ie[w]?e.jsxs("div",{className:"relative cursor-pointer group",onClick:()=>{var oa;return Be(((oa=t.avatars)==null?void 0:oa[w])||null)},title:c==="de"?"Klicken zum VergrÃ¶ssern":"Click to enlarge",children:[e.jsx("img",{draggable:!1,src:(Me=t.avatars)==null?void 0:Me[w],alt:`${t.name} - ${w}`,className:`w-full h-40 object-contain rounded border bg-white transition-all group-hover:shadow-lg group-hover:scale-[1.02] ${(Le=t.avatars)!=null&&Le.stale?"border-amber-400 opacity-75":"border-teal-200"}`}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-all rounded flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 group-hover:opacity-100 text-lg",children:"ðŸ”"})}),((ze=t.avatars)==null?void 0:ze.stale)&&e.jsx("div",{className:"absolute top-1 right-1 bg-amber-500 text-white text-[8px] px-1 py-0.5 rounded",children:c==="de"?"Alt":"Old"}),(J||_)&&((Ct=($t=t.avatars)==null?void 0:$t.faceMatch)==null?void 0:Ct[w])&&e.jsxs("div",{className:`absolute bottom-1 left-1 text-white text-[8px] px-1 py-0.5 rounded font-medium ${t.avatars.faceMatch[w].score>=6?"bg-green-600":"bg-red-600"}`,children:[t.avatars.faceMatch[w].score,"/10"]})]}):e.jsx("div",{className:"w-full h-40 rounded border border-dashed border-teal-300 bg-teal-100/50 flex items-center justify-center text-teal-400 text-[10px]",children:((Kt=t.avatars)==null?void 0:Kt.status)==="generating"?"...":"â€”"}),(J||_)&&((Tt=(kt=t.avatars)==null?void 0:kt.clothing)==null?void 0:Tt[w])&&e.jsxs("div",{className:"mt-1 p-1.5 rounded text-[10px] text-left bg-blue-50 border border-blue-200 text-blue-700",children:[e.jsx("span",{className:"font-semibold",children:"ðŸ‘• "}),t.avatars.clothing[w]]}),(J||_)&&((nt=t.avatars)==null?void 0:nt[w])&&!((tr=(br=t.avatars)==null?void 0:br.clothing)!=null&&tr[w])&&e.jsx("div",{className:"mt-1 p-1.5 rounded text-[10px] text-left bg-amber-50 border border-amber-200 text-amber-600",children:"âš ï¸ No clothing data - regenerate avatar"}),(J||_)&&e.jsxs(e.Fragment,{children:[((Br=(sr=t.avatars)==null?void 0:sr.prompts)==null?void 0:Br[w])&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsx("summary",{className:"text-[10px] text-gray-400 cursor-pointer hover:text-gray-600",children:"Show prompt"}),e.jsx("pre",{className:"mt-1 p-2 rounded text-[9px] whitespace-pre-wrap overflow-auto max-h-48 border bg-gray-100 border-gray-200",children:t.avatars.prompts[w]})]}),((Er=(yr=t.avatars)==null?void 0:yr.faceMatch)==null?void 0:Er[w])&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsxs("summary",{className:"text-[10px] text-gray-400 cursor-pointer hover:text-gray-600",children:["Face eval (",t.avatars.faceMatch[w].score,"/10)",t.avatars.faceMatch[w].lpips&&e.jsxs("span",{className:`ml-1 ${t.avatars.faceMatch[w].lpips.lpipsScore<.15?"text-green-600":t.avatars.faceMatch[w].lpips.lpipsScore<.3?"text-yellow-600":"text-red-600"}`,children:["LPIPS: ",(Mr=t.avatars.faceMatch[w].lpips.lpipsScore)==null?void 0:Mr.toFixed(3)]}),t.avatars.faceMatch[w].arcface&&e.jsxs("span",{className:`ml-1 ${t.avatars.faceMatch[w].arcface.samePerson?"text-green-600":"text-red-600"}`,children:["ID: ",((t.avatars.faceMatch[w].arcface.similarity??0)*100).toFixed(0),"%"]})]}),e.jsxs("pre",{className:"mt-1 p-2 rounded text-[9px] whitespace-pre-wrap overflow-auto max-h-48 border bg-gray-100 border-gray-200",children:[t.avatars.faceMatch[w].details,t.avatars.faceMatch[w].lpips&&`

LPIPS: ${(la=t.avatars.faceMatch[w].lpips.lpipsScore)==null?void 0:la.toFixed(4)} (${t.avatars.faceMatch[w].lpips.interpretation})`,t.avatars.faceMatch[w].arcface&&`

ArcFace ID: ${((t.avatars.faceMatch[w].arcface.similarity??0)*100).toFixed(1)}% (${t.avatars.faceMatch[w].arcface.confidence}, same_person: ${t.avatars.faceMatch[w].arcface.samePerson})`]})]})]})]},w)})}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[((qt=t.avatars)==null?void 0:qt.generatedAt)&&e.jsxs("div",{className:"text-xs text-teal-500",children:["Generated: ",new Date(t.avatars.generatedAt).toLocaleString()]}),(J||_)&&((It=t.avatars)==null?void 0:It.crossLpips)&&e.jsxs("div",{className:"text-[10px] text-gray-500 bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("div",{className:"font-medium mb-1",children:"Cross-Avatar LPIPS:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(t.avatars.crossLpips).map(([w,ie])=>{const[Me,Le]=w.split("_vs_"),ze=ie<.3?"text-green-600":ie<.5?"text-yellow-600":"text-red-600";return e.jsxs("span",{className:ze,children:[Me," â†” ",Le,": ",ie.toFixed(2)]},w)})})]}),(J||_)&&((Ss=t.avatars)==null?void 0:Ss.crossArcface)&&e.jsxs("div",{className:"text-[10px] text-gray-500 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsx("div",{className:"font-medium mb-1",children:"Cross-Avatar ArcFace ID:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(t.avatars.crossArcface).map(([w,ie])=>{const[Me,Le]=w.split("_vs_"),ze=ie.samePerson?"text-green-600":"text-red-600";return e.jsxs("span",{className:ze,children:[Me," â†” ",Le,": ",((ie.similarity??0)*100).toFixed(0),"% (",ie.confidence,")"]},w)})})]}),(J||_)&&e.jsxs("div",{className:"text-[10px] text-gray-500 bg-orange-50 border border-orange-200 rounded p-2",children:[e.jsx("div",{className:"font-medium mb-1",children:"Input Photo for Generation:"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("img",{draggable:!1,src:((ts=t.photos)==null?void 0:ts.bodyNoBg)||((Ne=t.photos)==null?void 0:Ne.body)||((Nt=t.photos)==null?void 0:Nt.face)||((ur=t.photos)==null?void 0:ur.original),alt:"Generation input",className:"w-16 h-20 object-contain rounded border border-orange-300",style:{background:"repeating-conic-gradient(#ccc 0% 25%, #fff 0% 50%) 50% / 10px 10px"}}),e.jsxs("div",{children:[e.jsxs("div",{className:(Is=t.photos)!=null&&Is.bodyNoBg?"text-green-600 font-bold":"text-gray-400",children:["bodyNoBg: ",(ss=t.photos)!=null&&ss.bodyNoBg?`âœ… ${Math.round(t.photos.bodyNoBg.length/1024)}KB`:"âŒ"]}),e.jsxs("div",{className:!((Bs=t.photos)!=null&&Bs.bodyNoBg)&&((Cs=t.photos)!=null&&Cs.body)?"text-yellow-600 font-bold":"text-gray-400",children:["body: ",(Es=t.photos)!=null&&Es.body?`${Math.round(t.photos.body.length/1024)}KB`:"âŒ"]}),e.jsxs("div",{className:!((Kr=t.photos)!=null&&Kr.bodyNoBg)&&!((Ms=t.photos)!=null&&Ms.body)&&((fa=t.photos)!=null&&fa.face)?"text-yellow-600 font-bold":"text-gray-400",children:["face: ",(us=t.photos)!=null&&us.face?`${Math.round(t.photos.face.length/1024)}KB`:"âŒ"]}),e.jsxs("div",{className:"mt-1 text-orange-700 font-bold",children:["Using: ",(Ls=t.photos)!=null&&Ls.bodyNoBg?"bodyNoBg âœ…":(ba=t.photos)!=null&&ba.body?"body âš ï¸":(Ur=t.photos)!=null&&Ur.face?"face âš ï¸":"original âŒ"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[L&&e.jsx("button",{onClick:L,disabled:q||u||((ya=t.avatars)==null?void 0:ya.status)==="generating",className:"px-3 py-1.5 text-xs font-medium bg-teal-600 text-white rounded hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",title:c==="de"?"Generiert Avatare mit allen physischen Merkmalen (Brille, Haarfarbe, etc.)":"Generates avatars with all physical traits (glasses, hair color, etc.)",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),c==="de"?"Generiere...":"Generating..."]}):e.jsx(e.Fragment,{children:c==="de"?"Neu generieren":c==="fr"?"RÃ©gÃ©nÃ©rer":"Regenerate"})}),k&&e.jsx("button",{onClick:k,disabled:q||u||((Jr=t.avatars)==null?void 0:Jr.status)==="generating",className:"px-3 py-1.5 text-xs font-medium bg-gray-500 text-white rounded hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",title:c==="de"?"Alte Methode ohne physische Merkmale":"Old method without physical traits",children:q?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),c==="de"?"Generiere...":"Generating..."]}):e.jsx(e.Fragment,{children:c==="de"?"Ohne Merkmale (alt)":c==="fr"?"Sans traits (ancien)":"Without Traits (old)"})})]})]})]}),(J||_)&&((va=t.avatars)==null?void 0:va.costumed)&&Object.keys(t.avatars.costumed).length>0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-300 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-orange-700 mb-3 flex items-center gap-2",children:["ðŸŽ­ ",c==="de"?"KostÃ¼mierte Avatare":c==="fr"?"Avatars costumÃ©s":"Costumed Avatars",e.jsxs("span",{className:"text-xs font-normal text-orange-500",children:["(",Object.keys(t.avatars.costumed).length," ",c==="de"?"KostÃ¼me":"costumes",")"]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:Object.entries(t.avatars.costumed).map(([w,ie])=>{const Me=typeof ie=="string"?ie:ie==null?void 0:ie.imageData,Le=typeof ie=="object"?ie==null?void 0:ie.clothing:void 0;return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs font-medium text-orange-600 mb-1 truncate",title:w,children:["ðŸŽ­ ",w]}),Me?e.jsxs("div",{className:"relative cursor-pointer group",onClick:()=>Be(Me),title:c==="de"?"Klicken zum VergrÃ¶ssern":"Click to enlarge",children:[e.jsx("img",{draggable:!1,src:Me,alt:`${t.name} - ${w}`,className:"w-full h-40 object-contain rounded border border-orange-200 bg-white transition-all group-hover:shadow-lg group-hover:scale-[1.02]"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-all rounded flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 group-hover:opacity-100 text-lg",children:"ðŸ”"})})]}):e.jsx("div",{className:"w-full h-40 rounded border border-dashed border-orange-300 bg-orange-100/50 flex items-center justify-center text-orange-400 text-[10px]",children:"â€”"}),Le&&e.jsxs("div",{className:"mt-1 p-1.5 rounded text-[10px] text-left bg-orange-100 border border-orange-200 text-orange-700",children:[e.jsx("span",{className:"font-semibold",children:"ðŸ‘• "}),Le]})]},w)})})]}),(J||_)&&((gr=t.avatars)==null?void 0:gr.styledAvatars)&&Object.keys(t.avatars.styledAvatars).length>0&&e.jsxs("div",{className:"bg-purple-50 border border-purple-300 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-purple-700 mb-3 flex items-center gap-2",children:["ðŸŽ¨ ",c==="de"?"Stilisierte Avatare":c==="fr"?"Avatars stylisÃ©s":"Styled Avatars",e.jsxs("span",{className:"text-xs font-normal text-purple-500",children:["(",Object.keys(t.avatars.styledAvatars).length," ",c==="de"?"Stile":"styles",")"]})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(t.avatars.styledAvatars).map(([w,ie])=>{const Le={pixar:{en:"Pixar 3D",de:"Pixar 3D",emoji:"ðŸŽ¬"},watercolor:{en:"Watercolor",de:"Aquarell",emoji:"ðŸŽ¨"},"comic-book":{en:"Comic Book",de:"Comic",emoji:"ðŸ’¥"},anime:{en:"Anime",de:"Anime",emoji:"ðŸŒ¸"},"oil-painting":{en:"Oil Painting",de:"Ã–lmalerei",emoji:"ðŸ–¼ï¸"},"colored-pencil":{en:"Colored Pencil",de:"Buntstift",emoji:"âœï¸"},storybook:{en:"Storybook",de:"Bilderbuch",emoji:"ðŸ“–"}}[w]||{en:w,de:w,emoji:"ðŸŽ­"},ze=["standard","winter","summer","formal"],$t={standard:"ðŸ‘•",winter:"â„ï¸",summer:"â˜€ï¸",formal:"ðŸ‘”"},Ct=ie.costumed,Kt=Ct?Object.keys(Ct):[];return e.jsxs("div",{className:"border border-purple-200 rounded-lg p-3 bg-white",children:[e.jsxs("h5",{className:"text-xs font-semibold text-purple-600 mb-2",children:[Le.emoji," ",c==="de"?Le.de:Le.en]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:ze.map(kt=>{const Tt=ie[kt];return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-[10px] text-gray-500 mb-1",children:[$t[kt]," ",kt]}),Tt?e.jsx("img",{draggable:!1,src:Tt,alt:`${t.name} - ${w} - ${kt}`,className:"w-full h-32 object-contain rounded border border-purple-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>Be(Tt),title:"Click to enlarge"}):e.jsx("div",{className:"w-full h-32 rounded border border-dashed border-purple-200 bg-purple-50/50 flex items-center justify-center text-purple-300 text-[10px]",children:"â€”"})]},kt)})}),Kt.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-purple-200",children:[e.jsxs("div",{className:"text-[10px] font-medium text-orange-600 mb-2",children:["ðŸŽ­ ",c==="de"?"KostÃ¼mierte Avatare":"Costumed Avatars"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:Kt.map(kt=>{const Tt=Ct[kt];return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-[10px] text-orange-500 mb-1 truncate",title:kt,children:["ðŸŽ­ ",kt]}),Tt?e.jsx("img",{draggable:!1,src:Tt,alt:`${t.name} - ${w} - ${kt}`,className:"w-full h-32 object-contain rounded border border-orange-200 bg-orange-50/50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>Be(Tt),title:"Click to enlarge"}):e.jsx("div",{className:"w-full h-32 rounded border border-dashed border-orange-200 bg-orange-50/50 flex items-center justify-center text-orange-300 text-[10px]",children:"â€”"})]},kt)})})]})]},w)})})]}),(J||_)&&((ja=t.avatars)==null?void 0:ja.rawEvaluation)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-4",children:[e.jsxs("summary",{className:"text-sm font-semibold text-purple-700 cursor-pointer flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“Š Full API Response (Avatar Evaluation)"}),e.jsx("span",{className:"text-xs font-normal text-purple-500",children:"Click to expand"})]}),e.jsx("pre",{className:"mt-3 p-4 bg-white rounded-lg text-xs whitespace-pre-wrap overflow-auto max-h-[600px] border border-purple-200 font-mono leading-relaxed",children:JSON.stringify(t.avatars.rawEvaluation,null,2)})]}),e.jsxs("div",{className:"flex gap-3 max-w-md",children:[r&&e.jsx("button",{onClick:r,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:ne.cancel}),e.jsx(Ps,{onClick:()=>{var Me,Le,ze,$t,Ct;const w=!!((Me=t.avatars)!=null&&Me.winter||(Le=t.avatars)!=null&&Le.standard||(ze=t.avatars)!=null&&ze.summer||($t=t.avatars)!=null&&$t.formal),ie=((Ct=t.avatars)==null?void 0:Ct.status)==="generating";!w&&!ie&&h?h():p()},disabled:!Dt||R||u,loading:R||u,icon:As,className:r?"flex-1":"w-full",children:ne.saveCharacter})]}),!Dt&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:ne.selectStrengthsFlaws}),(J||_)&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 text-yellow-700 text-xs rounded",children:"DEV"}),"Character Data (Database View)"]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-3",children:"Physical Traits"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Eye Color:"}),e.jsxs("div",{className:"font-medium flex items-center gap-1",children:[((Cr=t.physical)==null?void 0:Cr.eyeColor)||"â€”",((Na=t.physical)==null?void 0:Na.eyeColorHex)&&e.jsx("span",{className:"inline-block w-4 h-4 rounded border border-gray-300",style:{backgroundColor:t.physical.eyeColorHex},title:t.physical.eyeColorHex})]}),((kr=t.physicalTraitsSource)==null?void 0:kr.eyeColor)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",t.physicalTraitsSource.eyeColor,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Hair Color:"}),e.jsxs("div",{className:"font-medium flex items-center gap-1",children:[((wa=t.physical)==null?void 0:wa.hairColor)||"â€”",((Zr=t.physical)==null?void 0:Zr.hairColorHex)&&e.jsx("span",{className:"inline-block w-4 h-4 rounded border border-gray-300",style:{backgroundColor:t.physical.hairColorHex},title:t.physical.hairColorHex})]}),((Sa=t.physicalTraitsSource)==null?void 0:Sa.hairColor)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",t.physicalTraitsSource.hairColor,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Hair Length:"}),e.jsx("div",{className:"font-medium",children:((hr=t.physical)==null?void 0:hr.hairLength)||"â€”"}),((Ar=t.physicalTraitsSource)==null?void 0:Ar.hairLength)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",t.physicalTraitsSource.hairLength,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Hair Style:"}),e.jsx("div",{className:"font-medium",children:((ks=t.physical)==null?void 0:ks.hairStyle)||"â€”"}),((Vt=t.physicalTraitsSource)==null?void 0:Vt.hairStyle)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",t.physicalTraitsSource.hairStyle,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Build:"}),e.jsx("div",{className:"font-medium",children:((Qs=t.physical)==null?void 0:Qs.build)||"â€”"}),((Ca=t.physicalTraitsSource)==null?void 0:Ca.build)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",t.physicalTraitsSource.build,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Facial Hair:"}),e.jsx("div",{className:"font-medium",children:((Rs=t.physical)==null?void 0:Rs.facialHair)||"â€”"}),((Pr=t.physicalTraitsSource)==null?void 0:Pr.facialHair)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",t.physicalTraitsSource.facialHair,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Skin Tone:"}),e.jsx("div",{className:"font-medium",children:((gs=t.physical)==null?void 0:gs.skinTone)||"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Other:"}),e.jsx("div",{className:"font-medium",children:((Gs=t.physical)==null?void 0:Gs.other)||"â€”"}),((Ys=t.physicalTraitsSource)==null?void 0:Ys.other)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",t.physicalTraitsSource.other,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Height:"}),e.jsx("div",{className:"font-medium",children:((ka=t.physical)==null?void 0:ka.height)||"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Apparent Age:"}),e.jsx("div",{className:"font-medium",children:((Qr=t.physical)==null?void 0:Qr.apparentAge)||"â€”"})]})]}),((Aa=t.physical)==null?void 0:Aa.detailedHairAnalysis)&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-200",children:[e.jsx("span",{className:"text-gray-500 text-xs block mb-1",children:"Detailed Hair Analysis:"}),e.jsx("p",{className:"text-sm bg-white border border-gray-200 rounded p-2 italic text-gray-700",children:typeof t.physical.detailedHairAnalysis=="object"?JSON.stringify(t.physical.detailedHairAnalysis,null,2):t.physical.detailedHairAnalysis})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-3",children:"Clothing"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Upper Body:"}),e.jsx("div",{className:"font-medium",children:((Pa=(Yr=t.clothing)==null?void 0:Yr.structured)==null?void 0:Pa.upperBody)||"â€”"}),((Xr=t.clothingSource)==null?void 0:Xr.upperBody)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",t.clothingSource.upperBody,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Lower Body:"}),e.jsx("div",{className:"font-medium",children:((ea=(Da=t.clothing)==null?void 0:Da.structured)==null?void 0:ea.lowerBody)||"â€”"}),(($a=t.clothingSource)==null?void 0:$a.lowerBody)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",t.clothingSource.lowerBody,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Shoes:"}),e.jsx("div",{className:"font-medium",children:((Ta=(ta=t.clothing)==null?void 0:ta.structured)==null?void 0:Ta.shoes)||"â€”"}),((sa=t.clothingSource)==null?void 0:sa.shoes)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",t.clothingSource.shoes,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Full Body:"}),e.jsx("div",{className:"font-medium",children:((Xs=(Fa=t.clothing)==null?void 0:Fa.structured)==null?void 0:Xs.fullBody)||"â€”"}),((za=t.clothingSource)==null?void 0:za.fullBody)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",t.clothingSource.fullBody,"]"]})]})]}),((xr=t.clothing)==null?void 0:xr.current)&&e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-gray-500 text-xs block mb-1",children:"Legacy (current):"}),e.jsx("div",{className:"text-sm font-medium",children:t.clothing.current})]}),((Ia=t.avatars)==null?void 0:Ia.clothing)&&Object.keys(t.avatars.clothing).length>0&&e.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[e.jsx("span",{className:"text-gray-500 text-xs block mb-2",children:"Avatar Extracted Clothing:"}),e.jsx("div",{className:"space-y-1 text-sm",children:Object.entries(t.avatars.clothing).map(([w,ie])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-gray-500 capitalize w-20",children:[w,":"]}),e.jsx("span",{className:"text-gray-700",children:ie})]},w))})]})]})]}),e.jsx(fn,{src:pe,onClose:()=>Be(null)}),me&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-white flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-gray-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:c==="de"?"Aussehen anpassen":c==="fr"?"Modifier l'apparence":"Modify Look"}),e.jsx("button",{onClick:()=>de(!1),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-full transition-colors",children:e.jsx(ns,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"flex-shrink-0 flex justify-center md:justify-start",children:(Ba=(Dr=t.avatars)==null?void 0:Dr.faceThumbnails)!=null&&Ba.standard||($r=t.avatars)!=null&&$r.standard?e.jsx("img",{draggable:!1,src:((Tr=(Ea=t.avatars)==null?void 0:Ea.faceThumbnails)==null?void 0:Tr.standard)||((Ma=t.avatars)==null?void 0:Ma.standard),alt:`${t.name} avatar`,className:"w-48 h-64 object-contain rounded-lg border-2 border-indigo-300 bg-white shadow-lg"}):e.jsx("div",{className:"w-48 h-64 rounded-lg border-2 border-dashed border-gray-300 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400 text-sm",children:c==="de"?"Kein Bild":"No image"})})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:c==="de"?"Physische Merkmale":c==="fr"?"CaractÃ©ristiques physiques":"Physical Features"}),e.jsx(Kl,{character:t,language:c,updatePhysical:$e,updateApparentAge:w=>$e("apparentAge",w)})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:c==="de"?"Kleidung":c==="fr"?"VÃªtements":"Clothing"}),e.jsxs("div",{className:"space-y-3",children:[t.gender==="female"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:c==="de"?"Kleid / Overall":c==="fr"?"Robe / Combinaison":"Dress / Jumpsuit"}),e.jsx("input",{type:"text",value:((La=(ra=t.clothing)==null?void 0:ra.structured)==null?void 0:La.fullBody)||"",onChange:w=>{var ie;return n({...t,clothing:{...t.clothing,structured:{...(ie=t.clothing)==null?void 0:ie.structured,fullBody:w.target.value,...w.target.value?{upperBody:"",lowerBody:""}:{}}},clothingSource:{...t.clothingSource,fullBody:"user",...w.target.value?{upperBody:void 0,lowerBody:void 0}:{}}})},placeholder:c==="de"?"z.B. rotes Sommerkleid":c==="fr"?"ex. robe d'Ã©tÃ© rouge":"e.g. red summer dress",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none"})]}),e.jsxs("div",{className:(Fr=(pr=t.clothing)==null?void 0:pr.structured)!=null&&Fr.fullBody?"opacity-50":"",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:c==="de"?"Oberteil":c==="fr"?"Haut":"Upper Body"}),e.jsx("input",{type:"text",value:((er=(Bt=t.clothing)==null?void 0:Bt.structured)==null?void 0:er.upperBody)||"",onChange:w=>{var ie;return n({...t,clothing:{...t.clothing,structured:{...(ie=t.clothing)==null?void 0:ie.structured,upperBody:w.target.value}},clothingSource:{...t.clothingSource,upperBody:"user"}})},disabled:!!((Ge=(Wt=t.clothing)==null?void 0:Wt.structured)!=null&&Ge.fullBody),placeholder:c==="de"?"z.B. blaues T-Shirt":c==="fr"?"ex. t-shirt bleu":"e.g. blue t-shirt",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{className:(Ir=(zr=t.clothing)==null?void 0:zr.structured)!=null&&Ir.fullBody?"opacity-50":"",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:c==="de"?"Unterteil":c==="fr"?"Bas":"Lower Body"}),e.jsx("input",{type:"text",value:((Ra=(fr=t.clothing)==null?void 0:fr.structured)==null?void 0:Ra.lowerBody)||"",onChange:w=>{var ie;return n({...t,clothing:{...t.clothing,structured:{...(ie=t.clothing)==null?void 0:ie.structured,lowerBody:w.target.value}},clothingSource:{...t.clothingSource,lowerBody:"user"}})},disabled:!!((Ga=(aa=t.clothing)==null?void 0:aa.structured)!=null&&Ga.fullBody),placeholder:c==="de"?"z.B. dunkle Jeans":c==="fr"?"ex. jeans foncÃ©":"e.g. dark jeans",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:c==="de"?"Schuhe":c==="fr"?"Chaussures":"Shoes"}),e.jsx("input",{type:"text",value:((Ha=(na=t.clothing)==null?void 0:na.structured)==null?void 0:Ha.shoes)||"",onChange:w=>{var ie;return n({...t,clothing:{...t.clothing,structured:{...(ie=t.clothing)==null?void 0:ie.structured,shoes:w.target.value}},clothingSource:{...t.clothingSource,shoes:"user"}})},placeholder:c==="de"?"z.B. weiÃŸe Turnschuhe":c==="fr"?"ex. baskets blanches":"e.g. white sneakers",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none"})]})]})]})]})]})})}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex gap-3",children:[e.jsx("button",{onClick:()=>de(!1),className:"flex-1 px-4 py-3 text-sm font-medium bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:c==="de"?"Abbrechen":c==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:()=>{de(!1),Ke(),v&&h?h():L&&L()},disabled:u||((ia=t.avatars)==null?void 0:ia.status)==="generating"||!J&&!_&&!Ie,className:"flex-1 px-4 py-3 text-sm font-medium bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-colors",title:!J&&!_&&!Ie?c==="de"?`Warten Sie ${Pt}s`:`Wait ${Pt}s`:void 0,children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),c==="de"?"Generiere...":"Generating..."]}):!J&&!_&&!Ie?e.jsxs(e.Fragment,{children:[e.jsx(As,{size:16}),c==="de"?`Warten (${Pt}s)`:`Wait (${Pt}s)`]}):e.jsxs(e.Fragment,{children:[e.jsx(As,{size:16}),c==="de"?"Speichern & Neu generieren":c==="fr"?"Enregistrer et rÃ©gÃ©nÃ©rer":"Save & Regenerate"]})})]})})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:c==="de"?"Kleidung fÃ¼r neues Foto":c==="fr"?"VÃªtements pour la nouvelle photo":"Clothing for New Photo"}),e.jsx("p",{className:"text-gray-600 mb-6",children:c==="de"?"MÃ¶chten Sie die aktuelle Kleidung beibehalten oder die Kleidung aus dem neuen Foto verwenden?":c==="fr"?"Voulez-vous garder les vÃªtements actuels ou utiliser ceux de la nouvelle photo?":"Do you want to keep the current clothing or use the clothing from the new photo?"}),((Oa=t.clothing)==null?void 0:Oa.structured)&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-4 text-sm",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:c==="de"?"Aktuelle Kleidung:":c==="fr"?"VÃªtements actuels:":"Current clothing:"}),e.jsxs("div",{className:"text-gray-600 space-y-0.5",children:[t.clothing.structured.upperBody&&e.jsxs("div",{children:[c==="de"?"Oberteil":"Top",": ",t.clothing.structured.upperBody]}),t.clothing.structured.lowerBody&&e.jsxs("div",{children:[c==="de"?"Unterteil":"Bottom",": ",t.clothing.structured.lowerBody]}),t.clothing.structured.shoes&&e.jsxs("div",{children:[c==="de"?"Schuhe":"Shoes",": ",t.clothing.structured.shoes]}),t.clothing.structured.fullBody&&e.jsxs("div",{children:[c==="de"?"GanzkÃ¶rper":"Full outfit",": ",t.clothing.structured.fullBody]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>Ye(!1),className:"w-full px-4 py-3 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2",children:[c==="de"?"Kleidung aus neuem Foto verwenden":c==="fr"?"Utiliser les vÃªtements de la nouvelle photo":"Use clothing from new photo",e.jsx("span",{className:"text-xs bg-indigo-500 px-2 py-0.5 rounded",children:c==="de"?"Empfohlen":c==="fr"?"RecommandÃ©":"Default"})]}),e.jsx("button",{onClick:()=>Ye(!0),className:"w-full px-4 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors",children:c==="de"?"Aktuelle Kleidung beibehalten":c==="fr"?"Garder les vÃªtements actuels":"Keep current clothing"}),e.jsx("button",{onClick:()=>{X(!1),be(null)},className:"w-full px-4 py-2 text-gray-500 hover:text-gray-700 text-sm transition-colors",children:c==="de"?"Abbrechen":c==="fr"?"Annuler":"Cancel"})]})]})}),He&&He.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:c==="de"?"WÃ¤hle deinen Avatar":"Choose Your Avatar"}),e.jsx("p",{className:"text-gray-600 mb-4 text-sm",children:c==="de"?"Klicke auf das Bild, das dir am besten gefÃ¤llt":"Click on the image you like best"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4 mb-6",children:He.map(w=>e.jsxs("div",{onClick:()=>Gt(w.id),className:`cursor-pointer rounded-xl overflow-hidden border-4 transition-all ${Ut===w.id?"border-indigo-500 shadow-lg scale-[1.02]":"border-transparent hover:border-gray-300"}`,children:[e.jsx("img",{draggable:!1,src:w.imageData,alt:`Option ${w.id+1}`,className:"w-full aspect-[9/16] object-cover"}),e.jsxs("div",{className:`text-center py-2 text-sm font-medium ${Ut===w.id?"bg-indigo-500 text-white":"bg-gray-100 text-gray-700"}`,children:["Option ",w.id+1]})]},w.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Ds,disabled:Ut===null,className:"flex-1 px-4 py-3 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c==="de"?"Auswahl verwenden":"Use Selected"}),e.jsx("button",{onClick:()=>{Rt(null),Gt(null)},className:"px-4 py-3 text-gray-600 hover:text-gray-800 transition-colors",children:c==="de"?"Abbrechen":"Cancel"})]})]})})]})}const Jn={en:{title:"Multiple Faces Detected",description:"We detected multiple people in your photo. Please select which face belongs to the character you want to create.",selectFace:"Select Face",uploadDifferent:"Upload Different Photo",confidence:"Confidence"},de:{title:"Mehrere Gesichter erkannt",description:"Wir haben mehrere Personen in Ihrem Foto erkannt. Bitte wÃ¤hlen Sie aus, welches Gesicht zu dem Charakter gehÃ¶rt, den Sie erstellen mÃ¶chten.",selectFace:"Gesicht auswÃ¤hlen",uploadDifferent:"Anderes Foto hochladen",confidence:"Konfidenz"},fr:{title:"Plusieurs visages dÃ©tectÃ©s",description:"Nous avons dÃ©tectÃ© plusieurs personnes sur votre photo. Veuillez sÃ©lectionner le visage du personnage que vous souhaitez crÃ©er.",selectFace:"SÃ©lectionner le visage",uploadDifferent:"TÃ©lÃ©charger une autre photo",confidence:"Confiance"}};function Ul({isOpen:t,faces:a,onSelect:n,onUploadNew:p,developerMode:r=!1}){const{language:f}=gt(),x=Jn[f]||Jn.en;return e.jsx(_i,{isOpen:t,onClose:p,title:x.title,size:"lg",showCloseButton:!1,closeOnOverlayClick:!1,closeOnEscape:!1,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-gray-600 text-center",children:x.description}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:a.map((o,C)=>e.jsxs("button",{onClick:()=>n(o.id),className:`group relative bg-white border-2 border-gray-200 rounded-xl p-3
                hover:border-indigo-400 hover:shadow-lg transition-all duration-200
                focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2`,children:[e.jsx("div",{className:"aspect-square overflow-hidden rounded-lg mb-3",children:e.jsx("img",{draggable:!1,src:o.thumbnail,alt:`Face ${C+1}`,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"})}),e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"text-sm font-semibold text-indigo-600 group-hover:text-indigo-700",children:[x.selectFace," ",C+1]})}),r&&e.jsxs("div",{className:"absolute top-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded",children:[x.confidence,": ",Math.round(o.confidence*100),"%"]})]},o.id))}),e.jsx("div",{className:"pt-4 border-t border-gray-100",children:e.jsxs("button",{onClick:p,className:`w-full flex items-center justify-center gap-2 px-4 py-3
              bg-gray-100 text-gray-700 rounded-lg font-medium
              hover:bg-gray-200 transition-colors`,children:[e.jsx(_r,{size:20}),x.uploadDifferent]})})]})})}const Zn={en:{consent1:"I confirm I have the right to use the uploaded photos and, for photos of minors, I am the parent/guardian or have obtained their consent.",consent2:"I agree to the",termsLink:"Terms of Service",and:"and",privacyLink:"Privacy Policy",period:", including the processing of these photos by AI to create illustrated avatars.",pleaseAccept:"Please accept the terms above to upload a photo"},de:{consent1:"Ich bestÃ¤tige, dass ich das Recht habe, die hochgeladenen Fotos zu verwenden, und bei Fotos von MinderjÃ¤hrigen bin ich der Elternteil/Vormund oder habe deren Zustimmung eingeholt.",consent2:"Ich stimme den",termsLink:"Nutzungsbedingungen",and:"und der",privacyLink:"Datenschutzrichtlinie",period:" zu, einschliesslich der Verarbeitung dieser Fotos durch KI zur Erstellung illustrierter Avatare.",pleaseAccept:"Bitte akzeptieren Sie die obigen Bedingungen, um ein Foto hochzuladen"},fr:{consent1:"Je confirme que j'ai le droit d'utiliser les photos tÃ©lÃ©chargÃ©es et, pour les photos de mineurs, je suis le parent/tuteur ou j'ai obtenu leur consentement.",consent2:"J'accepte les",termsLink:"Conditions d'Utilisation",and:"et la",privacyLink:"Politique de ConfidentialitÃ©",period:", y compris le traitement de ces photos par l'IA pour crÃ©er des avatars illustrÃ©s.",pleaseAccept:"Veuillez accepter les conditions ci-dessus pour tÃ©lÃ©charger une photo"}};function Jl({onPhotoSelect:t,showExamples:a=!0}){const{t:n,language:p}=gt(),{user:r,recordPhotoConsent:f}=sn(),[x,o]=d.useState(!1),[C,$]=d.useState(!1),[b,v]=d.useState(!1),B=d.useRef(null),h=Zn[p]||Zn.en,k=!!(r!=null&&r.photoConsentAt);console.log("[PhotoUpload] Mounted/Updated:",{user:r==null?void 0:r.email,photoConsentAt:r==null?void 0:r.photoConsentAt,hasExistingConsent:k});const L=k||x&&C,R=()=>{L&&!b&&B.current&&B.current.click()},E=async q=>{var z;const u=(z=q.target.files)==null?void 0:z[0];if(console.log("[PhotoUpload] handleFileChange:",{file:u==null?void 0:u.name,canUpload:L,hasExistingConsent:k,consent1Checked:x,consent2Checked:C}),u&&L){if(!k&&x&&C){v(!0);try{await f()}catch(J){console.error("Failed to record consent:",J)}finally{v(!1)}}console.log("[PhotoUpload] Calling onPhotoSelect with file:",u.name),t(u)}else console.log("[PhotoUpload] NOT calling onPhotoSelect - file:",!!u,"canUpload:",L)},se=p==="de"?"Deine Geschichte wird basierend auf den hochgeladenen Fotos erstellt. Verwende Fotos mit nur einer Person, idealerweise GanzkÃ¶rperaufnahmen, da auch die Kleidung in die Geschichte Ã¼bernommen wird.":p==="fr"?"Votre histoire sera gÃ©nÃ©rÃ©e Ã  partir des photos tÃ©lÃ©chargÃ©es. Utilisez des photos d'une seule personne, idÃ©alement en pied, car les vÃªtements seront Ã©galement intÃ©grÃ©s dans l'histoire.":"Your story will be generated based on the photos you upload. Use photos of a single person, ideally full body shots, as clothing will also be copied into the story.";return e.jsxs("div",{className:"bg-indigo-50 border-2 border-indigo-300 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-4 text-center",children:se}),!k&&e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 space-y-3",children:[e.jsxs("div",{onClick:()=>o(!x),className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5 text-indigo-600 hover:text-indigo-800",children:x?e.jsx(Bn,{size:20}):e.jsx(En,{size:20})}),e.jsx("span",{className:"text-sm text-gray-700 group-hover:text-gray-900",children:h.consent1})]}),e.jsxs("div",{onClick:q=>{q.target.tagName!=="A"&&$(!C)},className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5 text-indigo-600 hover:text-indigo-800",children:C?e.jsx(Bn,{size:20}):e.jsx(En,{size:20})}),e.jsxs("span",{className:"text-sm text-gray-700 group-hover:text-gray-900",children:[h.consent2," ",e.jsx(Pn,{to:"/terms",className:"text-indigo-600 hover:underline",children:h.termsLink})," ",h.and," ",e.jsx(Pn,{to:"/privacy",className:"text-indigo-600 hover:underline",children:h.privacyLink}),h.period]})]})]}),e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("input",{ref:B,type:"file",accept:"image/*",onChange:E,className:"hidden"}),e.jsxs("button",{type:"button",onClick:R,disabled:!L||b,className:`inline-flex items-center justify-center gap-3 px-10 py-4 rounded-xl text-xl font-bold shadow-lg transition-colors ${L&&!b?"cursor-pointer bg-indigo-600 text-white hover:bg-indigo-700":"cursor-not-allowed bg-gray-300 text-gray-500"}`,children:[e.jsx(_r,{size:28})," ",b?"...":n.uploadPhoto]}),!L&&!k&&e.jsx("p",{className:"text-sm text-amber-600 mt-2",children:h.pleaseAccept})]}),a&&e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{draggable:!1,src:"/images/Full body.jpg",alt:"Full body example",className:"w-full md:max-h-32 object-contain rounded border-2 border-green-400 mb-1"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:p==="de"?"GanzkÃ¶rper":p==="fr"?"Corps entier":"Full body"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{draggable:!1,src:"/images/Upper body.jpg",alt:"Upper body example",className:"w-full md:max-h-32 object-contain rounded border-2 border-green-400 mb-1"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:p==="de"?"OberkÃ¶rper":p==="fr"?"Buste":"Upper body"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{draggable:!1,src:"/images/No zoomed in close up.jpg",alt:"Too close example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:p==="de"?"Zu nah / Unscharf":p==="fr"?"Trop proche / Flou":"Too close / Blurry"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{draggable:!1,src:"/images/No sunglasses, hat or helmets.jpg",alt:"No accessories example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:p==="de"?"Brille / Hut / Helm":p==="fr"?"Lunettes / Chapeau":"Glasses / Hat / Helmet"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{draggable:!1,src:"/images/One person not many.jpg",alt:"One person only example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:p==="de"?"Nur eine Person":p==="fr"?"Une seule personne":"Only one person"})]})]})})]})}function Zl({characters:t,currentCharacter:a,characterStep:n,showCharacterCreated:p,isLoading:r,isAnalyzingPhoto:f,isGeneratingAvatar:x,isRegeneratingAvatars:o,isRegeneratingAvatarsWithTraits:C,developerMode:$,isImpersonating:b=!1,changedTraits:v,photoAnalysisDebug:B,mainCharacters:h,excludedCharacters:k,onCharacterRoleChange:L,onCharacterChange:R,onCharacterStepChange:E,onContinueToAvatar:se,onPhotoSelect:q,onSaveAndGenerateAvatar:u,onSaveCharacter:z,onEditCharacter:J,onDeleteCharacter:_,onStartNewCharacter:Y,onRegenerateAvatars:I,onRegenerateAvatarsWithTraits:re,onSaveAndRegenerateWithTraits:fe,onSaveAndTryNewPhoto:xe,relationships:ae,relationshipTexts:he,onRelationshipChange:Se,onRelationshipTextChange:ne,customRelationships:c,onAddCustomRelationship:Te}){const{t:O,language:pe}=gt();if(a){if(n==="photo")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ir,{size:24})," ",O.charactersStepTitle]}),e.jsx(Jl,{onPhotoSelect:q}),e.jsx("button",{onClick:()=>R(null),className:"w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:O.cancel})]});if(n==="name")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ir,{size:24})," ",O.charactersStepTitle]}),e.jsx(Un,{character:a,onChange:R,onSave:z,onCancel:()=>R(null),onPhotoChange:q,onContinueToTraits:()=>{var me,de;((me=a==null?void 0:a.avatars)==null?void 0:me.status)==="pending"&&((de=a==null?void 0:a.photos)!=null&&de.original)?u():E("traits")},onSaveAndGenerateAvatar:u,onRegenerateAvatars:I,onRegenerateAvatarsWithTraits:re,isLoading:r,isAnalyzingPhoto:f,isGeneratingAvatar:x,isRegeneratingAvatars:o,isRegeneratingAvatarsWithTraits:C,step:"name",developerMode:$,isImpersonating:b,changedTraits:v,photoAnalysisDebug:B,isNewCharacter:!0})]});const Be=!t.find(me=>me.id===a.id);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ir,{size:24})," ",O.charactersStepTitle]}),e.jsx(Un,{character:a,allCharacters:t,onChange:R,onSave:z,onCancel:()=>R(null),onPhotoChange:q,onContinueToCharacteristics:()=>E("characteristics"),onContinueToRelationships:()=>E("relationships"),onContinueToAvatar:se,onRegenerateAvatars:I,onRegenerateAvatarsWithTraits:re,onSaveAndRegenerateWithTraits:fe,onSaveAndTryNewPhoto:xe,isLoading:r,isAnalyzingPhoto:f,isGeneratingAvatar:x,isRegeneratingAvatars:o,isRegeneratingAvatarsWithTraits:C,step:n,developerMode:$,isImpersonating:b,changedTraits:v,photoAnalysisDebug:B,relationships:ae,relationshipTexts:he,onRelationshipChange:Se,onRelationshipTextChange:ne,customRelationships:c,onAddCustomRelationship:Te,isNewCharacter:Be})]})}return t.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ir,{size:24})," ",O.charactersStepTitle]}),h.length===0&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-500 text-xl",children:"â­"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-800 font-medium",children:pe==="de"?"WÃ¤hle mindestens einen Hauptcharakter aus":pe==="fr"?"SÃ©lectionnez au moins un personnage principal":"Select at least one main character"}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:pe==="de"?"Klicke auf den Stern â­ neben einem Charakter, um ihn zum Hauptcharakter zu machen.":pe==="fr"?"Cliquez sur l'Ã©toile â­ Ã  cÃ´tÃ© d'un personnage pour en faire le personnage principal.":"Click the star â­ next to a character to make them the main character."})]})]}),e.jsx(Bl,{characters:t,showSuccessMessage:p,mainCharacters:h,excludedCharacters:k,onCharacterRoleChange:L,onEdit:J,onDelete:_,onCreateAnother:Y})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ir,{size:24})," ",O.charactersStepTitle]}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ir,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-6",children:O.startCreating}),e.jsx(Ps,{onClick:Y,icon:Mt,children:pe==="de"?"Ersten Charakter erstellen":pe==="fr"?"Creer le premier personnage":"Create First Character"})]})]})}const Qn=[{code:"de-ch",name:"Deutsch",family:"de"},{code:"fr-ch",name:"FranÃ§ais",family:"fr"},{code:"it-ch",name:"Italiano",family:"it"},{code:"en-gb",name:"English",family:"en"},{code:"gsw-zh",name:"Mundart",family:"gsw"}],Ja={de:[{code:"de-ch",name:"Schweiz"},{code:"de-de",name:"Hochdeutsch"},{code:"de-de-north",name:"Norddeutsch"},{code:"de-de-south",name:"SÃ¼ddeutsch"},{code:"de-at",name:"Ã–sterreich"},{code:"de-it",name:"SÃ¼dtirol"}],fr:[{code:"fr-ch",name:"Suisse"},{code:"fr-fr",name:"France"},{code:"fr-be",name:"Belgique"},{code:"fr-ca",name:"QuÃ©bec"},{code:"fr-af",name:"Afrique"}],it:[{code:"it-ch",name:"Svizzera"},{code:"it-it",name:"Standard"},{code:"it-it-north",name:"Nord"},{code:"it-it-central",name:"Toscana"},{code:"it-it-south",name:"Sud"},{code:"it-sm",name:"San Marino"}],en:[{code:"en-gb",name:"British"},{code:"en-us",name:"American"},{code:"en-ca",name:"Canadian"},{code:"en-au",name:"Australian"},{code:"en-ie",name:"Irish"},{code:"en-za",name:"South African"}],gsw:[{code:"gsw-zh",name:"ZÃ¼ritÃ¼Ã¼tsch"},{code:"gsw-be",name:"BÃ¤rndÃ¼tsch"},{code:"gsw-bs",name:"Baseldytsch"},{code:"gsw-lu",name:"LuzÃ¤rndÃ¼tsch"},{code:"gsw-sg",name:"SanggallerdÃ¼tsch"},{code:"gsw-vs",name:"WalliserdÃ¼tsch"},{code:"gsw-gr",name:"BÃ¼ndnerdÃ¼tsch"}]};function gn(t){return t.startsWith("gsw")?"gsw":t.startsWith("de")?"de":t.startsWith("fr")?"fr":t.startsWith("it")?"it":"en"}const Ql=["spring","summer","autumn","winter"];function Yl(){const t=new Date().getMonth();return t>=2&&t<=4?"spring":t>=5&&t<=7?"summer":t>=8&&t<=10?"autumn":"winter"}function Xl({languageLevel:t,onLanguageLevelChange:a,pages:n,onPagesChange:p,storyLanguage:r,onStoryLanguageChange:f,developerMode:x,userLocation:o,onLocationChange:C,season:$,onSeasonChange:b,userCredits:v}){const{t:B,language:h}=gt(),[k,L]=d.useState(!1),[R,E]=d.useState((o==null?void 0:o.city)||""),[se,q]=d.useState((o==null?void 0:o.country)||""),[u,z]=d.useState(!1),J=d.useRef(null);d.useEffect(()=>{const K=Fe=>{J.current&&!J.current.contains(Fe.target)&&z(!1)};return document.addEventListener("mousedown",K),()=>document.removeEventListener("mousedown",K)},[]);const _=d.useCallback(()=>{const K=gn(r),Fe=Qn.find(X=>X.family===K),T=Ja[K].find(X=>X.code===r)||Ja[K][0];return Fe&&T?`${Fe.name} (${T.name})`:(Fe==null?void 0:Fe.name)||r},[r]);d.useEffect(()=>{o&&(E(o.city||""),q(o.country||""))},[o]);const Y=()=>{C({city:R||null,region:null,country:se||null}),L(!1)},I={spring:{de:"FrÃ¼hling",fr:"Printemps",en:"Spring"},summer:{de:"Sommer",fr:"Ã‰tÃ©",en:"Summer"},autumn:{de:"Herbst",fr:"Automne",en:"Autumn"},winter:{de:"Winter",fr:"Hiver",en:"Winter"}},re=x?4:10,fe=50,xe=2,ae=10,he=v===-1,Se=he?fe:Math.floor(v/ae),ne=Math.floor(Se/2)*2,c=re*ae,Te=!he&&v<c,O=c-v,pe=Te?re:Math.min(fe,Math.max(re,ne)),Be=!he&&ne<fe;d.useEffect(()=>{let K=n;K%2!==0&&(K=Math.round(K/2)*2),K=Math.max(re,Math.min(pe,K)),K!==n&&p(K)},[n,re,pe,p]);const me=[{value:"1st-grade",label:B.firstGrade,desc:B.firstGradeDesc,image:"/images/text and image on each page.jpg"},{value:"standard",label:B.standard,desc:B.standardDesc,image:"/images/left page text, right page image.jpg"},{value:"advanced",label:B.advanced,desc:B.advancedDesc,image:"/images/dense text left.jpg"}],de=(K,Fe=!1)=>{const T=Fe?" (Test)":"",X=K*10,Ae=h==="de"?"Credits":h==="fr"?"crÃ©dits":"credits";if(t==="1st-grade")return`${K} ${h==="de"?"Seiten":"pages"} = ${X} ${Ae}${T}`;const be=Math.floor(K/2),He=Math.floor(K/2);return h==="de"?`${K} Seiten (${be} Text + ${He} Bilder) = ${X} ${Ae}${T}`:h==="fr"?`${K} pages (${be} texte + ${He} images) = ${X} ${Ae}${T}`:`${K} pages (${be} text + ${He} images) = ${X} ${Ae}${T}`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Qa,{size:24}),h==="de"?"Buchformat":h==="fr"?"Format du livre":"Book Format"]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:h==="de"?"Sprache:":h==="fr"?"Langue:":"Language:"}),e.jsxs("div",{className:"relative",ref:J,children:[e.jsxs("button",{type:"button",onClick:()=>z(!u),className:"px-3 py-1.5 border border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-sm font-medium bg-white cursor-pointer pr-8 flex items-center gap-1 min-w-[160px]",children:[_(),e.jsx(Ft,{size:16,className:`absolute right-2 text-gray-400 transition-transform ${u?"rotate-180":""}`})]}),u&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 min-w-[180px] py-1",children:[Qn.map(K=>{const Fe=gn(r)===K.family;return e.jsx("button",{type:"button",onClick:()=>{const T=Ja[K.family][0];f(T.code)},className:`w-full text-left px-3 py-1.5 text-sm hover:bg-indigo-50 ${Fe?"font-semibold text-indigo-600":"text-gray-700"}`,children:K.name},K.family)}),e.jsx("div",{className:"border-t border-gray-300 my-1"}),Ja[gn(r)].map(K=>e.jsx("button",{type:"button",onClick:()=>{f(K.code),z(!1)},className:`w-full text-left px-3 py-1.5 text-sm hover:bg-indigo-50 ${r===K.code?"bg-indigo-100 text-indigo-700 font-medium":"text-gray-700"}`,children:K.name},K.code))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(el,{className:"text-gray-500",size:16}),e.jsx("span",{className:"text-sm text-gray-600",children:h==="de"?"Ort:":h==="fr"?"Lieu:":"Location:"}),k?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"text",value:R,onChange:K=>E(K.target.value),placeholder:h==="de"?"Stadt":h==="fr"?"Ville":"City",className:"px-2 py-1 border border-gray-300 rounded text-base w-24 focus:outline-none focus:border-indigo-500"}),e.jsx("input",{type:"text",value:se,onChange:K=>q(K.target.value),placeholder:h==="de"?"Land":h==="fr"?"Pays":"Country",className:"px-2 py-1 border border-gray-300 rounded text-base w-24 focus:outline-none focus:border-indigo-500"}),e.jsx("button",{onClick:Y,className:"px-2 py-1 bg-indigo-600 text-white text-xs rounded hover:bg-indigo-700",children:"OK"}),e.jsx("button",{onClick:()=>L(!1),className:"px-1 text-gray-500 text-xs hover:text-gray-700",children:"âœ•"})]}):e.jsx("button",{onClick:()=>L(!0),className:"text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline",children:o!=null&&o.city?`${o.city}${o.country?`, ${o.country}`:""}`:h==="de"?"Festlegen":h==="fr"?"DÃ©finir":"Set"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:h==="de"?"Jahreszeit:":h==="fr"?"Saison:":"Season:"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:$,onChange:K=>b(K.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-sm font-medium appearance-none bg-white cursor-pointer pr-8",children:Ql.map(K=>e.jsx("option",{value:K,children:I[K][h]||I[K].en},K))}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:B.readingLevel}),e.jsx("div",{className:"flex overflow-x-auto gap-3 pb-2 md:grid md:grid-cols-3 md:gap-4 md:overflow-visible md:pb-0 -mx-4 px-4 md:mx-0 md:px-0",children:me.map(K=>e.jsxs("button",{onClick:()=>a(K.value),className:`flex-shrink-0 w-56 md:w-auto text-left rounded-lg border-2 transition-all overflow-hidden ${t===K.value?"border-indigo-600 ring-2 ring-indigo-200":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"w-full bg-gray-100 p-2 h-48 md:h-56",children:e.jsx("img",{src:K.image,alt:K.label,className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"p-2 md:p-2.5",children:[e.jsx("div",{className:"font-semibold text-sm mb-0.5",children:K.label}),e.jsx("div",{className:"text-xs text-gray-500 whitespace-pre-line",children:K.desc})]})]},K.value))})]}),t&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:B.numberOfPages}),Te?e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-red-700 font-semibold mb-2",children:h==="de"?"Nicht genÃ¼gend Credits":h==="fr"?"CrÃ©dits insuffisants":"Not enough credits"}),e.jsx("p",{className:"text-red-600 text-sm",children:h==="de"?`Du benÃ¶tigst mindestens ${c} Credits fÃ¼r eine Geschichte mit ${re} Seiten. Dir fehlen noch ${O} Credits.`:h==="fr"?`Vous avez besoin d'au moins ${c} crÃ©dits pour une histoire de ${re} pages. Il vous manque ${O} crÃ©dits.`:`You need at least ${c} credits for a ${re}-page story. You need ${O} more credits.`}),e.jsx("p",{className:"text-gray-500 text-xs mt-2",children:h==="de"?`Aktuell: ${v} Credits`:h==="fr"?`Actuel: ${v} crÃ©dits`:`Current: ${v} credits`})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"range",min:re,max:pe,step:xe,value:Math.min(n,pe),onChange:K=>p(parseInt(K.target.value)),className:`w-full h-3 bg-indigo-100 rounded-lg appearance-none cursor-pointer accent-indigo-600 touch-none
                           [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-6 [&::-webkit-slider-thumb]:h-6
                           [&::-webkit-slider-thumb]:bg-indigo-600 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer
                           [&::-webkit-slider-thumb]:shadow-md [&::-webkit-slider-thumb]:hover:bg-indigo-700
                           [&::-moz-range-thumb]:w-6 [&::-moz-range-thumb]:h-6 [&::-moz-range-thumb]:bg-indigo-600
                           [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:cursor-pointer [&::-moz-range-thumb]:border-0`}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:re}),e.jsxs("span",{className:"text-xl font-bold text-indigo-600",children:[n," ",h==="de"?"Seiten":"pages"]}),e.jsxs("span",{className:`text-sm ${Be?"text-orange-500 font-medium":"text-gray-400"}`,children:[pe,Be&&" âš ï¸"]})]}),Be&&e.jsx("div",{className:"text-center text-sm text-orange-600 bg-orange-50 rounded-lg py-2 px-3",children:h==="de"?`Max. ${pe} Seiten mit ${v} Credits mÃ¶glich`:h==="fr"?`Max. ${pe} pages possibles avec ${v} crÃ©dits`:`Max. ${pe} pages possible with ${v} credits`}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-base font-medium text-gray-700",children:de(n,n===4)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t==="1st-grade"?h==="de"?"Jede Seite enthÃ¤lt ein Bild mit Text darunter":h==="fr"?"Chaque page contient une image avec du texte en dessous":"Each page contains an image with text below":h==="de"?"Abwechselnd Textseite und Bildseite":h==="fr"?"Alternance de pages de texte et d'images":"Alternating text page and image page"})]})]})]})]})}function eo({storyCategory:t,storyTopic:a,storyTheme:n,customThemeText:p,onCategoryChange:r,onTopicChange:f,onThemeChange:x,onCustomThemeTextChange:o,onLegacyStoryTypeChange:C}){return e.jsx("div",{className:"space-y-6",children:e.jsx(zl,{storyCategory:t,storyTopic:a,storyTheme:n,customThemeText:p,onCategoryChange:r,onTopicChange:f,onThemeChange:x,onCustomThemeTextChange:o,onLegacyStoryTypeChange:C})})}function to({artStyle:t,onArtStyleChange:a}){const{language:n}=gt(),p=n==="de"?"Kunststil":n==="fr"?"Style artistique":"Art Style";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(jn,{size:24})," ",p]}),e.jsx(Il,{selectedStyle:t,onSelect:a})]})}const so=[{code:"de-ch",name:"Deutsch (Schweiz)"},{code:"de-de",name:"Hochdeutsch"},{code:"de-de-north",name:"Norddeutsch"},{code:"de-de-south",name:"SÃ¼ddeutsch"},{code:"de-at",name:"Deutsch (Ã–sterreich)"},{code:"de-it",name:"Deutsch (SÃ¼dtirol)"},{code:"fr-ch",name:"FranÃ§ais (Suisse)"},{code:"fr-fr",name:"FranÃ§ais (France)"},{code:"fr-be",name:"FranÃ§ais (Belgique)"},{code:"fr-ca",name:"FranÃ§ais (QuÃ©bec)"},{code:"fr-af",name:"FranÃ§ais (Afrique)"},{code:"it-ch",name:"Italiano (Svizzera)"},{code:"it-it",name:"Italiano (Standard)"},{code:"it-it-north",name:"Italiano (Nord)"},{code:"it-it-central",name:"Italiano (Toscana)"},{code:"it-it-south",name:"Italiano (Sud)"},{code:"it-sm",name:"Italiano (San Marino)"},{code:"en-gb",name:"English (British)"},{code:"en-us",name:"English (American)"},{code:"en-ca",name:"English (Canadian)"},{code:"en-au",name:"English (Australian)"},{code:"en-ie",name:"English (Irish)"},{code:"en-za",name:"English (South African)"},{code:"gsw-zh",name:"ZÃ¼ritÃ¼Ã¼tsch"},{code:"gsw-be",name:"BÃ¤rndÃ¼tsch"},{code:"gsw-bs",name:"Baseldytsch"},{code:"gsw-lu",name:"LuzÃ¤rndÃ¼tsch"},{code:"gsw-sg",name:"SanggallerdÃ¼tsch"},{code:"gsw-vs",name:"WalliserdÃ¼tsch"},{code:"gsw-gr",name:"BÃ¼ndnerdÃ¼tsch"},{code:"en",name:"English (British)"},{code:"fr",name:"FranÃ§ais (Suisse)"},{code:"de",name:"Deutsch (Schweiz)"},{code:"it",name:"Italiano (Standard)"}];function ro({characters:t,mainCharacters:a,excludedCharacters:n,storyCategory:p,storyTopic:r,storyTheme:f,customThemeText:x="",onCustomThemeTextChange:o,artStyle:C,storyLanguage:$,languageLevel:b,pages:v,userLocation:B,season:h,storyDetails:k,onStoryDetailsChange:L,dedication:R,onDedicationChange:E,onGenerateIdeas:se,isGeneratingIdeas:q,isGeneratingIdea1:u=!1,isGeneratingIdea2:z=!1,ideaProgress1:J=0,ideaProgress2:_=0,ideaPrompt:Y,ideaFullResponse:I,generatedIdeas:re,onSelectIdea:fe,onUseDirectly:xe,onEditStep:ae,developerMode:he,imageGenMode:Se,onImageGenModeChange:ne,generationMode:c="auto",onGenerationModeChange:Te}){const{language:O}=gt(),pe=O,[Be,me]=d.useState([]),[de,K]=d.useState(null);d.useEffect(()=>{re.length>0?(me([...re]),K(null)):(me([]),K(null))},[re]);const Fe=Z=>{K(Z),fe(Be[Z])},T=()=>t.filter(Z=>a.includes(Z.id)).map(Z=>Z.name).join(", "),X=()=>t.filter(Z=>!a.includes(Z.id)&&!n.includes(Z.id)).map(Z=>Z.name).join(", "),Ae=()=>{const Z=ha.find(Ye=>Ye.id===r);if(Z)return Z.name[pe]||Z.name.en;const Pe=xa.find(Ye=>Ye.id===r);if(Pe)return Pe.name[pe]||Pe.name.en;const ye=pa.find(Ye=>Ye.id===r);if(ye){const Ye=ye.shortName[pe]||ye.shortName.en;return ye.mainPerson?`${Ye} ${ye.mainPerson}`:Ye}return""},be=()=>{if(f==="realistic")return qr.name[pe]||qr.name.en;const Z=Wr.find(Pe=>Pe.id===f);return Z?Z.name[pe]||Z.name.en:""},He=()=>{const Z=ti.find(Pe=>Pe.id===C);return Z?Z.name[pe]||Z.name.en:C},Rt=()=>{const Z=so.find(Pe=>Pe.code===$);return Z?Z.name:$},Ut=()=>b==="1st-grade"?O==="de"?"Bilderbuch":O==="fr"?"Album IllustrÃ©":"Picture Book":b==="standard"?O==="de"?"Kinderbuch":O==="fr"?"Livre Enfant":"Chapter Book":b==="advanced"?O==="de"?"Jugendbuch":O==="fr"?"Roman Jeunesse":"Young Adult":"",Gt=()=>{var Pe,ye;const Z={spring:{de:"FrÃ¼hling",fr:"Printemps",en:"Spring"},summer:{de:"Sommer",fr:"Ã‰tÃ©",en:"Summer"},autumn:{de:"Herbst",fr:"Automne",en:"Autumn"},winter:{de:"Winter",fr:"Hiver",en:"Winter"}};return((Pe=Z[h])==null?void 0:Pe[O])||((ye=Z[h])==null?void 0:ye.en)||h},Os=()=>B!=null&&B.city?B.country?`${B.city}, ${B.country}`:B.city:O==="de"?"Nicht festgelegt":O==="fr"?"Non dÃ©fini":"Not set",i={title:O==="de"?"Geschichte erstellen":O==="fr"?"CrÃ©er l'histoire":"Create Your Story",storyDetails:O==="de"?"Geschichte / Handlung":O==="fr"?"Histoire / Intrigue":"Story / Plot",optional:O==="de"?"(optional)":O==="fr"?"(optionnel)":"(optional)",dedication:O==="de"?"Widmung":O==="fr"?"DÃ©dicace":"Dedication",dedicationPlaceholder:O==="de"?'z.B. "FÃ¼r meine liebe Tochter Emma zum 5. Geburtstag"':O==="fr"?'Par exemple "Pour ma chÃ¨re fille Emma pour son 5Ã¨me anniversaire"':'e.g. "For my dear daughter Emma on her 5th birthday"',dedicationHelp:O==="de"?"Dieser Text wird auf der EinfÃ¼hrungsseite deines Buches gedruckt.":O==="fr"?"Ce texte sera imprimÃ© sur la page d'introduction de ton livre.":"This text will be printed on the initial page of your book.",generateIdeas:O==="de"?"Vorschlag generieren":O==="fr"?"GÃ©nÃ©rer une suggestion":"Generate Suggestion",generating:O==="de"?"Generiere...":O==="fr"?"GÃ©nÃ©ration...":"Generating...",storyType:O==="de"?"Geschichte":O==="fr"?"Histoire":"Story",artStyleLabel:O==="de"?"Kunststil":O==="fr"?"Style":"Art Style",languageLabel:O==="de"?"Sprachvariante":O==="fr"?"Variante de langue":"Language Variant",mainChars:O==="de"?"Hauptfiguren":O==="fr"?"Personnages principaux":"Main characters",supportingChars:O==="de"?"Nebenfiguren":O==="fr"?"Personnages secondaires":"Also in story",level:O==="de"?"Lesestufe":O==="fr"?"Niveau":"Level",pagesLabel:O==="de"?"Seiten":"Pages",lengthLabel:O==="de"?"LÃ¤nge":O==="fr"?"Longueur":"Length",locationLabel:O==="de"?"Ort":O==="fr"?"Lieu":"Location",seasonLabel:O==="de"?"Jahreszeit":O==="fr"?"Saison":"Season",chooseIdea:O==="de"?"WÃ¤hlen Sie eine Idee oder bearbeiten Sie sie:":O==="fr"?"Choisissez une idÃ©e ou modifiez-la:":"Choose an idea or edit it:",useThis:O==="de"?"Diese verwenden":O==="fr"?"Utiliser celle-ci":"Use this",option1:"Option 1",option2:"Option 2",selected:O==="de"?"AusgewÃ¤hlt":O==="fr"?"SÃ©lectionnÃ©":"Selected",customTheme:O==="de"?"Eigenes Thema":O==="fr"?"ThÃ¨me personnalisÃ©":"Custom Theme",customThemePlaceholder:O==="de"?"Beschreibe dein Abenteuer-Thema...":O==="fr"?"DÃ©cris ton thÃ¨me...":"Describe your adventure theme...",useMyTheme:O==="de"?"Mein Thema direkt verwenden":O==="fr"?"Utiliser mon thÃ¨me directement":"Use my theme directly"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(rl,{size:24})," ",i.title]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-2 text-sm bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[i.storyType,":"]}),e.jsx("span",{className:"font-medium truncate",children:p==="adventure"?be():e.jsxs(e.Fragment,{children:[Ae(),f&&f!=="realistic"&&` + ${be()}`]})}),e.jsx("button",{onClick:()=>ae(3),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:O==="de"?"Bearbeiten":"Edit",children:e.jsx(xs,{size:10})})]}),e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[i.mainChars,":"]}),e.jsx("span",{className:"font-medium text-indigo-700 truncate",children:T()||"-"}),e.jsx("button",{onClick:()=>ae(1),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:O==="de"?"Bearbeiten":"Edit",children:e.jsx(xs,{size:10})})]}),e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[i.supportingChars,":"]}),e.jsx("span",{className:"font-medium text-gray-700 truncate",children:X()||"-"}),e.jsx("button",{onClick:()=>ae(1),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:O==="de"?"Bearbeiten":"Edit",children:e.jsx(xs,{size:10})})]}),e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[i.languageLabel,":"]}),e.jsx("span",{className:"font-medium truncate",children:Rt()}),e.jsx("button",{onClick:()=>ae(2),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:O==="de"?"Bearbeiten":"Edit",children:e.jsx(xs,{size:10})})]}),p!=="historical"&&e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[i.locationLabel,":"]}),e.jsx("span",{className:"font-medium truncate",children:Os()}),e.jsx("button",{onClick:()=>ae(2),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:O==="de"?"Bearbeiten":"Edit",children:e.jsx(xs,{size:10})})]}),p!=="historical"&&e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[i.seasonLabel,":"]}),e.jsx("span",{className:"font-medium truncate",children:Gt()}),e.jsx("button",{onClick:()=>ae(2),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:O==="de"?"Bearbeiten":"Edit",children:e.jsx(xs,{size:10})})]}),e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[i.level,":"]}),e.jsx("span",{className:"font-medium truncate",children:Ut()}),e.jsx("button",{onClick:()=>ae(2),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:O==="de"?"Bearbeiten":"Edit",children:e.jsx(xs,{size:10})})]}),e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[i.lengthLabel,":"]}),e.jsxs("span",{className:"font-medium truncate",children:[v," ",i.pagesLabel]}),e.jsx("button",{onClick:()=>ae(2),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:O==="de"?"Bearbeiten":"Edit",children:e.jsx(xs,{size:10})})]}),e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[i.artStyleLabel,":"]}),e.jsx("span",{className:"font-medium truncate",children:He()}),e.jsx("button",{onClick:()=>ae(4),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:O==="de"?"Bearbeiten":"Edit",children:e.jsx(xs,{size:10})})]})]}),f==="custom"&&e.jsxs("div",{className:"bg-indigo-50 border-2 border-indigo-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"text-lg font-semibold text-indigo-800 flex items-center gap-2",children:["âœ¨ ",i.customTheme]}),e.jsxs("button",{onClick:()=>{x.trim()&&(fe(x),xe==null||xe())},disabled:!x.trim(),className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white text-sm rounded-lg font-medium hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:[e.jsx(Vr,{size:14}),i.useMyTheme]})]}),e.jsx("textarea",{value:x,onChange:Z=>o==null?void 0:o(Z.target.value),placeholder:i.customThemePlaceholder,className:"w-full px-3 py-2 border-2 border-indigo-300 rounded-lg focus:border-indigo-500 focus:outline-none text-base bg-white",rows:3}),e.jsx("p",{className:"text-xs text-indigo-600 mt-1",children:O==="de"?"Dieses Thema wird fÃ¼r die Ideengenerierung verwendet. Du kannst es auch direkt als Handlung verwenden.":O==="fr"?"Ce thÃ¨me sera utilisÃ© pour la gÃ©nÃ©ration d'idÃ©es. Tu peux aussi l'utiliser directement comme intrigue.":"This theme will be used for idea generation. You can also use it directly as your plot."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"text-xl font-semibold",children:[i.storyDetails," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("button",{onClick:se,disabled:q,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:q?e.jsxs(e.Fragment,{children:[e.jsx(Lt,{size:18,className:"animate-spin"}),i.generating]}):e.jsxs(e.Fragment,{children:[e.jsx(Mt,{size:18}),i.generateIdeas]})})]}),he&&Y&&e.jsxs("div",{className:"space-y-2 mt-2 text-left",children:[e.jsxs("details",{children:[e.jsxs("summary",{className:"text-xs text-gray-500 cursor-pointer hover:text-gray-700",children:["Show idea generator prompt (",Y.model,")"]}),e.jsx("pre",{className:"mt-1 p-2 rounded text-[9px] whitespace-pre-wrap overflow-auto max-h-64 border bg-gray-100 border-gray-200",children:Y.prompt})]}),I&&e.jsxs("details",{children:[e.jsx("summary",{className:"text-xs text-gray-500 cursor-pointer hover:text-gray-700",children:"Show full LLM response"}),e.jsx("pre",{className:"mt-1 p-2 rounded text-[9px] whitespace-pre-wrap overflow-auto max-h-64 border bg-blue-50 border-blue-200",children:I})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:i.chooseIdea}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[0,1].map(Z=>{const Pe=Be[Z]||"",ye=!!Pe,Ye=(Z===0?u:z)&&!ye,Ve=de===Z,$e=Z===0?i.option1:i.option2;return e.jsxs("div",{className:`flex flex-col rounded-xl overflow-hidden transition-all ${Ye?"ring-1 ring-gray-200 opacity-75":Ve?"ring-4 ring-green-500 shadow-lg shadow-green-100":"ring-1 ring-gray-200 hover:ring-2 hover:ring-indigo-300"}`,children:[e.jsxs("div",{className:`px-4 py-2 font-semibold flex items-center justify-between ${Ye?"bg-gray-100 text-gray-500":Ve?"bg-green-500 text-white":"bg-gray-100 text-gray-700"}`,children:[e.jsx("span",{children:$e}),Ve&&!Ye&&e.jsxs("span",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Vr,{size:16}),i.selected]})]}),Ye?e.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 px-8",children:e.jsxs("div",{className:"text-center text-gray-500 w-full max-w-xs",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"h-2.5 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 rounded-full transition-all duration-300 ease-out",style:{width:`${Z===0?J:_}%`}})}),e.jsxs("div",{className:"text-xs text-gray-400 text-right mt-1",children:[Z===0?J:_,"%"]})]}),e.jsx("p",{className:"text-sm",children:(Z===0?J:_)<80?pe==="de"?"Denke nach...":pe==="fr"?"RÃ©flexion...":"Thinking...":pe==="de"?"Schreibe Idee...":pe==="fr"?"RÃ©daction...":"Writing idea..."})]})}):ye?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{value:Pe,onChange:rt=>{const Ie=[...Be];Ie[Z]=rt.target.value,me(Ie),Ve&&fe(rt.target.value)},className:`w-full px-4 py-3 border-0 focus:outline-none focus:ring-0 text-base resize-none ${Ve?"bg-green-50":"bg-white"}`,rows:10}),e.jsxs("button",{onClick:()=>Fe(Z),className:`flex items-center justify-center gap-2 px-4 py-3 font-semibold transition-all ${Ve?"bg-green-600 text-white cursor-default":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:[e.jsx(Vr,{size:18}),Ve?i.selected:i.useThis]})]}):e.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 text-gray-400",children:e.jsx("p",{className:"text-sm",children:pe==="de"?'Klicke auf "Vorschlag generieren"':pe==="fr"?'Cliquez sur "GÃ©nÃ©rer"':'Click "Generate Suggestion"'})})]},Z)})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xl font-semibold mb-3",children:[i.dedication," ",e.jsx("span",{className:"text-sm font-normal text-gray-500",children:i.optional})]}),e.jsx("textarea",{value:R,onChange:Z=>E(Z.target.value),placeholder:i.dedicationPlaceholder,className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-base",rows:2,maxLength:200}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:i.dedicationHelp})]}),he&&e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4",children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-3 flex items-center gap-2",children:O==="de"?"Entwickler-Optionen":O==="fr"?"Options dÃ©veloppeur":"Developer Options"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:O==="de"?"Bildgenerierungsmodus":O==="fr"?"Mode de gÃ©nÃ©ration d'images":"Image Generation Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ne(null),className:`px-3 py-2 rounded-lg text-sm font-medium ${Se===null?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:O==="de"?"Server-Standard":O==="fr"?"Par dÃ©faut serveur":"Server Default"}),e.jsx("button",{onClick:()=>ne("parallel"),className:`px-3 py-2 rounded-lg text-sm font-medium ${Se==="parallel"?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:O==="de"?"Parallel (schnell)":O==="fr"?"ParallÃ¨le (rapide)":"Parallel (fast)"}),e.jsx("button",{onClick:()=>ne("sequential"),className:`px-3 py-2 rounded-lg text-sm font-medium ${Se==="sequential"?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:O==="de"?"Sequenziell (konsistent)":O==="fr"?"SÃ©quentiel (cohÃ©rent)":"Sequential (consistent)"})]})]}),Te&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Generation Pipeline"}),e.jsxs("select",{value:c,onChange:Z=>Te(Z.target.value),className:"w-full px-3 py-2 border-2 border-yellow-400 rounded-lg focus:border-yellow-600 focus:outline-none text-sm font-medium bg-white",children:[e.jsx("option",{value:"auto",children:"Auto (based on reading level)"}),e.jsx("option",{value:"pictureBook",children:"Single Prompt (Picture Book)"}),e.jsx("option",{value:"outlineAndText",children:"Outline + Text (Standard)"})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Auto: 1st-grade uses single prompt, standard/advanced use outline+text."})]})]})]})}const Yn={en:{title:"Check Your Email",description:"We've sent you a verification link. Your story will start generating automatically once you verify your email!",currentEmail:"Verification sent to",sendVerification:"Send Verification Email",resendVerification:"Resend Verification Email",emailSent:"Verification email sent! Please check your inbox.",changeEmail:"Wrong email? Change it",newEmail:"New email address",currentPassword:"Current password",confirmChange:"Change & Verify",cancel:"Cancel",emailChanged:"Email changed! Please check your new inbox for verification.",checkSpam:"Don't see it? Check your spam folder.",fillAllFields:"Please fill in all fields"},de:{title:"E-Mail prÃ¼fen",description:"Wir haben Ihnen einen BestÃ¤tigungslink gesendet. Ihre Geschichte wird automatisch erstellt, sobald Sie Ihre E-Mail bestÃ¤tigen!",currentEmail:"BestÃ¤tigung gesendet an",sendVerification:"BestÃ¤tigungs-E-Mail senden",resendVerification:"BestÃ¤tigungs-E-Mail erneut senden",emailSent:"BestÃ¤tigungs-E-Mail gesendet! Bitte prÃ¼fen Sie Ihren Posteingang.",changeEmail:"Falsche E-Mail? Ã„ndern",newEmail:"Neue E-Mail-Adresse",currentPassword:"Aktuelles Passwort",confirmChange:"Ã„ndern & BestÃ¤tigen",cancel:"Abbrechen",emailChanged:"E-Mail geÃ¤ndert! Bitte prÃ¼fen Sie Ihren neuen Posteingang fÃ¼r die BestÃ¤tigung.",checkSpam:"Nicht gefunden? PrÃ¼fen Sie Ihren Spam-Ordner.",fillAllFields:"Bitte alle Felder ausfÃ¼llen"},fr:{title:"Verifiez votre e-mail",description:"Nous vous avons envoye un lien de verification. Votre histoire sera generee automatiquement une fois votre e-mail verifie!",currentEmail:"Verification envoyee a",sendVerification:"Envoyer l'e-mail de verification",resendVerification:"Renvoyer l'e-mail de verification",emailSent:"E-mail de verification envoye! Veuillez verifier votre boite de reception.",changeEmail:"Mauvais e-mail? Changer",newEmail:"Nouvelle adresse e-mail",currentPassword:"Mot de passe actuel",confirmChange:"Changer & Verifier",cancel:"Annuler",emailChanged:"E-mail change! Veuillez verifier votre nouvelle boite de reception pour la verification.",checkSpam:"Pas trouve? Verifiez votre dossier spam.",fillAllFields:"Veuillez remplir tous les champs"}};function ao({isOpen:t,onClose:a,onVerified:n}){const{language:p}=gt(),{user:r,refreshUser:f}=sn(),x=Yn[p]||Yn.en,[o,C]=d.useState("verify"),[$,b]=d.useState(!1),[v,B]=d.useState(!1),[h,k]=d.useState(""),[L,R]=d.useState(""),[E,se]=d.useState(!1),[q,u]=d.useState(0),[z,J]=d.useState(""),[_,Y]=d.useState(""),I=d.useRef(null),re=d.useRef(null),fe=d.useRef(!1);if(d.useEffect(()=>(q>0&&(re.current=setTimeout(()=>{u(he=>he-1)},1e3)),()=>{re.current&&clearTimeout(re.current)}),[q]),d.useEffect(()=>{if(t&&!fe.current&&!v){fe.current=!0;const he=setTimeout(async()=>{b(!0);try{const Se=await st.post("/api/auth/send-verification",{});B(!0),R(x.emailSent),Se.cooldown&&u(Se.cooldown)}catch(Se){const ne=Se;ne.retryAfter?(u(ne.retryAfter),B(!0)):k(ne.message||"Failed to send verification email")}finally{b(!1)}},300);return()=>clearTimeout(he)}t||(fe.current=!1)},[t,v,x.emailSent]),d.useEffect(()=>{if(!t){I.current&&(clearInterval(I.current),I.current=null);return}return se(!0),console.log("[EmailVerificationModal] Starting polling"),I.current=setInterval(async()=>{try{const he=await st.get("/api/auth/verification-status");console.log("[EmailVerificationModal] Poll result:",he.emailVerified),he.emailVerified&&(console.log("[EmailVerificationModal] Email verified! Refreshing user..."),await f(),console.log("[EmailVerificationModal] User refreshed, clearing interval"),I.current&&(clearInterval(I.current),I.current=null),se(!1),console.log("[EmailVerificationModal] Calling onVerified callback"),n==null||n(),console.log("[EmailVerificationModal] Calling onClose"),a())}catch(he){console.debug("Verification status poll error:",he)}},3e3),()=>{I.current&&(clearInterval(I.current),I.current=null)}},[t,f,n,a]),!t)return null;const xe=async()=>{b(!0),k("");try{const he=await st.post("/api/auth/send-verification",{});B(!0),R(x.emailSent),he.cooldown&&u(he.cooldown)}catch(he){const Se=he;Se.retryAfter?(u(Se.retryAfter),k(p==="de"?`Bitte warten Sie ${Se.retryAfter} Sekunden`:p==="fr"?`Veuillez patienter ${Se.retryAfter} secondes`:`Please wait ${Se.retryAfter} seconds`)):k(Se.message||"Failed to send verification email")}finally{b(!1)}},ae=async()=>{if(!z||!_){k(x.fillAllFields);return}b(!0),k("");try{await st.post("/api/auth/change-email",{newEmail:z,password:_}),R(x.emailChanged),C("verify"),J(""),Y("")}catch(he){k(he instanceof Error?he.message:"Failed to change email")}finally{b(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-8 animate-fade-in relative",children:[e.jsx("button",{onClick:a,className:"absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:e.jsx(ns,{size:20})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ei,{className:"w-8 h-8 text-indigo-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:x.title}),e.jsx("p",{className:"text-gray-500",children:x.description})]}),h&&e.jsx($n,{variant:"error",className:"mb-4",children:h}),L&&e.jsxs($n,{variant:"success",className:"mb-4",children:[L,e.jsx("p",{className:"text-sm mt-1 opacity-80",children:x.checkSpam})]}),E&&v&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-indigo-600 mb-4",children:[e.jsx(Lt,{size:16,className:"animate-spin"}),e.jsx("span",{className:"text-sm",children:p==="de"?"Warte auf BestÃ¤tigung...":p==="fr"?"En attente de verification...":"Waiting for verification..."})]}),o==="verify"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:x.currentEmail}),e.jsx("p",{className:"font-medium text-gray-800",children:r==null?void 0:r.email})]}),e.jsxs(Ps,{onClick:xe,variant:"primary",loading:$,disabled:q>0,className:"w-full",children:[e.jsx(ps,{size:16,className:"mr-2"}),q>0?`${p==="de"?"Warten":p==="fr"?"Patienter":"Wait"} ${q}s`:v?x.resendVerification:x.sendVerification]}),e.jsxs("button",{onClick:()=>{C("change"),k(""),R("")},className:"w-full text-center text-indigo-600 font-semibold hover:text-indigo-800 flex items-center justify-center gap-2",children:[e.jsx(wt,{size:16}),x.changeEmail]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(Dn,{type:"email",label:x.newEmail,value:z,onChange:he=>J(he.target.value),placeholder:"your@newemail.com",disabled:$}),e.jsx(Dn,{type:"password",label:x.currentPassword,value:_,onChange:he=>Y(he.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",disabled:$}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Ps,{onClick:()=>{C("verify"),k(""),J(""),Y("")},variant:"secondary",className:"flex-1",disabled:$,children:x.cancel}),e.jsx(Ps,{onClick:ae,variant:"primary",loading:$,className:"flex-1",children:x.confirmChange})]})]})]})})}const no={ideaModel:null,outlineModel:null,textModel:null,sceneDescriptionModel:null,imageModel:null,coverImageModel:null,qualityModel:null,imageBackend:null,avatarModel:null},Za={enableAutoRepair:!1,enableFinalChecks:!0,incrementalConsistency:!1,incrementalConsistencyDryRun:!0};function io(){const t=localStorage.getItem("developer_mode")==="true",[a,n]=d.useState(t),[p,r]=d.useState(null),[f,x]=d.useState("auto"),[o,C]=d.useState(!1),[$,b]=d.useState(!1),[v,B]=d.useState(!1),[h,k]=d.useState(!1),[L,R]=d.useState(t),[E,se]=d.useState(Za.enableAutoRepair),[q,u]=d.useState(Za.enableFinalChecks),[z,J]=d.useState(Za.incrementalConsistency),[_,Y]=d.useState(Za.incrementalConsistencyDryRun),[I,re]=d.useState(!1),[fe,xe]=d.useState({...no}),ae=he=>{n(he),R(!!he)};return d.useEffect(()=>{a?localStorage.setItem("developer_mode","true"):localStorage.removeItem("developer_mode")},[a]),{developerMode:a,setDeveloperMode:ae,imageGenMode:p,setImageGenMode:r,generationMode:f,setGenerationMode:x,devSkipOutline:o,setDevSkipOutline:C,devSkipText:$,setDevSkipText:b,devSkipSceneDescriptions:v,setDevSkipSceneDescriptions:B,devSkipImages:h,setDevSkipImages:k,devSkipCovers:L,setDevSkipCovers:R,enableAutoRepair:E,setEnableAutoRepair:se,enableFinalChecks:q,setEnableFinalChecks:u,incrementalConsistency:z,setIncrementalConsistency:J,incrementalConsistencyDryRun:_,setIncrementalConsistencyDryRun:Y,loadAllAvatars:I,setLoadAllAvatars:re,modelSelections:fe,setModelSelections:xe}}const y=yn("StoryWizard"),Xn={en:{1:"Add photos of your characters - they'll appear consistently throughout your story!",2:"Set the book length and reading level for your audience",3:"Choose a story type and theme",4:"Pick an illustration style for your book",5:"Review your choices, add plot details, then generate your story!"},de:{1:"FÃ¼ge Fotos deiner Charaktere hinzu - sie erscheinen einheitlich in der gesamten Geschichte!",2:"Lege die BuchlÃ¤nge und das Leseniveau fÃ¼r dein Publikum fest",3:"WÃ¤hle einen Geschichtstyp und ein Thema",4:"WÃ¤hle einen Illustrationsstil fÃ¼r dein Buch",5:"ÃœberprÃ¼fe deine Auswahl, fÃ¼ge Handlungsdetails hinzu und generiere deine Geschichte!"},fr:{1:"Ajoutez des photos de vos personnages - ils apparaÃ®tront de maniÃ¨re cohÃ©rente dans toute votre histoire!",2:"DÃ©finissez la longueur du livre et le niveau de lecture pour votre public",3:"Choisissez un type d'histoire et un thÃ¨me",4:"Choisissez un style d'illustration pour votre livre",5:"VÃ©rifiez vos choix, ajoutez des dÃ©tails de l'intrigue, puis gÃ©nÃ©rez votre histoire!"}};function Po(){const t=Ii(),[a,n]=Bi(),{t:p,language:r}=gt(),{isAuthenticated:f,user:x,updateCredits:o,refreshUser:C,isLoading:$,isImpersonating:b}=sn(),{showSuccess:v,showInfo:B,showError:h}=Ti(),{startTracking:k,stopTracking:L,activeJob:R,isComplete:E,completedStoryId:se,markCompletionViewed:q,hasUnviewedCompletion:u}=Fi(),[z,J]=d.useState(()=>{const l=new URLSearchParams(window.location.search);if(l.get("storyId"))return 6;if(l.get("new")==="true")return 1;const j=localStorage.getItem("wizard_step");return j?parseInt(j,10):1}),[_,Y]=d.useState(()=>!!new URLSearchParams(window.location.search).get("storyId")),[I,re]=d.useState(null),{developerMode:fe,setDeveloperMode:xe,imageGenMode:ae,setImageGenMode:he,generationMode:Se,setGenerationMode:ne,devSkipOutline:c,setDevSkipOutline:Te,devSkipText:O,setDevSkipText:pe,devSkipSceneDescriptions:Be,setDevSkipSceneDescriptions:me,devSkipImages:de,setDevSkipImages:K,devSkipCovers:Fe,setDevSkipCovers:T,enableAutoRepair:X,setEnableAutoRepair:Ae,enableFinalChecks:be,setEnableFinalChecks:He,incrementalConsistency:Rt,setIncrementalConsistency:Ut,incrementalConsistencyDryRun:Gt,setIncrementalConsistencyDryRun:Os,loadAllAvatars:i,setLoadAllAvatars:Z,modelSelections:Pe,setModelSelections:ye}=io(),[Ye,Ve]=d.useState(()=>localStorage.getItem("story_type")||""),[$e,rt]=d.useState(()=>localStorage.getItem("story_category")||""),[Ie,Pt]=d.useState(()=>localStorage.getItem("story_topic")||""),[Ke,is]=d.useState(()=>localStorage.getItem("story_theme")||""),[Jt,Ds]=d.useState(()=>localStorage.getItem("story_custom_theme_text")||""),[xt,Dt]=d.useState(()=>localStorage.getItem("story_art_style")||"watercolor"),[Ce,Oe]=d.useState([]),[lr,mt]=d.useState(null),[A,De]=d.useState(null),ls=d.useRef([]),_s=d.useRef(null),[zt,fs]=d.useState(!1),[St,dt]=d.useState("photo"),[Zt,os]=d.useState(!1),[$s,tt]=d.useState(null),[ds,bs]=d.useState(!1),[cs,Qt]=d.useState(!1),[wr,qs]=d.useState(void 0),[Sr,Vs]=d.useState(void 0),or=d.useRef(null),[ms,Ws]=d.useState(!1),[dr,Ks]=d.useState([]),[ys,Us]=d.useState(null),[vs,Js]=d.useState(null),[ct,Yt]=d.useState({}),[bt,cr]=d.useState({}),[js,Ht]=d.useState([]),Ot=d.useRef(null),Ts=d.useRef(!1),Ns=d.useRef(!1),[ws,mr]=d.useState(!1),[pt,yt]=d.useState(()=>{try{const l=localStorage.getItem("story_main_characters");return l?JSON.parse(l):[]}catch{return[]}}),[ot,_t]=d.useState(()=>{try{const l=localStorage.getItem("story_excluded_characters");return l?JSON.parse(l):[]}catch{return[]}}),[vt,Xt]=d.useState(()=>{try{return localStorage.getItem("story_language_level")||"standard"}catch{return"standard"}}),[jt,Zs]=d.useState(()=>{try{const l=localStorage.getItem("story_language");if(l){if(l==="de")return"de-ch";if(l==="fr")return"fr-ch";if(l==="it")return"it-ch";if(l==="en")return"en-gb";if(l.startsWith("de")||l.startsWith("fr")||l.startsWith("it")||l.startsWith("en")||l.startsWith("gsw"))return l}return"de-ch"}catch{return"de-ch"}}),[ft,Fs]=d.useState(()=>{try{const l=localStorage.getItem("story_pages");return l?parseInt(l):30}catch{return 30}}),[es,zs]=d.useState(()=>localStorage.getItem("story_dedication")||""),[s,P]=d.useState(()=>localStorage.getItem("story_details")||""),[N,Q]=d.useState(!1),[g,ue]=d.useState(!1),[Ee,ut]=d.useState(!1),[qt,It]=d.useState(0),[Ss,ts]=d.useState(0),[Ne,Nt]=d.useState(null),[ur,Is]=d.useState(""),[ss,Bs]=d.useState([]),Cs=d.useRef(null),[Es,Kr]=d.useState(null),[Ms,fa]=d.useState(()=>Yl()),[us,Ls]=d.useState(!1),[ba,Ur]=d.useState(new Set),[ya,Jr]=d.useState(!1),[va,gr]=d.useState(!1),[ja,Cr]=d.useState(!1),[Na,kr]=d.useState(!1),[wa,Zr]=d.useState(!1),[Sa,hr]=d.useState(!1),[Ar,ks]=d.useState({current:0,total:0,message:""}),[Vt,Qs]=d.useState(null),[Ca,Rs]=d.useState(!1),[Pr,gs]=d.useState(""),[Gs,Ys]=d.useState(""),[ka,Qr]=d.useState(""),[Aa,Yr]=d.useState(""),[Pa,Xr]=d.useState(""),[Da,ea]=d.useState(),[$a,ta]=d.useState(),[Ta,sa]=d.useState([]),[Fa,Xs]=d.useState(null),[za,xr]=d.useState(null),[Ia,Dr]=d.useState([]),[Ba,$r]=d.useState([]),[Ea,Tr]=d.useState([]),[Ma,ra]=d.useState(null),[La,pr]=d.useState([]),[Fr,Bt]=d.useState([]),[er,Wt]=d.useState({frontCover:null,initialPage:null,backCover:null}),[Ge,zr]=d.useState(null),[Ir,fr]=d.useState(null),[Ra,aa]=d.useState(!1),[Ga,na]=d.useState(),[Ha,ia]=d.useState(),[Oa,w]=d.useState(),[ie,Me]=d.useState(null),Le=d.useRef(!1),[ze,$t]=d.useState(null),[Ct,Kt]=d.useState({}),[kt,Tt]=d.useState(!1),[nt,br]=d.useState(null),[tr,sr]=d.useState("");d.useEffect(()=>{ls.current=Ce},[Ce]),d.useEffect(()=>{_s.current=A},[A]),d.useEffect(()=>{if(!$&&!f){if(!!localStorage.getItem("auth_token")){y.debug("Token found but not authenticated yet, waiting for state sync...");return}const j=window.location.pathname+window.location.search,m=encodeURIComponent(j);t(`/?login=true&redirect=${m}`)}},[f,$,t]),d.useEffect(()=>{at.getUserLocation().then(l=>{Kr(l),l!=null&&l.city&&at.triggerLandmarkDiscovery(l.city,l.country)})},[]),d.useEffect(()=>{f&&at.getStories({limit:1}).then(({pagination:l})=>{Zr(l.total>0)}).catch(()=>Zr(!1))},[f]);const Br=d.useRef(null);d.useEffect(()=>{const l=a.get("storyId");a.get("new")!=="true"&&(l&&(Br.current=null),R&&!l&&Br.current!==R.jobId&&(y.info("Returning during active generation, restoring progress for job:",R.jobId),Br.current=R.jobId,J(6),Ls(!0),gs(R.storyTitle),fr(R.jobId),at.getJobStatus(R.jobId).then(m=>{var H,S;if(y.info("Restored job status:",{progress:m.progress,hasStoryText:!!m.storyText,storyTextKeys:m.storyText?Object.keys(m.storyText):[],pageTextsCount:(H=m.storyText)!=null&&H.pageTexts?Object.keys(m.storyText.pageTexts).length:0,partialPages:((S=m.partialPages)==null?void 0:S.length)||0}),m.progress&&ks(F=>m.progress.current>=F.current?m.progress:{...F,message:m.progress.message}),m.storyText){const F=m.storyText.pageTexts||{};y.info("Setting progressiveStoryData with",Object.keys(F).length,"pages"),$t({title:m.storyText.title||R.storyTitle,dedication:m.storyText.dedication,pageTexts:F,sceneDescriptions:m.storyText.sceneDescriptions||[],totalPages:m.storyText.totalPages||ft})}else y.warn("No storyText in job status response");if(m.partialPages&&m.partialPages.length>0){const F={};m.partialPages.forEach(G=>{G.pageNumber&&G.imageData&&(F[G.pageNumber]=G.imageData)}),y.info("Restored",Object.keys(F).length,"page images"),Kt(F)}m.partialCovers&&Wt(F=>{var G,D,M;return{frontCover:((G=m.partialCovers)==null?void 0:G.frontCover)||F.frontCover,initialPage:((D=m.partialCovers)==null?void 0:D.initialPage)||F.initialPage,backCover:((M=m.partialCovers)==null?void 0:M.backCover)||F.backCover}})}).catch(m=>{y.error("Failed to restore job status:",m)})),y.debug("Auto-nav check:",{generationComplete:E,completedStoryId:se,urlStoryId:l,hasActiveJob:!!R}),E&&se&&!l&&(y.info("Generation completed, navigating to story:",se),n({storyId:se},{replace:!0})))},[R,E,se,a,n,ft]),d.useEffect(()=>{if(a.get("new")==="true"){y.info("New story requested - resetting all story settings"),Ve(""),rt(""),Pt(""),is(""),Ds(""),Dt("watercolor"),Xt("standard"),Fs(30),zs(""),P(""),yt([]),_t([]),mt(null),localStorage.removeItem("story_type"),localStorage.removeItem("story_category"),localStorage.removeItem("story_topic"),localStorage.removeItem("story_theme"),localStorage.removeItem("story_custom_theme_text"),localStorage.removeItem("story_art_style"),localStorage.removeItem("story_language_level"),localStorage.removeItem("story_pages"),localStorage.removeItem("story_dedication"),localStorage.removeItem("story_details"),localStorage.removeItem("story_main_characters"),localStorage.removeItem("story_excluded_characters"),localStorage.removeItem("wizard_step");const j=new URLSearchParams(a);j.delete("new"),n(j,{replace:!0}),De(null),dt("photo"),J(1)}},[a,n]),d.useEffect(()=>{const l=a.get("storyId");l&&z!==6&&J(6),(async()=>{if(!(!l||!f)){if(Le.current){Le.current=!1,y.info("Skipping story reload - just finished generating");return}y.info("Loading saved story progressively:",l),Y(!0),re(null),Qs(null);try{await at.getStoryProgressively(l,(m,H)=>{var S,F,G;y.info("Metadata loaded:",m.title,`(${H} images to load)`),zr(m.id),gs(m.title||""),Ve(m.storyType||""),Dt(m.artStyle||"pixar"),Yr(m.outline||""),Xr(m.outlinePrompt||""),ea(m.outlineModelId),ta(m.outlineUsage),sa(m.storyTextPrompts||[]),Dr(m.styledAvatarGeneration||[]),$r(m.costumedAvatarGeneration||[]),(S=m.generationLog)!=null&&S.length&&(console.log("[StoryWizard] Loading story metadata, generationLog:",m.generationLog.length,"entries"),Tr(m.generationLog)),m.visualBible?Xs({mainCharacters:m.visualBible.mainCharacters||[],secondaryCharacters:m.visualBible.secondaryCharacters||[],animals:m.visualBible.animals||[],artifacts:m.visualBible.artifacts||[],locations:m.visualBible.locations||[],vehicles:m.visualBible.vehicles||[],clothing:m.visualBible.clothing||[],changeLog:m.visualBible.changeLog||[]}):Xs(null),m.clothingRequirements?xr(m.clothingRequirements):xr(null),Bt(m.sceneImages||[]),pr(m.sceneDescriptions||[]),Wt(m.coverImages||{frontCover:null,initialPage:null,backCover:null}),Xt(m.languageLevel||"standard"),m.language&&Zs(m.language),Ls(!1),aa(m.isPartial||!1),na(m.failureReason),ia(m.generatedPages),w(m.totalPages),Ys(m.story||""),Qr(m.originalStory||m.story||""),Me({storyCategory:m.storyCategory,storyTopic:m.storyTopic,storyTheme:m.storyTheme,storyTypeName:m.storyTypeName,storyDetails:m.storyDetails,artStyle:m.artStyle,language:m.language,languageLevel:m.languageLevel,pages:m.pages,dedication:m.dedication,characters:(F=m.characters)==null?void 0:F.map(D=>{var M;return{id:D.id,name:D.name,isMain:(M=m.mainCharacters)==null?void 0:M.includes(D.id)}}),mainCharacters:m.mainCharacters,relationships:m.relationships,relationshipTexts:m.relationshipTexts,season:m.season,userLocation:m.userLocation}),(G=m.characters)!=null&&G.length&&mt(m.characters.map(D=>{var M,ce;return{id:D.id,name:D.name,photoData:D.photoData||((M=D.photos)==null?void 0:M.face)||((ce=D.photos)==null?void 0:ce.original)}})),J(6),Y(!1),re(null),H>0&&Qs({loaded:0,total:H}),(fe||b)&&at.getStoryDevMetadata(l).then(D=>{var M,ce,ke,je,Re;D&&((M=D.sceneImages)!=null&&M.length&&Bt(Xe=>Xe.map(_e=>{const qe=D.sceneImages.find(le=>le.pageNumber===_e.pageNumber);return qe?{..._e,prompt:qe.prompt??_e.prompt,qualityReasoning:qe.qualityReasoning??_e.qualityReasoning,retryHistory:qe.retryHistory??_e.retryHistory,repairHistory:qe.repairHistory??_e.repairHistory,wasRegenerated:qe.wasRegenerated??_e.wasRegenerated,originalScore:qe.originalScore??_e.originalScore,originalReasoning:qe.originalReasoning??_e.originalReasoning,totalAttempts:qe.totalAttempts??_e.totalAttempts,faceEvaluation:qe.faceEvaluation??_e.faceEvaluation,referencePhotos:qe.referencePhotos??_e.referencePhotos,consistencyRegen:qe.consistencyRegen??_e.consistencyRegen}:_e})),D.coverImages&&Wt(Xe=>{var le;const _e={...Xe},qe=["frontCover","initialPage","backCover"];for(const it of qe){const oe=(le=D.coverImages)==null?void 0:le[it],U=Xe[it];oe&&typeof U=="object"&&U!==null&&(_e[it]={...U,prompt:oe.prompt??U.prompt,qualityReasoning:oe.qualityReasoning??U.qualityReasoning,retryHistory:oe.retryHistory??U.retryHistory,referencePhotos:oe.referencePhotos??U.referencePhotos})}return _e}),console.log("[StoryWizard] Dev metadata generationLog:",((ce=D.generationLog)==null?void 0:ce.length)||0,"entries"),(ke=D.generationLog)!=null&&ke.length&&Tr(D.generationLog),(je=D.styledAvatarGeneration)!=null&&je.length&&(console.log("[StoryWizard] Dev metadata styledAvatarGeneration:",D.styledAvatarGeneration.length,"entries"),Dr(D.styledAvatarGeneration)),(Re=D.costumedAvatarGeneration)!=null&&Re.length&&(console.log("[StoryWizard] Dev metadata costumedAvatarGeneration:",D.costumedAvatarGeneration.length,"entries"),$r(D.costumedAvatarGeneration)),D.finalChecksReport&&(console.log("[StoryWizard] Dev metadata finalChecksReport:",D.finalChecksReport.totalIssues,"issues"),ra(D.finalChecksReport)),y.debug("Dev metadata merged into story"))}).catch(D=>{y.warn("Failed to load dev metadata:",D)})},(m,H,S,F)=>{if(typeof m=="number")Bt(G=>G.map(D=>D.pageNumber===m?{...D,imageData:H,imageVersions:S}:D));else{const G=m;Wt(D=>{const M=D[G];return typeof M=="object"&&M!==null?{...D,[G]:{...M,imageData:H}}:{...D,[G]:H}})}F!==void 0&&Qs(G=>G?{...G,loaded:F}:null)},()=>{y.info("All images loaded"),Qs(null)})}catch(m){y.error("Failed to load story:",m),Y(!1),re(null),Qs(null)}}})()},[a,f]),d.useEffect(()=>{z===6&&u&&(y.info("Clearing unviewed completion - user is viewing story"),q())},[z,u,q]),d.useEffect(()=>{(async()=>{const j=a.get("payment"),m=a.get("session_id");if(j==="success"&&m){y.info("Payment successful! Checking order status..."),y.info("Session ID:",m);try{const F=await at.getOrderStatus(m);if(y.info("Order Status:",F),F.order){const G=`CHF ${(F.order.amount_total/100).toFixed(2)}`,D={en:"Payment Successful!",de:"Zahlung erfolgreich!",fr:"Paiement rÃ©ussi!"},M={en:"Your book order has been received and will be printed soon.",de:"Ihre Buchbestellung wurde entgegengenommen und wird bald gedruckt.",fr:"Votre commande de livre a Ã©tÃ© reÃ§ue et sera bientÃ´t imprimÃ©e."},ce=[`${r==="de"?"Kunde":r==="fr"?"Client":"Customer"}: ${F.order.customer_name}`,`Email: ${F.order.customer_email}`,`${r==="de"?"Betrag":r==="fr"?"Montant":"Amount"}: ${G}`,`${r==="de"?"Versand an":r==="fr"?"ExpÃ©diÃ© Ã ":"Shipping to"}: ${F.order.shipping_name}`,`${F.order.shipping_address_line1}`,`${F.order.shipping_postal_code} ${F.order.shipping_city}`,`${F.order.shipping_country}`];v(M[r]||M.en,D[r]||D.en,ce)}}catch(F){y.error("Error checking order status:",F)}const S=new URLSearchParams(a);S.delete("payment"),S.delete("session_id"),n(S,{replace:!0})}else if(j==="cancelled"){y.info("Payment cancelled by user");const S={en:"Payment was cancelled. You can try again when ready.",de:"Zahlung wurde abgebrochen. Sie kÃ¶nnen es erneut versuchen.",fr:"Paiement annulÃ©. Vous pouvez rÃ©essayer quand vous Ãªtes prÃªt."};B(S[r]||S.en,r==="de"?"Abgebrochen":r==="fr"?"AnnulÃ©":"Cancelled");const F=new URLSearchParams(a);F.delete("payment"),n(F,{replace:!0})}const H=a.get("credits_payment");if(H==="success"){y.info("Credits payment successful!"),await C();const S={en:"Credits Added!",de:"Credits hinzugefuegt!",fr:"Credits ajoutes!"},F={en:"100 credits have been added to your account.",de:"100 Credits wurden Ihrem Konto gutgeschrieben.",fr:"100 credits ont ete ajoutes a votre compte."};v(F[r]||F.en,S[r]||S.en);const G=new URLSearchParams(a);G.delete("credits_payment"),G.delete("session_id"),n(G,{replace:!0})}else if(H==="cancelled"){y.info("Credits payment cancelled by user");const S={en:"Credits purchase was cancelled.",de:"Kreditkauf wurde abgebrochen.",fr:"L'achat de credits a ete annule."};B(S[r]||S.en,r==="de"?"Abgebrochen":r==="fr"?"Annule":"Cancelled");const F=new URLSearchParams(a);F.delete("credits_payment"),n(F,{replace:!0})}})()},[a,n,r,v,B,C]);const yr=d.useRef(!1);d.useEffect(()=>{if(a.get("autoGenerate")==="true"&&!yr.current){yr.current=!0;const j=localStorage.getItem("pending_story_type"),m=localStorage.getItem("pending_art_style");j&&(Ve(j),localStorage.removeItem("pending_story_type")),m&&(Dt(m),localStorage.removeItem("pending_art_style")),J(6);const H=new URLSearchParams(a);H.delete("autoGenerate"),n(H,{replace:!0})}},[a,n]);const Er=l=>{if(l.length===0)return;const j=l.filter(m=>{const H=parseInt(m.age);return H>=1&&H<=10});if(j.length>0){const m=j.map(H=>H.id);yt(m),y.info(`Auto-selected ${j.length} main character(s) aged 1-10`)}else{const m=l.reduce((H,S)=>{const F=parseInt(S.age)||999,G=parseInt(H.age)||999;return F<G?S:H});yt([m.id]),y.info(`Auto-selected youngest character as main: ${m.name} (age ${m.age})`)}};d.useEffect(()=>{f?(async()=>{try{Y(!0);const j=await Ze.getCharacterData(i);y.info("Loaded character data from API:",{characters:j.characters.length,relationships:Object.keys(j.relationships).length}),Oe(j.characters),Object.keys(j.relationships).length>0&&(Yt(j.relationships),Ts.current=!0),Object.keys(j.relationshipTexts).length>0&&cr(j.relationshipTexts),j.customRelationships.length>0&&Ht(j.customRelationships),j.characters.length>0&&Er(j.characters)}catch(j){y.error("Failed to load character data:",j)}finally{Y(!1),mr(!0)}})():$||mr(!0)},[f,$]),d.useEffect(()=>{i&&f&&ws&&(async()=>{try{y.info("Reloading characters with full avatars (dev mode)");const j=await Ze.getCharacterData(!0);Oe(j.characters),y.info(`Loaded ${j.characters.length} characters with full avatars`)}catch(j){y.error("Failed to reload with full avatars:",j)}})()},[i,f,ws]),d.useEffect(()=>{z===1&&Ce.length===0&&!A&&!_&&ws&&nn()},[z,Ce.length,A,_,ws]),d.useEffect(()=>{localStorage.setItem("story_main_characters",JSON.stringify(pt))},[pt]),d.useEffect(()=>{localStorage.setItem("story_excluded_characters",JSON.stringify(ot))},[ot]);const Mr=d.useRef(ot);d.useEffect(()=>{Mr.current!==ot&&JSON.stringify(Mr.current)!==JSON.stringify(ot)&&(Bs([]),P(""),Mr.current=ot)},[ot]),d.useEffect(()=>{localStorage.setItem("story_language_level",vt)},[vt]),d.useEffect(()=>{localStorage.setItem("story_language",jt)},[jt]),d.useEffect(()=>{localStorage.setItem("story_pages",ft.toString())},[ft]),d.useEffect(()=>{localStorage.setItem("story_dedication",es)},[es]),d.useEffect(()=>{localStorage.setItem("story_details",s)},[s]),d.useEffect(()=>{localStorage.setItem("story_type",Ye)},[Ye]),d.useEffect(()=>{$e?localStorage.setItem("story_category",$e):localStorage.removeItem("story_category")},[$e]),d.useEffect(()=>{Ie?localStorage.setItem("story_topic",Ie):localStorage.removeItem("story_topic")},[Ie]),d.useEffect(()=>{Ke?localStorage.setItem("story_theme",Ke):localStorage.removeItem("story_theme")},[Ke]),d.useEffect(()=>{Jt?localStorage.setItem("story_custom_theme_text",Jt):localStorage.removeItem("story_custom_theme_text")},[Jt]);const la=d.useRef($e),oa=d.useRef(Ie),Nn=d.useRef(Ke),wn=d.useRef(!0);d.useEffect(()=>{if(wn.current){wn.current=!1;return}const l=la.current!==$e,j=oa.current!==Ie,m=Nn.current!==Ke;(l||j||m)&&(P(""),localStorage.removeItem("story_details"),Bs([])),la.current=$e,oa.current=Ie,Nn.current=Ke},[$e,Ie,Ke]),d.useEffect(()=>{localStorage.setItem("story_art_style",xt)},[xt]);const da=d.useRef(!1);d.useEffect(()=>{if(z===4&&!da.current&&!N&&ss.length===0){const l=!!$e,j=!!Ke||!!Ie,m=Ce.length>0;l&&j&&m&&(da.current=!0,y.info("[StoryWizard] Pre-generating story ideas while user selects art style"),kn())}da.current&&ss.length===0&&(da.current=!1)},[z,$e,Ke,Ie,Ce.length,N,ss.length]);const Sn=d.useRef({storyCategory:$e,storyTheme:Ke,storyTopic:Ie});d.useEffect(()=>{const l=Sn.current,j=l.storyCategory!==$e||l.storyTheme!==Ke||l.storyTopic!==Ie;Sn.current={storyCategory:$e,storyTheme:Ke,storyTopic:Ie},j&&(N||ss.length>0)&&(y.info("[StoryWizard] Story inputs changed - aborting idea generation and clearing results"),Cs.current&&(Cs.current.abort(),Cs.current=null),Q(!1),ue(!1),ut(!1),Bs([]),Nt(null),Is(""),da.current=!1)},[$e,Ke,Ie,N,ss.length]),d.useEffect(()=>{if(!N)return;const j=setTimeout(()=>{y.warn("[StoryWizard] Safety timeout - resetting isGeneratingIdeas after 2.5 minutes"),Q(!1),ue(!1),ut(!1),h(r==="de"?"ZeitÃ¼berschreitung bei der Ideengenerierung. Bitte versuchen Sie es erneut.":r==="fr"?"DÃ©lai d'attente de gÃ©nÃ©ration d'idÃ©es. Veuillez rÃ©essayer.":"Idea generation timed out. Please try again.")},15e4);return()=>clearTimeout(j)},[N,r]),d.useEffect(()=>{if(!g&&!Ee){It(0),ts(0);return}const l=35e3,j=80,m=100,H=Date.now(),S=setInterval(()=>{const F=Date.now()-H,G=Math.min(F/l,1),D=1-Math.pow(1-G,3),M=Math.round(D*j);g&&It(M),Ee&&ts(M),G>=1&&clearInterval(S)},m);return()=>clearInterval(S)},[g,Ee]),d.useEffect(()=>{z>=1&&z<=5&&localStorage.setItem("wizard_step",z.toString())},[z]);const ni=l=>{rt(l)},ii=l=>{is(l),($e==="adventure"&&l!==""||($e==="life-challenge"||$e==="educational")&&Ie!==""&&l!==""&&l!=="realistic")&&rr(4)},li=l=>{Pt(l)},oi=l=>{Dt(l),rr(5)};d.useEffect(()=>{if(z===2&&Ce.length>=2&&!_){const l=Ce.map(j=>j.id).sort().join("-");if(!Ot.current||Ot.current!==l){const m=si(r);y.debug("Initializing relationships for step 2",{charKey:l,existingCount:Object.keys(ct).length}),Yt(H=>{const S={...H};let F=!1;return Ce.forEach((G,D)=>{Ce.forEach((M,ce)=>{if(D!==ce){const ke=`${G.id}-${M.id}`;S[ke]||(S[ke]=m,F=!0,y.debug("Initializing missing relationship:",ke))}})}),F?S:H}),Ot.current=l}}},[z,Ce,r,_]);const di=()=>{if(Ce.length<2)return!0;for(let l=0;l<Ce.length;l++)for(let j=0;j<Ce.length;j++)if(l!==j){const m=`${Ce[l].id}-${Ce[j].id}`,H=ct[m];if(!H||bn(H))return!1}return!0},ci=()=>{if(Ce.length<2)return null;let l=0,j=null;for(const m of Ce){let H=0;for(const S of Ce)if(m.id!==S.id){const F=`${m.id}-${S.id}`,G=ct[F];(!G||bn(G))&&H++}H>l&&(l=H,j=m)}return j},nn=()=>{De({id:Date.now(),name:"",gender:void 0,age:"",traits:{strengths:[],flaws:[],challenges:[]}}),dt("photo"),fs(!1)},mi=(l,j=1500)=>new Promise(m=>{const H=new Image;H.onload=()=>{const S=document.createElement("canvas");let{width:F,height:G}=H;(F>j||G>j)&&(F>G?(G=Math.round(G*j/F),F=j):(F=Math.round(F*j/G),G=j)),S.width=F,S.height=G;const D=S.getContext("2d");D==null||D.drawImage(H,0,0,F,G),m(S.toDataURL("image/jpeg",.85))},H.onerror=()=>m(l),H.src=l}),ui=async(l,j)=>{var S,F,G,D,M;if(y.info(`ðŸ“¸ handlePhotoSelect called: file=${l==null?void 0:l.name}, character=${A==null?void 0:A.name}, developerMode=${fe}`),A&&!fe){const ce=!!((S=A.avatars)!=null&&S.winter||(F=A.avatars)!=null&&F.standard||(G=A.avatars)!=null&&G.summer||(D=A.avatars)!=null&&D.hasFullAvatars);if(y.info(`ðŸ“¸ hasAvatars=${ce}`),ce){const ke=Ya(A.id);if(y.info(`ðŸ“¸ cooldown check: canRegenerate=${ke.canRegenerate}, waitSeconds=${ke.waitSeconds}`),!ke.canRegenerate){const je=r==="de"?`Bitte warten Sie ${ke.waitSeconds} Sekunden, bevor Sie ein neues Foto hochladen.`:`Please wait ${ke.waitSeconds} seconds before uploading a new photo.`;h(je);return}ai(A.id)}}const m=j&&((M=A==null?void 0:A.clothing)!=null&&M.structured)?{...A.clothing.structured}:null,H=new FileReader;H.onload=async ce=>{var je,Re,Xe,_e,qe,le,it,oe,U,V,ee,W;const ke=(je=ce.target)==null?void 0:je.result;A&&(or.current={physical:A.physical,gender:A.gender,age:A.age}),qs(void 0),os(!0),!(A!=null&&A.name)||A.name.trim().length<2?dt("name"):(dt("traits"),y.info("ðŸ“¸ Character has name, going to traits step to show avatar regeneration"));try{const ge=await mi(ke),Ue=Math.round(ke.length/1024),te=Math.round(ge.length/1024);y.info(`Starting photo analysis... (${Ue}KB -> ${te}KB)`);const We=A!=null&&A.id&&A.id>0?A.id:void 0,we=await Ze.analyzePhoto(ge,r,void 0,void 0,We);if(we.success){if(we.multipleFacesDetected&&we.faces&&we.faces.length>1){y.info(`Multiple faces detected (${we.faces.length}), showing selection modal`),Us(ge),Js(m?{structured:m}:null),Ks(we.faces),Ws(!0),os(!1);return}y.info("Photo analysis complete:",{hasPhotos:!!we.photos,hasPhysical:!!we.physical,hasClothing:!!we.clothing,age:we.age,gender:we.gender}),we._debug&&(Vs(we._debug),we._debug.rawResponse,we._debug.error&&console.warn("ðŸ“¸ [DEBUG] Gemini error:",we._debug.error));const et={original:((Re=we.photos)==null?void 0:Re.face)||ke,face:(Xe=we.photos)==null?void 0:Xe.face,body:((_e=we.photos)==null?void 0:_e.body)||ke,bodyNoBg:(qe=we.photos)==null?void 0:qe.bodyNoBg,faceBox:(le=we.photos)==null?void 0:le.faceBox,bodyBox:(it=we.photos)==null?void 0:it.bodyBox},ht=(oe=we.photos)!=null&&oe.bodyNoBg?Math.round(we.photos.bodyNoBg.length/1024):0,At=(U=we.photos)!=null&&U.body?Math.round(we.photos.body.length/1024):0,_a=(V=we.photos)!=null&&V.face?Math.round(we.photos.face.length/1024):0;if(y.info(`ðŸ“¸ [PHOTO CHANGE] Analysis returned: bodyNoBg=${ht}KB, body=${At}KB, face=${_a}KB`),(ee=we.photos)!=null&&ee.bodyNoBg){const Je=we.photos.bodyNoBg.substring(we.photos.bodyNoBg.indexOf("base64,")+7,we.photos.bodyNoBg.indexOf("base64,")+27);y.info(`ðŸ“¸ [PHOTO CHANGE] bodyNoBg fingerprint: ${Je}...`)}let hs,qa;m?(hs={structured:m},qa={upperBody:m.upperBody?"user":void 0,lowerBody:m.lowerBody?"user":void 0,shoes:m.shoes?"user":void 0,fullBody:m.fullBody?"user":void 0},y.info(`ðŸ‘• Keeping old clothing (marked as user-edited): ${JSON.stringify(m)}`)):y.info("ðŸ‘• Using new photo's clothing (cleared existing)");const Va=we.characterId,on=(A==null?void 0:A.id)&&A.id>0,Lr=on?A.id:Va;on?y.info(`ðŸ“¸ [PHOTO] Keeping existing character ID: ${A.id} (server created new ID ${Va} but ignoring)`):Va&&y.info(`ðŸ“¸ [PHOTO] Using server-created character ID: ${Va}`);const rs=A?{...A,id:Lr||A.id,photos:et,avatars:{status:"generating"},clothing:hs,clothingSource:qa}:null;if(rs){const Je=(W=rs.photos)==null?void 0:W.bodyNoBg,Et=Je?Math.round(Je.length/1024):0;if(y.info(`ðŸ“¸ [CHAR FOR GEN] bodyNoBg=${Et}KB, has photos: ${!!rs.photos}`),Je){const Qe=Je.substring(Je.indexOf("base64,")+7,Je.indexOf("base64,")+27);y.info(`ðŸ“¸ [CHAR FOR GEN] fingerprint: ${Qe}...`)}}if(De(Je=>{var Qe;if(!Je)return null;const Et=(Qe=Je.avatars)!=null&&Qe.standard?{...Je.avatars,status:"generating",stale:!0}:{status:"generating"};return{...Je,id:Lr||Je.id,photos:et,avatars:Et,clothing:hs,clothingSource:qa}}),Lr&&!on&&Oe(Je=>{if(!Je.some(Qe=>Qe.id===Lr)){const Qe={...A,id:Lr,photos:et,avatars:{status:"generating"},clothing:hs,clothingSource:qa};return y.info(`ðŸ“¸ Adding new character ${Lr} to array to prevent data loss`),[...Je,Qe]}return Je}),y.info("ðŸŽ¨ Auto-starting avatar generation in background..."),y.info(`ðŸ“¸ Photo for avatar: bodyNoBg=${!!et.bodyNoBg}, body=${!!et.body}, face=${!!et.face}`),rs&&rs.id&&rs.name&&rs.name.trim()){const Je=rs.id;tt(Je),Ze.generateAndSaveAvatarForCharacter(rs,void 0,{avatarModel:Pe.avatarModel||void 0}).then(Et=>{Et.success&&Et.character?(De(Qe=>!Qe||Qe.id!==Je?Qe:{...Qe,avatars:Et.character.avatars,physical:Et.character.physical,clothing:Et.character.clothing}),Oe(Qe=>Qe.map(as=>as.id===Je?{...as,...Et.character,id:as.id}:as)),y.success(`âœ… Avatar generated and traits extracted for ${rs.name}`)):(y.error(`âŒ Avatar generation failed: ${Et.error}`),De(Qe=>Qe&&Qe.id===Je?{...Qe,avatars:{status:"failed"}}:Qe),Oe(Qe=>Qe.map(as=>as.id===Je?{...as,avatars:{status:"failed"}}:as)))}).catch(Et=>{y.error("âŒ Avatar generation error:",Et),De(Qe=>Qe&&Qe.id===Je?{...Qe,avatars:{status:"failed"}}:Qe),Oe(Qe=>Qe.map(as=>as.id===Je?{...as,avatars:{status:"failed"}}:as))}).finally(()=>{tt(null)})}else rs&&rs.id?(y.info("â­ï¸ Skipping auto-generation: character has no name yet"),tt(null),De(Je=>Je&&{...Je,avatars:{status:"pending"}})):(y.warn("â­ï¸ Skipping auto-generation: no character data available"),tt(null))}else we.error==="no_face_detected"?(y.warn("No face detected in photo"),h(p.noFaceDetected)):(y.warn("Photo analysis returned no data, using original photo"),De(et=>et?{...et,photos:{original:ke},avatars:void 0}:null))}catch(ge){y.error("Photo analysis error:",ge),De(Ue=>Ue?{...Ue,photos:{original:ke},avatars:void 0}:null)}finally{os(!1)}},H.readAsDataURL(l)},gi=async l=>{var j,m,H,S,F,G,D,M;if(!ys){y.error("No pending photo data for face selection");return}Ws(!1),os(!0);try{y.info(`Re-analyzing photo with selected face ID: ${l}`);const ce=dr.map(Re=>({id:Re.id,x:Re.faceBox.x,y:Re.faceBox.y,width:Re.faceBox.width,height:Re.faceBox.height,confidence:Re.confidence})),ke=A!=null&&A.id&&A.id>0?A.id:void 0,je=await Ze.analyzePhoto(ys,r,l,ce,ke);if(je.success){y.info("Photo analysis complete with selected face:",{hasPhotos:!!je.photos,hasPhysical:!!je.physical,hasClothing:!!je.clothing,age:je.age,gender:je.gender}),je._debug&&Vs(je._debug);const Re=vs==null?void 0:vs.structured,Xe={original:((j=je.photos)==null?void 0:j.face)||ys,face:(m=je.photos)==null?void 0:m.face,body:((H=je.photos)==null?void 0:H.body)||ys,bodyNoBg:(S=je.photos)==null?void 0:S.bodyNoBg,faceBox:(F=je.photos)==null?void 0:F.faceBox,bodyBox:(G=je.photos)==null?void 0:G.bodyBox},_e=(D=je.photos)!=null&&D.bodyNoBg?Math.round(je.photos.bodyNoBg.length/1024):0;if(y.info(`ðŸ“¸ [FACE SELECT] Analysis returned: bodyNoBg=${_e}KB`),(M=je.photos)!=null&&M.bodyNoBg){const ee=je.photos.bodyNoBg.substring(je.photos.bodyNoBg.indexOf("base64,")+7,je.photos.bodyNoBg.indexOf("base64,")+27);y.info(`ðŸ“¸ [FACE SELECT] bodyNoBg fingerprint: ${ee}...`)}let qe,le;Re&&(qe={structured:Re},le={upperBody:Re.upperBody?"user":void 0,lowerBody:Re.lowerBody?"user":void 0,shoes:Re.shoes?"user":void 0,fullBody:Re.fullBody?"user":void 0});const it=je.characterId,oe=(A==null?void 0:A.id)&&A.id>0,U=oe?A.id:it;oe?y.info(`ðŸ“¸ [FACE SELECT] Keeping existing character ID: ${A.id} (server created new ID ${it} but ignoring)`):it&&y.info(`ðŸ“¸ [FACE SELECT] Using server-created character ID: ${it}`);const V=A?{...A,id:U||A.id,photos:Xe,avatars:{status:"generating"},clothing:qe,clothingSource:le}:null;if(De(ee=>{var ge;if(!ee)return null;const W=(ge=ee.avatars)!=null&&ge.standard?{...ee.avatars,status:"generating",stale:!0}:{status:"generating"};return{...ee,id:U||ee.id,photos:Xe,avatars:W,clothing:qe,clothingSource:le}}),U&&!oe&&Oe(ee=>{if(!ee.some(ge=>ge.id===U)){const ge={...A,id:U,photos:Xe,avatars:{status:"generating"},clothing:qe,clothingSource:le};return y.info(`ðŸ“¸ [FACE SELECT] Adding new character ${U} to array to prevent data loss`),[...ee,ge]}return ee}),A!=null&&A.name&&A.name.trim().length>=2?(dt("traits"),y.info("ðŸ“¸ Face selected, character has name, going to traits step")):dt("name"),y.info("ðŸŽ¨ Auto-starting avatar generation in background after face selection..."),y.info(`ðŸ“¸ Photo for avatar: bodyNoBg=${!!Xe.bodyNoBg}, body=${!!Xe.body}, face=${!!Xe.face}`),V&&V.name&&V.name.trim()){const ee=V.id;tt(ee),Ze.generateAndSaveAvatarForCharacter(V,void 0,{avatarModel:Pe.avatarModel||void 0}).then(W=>{W.success&&W.character?(De(ge=>!ge||ge.id!==ee?ge:{...ge,avatars:W.character.avatars,physical:W.character.physical,clothing:W.character.clothing}),Oe(ge=>ge.map(Ue=>Ue.id===ee?{...Ue,...W.character,id:Ue.id}:Ue)),y.success(`âœ… Avatar generated for ${V.name} (face selection)`)):(y.error(`âŒ Avatar generation failed: ${W.error}`),De(ge=>ge&&ge.id===ee?{...ge,avatars:{status:"failed"}}:ge),Oe(ge=>ge.map(Ue=>Ue.id===ee?{...Ue,avatars:{status:"failed"}}:Ue)))}).catch(W=>{y.error("âŒ Avatar generation error:",W),De(ge=>ge&&ge.id===ee?{...ge,avatars:{status:"failed"}}:ge),Oe(ge=>ge.map(Ue=>Ue.id===ee?{...Ue,avatars:{status:"failed"}}:Ue))}).finally(()=>{tt(null)})}else y.info("â­ï¸ Skipping auto-generation: character has no name yet"),tt(null),De(ee=>ee&&{...ee,avatars:{status:"pending"}})}else y.warn("Photo analysis failed after face selection"),h(p.noFaceDetected)}catch(ce){y.error("Photo analysis error after face selection:",ce),h("Failed to analyze photo. Please try again.")}finally{os(!1),Us(null),Js(null),Ks([])}},hi=()=>{Ws(!1),Us(null),Js(null),Ks([]),dt("photo")},xi=async()=>{if(A){De(l=>l&&{...l,avatars:void 0}),bs(!0);try{y.info(`ðŸ”„ Regenerating avatars for ${A.name}...`);const l=await Ze.regenerateAvatarsForCharacter(A.id,(j,m)=>y.info(`[${j}] ${m}`),{avatarModel:Pe.avatarModel||void 0});if(l.success&&l.character){const j={...l.character.avatars,stale:!1};De(m=>m&&{...m,avatars:j,physical:l.character.physical,clothing:l.character.clothing}),Oe(m=>m.map(H=>H.id===A.id?{...H,avatars:j,physical:l.character.physical,clothing:l.character.clothing}:H)),y.success(`âœ… Avatars and traits regenerated for ${A.name}`)}else y.error(`âŒ Failed to regenerate avatars: ${l.error}`),h(`Failed to regenerate avatars: ${l.error||"Unknown error"}`)}catch(l){y.error(`âŒ Failed to regenerate avatars for ${A.name}:`,l),h(`Failed to regenerate avatars: ${l instanceof Error?l.message:"Unknown error"}`)}finally{bs(!1)}}},pi=async()=>{var l,j,m,H,S,F,G,D,M,ce,ke,je,Re,Xe,_e,qe;if(A){De(le=>le&&{...le,avatars:void 0}),Qt(!0);try{y.info(`ðŸ”„ Regenerating avatars WITH TRAITS for ${A.name}...`),y.info(`Physical traits: ${JSON.stringify(A.physical)}`);const le=await Ze.generateClothingAvatarsWithTraits(A);if(le.success&&le.avatars){const it={...le.avatars,stale:!1,generatedAt:new Date().toISOString()},oe=A.physicalTraitsSource||{},U=le.extractedTraits?{height:(l=A.physical)==null?void 0:l.height,eyeColor:oe.eyeColor==="user"?(j=A.physical)==null?void 0:j.eyeColor:le.extractedTraits.eyeColor,eyeColorHex:oe.eyeColor==="user"?(m=A.physical)==null?void 0:m.eyeColorHex:le.extractedTraits.eyeColorHex,hairColor:oe.hairColor==="user"?(H=A.physical)==null?void 0:H.hairColor:le.extractedTraits.hairColor,hairColorHex:oe.hairColor==="user"?(S=A.physical)==null?void 0:S.hairColorHex:le.extractedTraits.hairColorHex,hairLength:oe.hairLength==="user"?(F=A.physical)==null?void 0:F.hairLength:le.extractedTraits.hairLength,hairStyle:oe.hairStyle==="user"?(G=A.physical)==null?void 0:G.hairStyle:le.extractedTraits.hairStyle,build:oe.build==="user"?(D=A.physical)==null?void 0:D.build:le.extractedTraits.build,face:oe.face==="user"?(M=A.physical)==null?void 0:M.face:le.extractedTraits.face,facialHair:oe.facialHair==="user"?(ce=A.physical)==null?void 0:ce.facialHair:le.extractedTraits.facialHair,other:oe.other==="user"?(ke=A.physical)==null?void 0:ke.other:le.extractedTraits.other,skinTone:oe.skinTone==="user"?(je=A.physical)==null?void 0:je.skinTone:le.extractedTraits.skinTone,skinToneHex:oe.skinTone==="user"?(Re=A.physical)==null?void 0:Re.skinToneHex:le.extractedTraits.skinToneHex,detailedHairAnalysis:le.extractedTraits.detailedHairAnalysis||((Xe=A.physical)==null?void 0:Xe.detailedHairAnalysis),apparentAge:oe.apparentAge==="user"?(_e=A.physical)==null?void 0:_e.apparentAge:le.extractedTraits.apparentAge||((qe=A.physical)==null?void 0:qe.apparentAge)}:A.physical,V=le.extractedTraits?{eyeColor:oe.eyeColor==="user"?"user":le.extractedTraits.eyeColor?"extracted":void 0,hairColor:oe.hairColor==="user"?"user":le.extractedTraits.hairColor?"extracted":void 0,hairLength:oe.hairLength==="user"?"user":le.extractedTraits.hairLength?"extracted":void 0,hairStyle:oe.hairStyle==="user"?"user":le.extractedTraits.hairStyle?"extracted":void 0,build:oe.build==="user"?"user":le.extractedTraits.build?"extracted":void 0,face:oe.face==="user"?"user":le.extractedTraits.face?"extracted":void 0,facialHair:oe.facialHair==="user"?"user":le.extractedTraits.facialHair?"extracted":void 0,other:oe.other==="user"?"user":le.extractedTraits.other?"extracted":void 0,skinTone:oe.skinTone==="user"?"user":le.extractedTraits.skinTone?"extracted":void 0,apparentAge:oe.apparentAge==="user"?"user":le.extractedTraits.apparentAge?"extracted":void 0}:A.physicalTraitsSource,ee=le.extractedClothing?{...A.clothing,structured:{upperBody:le.extractedClothing.upperBody||void 0,lowerBody:le.extractedClothing.lowerBody||void 0,shoes:le.extractedClothing.shoes||void 0,fullBody:le.extractedClothing.fullBody||void 0}}:A.clothing;De(W=>W&&{...W,avatars:it,physical:U,physicalTraitsSource:V,clothing:ee}),Oe(W=>W.map(ge=>ge.id===A.id?{...ge,avatars:it,physical:U,physicalTraitsSource:V,clothing:ee}:ge)),y.success(`âœ… Avatars WITH TRAITS regenerated for ${A.name}`),le.extractedTraits&&y.info(`ðŸ“‹ Extracted traits saved: ${JSON.stringify(le.extractedTraits)}`),le.extractedClothing&&y.info(`ðŸ‘• Extracted clothing saved: ${JSON.stringify(le.extractedClothing)}`)}else y.error(`âŒ Failed to regenerate avatars with traits: ${le.error}`),h(`Failed to regenerate avatars: ${le.error||"Unknown error"}`)}catch(le){y.error(`âŒ Failed to regenerate avatars with traits for ${A.name}:`,le),h(`Failed to regenerate avatars: ${le instanceof Error?le.message:"Unknown error"}`)}finally{Qt(!1)}}},fi=async()=>{var m,H,S,F,G,D,M,ce,ke,je,Re,Xe,_e,qe,le,it;if(!A)return;const l={...A},j=A.id;Qt(!0);try{y.info(`ðŸ’¾ Saving character and regenerating avatars for ${l.name}...`),await ln(),y.info(`ðŸ”„ Regenerating avatars WITH TRAITS for ${l.name}...`);const U=(await new Promise(ee=>{Oe(W=>(ee(W),W))})).find(ee=>ee.id===j);if(!U){y.warn("Character not found in characters array after save");return}const V=await Ze.generateClothingAvatarsWithTraits(U);if(V.success&&V.avatars){const ee={...V.avatars,stale:!1,generatedAt:new Date().toISOString()},W=U.physicalTraitsSource||{},ge=V.extractedTraits?{height:(m=U.physical)==null?void 0:m.height,eyeColor:W.eyeColor==="user"?(H=U.physical)==null?void 0:H.eyeColor:V.extractedTraits.eyeColor,eyeColorHex:W.eyeColor==="user"?(S=U.physical)==null?void 0:S.eyeColorHex:V.extractedTraits.eyeColorHex,hairColor:W.hairColor==="user"?(F=U.physical)==null?void 0:F.hairColor:V.extractedTraits.hairColor,hairColorHex:W.hairColor==="user"?(G=U.physical)==null?void 0:G.hairColorHex:V.extractedTraits.hairColorHex,hairLength:W.hairLength==="user"?(D=U.physical)==null?void 0:D.hairLength:V.extractedTraits.hairLength,hairStyle:W.hairStyle==="user"?(M=U.physical)==null?void 0:M.hairStyle:V.extractedTraits.hairStyle,build:W.build==="user"?(ce=U.physical)==null?void 0:ce.build:V.extractedTraits.build,face:W.face==="user"?(ke=U.physical)==null?void 0:ke.face:V.extractedTraits.face,facialHair:W.facialHair==="user"?(je=U.physical)==null?void 0:je.facialHair:V.extractedTraits.facialHair,other:W.other==="user"?(Re=U.physical)==null?void 0:Re.other:V.extractedTraits.other,skinTone:W.skinTone==="user"?(Xe=U.physical)==null?void 0:Xe.skinTone:V.extractedTraits.skinTone,skinToneHex:W.skinTone==="user"?(_e=U.physical)==null?void 0:_e.skinToneHex:V.extractedTraits.skinToneHex,detailedHairAnalysis:V.extractedTraits.detailedHairAnalysis||((qe=U.physical)==null?void 0:qe.detailedHairAnalysis),apparentAge:W.apparentAge==="user"?(le=U.physical)==null?void 0:le.apparentAge:V.extractedTraits.apparentAge||((it=U.physical)==null?void 0:it.apparentAge)}:U.physical,Ue=V.extractedTraits?{eyeColor:W.eyeColor==="user"?"user":V.extractedTraits.eyeColor?"extracted":void 0,hairColor:W.hairColor==="user"?"user":V.extractedTraits.hairColor?"extracted":void 0,hairLength:W.hairLength==="user"?"user":V.extractedTraits.hairLength?"extracted":void 0,hairStyle:W.hairStyle==="user"?"user":V.extractedTraits.hairStyle?"extracted":void 0,build:W.build==="user"?"user":V.extractedTraits.build?"extracted":void 0,face:W.face==="user"?"user":V.extractedTraits.face?"extracted":void 0,facialHair:W.facialHair==="user"?"user":V.extractedTraits.facialHair?"extracted":void 0,other:W.other==="user"?"user":V.extractedTraits.other?"extracted":void 0,skinTone:W.skinTone==="user"?"user":V.extractedTraits.skinTone?"extracted":void 0,apparentAge:W.apparentAge==="user"?"user":V.extractedTraits.apparentAge?"extracted":void 0}:U.physicalTraitsSource,te=V.extractedClothing?{...U.clothing,structured:{upperBody:V.extractedClothing.upperBody||void 0,lowerBody:V.extractedClothing.lowerBody||void 0,shoes:V.extractedClothing.shoes||void 0,fullBody:V.extractedClothing.fullBody||void 0}}:U.clothing;De(ht=>ht&&ht.id===j?{...ht,avatars:ee,physical:ge,physicalTraitsSource:Ue,clothing:te}:ht),Oe(ht=>ht.map(At=>At.id===j?{...At,avatars:ee,physical:ge,physicalTraitsSource:Ue,clothing:te}:At)),y.success(`âœ… Avatars regenerated for ${U.name}`);const We={...U,avatars:ee,physical:ge,physicalTraitsSource:Ue,clothing:te},et=(await new Promise(ht=>{Oe(At=>(ht(At),At))})).map(ht=>ht.id===j?We:ht);await Ze.saveCharacterData({characters:et,relationships:ct,relationshipTexts:bt,customRelationships:js,customStrengths:[],customWeaknesses:[],customFears:[]}),y.success("ðŸ’¾ Character saved with new avatars, traits, and clothing"),v(r==="de"?"Charakter gespeichert und Avatar regeneriert":"Character saved and avatar regenerated")}else y.error(`âŒ Failed to regenerate avatars: ${V.error}`),h(`Failed to regenerate avatars: ${V.error||"Unknown error"}`)}catch(oe){y.error("âŒ Failed to save and regenerate:",oe),h(`Failed: ${oe instanceof Error?oe.message:"Unknown error"}`)}finally{Qt(!1)}},bi=async()=>{var H,S,F,G,D,M,ce,ke,je,Re,Xe,_e,qe,le,it,oe,U,V;if(!A)return;const l=A.id;qs(void 0),dt("traits");const j=(H=A.avatars)==null?void 0:H.status,m=!!((S=A.avatars)!=null&&S.standard||(F=A.avatars)!=null&&F.winter||(G=A.avatars)!=null&&G.summer||(D=A.avatars)!=null&&D.hasFullAvatars);if(j==="generating"||j==="complete"&&m){y.info(`â­ï¸ Skipping avatar generation - already ${j}${m?" with avatars":""}`);return}tt(l),De(ee=>ee&&ee.id===l?{...ee,avatars:{status:"generating"}}:ee),y.info(`ðŸŽ¨ Starting avatar generation for ${A.name||"unnamed"} (id: ${l})...`);try{const ee=await Ze.generateClothingAvatarsWithTraits(A);if(ee.success&&ee.avatars){const W={...ee.avatars,stale:!1,generatedAt:new Date().toISOString()},ge=ee.extractedTraits?{...A.physical,build:ee.extractedTraits.build||((M=A.physical)==null?void 0:M.build),eyeColor:ee.extractedTraits.eyeColor||((ce=A.physical)==null?void 0:ce.eyeColor),eyeColorHex:ee.extractedTraits.eyeColorHex||((ke=A.physical)==null?void 0:ke.eyeColorHex),hairColor:ee.extractedTraits.hairColor||((je=A.physical)==null?void 0:je.hairColor),hairColorHex:ee.extractedTraits.hairColorHex||((Re=A.physical)==null?void 0:Re.hairColorHex),hairLength:ee.extractedTraits.hairLength||((Xe=A.physical)==null?void 0:Xe.hairLength),hairStyle:ee.extractedTraits.hairStyle||((_e=A.physical)==null?void 0:_e.hairStyle),facialHair:ee.extractedTraits.facialHair||((qe=A.physical)==null?void 0:qe.facialHair),skinTone:ee.extractedTraits.skinTone||((le=A.physical)==null?void 0:le.skinTone),skinToneHex:ee.extractedTraits.skinToneHex||((it=A.physical)==null?void 0:it.skinToneHex),face:ee.extractedTraits.face||((oe=A.physical)==null?void 0:oe.face),other:ee.extractedTraits.other||((U=A.physical)==null?void 0:U.other),detailedHairAnalysis:ee.extractedTraits.detailedHairAnalysis||((V=A.physical)==null?void 0:V.detailedHairAnalysis)}:A.physical,Ue=ee.extractedClothing?{...A.clothing,structured:{upperBody:ee.extractedClothing.upperBody||void 0,lowerBody:ee.extractedClothing.lowerBody||void 0,shoes:ee.extractedClothing.shoes||void 0,fullBody:ee.extractedClothing.fullBody||void 0}}:A.clothing;Oe(te=>te.map(We=>We.id===l?{...We,avatars:W,physical:ge,clothing:Ue}:We)),De(te=>te&&te.id===l?{...te,avatars:W,physical:ge,clothing:Ue}:te),y.success(`âœ… Avatar generated for ${A.name} (id: ${l})`)}else y.error(`âŒ Failed to generate avatar: ${ee.error}`),h(`Failed to generate avatar: ${ee.error||"Unknown error"}`),Oe(W=>W.map(ge=>ge.id===l?{...ge,avatars:{status:"failed"}}:ge)),De(W=>W&&W.id===l?{...W,avatars:{status:"failed"}}:W)}catch(ee){y.error("âŒ Avatar generation failed:",ee),h(`Avatar generation failed: ${ee instanceof Error?ee.message:"Unknown error"}`),Oe(W=>W.map(ge=>ge.id===l?{...ge,avatars:{status:"failed"}}:ge)),De(W=>W&&W.id===l?{...W,avatars:{status:"failed"}}:W)}finally{tt(null)}},ln=async()=>{var l;if(A){Y(!0);try{const j=_s.current,m=ls.current;if(!j){y.warn("No current character to save");return}const H=j.id&&m.find(D=>D.id===j.id),S=H?m.map(D=>D.id===j.id?j:D):[...m,j];y.info("Saving characters with relationships:",S.length);const F=!H&&!!((l=j.photos)!=null&&l.original);await Ze.saveCharacterData({characters:S,relationships:ct,relationshipTexts:bt,customRelationships:js,customStrengths:[],customWeaknesses:[],customFears:[]},{includePhotos:F}),Ns.current=!1,y.success("Character data saved successfully"),Oe(S),Er(S);const G=S.find(D=>D.id===A.id);G&&Ze.needsAvatars(G)&&$s!==G.id&&(y.info(`ðŸŽ¨ Starting background avatar generation for ${G.name}...`),Ze.generateAndSaveAvatarForCharacter(G,void 0,{avatarModel:Pe.avatarModel||void 0}).then(D=>{D.success&&D.character?(Oe(M=>M.map(ce=>ce.id===G.id?{...ce,avatars:D.character.avatars,physical:D.character.physical,clothing:D.character.clothing}:ce)),y.success(`âœ… Avatars and traits saved for ${G.name}`)):D.skipped||(y.warn(`Avatar generation failed for ${G.name}: ${D.error}`),Oe(M=>M.map(ce=>ce.id===G.id?{...ce,avatars:{status:"failed"}}:ce)))}).catch(D=>{y.error(`âŒ Background avatar generation error for ${G.name}:`,D),Oe(M=>M.map(ce=>ce.id===G.id?{...ce,avatars:{status:"failed"}}:ce))})),De(null),fs(!0)}catch(j){y.error("Failed to save character:",j),h(r==="de"?"Charakter konnte nicht gespeichert werden. Bitte versuche es erneut.":r==="fr"?"Ã‰chec de l'enregistrement du personnage. Veuillez rÃ©essayer.":"Failed to save character. Please try again.")}finally{Y(!1)}}},yi=async l=>{De({...l}),dt("traits"),fs(!1);const j=await Ze.loadFullCharacter(l.id);j&&(De(m=>m&&m.id===l.id?{...m,...j}:m),Oe(m=>m.map(H=>H.id===l.id?{...H,...j}:H)))},vi=async l=>{try{const j=await Ze.deleteCharacter(l);j.success?(Oe(m=>m.filter(H=>H.id!==l)),Yt(m=>{const H={...m};return Object.keys(H).forEach(S=>{(S.includes(`${l}-`)||S.includes(`-${l}`))&&delete H[S]}),H}),cr(m=>{const H={...m};return Object.keys(H).forEach(S=>{(S.includes(`${l}-`)||S.includes(`-${l}`))&&delete H[S]}),H}),yt(m=>m.filter(H=>H!==l)),y.success(`Character ${l} deleted`)):(y.error("Failed to delete character:",j.error),h(r==="de"?"Charakter konnte nicht gelÃ¶scht werden":"Failed to delete character"))}catch(j){y.error("Failed to delete character:",j),h(r==="de"?"Charakter konnte nicht gelÃ¶scht werden":"Failed to delete character")}},ji=(l,j,m)=>{const S=ri(m,r),F=`${l}-${j}`,G=`${j}-${l}`;y.debug("Updating relationship:",F,"=",m,", inverse:",G,"=",S),Ns.current=!0,Yt(D=>({...D,[F]:m,[G]:S}))},Ni=(l,j)=>{Ns.current=!0;const[m,H]=l.split("-").map(Number),S=`${H}-${m}`;cr(F=>({...F,[l]:j,[S]:j}))},wi=(l,j)=>{Ns.current=!0,Ht(m=>[...m,{forward:l,inverse:j}])},Si=(l,j)=>{j==="out"?(_t(m=>m.includes(l)?m:[...m,l]),yt(m=>m.filter(H=>H!==l))):j==="in"?(_t(m=>m.filter(H=>H!==l)),yt(m=>m.filter(H=>H!==l))):j==="main"&&(_t(m=>m.filter(H=>H!==l)),yt(m=>m.includes(l)?m:[...m,l]))},rr=async l=>{l>=0&&l<=7&&(z===1&&A&&l!==1&&await ln(),z===1&&l!==1&&ki(),l===1&&z!==1&&De(null),J(l),window.scrollTo(0,0))},Ci=l=>l===1?!0:l===2||l===3?Ce.length>0:l===4?Ce.length>0&&$e!=="":l===5?Ce.length>0&&$e!==""&&xt!=="":l===6?Gs!=="":!1,vr=()=>z===1?Ce.length>0&&pt.length>0:z===2?!0:z===3?!(!$e||$e==="adventure"&&!Ke||($e==="life-challenge"||$e==="educational")&&!Ie):z===4?xt!=="":z===5?Ce.filter(j=>!ot.includes(j.id)).length>0&&pt.length>0&&s.trim().length>0:!1,ki=async()=>{const l=await new Promise(j=>{Oe(m=>(j(m),m))});if(l.length!==0){if(!Ns.current){y.debug("Relationships not modified, skipping save");return}try{y.debug("Auto-saving character data with latest state..."),await Ze.saveCharacterData({characters:l,relationships:ct,relationshipTexts:bt,customRelationships:js,customStrengths:[],customWeaknesses:[],customFears:[]}),Ns.current=!1,y.debug("Character data auto-saved")}catch(j){y.error("Failed to auto-save character data:",j)}}},Ai=async()=>{if(z<5&&vr()){if(z===1&&Ce.length===1){kr(!0);return}await rr(z+1)}},Cn=async()=>{z>0&&await rr(z-1)},Pi=l=>{P(l)},kn=async()=>{Cs.current&&Cs.current.abort(),Q(!0),ue(!0),ut(!0),Bs([]),Nt(null),Is("");const l=Ce.filter(j=>!ot.includes(j.id));Cs.current=at.generateStoryIdeasStream({storyType:Ye,storyTypeName:ca(),storyCategory:$e||void 0,storyTopic:Ie||void 0,storyTheme:Ke||void 0,customThemeText:Ke==="custom"?Jt:void 0,language:jt,languageLevel:vt,pages:ft,characters:l.map(j=>({name:j.name,age:j.age,gender:j.gender,traits:j.traits,isMain:pt.includes(j.id)})),relationships:Object.entries(ct).map(([j,m])=>{const[H,S]=j.split("-").map(Number),F=l.find(D=>D.id===H),G=l.find(D=>D.id===S);return{character1:(F==null?void 0:F.name)||"",character2:(G==null?void 0:G.name)||"",relationship:m}}).filter(j=>j.character1&&j.character2),ideaModel:(x==null?void 0:x.role)==="admin"||b?Pe.ideaModel:void 0,userLocation:Es||void 0,season:Ms},{onStatus:(j,m,H)=>{m&&H&&Nt({prompt:m,model:H})},onStory1:j=>{Bs(m=>{const H=[...m];return H[0]=j,H}),It(100),ue(!1)},onStory2:j=>{Bs(m=>{const H=[...m];return H[1]=j,H}),ts(100),ut(!1)},onError:j=>{y.error("Failed to generate story ideas:",j),h(r==="de"?"Fehler beim Generieren von Ideen. Bitte versuchen Sie es erneut.":r==="fr"?"Erreur lors de la gÃ©nÃ©ration d'idÃ©es. Veuillez rÃ©essayer.":"Failed to generate ideas. Please try again."),Q(!1),ue(!1),ut(!1)},onDone:j=>{Q(!1),ue(!1),ut(!1),j&&Is(j),Cs.current=null,y.info("[IDEAS] onDone complete")}})},ca=()=>{const l=Wr.find(j=>j.id===Ye);return l?l.name[r]:Ye},jr=async l=>{var m,H,S,F,G,D,M,ce,ke,je,Re,Xe,_e,qe,le,it;if(console.log("[generateStory] Called with overrides:",l),console.log("[generateStory] user:",x==null?void 0:x.email,"emailVerified:",x==null?void 0:x.emailVerified,"isImpersonating:",b),!(l!=null&&l.skipEmailCheck)&&!b&&x&&x.emailVerified!==!0){console.log("[generateStory] Email not verified, showing modal"),localStorage.setItem("pendingStoryGeneration","true"),localStorage.setItem("pending_story_type",Ye),localStorage.setItem("pending_art_style",xt),hr(!0);return}console.log("[generateStory] Starting generation, setting step to 6"),Ls(!0),gr(!1),J(6),Me({storyCategory:$e||void 0,storyTopic:Ie||void 0,storyTheme:Ke||void 0,storyTypeName:ca(),storyDetails:s||void 0,artStyle:xt||void 0,language:jt||void 0,languageLevel:vt||void 0,pages:ft||void 0,dedication:es||void 0,characters:Ce.filter(oe=>!ot.includes(oe.id)).map(oe=>({id:oe.id,name:oe.name})),mainCharacters:pt,relationships:ct,relationshipTexts:bt,season:Ms||void 0,userLocation:Es||void 0}),Ys(""),gs(""),Bt([]),pr([]),$t(null),Kt({}),Wt({frontCover:null,initialPage:null,backCover:null});const j=Ce.filter(oe=>!ot.includes(oe.id)).filter(oe=>!oe.avatars||oe.avatars.stale||oe.avatars.status!=="complete");if(j.length>0){console.log("[generateStory] Characters needing avatar regeneration:",j.map(oe=>oe.name)),ks({current:1,total:100,message:r==="de"?`Aktualisiere Avatare fÃ¼r ${j.length} Charakter(e)...`:r==="fr"?`Mise Ã  jour des avatars pour ${j.length} personnage(s)...`:`Updating avatars for ${j.length} character(s)...`});for(let oe=0;oe<j.length;oe++){const U=j[oe];try{console.log(`[generateStory] Regenerating avatars for ${U.name} (${oe+1}/${j.length})`),ks({current:2,total:100,message:r==="de"?`Generiere Avatare fÃ¼r ${U.name}...`:r==="fr"?`GÃ©nÃ©ration des avatars pour ${U.name}...`:`Generating avatars for ${U.name}...`});const V=await Ze.generateClothingAvatarsWithTraits(U);if(V.success&&V.avatars){const ee={...V.avatars,stale:!1,generatedAt:new Date().toISOString()},W=U.physicalTraitsSource||{},ge=V.extractedTraits?{...U.physical,height:(m=U.physical)==null?void 0:m.height,build:W.build==="user"?(H=U.physical)==null?void 0:H.build:V.extractedTraits.build,eyeColor:W.eyeColor==="user"?(S=U.physical)==null?void 0:S.eyeColor:V.extractedTraits.eyeColor,eyeColorHex:W.eyeColor==="user"?(F=U.physical)==null?void 0:F.eyeColorHex:V.extractedTraits.eyeColorHex,hairColor:W.hairColor==="user"?(G=U.physical)==null?void 0:G.hairColor:V.extractedTraits.hairColor,hairColorHex:W.hairColor==="user"?(D=U.physical)==null?void 0:D.hairColorHex:V.extractedTraits.hairColorHex,hairLength:W.hairLength==="user"?(M=U.physical)==null?void 0:M.hairLength:V.extractedTraits.hairLength,hairStyle:W.hairStyle==="user"?(ce=U.physical)==null?void 0:ce.hairStyle:V.extractedTraits.hairStyle,facialHair:W.facialHair==="user"?(ke=U.physical)==null?void 0:ke.facialHair:V.extractedTraits.facialHair,skinTone:W.skinTone==="user"?(je=U.physical)==null?void 0:je.skinTone:V.extractedTraits.skinTone,skinToneHex:W.skinTone==="user"?(Re=U.physical)==null?void 0:Re.skinToneHex:V.extractedTraits.skinToneHex,face:W.face==="user"?(Xe=U.physical)==null?void 0:Xe.face:V.extractedTraits.face,other:W.other==="user"?(_e=U.physical)==null?void 0:_e.other:V.extractedTraits.other,detailedHairAnalysis:V.extractedTraits.detailedHairAnalysis||((qe=U.physical)==null?void 0:qe.detailedHairAnalysis),apparentAge:W.apparentAge==="user"?(le=U.physical)==null?void 0:le.apparentAge:V.extractedTraits.apparentAge||((it=U.physical)==null?void 0:it.apparentAge)}:U.physical,Ue=V.extractedTraits?{...W,build:W.build==="user"?"user":V.extractedTraits.build?"extracted":void 0,eyeColor:W.eyeColor==="user"?"user":V.extractedTraits.eyeColor?"extracted":void 0,hairColor:W.hairColor==="user"?"user":V.extractedTraits.hairColor?"extracted":void 0,hairLength:W.hairLength==="user"?"user":V.extractedTraits.hairLength?"extracted":void 0,hairStyle:W.hairStyle==="user"?"user":V.extractedTraits.hairStyle?"extracted":void 0,face:W.face==="user"?"user":V.extractedTraits.face?"extracted":void 0,facialHair:W.facialHair==="user"?"user":V.extractedTraits.facialHair?"extracted":void 0,other:W.other==="user"?"user":V.extractedTraits.other?"extracted":void 0,skinTone:W.skinTone==="user"?"user":V.extractedTraits.skinTone?"extracted":void 0,apparentAge:W.apparentAge==="user"?"user":V.extractedTraits.apparentAge?"extracted":void 0}:U.physicalTraitsSource,te=V.extractedClothing?{...U.clothing,structured:{upperBody:V.extractedClothing.upperBody||void 0,lowerBody:V.extractedClothing.lowerBody||void 0,shoes:V.extractedClothing.shoes||void 0,fullBody:V.extractedClothing.fullBody||void 0}}:U.clothing;Oe(We=>We.map(we=>we.id===U.id?{...we,avatars:ee,physical:ge,physicalTraitsSource:Ue,clothing:te}:we)),De(We=>We&&We.id===U.id?{...We,avatars:ee,physical:ge,physicalTraitsSource:Ue,clothing:te}:We),Oe(We=>{const we=We.map(et=>et.id===U.id?{...et,avatars:ee,physical:ge,physicalTraitsSource:Ue,clothing:te}:et);return Ze.saveCharacterData({characters:we,relationships:ct,relationshipTexts:bt,customRelationships:js,customStrengths:[],customWeaknesses:[],customFears:[]}).catch(et=>console.error("Failed to save avatar update:",et)),we}),console.log(`[generateStory] âœ… Avatars regenerated for ${U.name}`)}else console.warn(`[generateStory] âš ï¸ Failed to regenerate avatars for ${U.name}: ${V.error}`)}catch(V){console.error(`[generateStory] âŒ Error regenerating avatars for ${U.name}:`,V)}}}ks({current:5,total:100,message:r==="de"?"Starte Generierung...":r==="fr"?"DÃ©marrage de la gÃ©nÃ©ration...":"Starting generation..."});try{const oe=Ce.filter(te=>!ot.includes(te.id)),{jobId:U,creditsRemaining:V}=await at.createStoryJob({storyType:Ye,storyTypeName:ca(),storyCategory:$e||void 0,storyTopic:Ie||void 0,storyTheme:Ke||void 0,customThemeText:Ke==="custom"?Jt:void 0,artStyle:xt,language:jt,languageLevel:vt,pages:ft,dedication:es,storyDetails:s,characters:oe,mainCharacters:pt,relationships:ct,relationshipTexts:bt,skipImages:(l==null?void 0:l.skipImages)??de,imageGenMode:ae,generationMode:Se!=="auto"?Se:void 0,skipOutline:c,skipText:O,skipSceneDescriptions:Be,skipCovers:Fe,enableAutoRepair:X,enableFinalChecks:be,incrementalConsistency:Rt?{enabled:!0,dryRun:Gt,lookbackCount:3}:void 0,modelOverrides:(x==null?void 0:x.role)==="admin"||b?{outlineModel:Pe.outlineModel,textModel:Pe.textModel,sceneDescriptionModel:Pe.sceneDescriptionModel,imageModel:Pe.imageModel,coverImageModel:Pe.coverImageModel,qualityModel:Pe.qualityModel}:void 0,userLocation:Es||void 0,season:Ms||void 0});fr(U),y.info("Story job created:",U),k(U,ca()||"New Story"),V!=null&&o(V);let ee=!1,W=0,ge=Date.now();const Ue=180*1e3;for(Rs(!1);!ee;){await new Promise(We=>setTimeout(We,2e3));const te=await at.getJobStatus(U);if(te.progress&&(te.progress.current!==W?(y.debug(`Progress: ${te.progress.current}% - ${te.progress.message||""}`),W=te.progress.current,ge=Date.now(),Rs(!1)):Date.now()-ge>=Ue&&Rs(!0),ks(We=>te.progress.current>=We.current?te.progress:te.progress.message?{...We,message:te.progress.message}:We)),te.partialCovers){let We=!1;Wt(we=>{var ht,At,_a;const et={...we};if((ht=te.partialCovers)!=null&&ht.frontCover&&!we.frontCover){et.frontCover=te.partialCovers.frontCover,y.debug("Front cover received during streaming");const hs=te.partialCovers.frontCover;typeof hs=="object"&&(hs!=null&&hs.storyTitle)&&(gs(hs.storyTitle),y.debug(`Story title from front cover: ${hs.storyTitle}`)),We=!0}return(At=te.partialCovers)!=null&&At.initialPage&&!we.initialPage&&(et.initialPage=te.partialCovers.initialPage,y.debug("Initial page cover received during streaming")),(_a=te.partialCovers)!=null&&_a.backCover&&!we.backCover&&(et.backCover=te.partialCovers.backCover,y.debug("Back cover received during streaming")),et}),We&&(y.debug("Transitioning to StoryDisplay - front cover ready"),J(6))}if(te.storyText&&!ze&&($t(te.storyText),gs(te.storyText.title),y.debug(`Story text received: ${te.storyText.totalPages} pages ready for display`)),te.partialPages&&te.partialPages.length>0&&Kt(We=>{var ht;const we={...We};let et=0;return(ht=te.partialPages)==null||ht.forEach(At=>{At.imageData&&!We[At.pageNumber]&&(we[At.pageNumber]=At.imageData,et++)}),et>0&&y.debug(`${et} new page images received (total: ${Object.keys(we).length})`),we}),console.log("[StoryWizard] Job status check:",{status:te.status,hasResult:!!te.result,resultKeys:te.result?Object.keys(te.result):[],progress:te.progress}),te.status==="completed"&&te.result)zr(te.result.storyId),gs(te.result.title),Yr(te.result.outline),Xr(te.result.outlinePrompt||""),ea(te.result.outlineModelId),ta(te.result.outlineUsage),sa(te.result.storyTextPrompts||[]),Dr(te.result.styledAvatarGeneration||[]),$r(te.result.costumedAvatarGeneration||[]),Tr(te.result.generationLog||[]),ra(te.result.finalChecksReport||null),te.result.visualBible?Xs({mainCharacters:te.result.visualBible.mainCharacters||[],secondaryCharacters:te.result.visualBible.secondaryCharacters||[],animals:te.result.visualBible.animals||[],artifacts:te.result.visualBible.artifacts||[],locations:te.result.visualBible.locations||[],vehicles:te.result.visualBible.vehicles||[],clothing:te.result.visualBible.clothing||[],changeLog:te.result.visualBible.changeLog||[]}):Xs(null),te.result.clothingRequirements?xr(te.result.clothingRequirements):xr(null),Ys(te.result.story),Qr(te.result.story),pr(te.result.sceneDescriptions||[]),Bt(te.result.sceneImages||[]),Wt(te.result.coverImages||{frontCover:null,initialPage:null,backCover:null}),$t(null),Kt({}),ee=!0,te.currentCredits!==null&&te.currentCredits!==void 0&&o(te.currentCredits),J(6),y.success("Story generation completed!"),Me({storyCategory:$e||void 0,storyTopic:Ie||void 0,storyTheme:Ke||void 0,storyTypeName:ca(),storyDetails:s||void 0,artStyle:xt||void 0,language:jt||void 0,languageLevel:vt||void 0,pages:ft||void 0,dedication:es||void 0,characters:Ce.map(We=>({id:We.id,name:We.name})),mainCharacters:pt,relationships:ct,relationshipTexts:bt,season:Ms||void 0,userLocation:Es||void 0}),Le.current=!0,L();else if(te.status==="failed")throw new Error(te.error||"Story generation failed")}ks({current:100,total:100,message:r==="de"?"Fertig!":r==="fr"?"TerminÃ©!":"Complete!"})}catch(oe){y.error("Generation failed:",oe);const U=oe instanceof Error?oe.message:String(oe);if(U.includes("already in progress")){const V=U.match(/\|ACTIVE_JOB:(job_[a-z0-9_]+)/i),ee=V?V[1]:null,W=r==="de"?"Eine Geschichte wird bereits erstellt. MÃ¶chtest du diese abbrechen und eine neue starten?":r==="fr"?"Une histoire est dÃ©jÃ  en cours de crÃ©ation. Voulez-vous l'annuler et en commencer une nouvelle?":"A story is already being generated. Would you like to cancel it and start a new one?";if(ee&&window.confirm(W))try{await at.cancelJob(ee),y.info("Cancelled existing job:",ee),await jr(l);return}catch(ge){y.error("Failed to cancel existing job:",ge),h(r==="de"?"Abbrechen fehlgeschlagen. Bitte versuche es spÃ¤ter erneut.":r==="fr"?"Ã‰chec de l'annulation. Veuillez rÃ©essayer plus tard.":"Failed to cancel. Please try again later.")}Ls(!1);return}else h(r==="de"?`Generierung fehlgeschlagen: ${U}`:r==="fr"?`Ã‰chec de la gÃ©nÃ©ration: ${U}`:`Generation failed: ${U}`)}finally{Rs(!1),L(),setTimeout(()=>Ls(!1),500)}};d.useEffect(()=>{if(yr.current&&f&&Ce.length>0&&z===5&&!us){yr.current=!1;const l=localStorage.getItem("verificationGenerationStarted");if(l){const m=parseInt(l,10),H=Date.now()-120*1e3;if(m>H){console.log("Another window already started generation, skipping auto-generate");return}localStorage.removeItem("verificationGenerationStarted")}localStorage.setItem("verificationGenerationStarted",Date.now().toString()),(async()=>{await C(),setTimeout(()=>{jr({skipEmailCheck:!0})},500)})()}},[f,Ce,z,us,C]);const Di=()=>{switch(z){case 1:return e.jsx(Zl,{characters:Ce,currentCharacter:A,characterStep:St,showCharacterCreated:zt,isLoading:_,isAnalyzingPhoto:Zt,isGeneratingAvatar:$s===(A==null?void 0:A.id),isRegeneratingAvatars:ds,isRegeneratingAvatarsWithTraits:cs,developerMode:fe,isImpersonating:b,changedTraits:wr,photoAnalysisDebug:Sr,mainCharacters:pt,excludedCharacters:ot,onCharacterRoleChange:Si,onCharacterChange:De,onCharacterStepChange:dt,onContinueToAvatar:()=>dt("avatar"),onPhotoSelect:ui,onSaveAndGenerateAvatar:bi,onSaveCharacter:ln,onEditCharacter:yi,onDeleteCharacter:vi,onStartNewCharacter:nn,onRegenerateAvatars:xi,onRegenerateAvatarsWithTraits:pi,onSaveAndRegenerateWithTraits:fi,onSaveAndTryNewPhoto:async()=>{var m;if(y.info(`ðŸ“¸ onSaveAndTryNewPhoto called, currentCharacter: ${A==null?void 0:A.name}`),!A){y.warn("ðŸ“¸ No currentCharacter, returning early");return}Y(!0);try{const H=A.id&&Ce.find(G=>G.id===A.id),S=H?Ce.map(G=>G.id===A.id?A:G):[...Ce,A],F=!H&&!!((m=A.photos)!=null&&m.original);await Ze.saveCharacterData({characters:S,relationships:ct,relationshipTexts:bt,customRelationships:js,customStrengths:[],customWeaknesses:[],customFears:[]},{includePhotos:F}),Oe(S),Er(S),y.info(`ðŸ“¸ Setting characterStep to 'photo', currentCharacter still: ${A==null?void 0:A.name}`),dt("photo")}catch(H){y.error("ðŸ“¸ Error saving character:",H)}finally{Y(!1),y.info("ðŸ“¸ onSaveAndTryNewPhoto complete, characterStep should now be 'photo'")}},relationships:ct,relationshipTexts:bt,onRelationshipChange:ji,onRelationshipTextChange:Ni,customRelationships:js,onAddCustomRelationship:wi});case 2:return e.jsx(Xl,{languageLevel:vt,onLanguageLevelChange:Xt,pages:ft,onPagesChange:Fs,storyLanguage:jt,onStoryLanguageChange:Zs,developerMode:fe,userLocation:Es,onLocationChange:Kr,season:Ms,onSeasonChange:fa,userCredits:b?-1:(x==null?void 0:x.credits)??0});case 3:return e.jsx(eo,{storyCategory:$e,storyTopic:Ie,storyTheme:Ke,customThemeText:Jt,onCategoryChange:ni,onTopicChange:li,onThemeChange:ii,onCustomThemeTextChange:Ds,onLegacyStoryTypeChange:Ve});case 4:return e.jsx(to,{artStyle:xt,onArtStyleChange:oi});case 5:return e.jsx(ro,{characters:Ce,mainCharacters:pt,excludedCharacters:ot,storyCategory:$e,storyTopic:Ie,storyTheme:Ke,customThemeText:Jt,onCustomThemeTextChange:Ds,artStyle:xt,storyLanguage:jt,languageLevel:vt,pages:ft,userLocation:Es,season:Ms,storyDetails:s,onStoryDetailsChange:P,dedication:es,onDedicationChange:zs,onGenerateIdeas:kn,isGeneratingIdeas:N,isGeneratingIdea1:g,isGeneratingIdea2:Ee,ideaProgress1:qt,ideaProgress2:Ss,ideaPrompt:Ne,ideaFullResponse:ur,generatedIdeas:ss,onSelectIdea:Pi,onUseDirectly:()=>jr(),onEditStep:rr,developerMode:fe,imageGenMode:ae,onImageGenModeChange:he,generationMode:Se,onGenerationModeChange:ne});case 6:const l=er.frontCover||er.initialPage||Object.keys(Ct).length>0||Fr.some(m=>m.imageData);if(Gs&&l||ze&&l||us&&l){const m=Gs?Fr:Object.entries(Ct).map(([S,F])=>{var G;return{pageNumber:parseInt(S),imageData:F,description:((G=ze==null?void 0:ze.sceneDescriptions.find(D=>D.pageNumber===parseInt(S)))==null?void 0:G.description)||""}}),H=Gs||Object.entries((ze==null?void 0:ze.pageTexts)||{}).sort(([S],[F])=>parseInt(S)-parseInt(F)).map(([S,F])=>`--- Page ${S} ---
${F}`).join(`

`);return e.jsxs(e.Fragment,{children:[Vt&&Vt.total>0&&e.jsxs("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 bg-white/95 backdrop-blur-sm rounded-full shadow-lg px-4 py-2 flex items-center gap-3 border border-indigo-100",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300 ease-out",style:{width:`${Vt.loaded/Vt.total*100}%`}})}),e.jsx("span",{className:"text-sm text-gray-600 whitespace-nowrap",children:r==="de"?`Bilder: ${Vt.loaded}/${Vt.total}`:r==="fr"?`Images: ${Vt.loaded}/${Vt.total}`:`Images: ${Vt.loaded}/${Vt.total}`})]}),e.jsx(bl,{title:Pr,story:H,originalStory:ka,outline:Aa,outlinePrompt:Pa,outlineModelId:Da,outlineUsage:$a,storyTextPrompts:Ta,visualBible:Fa||void 0,sceneImages:m,sceneDescriptions:(ze==null?void 0:ze.sceneDescriptions)||La,characters:lr||Ce.filter(S=>!ot.includes(S.id)),progressiveMode:us,progressiveData:ze||void 0,completedPageImages:Ct,coverImages:er,regeneratingCovers:ba,languageLevel:vt,storyLanguage:jt,isGenerating:us,developerMode:fe,styledAvatarGeneration:Ia,costumedAvatarGeneration:Ba,generationLog:Ea,finalChecksReport:Ma,clothingRequirements:za||void 0,storyId:Ge,onVisualBibleChange:Ge?async S=>{try{y.info("Updating Visual Bible for story:",Ge),await at.updateVisualBible(Ge,S),Xs(S),y.success("Visual Bible updated successfully")}catch(F){y.error("Failed to update Visual Bible:",F),h(r==="de"?"Visual Bible konnte nicht aktualisiert werden":r==="fr"?"Ã‰chec de la mise Ã  jour de la Bible Visuelle":"Failed to update Visual Bible")}}:void 0,onRegenerateImage:Ge?async(S,F,G)=>{var D;try{y.info("Regenerating image for page:",S,F?"(scene edited)":"",G?`(${G.length} characters)`:"");const M=await at.regenerateImage(Ge,S,F,G);if(y.info("Regenerate result:",{hasImageData:!!(M!=null&&M.imageData),length:(D=M==null?void 0:M.imageData)==null?void 0:D.length,versionCount:M==null?void 0:M.versionCount,creditsRemaining:M==null?void 0:M.creditsRemaining}),!(M!=null&&M.imageData))throw y.error("No imageData in response!",M),new Error("No image data returned from server");Bt(ce=>ce.map(ke=>ke.pageNumber===S?{...ke,imageData:M.imageData,description:M.newDescription||ke.description,prompt:M.newPrompt,qualityScore:M.qualityScore,qualityReasoning:M.qualityReasoning,totalAttempts:M.totalAttempts,retryHistory:M.retryHistory,wasRegenerated:!0,originalImage:M.originalImage,originalScore:M.originalScore,originalReasoning:M.originalReasoning,imageVersions:M.imageVersions}:ke)),M.creditsRemaining!==void 0&&o&&o(M.creditsRemaining),y.info("Image regenerated successfully, updated state")}catch(M){y.error("Image regeneration failed:",M);const ce=M instanceof Error?M.message:String(M);h(r==="de"?`Bildgenerierung fehlgeschlagen: ${ce}`:r==="fr"?`Ã‰chec de la rÃ©gÃ©nÃ©ration: ${ce}`:`Image regeneration failed: ${ce}`)}}:void 0,onDownloadTxt:()=>{const S=new Blob([Gs],{type:"text/plain"}),F=URL.createObjectURL(S),G=document.createElement("a");G.href=F,G.download=`${Pr}.txt`,G.click(),URL.revokeObjectURL(F)},onDownloadPdf:Ge?async S=>{try{const F=await at.generatePdf(Ge,S),G=URL.createObjectURL(F),D=document.createElement("a");D.href=G,D.download=`${Pr}.pdf`,D.click(),URL.revokeObjectURL(G)}catch(F){y.error("PDF download failed:",F),h(r==="de"?"PDF-Download fehlgeschlagen":r==="fr"?"Ã‰chec du tÃ©lÃ©chargement PDF":"PDF download failed")}}:void 0,onAddToBook:Ge?()=>{try{const S=sessionStorage.getItem("mystories_selected"),F=S?JSON.parse(S):[];F.includes(Ge)||(F.push(Ge),sessionStorage.setItem("mystories_selected",JSON.stringify(F))),y.info("Added story to book selection:",Ge),v(r==="de"?"Geschichte zum Buch hinzugefÃ¼gt. Du kannst weitere hinzufÃ¼gen oder das Buch bestellen.":r==="fr"?"Histoire ajoutÃ©e au livre. Vous pouvez en ajouter d'autres ou commander le livre.":"Story added to book. You can add more or order the book.",r==="de"?"Zum Buch hinzugefÃ¼gt":r==="fr"?"AjoutÃ© au livre":"Added to Book"),t("/stories")}catch(S){y.error("Failed to add story to selection:",S)}}:void 0,onPrintBook:Ge?async()=>{let S=await al.getShippingAddress();if(!S){const D=prompt(r==="de"?"Keine Adresse gespeichert. Bitte eingeben (Format: Vorname, Nachname, Strasse, PLZ, Ort, Land, Email):":r==="fr"?"Aucune adresse enregistrÃ©e. Veuillez entrer (Format: PrÃ©nom, Nom, Rue, CP, Ville, Pays, Email):":"No saved address. Please enter (Format: FirstName, LastName, Street, PostCode, City, Country, Email):");if(!D)return;const M=D.split(",").map(ce=>ce.trim());if(M.length<7){h(r==="de"?"UngÃ¼ltiges Adressformat":r==="fr"?"Format d'adresse invalide":"Invalid address format");return}S={firstName:M[0],lastName:M[1],addressLine1:M[2],postCode:M[3],city:M[4],country:M[5],email:M[6]}}const F=`${S.firstName} ${S.lastName}
${S.addressLine1}
${S.postCode} ${S.city}
${S.country}`,G=r==="de"?`Druckauftrag an folgende Adresse senden?

${F}`:r==="fr"?`Envoyer la commande Ã  cette adresse?

${F}`:`Send print order to this address?

${F}`;if(confirm(G))try{y.info("Creating print order for story:",Ge);const D=await at.createPrintOrder(Ge,{firstName:S.firstName,lastName:S.lastName,addressLine1:S.addressLine1,city:S.city,postCode:S.postCode,country:S.country,email:S.email||""}),M=r==="de"?`âœ… Druckauftrag erfolgreich erstellt!

Order ID: ${D.orderId}
${D.isDraft?"(Entwurf - muss in Gelato bestÃ¤tigt werden)":""}

MÃ¶chten Sie das Gelato Dashboard Ã¶ffnen, um den Auftrag zu verfolgen?`:r==="fr"?`âœ… Commande d'impression crÃ©Ã©e avec succÃ¨s!

ID de commande: ${D.orderId}
${D.isDraft?"(Brouillon - doit Ãªtre confirmÃ© dans Gelato)":""}

Voulez-vous ouvrir le tableau de bord Gelato pour suivre la commande?`:`âœ… Print order created successfully!

Order ID: ${D.orderId}
${D.isDraft?"(Draft - must be confirmed in Gelato)":""}

Would you like to open the Gelato dashboard to track your order?`;D.dashboardUrl&&confirm(M)?window.open(D.dashboardUrl,"_blank"):D.dashboardUrl||v(r==="de"?`Druckauftrag erstellt! Order ID: ${D.orderId}`:r==="fr"?`Commande crÃ©Ã©e! ID: ${D.orderId}`:`Print order created! Order ID: ${D.orderId}`)}catch(D){y.error("Print order failed:",D);const M=D instanceof Error?D.message:String(D);h(r==="de"?`Druckauftrag fehlgeschlagen: ${M}`:r==="fr"?`Ã‰chec de la commande d'impression: ${M}`:`Print order failed: ${M}`)}}:void 0,onCreateAnother:()=>{y.info("Creating new story - resetting settings"),zr(null),fr(null),mt(null);const S=new URLSearchParams(a);S.delete("storyId"),n(S,{replace:!0}),Ys(""),gs(""),pr([]),Bt([]),Wt({frontCover:null,initialPage:null,backCover:null}),aa(!1),na(void 0),ia(void 0),w(void 0),Ve(""),rt(""),Pt(""),is(""),Dt("watercolor"),Xt("standard"),Fs(30),zs(""),P(""),_t([]),localStorage.removeItem("story_type"),localStorage.removeItem("story_category"),localStorage.removeItem("story_topic"),localStorage.removeItem("story_theme"),localStorage.removeItem("story_art_style"),localStorage.removeItem("story_language_level"),localStorage.removeItem("story_pages"),localStorage.removeItem("story_dedication"),localStorage.removeItem("story_details"),localStorage.removeItem("story_main_characters"),localStorage.removeItem("story_excluded_characters"),localStorage.removeItem("wizard_step"),localStorage.removeItem("verificationGenerationStarted"),De(null),dt("photo"),J(1)},onRegenerateCover:Ge?async(S,F)=>{const G=S==="front"?"frontCover":S==="back"?"backCover":"initialPage";try{y.info("Regenerating cover:",S,F?`with scene: "${F.substring(0,50)}..."`:""),Ur(M=>new Set(M).add(G));const D=await at.regenerateCover(Ge,S,F);Wt(M=>M&&{...M,[S==="front"?"frontCover":S==="back"?"backCover":"initialPage"]:{imageData:D.imageData,description:D.description,prompt:D.prompt,qualityScore:D.qualityScore,qualityReasoning:D.qualityReasoning,totalAttempts:D.totalAttempts,retryHistory:D.retryHistory}}),D.creditsRemaining!==void 0&&o&&o(D.creditsRemaining),y.info("Cover regenerated successfully")}catch(D){y.error("Cover regeneration failed:",D);const M=D instanceof Error?D.message:String(D);h(r==="de"?`Cover-Generierung fehlgeschlagen: ${M}`:r==="fr"?`Ã‰chec de la rÃ©gÃ©nÃ©ration: ${M}`:`Cover regeneration failed: ${M}`)}finally{Ur(D=>{const M=new Set(D);return M.delete(G),M})}}:void 0,onEditImage:S=>{br({type:"image",pageNumber:S}),sr(""),Tt(!0)},onEditCover:S=>{br({type:"cover",coverType:S}),sr(""),Tt(!0)},onRepairImage:Ge&&((x==null?void 0:x.role)==="admin"||b)?async S=>{var F,G,D;try{y.info("Starting auto-repair for page:",S);const M=Fr.find(je=>je.pageNumber===S);let ce=M==null?void 0:M.fixTargets;if(!ce||ce.length===0){const je=(G=(F=M==null?void 0:M.retryHistory)==null?void 0:F.filter(Re=>Re.type==="auto_repair"))==null?void 0:G.slice(-1)[0];(D=je==null?void 0:je.preRepairEval)!=null&&D.fixTargets&&je.preRepairEval.fixTargets.length>0&&(ce=je.preRepairEval.fixTargets,y.info(`Using ${ce.length} fix targets from retryHistory.preRepairEval`))}ce&&ce.length>0?y.info(`Using ${ce.length} existing fix targets`):y.info("No stored fix targets found, will re-evaluate");const ke=await at.repairImage(Ge,S,ce);ke.repaired?(Bt(je=>je.map(Re=>Re.pageNumber===S?{...Re,imageData:ke.imageData,wasAutoRepaired:!0,repairHistory:ke.repairHistory,repairedAt:new Date().toISOString()}:Re)),y.info("Auto-repair completed successfully:",{repaired:ke.repaired,repairs:ke.repairHistory.length})):ke.noErrorsFound&&y.info("No physics errors detected in the image")}catch(M){throw y.error("Auto-repair failed:",M),M}}:void 0,onRevertRepair:Ge&&((x==null?void 0:x.role)==="admin"||b)?async(S,F)=>{try{y.info("Reverting repair for page:",S),Bt(G=>G.map(D=>D.pageNumber===S?{...D,imageData:F,wasAutoRepaired:!1}:D)),await at.updateSceneImage(Ge,S,F),y.info("Repair reverted successfully")}catch(G){throw y.error("Failed to revert repair:",G),G}}:void 0,onSaveStoryText:Ge?async S=>{try{y.info("Saving story text for story:",Ge),await at.saveStoryText(Ge,S),Ys(S),y.info("Story text saved successfully")}catch(F){throw y.error("Failed to save story text:",F),F}}:void 0,onSaveTitleChange:Ge?async S=>{try{y.info("Saving title for story:",Ge,S),await at.saveStoryTitle(Ge,S),gs(S),y.info("Title saved successfully")}catch(F){throw y.error("Failed to save title:",F),F}}:void 0,userCredits:b?-1:(x==null?void 0:x.credits)||0,imageRegenerationCost:5,isImpersonating:b,onSelectImageVersion:Ge?async(S,F)=>{try{y.info("Selecting image version:",{pageNumber:S,versionIndex:F});const G=await at.setActiveImage(Ge,S,F);Bt(D=>D.map(M=>{if(M.pageNumber===S&&M.imageVersions){const ce=M.imageVersions[F];return{...M,imageData:(ce==null?void 0:ce.imageData)||M.imageData,imageVersions:M.imageVersions.map((ke,je)=>({...ke,isActive:je===F}))}}return M})),y.info("Image version selected:",G)}catch(G){throw y.error("Failed to select image version:",G),G}}:void 0,isPartial:Ra,failureReason:Ga,generatedPages:Ha,totalPages:Oa,generationSettings:ie||void 0})]})}return a.get("storyId")?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center",children:[e.jsx(Lt,{className:"w-12 h-12 text-indigo-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:r==="de"?"Geschichte wird geladen...":r==="fr"?"Chargement de l'histoire...":"Loading story..."})]}):us?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-indigo-700",children:r==="de"?"Geschichte wird erstellt...":r==="fr"?"CrÃ©ation de l'histoire...":"Creating your story..."}),e.jsx("p",{className:"text-indigo-500 mt-2",children:r==="de"?"Einen Moment Geduld bitte":r==="fr"?"Veuillez patienter":"Please wait a moment"})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Mt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:p.generateStory}),e.jsx("p",{className:"text-gray-600 mb-6",children:r==="de"?"Bereit, deine Geschichte zu erstellen!":r==="fr"?"PrÃªt Ã  crÃ©er votre histoire!":"Ready to create your story!"}),e.jsxs(Ps,{onClick:()=>jr(),size:"lg",icon:Mt,children:[p.generateStory," (",ft*10," Credits)"]})]});default:return null}};return f?e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(Mi,{currentStep:z,onStepClick:rr,canAccessStep:Ci,developerMode:fe,onDeveloperModeChange:xe,hideSteps:z===6&&!!Ge,onShowGenerationProgress:()=>{gr(!1),J(6)}}),e.jsx("div",{className:"px-3 md:px-8 mt-2 md:mt-8 flex-1",children:e.jsxs("div",{className:"md:bg-white md:rounded-2xl md:shadow-xl md:p-8",children:[_&&!us?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center",children:[e.jsx(Lt,{className:"w-12 h-12 text-indigo-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium mb-2",children:I?r==="de"?"Geschichte wird geladen...":r==="fr"?"Chargement de l'histoire...":"Loading story...":r==="de"?"Wird geladen...":r==="fr"?"Chargement...":"Loading..."}),I&&e.jsxs("div",{className:"w-64 mt-2",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all duration-300 ease-out",style:{width:I.total?`${Math.min(100,I.loaded/I.total*100)}%`:"100%"}})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2 text-center",children:[(I.loaded/(1024*1024)).toFixed(1)," MB",I.total&&e.jsxs("span",{children:[" (",Math.round(I.loaded/I.total*100),"%)"]})]})]})]}):e.jsxs(e.Fragment,{children:[z>=1&&z<=5&&!A&&e.jsx(dl,{step:z,text:(Xn[r]||Xn.en)[z]}),Di()]}),z<6&&!A&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[z===1&&Ce.length>=2&&!di()&&(()=>{const l=ci();if(!l)return null;const j=r==="de"?`${l.name} hat Beziehungen, die nicht definiert sind ("nicht bekannt")`:r==="fr"?`${l.name} a des relations non dÃ©finies ("ne connaÃ®t pas")`:`${l.name} has undefined relationships ("not known to")`;return e.jsxs("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-600 text-lg",children:"âš ï¸"}),e.jsx("p",{className:"text-amber-700 text-sm",children:j})]})})(),z!==5&&e.jsxs("div",{className:`flex ${z===1?"justify-end":"justify-between"}`,children:[z>1&&e.jsxs("button",{onClick:Cn,className:"bg-transparent text-gray-800 hover:bg-gray-100 px-6 py-3 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(zn,{size:20})," ",p.back]}),e.jsxs("button",{onClick:Ai,disabled:!vr(),className:`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${vr()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[p.next," ",e.jsx(Hr,{size:20})]})]}),z===5&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>jr(),disabled:!vr(),className:`w-full py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 ${vr()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-400 text-white cursor-not-allowed"}`,children:[e.jsx(Mt,{size:20})," ",p.generateStory," (",ft*10," Credits)"]}),fe&&e.jsxs("button",{onClick:()=>jr({skipImages:!0}),disabled:!vr(),className:`w-full py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 ${vr()?"bg-yellow-500 text-white hover:bg-yellow-600":"bg-gray-400 text-white cursor-not-allowed"}`,children:[e.jsx(Mt,{size:20}),r==="de"?"Nur Text generieren (ohne Bilder)":r==="fr"?"GÃ©nÃ©rer le texte uniquement (sans images)":"Generate Text Only (no images)"]}),fe&&e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg text-left",children:[e.jsxs("h3",{className:"text-sm font-semibold text-orange-700 mb-3",children:["ðŸ› ï¸ ",r==="de"?"Entwickler-Optionen - Schritte Ã¼berspringen":r==="fr"?"Options dÃ©veloppeur - Sauter des Ã©tapes":"Developer Options - Skip Steps"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:l=>Te(l.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Gliederung Ã¼berspringen":r==="fr"?"Sauter le plan":"Skip outline generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:l=>pe(l.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Text Ã¼berspringen":r==="fr"?"Sauter le texte":"Skip text generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Be,onChange:l=>me(l.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Szenenbeschreibungen Ã¼berspringen":r==="fr"?"Sauter les descriptions de scÃ¨nes":"Skip scene descriptions"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:de,onChange:l=>K(l.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Bilder Ã¼berspringen":r==="fr"?"Sauter les images":"Skip image generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Fe,onChange:l=>T(l.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Cover Ã¼berspringen":r==="fr"?"Sauter les couvertures":"Skip cover images"})]})]}),e.jsx("p",{className:"text-xs text-orange-600 mt-2",children:r==="de"?"Hinweis: Ãœbersprungene Schritte verwenden Platzhalter/leere Daten":r==="fr"?"Note: Les Ã©tapes sautÃ©es utiliseront des donnÃ©es vides/provisoires":"Note: Skipped steps will use placeholder/empty data"}),e.jsxs("h3",{className:"text-sm font-semibold text-orange-700 mt-4 mb-2",children:["ðŸ”§ ",r==="de"?"Feature-Optionen":r==="fr"?"Options de fonctionnalitÃ©s":"Feature Options"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:X,onChange:l=>Ae(l.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Auto-Reparatur aktivieren":r==="fr"?"Activer la rÃ©paration auto":"Enable auto-repair"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:r==="de"?"Versucht erkannte Bildfehler automatisch zu korrigieren (z.B. fehlende Finger)":r==="fr"?"Essaie de corriger automatiquement les erreurs d'image dÃ©tectÃ©es":"Attempts to automatically fix detected image issues (e.g., missing fingers)"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2",children:[e.jsx("input",{type:"checkbox",checked:be,onChange:l=>He(l.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"KonsistenzprÃ¼fung aktivieren":r==="fr"?"Activer la vÃ©rification de cohÃ©rence":"Enable final checks"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:r==="de"?"PrÃ¼ft Bilder und Text auf Konsistenz am Ende der Generierung":r==="fr"?"VÃ©rifie la cohÃ©rence des images et du texte Ã  la fin de la gÃ©nÃ©ration":"Checks images and text for consistency at end of generation"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2",children:[e.jsx("input",{type:"checkbox",checked:Rt,onChange:l=>Ut(l.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Inkrementelle Konsistenz":r==="fr"?"CohÃ©rence incrÃ©mentielle":"Incremental consistency"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:r==="de"?"PrÃ¼ft jedes Bild gegen vorherige Bilder wÃ¤hrend der Generierung":r==="fr"?"VÃ©rifie chaque image par rapport aux images prÃ©cÃ©dentes pendant la gÃ©nÃ©ration":"Checks each image against previous images during generation"}),Rt&&e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2 ml-6",children:[e.jsx("input",{type:"checkbox",checked:Gt,onChange:l=>Os(l.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Nur Protokoll (Dry Run)":r==="fr"?"Journaliser seulement (Dry Run)":"Dry run (log only)"})]}),Rt&&e.jsx("p",{className:"text-xs text-gray-500 ml-12",children:r==="de"?"Zeigt nur an, was repariert wÃ¼rde, ohne tatsÃ¤chlich zu reparieren":r==="fr"?"Affiche uniquement ce qui serait rÃ©parÃ© sans effectuer de rÃ©parations":"Shows what would be fixed without actually fixing"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:l=>Z(l.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Alle Avatare laden":r==="fr"?"Charger tous les avatars":"Load all avatars"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:r==="de"?"LÃ¤dt alle Avatar-Varianten (30MB+). NÃ¼tzlich zum Debuggen.":r==="fr"?"Charge toutes les variantes d'avatar (30MB+). Utile pour le dÃ©bogage.":"Loads all avatar variants (30MB+). Useful for debugging."})]}),fe&&((x==null?void 0:x.role)==="admin"||b)&&e.jsx(Nl,{selections:Pe,onChange:ye}),e.jsxs("button",{onClick:Cn,className:"bg-transparent text-gray-800 hover:bg-gray-100 px-6 py-3 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(zn,{size:20})," ",p.back]})]})]})]})}),us&&!Gs&&!ze&&!er.frontCover&&!va&&e.jsx(cl,{current:Ar.current,total:Ar.total,message:Ar.message,coverImages:er,characters:Ce,jobId:Ir||void 0,isStalled:Ca,onDismissStalled:()=>Rs(!1),isImpersonating:b,onMinimize:()=>Cr(!0),onCancel:Ir?async()=>{try{await at.cancelJob(Ir),y.info("Job cancelled by user"),Ls(!1),fr(null),Rs(!1),ks({current:0,total:0,message:""}),B(r==="de"?"Generierung abgebrochen":r==="fr"?"GÃ©nÃ©ration annulÃ©e":"Generation cancelled")}catch(l){y.error("Failed to cancel job:",l),h(r==="de"?"Abbruch fehlgeschlagen":r==="fr"?"Ã‰chec de l'annulation":"Failed to cancel")}}:void 0}),ja&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-sm mx-4 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:r==="de"?"Geschichte wird im Hintergrund generiert":r==="fr"?"Histoire en cours de gÃ©nÃ©ration":"Story generating in background"}),e.jsx("p",{className:"text-gray-600 mb-6",children:r==="de"?"Was mÃ¶chtest du tun?":r==="fr"?"Que voulez-vous faire?":"What would you like to do?"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{gr(!0),Cr(!1),t("/create?new=true")},className:"w-full py-3 px-4 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors font-medium",children:r==="de"?"Neue Geschichte erstellen":r==="fr"?"CrÃ©er une autre histoire":"Create another story"}),wa&&e.jsx("button",{onClick:()=>{gr(!0),Cr(!1),t("/stories")},className:"w-full py-3 px-4 bg-gray-100 text-gray-800 rounded-xl hover:bg-gray-200 transition-colors font-medium",children:r==="de"?"Meine Geschichten lesen":r==="fr"?"Lire mes histoires":"Read my stories"})]})]})}),Na&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-sm mx-4 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:r==="de"?"Nur ein Charakter":r==="fr"?"Un seul personnage":"Only One Character"}),e.jsx("p",{className:"text-gray-600 mb-6",children:r==="de"?"Geschichten werden interessanter mit mehreren Charakteren. Du hast nur einen Charakter erstellt.":r==="fr"?"Les histoires sont plus intÃ©ressantes avec plusieurs personnages. Vous n'avez crÃ©Ã© qu'un seul personnage.":"Stories are more interesting with multiple characters. You have only created one character."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{kr(!1),nn()},className:"w-full py-3 px-4 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors font-medium",children:r==="de"?"Weiteren Charakter erstellen":r==="fr"?"CrÃ©er un autre personnage":"Create another character"}),e.jsx("button",{onClick:async()=>{kr(!1),await rr(z+1)},className:"w-full py-3 px-4 bg-gray-100 text-gray-800 rounded-xl hover:bg-gray-200 transition-colors font-medium",children:r==="de"?"Trotzdem weiter":r==="fr"?"Continuer quand mÃªme":"Continue anyway"})]})]})}),ya&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-sm w-full p-6 text-center",children:[e.jsx("div",{className:"relative inline-block mb-4",children:e.jsx(Lt,{size:40,className:"animate-spin text-indigo-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:r==="de"?"Bild wird erstellt...":r==="fr"?"CrÃ©ation de l'image...":"Generating image..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:r==="de"?"Dies dauert etwa 30 Sekunden":r==="fr"?"Cela prend environ 30 secondes":"This takes about 30 seconds"})]})}),kt&&nt&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:r==="de"?"Bild bearbeiten":r==="fr"?"Modifier l'image":"Edit Image"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:nt.type==="image"?r==="de"?`Seite ${nt.pageNumber}`:r==="fr"?`Page ${nt.pageNumber}`:`Page ${nt.pageNumber}`:r==="de"?nt.coverType==="front"?"Titelseite":nt.coverType==="back"?"RÃ¼ckseite":"Einleitungsseite":r==="fr"?nt.coverType==="front"?"Couverture":nt.coverType==="back"?"Dos":"Page de dÃ©dicace":nt.coverType==="front"?"Front Cover":nt.coverType==="back"?"Back Cover":"Dedication Page"}),e.jsx("textarea",{value:tr,onChange:l=>sr(l.target.value),placeholder:r==="de"?`Beschreibe die gewÃ¼nschte Ã„nderung...
z.B. "Mach den Himmel blauer" oder "FÃ¼ge einen Schmetterling hinzu"`:r==="fr"?`DÃ©crivez le changement souhaitÃ©...
par ex. "Rendre le ciel plus bleu" ou "Ajouter un papillon"`:`Describe what you want to change...
e.g. "Make the sky bluer" or "Add a butterfly"`,className:"w-full h-32 p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 resize-none"}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{Tt(!1),br(null),sr("")},className:"flex-1 px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:r==="de"?"Abbrechen":r==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:async()=>{if(!(!tr.trim()||!Ge)){Tt(!1),Jr(!0);try{if(nt.type==="image"&&nt.pageNumber){const l=await at.editImage(Ge,nt.pageNumber,tr);if(y.info("Edit result:",{hasImageData:!!(l!=null&&l.imageData),score:l==null?void 0:l.qualityScore}),!(l!=null&&l.imageData))throw y.error("No imageData in edit response!",l),new Error("No image data returned from server");Bt(j=>j.map(m=>m.pageNumber===nt.pageNumber?{...m,imageData:l.imageData,qualityScore:l.qualityScore,qualityReasoning:l.qualityReasoning,wasEdited:!0,originalImage:l.originalImage,originalScore:l.originalScore,originalReasoning:l.originalReasoning}:m)),y.info("Image edited successfully, updated state with quality info")}else if(nt.type==="cover"&&nt.coverType){const l=await at.editCover(Ge,nt.coverType,tr);Wt(j=>{if(!j)return j;const m=nt.coverType==="front"?"frontCover":nt.coverType==="back"?"backCover":"initialPage",H=j[m],S={...typeof H=="object"?H:{},imageData:l.imageData,qualityScore:l.qualityScore,qualityReasoning:l.qualityReasoning,wasEdited:!0,originalImage:l.originalImage,originalScore:l.originalScore,originalReasoning:l.originalReasoning};return{...j,[m]:S}}),y.info("Cover edited successfully with quality info")}}catch(l){y.error("Edit failed:",l),h(r==="de"?"Bearbeitung fehlgeschlagen. Bitte versuche es erneut.":r==="fr"?"Ã‰chec de la modification. Veuillez rÃ©essayer.":"Edit failed. Please try again.")}finally{Jr(!1),br(null),sr("")}}},disabled:!tr.trim(),className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:r==="de"?"Bearbeiten":r==="fr"?"Modifier":"Edit"})]})]})}),e.jsx(Ul,{isOpen:ms,faces:dr,onSelect:gi,onUploadNew:hi,developerMode:fe}),e.jsx(ao,{isOpen:Sa,onClose:()=>hr(!1),onVerified:()=>{console.log("[EmailVerification] onVerified callback triggered");const l=localStorage.getItem("verificationGenerationStarted");if(l){const j=parseInt(l,10),m=Date.now()-120*1e3;if(j>m){console.log("[EmailVerification] Another window started recently, skipping"),hr(!1);return}console.log("[EmailVerification] Clearing stale flag"),localStorage.removeItem("verificationGenerationStarted")}localStorage.setItem("verificationGenerationStarted",Date.now().toString()),localStorage.removeItem("pendingStoryGeneration"),localStorage.removeItem("pending_story_type"),localStorage.removeItem("pending_art_style"),console.log("[EmailVerification] Calling generateStory with skipEmailCheck: true"),jr({skipEmailCheck:!0}),hr(!1)}})]}):e.jsx(zi,{fullScreen:!0})}export{Po as default};
