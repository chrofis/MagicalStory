const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WizardStep2Characters-B4jGUy8-.js","assets/index-Db35fN8K.js","assets/vendor-react-CqfXSjHo.js","assets/vendor-firebase-DTVMaYMy.js","assets/index-DNDE0SgQ.css","assets/Input-CEu9pdH3.js","assets/Textarea-dVa4S184.js","assets/sparkles-C116wel2.js","assets/book-open-MkdUs_9_.js","assets/check-DuXnYeV_.js","assets/pen-D7XnaujG.js","assets/trash-2-BSjWhdmj.js","assets/Modal-CkDLy1Xp.js","assets/download-CAKgue9x.js","assets/chevron-right-cQZJkTxS.js","assets/arrow-right-DUEV9lwG.js","assets/camera-G3JqLgvH.js","assets/pencil-Dt2cWnKX.js","assets/circle-x-RrH0wMTi.js","assets/clock-BjCJp5P5.js","assets/palette-DQZS5pa1.js","assets/book-Dfrw4Aln.js","assets/shopping-cart-DP7VWjTE.js","assets/arrow-left-BWaG3Tln.js","assets/WizardStep4StoryType-D_zGXmwP.js","assets/WizardStep5ArtStyle-DbI25i0F.js","assets/artStyles-DJIZ4CgP.js","assets/WizardStep6Summary-13isz1xE.js"])))=>i.map(i=>d[i]);
import{c as et,b as Ge,d as ya,j as e,X as Dt,u as Ot,a as va,L as gt,T as fi,C as Ka,E as kn,e as An,f as Pn,s as Oe,g as Ja,_ as xs}from"./index-Db35fN8K.js";import{b as o,u as Tn,e as In}from"./vendor-react-CqfXSjHo.js";import{U as ja,B as _s,I as Qa}from"./Input-CEu9pdH3.js";import{S as $n,A as Za,N as Dn}from"./Textarea-dVa4S184.js";import{C as Rn}from"./circle-x-RrH0wMTi.js";import{C as En}from"./clock-BjCJp5P5.js";import{M as bi,H as Fn,C as Ya,R as Gt,F as Wr,P as Xa,a as zn,I as ei,b as Bn}from"./Modal-CkDLy1Xp.js";import{D as wr,C as Zt}from"./download-CAKgue9x.js";import{C as pa}from"./chevron-right-cQZJkTxS.js";import{P as yi}from"./palette-DQZS5pa1.js";import{B as Mn}from"./book-Dfrw4Aln.js";import{C as Ln}from"./check-DuXnYeV_.js";import{S as ti}from"./shopping-cart-DP7VWjTE.js";import{B as Hs}from"./book-open-MkdUs_9_.js";import{S as Ur}from"./sparkles-C116wel2.js";import{A as ri}from"./arrow-left-BWaG3Tln.js";import{A as Gn}from"./arrow-right-DUEV9lwG.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=et("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _n=et("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=et("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=et("Images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=et("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=et("Link2Off",[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qn=et("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=et("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Un=et("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kn=et("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=et("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=et("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=et("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const si=et("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=et("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=et("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=et("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=et("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),Yn={async login(r,l){const n=await Ge.post("/api/auth/login",{username:r,password:l},{skipAuth:!0}),y={id:n.user.id,username:n.user.username,email:n.user.email,role:n.user.role,credits:n.user.credits};return{token:n.token,user:y}},async register(r,l,n){return Ge.post("/api/auth/register",{username:r,password:l,email:n},{skipAuth:!0})},async loginWithFirebase(r){const l=await Ge.post("/api/auth/firebase",{idToken:r},{skipAuth:!0}),n={id:l.user.id,username:l.user.username,email:l.user.email,role:l.user.role,credits:l.user.credits};return{token:l.token,user:n}},async getQuota(){const r=await Ge.get("/api/user/quota");return{storyQuota:r.storyQuota,storiesGenerated:r.storiesGenerated,remaining:r.remaining}},async getCredits(){const r=await Ge.get("/api/user/quota");return{credits:r.credits,unlimited:r.unlimited}},async updateEmail(r){await Ge.put("/api/user/update-email",{email:r})},async getShippingAddress(){try{return await Ge.get("/api/user/shipping-address")}catch{return null}},async updateShippingAddress(r){await Ge.put("/api/user/shipping-address",r)}},ie=ya("CharacterService");function vi(r){if(!r)return;const l=parseInt(r,10);if(!(isNaN(l)||l<0))return l<=1?"infant":l<=2?"toddler":l<=4?"preschooler":l<=6?"kindergartner":l<=8?"young-school-age":l<=10?"school-age":l<=12?"preteen":l<=14?"young-teen":l<=17?"teenager":l<=25?"young-adult":l<=39?"adult":l<=59?"middle-aged":l<=75?"senior":"elderly"}function ha(r){const l={height:r.height,build:r.build,face:r.other_features||r.otherFeatures,eyeColor:r.eye_color||r.eyeColor,hairColor:r.hair_color||r.hairColor,hairLength:r.hair_length||r.hairLength,hairStyle:r.hair_style||r.hairStyle,facialHair:r.facial_hair||r.facialHair,skinTone:r.skin_tone||r.skinTone,skinUndertone:r.skin_undertone||r.skinUndertone,skinToneHex:r.skin_tone_hex||r.skinToneHex,hair:r.hair_color||r.hairColor,other:r.other,detailedHairAnalysis:r.detailed_hair_analysis||r.detailedHairAnalysis,apparentAge:r.apparent_age||r.apparentAge},n=r.age_category||r.ageCategory||vi(r.age);return{id:r.id,name:r.name,gender:r.gender,age:r.age,ageCategory:n,physical:l.height||l.build||l.face||l.eyeColor||l.hairColor||l.hairLength||l.hairStyle||l.facialHair||l.skinTone||l.hair||l.other||l.detailedHairAnalysis||l.apparentAge?l:void 0,physicalTraitsSource:r.physical_traits_source||r.physicalTraitsSource,traits:{strengths:r.strengths||[],flaws:r.flaws||r.weaknesses||[],challenges:r.challenges||r.fears||[],specialDetails:r.special_details||r.specialDetails},photos:{original:r.photo_url||r.photoUrl,face:r.thumbnail_url||r.thumbnailUrl,body:r.body_photo_url||r.bodyPhotoUrl,bodyNoBg:r.body_no_bg_url||r.bodyNoBgUrl,faceBox:r.face_box||r.faceBox,bodyBox:r.body_box||r.bodyBox},avatars:r.avatars||r.clothing_avatars||r.clothingAvatars,clothing:r.clothing||r.structured_clothing||r.structuredClothing?{current:r.clothing,structured:r.structured_clothing||r.structuredClothing}:void 0,generatedOutfits:r.generated_outfits||r.generatedOutfits,storyRole:r.storyRole}}function ai(r){var n,y,s,C,x,A,P,m,T,S,D,v,V,d,G,F,ne,L,Z,E,te,Y,Q,$;const l=r.ageCategory||vi(r.age);return{id:r.id,name:r.name,gender:r.gender,age:r.age,age_category:l,apparent_age:(n=r.physical)==null?void 0:n.apparentAge,height:(y=r.physical)==null?void 0:y.height,build:(s=r.physical)==null?void 0:s.build,eye_color:(C=r.physical)==null?void 0:C.eyeColor,hair_color:(x=r.physical)==null?void 0:x.hairColor,hair_length:(A=r.physical)==null?void 0:A.hairLength,hair_style:(P=r.physical)==null?void 0:P.hairStyle,facial_hair:(m=r.physical)==null?void 0:m.facialHair,skin_tone:(T=r.physical)==null?void 0:T.skinTone,skin_undertone:(S=r.physical)==null?void 0:S.skinUndertone,skin_tone_hex:(D=r.physical)==null?void 0:D.skinToneHex,other_features:(v=r.physical)==null?void 0:v.face,other:(V=r.physical)==null?void 0:V.other,detailed_hair_analysis:(d=r.physical)==null?void 0:d.detailedHairAnalysis,physical_traits_source:r.physicalTraitsSource,face_box:(G=r.photos)==null?void 0:G.faceBox,body_box:(F=r.photos)==null?void 0:F.bodyBox,strengths:(ne=r.traits)==null?void 0:ne.strengths,flaws:(L=r.traits)==null?void 0:L.flaws,challenges:(Z=r.traits)==null?void 0:Z.challenges,special_details:(E=r.traits)==null?void 0:E.specialDetails,weaknesses:(te=r.traits)==null?void 0:te.flaws,fears:(Y=r.traits)==null?void 0:Y.challenges,clothing:(Q=r.clothing)==null?void 0:Q.current,structured_clothing:($=r.clothing)==null?void 0:$.structured,generated_outfits:r.generatedOutfits,storyRole:r.storyRole}}function Xn(r){return!r||r.length===0?[]:typeof r[0]=="string"?r.map(l=>({forward:l,inverse:l})):r}const De={async getCharacters(r=!1){const l=r?"/api/characters?includeAllAvatars=true":"/api/characters";return((await Ge.get(l)).characters||[]).map(ha)},async getCharacterData(r=!1){const l=r?"/api/characters?includeAllAvatars=true":"/api/characters",n=await Ge.get(l);return{characters:(n.characters||[]).map(ha),relationships:n.relationships||{},relationshipTexts:n.relationshipTexts||{},customRelationships:Xn(n.customRelationships),customStrengths:n.customStrengths||[],customWeaknesses:n.customWeaknesses||[],customFears:n.customFears||[]}},async saveCharacters(r){await Ge.post("/api/characters",{characters:r.map(ai)})},async saveCharacterData(r,l){const n=s=>{var x,A,P,m;const C=ai(s);return l!=null&&l.includePhotos&&(C.photo_url=(x=s.photos)==null?void 0:x.original,C.thumbnail_url=(A=s.photos)==null?void 0:A.face,C.body_photo_url=(P=s.photos)==null?void 0:P.body,C.body_no_bg_url=(m=s.photos)==null?void 0:m.bodyNoBg),C},y={characters:r.characters.map(n),relationships:r.relationships,relationshipTexts:r.relationshipTexts,customRelationships:r.customRelationships,customStrengths:r.customStrengths,customWeaknesses:r.customWeaknesses,customFears:r.customFears};await Ge.post("/api/characters",y)},async deleteCharacter(r){try{const l=await Ge.delete(`/api/characters/${r}`);return ie.success(`Deleted character ${r}: ${l.message}`),{success:!0}}catch(l){return ie.error(`Failed to delete character ${r}:`,l),{success:!1,error:String(l)}}},async saveCharacterRoles(r){try{return await Ge.put("/api/characters/roles",{roles:r}),ie.success(`Saved character roles: ${Object.keys(r).length} characters`),{success:!0}}catch(l){return ie.error("Failed to save character roles:",l),{success:!1,error:String(l)}}},async loadCharacterAvatars(r){try{const l=await Ge.get(`/api/characters/${r}/avatars`);return ie.info(`Loaded full avatars for character ${r}`),l.avatars||null}catch(l){return ie.error(`Failed to load avatars for character ${r}:`,l),null}},async loadFullCharacter(r){try{const l=await Ge.get(`/api/characters/${r}/full`);return l.character?(ie.info(`Loaded full data for character ${r}`),ha(l.character)):null}catch(l){return ie.error(`Failed to load full data for character ${r}:`,l),null}},async generateAvatarOptions(r,l){try{return await Ge.post("/api/generate-avatar-options",{facePhoto:r,gender:l,category:"standard"})}catch(n){const y=n instanceof Error?n.message:"Unknown error";return{success:!1,options:[],error:y}}},async generateClothingAvatars(r,l){var n,y,s,C,x,A,P,m,T,S,D;try{const v=parseInt(r.age)||10,V=r.gender||"child";let d;V==="male"?d=v>=18?"man":"boy":V==="female"?d=v>=18?"woman":"girl":d=v>=18?"person":"child";let F=`${((n=r.name)==null?void 0:n.trim())||`This ${d}`} is a ${v}-year-old ${d}`;r.physical&&(r.physical.hair&&(F+=`, ${r.physical.hair}`),r.physical.face&&(F+=`, ${r.physical.face}`),r.physical.build&&(F+=`, ${r.physical.build}`),r.physical.other&&(F+=`, ${r.physical.other}`));const ne=((y=r.photos)==null?void 0:y.bodyNoBg)||((s=r.photos)==null?void 0:s.body)||((C=r.photos)==null?void 0:C.face)||((x=r.photos)==null?void 0:x.original);ie.info(`ðŸŽ¨ Generating clothing avatars for ${r.name||"unnamed"} (id: ${r.id})`);const L=await Ge.post("/api/generate-clothing-avatars?async=true",{characterId:r.id,facePhoto:ne,physicalDescription:F,name:r.name,age:r.age,apparentAge:(A=r.physical)==null?void 0:A.apparentAge,gender:r.gender,build:(P=r.physical)==null?void 0:P.build,clothing:(m=r.clothing)==null?void 0:m.structured,avatarModel:l==null?void 0:l.avatarModel});if(L.async&&L.jobId){ie.info(`Avatar job started: ${L.jobId}, polling for completion...`);const E=60,te=2e3;for(let Y=0;Y<E;Y++){await new Promise($=>setTimeout($,te));const Q=await Ge.get(`/api/avatar-jobs/${L.jobId}`);if(Q.status==="complete"&&Q.clothingAvatars){ie.success(`Avatar job ${L.jobId} completed after ${(Y+1)*2}s`);const $=Q.clothingAvatars.extractedTraits,re=(T=Q.clothingAvatars.structuredClothing)==null?void 0:T.standard;return ie.info(`ðŸ” [DEBUG] extractedTraits: ${(S=JSON.stringify($))==null?void 0:S.substring(0,100)}`),ie.info(`ðŸ” [DEBUG] extractedClothing: ${JSON.stringify(re)}`),ie.info(`ðŸ” [DEBUG] structuredClothing keys: ${Object.keys(Q.clothingAvatars.structuredClothing||{})}`),{success:!0,avatars:Q.clothingAvatars,extractedTraits:$,extractedClothing:re}}if(Q.status==="failed")return ie.error(`Avatar job failed: ${Q.error}`),{success:!1,error:Q.error};Y%5===0&&ie.info(`Avatar job ${L.jobId}: ${Q.message||Q.status} (${Q.progress||0}%)`)}return{success:!1,error:"Avatar generation timed out"}}const Z=L;if(Z.success&&Z.clothingAvatars){ie.success(`Clothing avatars generated for ${r.name}`);const E=Z.clothingAvatars.extractedTraits,te=(D=Z.clothingAvatars.structuredClothing)==null?void 0:D.standard;return E&&ie.info(`Extracted traits: ${JSON.stringify(E)}`),te&&ie.info(`Extracted clothing: ${JSON.stringify(te)}`),{success:!0,avatars:Z.clothingAvatars,extractedTraits:E,extractedClothing:te}}else return ie.error(`Failed to generate avatars: ${Z.error}`),{success:!1,error:Z.error}}catch(v){return ie.error("Clothing avatar generation failed:",v),{success:!1,error:String(v)}}},async generateClothingAvatarsWithTraits(r){var l,n,y,s,C,x,A,P,m,T,S,D,v,V,d,G,F,ne;try{const L=parseInt(r.age)||10,Z=r.gender||"child";let E;Z==="male"?E=L>=18?"man":"boy":Z==="female"?E=L>=18?"woman":"girl":E=L>=18?"person":"child";let Y=`${((l=r.name)==null?void 0:l.trim())||`This ${E}`} is a ${L}-year-old ${E}`;r.physical&&(r.physical.hair&&(Y+=`, ${r.physical.hair}`),r.physical.face&&(Y+=`, ${r.physical.face}`),r.physical.build&&(Y+=`, ${r.physical.build}`),r.physical.other&&(Y+=`, ${r.physical.other}`));const Q=((n=r.photos)==null?void 0:n.bodyNoBg)||((y=r.photos)==null?void 0:y.body)||((s=r.photos)==null?void 0:s.face)||((C=r.photos)==null?void 0:C.original),$=(x=r.photos)!=null&&x.bodyNoBg?"bodyNoBg":(A=r.photos)!=null&&A.body?"body":(P=r.photos)!=null&&P.face?"face":"original",re=Q?Math.round(Q.length/1024):0,pe=Q==null?void 0:Q.startsWith("data:image/png");ie.info(`ðŸŽ¨ Generating clothing avatars WITH TRAITS for ${r.name} (id: ${r.id})`),ie.info(`ðŸ“¸ Photo source: ${$}, size: ${re}KB, format: ${pe?"PNG":"JPEG"}`),ie.info(`ðŸ“¸ Available photos: bodyNoBg=${!!((m=r.photos)!=null&&m.bodyNoBg)}, body=${!!((T=r.photos)!=null&&T.body)}, face=${!!((S=r.photos)!=null&&S.face)}, original=${!!((D=r.photos)!=null&&D.original)}`),ie.info(`Physical traits: ${JSON.stringify(r.physical)}`);const fe=r.physicalTraitsSource||{};ie.info(`Physical traits source: ${JSON.stringify(fe)}`),ie.info(`Physical skinTone value: '${(v=r.physical)==null?void 0:v.skinTone}', source: '${fe.skinTone}'`),ie.info(`Physical hairStyle value: '${(V=r.physical)==null?void 0:V.hairStyle}', source: '${fe.hairStyle}'`);const ye={};r.physical&&(fe.eyeColor==="user"&&r.physical.eyeColor&&(ye.eyeColor=r.physical.eyeColor),fe.hairColor==="user"&&r.physical.hairColor&&(ye.hairColor=r.physical.hairColor),fe.hairLength==="user"&&r.physical.hairLength&&(ye.hairLength=r.physical.hairLength),fe.hairStyle==="user"&&r.physical.hairStyle&&(ye.hairStyle=r.physical.hairStyle),fe.build==="user"&&r.physical.build&&(ye.build=r.physical.build),fe.skinTone==="user"&&r.physical.skinTone&&(ye.skinTone=r.physical.skinTone,r.physical.skinToneHex&&(ye.skinToneHex=r.physical.skinToneHex)),fe.face==="user"&&r.physical.face&&(ye.face=r.physical.face),fe.facialHair==="user"&&r.physical.facialHair&&(ye.facialHair=r.physical.facialHair),fe.other==="user"&&r.physical.other&&(ye.other=r.physical.other));const le=Object.keys(ye).length>0;ie.info(`Physical traits to send (user-edited only): ${le?JSON.stringify(ye):"none"}`);const Se=r.clothingSource||{},Ee={};(d=r.clothing)!=null&&d.structured&&(Se.upperBody==="user"&&r.clothing.structured.upperBody&&(Ee.upperBody=r.clothing.structured.upperBody),Se.lowerBody==="user"&&r.clothing.structured.lowerBody&&(Ee.lowerBody=r.clothing.structured.lowerBody),Se.shoes==="user"&&r.clothing.structured.shoes&&(Ee.shoes=r.clothing.structured.shoes),Se.fullBody==="user"&&r.clothing.structured.fullBody&&(Ee.fullBody=r.clothing.structured.fullBody));const Be=Object.keys(Ee).length>0;ie.info(`Clothing to send (user-edited only): ${Be?JSON.stringify(Ee):"none"}`);const X=await Ge.post("/api/generate-clothing-avatars?async=true",{characterId:r.id,facePhoto:Q,physicalDescription:Y,name:r.name,age:r.age,apparentAge:(G=r.physical)==null?void 0:G.apparentAge,gender:r.gender,build:ye.build||"average",physicalTraits:le?ye:void 0,clothing:Be?Ee:void 0});if(X.async&&X.jobId){ie.info(`Avatar job started: ${X.jobId}, polling for completion...`);const Ve=60,Ce=2e3;for(let Ue=0;Ue<Ve;Ue++){await new Promise(ge=>setTimeout(ge,Ce));const ue=await Ge.get(`/api/avatar-jobs/${X.jobId}`);if(ue.status==="complete"&&ue.clothingAvatars){ie.success(`Avatar job ${X.jobId} completed after ${(Ue+1)*2}s`);const ge=ue.clothingAvatars.extractedTraits,_=(F=ue.clothingAvatars.structuredClothing)==null?void 0:F.standard;return{success:!0,avatars:ue.clothingAvatars,extractedTraits:ge,extractedClothing:_}}if(ue.status==="failed")return ie.error(`Avatar job failed: ${ue.error}`),{success:!1,error:ue.error};Ue%5===0&&ie.info(`Avatar job ${X.jobId}: ${ue.message||ue.status} (${ue.progress||0}%)`)}return{success:!1,error:"Avatar generation timed out"}}if(X.success&&X.clothingAvatars){ie.success(`Clothing avatars WITH TRAITS generated for ${r.name}`);const Ve=X.clothingAvatars.extractedTraits,Ce=(ne=X.clothingAvatars.structuredClothing)==null?void 0:ne.standard;return{success:!0,avatars:X.clothingAvatars,extractedTraits:Ve,extractedClothing:Ce}}else return ie.error(`Failed to generate avatars with traits: ${X.error}`),{success:!1,error:X.error}}catch(L){return ie.error("Clothing avatar generation with traits failed:",L),{success:!1,error:String(L)}}},async analyzePhoto(r,l,n,y,s){var C,x,A,P,m,T,S,D,v,V,d,G,F,ne,L,Z,E,te,Y,Q;try{const $=await Ge.post("/api/analyze-photo",{imageData:r,language:l,selectedFaceId:n,cachedFaces:y,existingCharacterId:s});if(!$.success)return{success:!1,error:$.error};if($.multipleFacesDetected&&$.faces)return ie.info(`Multiple faces detected (${$.faceCount}), showing selection UI`),{success:!0,multipleFacesDetected:!0,faceCount:$.faceCount,faces:$.faces};const re={height:(C=$.attributes)==null?void 0:C.height,build:(x=$.attributes)==null?void 0:x.build,face:(A=$.attributes)==null?void 0:A.face,eyeColor:((P=$.attributes)==null?void 0:P.eye_color)||((m=$.attributes)==null?void 0:m.eyeColor),hairColor:((T=$.attributes)==null?void 0:T.hair_color)||((S=$.attributes)==null?void 0:S.hairColor),hairLength:((D=$.attributes)==null?void 0:D.hair_length)||((v=$.attributes)==null?void 0:v.hairLength),hairStyle:((V=$.attributes)==null?void 0:V.hair_style)||((d=$.attributes)==null?void 0:d.hairStyle),hair:((G=$.attributes)==null?void 0:G.hair_color)||((F=$.attributes)==null?void 0:F.hairColor),other:(ne=$.attributes)==null?void 0:ne.other_features};return{success:$.success,characterId:$.characterId,multipleFacesDetected:!1,faceCount:$.faceCount,photos:{face:$.faceThumbnail,body:$.bodyCrop,bodyNoBg:$.bodyNoBg,faceBox:$.faceBox,bodyBox:$.bodyBox},age:(L=$.attributes)==null?void 0:L.age,apparentAge:(Z=$.attributes)==null?void 0:Z.apparent_age,gender:(E=$.attributes)==null?void 0:E.gender,physical:re.height||re.build||re.face||re.eyeColor||re.hairColor||re.hairLength||re.hairStyle||re.hair||re.other?re:void 0,clothing:(te=$.attributes)!=null&&te.clothing||(Y=$.attributes)!=null&&Y.clothingStyle||(Q=$.attributes)!=null&&Q.clothingColors?{current:$.attributes.clothing,style:$.attributes.clothingStyle||$.attributes.clothingColors}:void 0,_debug:$._debug}}catch($){return ie.error("Photo analysis failed:",$),{success:!1,error:"unknown_error"}}},needsAvatars(r){var s,C,x,A;if(!!!((s=r.photos)!=null&&s.original||(C=r.photos)!=null&&C.face||(x=r.photos)!=null&&x.body||(A=r.photos)!=null&&A.bodyNoBg))return!1;const n=r.avatars;return n?n.status==="generating"||n.status==="pending"?!1:n.status==="failed"?!0:!!!(n.winter||n.standard||n.summer||n.formal||n.hasFullAvatars):!0},async generateAndSaveAvatarForCharacter(r,l,n){var s,C,x,A,P,m,T,S,D,v,V,d,G,F,ne,L,Z,E,te,Y;const y={characterId:r.id,characterName:r.name,success:!1};try{if(!!!((s=r.photos)!=null&&s.original||(C=r.photos)!=null&&C.face||(x=r.photos)!=null&&x.body||(A=r.photos)!=null&&A.bodyNoBg))return y.skipped=!0,y.skipReason="No photo available",y;l==null||l("generating",`Generating avatars for ${r.name}...`),ie.info(`ðŸŽ¨ Generating avatars for ${r.name} (id: ${r.id})${n!=null&&n.avatarModel?`, model: ${n.avatarModel}`:""}`);const $=await De.generateClothingAvatars(r,n);if(!$.success||!$.avatars)return y.error=$.error||"Avatar generation failed",l==null||l("error",y.error),y;y.avatars=$.avatars,y.extractedTraits=$.extractedTraits,y.extractedClothing=$.extractedClothing,l==null||l("saving",`Fetching updated data for ${r.name}...`);let re=null;const pe=30;for(let fe=0;fe<pe;fe++){if(fe>0){const ye=Math.min(500*Math.pow(1.2,fe),3e3);ie.info(`[AVATAR] Retry ${fe+1}/${pe}: waiting ${Math.round(ye)}ms for avatar data...`),await new Promise(le=>setTimeout(le,ye))}if(re=await De.loadFullCharacter(r.id),(P=re==null?void 0:re.avatars)!=null&&P.standard||(m=re==null?void 0:re.avatars)!=null&&m.winter||(T=re==null?void 0:re.avatars)!=null&&T.summer){ie.info(`[AVATAR] Got fresh data with avatars on attempt ${fe+1}`);break}}return re?(y.character=re,(S=re.avatars)!=null&&S.standard||(D=re.avatars)!=null&&D.winter||(v=re.avatars)!=null&&v.summer||ie.warn(`âš ï¸ Fresh DB data for ${r.name} missing avatars after ${pe} retries - server may not have saved them`),ie.info(`ðŸ“‹ Using server-saved data for ${r.name}`)):(ie.error(`âŒ Character ${r.name} (id: ${r.id}) not found in DB after avatar job - avatars lost!`),y.character={...r,avatars:{status:"failed"},physical:$.extractedTraits?{...r.physical,apparentAge:$.extractedTraits.apparentAge||((V=r.physical)==null?void 0:V.apparentAge),build:$.extractedTraits.build||((d=r.physical)==null?void 0:d.build),eyeColor:$.extractedTraits.eyeColor||((G=r.physical)==null?void 0:G.eyeColor),eyeColorHex:$.extractedTraits.eyeColorHex||((F=r.physical)==null?void 0:F.eyeColorHex),hairColor:$.extractedTraits.hairColor||((ne=r.physical)==null?void 0:ne.hairColor),hairColorHex:$.extractedTraits.hairColorHex||((L=r.physical)==null?void 0:L.hairColorHex),hairLength:$.extractedTraits.hairLength||((Z=r.physical)==null?void 0:Z.hairLength),hairStyle:$.extractedTraits.hairStyle||((E=r.physical)==null?void 0:E.hairStyle),skinTone:$.extractedTraits.skinTone||((te=r.physical)==null?void 0:te.skinTone),skinToneHex:$.extractedTraits.skinToneHex||((Y=r.physical)==null?void 0:Y.skinToneHex)}:r.physical,clothing:$.extractedClothing?{...r.clothing,structured:{upperBody:$.extractedClothing.upperBody||void 0,lowerBody:$.extractedClothing.lowerBody||void 0,shoes:$.extractedClothing.shoes||void 0,fullBody:$.extractedClothing.fullBody||void 0}}:r.clothing}),y.success=!0,l==null||l("complete",`Avatars saved for ${r.name}`),ie.success(`âœ… Avatars generated and saved for ${r.name}`),y}catch(Q){return y.error=String(Q),l==null||l("error",y.error),ie.error(`Failed to generate/save avatars for ${r.name}:`,Q),y}},async generateAvatarsForCharacters(r,l){const{forceRegenerate:n=!1,maxConcurrent:y=2,onProgress:s}=l||{};ie.info("ðŸŽ¨ Starting batch avatar generation...");const C=await De.getCharacterData();let x;if(r&&r.length>0?x=C.characters.filter(D=>r.includes(D.id)):x=C.characters.filter(D=>{var v,V;return n?!!((v=D.photos)!=null&&v.original||(V=D.photos)!=null&&V.face):De.needsAvatars(D)}),x.length===0)return ie.info("No characters need avatar generation"),{results:[],successCount:0,failCount:0,skipCount:0};ie.info(`Processing ${x.length} characters for avatar generation`);const A=[],P=new Map;for(let D=0;D<x.length;D+=y){const V=x.slice(D,D+y).map(async G=>{var ne,L,Z,E,te;const F={characterId:G.id,characterName:G.name,success:!1};try{if(!!!((ne=G.photos)!=null&&ne.original||(L=G.photos)!=null&&L.face||(Z=G.photos)!=null&&Z.body||(E=G.photos)!=null&&E.bodyNoBg))return F.skipped=!0,F.skipReason="No photo available",F;if(!n&&((te=G.avatars)!=null&&te.winter))return F.skipped=!0,F.skipReason="Avatars already exist",F;s==null||s(G.id,"generating",`Generating avatars for ${G.name}...`),ie.info(`ðŸŽ¨ Generating avatars for ${G.name}...`);const Q=await De.generateClothingAvatars(G);return!Q.success||!Q.avatars?(F.error=Q.error||"Avatar generation failed",s==null||s(G.id,"error",F.error),F):(F.avatars=Q.avatars,F.success=!0,P.set(G.id,{...G,avatars:Q.avatars}),s==null||s(G.id,"complete",`Avatars generated for ${G.name}`),ie.success(`âœ… Avatars generated for ${G.name}`),F)}catch(Y){return F.error=String(Y),s==null||s(G.id,"error",F.error),ie.error(`Failed to generate avatars for ${G.name}:`,Y),F}}),d=await Promise.all(V);A.push(...d)}if(P.size>0){ie.info(`ðŸ’¾ Saving ${P.size} character avatar updates...`);const D=await De.getCharacterData(),v=D.characters.map(V=>P.get(V.id)||V);await De.saveCharacterData({...D,characters:v}),ie.success(`ðŸ’¾ Saved character data for ${P.size} characters`)}const m=A.filter(D=>D.success).length,T=A.filter(D=>!D.success&&!D.skipped).length,S=A.filter(D=>D.skipped).length;return ie.info(`Avatar generation complete: ${m} success, ${T} failed, ${S} skipped`),{results:A,successCount:m,failCount:T,skipCount:S}},async regenerateAvatarsForCharacter(r,l,n){ie.info(`ðŸ”„ Regenerating avatars for character ${r}...`);const s=(await De.getCharacterData()).characters.find(x=>x.id===r);if(!s)return{characterId:r,characterName:"Unknown",success:!1,error:"Character not found"};const C={...s,avatars:{status:"pending"}};return De.generateAndSaveAvatarForCharacter(C,l?(x,A)=>l(x,A):void 0,n)}},ii={sm:"h-1",md:"h-2",lg:"h-3"},eo={default:"bg-indigo-600",success:"bg-green-500",warning:"bg-yellow-500",gradient:"bg-gradient-to-r from-indigo-500 to-indigo-600"};function to({value:r,max:l=100,label:n,showPercentage:y=!1,size:s="md",variant:C="gradient",className:x=""}){const A=Math.min(Math.max(r/l*100,0),100);return e.jsxs("div",{className:x,children:[(n||y)&&e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n&&e.jsx("span",{className:"text-sm font-medium text-gray-700",children:n}),y&&e.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(A),"%"]})]}),e.jsx("div",{className:`w-full bg-gray-200 rounded-full overflow-hidden ${ii[s]}`,children:e.jsx("div",{className:`${ii[s]} ${eo[C]} rounded-full transition-all duration-500 ease-out`,style:{width:`${A}%`}})})]})}const dr=ya("ImageLoad");function Ms({src:r,alt:l,className:n,label:y}){const[s,C]=o.useState(!0),[x,A]=o.useState(null),P=o.useRef(0),m=o.useRef(null);o.useEffect(()=>{r&&r.length>100?(P.current=Date.now(),dr.info(`â³ Loading ${y||l}`,{isBase64:r==null?void 0:r.startsWith("data:"),sizeKB:Math.round(r.length*3/4/1024)})):P.current=0,C(!0),A(null)},[r,l,y]);const T=()=>{if(C(!1),P.current===0){dr.info(`âœ… Loaded ${y||l} (placeholder/empty)`);return}const D=Date.now()-P.current;A(D);const V=(r==null?void 0:r.startsWith("data:"))?Math.round(r.length*3/4/1024):null,d=m.current?`${m.current.naturalWidth}x${m.current.naturalHeight}`:"unknown";D<100?dr.success(`âœ… Loaded ${y||l} in ${D}ms`,{sizeKB:V,naturalSize:d}):D<500?dr.info(`âœ… Loaded ${y||l} in ${D}ms`,{sizeKB:V,naturalSize:d}):D<2e3?dr.warn(`âš ï¸ Slow load: ${y||l} took ${D}ms`,{sizeKB:V,naturalSize:d}):dr.error(`ðŸ¢ Very slow: ${y||l} took ${D}ms`,{sizeKB:V,naturalSize:d}),D>1e3&&ro({type:"slow_image_load",label:y||l,loadTimeMs:D,sizeKB:V,naturalSize:d,userAgent:navigator.userAgent,timestamp:new Date().toISOString()})},S=()=>{if(C(!1),P.current===0){dr.error(`âŒ Failed to load ${y||l} (no data received)`);return}const D=Date.now()-P.current;dr.error(`âŒ Failed to load ${y||l} after ${D}ms`)};return e.jsx("img",{ref:m,src:r,alt:l,className:n,onLoad:T,onError:S,draggable:!1})}async function ro(r){try{await fetch("/api/log-error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errorType:"Performance",message:`Slow image load: ${r.label} took ${r.loadTimeMs}ms`,userAgent:r.userAgent,timestamp:r.timestamp,url:window.location.href})})}catch{}}function so({step:r,text:l}){const n=`wizard_helper_dismissed_${r}`,[y,s]=o.useState(()=>localStorage.getItem(n)==="true");o.useEffect(()=>{const x=localStorage.getItem(n)==="true";s(x)},[r,n]);const C=()=>{localStorage.setItem(n,"true"),s(!0)};return y?null:e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg px-3 py-2 md:px-4 md:py-3 mb-4 flex items-start gap-2 md:gap-3",children:[e.jsx("p",{className:"text-sm text-indigo-700 flex-1",children:l}),e.jsx("button",{onClick:C,className:"text-indigo-400 hover:text-indigo-600 transition-colors flex-shrink-0 p-0.5","aria-label":"Dismiss",children:e.jsx(Dt,{size:16})})]})}function ao({current:r,total:l,message:n,isGenerating:y=!0,coverImages:s,jobId:C,onCancel:x,onMinimize:A,characters:P=[],isStalled:m=!1,onDismissStalled:T,isImpersonating:S=!1}){const{language:D}=Ot(),{user:v}=va(),V=(v==null?void 0:v.role)==="admin"||S,[d,G]=o.useState(!1),[F,ne]=o.useState(0),L=[{en:"{name} is getting ready for their big adventure...",de:"{name} macht sich bereit fÃ¼r das grosse Abenteuer...",fr:"{name} se prÃ©pare pour sa grande aventure..."},{en:"{name} is practicing their hero pose...",de:"{name} Ã¼bt gerade die Heldenpose...",fr:"{name} s'entraÃ®ne Ã  prendre la pose du hÃ©ros..."},{en:"{name} can't wait to see what happens next!",de:"{name} kann es kaum erwarten zu sehen, was als NÃ¤chstes passiert!",fr:"{name} a hÃ¢te de voir ce qui va se passer !"},{en:"{name} is warming up for the adventure ahead...",de:"{name} wÃ¤rmt sich fÃ¼r das bevorstehende Abenteuer auf...",fr:"{name} s'Ã©chauffe pour l'aventure Ã  venir..."},{en:"{name} just found a magic feather! Adding it to the story...",de:"{name} hat gerade eine Zauberfeder gefunden! Wir fÃ¼gen sie der Geschichte hinzu...",fr:"{name} vient de trouver une plume magique ! On l'ajoute au rÃ©cit..."},{en:"{name} is whispering secrets to the story wizard...",de:"{name} flÃ¼stert dem Geschichtenzauberer Geheimnisse zu...",fr:"{name} chuchote des secrets au magicien des histoires..."},{en:"{name} is peeking around the corner to see what's coming...",de:"{name} schaut um die Ecke, um zu sehen, was kommt...",fr:"{name} jette un coup d'Å“il au coin pour voir ce qui arrive..."},{en:"{name} is doing a little happy dance!",de:"{name} macht einen kleinen Freudentanz!",fr:"{name} fait une petite danse de joie !"},{en:"{name} is collecting stars for the story...",de:"{name} sammelt Sterne fÃ¼r die Geschichte...",fr:"{name} collectionne des Ã©toiles pour le rÃ©cit..."},{en:"{name} just met a friendly dragon! Making friends...",de:"{name} hat gerade einen freundlichen Drachen getroffen! Sie werden Freunde...",fr:"{name} vient de rencontrer un dragon amical ! Ils deviennent amis..."}],Z=o.useRef({}),[E,te]=o.useState(null),Y=o.useMemo(()=>P.filter(ue=>{var _;const ge=ue.avatars;return ge&&(((_=ge.faceThumbnails)==null?void 0:_.standard)||ge.standard||ge.summer||ge.winter||ge.formal||ge.hasFullAvatars)}),[P]),Q=ue=>{var Ae;const ge=ue.avatars;if(!ge)return"";if((Ae=ge.faceThumbnails)!=null&&Ae.standard)return ge.faceThumbnails.standard;const _=[];return ge.standard&&_.push(ge.standard),ge.summer&&_.push(ge.summer),ge.winter&&_.push(ge.winter),ge.formal&&_.push(ge.formal),_[Math.floor(Math.random()*_.length)]||""},$=o.useMemo(()=>{const ue=[{type:"message",key:"timeInfo"},{type:"message",key:"tipCharacters"},{type:"message",key:"emailInfo"},{type:"message",key:"tipStoryPlot"},{type:"message",key:"canClose"},{type:"message",key:"tipLocations"},{type:"message",key:"tipArtStyle"}];if(Y.length===0)return ue;const ge=[],_=Math.max(ue.length,Y.length);for(let Ae=0;Ae<_;Ae++)ge.push(ue[Ae%ue.length]),ge.push({type:"character",char:Y[Ae%Y.length]});return ge},[Y]);if(o.useEffect(()=>{if($.length<=1)return;const ue=setInterval(()=>{ne(ge=>(ge+1)%$.length)},8e3);return()=>clearInterval(ue)},[$.length]),o.useEffect(()=>{if($.length===0)return;const ue=$[F];if(ue.type==="character"){const ge=ue.char,_=Q(ge),tt=((Z.current[ge.id]??-1)+1)%L.length;Z.current[ge.id]=tt;const _e=L[tt],vt=(D==="de"?_e.de:D==="fr"?_e.fr:_e.en).replace("{name}",ge.name);te({avatarUrl:_,message:vt})}else te(null)},[F,$,D]),!y||l===0)return null;const re=l===100?r:Math.round(r/l*100),pe=ue=>{if(ue)return typeof ue=="string"?ue:ue.imageData},fe=pe(s==null?void 0:s.frontCover),ye=pe(s==null?void 0:s.initialPage),le=pe(s==null?void 0:s.backCover),Se=!!fe,Ee=!!ye,Be=!!le,X=Se||Ee||Be,Ve={en:{title:"Creating Your Story!",timeInfo:"Your story will start to display in about 1 minute. The full story can take up to 10 minutes.",emailInfo:"You will receive an email when your story is ready.",canClose:"You can wait here or close the browser - your story will keep generating.",tipCharacters:"The better you describe your characters, the more fun the story becomes!",tipStoryPlot:'"Story Plot / Story Details" lets you craft your own personal adventure.',tipLocations:'Add your hometown and favorite places to "Story Plot / Story Details" for a personal touch.',tipArtStyle:"What's your favorite art style? For picture books, watercolor works great!",coversPreview:"Cover Preview",frontCover:"Front",initialPage:"Inside",backCover:"Back",cancelJob:"Cancel Generation",cancelling:"Cancelling...",stalled:"Generation seems stuck",stalledDesc:"No progress for a while. This can happen due to high server load.",continueWaiting:"Keep Waiting",continueInBackground:"Continue in Background"},de:{title:"Geschichte wird erstellt!",timeInfo:"Deine Geschichte wird in etwa 1 Minute angezeigt. Die Erstellung der vollstÃ¤ndigen Geschichte kann bis zu 10 Minuten dauern.",emailInfo:"Du erhÃ¤ltst eine E-Mail, wenn deine Geschichte bereit ist.",canClose:"Du kannst hier warten oder den Browser schliessen - deine Geschichte wird weiter generiert.",tipCharacters:"Je besser du deine Charaktere beschreibst, desto lustiger wird die Geschichte!",tipStoryPlot:'Mit "Handlung / Angaben zur Geschichte" kannst du dein ganz persÃ¶nliches Abenteuer gestalten.',tipLocations:'FÃ¼ge deinen Heimatort und Lieblingsorte zu "Handlung / Angaben zur Geschichte" hinzu fÃ¼r eine persÃ¶nliche Note.',tipArtStyle:"Was ist dein Lieblings-Kunststil? FÃ¼r BilderbÃ¼cher funktioniert Aquarell besonders gut!",coversPreview:"Cover-Vorschau",frontCover:"Vorne",initialPage:"Innen",backCover:"Hinten",cancelJob:"Generierung abbrechen",cancelling:"Wird abgebrochen...",stalled:"Generierung scheint hÃ¤ngen zu bleiben",stalledDesc:"Seit einer Weile kein Fortschritt. Dies kann bei hoher Serverlast passieren.",continueWaiting:"Weiter warten",continueInBackground:"Im Hintergrund fortsetzen"},fr:{title:"CrÃ©ation de votre histoire!",timeInfo:"Votre rÃ©cit commencera Ã  s'afficher dans environ 1 minute. Le rÃ©cit complet peut prendre jusqu'Ã  10 minutes.",emailInfo:"Vous recevrez un email quand votre rÃ©cit sera prÃªt.",canClose:"Vous pouvez attendre ici ou fermer le navigateur - votre rÃ©cit continuera Ã  Ãªtre gÃ©nÃ©rÃ©.",tipCharacters:"Mieux vous dÃ©crivez vos personnages, plus le rÃ©cit sera amusant !",tipStoryPlot:'"Intrigue / Contexte du rÃ©cit" vous permet de crÃ©er votre propre aventure personnelle.',tipLocations:'Ajoutez votre ville et vos endroits prÃ©fÃ©rÃ©s Ã  "Intrigue / Contexte du rÃ©cit" pour une touche personnelle.',tipArtStyle:"Quel est votre style artistique prÃ©fÃ©rÃ© ? Pour les livres d'images, l'aquarelle fonctionne trÃ¨s bien !",coversPreview:"AperÃ§u des couvertures",frontCover:"Avant",initialPage:"IntÃ©rieur",backCover:"ArriÃ¨re",cancelJob:"Annuler la gÃ©nÃ©ration",cancelling:"Annulation...",stalled:"La gÃ©nÃ©ration semble bloquÃ©e",stalledDesc:"Aucun progrÃ¨s depuis un moment. Cela peut arriver en cas de forte charge serveur.",continueWaiting:"Continuer Ã  attendre",continueInBackground:"Continuer en arriÃ¨re-plan"}},Ce=Ve[D]||Ve.en,Ue=({imageData:ue,label:ge,isReady:_})=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`w-16 h-16 md:w-20 md:h-20 rounded-lg overflow-hidden border-2 ${_?"border-green-400":"border-gray-200"} bg-gray-100 flex items-center justify-center`,children:_&&ue?e.jsx("img",{src:ue,alt:ge,className:"w-full h-full object-cover"}):e.jsx(gt,{size:20,className:"animate-spin text-gray-400"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[_&&e.jsx(Ka,{size:12,className:"text-green-500"}),e.jsx("span",{className:`text-xs ${_?"text-green-600 font-medium":"text-gray-400"}`,children:ge})]})]});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`bg-white rounded-2xl shadow-xl w-full p-6 md:p-8 ${X?"max-w-lg":"max-w-md"}`,children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"relative inline-block mb-3",children:[e.jsx(gt,{size:48,className:"animate-spin text-indigo-600"}),e.jsx("span",{className:"absolute -top-1 -right-1 text-xl",children:"âœ¨"})]}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-800",children:Ce.title})]}),!X&&$.length>0&&e.jsx("div",{className:"mb-6 min-h-[220px] flex items-center justify-center",children:(()=>{const ue=$[F];if(ue.type==="character"&&E)return e.jsxs("div",{className:"flex flex-col items-center gap-3 animate-fade-in",children:[e.jsx("div",{className:"w-32 h-44 md:w-40 md:h-52 rounded-xl overflow-hidden border-4 border-indigo-200 shadow-lg bg-gradient-to-b from-indigo-50 to-purple-50",children:e.jsx("img",{src:E.avatarUrl,alt:ue.char.name,className:"w-full h-full object-contain"})}),e.jsx("p",{className:"text-sm text-center text-gray-600 max-w-xs italic",children:E.message})]},`char-${ue.char.id}-${F}`);if(ue.type==="message"){const ge=ue.key,_=Ce[ge]||"",Ae=ge==="timeInfo"?e.jsx(En,{size:20,className:"text-indigo-500 shrink-0"}):ge==="emailInfo"?e.jsx(bi,{size:20,className:"text-indigo-500 shrink-0"}):e.jsx(Ka,{size:20,className:"text-indigo-500 shrink-0"});return e.jsxs("div",{className:"flex items-start gap-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 max-w-sm animate-fade-in",children:[Ae,e.jsx("p",{className:"text-sm text-gray-700",children:_})]})}return null})()}),X&&e.jsxs("div",{className:"mb-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-indigo-700 text-center mb-3",children:Ce.coversPreview}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(Ue,{imageData:fe,label:Ce.frontCover,isReady:Se}),e.jsx(Ue,{imageData:ye,label:Ce.initialPage,isReady:Ee}),e.jsx(Ue,{imageData:le,label:Ce.backCover,isReady:Be})]})]}),X&&e.jsxs("div",{className:"mb-4 text-center",children:[e.jsxs("p",{className:"text-sm text-gray-600 flex items-center justify-center gap-2",children:[e.jsx(gt,{size:14,className:"animate-spin text-indigo-500"}),D==="de"?"Bilder fÃ¼r die Seiten werden jetzt erstellt...":D==="fr"?"CrÃ©ation des images pour les pages en cours...":"Now generating images for the pages..."]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:D==="de"?"Dies kann einige Minuten dauern. Du kannst den Browser schliessen.":D==="fr"?"Cela peut prendre quelques minutes. Vous pouvez fermer le navigateur.":"This may take a few minutes. You can close the browser."})]}),e.jsx("div",{className:"mb-4",children:e.jsx(to,{value:re,max:100,showPercentage:!0,size:"lg"})}),A&&e.jsx("button",{onClick:A,className:"w-full mb-4 px-4 py-2.5 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded-lg font-medium transition-colors text-sm",children:Ce.continueInBackground}),m&&e.jsx("div",{className:"mb-4 bg-amber-50 border border-amber-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fi,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-amber-800 mb-1",children:Ce.stalled}),e.jsx("p",{className:"text-sm text-amber-700 mb-3",children:Ce.stalledDesc}),e.jsxs("div",{className:"flex gap-2",children:[T&&e.jsx("button",{onClick:T,className:"px-3 py-1.5 bg-amber-100 hover:bg-amber-200 text-amber-800 rounded-lg text-sm font-medium transition-colors",children:Ce.continueWaiting}),x&&e.jsx("button",{onClick:()=>{if(!d){G(!0);try{x()}finally{G(!1)}}},disabled:d,className:"px-3 py-1.5 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:d?Ce.cancelling:Ce.cancelJob})]})]})]})}),V&&C&&x&&e.jsxs("button",{onClick:async()=>{if(!d){G(!0);try{x()}finally{G(!1)}}},disabled:d,className:"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:[d?e.jsx(gt,{size:16,className:"animate-spin"}):e.jsx(Rn,{size:16}),d?Ce.cancelling:Ce.cancelJob]})]})})}function Kr(r,l){const n=new Blob([r],{type:"text/plain;charset=utf-8"}),y=URL.createObjectURL(n),s=document.createElement("a");s.href=y,s.download=l,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(y)}function fa(r,l=0){const n="  ".repeat(l);if(r==null)return`${n}null`;if(typeof r=="boolean")return`${n}${r?"YES":"NO"}`;if(typeof r=="number")return`${n}${r}`;if(typeof r=="string")return`${n}${r}`;if(Array.isArray(r))return r.length===0?`${n}[]`:r.map((y,s)=>`${n}[${s}]: ${fa(y,0)}`).join(`
`);if(typeof r=="object"){const y=Object.entries(r);return y.length===0?`${n}{}`:y.map(([s,C])=>{const x=fa(C,l+1);return typeof C=="object"&&C!==null?`${n}${s}:
${x}`:`${n}${s}: ${x.trim()}`}).join(`
`)}return`${n}${String(r)}`}function Ls({data:r,language:l,title:n}){const[y,s]=o.useState(new Set);if(!r)return e.jsx("div",{className:"text-gray-400 italic text-sm",children:l==="de"?"Keine Daten":"No data"});let C=r;if(typeof r=="string")try{C=JSON.parse(r)}catch{return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-1",children:e.jsxs("button",{onClick:()=>Kr(r,`${n||"evaluation"}.txt`),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1",title:"Download as text file",children:[e.jsx(wr,{size:12})," Download"]})}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap bg-gray-50 p-3 rounded max-h-80 overflow-auto font-mono",children:r})]})}const x=m=>{const T=new Set(y);T.has(m)?T.delete(m):T.add(m),s(T)},A=()=>{const m=fa(C);Kr(m,`${n||"evaluation"}.txt`)},P=(m,T,S=0)=>{const D=y.has(m);if(T==null)return e.jsx("span",{className:"text-gray-400",children:"null"});if(typeof T=="boolean")return e.jsx("span",{className:T?"text-green-600 font-medium":"text-red-600 font-medium",children:T?"âœ“":"âœ—"});if(typeof T=="number"){const v=T>=70?"text-green-600":T>=50?"text-yellow-600":"text-red-600";return e.jsx("span",{className:`font-bold ${v}`,children:T})}if(typeof T=="string")return T.length>100?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>x(m),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[D?e.jsx(Zt,{size:14}):e.jsx(pa,{size:14}),D?"Collapse":`Show (${T.length} chars)`]}),D&&e.jsx("div",{className:"mt-1 p-2 bg-gray-100 rounded text-sm whitespace-pre-wrap font-mono",children:T})]}):e.jsx("span",{className:"text-gray-700",children:T});if(Array.isArray(T))return T.length===0?e.jsx("span",{className:"text-gray-400",children:"[]"}):e.jsx("div",{className:"ml-2 border-l-2 border-gray-200 pl-2",children:T.map((v,V)=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"text-gray-400 text-xs",children:["[",V,"]"]})," ",P(`${m}.${V}`,v,S+1)]},V))});if(typeof T=="object"){const v=Object.entries(T);return v.length===0?e.jsx("span",{className:"text-gray-400",children:"{}"}):S>0?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>x(m),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[D?e.jsx(Zt,{size:14}):e.jsx(pa,{size:14}),D?"Collapse":`{${v.length} fields}`]}),D&&e.jsx("div",{className:"ml-2 mt-1 border-l-2 border-gray-200 pl-2",children:v.map(([V,d])=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-600",children:[V,":"]})," ",P(`${m}.${V}`,d,S+1)]},V))})]}):e.jsx("div",{className:"space-y-1",children:v.map(([V,d])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-600 min-w-[100px]",children:[V,":"]}),e.jsx("div",{className:"flex-1",children:P(`${m}.${V}`,d,S+1)})]},V))})}return e.jsx("span",{children:String(T)})};return e.jsxs("div",{className:"text-sm space-y-1 max-h-[500px] overflow-auto",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("button",{onClick:A,className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-1 bg-blue-50 rounded hover:bg-blue-100",title:"Download as text file",children:[e.jsx(wr,{size:12})," Download"]})}),P("root",C)]})}function io({beforeImage:r,maskImage:l,onEnlarge:n}){return e.jsxs("div",{className:"relative w-40 h-40 cursor-pointer hover:ring-2 hover:ring-amber-400 rounded overflow-hidden border",onClick:()=>n(r,"Before with Mask"),children:[e.jsx("img",{src:r,alt:"Before",className:"w-full h-full object-contain"}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:{backgroundImage:`url(${l})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",mixBlendMode:"multiply",opacity:.5}}),e.jsx("img",{src:l,alt:"Mask overlay",className:"absolute inset-0 w-full h-full object-contain pointer-events-none",style:{mixBlendMode:"screen",opacity:.7,filter:"sepia(1) saturate(5) hue-rotate(-50deg)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent text-white text-[10px] text-center py-1 font-medium",children:"ðŸŽ¯ Edit Area"})]})}function qr({retryHistory:r,totalAttempts:l,language:n,onRevertRepair:y}){const[s,C]=o.useState(null);if(!r||r.length===0)return null;const x=r.filter(m=>m.type==="auto_repair"||m.type==="grid_repair"||m.type==="grid_repair_failed").length,A=r.filter(m=>m.type==="grid_repair"||m.type==="grid_repair_failed").length,P=r.filter(m=>m.type==="grid_repair_failed").length;return e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>C(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("div",{className:"absolute -top-8 left-0 text-white text-sm",children:s.title}),e.jsx("img",{src:s.src,alt:s.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute -top-8 right-0 text-white hover:text-gray-300",onClick:()=>C(null),children:"âœ• Close"})]})}),e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Fn,{size:14}),n==="de"?"Generierungshistorie":n==="fr"?"Historique de gÃ©nÃ©ration":"Generation History",x>0&&e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded",children:["ðŸ”§ ",x," ",n==="de"?"Reparatur":"repair",x>1?n==="de"?"en":"s":"",A>0&&e.jsxs("span",{className:"ml-1",children:["(",A," grid",P>0?`, ${P} failed`:"",")"]})]})]}),e.jsxs("span",{className:"text-purple-600",children:[l," ",n==="de"?"Versuche":n==="fr"?"tentatives":"attempts"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:r.map((m,T)=>{var S,D,v,V;return e.jsxs("div",{className:`border rounded-lg p-3 ${m.type==="grid_repair_failed"?"bg-red-50 border-red-300":m.type==="grid_repair"?"bg-violet-50 border-violet-300":m.type==="auto_repair"?"bg-amber-50 border-amber-300":T===r.length-1?"bg-green-50 border-green-300":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-sm",children:[m.type==="grid_repair_failed"?e.jsx("span",{className:"text-red-700",children:"ðŸ”² Grid Repair Failed"}):m.type==="grid_repair"?e.jsx("span",{className:"text-violet-700",children:"ðŸ”² Grid Repair"}):m.type==="auto_repair"?e.jsx("span",{className:"text-amber-700",children:"ðŸ”§ Auto-Repair"}):e.jsx(e.Fragment,{children:n==="de"?`Versuch ${m.attempt}`:n==="fr"?`Tentative ${m.attempt}`:`Attempt ${m.attempt}`}),m.type==="text_edit"&&e.jsx("span",{className:"text-xs ml-2 text-blue-600",children:"(text edit)"}),m.type==="text_edit_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(text edit failed)"}),m.type==="auto_repair_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(auto-repair failed)"}),T===r.length-1&&m.type!=="auto_repair"&&e.jsx("span",{className:"text-xs ml-2 text-green-600 font-bold",children:"âœ“ USED"})]}),m.type==="auto_repair"&&m.preRepairScore!==void 0&&m.postRepairScore!==void 0?e.jsxs("span",{className:"font-bold text-sm",children:[e.jsxs("span",{className:m.preRepairScore>=70?"text-green-600":m.preRepairScore>=50?"text-yellow-600":"text-red-600",children:[m.preRepairScore,"%"]}),e.jsx("span",{className:"text-gray-400 mx-1",children:"â†’"}),e.jsxs("span",{className:m.postRepairScore>=70?"text-green-600":m.postRepairScore>=50?"text-yellow-600":"text-red-600",children:[m.postRepairScore,"%"]})]}):m.score!==void 0&&e.jsxs("span",{className:`font-bold ${m.score>=70?"text-green-600":m.score>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(m.score),"%"]})]}),m.error&&e.jsxs("div",{className:"text-xs text-red-600 mb-2",children:["Error: ",m.error]}),m.textIssue&&m.textIssue!=="NONE"&&e.jsxs("div",{className:"text-xs text-orange-600 mb-2",children:["Text issue: ",m.textIssue,m.expectedText&&e.jsxs("span",{className:"block",children:['Expected: "',m.expectedText,'"']}),m.actualText&&e.jsxs("span",{className:"block",children:['Actual: "',m.actualText,'"']})]}),m.type==="auto_repair"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[m.fixTargetsCount&&e.jsxs("div",{className:"text-xs text-amber-700",children:["Fixed ",m.fixTargetsCount," target",m.fixTargetsCount>1?"s":""]}),y&&((D=(S=m.repairDetails)==null?void 0:S[0])==null?void 0:D.beforeImage)&&m.postRepairScore!==void 0&&m.preRepairScore!==void 0&&m.postRepairScore<=m.preRepairScore&&e.jsxs("button",{onClick:()=>y(T,m.repairDetails[0].beforeImage),className:"text-xs px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded border border-red-300 transition-colors",children:["â†©ï¸ ",n==="de"?"ZurÃ¼cksetzen":"Revert to Original"]})]}),m.postRepairScore!==void 0&&m.preRepairScore!==void 0&&m.postRepairScore<m.preRepairScore&&e.jsxs("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded border border-red-200",children:["âš ï¸ ",n==="de"?`Bewertung verschlechtert: ${m.preRepairScore}% â†’ ${m.postRepairScore}%`:`Score decreased: ${m.preRepairScore}% â†’ ${m.postRepairScore}%`]}),m.bboxDetection&&Array.isArray(m.bboxDetection)&&m.bboxDetection.length>0&&e.jsxs("details",{className:"text-sm mb-2",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-700 font-medium hover:text-blue-900",children:["ðŸ“¦ ",n==="de"?"Bounding Box Erkennung":"Bounding Box Detection"," (",m.bboxDetection.length,")"]}),e.jsx("div",{className:"mt-3 space-y-2",children:m.bboxDetection.map((d,G)=>e.jsxs("div",{className:`p-3 rounded-lg border ${d.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:`font-medium text-sm ${d.success?"text-green-800":"text-red-800"}`,children:[d.success?"âœ“":"âœ—"," ",d.issue.substring(0,60),d.issue.length>60?"...":""]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${d.severity==="CRITICAL"?"bg-red-200 text-red-800":d.severity==="MAJOR"?"bg-orange-200 text-orange-800":d.severity==="MODERATE"?"bg-yellow-200 text-yellow-800":"bg-gray-200 text-gray-800"}`,children:[d.severity," â€¢ ",d.type]})]}),d.success&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${d.faceBox?"bg-purple-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-purple-800",children:"Face Box:"}),d.faceBox?e.jsxs("span",{className:"ml-1 font-mono text-purple-600",children:["[",d.faceBox.map(F=>(F*100).toFixed(0)+"%").join(", "),"]"]}):e.jsx("span",{className:"ml-1 text-gray-500 italic",children:"not detected"})]}),e.jsxs("div",{className:`p-2 rounded ${d.bodyBox?"bg-blue-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-blue-800",children:"Body Box:"}),d.bodyBox?e.jsxs("span",{className:"ml-1 font-mono text-blue-600",children:["[",d.bodyBox.map(F=>(F*100).toFixed(0)+"%").join(", "),"]"]}):e.jsx("span",{className:"ml-1 text-gray-500 italic",children:"not detected"})]})]}),d.label&&d.label!==d.issue&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Detected as:"})," ",d.label]}),d.usage&&e.jsxs("div",{className:"mt-1 text-xs text-gray-400",children:["Tokens: ",d.usage.input_tokens," in / ",d.usage.output_tokens," out"]})]},G))})]}),e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["ðŸ“Š ",n==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-red-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-red-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 px-2 py-0.5 rounded",children:"Before"}),e.jsxs("span",{className:"text-red-600",children:[m.preRepairScore,"%"]})]}),e.jsx(Ls,{data:m.preRepairEval||m.reasoning,language:n,title:`evaluation-before-attempt-${T}`})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-green-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded",children:"After"}),e.jsxs("span",{className:"text-green-600",children:[m.postRepairScore,"%"]})]}),e.jsx(Ls,{data:m.postRepairEval,language:n,title:`evaluation-after-attempt-${T}`})]})]})]}),m.repairDetails&&m.repairDetails.length>0&&e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["ðŸ–¼ï¸ ",n==="de"?"Reparatur-Details":"Repair Details"," (",m.repairDetails.length,")"]}),e.jsx("div",{className:"mt-3 space-y-3",children:m.repairDetails.map((d,G)=>{var F,ne;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-medium text-amber-800 text-base",children:d.description}),d.modelId&&e.jsx("span",{className:"text-xs text-gray-400 bg-gray-100 px-2 py-0.5 rounded",children:d.modelId})]}),e.jsxs("details",{className:"mb-3",children:[e.jsxs("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700 text-sm flex items-center gap-2",children:["Show fix prompt",e.jsxs("button",{onClick:L=>{L.stopPropagation(),Kr(d.fullPrompt||d.fixPrompt||"",`fix-prompt-${G}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(wr,{size:10})," Download"]})]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded text-sm text-gray-600 whitespace-pre-wrap font-mono max-h-[500px] overflow-auto",children:d.fullPrompt||d.fixPrompt})]}),e.jsxs("div",{className:"flex gap-4 items-start",children:[d.beforeImage&&d.maskImage?e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before + Mask"}),e.jsx(io,{beforeImage:d.beforeImage,maskImage:d.maskImage,onEnlarge:(L,Z)=>C({src:L,title:Z})})]}):d.beforeImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before"}),e.jsx("img",{src:d.beforeImage,alt:"Before",className:"w-32 h-32 object-contain border rounded cursor-pointer hover:ring-2 hover:ring-amber-400",onClick:()=>C({src:d.beforeImage,title:"Before Repair"})})]}),e.jsx("div",{className:"flex items-center h-32 text-gray-400 text-2xl",children:"â†’"}),d.afterImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"After"}),e.jsx("img",{src:d.afterImage,alt:"After",className:"w-32 h-32 object-contain border-2 border-green-300 rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>C({src:d.afterImage,title:"After Repair"})})]})]}),d.verification&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded border text-sm",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"ðŸ” Verification:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[d.verification.lpips&&e.jsxs("div",{className:`p-2 rounded ${d.verification.lpips.changed?"bg-green-100":"bg-yellow-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LPIPS: "}),e.jsx("span",{className:d.verification.lpips.changed?"text-green-700":"text-yellow-700",children:(F=d.verification.lpips.lpipsScore)==null?void 0:F.toFixed(4)}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",d.verification.lpips.changed?"âœ“ changed":"âš  unchanged",")"]})]}),d.verification.llm&&e.jsxs("div",{className:`p-2 rounded ${d.verification.llm.fixed?"bg-green-100":"bg-red-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LLM: "}),e.jsx("span",{className:d.verification.llm.fixed?"text-green-700":"text-red-700",children:d.verification.llm.fixed?"âœ“ Fixed":"âœ— Not fixed"}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",Math.round(d.verification.llm.confidence*100),"%)"]})]})]}),((ne=d.verification.llm)==null?void 0:ne.explanation)&&e.jsx("div",{className:"mt-2 text-gray-600 text-sm italic",children:d.verification.llm.explanation})]})]},G)})})]})]}),(m.type==="grid_repair"||m.type==="grid_repair_failed")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[m.gridTotalIssues!==void 0&&e.jsxs("span",{className:"text-violet-700",children:[n==="de"?"Probleme:":"Issues:"," ",m.gridTotalIssues]}),m.gridFixedCount!==void 0&&e.jsxs("span",{className:"text-green-600",children:["âœ“ ",n==="de"?"Behoben:":"Fixed:"," ",m.gridFixedCount]}),m.gridFailedCount!==void 0&&m.gridFailedCount>0&&e.jsxs("span",{className:"text-red-600",children:["âœ— ",n==="de"?"Fehlgeschlagen:":"Failed:"," ",m.gridFailedCount]})]}),m.type==="grid_repair_failed"&&m.failReason&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-100 p-2 rounded border border-red-200",children:["âš ï¸ ",n==="de"?"Fehlergrund:":"Failure reason:"," ",m.failReason==="no_repairs_made"?n==="de"?"Keine Reparaturen durchgefÃ¼hrt":"No repairs were made":m.failReason==="no_image_data"?n==="de"?"Keine Bilddaten zurÃ¼ckgegeben":"No image data returned":m.failReason==="image_too_small"?n==="de"?"ZurÃ¼ckgegebenes Bild zu klein/ungÃ¼ltig":"Returned image too small/invalid":m.failReason==="image_unchanged"?n==="de"?"Bild wurde nicht verÃ¤ndert":"Image was not changed":m.failReason]}),m.annotatedOriginal&&e.jsxs("details",{className:"text-sm",open:!0,children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["ðŸ“ ",n==="de"?"Schritt 1: Erkannte Probleme":"Step 1: Detected Issues"]}),e.jsxs("div",{className:"mt-3 bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:[n==="de"?"Originalbild mit markierten Problembereichen":"Original image with marked issue regions",e.jsxs("span",{className:"ml-2 text-gray-400",children:["(ðŸ”´ ",n==="de"?"kritisch":"critical",", ðŸŸ  ",n==="de"?"wichtig":"major",", ðŸŸ¡ ",n==="de"?"gering":"minor",")"]})]}),e.jsx("img",{src:`data:image/jpeg;base64,${m.annotatedOriginal}`,alt:"Annotated original",className:"max-w-md border rounded cursor-pointer hover:ring-2 hover:ring-violet-400",onClick:()=>C({src:`data:image/jpeg;base64,${m.annotatedOriginal}`,title:n==="de"?"Erkannte Probleme":"Detected Issues"})})]})]}),e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["ðŸ“Š ",n==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-red-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-red-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 px-2 py-0.5 rounded",children:"Before"}),e.jsxs("span",{className:"text-red-600",children:[m.preRepairScore,"%"]})]}),e.jsx(Ls,{data:m.preRepairEval||m.reasoning,language:n,title:`evaluation-before-grid-${T}`})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-green-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded",children:"After"}),e.jsxs("span",{className:"text-green-600",children:[m.postRepairScore,"%"]})]}),e.jsx(Ls,{data:m.postRepairEval,language:n,title:`evaluation-after-grid-${T}`})]})]})]}),m.grids&&m.grids.length>0&&e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["ðŸ”² ",n==="de"?"Grid-Details":"Grid Details"," (",m.grids.length," ",m.grids.length===1?"grid":"grids",")"]}),e.jsx("div",{className:"mt-3 space-y-4",children:m.grids.map((d,G)=>{var F,ne;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("span",{className:"font-medium text-violet-800",children:["Grid"," ",d.batchNum||G+1]}),((F=d.manifest)==null?void 0:F.issues)&&e.jsxs("span",{className:"text-xs text-gray-500",children:[d.manifest.issues.length," ",n==="de"?"Regionen":"regions"]})]}),((ne=d.manifest)==null?void 0:ne.issues)&&d.manifest.issues.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-violet-50 rounded text-sm",children:[e.jsx("div",{className:"font-medium text-violet-800 mb-1",children:n==="de"?"Zu reparierende Probleme:":"Issues to repair:"}),e.jsx("div",{className:"space-y-1",children:d.manifest.issues.map((L,Z)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-mono font-bold text-violet-600 min-w-[20px]",children:[L.letter,":"]}),e.jsx("span",{className:"text-gray-700",children:L.fixInstruction||L.description||"Unknown issue"})]},Z))})]}),d.prompt&&e.jsxs("details",{className:"mb-3",children:[e.jsxs("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700 text-sm flex items-center gap-2",children:[n==="de"?"Reparatur-Prompt anzeigen":"Show repair prompt",e.jsxs("button",{onClick:L=>{L.stopPropagation(),Kr(d.prompt||"",`grid-repair-prompt-${G}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(wr,{size:10})," Download"]})]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded text-sm text-gray-600 whitespace-pre-wrap font-mono max-h-[500px] overflow-auto",children:d.prompt})]}),e.jsxs("div",{className:"flex gap-4 items-start flex-wrap",children:[d.original&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:n==="de"?"Original-Grid":"Input Grid"}),e.jsx("img",{src:`data:image/jpeg;base64,${d.original}`,alt:"Input grid",className:"max-w-xs border rounded cursor-pointer hover:ring-2 hover:ring-violet-400",onClick:()=>C({src:`data:image/jpeg;base64,${d.original}`,title:n==="de"?"Original-Grid":"Input Grid"})})]}),d.original&&d.repaired&&e.jsx("div",{className:"flex items-center self-center text-gray-400 text-2xl",children:"â†’"}),d.repaired&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:n==="de"?"Repariertes Grid":"Repaired Grid"}),e.jsx("img",{src:`data:image/jpeg;base64,${d.repaired}`,alt:"Repaired grid",className:"max-w-xs border-2 border-green-300 rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>C({src:`data:image/jpeg;base64,${d.repaired}`,title:n==="de"?"Repariertes Grid":"Repaired Grid"})})]})]}),d.repairs&&d.repairs.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"font-medium text-violet-800 mb-2",children:["âœ… ",n==="de"?"Verifizierungsergebnisse":"Verification Results"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-violet-100 text-violet-800",children:[e.jsx("th",{className:"px-2 py-1 text-left border",children:"Ltr"}),e.jsx("th",{className:"px-2 py-1 text-left border",children:n==="de"?"Problem":"Issue"}),e.jsx("th",{className:"px-2 py-1 text-center border",children:n==="de"?"Vorher":"Before"}),e.jsx("th",{className:"px-2 py-1 text-center border",children:n==="de"?"Nachher":"After"}),e.jsx("th",{className:"px-2 py-1 text-center border",children:"Status"}),e.jsx("th",{className:"px-2 py-1 text-center border",children:n==="de"?"Konfidenz":"Confidence"})]})}),e.jsx("tbody",{children:d.repairs.map((L,Z)=>{var E,te,Y,Q,$,re,pe,fe;return e.jsxs("tr",{className:(E=L.verification)!=null&&E.accepted?"bg-green-50":"bg-red-50",children:[e.jsx("td",{className:"px-2 py-1 border font-mono font-bold text-violet-600",children:L.letter}),e.jsxs("td",{className:"px-2 py-1 border text-gray-700 max-w-[200px] truncate",title:L.description,children:[e.jsx("span",{className:`inline-block px-1 py-0.5 rounded text-xs mr-1 ${L.severity==="critical"?"bg-red-200 text-red-800":L.severity==="major"?"bg-orange-200 text-orange-800":"bg-yellow-200 text-yellow-800"}`,children:L.type||"unknown"}),(te=L.description)==null?void 0:te.substring(0,40),(((Y=L.description)==null?void 0:Y.length)||0)>40?"...":""]}),e.jsx("td",{className:"px-2 py-1 border text-center",children:L.originalThumbnail&&e.jsx("img",{src:`data:image/jpeg;base64,${L.originalThumbnail}`,alt:"Before",className:"w-12 h-12 object-contain inline-block cursor-pointer hover:ring-2 hover:ring-violet-400 rounded",onClick:()=>C({src:`data:image/jpeg;base64,${L.originalThumbnail}`,title:`${L.letter}: Before`})})}),e.jsx("td",{className:"px-2 py-1 border text-center",children:L.repairedThumbnail&&e.jsx("img",{src:`data:image/jpeg;base64,${L.repairedThumbnail}`,alt:"After",className:`w-12 h-12 object-contain inline-block cursor-pointer hover:ring-2 rounded ${(Q=L.verification)!=null&&Q.accepted?"hover:ring-green-400 border-green-300":"hover:ring-red-400 border-red-300"}`,onClick:()=>C({src:`data:image/jpeg;base64,${L.repairedThumbnail}`,title:`${L.letter}: After`})})}),e.jsx("td",{className:"px-2 py-1 border text-center",children:($=L.verification)!=null&&$.accepted?e.jsx("span",{className:"text-green-600 font-bold",children:"âœ“"}):e.jsx("span",{className:"text-red-600 font-bold",children:"âœ—"})}),e.jsx("td",{className:"px-2 py-1 border text-center",children:e.jsxs("span",{className:`font-medium ${(((re=L.verification)==null?void 0:re.confidence)??0)>=.7?"text-green-600":(((pe=L.verification)==null?void 0:pe.confidence)??0)>=.5?"text-yellow-600":"text-red-600"}`,children:[Math.round((((fe=L.verification)==null?void 0:fe.confidence)??0)*100),"%"]})})]},Z)})})]})}),d.repairs.filter(L=>{var Z;return!((Z=L.verification)!=null&&Z.accepted)}).map((L,Z)=>{var E,te;return e.jsxs("div",{className:"mt-2 text-sm text-red-600 bg-red-50 p-2 rounded border border-red-200",children:[e.jsxs("span",{className:"font-mono font-bold",children:[L.letter,":"]})," ",((E=L.verification)==null?void 0:E.reason)||((te=L.verification)==null?void 0:te.explanation)||"Unknown failure reason"]},Z)})]})]},G)})})]})]}),m.bboxDetection&&typeof m.bboxDetection=="object"&&"figures"in m.bboxDetection&&e.jsxs("details",{className:"text-sm mb-2",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-700 font-medium hover:text-blue-900 flex items-center gap-2",children:["ðŸ“¦ ",n==="de"?"Objekterkennung":"Object Detection",e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded",children:[((v=m.bboxDetection.figures)==null?void 0:v.length)||0," ",n==="de"?"Figuren":"figures",","," ",((V=m.bboxDetection.objects)==null?void 0:V.length)||0," ",n==="de"?"Objekte":"objects"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[m.bboxOverlayImage&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:[n==="de"?"Erkannte Regionen":"Detected Regions",e.jsx("span",{className:"ml-2 text-gray-400",children:"(ðŸŸ¢ Body, ðŸ”µ Face, ðŸŸ  Object)"})]}),e.jsx("img",{src:m.bboxOverlayImage,alt:"Bbox overlay",className:"max-w-md border rounded cursor-pointer hover:ring-2 hover:ring-blue-400",onClick:()=>C({src:m.bboxOverlayImage,title:n==="de"?"Erkannte Regionen":"Detected Regions"})})]}),m.bboxDetection.figures&&m.bboxDetection.figures.length>0&&e.jsxs("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[e.jsxs("div",{className:"font-medium text-green-800 mb-2",children:[n==="de"?"Figuren":"Figures"," (",m.bboxDetection.figures.length,")"]}),e.jsx("div",{className:"space-y-2",children:m.bboxDetection.figures.map((d,G)=>e.jsxs("div",{className:"text-sm bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-medium text-green-700",children:d.label||`Figure ${G+1}`}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 grid grid-cols-2 gap-2",children:[d.bodyBox&&e.jsxs("span",{children:["Body: [",d.bodyBox.map(F=>(F*100).toFixed(0)+"%").join(", "),"]"]}),d.faceBox&&e.jsxs("span",{children:["Face: [",d.faceBox.map(F=>(F*100).toFixed(0)+"%").join(", "),"]"]}),d.position&&e.jsxs("span",{children:["Pos: ",d.position]})]})]},G))})]}),m.bboxDetection.objects&&m.bboxDetection.objects.length>0&&e.jsxs("div",{className:"bg-orange-50 p-3 rounded border border-orange-200",children:[e.jsxs("div",{className:"font-medium text-orange-800 mb-2",children:[n==="de"?"Objekte":"Objects"," (",m.bboxDetection.objects.length,")"]}),e.jsx("div",{className:"space-y-2",children:m.bboxDetection.objects.map((d,G)=>e.jsxs("div",{className:"text-sm bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-medium text-orange-700",children:d.label||`Object ${G+1}`}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[d.bodyBox&&e.jsxs("span",{children:["Box: [",d.bodyBox.map(F=>(F*100).toFixed(0)+"%").join(", "),"]"]}),d.position&&e.jsxs("span",{className:"ml-2",children:["Pos: ",d.position]})]})]},G))})]}),e.jsxs("button",{onClick:()=>Kr(JSON.stringify(m.bboxDetection,null,2),`bbox-detection-attempt-${T}.json`),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-1 bg-blue-50 rounded hover:bg-blue-100",children:[e.jsx(wr,{size:12})," ",n==="de"?"JSON herunterladen":"Download JSON"]})]})]}),m.type!=="auto_repair"&&m.type!=="grid_repair"&&m.type!=="grid_repair_failed"&&m.prompt&&e.jsxs("details",{className:"text-sm mb-2",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-700 font-medium hover:text-blue-900 flex items-center gap-2",children:["ðŸ“¤ ",n==="de"?"Eingabe-Prompt":"Input Prompt",e.jsxs("button",{onClick:d=>{d.stopPropagation(),Kr(m.prompt||"",`prompt-attempt-${m.attempt}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(wr,{size:10})," Download"]})]}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap bg-blue-50 p-3 rounded text-sm overflow-auto max-h-[500px] font-mono border border-blue-200",children:m.prompt})]}),m.type!=="auto_repair"&&m.type!=="grid_repair"&&m.type!=="grid_repair_failed"&&m.reasoning?e.jsxs("details",{className:"text-sm text-gray-600 mb-2",children:[e.jsxs("summary",{className:"cursor-pointer font-medium",children:["ðŸ“¥ ",n==="de"?"Bewertungs-Feedback":"Evaluation Feedback"]}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap bg-gray-50 p-3 rounded text-sm overflow-auto max-h-[500px] font-mono",children:m.reasoning})]}):m.type!=="auto_repair"&&m.type!=="grid_repair"&&m.type!=="grid_repair_failed"&&m.score===0&&e.jsx("div",{className:"text-sm text-gray-500 italic mb-2",children:n==="de"?"QualitÃ¤tsbewertung fehlgeschlagen":n==="fr"?"Ã‰valuation de qualitÃ© Ã©chouÃ©e":"Quality evaluation failed"}),m.imageData&&m.type!=="auto_repair"&&m.type!=="grid_repair"&&m.type!=="grid_repair_failed"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:n==="de"?"Generiertes Bild":"Generated Image"}),e.jsx("img",{src:m.imageData,alt:`Attempt ${m.attempt}`,className:`w-48 h-48 object-contain rounded border cursor-pointer hover:ring-2 ${T===r.length-1?"border-green-300 hover:ring-green-400":"border-gray-200 opacity-75 hover:ring-gray-400"}`,onClick:()=>C({src:m.imageData,title:`${n==="de"?"Versuch":"Attempt"} ${m.attempt}`})})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(m.timestamp).toLocaleTimeString()})]},T)})})]})]})}function no({src:r,alt:l,onClose:n}){const y=o.useCallback(s=>{s.key==="Escape"&&n()},[n]);return o.useEffect(()=>(r&&(document.addEventListener("keydown",y),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",y),document.body.style.overflow="unset"}),[r,y]),r?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm cursor-pointer",onClick:n,children:[e.jsx("button",{onClick:n,className:"absolute top-4 right-4 p-2 rounded-full bg-black/50 hover:bg-black/70 text-white transition-colors z-10","aria-label":"Close",children:e.jsx(Dt,{size:24})}),e.jsx("img",{src:r,alt:l||"Enlarged image",className:"max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl",onClick:s=>s.stopPropagation()})]}):null}function hs({referencePhotos:r,landmarkPhotos:l,language:n}){var D;const[y,s]=o.useState(null),C=r&&r.length>0,x=l&&l.length>0;if(!C&&!x)return null;const A=((r==null?void 0:r.length)||0)+((l==null?void 0:l.length)||0),P=v=>{switch(v){case"bodyNoBg":case"body-no-bg":return n==="de"?"GanzkÃ¶rper (freigestellt)":n==="fr"?"Corps entier (dÃ©tourÃ©)":"Full body (no bg)";case"body":return n==="de"?"GanzkÃ¶rper":n==="fr"?"Corps entier":"Full body";case"face":return n==="de"?"Gesicht":n==="fr"?"Visage":"Face only";case"clothing-winter":return n==="de"?"Winter-Avatar":n==="fr"?"Avatar hiver":"Winter avatar";case"clothing-summer":return n==="de"?"Sommer-Avatar":n==="fr"?"Avatar Ã©tÃ©":"Summer avatar";case"clothing-formal":return n==="de"?"Formell-Avatar":n==="fr"?"Avatar formel":"Formal avatar";case"clothing-standard":return n==="de"?"Standard-Avatar":n==="fr"?"Avatar standard":"Standard avatar";case"none":return n==="de"?"Kein Foto":n==="fr"?"Pas de photo":"No photo";default:return v}},m=v=>{switch(v){case"bodyNoBg":case"body-no-bg":return"bg-green-100 text-green-700 border-green-300";case"body":return"bg-blue-100 text-blue-700 border-blue-300";case"face":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"clothing-winter":return"bg-cyan-100 text-cyan-700 border-cyan-300";case"clothing-summer":return"bg-orange-100 text-orange-700 border-orange-300";case"clothing-formal":return"bg-purple-100 text-purple-700 border-purple-300";case"clothing-standard":return"bg-teal-100 text-teal-700 border-teal-300";case"none":return"bg-red-100 text-red-700 border-red-300";default:return"bg-gray-100 text-gray-700 border-gray-300"}},T=(D=r.find(v=>v.clothingCategory))==null?void 0:D.clothingCategory,S=v=>{if(!v)return"";switch(v){case"winter":return n==="de"?"Winter":n==="fr"?"Hiver":"Winter";case"summer":return n==="de"?"Sommer":n==="fr"?"Ã‰tÃ©":"Summer";case"formal":return n==="de"?"Formell":n==="fr"?"Formel":"Formal";case"standard":return"Standard";default:return v}};return e.jsxs("details",{className:"bg-pink-50 border border-pink-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-900 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“¸"}),n==="de"?"Referenzfotos":n==="fr"?"Photos de rÃ©fÃ©rence":"Reference Photos",e.jsxs("span",{className:"text-xs text-pink-600",children:["(",A,")"]}),T&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-pink-200 text-pink-800 text-xs rounded",children:["ðŸ‘• ",S(T)]}),x&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-amber-200 text-amber-800 text-xs rounded",children:["ðŸ“ ",l.length," ",n==="de"?"Wahrzeichen":"Landmark"]})]}),C&&e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2",children:r.map((v,V)=>e.jsxs("div",{className:"bg-white rounded-lg p-2 border border-pink-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:v.name}),v.photoType&&e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap ${m(v.photoType)}`,children:P(v.photoType)})]}),v.photoUrl?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:v.photoUrl,alt:`${v.name} - ${P(v.photoType||"unknown")}`,className:`w-full max-h-32 object-contain rounded border bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity ${v.isStyled?"border-purple-400 ring-2 ring-purple-200":"border-gray-200"}`,onClick:()=>s(v.photoUrl),title:"Click to enlarge"}),v.isStyled&&e.jsx("span",{className:"absolute top-1 right-1 px-1 py-0.5 text-[9px] font-bold bg-purple-500 text-white rounded",children:"ðŸŽ¨ STYLED"})]}),v.photoHash&&e.jsxs("div",{className:"mt-1 text-[9px] font-mono text-gray-500 bg-gray-100 px-1 py-0.5 rounded text-center",children:["ðŸ” ",v.photoHash]})]}):e.jsx("div",{className:"text-xs text-gray-500 italic py-2 text-center bg-gray-100 rounded",children:n==="de"?"Foto nicht geladen":"Photo not loaded"})]},V))}),x&&e.jsxs("div",{className:C?"mt-4 pt-3 border-t border-pink-200":"mt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-amber-700 mb-2 flex items-center gap-1",children:["ðŸ“ ",n==="de"?"Wahrzeichen-Referenzfotos":n==="fr"?"Photos de monuments":"Landmark Reference Photos"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:l.map((v,V)=>e.jsxs("div",{className:"bg-amber-50 rounded-lg p-2 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:v.name}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap bg-amber-100 text-amber-700 border-amber-300",children:"ðŸ“ LANDMARK"})]}),v.photoData?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:v.photoData,alt:`${v.name} landmark`,className:"w-full max-h-32 object-contain rounded border border-amber-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>s(v.photoData),title:"Click to enlarge"})}),v.attribution&&e.jsxs("div",{className:"mt-1 text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 rounded truncate",title:v.attribution,children:["ðŸ“· ",v.attribution]}),v.source&&e.jsxs("div",{className:"mt-0.5 text-[9px] text-gray-400",children:["Source: ",v.source]})]}):e.jsx("div",{className:"text-xs text-gray-500 italic py-2 text-center bg-gray-100 rounded",children:n==="de"?"Foto nicht geladen":"Photo not loaded"})]},V))})]}),e.jsx(no,{src:y,onClose:()=>s(null)})]})}function oo({pageNumber:r,scene:l,onSceneChange:n,onClose:y,onRegenerate:s,isRegenerating:C,imageRegenerationCost:x,characters:A=[],selectedCharacterIds:P=[],onCharacterSelectionChange:m,consistencyRegen:T}){const{language:S}=Ot(),[D,v]=o.useState(!1),[V,d]=o.useState(!1),G=F=>{m&&(P.includes(F)?m(P.filter(ne=>ne!==F)):m([...P,F]))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(nt,{size:20}),S==="de"?`Szene bearbeiten - Seite ${r}`:S==="fr"?`Modifier la scÃ¨ne - Page ${r}`:`Edit Scene - Page ${r}`]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:S==="de"?"Bearbeiten Sie die Szenenbeschreibung und wÃ¤hlen Sie die Charaktere aus.":S==="fr"?"Modifiez la description de la scÃ¨ne et sÃ©lectionnez les personnages.":"Edit the scene description and select the characters."})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[A.length>0&&m&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ja,{size:16}),S==="de"?"Charaktere in dieser Szene:":S==="fr"?"Personnages dans cette scÃ¨ne:":"Characters in this scene:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:A.map(F=>{const ne=P.includes(F.id);return e.jsxs("button",{type:"button",onClick:()=>G(F.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${ne?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{className:"font-medium",children:F.name}),ne&&e.jsx("span",{className:"text-indigo-500",children:"âœ“"})]},F.id)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:S==="de"?"WÃ¤hlen Sie die Charaktere aus, die im Bild erscheinen sollen.":S==="fr"?"SÃ©lectionnez les personnages qui doivent apparaÃ®tre dans l'image.":"Select the characters that should appear in the image."})]}),T&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(fi,{className:"text-amber-600",size:20}),e.jsx("h4",{className:"font-semibold text-amber-800",children:S==="de"?"Konsistenz-Korrektur angewendet":S==="fr"?"Correction de cohÃ©rence appliquÃ©e":"Consistency Fix Applied"}),e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded",children:["Score: ",T.score,"%"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-amber-700 mb-2",children:S==="de"?"Behobene Probleme:":S==="fr"?"ProblÃ¨mes corrigÃ©s:":"Issues Fixed:"}),e.jsx("ul",{className:"text-sm text-amber-900 space-y-1",children:T.issues.map((F,ne)=>e.jsxs("li",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[F.type.toUpperCase(),F.characterInvolved&&` (${F.characterInvolved})`,":"]}),e.jsx("span",{className:"text-amber-700 ml-2",children:F.description}),e.jsxs("span",{className:"text-amber-600 ml-2 text-xs",children:["â†’ ",F.recommendation]})]},ne))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1 text-center",children:"Original"}),e.jsx("img",{src:T.originalImage,alt:"Original",className:"w-full rounded-lg border border-gray-300",draggable:!1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-600 mb-1 text-center",children:S==="de"?"Korrigiert":S==="fr"?"CorrigÃ©":"Fixed"}),e.jsx("img",{src:T.fixedImage,alt:"Fixed",className:"w-full rounded-lg border-2 border-green-500",draggable:!1})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>v(!D),className:"flex items-center gap-1 text-xs text-gray-600 hover:text-gray-800",children:[D?e.jsx(Ya,{size:14}):e.jsx(Zt,{size:14}),S==="de"?"Original-Prompt":S==="fr"?"Prompt original":"Original Prompt"]}),D&&e.jsx("pre",{className:"text-xs bg-gray-100 p-2 rounded overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:T.originalPrompt}),e.jsxs("button",{onClick:()=>d(!V),className:"flex items-center gap-1 text-xs text-green-600 hover:text-green-800",children:[V?e.jsx(Ya,{size:14}):e.jsx(Zt,{size:14}),S==="de"?"Korrigierter Prompt (mit Korrekturen)":S==="fr"?"Prompt corrigÃ© (avec corrections)":"Fixed Prompt (with corrections)"]}),V&&e.jsx("pre",{className:"text-xs bg-green-50 p-2 rounded border border-green-200 overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:T.fixedPrompt})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xs text-gray-400",children:S==="de"?`Korrigiert am ${new Date(T.timestamp).toLocaleString()}`:S==="fr"?`CorrigÃ© le ${new Date(T.timestamp).toLocaleString()}`:`Fixed at ${new Date(T.timestamp).toLocaleString()}`}),T.clothing&&e.jsxs("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded",children:["ðŸŽ¨ ",T.clothing]})]}),T.avatarsUsed&&T.avatarsUsed.length>0&&e.jsxs("div",{className:"mt-3 p-2 bg-blue-50 rounded border border-blue-200",children:[e.jsx("p",{className:"text-xs font-medium text-blue-700 mb-1",children:S==="de"?"Verwendete Avatare:":S==="fr"?"Avatars utilisÃ©s:":"Avatars used:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:T.avatarsUsed.map((F,ne)=>e.jsxs("span",{className:`text-xs px-2 py-1 rounded ${F.hasPhoto?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:[F.name,F.category&&F.category!=="standard"&&e.jsxs("span",{className:"ml-1 opacity-75",children:["(",F.category,")"]}),!F.hasPhoto&&" âš ï¸"]},ne))})]}),T.retryHistory&&T.retryHistory.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(qr,{retryHistory:T.retryHistory,totalAttempts:T.totalAttempts||1,language:S})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:S==="de"?"Szenenbeschreibung:":S==="fr"?"Description de la scÃ¨ne:":"Scene description:"}),e.jsx("textarea",{value:l,onChange:F=>n(F.target.value),className:"w-full h-40 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y",placeholder:S==="de"?"Beschreiben Sie die Szene...":S==="fr"?"DÃ©crivez la scÃ¨ne...":"Describe the scene..."}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:S==="de"?"Tipp: Beschreiben Sie die Aktionen und die Umgebung. Die ausgewÃ¤hlten Charaktere werden automatisch hinzugefÃ¼gt.":S==="fr"?"Conseil: DÃ©crivez les actions et l'environnement. Les personnages sÃ©lectionnÃ©s seront ajoutÃ©s automatiquement.":"Tip: Describe the actions and the environment. Selected characters will be added automatically."})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:P.length>0&&e.jsx("span",{children:S==="de"?`${P.length} Charakter(e) ausgewÃ¤hlt`:S==="fr"?`${P.length} personnage(s) sÃ©lectionnÃ©(s)`:`${P.length} character(s) selected`})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:y,disabled:C,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700 font-medium disabled:opacity-50 order-2 sm:order-1",children:S==="de"?"Abbrechen":S==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:s,disabled:C||!l.trim(),className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 order-1 sm:order-2 ${C||!l.trim()?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:C?e.jsxs(e.Fragment,{children:[e.jsx(Gt,{size:16,className:"animate-spin"}),S==="de"?"Generiere...":S==="fr"?"GÃ©nÃ©ration...":"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Gt,{size:16}),S==="de"?"Neu generieren":S==="fr"?"RÃ©gÃ©nÃ©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",x,")"]})]})})]})]})]})})}function lo({pageNumber:r,versions:l,onClose:n,onSelectVersion:y,developerMode:s=!1}){const{language:C}=Ot();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Vr,{size:20}),C==="de"?`Bildversionen - Seite ${r}`:C==="fr"?`Versions d'image - Page ${r}`:`Image Versions - Page ${r}`]}),e.jsx("button",{onClick:n,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Dt,{size:20})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:l.map((x,A)=>e.jsxs("div",{className:`relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${x.isActive?"border-green-500 ring-2 ring-green-200":"border-gray-200 hover:border-indigo-300"}`,onClick:()=>y(r,A),children:[e.jsx("img",{src:x.imageData,alt:`Version ${A+1}`,className:"w-full aspect-square object-cover"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:A===0?"Original":`V${A+1}`}),x.isActive&&e.jsx("span",{className:"bg-green-500 px-2 py-0.5 rounded text-[10px] font-bold",children:C==="de"?"Aktiv":C==="fr"?"Actif":"Active"})]}),e.jsx("div",{className:"text-[10px] text-gray-300 mt-1",children:new Date(x.createdAt).toLocaleDateString()})]})]},A))}),s&&l.length>1&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-700",children:C==="de"?"Szenen- und Prompt-Vergleich":C==="fr"?"Comparaison de scÃ¨nes et prompts":"Scene & Prompt Comparison"}),l.map((x,A)=>e.jsxs("details",{className:`rounded-lg p-3 ${x.isActive?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-medium text-gray-700",children:[A===0?"Original":`V${A+1}`,x.isActive&&e.jsx("span",{className:"ml-2 text-green-600 text-xs",children:"(Active)"})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[x.userInput&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-purple-700",children:C==="de"?"Benutzer-Eingabe:":C==="fr"?"EntrÃ©e utilisateur:":"User Input:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-purple-50 p-2 rounded border border-purple-200 max-h-24 overflow-y-auto",children:x.userInput})]}),x.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-amber-700",children:C==="de"?"Erweiterte Szene:":C==="fr"?"ScÃ¨ne Ã©tendue:":"Expanded Scene:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-24 overflow-y-auto",children:x.description})]}),x.prompt&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-blue-700",children:C==="de"?"API-Prompt:":C==="fr"?"Prompt API:":"API Prompt:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-32 overflow-y-auto",children:x.prompt})]}),x.modelId&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Model: ",x.modelId]})]})]},A))]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 text-sm text-gray-500",children:C==="de"?"Klicken Sie auf ein Bild, um es auszuwÃ¤hlen":C==="fr"?"Cliquez sur une image pour la sÃ©lectionner":"Click an image to select it"})]})})}function co({src:r,title:l,onClose:n}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:n,children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] bg-white rounded-lg overflow-hidden",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:l}),e.jsx("button",{onClick:n,className:"text-gray-500 hover:text-gray-700 p-1",children:e.jsx(Dt,{size:20})})]}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsx("img",{src:r,alt:l,className:"max-w-full max-h-[80vh] object-contain mx-auto"})})]})})}const ni={en:{adventure:"Adventure","life-challenge":"Life Challenge",educational:"Educational",historical:"Historical"},de:{adventure:"Abenteuer","life-challenge":"Lebensherausforderung",educational:"Bildung",historical:"Historisch"},fr:{adventure:"Aventure","life-challenge":"DÃ©fi de vie",educational:"Ã‰ducatif",historical:"Historique"}},oi={en:{"1st-grade":"Picture Book (1st Grade)",standard:"Standard",advanced:"Advanced"},de:{"1st-grade":"Bilderbuch (1. Klasse)",standard:"Standard",advanced:"Fortgeschritten"},fr:{"1st-grade":"Livre illustrÃ© (1Ã¨re annÃ©e)",standard:"Standard",advanced:"AvancÃ©"}},mo={"de-CH":"Schweizerdeutsch","de-DE":"Deutsch (Deutschland)",en:"English",fr:"FranÃ§ais"};function uo({settings:r,language:l}){var v,V;const[n,y]=o.useState(!1),s=d=>{const G={en:{title:"Story Info",category:"Category",topic:"Topic",theme:"Theme",storyType:"Story Type",storyDetails:"Story Idea",artStyle:"Art Style",language:"Language",readingLevel:"Reading Level",pages:"Length",dedication:"Dedication",mainCharacters:"Main Characters",otherCharacters:"Other Characters",relationships:"Relationships",season:"Season",location:"Location",noData:"Not specified",spring:"Spring",summer:"Summer",autumn:"Autumn",winter:"Winter"},de:{title:"Story-Info",category:"Kategorie",topic:"Thema",theme:"Thema",storyType:"Story-Typ",storyDetails:"Story-Idee",artStyle:"Kunststil",language:"Sprache",readingLevel:"Lesestufe",pages:"LÃ¤nge",dedication:"Widmung",mainCharacters:"Hauptfiguren",otherCharacters:"Andere Figuren",relationships:"Beziehungen",season:"Jahreszeit",location:"Ort",noData:"Nicht angegeben",spring:"FrÃ¼hling",summer:"Sommer",autumn:"Herbst",winter:"Winter"},fr:{title:"Info histoire",category:"CatÃ©gorie",topic:"Sujet",theme:"ThÃ¨me",storyType:"Type d'histoire",storyDetails:"IdÃ©e d'histoire",artStyle:"Style artistique",language:"Langue",readingLevel:"Niveau de lecture",pages:"Longueur",dedication:"DÃ©dicace",mainCharacters:"Personnages principaux",otherCharacters:"Autres personnages",relationships:"Relations",season:"Saison",location:"Lieu",noData:"Non spÃ©cifiÃ©",spring:"Printemps",summer:"Ã‰tÃ©",autumn:"Automne",winter:"Hiver"}};return(G[l]||G.en)[d]||d},C=d=>(ni[l]||ni.en)[d]||d,x=d=>(oi[l]||oi.en)[d]||d,A=(d,G)=>d==null||d===""?e.jsx("span",{className:"text-gray-400 italic",children:s("noData")}):e.jsx("span",{className:"text-gray-800",children:d}),P=r.mainCharacters||[],m=((v=r.characters)==null?void 0:v.filter(d=>P.includes(d.id)))||[],T=((V=r.characters)==null?void 0:V.filter(d=>!P.includes(d.id)))||[],S=d=>s(d)||d,D=()=>{if(!r.userLocation)return null;const d=[r.userLocation.city,r.userLocation.region,r.userLocation.country].filter(Boolean);return d.length>0?d.join(", "):null};return e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>y(!n),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-amber-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($n,{size:16,className:"text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-800",children:s("title")}),e.jsx("span",{className:"text-xs bg-amber-200 text-amber-700 px-2 py-0.5 rounded",children:"DEV"})]}),n?e.jsx(Zt,{size:18,className:"text-amber-600"}):e.jsx(pa,{size:18,className:"text-amber-600"})]}),n&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[m.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(ga,{size:12}),s("mainCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(d=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-indigo-100 text-indigo-800 border border-indigo-200",children:[e.jsx(ga,{size:10}),e.jsx("span",{children:d.name})]},d.id))})]}),T.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(ja,{size:12}),s("otherCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:T.map(d=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700 border border-gray-200",children:[e.jsx(ga,{size:10}),e.jsx("span",{children:d.name})]},d.id))})]}),r.relationships&&Object.keys(r.relationships).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-2",children:s("relationships")}),e.jsx("div",{className:"text-xs bg-white/50 p-2 rounded border border-amber-100 space-y-1",children:Object.entries(r.relationships).map(([d,G])=>{var E,te;const[F,ne]=d.split("-").map(Y=>parseInt(Y,10)),L=(E=r.characters)==null?void 0:E.find(Y=>Y.id===F),Z=(te=r.characters)==null?void 0:te.find(Y=>Y.id===ne);return!L||!Z?null:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-amber-600 font-medium whitespace-nowrap",children:[L.name," â†’ ",Z.name,":"]}),e.jsx("span",{className:"text-gray-700",children:G})]},d)})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(Hn,{size:12}),s("language")]}),e.jsx("div",{className:"text-sm",children:r.language?mo[r.language]||r.language:A(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:s("readingLevel")}),e.jsx("div",{className:"text-sm",children:r.languageLevel?x(r.languageLevel):A(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:s("pages")}),e.jsx("div",{className:"text-sm",children:r.pages?`${r.pages} ${l==="de"?"Seiten":"pages"}`:A(void 0)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:s("season")}),e.jsx("div",{className:"text-sm",children:r.season?S(r.season):A(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:s("location")}),e.jsx("div",{className:"text-sm",children:D()||A(void 0)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(yi,{size:12}),s("artStyle")]}),e.jsx("div",{className:"text-sm capitalize",children:A(r.artStyle)})]})]}),r.storyDetails&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(Wr,{size:12}),s("storyDetails")]}),e.jsx("div",{className:"text-sm bg-white/50 p-2 rounded border border-amber-100 whitespace-pre-wrap",children:r.storyDetails})]}),(r.storyCategory||r.storyTheme||r.storyTopic)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-amber-100",children:[r.storyCategory&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(Mn,{size:12}),s("category")]}),e.jsx("div",{className:"text-sm",children:C(r.storyCategory)})]}),(r.storyTheme||r.storyTopic)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:r.storyCategory==="adventure"?s("theme"):s("topic")}),e.jsx("div",{className:"text-sm",children:r.storyCategory==="adventure"?r.storyTheme:r.storyTopic})]})]})]})]})}function go({storyId:r,onShareStatusChange:l,variant:n="compact"}){const{language:y}=Ot(),[s,C]=o.useState(!1),[x,A]=o.useState(null),[P,m]=o.useState(!1),[T,S]=o.useState(!1),[D,v]=o.useState(null),V=n==="full",d={share:y==="de"?"Teilen":y==="fr"?"Partager":"Share",shareStory:y==="de"?"Geschichte teilen":y==="fr"?"Partager l'histoire":"Share Story",enableSharing:y==="de"?"Link aktivieren":y==="fr"?"Activer le lien":"Enable sharing",disableSharing:y==="de"?"Link deaktivieren":y==="fr"?"DÃ©sactiver le lien":"Disable sharing",copyLink:y==="de"?"Link kopieren":y==="fr"?"Copier le lien":"Copy link",copied:y==="de"?"Kopiert!":y==="fr"?"CopiÃ©!":"Copied!",shareWhatsApp:y==="de"?"Per WhatsApp teilen":y==="fr"?"Partager sur WhatsApp":"Share on WhatsApp",sharingEnabled:y==="de"?"Teilen aktiv":y==="fr"?"Partage actif":"Sharing enabled",sharingDisabled:y==="de"?"Teilen inaktiv":y==="fr"?"Partage inactif":"Sharing disabled",anyoneWithLink:y==="de"?"Jeder mit dem Link kann die Geschichte lesen":y==="fr"?"Toute personne avec le lien peut lire l'histoire":"Anyone with the link can read the story",errorLoading:y==="de"?"Fehler beim Laden":y==="fr"?"Erreur de chargement":"Error loading"};o.useEffect(()=>{s&&!x&&G()},[s]);const G=async()=>{m(!0),v(null);try{const Z=localStorage.getItem("auth_token"),E=await fetch(`/api/stories/${r}/share-status`,{headers:Z?{Authorization:`Bearer ${Z}`}:{}});if(!E.ok)throw new Error("Failed to fetch status");const te=await E.json();A(te)}catch{v(d.errorLoading)}finally{m(!1)}},F=async()=>{m(!0),v(null);try{const E=(x==null?void 0:x.isShared)?"DELETE":"POST",te=localStorage.getItem("auth_token"),Y=await fetch(`/api/stories/${r}/share`,{method:E,headers:te?{Authorization:`Bearer ${te}`}:{}});if(!Y.ok)throw new Error("Failed to toggle sharing");const Q=await Y.json();A({isShared:Q.isShared,shareToken:Q.shareToken,shareUrl:Q.shareUrl}),l==null||l(Q.isShared)}catch{v("Failed to update sharing")}finally{m(!1)}},ne=async()=>{if(x!=null&&x.shareUrl)try{await navigator.clipboard.writeText(x.shareUrl),S(!0),setTimeout(()=>S(!1),2e3)}catch{const E=document.createElement("textarea");E.value=x.shareUrl,document.body.appendChild(E),E.select(),document.execCommand("copy"),document.body.removeChild(E),S(!0),setTimeout(()=>S(!1),2e3)}},L=()=>{if(!(x!=null&&x.shareUrl))return;const Z=encodeURIComponent(x.shareUrl);window.open(`https://wa.me/?text=${Z}`,"_blank")};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>C(!s),className:V?"bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full hover:bg-indigo-600":"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-lg hover:from-blue-600 hover:to-indigo-600 transition-all shadow-md hover:shadow-lg",title:d.share,children:[e.jsx(si,{className:"w-4 h-4"}),e.jsx("span",{className:V?"":"hidden sm:inline",children:d.share}),(x==null?void 0:x.isShared)&&e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>C(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-xl border border-gray-200 z-50 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(si,{className:"w-5 h-5 text-blue-600"}),d.shareStory]})}),e.jsx("div",{className:"p-4 space-y-4",children:P&&!x?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(gt,{className:"w-6 h-6 animate-spin text-blue-500"})}):D?e.jsx("div",{className:"text-red-500 text-sm py-2",children:D}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[x!=null&&x.isShared?e.jsx(qn,{className:"w-5 h-5 text-green-500"}):e.jsx(Vn,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:x!=null&&x.isShared?"text-green-700":"text-gray-600",children:x!=null&&x.isShared?d.sharingEnabled:d.sharingDisabled})]}),e.jsx("button",{onClick:F,disabled:P,className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${x!=null&&x.isShared?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"} disabled:opacity-50`,children:P?e.jsx(gt,{className:"w-4 h-4 animate-spin"}):x!=null&&x.isShared?d.disableSharing:d.enableSharing})]}),(x==null?void 0:x.isShared)&&x.shareUrl&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500",children:d.anyoneWithLink}),e.jsx("button",{onClick:ne,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:T?e.jsxs(e.Fragment,{children:[e.jsx(Ln,{className:"w-4 h-4 text-green-500"}),d.copied]}):e.jsxs(e.Fragment,{children:[e.jsx(On,{className:"w-4 h-4"}),d.copyLink]})}),e.jsxs("button",{onClick:L,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors",children:[e.jsx(Kn,{className:"w-4 h-4"}),d.shareWhatsApp]})]})]})})]})]})]})}function ho({title:r,dedication:l,story:n,outline:y,outlinePrompt:s,outlineModelId:C,outlineUsage:x,storyTextPrompts:A=[],visualBible:P,sceneImages:m,sceneDescriptions:T=[],coverImages:S,regeneratingCovers:D=new Set,languageLevel:v="standard",storyLanguage:V,isGenerating:d=!1,onDownloadPdf:G,onAddToBook:F,onPrintBook:ne,onCreateAnother:L,onDownloadTxt:Z,onRegenerateImage:E,onRegenerateCover:te,characters:Y=[],onEditImage:Q,onEditCover:$,onRepairImage:re,onRevertRepair:pe,onVisualBibleChange:fe,storyId:ye,developerMode:le=!1,styledAvatarGeneration:Se=[],costumedAvatarGeneration:Ee=[],generationLog:Be=[],finalChecksReport:X,clothingRequirements:Ve,isPartial:Ce=!1,failureReason:Ue,generatedPages:ue,totalPages:ge,progressiveMode:_=!1,progressiveData:Ae,completedPageImages:tt={},originalStory:_e,onSaveStoryText:ht,onSaveTitleChange:vt,userCredits:Yt=0,imageRegenerationCost:jt=5,isImpersonating:Vs=!1,onSelectImageVersion:Jr,generationSettings:ps}){var ft,xr,bt,rs,at,Rr,zt,Er;const{t:mr,language:a}=Ot(),ke=V?V.startsWith("de")?"de":V:a,rt=Vs||Yt===-1||Yt>=jt,[he,Qr]=o.useState(null),[lt,_t]=o.useState(""),[Nt,ur]=o.useState(!1),[st,Sr]=o.useState(n),[dt,Xt]=o.useState(!1),[we,er]=o.useState(!1),[Fe,tr]=o.useState(r||""),[Me,Cr]=o.useState(!1),[ct,rr]=o.useState(null),[He,At]=o.useState(null),[,xe]=o.useState(!1),[be,Zr]=o.useState(new Set),[Te,j]=o.useState(null),[ve,Yr]=o.useState(null),[kr,ot]=o.useState(null),[Rt,Ar]=o.useState("square"),[Ke,Pr]=o.useState(!1),[sr,fs]=o.useState({}),[wt,bs]=o.useState(new Set),ys=async t=>{if(!(!ye||sr[t]||wt.has(t))){bs(f=>new Set(f).add(t));try{const f=localStorage.getItem("token"),b=await fetch(`/api/stories/${ye}/visual-bible-image/${t}`,{headers:{Authorization:`Bearer ${f}`}});if(b.ok){const z=await b.json();fs(u=>({...u,[t]:z.imageData}))}}catch(f){console.error(`Failed to load reference image for ${t}:`,f)}finally{bs(f=>{const b=new Set(f);return b.delete(t),b})}}},gr=(t,f)=>{if(!f||!le)return null;const b=sr[t],z=wt.has(t);return b?e.jsx("img",{src:b,alt:"Reference",className:"w-16 h-16 object-cover rounded border border-rose-300 cursor-pointer hover:opacity-80",onClick:()=>ot({src:b,title:"Reference Image"})}):e.jsx("button",{onClick:()=>ys(t),disabled:z,className:"w-16 h-16 flex items-center justify-center bg-rose-100 border border-rose-300 rounded text-rose-500 hover:bg-rose-200 disabled:opacity-50",title:"Load reference image",children:z?e.jsx(gt,{size:16,className:"animate-spin"}):e.jsx(Vr,{size:16})})};o.useEffect(()=>{Nt||Sr(n)},[n,Nt]),o.useEffect(()=>{we||tr(r||"")},[r,we]);const Tr=async()=>{if(ht){Xt(!0);try{await ht(st),ur(!1)}catch(t){console.error("Failed to save story text:",t)}finally{Xt(!1)}}},vs=async()=>{if(!(!vt||!Fe.trim())){Cr(!0);try{await vt(Fe.trim()),er(!1)}catch(t){console.error("Failed to save title:",t)}finally{Cr(!1)}}},js=()=>{Sr(n),ur(!1)},Ns=async t=>{if(!(!re||ve!==null)){Yr(t);try{await re(t)}catch(f){console.error("Failed to repair image:",f)}finally{Yr(null)}}},Xr=(t,f)=>{const b=st.split(/(?=---\s*(?:Page|Seite)\s+\d+\s*---|(?=##\s*(?:Page|Seite)\s+\d+))/i);let z=0;for(let se=0;se<b.length;se++)if(/^(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i.test(b[se].trim())){z=se;break}const u=z+t;if(u<b.length){const se=b[u].match(/^(---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i),de=se?se[0]:"";b[u]=de+`
`+f.trim()+`
`}Sr(b.join(""))},ar=t=>{const f=m.find(b=>b.pageNumber===t);return(f==null?void 0:f.imageVersions)||[]},qs=async(t,f)=>{if(Jr)try{await Jr(t,f),rr(null)}catch(b){console.error("Failed to select image version:",b)}},es=t=>{if(!t)return"";let f;if(typeof t!="string"){const se=t;if(se.output)if(typeof se.output=="string")f=se.output;else if(typeof se.output=="object"){const de=se.output.translatedSummary||se.output.imageSummary||"";if(de)return de;f=JSON.stringify(t)}else f=JSON.stringify(t);else f=JSON.stringify(t)}else f=t;if(f.trim().startsWith("{"))try{const se=JSON.parse(f);if(se.output){if(typeof se.output=="string")f=se.output;else if(typeof se.output=="object"){const de=se.output.translatedSummary||se.output.imageSummary;if(de)return de}}}catch{}const b=f.match(/(?:#{1,3}\s*)?(?:\*\*)?6\.?\s*(?:\*\*)?\s*\*?\*?(Image Summary|Bildzusammenfassung|RÃ©sumÃ© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*\*?\*?\s*:?\s*\n?([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n---|\n```|$)/i);if(b&&b[2]&&b[2].trim())return b[2].trim();const z=f.match(/(?:#{1,3}\s*)?\*?\*?(Image Summary|Bildzusammenfassung|RÃ©sumÃ© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*:?\s*\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n\*\*|\n#{1,3}\s|$)/i);if(z&&z[2]&&z[2].trim())return z[2].trim();if(!f.includes("**")&&f.length<1e3)return f.trim();const u=f.match(/\*?\*?(Image Summary|Bildzusammenfassung|RÃ©sumÃ© de l['']Image)\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:\*\*)?\d+\.\s*\*\*|\n\s*\*\*\d+\.|$)/i);return u&&u[2]&&u[2].trim()?u[2].trim():f.substring(0,500).trim()+"..."},ws=t=>{if(!t||!Y.length)return Y.map(z=>z.id);let f;if(typeof t!="string"){const z=t;f=z.output&&typeof z.output=="string"?z.output:JSON.stringify(t)}else f=t;if(f.trim().startsWith("{"))try{const z=JSON.parse(f);z.output&&typeof z.output=="string"&&(f=z.output)}catch{}const b=f.toLowerCase();return Y.filter(z=>b.includes(z.name.toLowerCase())).map(z=>z.id)},Ir=t=>{const f=m.find(de=>de.pageNumber===t),b=T.find(de=>de.pageNumber===t),z=(f==null?void 0:f.description)||(b==null?void 0:b.description)||"",u=(b==null?void 0:b.translatedSummary)||es(z)||(b==null?void 0:b.imageSummary)||"",se=ws(z);At({pageNumber:t,scene:u,selectedCharacterIds:se})},$r=async()=>{if(!He||!E)return;const t=He.pageNumber,f=He.scene,b=He.selectedCharacterIds;At(null),Zr(z=>new Set(z).add(t)),xe(!0);try{await E(t,f,b)}catch(z){console.error("Failed to regenerate image:",z)}finally{Zr(z=>{const u=new Set(z);return u.delete(t),u}),Zr(z=>(z.size===0&&xe(!1),z))}},hr=t=>{let f="",b=[];if(t==="front"&&(S!=null&&S.frontCover)){const de=S.frontCover;typeof de=="object"&&(f=de.description||"",b=de.referencePhotos||[])}else if(t==="initial"&&(S!=null&&S.initialPage)){const de=S.initialPage;typeof de=="object"&&(f=de.description||"",b=de.referencePhotos||[])}else if(t==="back"&&(S!=null&&S.backCover)){const de=S.backCover;typeof de=="object"&&(f=de.description||"",b=de.referencePhotos||[])}let z=[];b.length>0&&Y.length>0&&(z=Y.filter(de=>b.some(Qe=>Qe.name===de.name)).map(de=>de.id)),z.length===0&&(z=Y.map(de=>de.id)),j({coverType:t,scene:f,selectedCharacterIds:z,title:t==="front"?r:void 0,dedication:t==="initial"?l:void 0})},ts=async()=>{if(!Te||!te)return;const{coverType:t,scene:f,selectedCharacterIds:b,title:z,dedication:u}=Te;j(null);try{await te(t,f,b,z,u)}catch(se){console.error("Failed to regenerate cover:",se)}},ir=(t,f,b,z)=>{Qr({type:t,id:f,field:b}),_t(z||"")},Ye=()=>{if(!he||!P||!fe)return;const{type:t,id:f,field:b}=he,z={...P};if(t==="secondaryCharacter")z.secondaryCharacters=(z.secondaryCharacters||[]).map(u=>u.id===f?{...u,[b]:lt}:u);else if(t==="animal")z.animals=(z.animals||[]).map(u=>u.id===f?{...u,[b]:lt}:u);else if(t==="artifact")z.artifacts=(z.artifacts||[]).map(u=>u.id===f?{...u,[b]:lt}:u);else if(t==="location")z.locations=(z.locations||[]).map(u=>u.id===f?{...u,[b]:lt}:u);else if(t==="mainCharacter"){const u=parseInt(f);z.mainCharacters=(z.mainCharacters||[]).map(se=>se.id!==u?se:b==="physical.face"?{...se,physical:{...se.physical,face:lt}}:b==="physical.hair"?{...se,physical:{...se.physical,hair:lt}}:b==="physical.build"?{...se,physical:{...se.physical,build:lt}}:se)}fe(z),Qr(null),_t("")},Ht=()=>{Qr(null),_t("")},xt=(t=>t?t.split(/(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i).slice(1).filter(b=>b.trim().length>0):[])(Nt?st:n),Wt=m.length>0,nr=v==="1st-grade",Vt=(()=>{if(!_)return xt.length;if(xt.length===0)return 0;let t=1;for(let f=2;f<=xt.length;f++){const b=f-1;if(m.some(u=>u.pageNumber===b&&u.imageData)||!!tt[b])t=f;else break}return t})(),Dr=(Ae==null?void 0:Ae.totalPages)||xt.length;Ae!=null&&Ae.totalScenes||m.length||Math.ceil(Dr/(nr?1:2));const qt=t=>t?typeof t=="string"?t:t.imageData||null:null,St=t=>t?typeof t=="string"?{imageData:t}:t:null,pt=t=>{var z;const f=(z=T.find(u=>u.pageNumber===t))==null?void 0:z.description;if(f)return f;const b=m.find(u=>u.pageNumber===t);return b==null?void 0:b.description},Xe=t=>{const f=T.find(b=>b.pageNumber===t);return t===1&&f&&(console.log("[StoryDisplay] Page 1 scene keys:",Object.keys(f)),console.log("[StoryDisplay] Page 1 has outlineExtract:",!!f.outlineExtract),console.log("[StoryDisplay] Page 1 has scenePrompt:",!!f.scenePrompt)),f==null?void 0:f.outlineExtract},Ft=t=>{var f;return(f=T.find(b=>b.pageNumber===t))==null?void 0:f.scenePrompt},Ut=t=>{var f;return(f=T.find(b=>b.pageNumber===t))==null?void 0:f.textModelId};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center gap-2",children:we?e.jsxs("div",{className:"flex items-center gap-2 w-full max-w-2xl",children:[e.jsx("input",{type:"text",value:Fe,onChange:t=>tr(t.target.value),className:"flex-1 text-2xl md:text-3xl font-bold text-gray-800 text-center border-2 border-indigo-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-500",autoFocus:!0,onKeyDown:t=>{t.key==="Enter"&&vs(),t.key==="Escape"&&(tr(r||""),er(!1))}}),e.jsx("button",{onClick:vs,disabled:Me||!Fe.trim(),className:"p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50",title:a==="de"?"Speichern":a==="fr"?"Sauvegarder":"Save",children:Me?e.jsx(gs,{className:"animate-spin",size:20}):e.jsx(Hr,{size:20})}),e.jsx("button",{onClick:()=>{tr(r||""),er(!1)},disabled:Me,className:"p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",title:a==="de"?"Abbrechen":a==="fr"?"Annuler":"Cancel",children:e.jsx(Dt,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-800 text-center",children:r||mr.yourStory}),vt&&!d&&e.jsx("button",{onClick:()=>er(!0),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:a==="de"?"Titel bearbeiten":a==="fr"?"Modifier le titre":"Edit title",children:e.jsx(nt,{size:18})})]})}),Ce&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-400 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-amber-500 text-2xl",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-amber-800",children:a==="de"?"UnvollstÃ¤ndige Geschichte":a==="fr"?"Histoire incomplÃ¨te":"Incomplete Story"}),e.jsx("p",{className:"text-amber-700 text-sm mt-1",children:a==="de"?`Diese Geschichte konnte nicht vollstÃ¤ndig generiert werden. ${ue||m.length} von ${ge||"unbekannt"} Seiten wurden erstellt.`:a==="fr"?`Cette histoire n'a pas pu Ãªtre gÃ©nÃ©rÃ©e complÃ¨tement. ${ue||m.length} sur ${ge||"inconnu"} pages ont Ã©tÃ© crÃ©Ã©es.`:`This story could not be fully generated. ${ue||m.length} of ${ge||"unknown"} pages were created.`}),Ue&&le&&e.jsxs("details",{className:"mt-2 text-sm",children:[e.jsx("summary",{className:"cursor-pointer text-amber-600 hover:text-amber-700",children:a==="de"?"Fehlerdetails":a==="fr"?"DÃ©tails de l'erreur":"Error details"}),e.jsx("p",{className:"mt-1 bg-amber-100 p-2 rounded text-amber-800 font-mono text-xs",children:Ue})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[Wt&&ye&&F&&e.jsxs("button",{onClick:F,disabled:d,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ti,{size:16})," ",a==="de"?"Buch erstellen":a==="fr"?"CrÃ©er le livre":"Create Book"]}),Wt&&G&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>Pr(!Ke),disabled:d,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Wr,{size:16}),a==="de"?"PDF herunterladen":a==="fr"?"TÃ©lÃ©charger PDF":"Download PDF",e.jsx(Zt,{size:14,className:`transition-transform ${Ke?"rotate-180":""}`})]}),Ke&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:Rt==="square",onChange:()=>Ar("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20Ã—20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:Rt==="A4",onChange:()=>Ar("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21Ã—28cm)"})]})]}),e.jsx("button",{onClick:()=>{G(Rt),Pr(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:a==="de"?"Herunterladen":a==="fr"?"TÃ©lÃ©charger":"Download"})]})]}),Wt&&ye&&!d&&e.jsx(go,{storyId:ye,variant:"full"}),L&&e.jsxs("button",{onClick:L,disabled:d,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xa,{size:16})," ",a==="de"?"Neue Geschichte":a==="fr"?"Nouvelle histoire":"New Story"]})]}),le&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[Z&&e.jsxs("button",{onClick:Z,className:"bg-gray-500 text-white px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 hover:bg-gray-600",children:[e.jsx(wr,{size:14})," TXT"]}),Wt&&ye&&ne&&e.jsxs("button",{onClick:ne,disabled:d,className:`bg-yellow-500 text-black px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 ${d?"opacity-50 cursor-not-allowed":"hover:bg-yellow-600"}`,children:[e.jsx(Hs,{size:14})," Print (DEV)"]})]}),le&&ps&&e.jsx("div",{className:"mt-4",children:e.jsx(uo,{settings:ps,language:a})}),le&&e.jsxs("div",{className:"space-y-4 mt-6",children:[y&&e.jsxs("details",{className:"bg-purple-50 border-2 border-purple-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-purple-800 hover:text-purple-900 flex items-center gap-2",children:[e.jsx(Wr,{size:20}),nr?a==="de"?"VollstÃ¤ndige API-Ausgabe (Kombiniert)":a==="fr"?"Sortie API complÃ¨te (CombinÃ©e)":"Full API Output (Combined)":a==="de"?"VollstÃ¤ndige API-Ausgabe (Outline)":a==="fr"?"Sortie API complÃ¨te (Plan)":"Full API Output (Outline)",C&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-purple-600",children:["(",C,")"]}),x&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-purple-500",children:["[",x.input_tokens.toLocaleString()," in / ",x.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[s&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:a==="de"?"ðŸ“¤ Prompt (Eingabe)":a==="fr"?"ðŸ“¤ Prompt (EntrÃ©e)":"ðŸ“¤ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:s})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:nr?a==="de"?"ðŸ“¥ API-Antwort (Kombiniert)":a==="fr"?"ðŸ“¥ RÃ©ponse API (CombinÃ©e)":"ðŸ“¥ API Response (Combined)":a==="de"?"ðŸ“¥ API-Antwort (Outline)":a==="fr"?"ðŸ“¥ RÃ©ponse API (Plan)":"ðŸ“¥ API Response (Outline)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:y})]})]})]}),n&&A.length>0&&e.jsxs("details",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(Hs,{size:20}),a==="de"?"VollstÃ¤ndige API-Ausgabe (Story-Text)":a==="fr"?"Sortie API complÃ¨te (Texte)":"Full API Output (Story Text)",((ft=A[0])==null?void 0:ft.modelId)&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-amber-600",children:["(",A[0].modelId,")"]}),((xr=A[0])==null?void 0:xr.usage)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-500",children:["[",A[0].usage.input_tokens.toLocaleString()," in / ",A[0].usage.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:a==="de"?"ðŸ“¤ Prompt (Eingabe)":a==="fr"?"ðŸ“¤ Prompt (EntrÃ©e)":"ðŸ“¤ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((bt=A[0])==null?void 0:bt.prompt)||"No prompt available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:a==="de"?"ðŸ“¥ Rohe API-Antwort (ungefiltert)":a==="fr"?"ðŸ“¥ RÃ©ponse API brute (non filtrÃ©e)":"ðŸ“¥ Raw API Response (unfiltered)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((rs=A[0])==null?void 0:rs.rawResponse)||n})]})]})]}),P&&e.jsxs("details",{className:"bg-rose-50 border-2 border-rose-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-rose-800 hover:text-rose-900 flex items-center gap-2",children:[e.jsx(Hs,{size:20}),a==="de"?"Visual Bible (Wiederkehrende Elemente)":a==="fr"?"Bible Visuelle (Ã‰lÃ©ments RÃ©currents)":"Visual Bible (Recurring Elements)",P.changeLog&&P.changeLog.length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-rose-200 text-rose-800 rounded-full text-xs font-medium",children:[P.changeLog.length," ",a==="de"?"Ã„nderungen":a==="fr"?"changements":"changes"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[P.mainCharacters&&P.mainCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-purple-300 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-purple-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ‘—"}),a==="de"?"Hauptcharaktere (Style Profile)":a==="fr"?"Personnages Principaux (Profil Style)":"Main Characters (Style Profile)"]}),e.jsx("div",{className:"space-y-3",children:P.mainCharacters.map(t=>{var f,b,z,u;return e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-sm",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-800 hover:text-purple-900",children:[t.name,Object.keys(t.generatedOutfits||{}).length>0&&e.jsxs("span",{className:"ml-2 px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:[Object.keys(t.generatedOutfits).length," ",a==="de"?"Outfits":a==="fr"?"tenues":"outfits"]})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Physical:"}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[((f=t.physical)==null?void 0:f.skinTone)||"N/A"," | ",((b=t.physical)==null?void 0:b.hair)||"N/A"," | ",((z=t.physical)==null?void 0:z.build)||"N/A",((u=t.physical)==null?void 0:u.other)&&` | ${t.physical.other}`]})]}),t.generatedOutfits&&Object.keys(t.generatedOutfits).length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-200",children:[e.jsx("span",{className:"font-medium text-gray-600 text-xs",children:"Generated Outfits:"}),e.jsx("div",{className:"mt-1 space-y-1",children:Object.entries(t.generatedOutfits).map(([se,de])=>{var Qe;return e.jsxs("div",{className:"bg-white p-1.5 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-purple-600",children:["Page ",se,":"]}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[(Qe=de.outfit)==null?void 0:Qe.substring(0,80),"..."]}),e.jsx("span",{className:`ml-1 px-1 py-0.5 rounded text-[10px] ${de.setting==="outdoor-cold"?"bg-blue-100 text-blue-700":de.setting==="outdoor-warm"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:de.setting})]},se)})})]})]})]},t.id)})})]}),P.secondaryCharacters&&P.secondaryCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:a==="de"?"Nebencharaktere":a==="fr"?"Personnages Secondaires":"Secondary Characters"}),e.jsx("div",{className:"space-y-2",children:P.secondaryCharacters.map(t=>{var f;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[gr(t.id,t.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[t.name,t.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:t.id}),t.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${t.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:t.source==="outline"?"Outline":"Story"}),t.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((f=t.appearsInPages)==null?void 0:f.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",t.appearsInPages.join(", "),")"]})]}),(he==null?void 0:he.type)==="secondaryCharacter"&&(he==null?void 0:he.id)===t.id&&(he==null?void 0:he.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:lt,onChange:b=>_t(b.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Ye,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Hr,{size:12})," Save"]}),e.jsxs("button",{onClick:Ht,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Dt,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:t.description}),le&&fe&&e.jsx("button",{onClick:()=>ir("secondaryCharacter",t.id,"description",t.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(nt,{size:12})})]}),t.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",t.extractedDescription]})]})]},t.id)})})]}),((at=P.animals)==null?void 0:at.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:a==="de"?"Tiere & Wesen":a==="fr"?"Animaux & CrÃ©atures":"Animals & Creatures"}),e.jsx("div",{className:"space-y-2",children:P.animals.map(t=>{var f;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[gr(t.id,t.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[t.name,t.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:t.id}),t.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${t.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:t.source==="outline"?"Outline":"Story"}),t.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((f=t.appearsInPages)==null?void 0:f.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",t.appearsInPages.join(", "),")"]})]}),(he==null?void 0:he.type)==="animal"&&(he==null?void 0:he.id)===t.id&&(he==null?void 0:he.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:lt,onChange:b=>_t(b.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Ye,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Hr,{size:12})," Save"]}),e.jsxs("button",{onClick:Ht,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Dt,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:t.description}),le&&fe&&e.jsx("button",{onClick:()=>ir("animal",t.id,"description",t.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(nt,{size:12})})]}),t.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",t.extractedDescription]})]})]},t.id)})})]}),((Rr=P.artifacts)==null?void 0:Rr.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:a==="de"?"Artefakte & Objekte":a==="fr"?"Artefacts & Objets":"Artifacts & Objects"}),e.jsx("div",{className:"space-y-2",children:P.artifacts.map(t=>{var f;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[gr(t.id,t.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[t.name,t.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:t.id}),t.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${t.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:t.source==="outline"?"Outline":"Story"}),t.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((f=t.appearsInPages)==null?void 0:f.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",t.appearsInPages.join(", "),")"]})]}),(he==null?void 0:he.type)==="artifact"&&(he==null?void 0:he.id)===t.id&&(he==null?void 0:he.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:lt,onChange:b=>_t(b.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Ye,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Hr,{size:12})," Save"]}),e.jsxs("button",{onClick:Ht,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Dt,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:t.description}),le&&fe&&e.jsx("button",{onClick:()=>ir("artifact",t.id,"description",t.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(nt,{size:12})})]}),t.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",t.extractedDescription]})]})]},t.id)})})]}),((zt=P.locations)==null?void 0:zt.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:a==="de"?"Wiederkehrende Orte":a==="fr"?"Lieux RÃ©currents":"Recurring Locations"}),e.jsx("div",{className:"space-y-2",children:P.locations.map(t=>{var f;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[!t.isRealLandmark&&gr(t.id,t.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[t.name,t.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:t.id}),t.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${t.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:t.source==="outline"?"Outline":"Story"}),t.isRealLandmark&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-amber-100 text-amber-700 font-semibold",children:"ðŸ“ LANDMARK"}),t.photoFetchStatus==="success"&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-green-100 text-green-700",children:"ðŸ“· Photo"}),!t.isRealLandmark&&t.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((f=t.appearsInPages)==null?void 0:f.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",t.appearsInPages.join(", "),")"]})]}),t.isRealLandmark&&t.landmarkQuery&&e.jsxs("div",{className:"text-amber-700 text-xs mt-1",children:["Landmark: ",e.jsx("span",{className:"font-mono bg-amber-50 px-1 rounded",children:t.landmarkQuery})]}),(he==null?void 0:he.type)==="location"&&(he==null?void 0:he.id)===t.id&&(he==null?void 0:he.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:lt,onChange:b=>_t(b.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Ye,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Hr,{size:12})," Save"]}),e.jsxs("button",{onClick:Ht,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Dt,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:t.description}),le&&fe&&e.jsx("button",{onClick:()=>ir("location",t.id,"description",t.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(nt,{size:12})})]}),t.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",t.extractedDescription]}),t.referencePhotoData&&e.jsxs("div",{className:"mt-2 border border-amber-200 rounded overflow-hidden",children:[e.jsx("img",{src:t.referencePhotoData,alt:`${t.name} reference`,className:"w-full max-h-32 object-contain bg-gray-50"}),t.photoAttribution&&e.jsxs("div",{className:"text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 truncate",children:["ðŸ“· ",t.photoAttribution]})]})]})]},t.id)})})]}),P.vehicles&&P.vehicles.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:a==="de"?"Fahrzeuge":a==="fr"?"VÃ©hicules":"Vehicles"}),e.jsx("div",{className:"space-y-2",children:P.vehicles.map(t=>{var f;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[gr(t.id,t.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[t.name,t.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:t.id}),t.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${t.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:t.source==="outline"?"Outline":"Story"}),t.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((f=t.appearsInPages)==null?void 0:f.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",t.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:t.description}),t.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",t.extractedDescription]})]})]},t.id)})})]}),P.clothing&&P.clothing.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:a==="de"?"Kleidung & KostÃ¼me":a==="fr"?"VÃªtements & Costumes":"Clothing & Costumes"}),e.jsx("div",{className:"space-y-2",children:P.clothing.map(t=>{var f;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[t.name,t.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:t.id}),t.wornBy&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:["worn by ",t.wornBy]}),t.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${t.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:t.source==="outline"?"Outline":"Story"}),((f=t.appearsInPages)==null?void 0:f.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",t.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:t.description}),t.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",t.extractedDescription]})]},t.id)})})]}),P.changeLog&&P.changeLog.length>0&&e.jsxs("details",{className:"bg-white border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-bold text-amber-700 hover:text-amber-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“"}),a==="de"?"Ã„nderungsprotokoll":a==="fr"?"Journal des Modifications":"Change Log",e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-amber-100 text-amber-700 rounded text-xs",children:P.changeLog.length})]}),e.jsx("div",{className:"mt-2 space-y-1 max-h-[500px] overflow-y-auto",children:P.changeLog.slice().reverse().map((t,f)=>{var b;return e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs border-l-2 border-amber-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${t.type==="mainCharacter"?"bg-purple-100 text-purple-700":t.type==="secondaryCharacter"?"bg-rose-100 text-rose-700":t.type==="generatedOutfit"?"bg-green-100 text-green-700":t.type==="animal"?"bg-orange-100 text-orange-700":t.type==="artifact"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:t.type}),e.jsx("span",{className:"font-semibold text-amber-800",children:t.element}),e.jsxs("span",{className:"text-gray-500",children:[ke==="de"?"Seite":"Page"," ",t.page]})]}),e.jsxs("div",{className:"mt-1 text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:[t.change,":"]}),e.jsxs("span",{className:"ml-1 text-gray-700",children:[(b=t.after)==null?void 0:b.substring(0,100),t.after&&t.after.length>100?"...":""]})]}),t.before&&e.jsxs("div",{className:"text-gray-400 line-through text-[10px] mt-0.5",children:[a==="de"?"Vorher":a==="fr"?"Avant":"Before",": ",t.before.substring(0,50),"..."]}),e.jsx("div",{className:"text-gray-400 text-[10px] mt-0.5",children:new Date(t.timestamp).toLocaleTimeString()})]},f)})})]}),(!P.mainCharacters||P.mainCharacters.length===0)&&(!P.secondaryCharacters||P.secondaryCharacters.length===0)&&(!P.animals||P.animals.length===0)&&(!P.artifacts||P.artifacts.length===0)&&(!P.locations||P.locations.length===0)&&(!P.vehicles||P.vehicles.length===0)&&(!P.clothing||P.clothing.length===0)&&e.jsx("div",{className:"text-gray-500 text-sm italic",children:a==="de"?"Keine wiederkehrenden Elemente gefunden":a==="fr"?"Aucun Ã©lÃ©ment rÃ©current trouvÃ©":"No recurring elements found in this story"})]})]}),Ve&&Object.keys(Ve).length>0&&e.jsxs("details",{className:"bg-teal-50 border-2 border-teal-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-teal-800 hover:text-teal-900 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ‘”"}),a==="de"?`Kleidungsanforderungen (${Object.keys(Ve).length} Charaktere)`:a==="fr"?`Exigences vestimentaires (${Object.keys(Ve).length} personnages)`:`Clothing Requirements (${Object.keys(Ve).length} characters)`]}),e.jsx("div",{className:"mt-4 space-y-3",children:Object.entries(Ve).map(([t,f])=>{var b,z,u,se,de,Qe,Bt,Pt,pr,Kt,ce,mt,ss,Fr,Tt;return e.jsxs("div",{className:"bg-white border border-teal-200 rounded-lg p-3",children:[e.jsx("h4",{className:"font-bold text-teal-700 mb-2",children:t}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${(b=f.standard)!=null&&b.used?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(z=f.standard)!=null&&z.used?"âœ…":"â¬œ"," Standard"]}),((u=f.standard)==null?void 0:u.used)&&((se=f.standard)==null?void 0:se.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:f.standard.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(de=f.winter)!=null&&de.used?"bg-blue-50 border border-blue-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(Qe=f.winter)!=null&&Qe.used?"â„ï¸":"â¬œ"," Winter"]}),((Bt=f.winter)==null?void 0:Bt.used)&&((Pt=f.winter)==null?void 0:Pt.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:f.winter.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(pr=f.summer)!=null&&pr.used?"bg-yellow-50 border border-yellow-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(Kt=f.summer)!=null&&Kt.used?"â˜€ï¸":"â¬œ"," Summer"]}),((ce=f.summer)==null?void 0:ce.used)&&((mt=f.summer)==null?void 0:mt.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:f.summer.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(ss=f.costumed)!=null&&ss.used?"bg-purple-50 border border-purple-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(Fr=f.costumed)!=null&&Fr.used?"ðŸŽ­":"â¬œ"," Costumed"]}),((Tt=f.costumed)==null?void 0:Tt.used)&&e.jsxs("div",{className:"text-gray-600 mt-1",children:[f.costumed.costume&&e.jsxs("span",{className:"font-medium",children:[f.costumed.costume,": "]}),f.costumed.description]})]})]})]},t)})})]}),Se&&Se.length>0&&e.jsxs("details",{className:"bg-pink-50 border-2 border-pink-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-pink-800 hover:text-pink-900 flex items-center gap-2",children:[e.jsx(Vr,{size:20}),a==="de"?`Stilisierte Avatare (${Se.length})`:a==="fr"?`Avatars stylisÃ©s (${Se.length})`:`Styled Avatars (${Se.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:Se.map((t,f)=>{var b,z;return e.jsxs("details",{className:`border rounded-lg p-3 ${t.success?"bg-white border-pink-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${t.success?"bg-green-500":"bg-red-500"}`}),t.characterName," - ",t.artStyle," (",t.clothingCategory||"standard",")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(t.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Face Photo"}),(b=t.inputs.facePhoto)!=null&&b.imageData?e.jsx("img",{src:t.inputs.facePhoto.imageData,alt:"Face",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>ot({src:t.inputs.facePhoto.imageData,title:"Face Photo"}),title:`${t.inputs.facePhoto.sizeKB} KB - Click to enlarge`}):t.inputs.facePhoto?e.jsxs("span",{className:"text-blue-600 text-[10px]",children:[t.inputs.facePhoto.sizeKB," KB"]}):e.jsx("span",{className:"text-gray-400 italic text-[10px]",children:"N/A"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Original Avatar"}),(z=t.inputs.originalAvatar)!=null&&z.imageData?e.jsx("img",{src:t.inputs.originalAvatar.imageData,alt:"Avatar",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>ot({src:t.inputs.originalAvatar.imageData,title:"Original Avatar"}),title:`${t.inputs.originalAvatar.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-blue-600 text-[10px]",children:[t.inputs.originalAvatar.sizeKB," KB"]})]}),t.inputs.styleSample&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Style Sample"}),t.inputs.styleSample.imageData?e.jsx("img",{src:t.inputs.styleSample.imageData,alt:"Style",className:"w-16 h-16 object-cover rounded border border-purple-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>ot({src:t.inputs.styleSample.imageData,title:"Style Sample"}),title:`${t.inputs.styleSample.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-purple-600 text-[10px]",children:[t.inputs.styleSample.sizeKB," KB"]})]})]})]}),t.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",t.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-[500px] overflow-y-auto",children:t.prompt})]}),t.success&&t.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2 flex flex-col items-start",children:t.output.imageData?e.jsx("img",{src:t.output.imageData,alt:"Output",className:"w-24 h-24 object-cover rounded border border-green-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>ot({src:t.output.imageData,title:"Styled Avatar Output"}),title:`${t.output.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-green-600",children:[t.output.sizeKB," KB"]})})]}),!t.success&&t.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:t.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(t.timestamp).toLocaleString()]})]})]},f)})})]}),Ee&&Ee.length>0&&e.jsxs("details",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-orange-800 hover:text-orange-900 flex items-center gap-2",children:[e.jsx(Vr,{size:20}),a==="de"?`KostÃ¼m-Avatare (${Ee.length})`:a==="fr"?`Avatars costumÃ©s (${Ee.length})`:`Costumed Avatars (${Ee.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:Ee.map((t,f)=>{var b,z,u;return e.jsxs("details",{className:`border rounded-lg p-3 ${t.success?"bg-white border-orange-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 hover:text-orange-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${t.success?"bg-green-500":"bg-red-500"}`}),t.characterName," - ",t.costumeType," (",t.artStyle,")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(t.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[t.costumeDescription&&e.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-yellow-700",children:"Costume:"}),e.jsx("p",{className:"mt-1 text-gray-700",children:t.costumeDescription})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Face Photo"}),(b=t.inputs.facePhoto)!=null&&b.imageData?e.jsx("img",{src:t.inputs.facePhoto.imageData,alt:"Face",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>ot({src:t.inputs.facePhoto.imageData,title:"Face Photo"}),title:`${t.inputs.facePhoto.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-blue-600 text-[10px]",children:[((z=t.inputs.facePhoto)==null?void 0:z.sizeKB)||0," KB"]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Standard Avatar"}),(u=t.inputs.standardAvatar)!=null&&u.imageData?e.jsx("img",{src:t.inputs.standardAvatar.imageData,alt:"Avatar",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>ot({src:t.inputs.standardAvatar.imageData,title:"Standard Avatar"}),title:`${t.inputs.standardAvatar.sizeKB} KB - Click to enlarge`}):e.jsx("span",{className:"text-gray-400 italic text-[10px]",children:"N/A"})]})]})]}),t.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",t.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-[500px] overflow-y-auto",children:t.prompt})]}),t.success&&t.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2 flex flex-col items-start",children:t.output.imageData?e.jsx("img",{src:t.output.imageData,alt:"Output",className:"w-24 h-24 object-cover rounded border border-green-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>ot({src:t.output.imageData,title:"Costumed Avatar Output"}),title:`${t.output.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-green-600",children:[t.output.sizeKB," KB"]})})]}),!t.success&&t.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:t.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(t.timestamp).toLocaleString()]})]})]},f)})})]}),Be&&Be.length>0&&e.jsxs("details",{className:"bg-slate-50 border-2 border-slate-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-slate-800 hover:text-slate-900 flex items-center gap-2",children:[e.jsx(Wr,{size:20}),a==="de"?`Generierungslog (${Be.length})`:a==="fr"?`Journal de gÃ©nÃ©ration (${Be.length})`:`Generation Log (${Be.length})`,Be.filter(t=>t.level==="warn").length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-yellow-200 text-yellow-800 text-xs rounded-full",children:[Be.filter(t=>t.level==="warn").length," warnings"]}),Be.filter(t=>t.level==="error").length>0&&e.jsxs("span",{className:"ml-1 px-2 py-0.5 bg-red-200 text-red-800 text-xs rounded-full",children:[Be.filter(t=>t.level==="error").length," errors"]})]}),e.jsx("div",{className:"mt-4 space-y-1 max-h-96 overflow-y-auto",children:Be.map((t,f)=>e.jsxs("div",{className:`text-xs p-2 rounded flex items-start gap-2 ${t.level==="error"?"bg-red-50 text-red-800":t.level==="warn"?"bg-yellow-50 text-yellow-800":t.level==="debug"?"bg-gray-50 text-gray-600":"bg-white text-slate-700"}`,children:[e.jsx("span",{className:"text-gray-400 font-mono text-[10px] whitespace-nowrap",children:new Date(t.timestamp).toLocaleTimeString()}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium whitespace-nowrap ${t.stage==="outline"?"bg-blue-100 text-blue-700":t.stage==="avatars"?"bg-purple-100 text-purple-700":t.stage==="scenes"?"bg-green-100 text-green-700":t.stage==="images"?"bg-orange-100 text-orange-700":t.stage==="covers"?"bg-pink-100 text-pink-700":"bg-gray-100 text-gray-700"}`,children:t.stage}),t.character&&e.jsxs("span",{className:"font-medium text-slate-600",children:["[",t.character,"]"]}),e.jsx("span",{className:"flex-1",children:t.message}),e.jsx("span",{className:"text-gray-400 text-[10px]",children:t.event})]},f))})]}),X&&e.jsxs("details",{className:`border-2 rounded-xl p-4 ${X.overallConsistent?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("summary",{className:`cursor-pointer text-lg font-bold flex items-center gap-2 ${X.overallConsistent?"text-green-800 hover:text-green-900":"text-amber-800 hover:text-amber-900"}`,children:[X.overallConsistent?"âœ“":"âš ï¸",a==="de"?`KonsistenzprÃ¼fung (${X.totalIssues} Probleme)`:a==="fr"?`VÃ©rification de cohÃ©rence (${X.totalIssues} problÃ¨mes)`:`Final Checks (${X.totalIssues} issues)`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700",children:X.summary}),X.imageChecks&&X.imageChecks.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:a==="de"?"Bildkonsistenz":a==="fr"?"CohÃ©rence des images":"Image Consistency"}),X.imageChecks.map((t,f)=>{var b,z;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${t.consistent?"text-green-600":"text-amber-600"}`,children:t.consistent?"âœ“":"âš ï¸"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:t.type==="full"?"Full Check":t.type==="character"?`Character: ${t.characterName}`:t.type==="sequence"?"Sequence Check":t.type}),t.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",t.overallScore,"/10"]})]}),t.issues&&t.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:t.issues.map((u,se)=>{var de,Qe;return e.jsxs("div",{className:`text-xs p-2 rounded ${u.severity==="high"?"bg-red-50 border-l-4 border-red-400":u.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${u.severity==="high"?"bg-red-200 text-red-800":u.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:u.severity}),e.jsxs("span",{className:"text-gray-500",children:["Pages ",(de=u.images)==null?void 0:de.join(", ")]}),u.pagesToFix&&u.pagesToFix.length>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-orange-100 text-orange-700 rounded text-[10px]",children:["Fix: ",u.pagesToFix.join(", ")]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:(Qe=u.type)==null?void 0:Qe.replace(/_/g," ")}),u.characterInvolved&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded text-[10px]",children:u.characterInvolved})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:u.description}),u.details&&Object.keys(u.details).length>0&&e.jsx("div",{className:"mt-1 pl-2 border-l-2 border-gray-200",children:Object.entries(u.details).map(([Bt,Pt])=>e.jsxs("p",{className:"text-gray-500 text-[10px]",children:[e.jsxs("span",{className:"font-medium",children:[Bt,":"]})," ",Pt]},Bt))}),u.canonicalVersion&&e.jsxs("p",{className:"text-blue-700 mt-1",children:["ðŸŽ¯ Target: ",u.canonicalVersion]}),u.recommendation&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:["ðŸ’¡ ",u.recommendation]})]},se)})}),t.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:t.summary}),(t.evaluationPrompts||t.evaluationPrompt)&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:["ðŸ” View Evaluation Prompt",(((b=t.evaluationPrompts)==null?void 0:b.length)??0)>1?`s (${(z=t.evaluationPrompts)==null?void 0:z.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:(t.evaluationPrompts??(t.evaluationPrompt?[t.evaluationPrompt]:[])).map((u,se)=>{var de;return e.jsxs("div",{children:[(((de=t.evaluationPrompts)==null?void 0:de.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-blue-700 mb-1",children:["Batch ",se+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto bg-white p-2 rounded border",children:u})]},se)})})]}),e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"ðŸ”§ View Parsed Result (Full JSON)"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-96 overflow-y-auto bg-white p-2 rounded border",children:JSON.stringify({type:t.type,characterName:t.characterName,consistent:t.consistent,overallScore:t.overallScore,issues:t.issues,summary:t.summary},null,2)})]}),t.rawResponses&&t.rawResponses.length>0&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:["ðŸ“ View Raw Response",t.rawResponses.length>1?`s (${t.rawResponses.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:t.rawResponses.map((u,se)=>{var de;return e.jsxs("div",{children:[(((de=t.rawResponses)==null?void 0:de.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-purple-700 mb-1",children:["Batch ",se+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto bg-white p-2 rounded border",children:u})]},se)})})]})]},f)})]}),X.textCheck&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:a==="de"?"TextqualitÃ¤t":a==="fr"?"QualitÃ© du texte":"Text Quality"}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${X.textCheck.quality==="good"?"text-green-600":X.textCheck.quality==="needs_review"?"text-amber-600":"text-red-600"}`,children:X.textCheck.quality==="good"?"âœ“":"âš ï¸"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:X.textCheck.quality==="good"?"Good":X.textCheck.quality==="needs_review"?"Needs Review":"Has Issues"}),X.textCheck.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",X.textCheck.overallScore,"/10"]})]}),X.textCheck.issues&&X.textCheck.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:X.textCheck.issues.map((t,f)=>e.jsxs("div",{className:`text-xs p-2 rounded ${t.severity==="high"?"bg-red-50 border-l-4 border-red-400":t.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${t.severity==="high"?"bg-red-200 text-red-800":t.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:t.severity}),t.page&&e.jsxs("span",{className:"text-gray-500",children:["Page ",t.page]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:t.type})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:t.issue}),(t.originalText||t.text)&&e.jsxs("p",{className:"text-red-600 mt-1 line-through",children:['"',t.originalText||t.text,'"']}),t.correctedText&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:['âœ“ "',t.correctedText,'"']}),!t.correctedText&&t.suggestion&&e.jsxs("p",{className:"text-green-700 mt-1",children:["â†’ ",t.suggestion]})]},f))}),X.textCheck.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:X.textCheck.summary}),X.textCheck.fullOriginalText&&e.jsxs("details",{className:"mt-3 bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-gray-700",children:"ðŸ“„ View Original Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-600 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:X.textCheck.fullOriginalText})]}),X.textCheck.fullCorrectedText&&e.jsxs("details",{className:"mt-3 bg-green-50 border border-green-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-green-800",children:"ðŸ“‹ View Full Corrected Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:X.textCheck.fullCorrectedText})]}),X.textCheck.rawResponse&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:"ðŸ“ View Raw Response"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:X.textCheck.rawResponse})]}),X.textCheck&&e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"ðŸ”§ View Parsed Result"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:JSON.stringify({quality:X.textCheck.quality,overallScore:X.textCheck.overallScore,issues:X.textCheck.issues,summary:X.textCheck.summary,parseError:X.textCheck.parseError},null,2)})]}),X.textCheck.evaluationPrompt&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:"ðŸ” View Evaluation Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:X.textCheck.evaluationPrompt})]})]})]}),X.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-2 text-xs text-red-700",children:["Error: ",X.error]})]})]}),T.length>0&&e.jsxs("details",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-green-800 hover:text-green-900 flex items-center gap-2",children:[e.jsx(Wr,{size:20}),a==="de"?`Alle Szenenbeschreibungen (${T.length})`:a==="fr"?`Toutes les descriptions de scÃ¨nes (${T.length})`:`All Scene Descriptions (${T.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:T.map(t=>{var f;return e.jsxs("details",{className:"bg-white border border-green-200 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-700 hover:text-green-800",children:ke==="de"?`Seite ${t.pageNumber}`:ke==="fr"?`Page ${t.pageNumber}`:`Page ${t.pageNumber}`}),e.jsxs("div",{className:"mt-2 space-y-2",children:[t.outlineExtract&&e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-amber-700",children:"Outline Extract:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:t.outlineExtract})]}),t.scenePrompt&&e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-purple-700",children:"Scene Prompt:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:t.scenePrompt})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Scene Description:"}),t.textModelId&&e.jsxs("span",{className:"ml-2 text-green-600",children:["(",t.textModelId,")"]}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:typeof t.description=="string"?t.description:((f=t.description)==null?void 0:f.text)||JSON.stringify(t.description)})]})]})]},t.pageNumber)})})]})]}),S&&qt(S.frontCover)&&(()=>{var f,b,z;const t=St(S.frontCover);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:ke==="de"?"Titelseite":ke==="fr"?"Couverture":"Front Cover"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{src:qt(S.frontCover),alt:"Front Cover",className:"w-full rounded-lg shadow-lg",label:"Front Cover"}),D.has("frontCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(gt,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),te&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>hr("front"),disabled:d||!rt||D.has("frontCover"),className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d||!rt||D.has("frontCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:rt?"":a==="de"?"Nicht genug Credits":a==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(Gt,{size:14}),a==="de"?"Bild neu generieren":a==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",jt," ",a==="de"?"Credits":"credits",")"]})]})}),le&&t&&e.jsxs("div",{className:"mt-3 space-y-2",children:[$&&e.jsxs("button",{onClick:()=>$("front"),disabled:d,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(nt,{size:14})," ",a==="de"?"Bearbeiten":"Edit"]}),t.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:a==="de"?"Szenenbeschreibung":a==="fr"?"Description de scÃ¨ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:typeof t.description=="string"?t.description:((f=t.description)==null?void 0:f.text)||JSON.stringify(t.description)})]}),t.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[a==="de"?"API-Prompt":a==="fr"?"Prompt API":"API Prompt",t.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",t.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:t.prompt})]}),((((b=t.referencePhotos)==null?void 0:b.length)??0)>0||(((z=t.landmarkPhotos)==null?void 0:z.length)??0)>0)&&e.jsx(hs,{referencePhotos:t.referencePhotos||[],landmarkPhotos:t.landmarkPhotos,language:a}),t.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[a==="de"?"QualitÃ¤tsbewertung":a==="fr"?"Score de qualitÃ©":"Quality Score",t.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",t.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${t.qualityScore>=70?"text-green-600":t.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(t.qualityScore),"%"]})]}),t.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:a==="de"?"Feedback:":a==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:t.qualityReasoning})]})]}),t.retryHistory&&t.retryHistory.length>0&&e.jsx(qr,{retryHistory:t.retryHistory,totalAttempts:t.totalAttempts||t.retryHistory.length,language:a}),t.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[a==="de"?"Vorherige Version":a==="fr"?"Version prÃ©cÃ©dente":"Previous Version",t.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(t.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:t.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),t.originalImage&&t.originalImage!==t.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[a==="de"?"Originalbild":a==="fr"?"Image originale":"Original Image",t.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(t.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:t.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),S&&qt(S.initialPage)&&(()=>{var f,b,z;const t=St(S.initialPage);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:ke==="de"?"Widmungsseite":ke==="fr"?"Page de dÃ©dicace":"Dedication Page"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{src:qt(S.initialPage),alt:"Dedication Page",className:"w-full rounded-lg shadow-lg",label:"Dedication Page"}),D.has("initialPage")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(gt,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),te&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>hr("initial"),disabled:d||!rt||D.has("initialPage"),className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d||!rt||D.has("initialPage")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:rt?"":a==="de"?"Nicht genug Credits":a==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(Gt,{size:14}),a==="de"?"Bild neu generieren":a==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",jt," ",a==="de"?"Credits":"credits",")"]})]})}),le&&t&&e.jsxs("div",{className:"mt-3 space-y-2",children:[$&&e.jsxs("button",{onClick:()=>$("initial"),disabled:d,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(nt,{size:14})," ",a==="de"?"Bearbeiten":"Edit"]}),t.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:a==="de"?"Szenenbeschreibung":a==="fr"?"Description de scÃ¨ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:typeof t.description=="string"?t.description:((f=t.description)==null?void 0:f.text)||JSON.stringify(t.description)})]}),t.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[a==="de"?"API-Prompt":a==="fr"?"Prompt API":"API Prompt",t.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",t.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:t.prompt})]}),((((b=t.referencePhotos)==null?void 0:b.length)??0)>0||(((z=t.landmarkPhotos)==null?void 0:z.length)??0)>0)&&e.jsx(hs,{referencePhotos:t.referencePhotos||[],landmarkPhotos:t.landmarkPhotos,language:a}),t.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[a==="de"?"QualitÃ¤tsbewertung":a==="fr"?"Score de qualitÃ©":"Quality Score",t.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",t.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${t.qualityScore>=70?"text-green-600":t.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(t.qualityScore),"%"]})]}),t.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:a==="de"?"Feedback:":a==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:t.qualityReasoning})]})]}),t.retryHistory&&t.retryHistory.length>0&&e.jsx(qr,{retryHistory:t.retryHistory,totalAttempts:t.totalAttempts||t.retryHistory.length,language:a}),t.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[a==="de"?"Vorherige Version":a==="fr"?"Version prÃ©cÃ©dente":"Previous Version",t.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(t.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:t.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),t.originalImage&&t.originalImage!==t.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[a==="de"?"Originalbild":a==="fr"?"Image originale":"Original Image",t.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(t.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:t.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),_&&!n&&(S==null?void 0:S.frontCover)&&e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-8 mt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-indigo-700",children:ke==="de"?"Geschichte wird erstellt...":ke==="fr"?"CrÃ©ation de l'histoire...":"Creating your story..."}),e.jsx("p",{className:"text-indigo-500 mt-2",children:ke==="de"?"Die Seiten werden gleich angezeigt":ke==="fr"?"Les pages seront bientÃ´t affichÃ©es":"Pages will appear shortly"})]})}),Wt&&n&&e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 text-center mb-6",children:r||(ke==="de"?"Ihre Geschichte":ke==="fr"?"Votre histoire":"Your Story")}),xt.slice(0,_?Vt:xt.length).map((t,f)=>{var Bt,Pt,pr,Kt;const b=f+1,z=b,u=m.find(ce=>ce.pageNumber===z),se=_?tt[z]:void 0,de=!!(u!=null&&u.imageData||se),Qe=_&&b===Vt&&!de;return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-4 text-center",children:ke==="de"?`Seite ${b}`:ke==="fr"?`Page ${b}`:`Page ${b}`}),nr?e.jsxs("div",{className:"flex flex-col items-center max-w-2xl mx-auto",children:[Qe?e.jsxs("div",{className:"w-full mb-4 aspect-[4/3] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-md flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-600 font-medium",children:ke==="de"?"Bild wird erstellt...":ke==="fr"?"CrÃ©ation de l'image...":"Creating image..."}),e.jsx("p",{className:"text-indigo-400 text-sm mt-1",children:ke==="de"?"Die nÃ¤chste Seite erscheint bald":ke==="fr"?"La page suivante arrive bientÃ´t":"Next page coming soon"})]}):u!=null&&u.imageData||se?e.jsxs("div",{className:"w-full mb-4 relative",children:[e.jsx(Ms,{src:((u==null?void 0:u.imageData)||se)??"",alt:`Scene for page ${b}`,className:`w-full rounded-lg shadow-md object-cover ${be.has(b)?"opacity-50":""}`,label:`Page ${b}`}),be.has(b)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(gs,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:a==="de"?"Neues Bild wird erstellt...":a==="fr"?"Nouvelle image en cours...":"Generating new image..."})]}),E&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>Ir(b),disabled:d||be.has(b)||!rt,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d||be.has(b)||!rt?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:rt?"":a==="de"?"Nicht genug Credits":a==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(Gt,{size:14}),a==="de"?"Bild neu generieren":a==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",jt," ",a==="de"?"Credits":"credits",")"]})]}),ht&&e.jsxs("button",{onClick:()=>ur(!0),disabled:d,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(nt,{size:14}),a==="de"?"Text bearbeiten":a==="fr"?"Modifier le texte":"Edit Text"]}),ar(b).length>1&&e.jsxs("button",{onClick:()=>rr({pageNumber:b,versions:ar(b)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(Vr,{size:14}),ar(b).length]})]})}),le&&e.jsxs("div",{className:"mt-3 space-y-2",children:[Q&&e.jsxs("button",{onClick:()=>Q(b),disabled:d,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(nt,{size:14})," ",a==="de"?"Bearbeiten":"Edit"]}),re&&e.jsx("button",{onClick:()=>Ns(b),disabled:d||ve!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d||ve!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:a==="de"?"Physik-Fehler automatisch erkennen und reparieren":a==="fr"?"DÃ©tecter et rÃ©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:ve===b?e.jsxs(e.Fragment,{children:[e.jsx(gs,{size:14,className:"animate-spin"}),a==="de"?"Repariere...":a==="fr"?"RÃ©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Bs,{size:14}),a==="de"?"Auto-Reparatur":a==="fr"?"Auto-RÃ©paration":"Auto-Repair"]})}),(u==null?void 0:u.repairHistory)&&u.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(Bs,{size:14}),a==="de"?"Reparatur-Historie":a==="fr"?"Historique de rÃ©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",u.repairHistory.length," ",a==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:u.repairHistory.map((ce,mt)=>e.jsxs("div",{className:`border rounded-lg p-3 ${ce.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[a==="de"?`Reparatur ${ce.attempt}`:`Repair ${ce.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${ce.success?"text-green-600":"text-red-600"}`,children:["(",ce.success?"âœ“":"âœ—"," ",ce.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:ce.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:a==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:a==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",ce.fixPrompt]}),ce.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:a==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:ce.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),ce.beforeImage&&ce.afterImage&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:a==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:ce.beforeImage,alt:"Before repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>ot({src:ce.beforeImage,title:a==="de"?"Vorher":"Before"}),title:a==="de"?"Klicken zum VergrÃ¶ÃŸern":"Click to enlarge"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:a==="de"?"Nachher:":"After:"}),e.jsx("img",{src:ce.afterImage,alt:"After repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>ot({src:ce.afterImage,title:a==="de"?"Nachher":"After"}),title:a==="de"?"Klicken zum VergrÃ¶ÃŸern":"Click to enlarge"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(ce.timestamp).toLocaleTimeString()})]},mt))})]}),Xe(b)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:a==="de"?"Auszug aus Gliederung":a==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Xe(b)})]}),Ft(b)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:a==="de"?"Szenen-Prompt":a==="fr"?"Prompt de scÃ¨ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:Ft(b)})]}),pt(b)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[a==="de"?"Szenenbeschreibung":a==="fr"?"Description de scÃ¨ne":"Scene Description",Ut(b)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",Ut(b),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:pt(b)})]}),(u==null?void 0:u.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[a==="de"?"API-Prompt":a==="fr"?"Prompt API":"API Prompt",(u==null?void 0:u.modelId)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",u.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:u==null?void 0:u.prompt})]}),((((Bt=u==null?void 0:u.referencePhotos)==null?void 0:Bt.length)??0)>0||(((Pt=u==null?void 0:u.landmarkPhotos)==null?void 0:Pt.length)??0)>0)&&u&&e.jsx(hs,{referencePhotos:u.referencePhotos||[],landmarkPhotos:u.landmarkPhotos,language:a}),(u==null?void 0:u.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[a==="de"?"QualitÃ¤tsbewertung":a==="fr"?"Score de qualitÃ©":"Quality Score",(u==null?void 0:u.qualityModelId)&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",u.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${((u==null?void 0:u.qualityScore)??0)>=70?"text-green-600":((u==null?void 0:u.qualityScore)??0)>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round((u==null?void 0:u.qualityScore)??0),"%"]})]}),(u==null?void 0:u.qualityReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:a==="de"?"Feedback:":a==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:u.qualityReasoning})]})]}),(u==null?void 0:u.retryHistory)&&u.retryHistory.length>0&&e.jsx(qr,{retryHistory:u.retryHistory,totalAttempts:(u==null?void 0:u.totalAttempts)||u.retryHistory.length,language:a,onRevertRepair:pe?(ce,mt)=>pe(u.pageNumber,mt):void 0}),(u==null?void 0:u.wasRegenerated)&&(!(u!=null&&u.retryHistory)||u.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["ðŸ”„ ",a==="de"?"Bild regeneriert":a==="fr"?"Image rÃ©gÃ©nÃ©rÃ©e":"Image Regenerated"]}),(u==null?void 0:u.originalScore)!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(u.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:a==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige QualitÃ¤t hatte.":a==="fr"?"L'image a Ã©tÃ© automatiquement rÃ©gÃ©nÃ©rÃ©e car la premiÃ¨re version avait une qualitÃ© faible.":"Image was automatically regenerated because the first version had low quality."}),(u==null?void 0:u.originalImage)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:a==="de"?"Originalbild:":a==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:u.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),(u==null?void 0:u.originalReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:a==="de"?"Original Feedback:":a==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:u.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`w-full flex flex-col items-center justify-center rounded-lg p-8 mb-4 ${d?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:ke==="de"?"Bild wird noch erstellt...":ke==="fr"?"Image en cours de crÃ©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:ke==="de"?"Kein Bild fÃ¼r diese Seite":ke==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"w-full bg-indigo-50 rounded-lg p-6 border-2 border-indigo-200",children:Nt?e.jsx("textarea",{value:t.trim(),onChange:ce=>Xr(f,ce.target.value),className:"w-full min-h-[400px] p-3 text-gray-800 leading-snug font-serif text-xl text-center bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:a==="de"?"Text eingeben...":a==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl text-center",children:t.trim()})})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 items-stretch",children:[u&&u.imageData?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:u.imageData,alt:`Scene for page ${b}`,className:`w-full rounded-lg shadow-md object-cover ${be.has(b)?"opacity-50":""}`}),be.has(b)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(gs,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:a==="de"?"Neues Bild wird erstellt...":a==="fr"?"Nouvelle image en cours...":"Generating new image..."})]})]}),E&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>Ir(b),disabled:d||be.has(b)||!rt,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d||be.has(b)||!rt?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:rt?"":a==="de"?"Nicht genug Credits":a==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(Gt,{size:14}),a==="de"?"Bild neu generieren":a==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",jt," ",a==="de"?"Credits":"credits",")"]})]}),ht&&e.jsxs("button",{onClick:()=>ur(!0),disabled:d,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(nt,{size:14}),a==="de"?"Text bearbeiten":a==="fr"?"Modifier le texte":"Edit Text"]}),ar(b).length>1&&e.jsxs("button",{onClick:()=>rr({pageNumber:b,versions:ar(b)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(Vr,{size:14}),ar(b).length]})]})}),le&&e.jsxs("div",{className:"mt-3 space-y-2",children:[Q&&e.jsxs("button",{onClick:()=>Q(b),disabled:d,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(nt,{size:14})," ",a==="de"?"Bearbeiten":"Edit"]}),re&&e.jsx("button",{onClick:()=>Ns(b),disabled:d||ve!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d||ve!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:a==="de"?"Physik-Fehler automatisch erkennen und reparieren":a==="fr"?"DÃ©tecter et rÃ©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:ve===b?e.jsxs(e.Fragment,{children:[e.jsx(gs,{size:14,className:"animate-spin"}),a==="de"?"Repariere...":a==="fr"?"RÃ©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Bs,{size:14}),a==="de"?"Auto-Reparatur":a==="fr"?"Auto-RÃ©paration":"Auto-Repair"]})}),(u==null?void 0:u.repairHistory)&&u.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(Bs,{size:14}),a==="de"?"Reparatur-Historie":a==="fr"?"Historique de rÃ©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",u.repairHistory.length," ",a==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:u.repairHistory.map((ce,mt)=>e.jsxs("div",{className:`border rounded-lg p-3 ${ce.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[a==="de"?`Reparatur ${ce.attempt}`:`Repair ${ce.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${ce.success?"text-green-600":"text-red-600"}`,children:["(",ce.success?"âœ“":"âœ—"," ",ce.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:ce.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:a==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:a==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",ce.fixPrompt]}),ce.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:a==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:ce.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),ce.beforeImage&&ce.afterImage&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:a==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:ce.beforeImage,alt:"Before repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>ot({src:ce.beforeImage,title:a==="de"?"Vorher":"Before"}),title:a==="de"?"Klicken zum VergrÃ¶ÃŸern":"Click to enlarge"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:a==="de"?"Nachher:":"After:"}),e.jsx("img",{src:ce.afterImage,alt:"After repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>ot({src:ce.afterImage,title:a==="de"?"Nachher":"After"}),title:a==="de"?"Klicken zum VergrÃ¶ÃŸern":"Click to enlarge"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(ce.timestamp).toLocaleTimeString()})]},mt))})]}),Xe(b)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:a==="de"?"Auszug aus Gliederung":a==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Xe(b)})]}),Ft(b)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:a==="de"?"Szenen-Prompt":a==="fr"?"Prompt de scÃ¨ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:Ft(b)})]}),pt(b)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[a==="de"?"Szenenbeschreibung":a==="fr"?"Description de scÃ¨ne":"Scene Description",Ut(b)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",Ut(b),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:pt(b)})]}),u.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[a==="de"?"API-Prompt":a==="fr"?"Prompt API":"API Prompt",u.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",u.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:u.prompt})]}),((((pr=u.referencePhotos)==null?void 0:pr.length)??0)>0||(((Kt=u.landmarkPhotos)==null?void 0:Kt.length)??0)>0)&&e.jsx(hs,{referencePhotos:u.referencePhotos||[],landmarkPhotos:u.landmarkPhotos,language:a}),u.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[a==="de"?"QualitÃ¤tsbewertung":a==="fr"?"Score de qualitÃ©":"Quality Score",u.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",u.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${u.qualityScore>=70?"text-green-600":u.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(u.qualityScore),"%"]})]}),u.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:a==="de"?"Feedback:":a==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:u.qualityReasoning})]})]}),u.retryHistory&&u.retryHistory.length>0&&e.jsx(qr,{retryHistory:u.retryHistory,totalAttempts:u.totalAttempts||u.retryHistory.length,language:a,onRevertRepair:pe?(ce,mt)=>pe(u.pageNumber,mt):void 0}),u.wasRegenerated&&(!u.retryHistory||u.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["ðŸ”„ ",a==="de"?"Bild regeneriert":a==="fr"?"Image rÃ©gÃ©nÃ©rÃ©e":"Image Regenerated"]}),u.originalScore!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(u.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:a==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige QualitÃ¤t hatte.":a==="fr"?"L'image a Ã©tÃ© automatiquement rÃ©gÃ©nÃ©rÃ©e car la premiÃ¨re version avait une qualitÃ© faible.":"Image was automatically regenerated because the first version had low quality."}),u.originalImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:a==="de"?"Originalbild:":a==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:u.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),u.originalReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:a==="de"?"Original Feedback:":a==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:u.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`flex flex-col items-center justify-center rounded-lg p-8 ${d?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:ke==="de"?"Bild wird noch erstellt...":ke==="fr"?"Image en cours de crÃ©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:ke==="de"?"Kein Bild fÃ¼r diese Seite":ke==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"flex flex-col w-full h-full",children:Nt?e.jsx("textarea",{value:t.trim(),onChange:ce=>Xr(f,ce.target.value),className:"w-full flex-1 min-h-[300px] p-4 text-gray-800 leading-snug font-serif text-xl bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:a==="de"?"Text eingeben...":a==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl",children:t.trim()})})})]})]},b)})]}),S&&qt(S.backCover)&&(()=>{var f,b,z;const t=St(S.backCover);return e.jsxs("div",{className:"mt-8 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:ke==="de"?"RÃ¼ckseite":ke==="fr"?"QuatriÃ¨me de couverture":"Back Cover"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{src:qt(S.backCover),alt:"Back Cover",className:"w-full rounded-lg shadow-lg",label:"Back Cover"}),D.has("backCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(gt,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),te&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>hr("back"),disabled:d||!rt||D.has("backCover"),className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d||!rt||D.has("backCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:rt?"":a==="de"?"Nicht genug Credits":a==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(Gt,{size:14}),a==="de"?"Bild neu generieren":a==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",jt," ",a==="de"?"Credits":"credits",")"]})]})}),le&&t&&e.jsxs("div",{className:"mt-3 space-y-2",children:[$&&e.jsxs("button",{onClick:()=>$("back"),disabled:d,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(nt,{size:14})," ",a==="de"?"Bearbeiten":"Edit"]}),t.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:a==="de"?"Szenenbeschreibung":a==="fr"?"Description de scÃ¨ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:typeof t.description=="string"?t.description:((f=t.description)==null?void 0:f.text)||JSON.stringify(t.description)})]}),t.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[a==="de"?"API-Prompt":a==="fr"?"Prompt API":"API Prompt",t.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",t.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:t.prompt})]}),((((b=t.referencePhotos)==null?void 0:b.length)??0)>0||(((z=t.landmarkPhotos)==null?void 0:z.length)??0)>0)&&e.jsx(hs,{referencePhotos:t.referencePhotos||[],landmarkPhotos:t.landmarkPhotos,language:a}),t.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[a==="de"?"QualitÃ¤tsbewertung":a==="fr"?"Score de qualitÃ©":"Quality Score",t.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",t.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${t.qualityScore>=70?"text-green-600":t.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(t.qualityScore),"%"]})]}),t.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:a==="de"?"Feedback:":a==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:t.qualityReasoning})]})]}),t.retryHistory&&t.retryHistory.length>0&&e.jsx(qr,{retryHistory:t.retryHistory,totalAttempts:t.totalAttempts||t.retryHistory.length,language:a}),t.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[a==="de"?"Vorherige Version":a==="fr"?"Version prÃ©cÃ©dente":"Previous Version",t.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(t.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:t.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),t.originalImage&&t.originalImage!==t.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[a==="de"?"Originalbild":a==="fr"?"Image originale":"Original Image",t.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(t.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:t.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),Wt&&n&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-4 mt-6",children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-3 text-center",children:a==="de"?"Was mÃ¶chten Sie als NÃ¤chstes tun?":a==="fr"?"Que souhaitez-vous faire ensuite ?":"What would you like to do next?"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[ye&&F&&e.jsxs("button",{onClick:F,disabled:d,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ti,{size:16})," ",a==="de"?"Buch erstellen":a==="fr"?"CrÃ©er le livre":"Create Book"]}),G&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>Pr(!Ke),disabled:d,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Wr,{size:16}),a==="de"?"PDF herunterladen":a==="fr"?"TÃ©lÃ©charger PDF":"Download PDF",e.jsx(Zt,{size:14,className:`transition-transform ${Ke?"rotate-180":""}`})]}),Ke&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:Rt==="square",onChange:()=>Ar("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20Ã—20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:Rt==="A4",onChange:()=>Ar("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21Ã—28cm)"})]})]}),e.jsx("button",{onClick:()=>{G(Rt),Pr(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:a==="de"?"Herunterladen":a==="fr"?"TÃ©lÃ©charger":"Download"})]})]}),ht&&!Nt&&e.jsxs("button",{onClick:()=>ur(!0),disabled:d,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(nt,{size:16})," ",a==="de"?"Text bearbeiten":a==="fr"?"Modifier le texte":"Edit Text"]}),L&&e.jsxs("button",{onClick:L,disabled:d,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xa,{size:16})," ",a==="de"?"Neue Geschichte":a==="fr"?"Nouvelle histoire":"New Story"]})]})]}),Nt&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 shadow-lg p-3 md:p-4 z-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(nt,{size:18,className:"flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-sm md:text-base",children:a==="de"?"Bearbeitungsmodus":a==="fr"?"Mode Ã©dition":"Edit Mode"}),_e&&e.jsxs("span",{className:"text-xs text-gray-500 hidden sm:inline",children:["(",a==="de"?"Original gespeichert":a==="fr"?"Original sauvegardÃ©":"Original saved",")"]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-center md:justify-end",children:[e.jsxs("button",{onClick:js,disabled:dt,className:"px-3 md:px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(Dt,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:a==="de"?"Abbrechen":a==="fr"?"Annuler":"Cancel"})]}),_e&&st!==_e&&e.jsxs("button",{onClick:()=>Sr(_e),disabled:dt,className:"px-3 md:px-4 py-2 border border-amber-400 text-amber-700 rounded-lg hover:bg-amber-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(zn,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:a==="de"?"ZurÃ¼cksetzen":a==="fr"?"Restaurer":"Restore"})]}),e.jsxs("button",{onClick:Tr,disabled:dt,className:`px-3 md:px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-semibold flex items-center gap-1.5 ${dt?"opacity-50 cursor-not-allowed":"hover:bg-green-600"}`,children:[e.jsx(Hr,{size:16}),dt?a==="de"?"Speichern...":a==="fr"?"Sauvegarde...":"Saving...":a==="de"?"Speichern":a==="fr"?"Sauvegarder":"Save"]})]})]})}),He&&e.jsx(oo,{pageNumber:He.pageNumber,scene:He.scene,onSceneChange:t=>At({...He,scene:t}),onClose:()=>At(null),onRegenerate:$r,isRegenerating:be.has(He.pageNumber),imageRegenerationCost:jt,characters:Y.map(t=>({id:t.id,name:t.name})),selectedCharacterIds:He.selectedCharacterIds,onCharacterSelectionChange:t=>At({...He,selectedCharacterIds:t}),consistencyRegen:le?(Er=m.find(t=>t.pageNumber===He.pageNumber))==null?void 0:Er.consistencyRegen:void 0}),Te&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Gt,{size:20}),a==="de"?"Cover bearbeiten":a==="fr"?"Modifier la couverture":"Edit Cover"," - ",Te.coverType==="front"?a==="de"?"Titelseite":a==="fr"?"Couverture":"Front Cover":Te.coverType==="initial"?a==="de"?"Einleitungsseite":a==="fr"?"Page de dÃ©dicace":"Dedication Page":a==="de"?"RÃ¼ckseite":a==="fr"?"Dos":"Back Cover"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:a==="de"?"Bearbeite die Szenenbeschreibung und wÃ¤hle die Charaktere aus":a==="fr"?"Modifiez la description de la scÃ¨ne et sÃ©lectionnez les personnages":"Edit the scene description and select the characters"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[Y.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ja,{size:16}),a==="de"?"Charaktere auf dem Cover:":a==="fr"?"Personnages sur la couverture:":"Characters on the cover:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Y.map(t=>{const f=Te.selectedCharacterIds.includes(t.id);return e.jsxs("button",{type:"button",onClick:()=>{const b=f?Te.selectedCharacterIds.filter(z=>z!==t.id):[...Te.selectedCharacterIds,t.id];j({...Te,selectedCharacterIds:b})},className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${f?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{className:"font-medium",children:t.name}),f&&e.jsx("span",{className:"text-indigo-500",children:"âœ“"})]},t.id)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:a==="de"?"WÃ¤hle die Charaktere aus, die auf dem Cover erscheinen sollen.":a==="fr"?"SÃ©lectionnez les personnages qui doivent apparaÃ®tre sur la couverture.":"Select the characters that should appear on the cover."})]}),Te.coverType==="front"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a==="de"?"Titel:":a==="fr"?"Titre:":"Title:"}),e.jsx("input",{type:"text",value:Te.title||"",onChange:t=>j({...Te,title:t.target.value}),placeholder:a==="de"?"Der Titel des Buches":a==="fr"?"Le titre du livre":"The book title",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),Te.coverType==="initial"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a==="de"?"Widmung:":a==="fr"?"DÃ©dicace:":"Dedication:"}),e.jsx("input",{type:"text",value:Te.dedication||"",onChange:t=>j({...Te,dedication:t.target.value}),placeholder:a==="de"?'z.B. "FÃ¼r meine liebste Tochter Emma"':a==="fr"?'par ex. "Pour ma chÃ¨re fille Emma"':'e.g. "For my dear daughter Emma"',className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:a==="de"?"Leer lassen fÃ¼r keine Widmung":a==="fr"?"Laisser vide pour aucune dÃ©dicace":"Leave empty for no dedication"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a==="de"?"Szenenbeschreibung:":a==="fr"?"Description de la scÃ¨ne:":"Scene description:"}),e.jsx("textarea",{value:Te.scene,onChange:t=>j({...Te,scene:t.target.value}),placeholder:a==="de"?'z.B. "Die Hauptfigur steht vor einem magischen Schloss bei Sonnenuntergang"':a==="fr"?'par ex. "Le personnage principal devant un chÃ¢teau magique au coucher du soleil"':'e.g. "The main character standing in front of a magical castle at sunset"',className:"w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y"}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:a==="de"?"Tipp: Beschreibe die Aktionen und die Umgebung. Die ausgewÃ¤hlten Charaktere werden automatisch hinzugefÃ¼gt.":a==="fr"?"Conseil: DÃ©crivez les actions et l'environnement. Les personnages sÃ©lectionnÃ©s seront ajoutÃ©s automatiquement.":"Tip: Describe the actions and the environment. Selected characters will be added automatically."})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:Te.selectedCharacterIds.length>0&&e.jsx("span",{children:a==="de"?`${Te.selectedCharacterIds.length} Charakter(e) ausgewÃ¤hlt`:a==="fr"?`${Te.selectedCharacterIds.length} personnage(s) sÃ©lectionnÃ©(s)`:`${Te.selectedCharacterIds.length} character(s) selected`})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>j(null),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium order-2 sm:order-1",children:a==="de"?"Abbrechen":a==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{onClick:ts,disabled:D.has(Te.coverType==="front"?"frontCover":Te.coverType==="initial"?"initialPage":"backCover")||Te.selectedCharacterIds.length===0,className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 order-1 sm:order-2 ${D.has(Te.coverType==="front"?"frontCover":Te.coverType==="initial"?"initialPage":"backCover")||Te.selectedCharacterIds.length===0?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:[e.jsx(Gt,{size:16}),a==="de"?"Neu generieren":a==="fr"?"RÃ©gÃ©nÃ©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",jt," ",a==="de"?"Credits":"credits",")"]})]})]})]})]})}),ct&&e.jsx(lo,{pageNumber:ct.pageNumber,versions:ct.versions,onClose:()=>rr(null),onSelectVersion:qs,developerMode:le}),kr&&e.jsx(co,{src:kr.src,title:kr.title,onClose:()=>ot(null)})]})}const Gs={"claude-sonnet":{provider:"anthropic",description:"Claude Sonnet 4.5 - Best narrative quality",descriptionDe:"Claude Sonnet 4.5 - Beste ErzÃ¤hlqualitÃ¤t",descriptionFr:"Claude Sonnet 4.5 - Meilleure qualitÃ© narrative"},"claude-haiku":{provider:"anthropic",description:"Claude Haiku 3.5 - Fast and cheap",descriptionDe:"Claude Haiku 3.5 - Schnell und gÃ¼nstig",descriptionFr:"Claude Haiku 3.5 - Rapide et Ã©conomique"},"gemini-2.5-pro":{provider:"google",description:"Gemini 2.5 Pro - High quality, large output",descriptionDe:"Gemini 2.5 Pro - Hohe QualitÃ¤t, grosse Ausgabe",descriptionFr:"Gemini 2.5 Pro - Haute qualitÃ©, grande sortie"},"gemini-2.5-flash":{provider:"google",description:"Gemini 2.5 Flash - Fast with large output",descriptionDe:"Gemini 2.5 Flash - Schnell mit grosser Ausgabe",descriptionFr:"Gemini 2.5 Flash - Rapide avec grande sortie"},"gemini-2.0-flash":{provider:"google",description:"Gemini 2.0 Flash - Very fast",descriptionDe:"Gemini 2.0 Flash - Sehr schnell",descriptionFr:"Gemini 2.0 Flash - TrÃ¨s rapide"}},li={"gemini-2.5-flash-image":{description:"Gemini 2.5 Flash Image - Fast scene generation",descriptionDe:"Gemini 2.5 Flash Image - Schnelle Szenengenerierung",descriptionFr:"Gemini 2.5 Flash Image - GÃ©nÃ©ration rapide de scÃ¨nes"},"gemini-3-pro-image-preview":{description:"Gemini 3 Pro Image - Higher quality (preview)",descriptionDe:"Gemini 3 Pro Image - HÃ¶here QualitÃ¤t (Vorschau)",descriptionFr:"Gemini 3 Pro Image - QualitÃ© supÃ©rieure (aperÃ§u)"},"flux-schnell":{description:"FLUX Schnell (Runware) - Ultra cheap ($0.0006/image)",descriptionDe:"FLUX Schnell (Runware) - Ultra gÃ¼nstig ($0.0006/Bild)",descriptionFr:"FLUX Schnell (Runware) - Ultra Ã©conomique ($0.0006/image)"},"flux-dev":{description:"FLUX Dev (Runware) - Better quality ($0.004/image)",descriptionDe:"FLUX Dev (Runware) - Bessere QualitÃ¤t ($0.004/Bild)",descriptionFr:"FLUX Dev (Runware) - Meilleure qualitÃ© ($0.004/image)"}},xo={"gemini-2.0-flash":{description:"Gemini 2.0 Flash - Fast evaluation",descriptionDe:"Gemini 2.0 Flash - Schnelle Bewertung",descriptionFr:"Gemini 2.0 Flash - Ã‰valuation rapide"},"gemini-2.5-flash":{description:"Gemini 2.5 Flash - More thorough",descriptionDe:"Gemini 2.5 Flash - GrÃ¼ndlicher",descriptionFr:"Gemini 2.5 Flash - Plus approfondi"}},po={gemini:{description:"Google Gemini - Best quality (~$0.035/image)",descriptionDe:"Google Gemini - Beste QualitÃ¤t (~$0.035/Bild)",descriptionFr:"Google Gemini - Meilleure qualitÃ© (~$0.035/image)"},runware:{description:"FLUX Schnell - Ultra cheap for testing ($0.0006/image)",descriptionDe:"FLUX Schnell - Ultra gÃ¼nstig zum Testen ($0.0006/Bild)",descriptionFr:"FLUX Schnell - Ultra Ã©conomique pour tests ($0.0006/image)"}},fo={"gemini-2.5-flash-image":{description:"Gemini 2.5 Flash Image - Fast avatar generation",descriptionDe:"Gemini 2.5 Flash Image - Schnelle Avatar-Generierung",descriptionFr:"Gemini 2.5 Flash Image - GÃ©nÃ©ration rapide d'avatars"},"gemini-3-pro-image-preview":{description:"Gemini 3 Pro Image - Higher quality (preview)",descriptionDe:"Gemini 3 Pro Image - HÃ¶here QualitÃ¤t (Vorschau)",descriptionFr:"Gemini 3 Pro Image - QualitÃ© supÃ©rieure (aperÃ§u)"},"ace-plus-plus":{description:"ACE++ (Runware) - Cheap face-consistent avatars (~$0.005)",descriptionDe:"ACE++ (Runware) - GÃ¼nstige gesichtskonsistente Avatare (~$0.005)",descriptionFr:"ACE++ (Runware) - Avatars Ã©conomiques avec visage cohÃ©rent (~$0.005)"}};function Qt({label:r,icon:l,value:n,options:y,onChange:s,language:C}){const x=A=>C==="de"&&A.descriptionDe?A.descriptionDe:C==="fr"&&A.descriptionFr?A.descriptionFr:A.description;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("label",{className:"text-xs font-semibold text-gray-600 flex items-center gap-1",children:[l,r]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:n||"",onChange:A=>s(A.target.value||null),className:"w-full appearance-none bg-white border border-gray-300 rounded-lg px-3 py-2 pr-8 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:C==="de"?"Server-Standard":C==="fr"?"Par dÃ©faut serveur":"Server Default"}),Object.entries(y).map(([A,P])=>e.jsxs("option",{value:A,children:[A," ",P.provider?`(${P.provider})`:""]},A))]}),e.jsx(Zt,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),n&&y[n]&&e.jsx("p",{className:"text-[10px] text-gray-500 italic",children:x(y[n])})]})}function bo({selections:r,onChange:l}){const{language:n}=Ot(),y=(s,C)=>{l({...r,[s]:C})};return e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-400 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-yellow-800 mb-3 flex items-center gap-2",children:[e.jsx(_n,{size:16}),n==="de"?"AI-Modell Auswahl (Dev)":n==="fr"?"SÃ©lection de modÃ¨le IA (Dev)":"AI Model Selection (Dev)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(Qt,{label:n==="de"?"Ideen-Modell":n==="fr"?"ModÃ¨le d'idÃ©es":"Idea Model",icon:e.jsx(Wn,{size:12}),value:r.ideaModel,options:Gs,onChange:s=>y("ideaModel",s),language:n}),e.jsx(Qt,{label:n==="de"?"Geschichte (Kombiniert)":n==="fr"?"Histoire (CombinÃ©)":"Story (Combined)",icon:e.jsx(Ur,{size:12}),value:r.outlineModel,options:Gs,onChange:s=>y("outlineModel",s),language:n}),e.jsx(Qt,{label:n==="de"?"Text-Modell":n==="fr"?"ModÃ¨le de texte":"Text Model",icon:e.jsx(Ur,{size:12}),value:r.textModel,options:Gs,onChange:s=>y("textModel",s),language:n}),e.jsx(Qt,{label:n==="de"?"Szenen-Modell":n==="fr"?"ModÃ¨le de scÃ¨ne":"Scene Description Model",icon:e.jsx(yi,{size:12}),value:r.sceneDescriptionModel,options:Gs,onChange:s=>y("sceneDescriptionModel",s),language:n}),e.jsx(Qt,{label:n==="de"?"Bild-Modell":n==="fr"?"ModÃ¨le d'image":"Image Model",icon:e.jsx(ei,{size:12}),value:r.imageModel,options:li,onChange:s=>y("imageModel",s),language:n}),e.jsx(Qt,{label:n==="de"?"Cover-Modell":n==="fr"?"ModÃ¨le de couverture":"Cover Image Model",icon:e.jsx(Qn,{size:12}),value:r.coverImageModel,options:li,onChange:s=>y("coverImageModel",s),language:n}),e.jsx(Qt,{label:n==="de"?"Bewertungs-Modell":n==="fr"?"ModÃ¨le d'Ã©valuation":"Quality Eval Model",icon:e.jsx(kn,{size:12}),value:r.qualityModel,options:xo,onChange:s=>y("qualityModel",s),language:n}),e.jsx(Qt,{label:n==="de"?"Bild-Reparatur":n==="fr"?"RÃ©paration d'image":"Image Repair",icon:e.jsx(Jn,{size:12}),value:r.imageBackend,options:po,onChange:s=>y("imageBackend",s),language:n}),e.jsx(Qt,{label:n==="de"?"Avatar-Modell":n==="fr"?"ModÃ¨le d'avatar":"Avatar Model",icon:e.jsx(ei,{size:12}),value:r.avatarModel,options:fo,onChange:s=>y("avatarModel",s),language:n})]}),e.jsx("p",{className:"text-[10px] text-yellow-700 mt-3 italic",children:n==="de"?'Hinweis: Nur sichtbar fÃ¼r Admin-Benutzer im Entwicklermodus. "Server-Standard" verwendet die Umgebungsvariablen-Konfiguration.':n==="fr"?`Note: Visible uniquement pour les utilisateurs admin en mode dÃ©veloppeur. "Par dÃ©faut serveur" utilise la configuration des variables d'environnement.`:'Note: Only visible to admin users in developer mode. "Server Default" uses the environment variable configuration.'})]})}const di=[{code:"de-ch",name:"Deutsch",family:"de"},{code:"fr-ch",name:"FranÃ§ais",family:"fr"},{code:"it-ch",name:"Italiano",family:"it"},{code:"en-gb",name:"English",family:"en"},{code:"gsw-zh",name:"Mundart",family:"gsw"}],Os={de:[{code:"de-ch",name:"Schweiz"},{code:"de-de",name:"Hochdeutsch"},{code:"de-de-north",name:"Norddeutsch"},{code:"de-de-south",name:"SÃ¼ddeutsch"},{code:"de-at",name:"Ã–sterreich"},{code:"de-it",name:"SÃ¼dtirol"}],fr:[{code:"fr-ch",name:"Suisse"},{code:"fr-fr",name:"France"},{code:"fr-be",name:"Belgique"},{code:"fr-ca",name:"QuÃ©bec"},{code:"fr-af",name:"Afrique"}],it:[{code:"it-ch",name:"Svizzera"},{code:"it-it",name:"Standard"},{code:"it-it-north",name:"Nord"},{code:"it-it-central",name:"Toscana"},{code:"it-it-south",name:"Sud"},{code:"it-sm",name:"San Marino"}],en:[{code:"en-gb",name:"British"},{code:"en-us",name:"American"},{code:"en-ca",name:"Canadian"},{code:"en-au",name:"Australian"},{code:"en-ie",name:"Irish"},{code:"en-za",name:"South African"}],gsw:[{code:"gsw-zh",name:"ZÃ¼ritÃ¼Ã¼tsch"},{code:"gsw-be",name:"BÃ¤rndÃ¼tsch"},{code:"gsw-bs",name:"Baseldytsch"},{code:"gsw-lu",name:"LuzÃ¤rndÃ¼tsch"},{code:"gsw-sg",name:"SanggallerdÃ¼tsch"},{code:"gsw-vs",name:"WalliserdÃ¼tsch"},{code:"gsw-gr",name:"BÃ¼ndnerdÃ¼tsch"}]};function xa(r){return r.startsWith("gsw")?"gsw":r.startsWith("de")?"de":r.startsWith("fr")?"fr":r.startsWith("it")?"it":"en"}const yo=["spring","summer","autumn","winter"];function ji(){const r=new Date().getMonth();return r>=2&&r<=4?"spring":r>=5&&r<=7?"summer":r>=8&&r<=10?"autumn":"winter"}function vo({languageLevel:r,onLanguageLevelChange:l,pages:n,onPagesChange:y,storyLanguage:s,onStoryLanguageChange:C,developerMode:x,userLocation:A,onLocationChange:P,season:m,onSeasonChange:T,userCredits:S}){const{t:D,language:v}=Ot(),[V,d]=o.useState(!1),[G,F]=o.useState((A==null?void 0:A.city)||""),[ne,L]=o.useState((A==null?void 0:A.country)||""),[Z,E]=o.useState(!1),te=o.useRef(null);o.useEffect(()=>{const _=Ae=>{te.current&&!te.current.contains(Ae.target)&&E(!1)};return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[]);const Y=o.useCallback(()=>{const _=xa(s),Ae=di.find(_e=>_e.family===_),tt=Os[_].find(_e=>_e.code===s)||Os[_][0];return Ae&&tt?`${Ae.name} (${tt.name})`:(Ae==null?void 0:Ae.name)||s},[s]);o.useEffect(()=>{A&&(F(A.city||""),L(A.country||""))},[A]);const Q=()=>{P({city:G||null,region:null,country:ne||null}),d(!1)},$={spring:{de:"FrÃ¼hling",fr:"Printemps",en:"Spring"},summer:{de:"Sommer",fr:"Ã‰tÃ©",en:"Summer"},autumn:{de:"Herbst",fr:"Automne",en:"Autumn"},winter:{de:"Winter",fr:"Hiver",en:"Winter"}},re=x?4:10,pe=50,fe=2,ye=10,le=S===-1,Se=le?pe:Math.floor(S/ye),Ee=Math.floor(Se/2)*2,Be=re*ye,X=!le&&S<Be,Ve=Be-S,Ce=X?re:Math.min(pe,Math.max(re,Ee)),Ue=!le&&Ee<pe;o.useEffect(()=>{let _=n;_%2!==0&&(_=Math.round(_/2)*2),_=Math.max(re,Math.min(Ce,_)),_!==n&&y(_)},[n,re,Ce,y]);const ue=[{value:"1st-grade",label:D.firstGrade,desc:D.firstGradeDesc,image:"/images/text and image on each page.jpg"},{value:"standard",label:D.standard,desc:D.standardDesc,image:"/images/left page text, right page image.jpg"},{value:"advanced",label:D.advanced,desc:D.advancedDesc,image:"/images/dense text left.jpg"}],ge=(_,Ae=!1)=>{const tt=Ae?" (Test)":"",_e=_*10,ht=v==="de"?"Credits":v==="fr"?"crÃ©dits":"credits";if(r==="1st-grade")return`${_} ${v==="de"?"Seiten":"pages"} = ${_e} ${ht}${tt}`;const vt=Math.floor(_/2),Yt=Math.floor(_/2);return v==="de"?`${_} Seiten (${vt} Text + ${Yt} Bilder) = ${_e} ${ht}${tt}`:v==="fr"?`${_} pages (${vt} texte + ${Yt} images) = ${_e} ${ht}${tt}`:`${_} pages (${vt} text + ${Yt} images) = ${_e} ${ht}${tt}`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Hs,{size:24}),v==="de"?"Buchformat":v==="fr"?"Format du livre":"Book Format"]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:v==="de"?"Sprache:":v==="fr"?"Langue:":"Language:"}),e.jsxs("div",{className:"relative",ref:te,children:[e.jsxs("button",{type:"button",onClick:()=>E(!Z),className:"px-3 py-1.5 border border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-sm font-medium bg-white cursor-pointer pr-8 flex items-center gap-1 min-w-[160px]",children:[Y(),e.jsx(Zt,{size:16,className:`absolute right-2 text-gray-400 transition-transform ${Z?"rotate-180":""}`})]}),Z&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 min-w-[180px] py-1",children:[di.map(_=>{const Ae=xa(s)===_.family;return e.jsx("button",{type:"button",onClick:()=>{const tt=Os[_.family][0];C(tt.code)},className:`w-full text-left px-3 py-1.5 text-sm hover:bg-indigo-50 ${Ae?"font-semibold text-indigo-600":"text-gray-700"}`,children:_.name},_.family)}),e.jsx("div",{className:"border-t border-gray-300 my-1"}),Os[xa(s)].map(_=>e.jsx("button",{type:"button",onClick:()=>{C(_.code),E(!1)},className:`w-full text-left px-3 py-1.5 text-sm hover:bg-indigo-50 ${s===_.code?"bg-indigo-100 text-indigo-700 font-medium":"text-gray-700"}`,children:_.name},_.code))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Un,{className:"text-gray-500",size:16}),e.jsx("span",{className:"text-sm text-gray-600",children:v==="de"?"Ort:":v==="fr"?"Lieu:":"Location:"}),V?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"text",value:G,onChange:_=>F(_.target.value),placeholder:v==="de"?"Stadt":v==="fr"?"Ville":"City",className:"px-2 py-1 border border-gray-300 rounded text-base w-24 focus:outline-none focus:border-indigo-500"}),e.jsx("input",{type:"text",value:ne,onChange:_=>L(_.target.value),placeholder:v==="de"?"Land":v==="fr"?"Pays":"Country",className:"px-2 py-1 border border-gray-300 rounded text-base w-24 focus:outline-none focus:border-indigo-500"}),e.jsx("button",{onClick:Q,className:"px-2 py-1 bg-indigo-600 text-white text-xs rounded hover:bg-indigo-700",children:"OK"}),e.jsx("button",{onClick:()=>d(!1),className:"px-1 text-gray-500 text-xs hover:text-gray-700",children:"âœ•"})]}):e.jsx("button",{onClick:()=>d(!0),className:"text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline",children:A!=null&&A.city?`${A.city}${A.country?`, ${A.country}`:""}`:v==="de"?"Festlegen":v==="fr"?"DÃ©finir":"Set"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:v==="de"?"Jahreszeit:":v==="fr"?"Saison:":"Season:"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:m,onChange:_=>T(_.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-sm font-medium appearance-none bg-white cursor-pointer pr-8",children:yo.map(_=>e.jsx("option",{value:_,children:$[_][v]||$[_].en},_))}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:D.readingLevel}),e.jsx("div",{className:"flex overflow-x-auto gap-3 pb-2 md:grid md:grid-cols-3 md:gap-4 md:overflow-visible md:pb-0 -mx-4 px-4 md:mx-0 md:px-0",children:ue.map(_=>e.jsxs("button",{onClick:()=>l(_.value),className:`flex-shrink-0 w-56 md:w-auto text-left rounded-lg border-2 transition-all overflow-hidden ${r===_.value?"border-indigo-600 ring-2 ring-indigo-200":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"w-full bg-gray-100 p-2 h-48 md:h-56",children:e.jsx("img",{src:_.image,alt:_.label,className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"p-2 md:p-2.5",children:[e.jsx("div",{className:"font-semibold text-sm mb-0.5",children:_.label}),e.jsx("div",{className:"text-xs text-gray-500 whitespace-pre-line",children:_.desc})]})]},_.value))})]}),r&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:D.numberOfPages}),X?e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-red-700 font-semibold mb-2",children:v==="de"?"Nicht genÃ¼gend Credits":v==="fr"?"CrÃ©dits insuffisants":"Not enough credits"}),e.jsx("p",{className:"text-red-600 text-sm",children:v==="de"?`Du benÃ¶tigst mindestens ${Be} Credits fÃ¼r eine Geschichte mit ${re} Seiten. Dir fehlen noch ${Ve} Credits.`:v==="fr"?`Vous avez besoin d'au moins ${Be} crÃ©dits pour une histoire de ${re} pages. Il vous manque ${Ve} crÃ©dits.`:`You need at least ${Be} credits for a ${re}-page story. You need ${Ve} more credits.`}),e.jsx("p",{className:"text-gray-500 text-xs mt-2",children:v==="de"?`Aktuell: ${S} Credits`:v==="fr"?`Actuel: ${S} crÃ©dits`:`Current: ${S} credits`})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"range",min:re,max:Ce,step:fe,value:Math.min(n,Ce),onChange:_=>y(parseInt(_.target.value)),className:`w-full h-3 bg-indigo-100 rounded-lg appearance-none cursor-pointer accent-indigo-600 touch-none
                           [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-6 [&::-webkit-slider-thumb]:h-6
                           [&::-webkit-slider-thumb]:bg-indigo-600 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer
                           [&::-webkit-slider-thumb]:shadow-md [&::-webkit-slider-thumb]:hover:bg-indigo-700
                           [&::-moz-range-thumb]:w-6 [&::-moz-range-thumb]:h-6 [&::-moz-range-thumb]:bg-indigo-600
                           [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:cursor-pointer [&::-moz-range-thumb]:border-0`}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:re}),e.jsxs("span",{className:"text-xl font-bold text-indigo-600",children:[n," ",v==="de"?"Seiten":"pages"]}),e.jsxs("span",{className:`text-sm ${Ue?"text-orange-500 font-medium":"text-gray-400"}`,children:[Ce,Ue&&" âš ï¸"]})]}),Ue&&e.jsx("div",{className:"text-center text-sm text-orange-600 bg-orange-50 rounded-lg py-2 px-3",children:v==="de"?`Max. ${Ce} Seiten mit ${S} Credits mÃ¶glich`:v==="fr"?`Max. ${Ce} pages possibles avec ${S} crÃ©dits`:`Max. ${Ce} pages possible with ${S} credits`}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-base font-medium text-gray-700",children:ge(n,n===4)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:r==="1st-grade"?v==="de"?"Jede Seite enthÃ¤lt ein Bild mit Text darunter":v==="fr"?"Chaque page contient une image avec du texte en dessous":"Each page contains an image with text below":v==="de"?"Abwechselnd Textseite und Bildseite":v==="fr"?"Alternance de pages de texte et d'images":"Alternating text page and image page"})]})]})]})]})}const jo=Object.freeze(Object.defineProperty({__proto__:null,WizardStep3BookSettings:vo,getCurrentSeason:ji},Symbol.toStringTag,{value:"Module"})),ci={en:{title:"Check Your Email",description:"We've sent you a verification link. Your story will start generating automatically once you verify your email!",currentEmail:"Verification sent to",sendVerification:"Send Verification Email",resendVerification:"Resend Verification Email",emailSent:"Verification email sent! Please check your inbox.",changeEmail:"Wrong email? Change it",newEmail:"New email address",currentPassword:"Current password",confirmChange:"Change & Verify",cancel:"Cancel",emailChanged:"Email changed! Please check your new inbox for verification.",checkSpam:"Don't see it? Check your spam folder.",fillAllFields:"Please fill in all fields"},de:{title:"E-Mail prÃ¼fen",description:"Wir haben Ihnen einen BestÃ¤tigungslink gesendet. Ihre Geschichte wird automatisch erstellt, sobald Sie Ihre E-Mail bestÃ¤tigen!",currentEmail:"BestÃ¤tigung gesendet an",sendVerification:"BestÃ¤tigungs-E-Mail senden",resendVerification:"BestÃ¤tigungs-E-Mail erneut senden",emailSent:"BestÃ¤tigungs-E-Mail gesendet! Bitte prÃ¼fen Sie Ihren Posteingang.",changeEmail:"Falsche E-Mail? Ã„ndern",newEmail:"Neue E-Mail-Adresse",currentPassword:"Aktuelles Passwort",confirmChange:"Ã„ndern & BestÃ¤tigen",cancel:"Abbrechen",emailChanged:"E-Mail geÃ¤ndert! Bitte prÃ¼fen Sie Ihren neuen Posteingang fÃ¼r die BestÃ¤tigung.",checkSpam:"Nicht gefunden? PrÃ¼fen Sie Ihren Spam-Ordner.",fillAllFields:"Bitte alle Felder ausfÃ¼llen"},fr:{title:"Verifiez votre e-mail",description:"Nous vous avons envoye un lien de verification. Votre histoire sera generee automatiquement une fois votre e-mail verifie!",currentEmail:"Verification envoyee a",sendVerification:"Envoyer l'e-mail de verification",resendVerification:"Renvoyer l'e-mail de verification",emailSent:"E-mail de verification envoye! Veuillez verifier votre boite de reception.",changeEmail:"Mauvais e-mail? Changer",newEmail:"Nouvelle adresse e-mail",currentPassword:"Mot de passe actuel",confirmChange:"Changer & Verifier",cancel:"Annuler",emailChanged:"E-mail change! Veuillez verifier votre nouvelle boite de reception pour la verification.",checkSpam:"Pas trouve? Verifiez votre dossier spam.",fillAllFields:"Veuillez remplir tous les champs"}};function No({isOpen:r,onClose:l,onVerified:n}){const{language:y}=Ot(),{user:s,refreshUser:C}=va(),x=ci[y]||ci.en,[A,P]=o.useState("verify"),[m,T]=o.useState(!1),[S,D]=o.useState(!1),[v,V]=o.useState(""),[d,G]=o.useState(""),[F,ne]=o.useState(!1),[L,Z]=o.useState(0),[E,te]=o.useState(""),[Y,Q]=o.useState(""),$=o.useRef(null),re=o.useRef(null),pe=o.useRef(!1);if(o.useEffect(()=>(L>0&&(re.current=setTimeout(()=>{Z(le=>le-1)},1e3)),()=>{re.current&&clearTimeout(re.current)}),[L]),o.useEffect(()=>{if(r&&!pe.current&&!S){pe.current=!0;const le=setTimeout(async()=>{T(!0);try{const Se=await Ge.post("/api/auth/send-verification",{});D(!0),G(x.emailSent),Se.cooldown&&Z(Se.cooldown)}catch(Se){const Ee=Se;Ee.retryAfter?(Z(Ee.retryAfter),D(!0)):V(Ee.message||"Failed to send verification email")}finally{T(!1)}},300);return()=>clearTimeout(le)}r||(pe.current=!1)},[r,S,x.emailSent]),o.useEffect(()=>{if(!r){$.current&&(clearInterval($.current),$.current=null);return}return ne(!0),console.log("[EmailVerificationModal] Starting polling"),$.current=setInterval(async()=>{try{const le=await Ge.get("/api/auth/verification-status");console.log("[EmailVerificationModal] Poll result:",le.emailVerified),le.emailVerified&&(console.log("[EmailVerificationModal] Email verified! Refreshing user..."),await C(),console.log("[EmailVerificationModal] User refreshed, clearing interval"),$.current&&(clearInterval($.current),$.current=null),ne(!1),console.log("[EmailVerificationModal] Calling onVerified callback"),n==null||n(),console.log("[EmailVerificationModal] Calling onClose"),l())}catch(le){console.debug("Verification status poll error:",le)}},3e3),()=>{$.current&&(clearInterval($.current),$.current=null)}},[r,C,n,l]),!r)return null;const fe=async()=>{T(!0),V("");try{const le=await Ge.post("/api/auth/send-verification",{});D(!0),G(x.emailSent),le.cooldown&&Z(le.cooldown)}catch(le){const Se=le;Se.retryAfter?(Z(Se.retryAfter),V(y==="de"?`Bitte warten Sie ${Se.retryAfter} Sekunden`:y==="fr"?`Veuillez patienter ${Se.retryAfter} secondes`:`Please wait ${Se.retryAfter} seconds`)):V(Se.message||"Failed to send verification email")}finally{T(!1)}},ye=async()=>{if(!E||!Y){V(x.fillAllFields);return}T(!0),V("");try{await Ge.post("/api/auth/change-email",{newEmail:E,password:Y}),G(x.emailChanged),P("verify"),te(""),Q("")}catch(le){V(le instanceof Error?le.message:"Failed to change email")}finally{T(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-8 animate-fade-in relative",children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:e.jsx(Dt,{size:20})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(bi,{className:"w-8 h-8 text-indigo-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:x.title}),e.jsx("p",{className:"text-gray-500",children:x.description})]}),v&&e.jsx(Za,{variant:"error",className:"mb-4",children:v}),d&&e.jsxs(Za,{variant:"success",className:"mb-4",children:[d,e.jsx("p",{className:"text-sm mt-1 opacity-80",children:x.checkSpam})]}),F&&S&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-indigo-600 mb-4",children:[e.jsx(gt,{size:16,className:"animate-spin"}),e.jsx("span",{className:"text-sm",children:y==="de"?"Warte auf BestÃ¤tigung...":y==="fr"?"En attente de verification...":"Waiting for verification..."})]}),A==="verify"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:x.currentEmail}),e.jsx("p",{className:"font-medium text-gray-800",children:s==null?void 0:s.email})]}),e.jsxs(_s,{onClick:fe,variant:"primary",loading:m,disabled:L>0,className:"w-full",children:[e.jsx(Gt,{size:16,className:"mr-2"}),L>0?`${y==="de"?"Warten":y==="fr"?"Patienter":"Wait"} ${L}s`:S?x.resendVerification:x.sendVerification]}),e.jsxs("button",{onClick:()=>{P("change"),V(""),G("")},className:"w-full text-center text-indigo-600 font-semibold hover:text-indigo-800 flex items-center justify-center gap-2",children:[e.jsx(nt,{size:16}),x.changeEmail]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(Qa,{type:"email",label:x.newEmail,value:E,onChange:le=>te(le.target.value),placeholder:"your@newemail.com",disabled:m}),e.jsx(Qa,{type:"password",label:x.currentPassword,value:Y,onChange:le=>Q(le.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",disabled:m}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(_s,{onClick:()=>{P("verify"),V(""),te(""),Q("")},variant:"secondary",className:"flex-1",disabled:m,children:x.cancel}),e.jsx(_s,{onClick:ye,variant:"primary",loading:m,className:"flex-1",children:x.confirmChange})]})]})]})})}const Na=[{value:{en:"Best Friends with",de:"Beste Freunde mit",fr:"Meilleurs amis avec"},inverse:{en:"Best Friends with",de:"Beste Freunde mit",fr:"Meilleurs amis avec"}},{value:{en:"Friends with",de:"Freunde mit",fr:"Amis avec"},inverse:{en:"Friends with",de:"Freunde mit",fr:"Amis avec"}},{value:{en:"Married to",de:"Verheiratet mit",fr:"MariÃ©(e) Ã "},inverse:{en:"Married to",de:"Verheiratet mit",fr:"MariÃ©(e) Ã "}},{value:{en:"In a relationship with",de:"In einer Beziehung mit",fr:"En relation avec"},inverse:{en:"In a relationship with",de:"In einer Beziehung mit",fr:"En relation avec"}},{value:{en:"Older Sibling of",de:"Ã„lteres Geschwister von",fr:"FrÃ¨re/SÅ“ur aÃ®nÃ©(e) de"},inverse:{en:"Younger Sibling of",de:"JÃ¼ngeres Geschwister von",fr:"FrÃ¨re/SÅ“ur cadet(te) de"}},{value:{en:"Younger Sibling of",de:"JÃ¼ngeres Geschwister von",fr:"FrÃ¨re/SÅ“ur cadet(te) de"},inverse:{en:"Older Sibling of",de:"Ã„lteres Geschwister von",fr:"FrÃ¨re/SÅ“ur aÃ®nÃ©(e) de"}},{value:{en:"Parent of",de:"Elternteil von",fr:"Parent de"},inverse:{en:"Child of",de:"Kind von",fr:"Enfant de"}},{value:{en:"Child of",de:"Kind von",fr:"Enfant de"},inverse:{en:"Parent of",de:"Elternteil von",fr:"Parent de"}},{value:{en:"Rivals with",de:"Rivalen mit",fr:"Rivaux avec"},inverse:{en:"Rivals with",de:"Rivalen mit",fr:"Rivaux avec"}},{value:{en:"Neighbors with",de:"Nachbarn mit",fr:"Voisins avec"},inverse:{en:"Neighbors with",de:"Nachbarn mit",fr:"Voisins avec"}},{value:{en:"Not Known to",de:"Nicht bekannt mit",fr:"Pas connu de"},inverse:{en:"Not Known to",de:"Nicht bekannt mit",fr:"Pas connu de"}}];function wo(r){const l=Na.find(n=>n.value.en==="Not Known to");return l?l.value[r]:"Not Known to"}function mi(r){const l=Na.find(n=>n.value.en==="Not Known to");return l?r===l.value.en||r===l.value.de||r===l.value.fr:!1}function So(r,l,n=[]){for(const y of Na)if(y.value[l]===r)return y.inverse[l];for(const y of n){if(y.forward===r)return y.inverse;if(y.inverse===r)return y.forward}return r}const Co=1440*60*1e3;function Ws(r){const l=`avatar_regen_${r}`,n=localStorage.getItem(l),y=Date.now();if(!n)return{canRegenerate:!0,waitSeconds:0,attempts:0};try{const{attempts:s,lastAttempt:C}=JSON.parse(n);if(y-C>Co)return localStorage.removeItem(l),{canRegenerate:!0,waitSeconds:0,attempts:0};let x=0;s>=2&&s<4?x=30*1e3:s>=4&&s<6?x=60*1e3:s>=6&&s<8?x=120*1e3:s>=8&&s<10?x=300*1e3:s>=10&&(x=600*1e3);const A=y-C;return A>=x?{canRegenerate:!0,waitSeconds:0,attempts:s}:{canRegenerate:!1,waitSeconds:Math.ceil((x-A)/1e3),attempts:s}}catch{return{canRegenerate:!0,waitSeconds:0,attempts:0}}}function Ni(r){const l=`avatar_regen_${r}`,n=localStorage.getItem(l),y=Date.now();let s=1;if(n)try{s=(JSON.parse(n).attempts||0)+1}catch{}localStorage.setItem(l,JSON.stringify({attempts:s,lastAttempt:y}))}function rl(r){const[l,n]=o.useState(()=>Ws(r));o.useEffect(()=>{if(l.waitSeconds>0){const s=setInterval(()=>{n(Ws(r))},1e3);return()=>clearInterval(s)}},[l.waitSeconds,r]);const y=o.useCallback(()=>{Ni(r),n(Ws(r))},[r]);return{...l,recordRegeneration:y}}const ui={en:{title:"Multiple Faces Detected",description:"We detected multiple people in your photo. Please select which face belongs to the character you want to create.",selectFace:"Select Face",uploadDifferent:"Upload Different Photo",confidence:"Confidence"},de:{title:"Mehrere Gesichter erkannt",description:"Wir haben mehrere Personen in Ihrem Foto erkannt. Bitte wÃ¤hlen Sie aus, welches Gesicht zu dem Charakter gehÃ¶rt, den Sie erstellen mÃ¶chten.",selectFace:"Gesicht auswÃ¤hlen",uploadDifferent:"Anderes Foto hochladen",confidence:"Konfidenz"},fr:{title:"Plusieurs visages dÃ©tectÃ©s",description:"Nous avons dÃ©tectÃ© plusieurs personnes sur votre photo. Veuillez sÃ©lectionner le visage du personnage que vous souhaitez crÃ©er.",selectFace:"SÃ©lectionner le visage",uploadDifferent:"TÃ©lÃ©charger une autre photo",confidence:"Confiance"}};function ko({isOpen:r,faces:l,onSelect:n,onUploadNew:y,developerMode:s=!1}){const{language:C}=Ot(),x=ui[C]||ui.en;return e.jsx(Bn,{isOpen:r,onClose:y,title:x.title,size:"lg",showCloseButton:!1,closeOnOverlayClick:!1,closeOnEscape:!1,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-gray-600 text-center",children:x.description}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:l.map((A,P)=>e.jsxs("button",{onClick:()=>n(A.id),className:`group relative bg-white border-2 border-gray-200 rounded-xl p-3
                hover:border-indigo-400 hover:shadow-lg transition-all duration-200
                focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2`,children:[e.jsx("div",{className:"aspect-square overflow-hidden rounded-lg mb-3",children:e.jsx("img",{draggable:!1,src:A.thumbnail,alt:`Face ${P+1}`,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"})}),e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"text-sm font-semibold text-indigo-600 group-hover:text-indigo-700",children:[x.selectFace," ",P+1]})}),s&&e.jsxs("div",{className:"absolute top-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded",children:[x.confidence,": ",Math.round(A.confidence*100),"%"]})]},A.id))}),e.jsx("div",{className:"pt-4 border-t border-gray-100",children:e.jsxs("button",{onClick:y,className:`w-full flex items-center justify-center gap-2 px-4 py-3
              bg-gray-100 text-gray-700 rounded-lg font-medium
              hover:bg-gray-200 transition-colors`,children:[e.jsx(Zn,{size:20}),x.uploadDifferent]})})]})})}const sl=[{id:"adventure",name:{en:"Adventure",de:"Abenteuer",fr:"Aventure"},description:{en:"Exciting journeys and heroic quests",de:"Spannende Reisen und heldenhafte Abenteuer",fr:"Voyages passionnants et quÃªtes hÃ©roÃ¯ques"},emoji:"ðŸ—¡ï¸"},{id:"life-challenge",name:{en:"Life Skills",de:"Lebenskompetenzen",fr:"CompÃ©tences de vie"},description:{en:"Help overcome everyday challenges",de:"Hilfe bei alltÃ¤glichen Herausforderungen",fr:"Aide pour surmonter les dÃ©fis quotidiens"},emoji:"ðŸ’ª"},{id:"educational",name:{en:"Learning",de:"Lernen",fr:"Apprentissage"},description:{en:"Fun stories that teach something new",de:"Lustige Geschichten, die etwas Neues lehren",fr:"Histoires amusantes qui enseignent quelque chose de nouveau"},emoji:"ðŸ“š"},{id:"historical",name:{en:"History",de:"Geschichte",fr:"Histoire"},description:{en:"Experience real historical events",de:"Erlebe echte historische Ereignisse",fr:"Vivez de vrais Ã©vÃ©nements historiques"},emoji:"ðŸ›ï¸"},{id:"custom",name:{en:"Create Your Own",de:"Eigenes Thema",fr:"CrÃ©er le vÃ´tre"},description:{en:"Describe your own unique story idea",de:"Beschreibe deine eigene Geschichte",fr:"DÃ©cris ta propre idÃ©e d'histoire"},emoji:"âœ¨"}],Ao=["pirate","knight","cowboy","ninja","wizard","dragon","superhero","detective","easter"],al=[{id:"popular",name:{en:"Popular",de:"Beliebt",fr:"Populaires"}},{id:"historical",name:{en:"Historical Times",de:"Historische Zeiten",fr:"Ã‰poques historiques"}},{id:"fantasy",name:{en:"Fantasy & Magic",de:"Fantasie & Magie",fr:"Fantaisie & Magie"}},{id:"locations",name:{en:"Exploration",de:"Entdeckung",fr:"Exploration"}},{id:"professions",name:{en:"Heroes & Helpers",de:"Helden & Helfer",fr:"HÃ©ros & Aides"}},{id:"seasonal",name:{en:"Seasonal",de:"Jahreszeiten",fr:"Saisonnier"}},{id:"custom",name:{en:"Custom",de:"Eigenes Thema",fr:"PersonnalisÃ©"}}],ba=[{id:"pirate",name:{en:"Pirate Adventure",de:"Piraten-Abenteuer",fr:"Aventure de Pirates"},emoji:"ðŸ´â€â˜ ï¸",group:"historical"},{id:"knight",name:{en:"Knights & Princess",de:"Ritter & Prinzessin",fr:"Chevaliers & Princesse"},emoji:"âš”ï¸",group:"historical"},{id:"cowboy",name:{en:"Cowboys & Indians",de:"Cowboys und Indianer",fr:"Cowboys et Indiens"},emoji:"ðŸ¤ ",group:"historical"},{id:"ninja",name:{en:"Secret Ninja",de:"Geheimer Ninja",fr:"Ninja Secret"},emoji:"ðŸ¥·",group:"historical"},{id:"viking",name:{en:"Viking Adventure",de:"Wikinger-Abenteuer",fr:"Aventure Viking"},emoji:"âš“",group:"historical"},{id:"roman",name:{en:"Ancient Rome",de:"Antikes Rom",fr:"Rome Antique"},emoji:"ðŸ›ï¸",group:"historical"},{id:"egyptian",name:{en:"Ancient Egypt",de:"Altes Ã„gypten",fr:"Ã‰gypte Ancienne"},emoji:"ðŸº",group:"historical"},{id:"greek",name:{en:"Ancient Greece",de:"Antikes Griechenland",fr:"GrÃ¨ce Antique"},emoji:"ðŸº",group:"historical"},{id:"caveman",name:{en:"Stone Age",de:"Steinzeit",fr:"Ã‚ge de Pierre"},emoji:"ðŸ¦´",group:"historical"},{id:"samurai",name:{en:"Samurai Adventure",de:"Samurai-Abenteuer",fr:"Aventure SamouraÃ¯"},emoji:"ðŸŽŒ",group:"historical"},{id:"wizard",name:{en:"Wizard & Witch",de:"Zauberer & Hexe",fr:"Sorcier & SorciÃ¨re"},emoji:"ðŸ§™",group:"fantasy"},{id:"dragon",name:{en:"Dragon Quest",de:"Drachen-Abenteuer",fr:"QuÃªte du Dragon"},emoji:"ðŸ‰",group:"fantasy"},{id:"unicorn",name:{en:"Magical Unicorn",de:"Magisches Einhorn",fr:"Licorne Magique"},emoji:"ðŸ¦„",group:"fantasy"},{id:"mermaid",name:{en:"Mermaid Adventure",de:"Meerjungfrauen-Abenteuer",fr:"Aventure de SirÃ¨ne"},emoji:"ðŸ§œâ€â™€ï¸",group:"fantasy"},{id:"dinosaur",name:{en:"Dinosaur World",de:"Dinosaurier-Welt",fr:"Monde des Dinosaures"},emoji:"ðŸ¦–",group:"fantasy"},{id:"superhero",name:{en:"Superhero",de:"Superheld",fr:"Super-hÃ©ros"},emoji:"ðŸ¦¸",group:"fantasy"},{id:"space",name:{en:"Space Explorer",de:"Weltraum-Entdecker",fr:"Explorateur Spatial"},emoji:"ðŸš€",group:"locations"},{id:"ocean",name:{en:"Ocean Explorer",de:"Ozean-Entdecker",fr:"Explorateur des OcÃ©ans"},emoji:"ðŸŒŠ",group:"locations"},{id:"jungle",name:{en:"Jungle Safari",de:"Dschungel-Safari",fr:"Safari dans la Jungle"},emoji:"ðŸŒ´",group:"locations"},{id:"farm",name:{en:"Farm Life",de:"Bauernhof-Leben",fr:"Vie Ã  la Ferme"},emoji:"ðŸ„",group:"locations"},{id:"forest",name:{en:"Forest Friends",de:"Waldfreunde",fr:"Amis de la ForÃªt"},emoji:"ðŸ¦Š",group:"locations"},{id:"fireman",name:{en:"Brave Firefighter",de:"Tapferer Feuerwehrmann",fr:"Pompier Courageux"},emoji:"ðŸš’",group:"professions"},{id:"doctor",name:{en:"Helpful Doctor",de:"Hilfreicher Arzt",fr:"Docteur Serviable"},emoji:"ðŸ‘¨â€âš•ï¸",group:"professions"},{id:"police",name:{en:"Police Officer",de:"Polizist",fr:"Policier"},emoji:"ðŸ‘®",group:"professions"},{id:"detective",name:{en:"Detective Mystery",de:"Detektiv-Geheimnis",fr:"MystÃ¨re DÃ©tective"},emoji:"ðŸ”",group:"professions"},{id:"christmas",name:{en:"Christmas Story",de:"Weihnachts-Geschichte",fr:"Histoire de NoÃ«l"},emoji:"ðŸŽ„",group:"seasonal"},{id:"newyear",name:{en:"New Year Story",de:"Neujahrs-Geschichte",fr:"Histoire du Nouvel An"},emoji:"ðŸŽ†",group:"seasonal"},{id:"easter",name:{en:"Easter Story",de:"Oster-Geschichte",fr:"Histoire de PÃ¢ques"},emoji:"ðŸ°",group:"seasonal"},{id:"halloween",name:{en:"Halloween Story",de:"Halloween-Geschichte",fr:"Histoire d'Halloween"},emoji:"ðŸŽƒ",group:"seasonal"},{id:"custom",name:{en:"Create Your Own",de:"Eigenes Thema",fr:"CrÃ©er le vÃ´tre"},emoji:"âœ¨",group:"custom"}],il={name:{en:"Everyday Life",de:"Alltag",fr:"Vie Quotidienne"},emoji:"ðŸ "},gi=[{id:"potty-training",name:{en:"Potty Training",de:"TÃ¶pfchen-Training",fr:"Apprentissage du pot"},emoji:"ðŸš½",ageGroup:"toddler"},{id:"washing-hands",name:{en:"Washing Hands",de:"HÃ¤nde waschen",fr:"Se laver les mains"},emoji:"ðŸ§¼",ageGroup:"toddler"},{id:"brushing-teeth",name:{en:"Brushing Teeth",de:"ZÃ¤hne putzen",fr:"Se brosser les dents"},emoji:"ðŸª¥",ageGroup:"toddler"},{id:"eating-vegetables",name:{en:"Eating Vegetables",de:"GemÃ¼se essen",fr:"Manger des lÃ©gumes"},emoji:"ðŸ¥¦",ageGroup:"toddler"},{id:"going-to-bed",name:{en:"Going to Bed",de:"Ins Bett gehen",fr:"Aller au lit"},emoji:"ðŸ›ï¸",ageGroup:"toddler"},{id:"saying-goodbye",name:{en:"Saying Goodbye",de:"Abschied nehmen",fr:"Dire au revoir"},emoji:"ðŸ‘‹",ageGroup:"toddler"},{id:"no-pacifier",name:{en:"No More Pacifier",de:"Ohne Schnuller",fr:"Plus de tÃ©tine"},emoji:"ðŸ¼",ageGroup:"toddler"},{id:"cleaning-up",name:{en:"Cleaning Up Toys",de:"AufrÃ¤umen",fr:"Ranger les jouets"},emoji:"ðŸ§¹",ageGroup:"preschool"},{id:"sitting-still",name:{en:"Sitting Still",de:"Still sitzen",fr:"Rester tranquille"},emoji:"ðŸª‘",ageGroup:"preschool"},{id:"sharing",name:{en:"Learning to Share",de:"Teilen lernen",fr:"Apprendre Ã  partager"},emoji:"ðŸ¤",ageGroup:"preschool"},{id:"waiting-turn",name:{en:"Waiting Your Turn",de:"Warten kÃ¶nnen",fr:"Attendre son tour"},emoji:"â³",ageGroup:"preschool"},{id:"first-kindergarten",name:{en:"First Day of Kindergarten",de:"Erster Kindergartentag",fr:"Premier jour de maternelle"},emoji:"ðŸŽ’",ageGroup:"preschool"},{id:"making-friends",name:{en:"Making Friends",de:"Freunde finden",fr:"Se faire des amis"},emoji:"ðŸ‘«",ageGroup:"preschool"},{id:"being-brave",name:{en:"Being Brave",de:"Mutig sein",fr:"ÃŠtre courageux"},emoji:"ðŸ’ª",ageGroup:"preschool"},{id:"new-sibling",name:{en:"New Baby Sibling",de:"Neues Geschwisterchen",fr:"Nouveau bÃ©bÃ© dans la famille"},emoji:"ðŸ‘¶",ageGroup:"preschool"},{id:"first-school",name:{en:"First Day of School",de:"Erster Schultag",fr:"Premier jour d'Ã©cole"},emoji:"ðŸ«",ageGroup:"early-school"},{id:"homework",name:{en:"Doing Homework",de:"Hausaufgaben machen",fr:"Faire ses devoirs"},emoji:"ðŸ“",ageGroup:"early-school"},{id:"reading-alone",name:{en:"Learning to Read",de:"Lesen lernen",fr:"Apprendre Ã  lire"},emoji:"ðŸ“–",ageGroup:"early-school"},{id:"losing-game",name:{en:"Losing a Game",de:"Verlieren kÃ¶nnen",fr:"Savoir perdre"},emoji:"ðŸŽ¯",ageGroup:"early-school"},{id:"being-different",name:{en:"Being Different is OK",de:"Anders sein ist OK",fr:"ÃŠtre diffÃ©rent c'est bien"},emoji:"ðŸŒˆ",ageGroup:"early-school"},{id:"dealing-bully",name:{en:"Dealing with Bullies",de:"Mit HÃ¤nseleien umgehen",fr:"Faire face aux moqueries"},emoji:"ðŸ›¡ï¸",ageGroup:"early-school"},{id:"telling-truth",name:{en:"Telling the Truth",de:"Die Wahrheit sagen",fr:"Dire la vÃ©ritÃ©"},emoji:"âœ…",ageGroup:"early-school"},{id:"trying-new-things",name:{en:"Trying New Things",de:"Neues ausprobieren",fr:"Essayer de nouvelles choses"},emoji:"ðŸŒŸ",ageGroup:"early-school"},{id:"moving-house",name:{en:"Moving to a New Home",de:"Umzug",fr:"DÃ©mÃ©nagement"},emoji:"ðŸ ",ageGroup:"family"},{id:"going-vacation",name:{en:"Going on Vacation",de:"In den Urlaub fahren",fr:"Partir en vacances"},emoji:"âœˆï¸",ageGroup:"family"},{id:"parents-splitting",name:{en:"Parents Living Apart",de:"Eltern leben getrennt",fr:"Parents sÃ©parÃ©s"},emoji:"ðŸ’”",ageGroup:"family"},{id:"visiting-doctor",name:{en:"Going to the Doctor",de:"Arztbesuch",fr:"Visite chez le mÃ©decin"},emoji:"ðŸ¥",ageGroup:"family"},{id:"staying-hospital",name:{en:"Staying in Hospital",de:"Im Krankenhaus",fr:"SÃ©jour Ã  l'hÃ´pital"},emoji:"ðŸ©º",ageGroup:"family"},{id:"death-pet",name:{en:"Losing a Pet",de:"Haustier verlieren",fr:"Perte d'un animal"},emoji:"ðŸŒˆ",ageGroup:"family"},{id:"grandparent-sick",name:{en:"Grandparent is Sick",de:"Grosseltern sind krank",fr:"Grand-parent malade"},emoji:"â¤ï¸",ageGroup:"family"},{id:"money-saving",name:{en:"Saving Money",de:"Geld sparen",fr:"Ã‰conomiser de l'argent"},emoji:"ðŸ’°",ageGroup:"preteen"},{id:"spending-wisely",name:{en:"Spending Wisely",de:"Klug ausgeben",fr:"DÃ©penser intelligemment"},emoji:"ðŸ›’",ageGroup:"preteen"},{id:"screen-time",name:{en:"Screen Time Balance",de:"Bildschirmzeit-Balance",fr:"Ã‰quilibre du temps d'Ã©cran"},emoji:"ðŸ“±",ageGroup:"preteen"},{id:"peer-pressure",name:{en:"Peer Pressure",de:"Gruppenzwang",fr:"Pression des pairs"},emoji:"ðŸ‘¥",ageGroup:"preteen"},{id:"body-changes",name:{en:"Body Changes",de:"KÃ¶rperliche VerÃ¤nderungen",fr:"Changements corporels"},emoji:"ðŸŒ±",ageGroup:"preteen"},{id:"responsibility",name:{en:"Taking Responsibility",de:"Verantwortung Ã¼bernehmen",fr:"Prendre ses responsabilitÃ©s"},emoji:"ðŸŽ¯",ageGroup:"preteen"},{id:"managing-time",name:{en:"Managing Time",de:"Zeitmanagement",fr:"Gestion du temps"},emoji:"â°",ageGroup:"preteen"},{id:"online-safety",name:{en:"Online Safety",de:"Sicherheit im Internet",fr:"SÃ©curitÃ© en ligne"},emoji:"ðŸ”’",ageGroup:"preteen"}],Po=["going-to-bed","cleaning-up","first-kindergarten","first-school","losing-game","dealing-bully","telling-truth","spending-wisely","moving-house","screen-time"],nl=[{id:"popular",name:{en:"Popular",de:"Beliebt",fr:"Populaires"},ageRange:"all"},{id:"family",name:{en:"Family Changes",de:"Familien-VerÃ¤nderungen",fr:"Changements familiaux"},ageRange:"all"},{id:"toddler",name:{en:"Toddler (2-4)",de:"Kleinkind (2-4)",fr:"Tout-petit (2-4)"},ageRange:"2-4"},{id:"preschool",name:{en:"Preschool (4-6)",de:"Vorschule (4-6)",fr:"PrÃ©scolaire (4-6)"},ageRange:"4-6"},{id:"early-school",name:{en:"Early School (6-9)",de:"Grundschule (6-9)",fr:"Ã‰cole primaire (6-9)"},ageRange:"6-9"},{id:"preteen",name:{en:"Pre-Teen (9-12)",de:"VorpubertÃ¤t (9-12)",fr:"PrÃ©adolescent (9-12)"},ageRange:"9-12"}],hi=[{id:"alphabet",name:{en:"The Alphabet (ABC)",de:"Das Alphabet (ABC)",fr:"L'Alphabet (ABC)"},emoji:"ðŸ”¤",group:"letters"},{id:"vowels",name:{en:"Vowels (A, E, I, O, U)",de:"Vokale (A, E, I, O, U)",fr:"Voyelles (A, E, I, O, U)"},emoji:"ðŸ…°ï¸",group:"letters"},{id:"rhyming",name:{en:"Rhyming Words",de:"ReimwÃ¶rter",fr:"Mots qui riment"},emoji:"ðŸŽµ",group:"letters"},{id:"numbers-1-10",name:{en:"Numbers 1-10",de:"Zahlen 1-10",fr:"Nombres 1-10"},emoji:"ðŸ”¢",group:"numbers"},{id:"numbers-1-20",name:{en:"Numbers 1-20",de:"Zahlen 1-20",fr:"Nombres 1-20"},emoji:"ðŸ”¢",group:"numbers"},{id:"counting",name:{en:"Learning to Count",de:"ZÃ¤hlen lernen",fr:"Apprendre Ã  compter"},emoji:"âœ‹",group:"numbers"},{id:"shapes",name:{en:"Shapes",de:"Formen",fr:"Formes"},emoji:"ðŸ”·",group:"numbers"},{id:"addition",name:{en:"Simple Addition",de:"Einfaches Addieren",fr:"Addition simple"},emoji:"âž•",group:"numbers"},{id:"colors-basic",name:{en:"Basic Colors",de:"Grundfarben",fr:"Couleurs de base"},emoji:"ðŸŒˆ",group:"colors"},{id:"colors-mixing",name:{en:"Mixing Colors",de:"Farben mischen",fr:"MÃ©langer les couleurs"},emoji:"ðŸŽ¨",group:"colors"},{id:"planets",name:{en:"Planets & Space",de:"Planeten & Weltraum",fr:"PlanÃ¨tes & Espace"},emoji:"ðŸª",group:"science"},{id:"seasons",name:{en:"The Four Seasons",de:"Die vier Jahreszeiten",fr:"Les quatre saisons"},emoji:"ðŸ‚",group:"science"},{id:"weather",name:{en:"Weather",de:"Wetter",fr:"MÃ©tÃ©o"},emoji:"â›…",group:"science"},{id:"water-cycle",name:{en:"Water Cycle",de:"Wasserkreislauf",fr:"Cycle de l'eau"},emoji:"ðŸ’§",group:"science"},{id:"plants-grow",name:{en:"How Plants Grow",de:"Wie Pflanzen wachsen",fr:"Comment poussent les plantes"},emoji:"ðŸŒ±",group:"science"},{id:"day-night",name:{en:"Day and Night",de:"Tag und Nacht",fr:"Jour et nuit"},emoji:"ðŸŒ™",group:"science"},{id:"farm-animals",name:{en:"Farm Animals",de:"Bauernhoftiere",fr:"Animaux de la ferme"},emoji:"ðŸ·",group:"animals"},{id:"wild-animals",name:{en:"Wild Animals",de:"Wilde Tiere",fr:"Animaux sauvages"},emoji:"ðŸ¦",group:"animals"},{id:"ocean-animals",name:{en:"Ocean Animals",de:"Meerestiere",fr:"Animaux marins"},emoji:"ðŸ‹",group:"animals"},{id:"insects",name:{en:"Insects & Bugs",de:"Insekten & KÃ¤fer",fr:"Insectes"},emoji:"ðŸ›",group:"animals"},{id:"dinosaurs",name:{en:"Dinosaurs",de:"Dinosaurier",fr:"Dinosaures"},emoji:"ðŸ¦•",group:"animals"},{id:"body-parts",name:{en:"Body Parts",de:"KÃ¶rperteile",fr:"Parties du corps"},emoji:"ðŸ«€",group:"body"},{id:"five-senses",name:{en:"The Five Senses",de:"Die fÃ¼nf Sinne",fr:"Les cinq sens"},emoji:"ðŸ‘ï¸",group:"body"},{id:"healthy-eating",name:{en:"Healthy Eating",de:"Gesund essen",fr:"Manger sainement"},emoji:"ðŸ¥—",group:"body"},{id:"days-week",name:{en:"Days of the Week",de:"Wochentage",fr:"Jours de la semaine"},emoji:"ðŸ“…",group:"time"},{id:"months-year",name:{en:"Months of the Year",de:"Monate des Jahres",fr:"Mois de l'annÃ©e"},emoji:"ðŸ—“ï¸",group:"time"},{id:"telling-time",name:{en:"Telling Time",de:"Uhr lesen",fr:"Lire l'heure"},emoji:"ðŸ•",group:"time"},{id:"continents",name:{en:"Continents",de:"Kontinente",fr:"Continents"},emoji:"ðŸŒ",group:"geography"},{id:"countries-flags",name:{en:"Countries & Flags",de:"LÃ¤nder & Flaggen",fr:"Pays & Drapeaux"},emoji:"ðŸ³ï¸",group:"geography"},{id:"instruments",name:{en:"Musical Instruments",de:"Musikinstrumente",fr:"Instruments de musique"},emoji:"ðŸŽ¸",group:"arts"},{id:"famous-artists",name:{en:"Famous Artists",de:"BerÃ¼hmte KÃ¼nstler",fr:"Artistes cÃ©lÃ¨bres"},emoji:"ðŸ–¼ï¸",group:"arts"}],To=["alphabet","numbers-1-10","rhyming","seasons","weather","water-cycle","farm-animals","five-senses","days-week","months-year"],ol=[{id:"popular",name:{en:"Popular",de:"Beliebt",fr:"Populaires"}},{id:"letters",name:{en:"Letters & Reading",de:"Buchstaben & Lesen",fr:"Lettres & Lecture"}},{id:"numbers",name:{en:"Numbers & Math",de:"Zahlen & Mathe",fr:"Nombres & Maths"}},{id:"colors",name:{en:"Colors",de:"Farben",fr:"Couleurs"}},{id:"science",name:{en:"Nature & Science",de:"Natur & Wissenschaft",fr:"Nature & Science"}},{id:"animals",name:{en:"Animals",de:"Tiere",fr:"Animaux"}},{id:"body",name:{en:"Body & Health",de:"KÃ¶rper & Gesundheit",fr:"Corps & SantÃ©"}},{id:"time",name:{en:"Time & Calendar",de:"Zeit & Kalender",fr:"Temps & Calendrier"}},{id:"geography",name:{en:"World & Geography",de:"Welt & Geografie",fr:"Monde & GÃ©ographie"}},{id:"arts",name:{en:"Music & Art",de:"Musik & Kunst",fr:"Musique & Art"}}],Io=["wilhelm-tell","gotthard-tunnel","moon-landing","columbus-voyage","wright-brothers","lindbergh-flight","galapagos-darwin","berlin-wall-fall","golden-gate"],ll=[{id:"popular",name:{en:"Popular",de:"Beliebt",fr:"Populaires"},icon:"â­"},{id:"swiss",name:{en:"Swiss History",de:"Schweizer Geschichte",fr:"Histoire Suisse"},icon:"ðŸ‡¨ðŸ‡­"},{id:"exploration",name:{en:"Exploration & Discovery",de:"Entdeckungen",fr:"Exploration & DÃ©couverte"},icon:"ðŸ§­"},{id:"science",name:{en:"Science & Medicine",de:"Wissenschaft & Medizin",fr:"Science & MÃ©decine"},icon:"ðŸ”¬"},{id:"invention",name:{en:"Inventions",de:"Erfindungen",fr:"Inventions"},icon:"ðŸ’¡"},{id:"rights",name:{en:"Human Rights & Freedom",de:"Menschenrechte & Freiheit",fr:"Droits humains & LibertÃ©"},icon:"âœŠ"},{id:"construction",name:{en:"Great Constructions",de:"Grosse Bauwerke",fr:"Grandes Constructions"},icon:"ðŸ—ï¸"},{id:"culture",name:{en:"Culture & Arts",de:"Kultur & Kunst",fr:"Culture & Arts"},icon:"ðŸŽ­"},{id:"archaeology",name:{en:"Archaeological Discoveries",de:"ArchÃ¤ologische Entdeckungen",fr:"DÃ©couvertes ArchÃ©ologiques"},icon:"ðŸº"}],xi=[{id:"swiss-founding",name:{en:"Founding of Switzerland (RÃ¼tlischwur)",de:"GrÃ¼ndung der Schweiz (RÃ¼tlischwur)",fr:"Fondation de la Suisse (Serment du GrÃ¼tli)"},shortName:{en:"RÃ¼tlischwur",de:"RÃ¼tlischwur",fr:"Serment du GrÃ¼tli"},emoji:"ðŸ¤",year:1291,category:"swiss"},{id:"wilhelm-tell",name:{en:"Wilhelm Tell and the Apple",de:"Wilhelm Tell und der Apfel",fr:"Guillaume Tell et la pomme"},shortName:{en:"Wilhelm Tell",de:"Wilhelm Tell",fr:"Guillaume Tell"},emoji:"ðŸ¹",year:1307,category:"swiss",mainPerson:"Wilhelm Tell"},{id:"battle-morgarten",name:{en:"Battle of Morgarten",de:"Schlacht am Morgarten",fr:"Bataille de Morgarten"},shortName:{en:"Morgarten",de:"Morgarten",fr:"Morgarten"},emoji:"âš”ï¸",year:1315,category:"swiss"},{id:"battle-sempach",name:{en:"Battle of Sempach (Winkelried)",de:"Schlacht bei Sempach (Winkelried)",fr:"Bataille de Sempach (Winkelried)"},shortName:{en:"Sempach",de:"Sempach",fr:"Sempach"},emoji:"ðŸ›¡ï¸",year:1386,category:"swiss",mainPerson:"Arnold von Winkelried"},{id:"swiss-reformation",name:{en:"Swiss Reformation (Zwingli)",de:"Schweizer Reformation (Zwingli)",fr:"RÃ©forme Suisse (Zwingli)"},shortName:{en:"Reformation",de:"Reformation",fr:"RÃ©forme"},emoji:"ðŸ“œ",year:1523,category:"swiss",mainPerson:"Huldrych Zwingli"},{id:"red-cross-founding",name:{en:"Henry Dunant Founds the Red Cross",de:"Henry Dunant grÃ¼ndet das Rote Kreuz",fr:"Henry Dunant fonde la Croix-Rouge"},shortName:{en:"Red Cross",de:"Rotes Kreuz",fr:"Croix-Rouge"},emoji:"â¤ï¸",year:1863,category:"swiss",mainPerson:"Henry Dunant"},{id:"general-dufour",name:{en:"General Dufour and Swiss Unity",de:"General Dufour und die Schweizer Einheit",fr:"GÃ©nÃ©ral Dufour et l'unitÃ© suisse"},shortName:{en:"General Dufour",de:"General Dufour",fr:"GÃ©nÃ©ral Dufour"},emoji:"ðŸŽ–ï¸",year:1847,category:"swiss",mainPerson:"Guillaume-Henri Dufour"},{id:"sonderbund-war",name:{en:"The Sonderbund War",de:"Der Sonderbundskrieg",fr:"La Guerre du Sonderbund"},shortName:{en:"Sonderbund",de:"Sonderbund",fr:"Sonderbund"},emoji:"ðŸ”ï¸",year:1847,category:"swiss"},{id:"swiss-constitution",name:{en:"Swiss Federal Constitution",de:"Schweizerische Bundesverfassung",fr:"Constitution fÃ©dÃ©rale suisse"},shortName:{en:"Constitution",de:"Bundesverfassung",fr:"Constitution"},emoji:"ðŸ“‹",year:1848,category:"swiss"},{id:"gotthard-tunnel",name:{en:"Building the Gotthard Tunnel",de:"Bau des Gotthardtunnels",fr:"Construction du tunnel du Gothard"},shortName:{en:"Gotthard Tunnel",de:"Gotthardtunnel Bau",fr:"Tunnel du Gothard"},emoji:"ðŸš‚",year:1882,category:"swiss"},{id:"swiss-ww1-neutrality",name:{en:"Swiss Neutrality in WWI",de:"Schweizer NeutralitÃ¤t im 1. Weltkrieg",fr:"NeutralitÃ© suisse pendant la PremiÃ¨re Guerre"},shortName:{en:"WWI Neutrality",de:"NeutralitÃ¤t 1. WK",fr:"NeutralitÃ© 1GM"},emoji:"ðŸ•Šï¸",year:1914,category:"swiss"},{id:"general-guisan",name:{en:"General Guisan and the RÃ¼tli Report",de:"General Guisan und der RÃ¼tlirapport",fr:"GÃ©nÃ©ral Guisan et le Rapport du GrÃ¼tli"},shortName:{en:"General Guisan",de:"General Guisan",fr:"GÃ©nÃ©ral Guisan"},emoji:"ðŸŽ–ï¸",year:1940,category:"swiss",mainPerson:"Henri Guisan"},{id:"swiss-ww2-neutrality",name:{en:"Switzerland in World War II",de:"Die Schweiz im 2. Weltkrieg",fr:"La Suisse pendant la Seconde Guerre"},shortName:{en:"WWII",de:"2. Weltkrieg",fr:"2Ã¨me GM"},emoji:"ðŸ”ï¸",year:1939,category:"swiss"},{id:"swiss-womens-vote",name:{en:"Swiss Women Win the Vote",de:"Schweizer Frauenstimmrecht",fr:"Droit de vote des femmes suisses"},shortName:{en:"Women's Vote",de:"Frauenstimmrecht",fr:"Vote des femmes"},emoji:"ðŸ—³ï¸",year:1971,category:"swiss"},{id:"moon-landing",name:{en:"First Moon Landing",de:"Erste Mondlandung",fr:"Premier pas sur la Lune"},shortName:{en:"Moon Landing",de:"Mondlandung",fr:"Alunissage"},emoji:"ðŸŒ™",year:1969,category:"exploration",mainPerson:"Neil Armstrong"},{id:"columbus-voyage",name:{en:"Columbus Reaches the Americas",de:"Kolumbus erreicht Amerika",fr:"Colomb atteint les AmÃ©riques"},shortName:{en:"Discovery of America",de:"Entdeckung Amerikas",fr:"DÃ©couverte de l'AmÃ©rique"},emoji:"â›µ",year:1492,category:"exploration",mainPerson:"Christopher Columbus"},{id:"wright-brothers",name:{en:"First Powered Flight",de:"Erster Motorflug",fr:"Premier vol motorisÃ©"},shortName:{en:"First Flight",de:"Erster Flug",fr:"Premier vol"},emoji:"âœˆï¸",year:1903,category:"exploration",mainPerson:"Wright Brothers"},{id:"lindbergh-flight",name:{en:"First Solo Atlantic Crossing",de:"Erster Atlantik-Soloflug",fr:"PremiÃ¨re traversÃ©e solitaire"},shortName:{en:"Atlantic Flight",de:"Atlantikflug",fr:"Vol Atlantique"},emoji:"ðŸ›©ï¸",year:1927,category:"exploration",mainPerson:"Charles Lindbergh"},{id:"everest-summit",name:{en:"First Everest Summit",de:"Erste Everest-Besteigung",fr:"Premier sommet de l'Everest"},shortName:{en:"Climbing Everest",de:"Everest-Besteigung",fr:"Ascension Everest"},emoji:"ðŸ”ï¸",year:1953,category:"exploration",mainPerson:"Edmund Hillary & Tenzing Norgay"},{id:"south-pole",name:{en:"First to the South Pole",de:"Erster am SÃ¼dpol",fr:"Premier au PÃ´le Sud"},shortName:{en:"South Pole",de:"SÃ¼dpol",fr:"PÃ´le Sud"},emoji:"â„ï¸",year:1911,category:"exploration",mainPerson:"Roald Amundsen"},{id:"magellan-circumnavigation",name:{en:"First Circumnavigation",de:"Erste Weltumsegelung",fr:"Premier tour du monde"},shortName:{en:"Around the World",de:"Weltumsegelung",fr:"Tour du monde"},emoji:"ðŸŒ",year:1522,category:"exploration",mainPerson:"Ferdinand Magellan"},{id:"mariana-trench",name:{en:"Deepest Ocean Dive",de:"Tiefster Meerstauchgang",fr:"PlongÃ©e la plus profonde"},shortName:{en:"Deep Sea Dive",de:"Tiefseetauchen",fr:"PlongÃ©e profonde"},emoji:"ðŸŒŠ",year:1960,category:"exploration",mainPerson:"Jacques Piccard"},{id:"electricity-discovery",name:{en:"Franklin's Kite Experiment",de:"Franklins Drachenexperiment",fr:"ExpÃ©rience du cerf-volant"},shortName:{en:"Electricity Discovery",de:"ElektrizitÃ¤t entdeckt",fr:"DÃ©couverte Ã©lectricitÃ©"},emoji:"âš¡",year:1752,category:"science",mainPerson:"Benjamin Franklin"},{id:"penicillin",name:{en:"Discovery of Penicillin",de:"Entdeckung des Penicillins",fr:"DÃ©couverte de la pÃ©nicilline"},shortName:{en:"Penicillin",de:"Penicillin",fr:"PÃ©nicilline"},emoji:"ðŸ’Š",year:1928,category:"science",mainPerson:"Alexander Fleming"},{id:"vaccine-discovery",name:{en:"First Vaccine",de:"Erste Impfung",fr:"Premier vaccin"},shortName:{en:"First Vaccine",de:"Erste Impfung",fr:"Premier vaccin"},emoji:"ðŸ’‰",year:1796,category:"science",mainPerson:"Edward Jenner"},{id:"dna-discovery",name:{en:"DNA Structure Discovered",de:"DNA-Struktur entdeckt",fr:"Structure ADN dÃ©couverte"},shortName:{en:"DNA Discovery",de:"DNA-Entdeckung",fr:"DÃ©couverte ADN"},emoji:"ðŸ§¬",year:1953,category:"science",mainPerson:"Watson & Crick"},{id:"dinosaur-discovery",name:{en:"First Dinosaur Named",de:"Erster Dinosaurier benannt",fr:"Premier dinosaure nommÃ©"},shortName:{en:"Dinosaur Discovery",de:"Dinosaurier-Entdeckung",fr:"DÃ©couverte dinosaure"},emoji:"ðŸ¦•",year:1824,category:"science",mainPerson:"William Buckland"},{id:"einstein-relativity",name:{en:"Einstein's Relativity",de:"Einsteins RelativitÃ¤tstheorie",fr:"RelativitÃ© d'Einstein"},shortName:{en:"Einstein's Theory",de:"Einsteins Theorie",fr:"ThÃ©orie d'Einstein"},emoji:"ðŸ§ ",year:1905,category:"science",mainPerson:"Albert Einstein"},{id:"galapagos-darwin",name:{en:"Darwin Visits GalÃ¡pagos",de:"Darwin auf GalÃ¡pagos",fr:"Darwin aux GalÃ¡pagos"},shortName:{en:"Darwin's Voyage",de:"Darwins Reise",fr:"Voyage de Darwin"},emoji:"ðŸ¢",year:1835,category:"science",mainPerson:"Charles Darwin"},{id:"first-heart-transplant",name:{en:"First Heart Transplant",de:"Erste Herztransplantation",fr:"PremiÃ¨re greffe cardiaque"},shortName:{en:"Heart Transplant",de:"Herztransplantation",fr:"Greffe cardiaque"},emoji:"â¤ï¸",year:1967,category:"science",mainPerson:"Christiaan Barnard"},{id:"human-genome",name:{en:"Human Genome Decoded",de:"Menschliches Genom entschlÃ¼sselt",fr:"GÃ©nome humain dÃ©codÃ©"},shortName:{en:"Genome Project",de:"Genom-Projekt",fr:"Projet GÃ©nome"},emoji:"ðŸ§ª",year:2003,category:"science"},{id:"hubble-launch",name:{en:"Hubble Telescope Launch",de:"Hubble-Teleskop Start",fr:"Lancement tÃ©lescope Hubble"},shortName:{en:"Hubble Telescope",de:"Hubble-Teleskop",fr:"TÃ©lescope Hubble"},emoji:"ðŸ”­",year:1990,category:"science"},{id:"telephone-invention",name:{en:"First Telephone Call",de:"Erster Telefonanruf",fr:"Premier appel tÃ©lÃ©phonique"},shortName:{en:"Telephone",de:"Telefon",fr:"TÃ©lÃ©phone"},emoji:"ðŸ“ž",year:1876,category:"invention",mainPerson:"Alexander Graham Bell"},{id:"light-bulb",name:{en:"Edison's Light Bulb",de:"Edisons GlÃ¼hbirne",fr:"Ampoule d'Edison"},shortName:{en:"Light Bulb",de:"GlÃ¼hbirne",fr:"Ampoule"},emoji:"ðŸ’¡",year:1879,category:"invention",mainPerson:"Thomas Edison"},{id:"printing-press",name:{en:"Gutenberg's Printing Press",de:"Gutenbergs Buchdruck",fr:"Presse de Gutenberg"},shortName:{en:"Printing Press",de:"Buchdruck",fr:"Imprimerie"},emoji:"ðŸ“–",year:1440,category:"invention",mainPerson:"Johannes Gutenberg"},{id:"internet-creation",name:{en:"Birth of the World Wide Web",de:"Geburt des World Wide Web",fr:"Naissance du Web"},shortName:{en:"The Web",de:"Das Internet",fr:"Le Web"},emoji:"ðŸŒ",year:1991,category:"invention",mainPerson:"Tim Berners-Lee"},{id:"emancipation",name:{en:"Abolition of Slavery",de:"Abschaffung der Sklaverei",fr:"Abolition de l'esclavage"},shortName:{en:"End of Slavery",de:"Ende der Sklaverei",fr:"Fin de l'esclavage"},emoji:"â›“ï¸",year:1865,category:"rights",mainPerson:"Abraham Lincoln"},{id:"womens-suffrage",name:{en:"Women Win the Vote",de:"Frauenwahlrecht",fr:"Droit de vote des femmes"},shortName:{en:"Women's Vote",de:"Frauenwahlrecht",fr:"Vote des femmes"},emoji:"ðŸ—³ï¸",year:1920,category:"rights"},{id:"rosa-parks",name:{en:"Rosa Parks & Bus Boycott",de:"Rosa Parks & Busboykott",fr:"Rosa Parks & Boycott des bus"},shortName:{en:"Rosa Parks",de:"Rosa Parks",fr:"Rosa Parks"},emoji:"ðŸšŒ",year:1955,category:"rights",mainPerson:"Rosa Parks"},{id:"berlin-wall-fall",name:{en:"Fall of the Berlin Wall",de:"Fall der Berliner Mauer",fr:"Chute du mur de Berlin"},shortName:{en:"Berlin Wall Fall",de:"Fall der Berliner Mauer",fr:"Chute du Mur de Berlin"},emoji:"ðŸ§±",year:1989,category:"rights"},{id:"mandela-freedom",name:{en:"Mandela Released",de:"Mandela befreit",fr:"Mandela libÃ©rÃ©"},shortName:{en:"Mandela Free",de:"Mandela frei",fr:"Mandela libre"},emoji:"âœŠ",year:1990,category:"rights",mainPerson:"Nelson Mandela"},{id:"pyramids",name:{en:"Building the Great Pyramids",de:"Bau der Pyramiden",fr:"Construction des Pyramides"},shortName:{en:"The Pyramids",de:"Die Pyramiden",fr:"Les Pyramides"},emoji:"ðŸ”º",year:"-2560",category:"construction"},{id:"eiffel-tower",name:{en:"Eiffel Tower Opens",de:"Eiffelturm erÃ¶ffnet",fr:"Tour Eiffel inaugurÃ©e"},shortName:{en:"Eiffel Tower",de:"Eiffelturm",fr:"Tour Eiffel"},emoji:"ðŸ—¼",year:1889,category:"construction",mainPerson:"Gustave Eiffel"},{id:"panama-canal",name:{en:"Panama Canal Opens",de:"Panamakanal erÃ¶ffnet",fr:"Canal de Panama inaugurÃ©"},shortName:{en:"Panama Canal",de:"Panamakanal",fr:"Canal de Panama"},emoji:"ðŸš¢",year:1914,category:"construction"},{id:"golden-gate",name:{en:"Building the Golden Gate Bridge",de:"Bau der Golden Gate Bridge",fr:"Construction du pont Golden Gate"},shortName:{en:"Golden Gate Bridge",de:"Bau der Golden Gate Bridge",fr:"Pont Golden Gate"},emoji:"ðŸŒ‰",year:1937,category:"construction"},{id:"channel-tunnel",name:{en:"Channel Tunnel Opens",de:"Eurotunnel erÃ¶ffnet",fr:"Tunnel sous la Manche"},shortName:{en:"Chunnel",de:"Eurotunnel",fr:"Eurotunnel"},emoji:"ðŸš‡",year:1994,category:"construction"},{id:"first-olympics",name:{en:"First Modern Olympics",de:"Erste moderne Olympiade",fr:"Premiers Jeux Olympiques modernes"},shortName:{en:"Modern Olympics",de:"Moderne Olympiade",fr:"Jeux modernes"},emoji:"ðŸ…",year:1896,category:"culture"},{id:"disneyland-opening",name:{en:"Disneyland Opens",de:"Disneyland erÃ¶ffnet",fr:"Disneyland ouvre"},shortName:{en:"Disneyland",de:"Disneyland",fr:"Disneyland"},emoji:"ðŸ°",year:1955,category:"culture",mainPerson:"Walt Disney"},{id:"first-movie",name:{en:"Birth of Cinema",de:"Geburt des Kinos",fr:"Naissance du cinÃ©ma"},shortName:{en:"First Movies",de:"Erste Filme",fr:"Premiers films"},emoji:"ðŸŽ¬",year:1895,category:"culture",mainPerson:"LumiÃ¨re Brothers"},{id:"first-zoo",name:{en:"First Modern Zoo Opens",de:"Erster moderner Zoo",fr:"Premier zoo moderne"},shortName:{en:"London Zoo",de:"London Zoo",fr:"Zoo de Londres"},emoji:"ðŸ¦",year:1828,category:"culture"},{id:"natural-history-museum",name:{en:"Natural History Museum Opens",de:"Naturhistorisches Museum",fr:"MusÃ©e d'Histoire Naturelle"},shortName:{en:"Natural History Museum",de:"Naturkundemuseum",fr:"MusÃ©e Histoire Naturelle"},emoji:"ðŸ›ï¸",year:1881,category:"culture"},{id:"king-tut",name:{en:"King Tut's Tomb Discovered",de:"Tutanchamuns Grab entdeckt",fr:"Tombeau de ToutÃ¢nkhamon"},shortName:{en:"King Tut",de:"Tutanchamun",fr:"ToutÃ¢nkhamon"},emoji:"ðŸ‘‘",year:1922,category:"archaeology",mainPerson:"Howard Carter"},{id:"pompeii-discovery",name:{en:"Rediscovery of Pompeii",de:"Wiederentdeckung von Pompeji",fr:"RedÃ©couverte de PompÃ©i"},shortName:{en:"Pompeii",de:"Pompeji",fr:"PompÃ©i"},emoji:"ðŸŒ‹",year:1748,category:"archaeology"},{id:"terracotta-army",name:{en:"Terracotta Army Discovered",de:"Terrakotta-Armee entdeckt",fr:"ArmÃ©e de terre cuite"},shortName:{en:"Terracotta Army",de:"Terrakotta-Armee",fr:"ArmÃ©e terre cuite"},emoji:"ðŸ—¿",year:1974,category:"archaeology"}];function dl(r){return r==="popular"?ba.filter(l=>Ao.includes(l.id)):ba.filter(l=>l.group===r)}function cl(r){return r==="popular"?gi.filter(l=>Po.includes(l.id)):gi.filter(l=>l.ageGroup===r)}function ml(r){return r==="popular"?hi.filter(l=>To.includes(l.id)):hi.filter(l=>l.group===r)}function ul(r){return r==="popular"?xi.filter(l=>Io.includes(l.id)):xi.filter(l=>l.category===r)}const $o={ideaModel:null,outlineModel:null,textModel:null,sceneDescriptionModel:null,imageModel:null,coverImageModel:null,qualityModel:null,imageBackend:null,avatarModel:null},cr={enableAutoRepair:!1,enableFinalChecks:!0,incrementalConsistency:!1,incrementalConsistencyDryRun:!0,lookbackCount:3,checkOnlyMode:!1,useGridRepair:!0,forceRepairThreshold:null};function Do(){const r=localStorage.getItem("developer_mode")==="true",[l,n]=o.useState(r),[y,s]=o.useState(null),[C,x]=o.useState("auto"),[A,P]=o.useState(!1),[m,T]=o.useState(!1),[S,D]=o.useState(!1),[v,V]=o.useState(!1),[d,G]=o.useState(r),[F,ne]=o.useState(cr.enableAutoRepair),[L,Z]=o.useState(cr.enableFinalChecks),[E,te]=o.useState(cr.incrementalConsistency),[Y,Q]=o.useState(cr.incrementalConsistencyDryRun),[$,re]=o.useState(cr.lookbackCount),[pe,fe]=o.useState(cr.checkOnlyMode),[ye,le]=o.useState(cr.useGridRepair),[Se,Ee]=o.useState(cr.forceRepairThreshold),[Be,X]=o.useState(!1),[Ve,Ce]=o.useState({...$o}),Ue=ue=>{n(ue),G(!!ue)};return o.useEffect(()=>{l?localStorage.setItem("developer_mode","true"):localStorage.removeItem("developer_mode")},[l]),{developerMode:l,setDeveloperMode:Ue,imageGenMode:y,setImageGenMode:s,generationMode:C,setGenerationMode:x,devSkipOutline:A,setDevSkipOutline:P,devSkipText:m,setDevSkipText:T,devSkipSceneDescriptions:S,setDevSkipSceneDescriptions:D,devSkipImages:v,setDevSkipImages:V,devSkipCovers:d,setDevSkipCovers:G,enableAutoRepair:F,setEnableAutoRepair:ne,enableFinalChecks:L,setEnableFinalChecks:Z,incrementalConsistency:E,setIncrementalConsistency:te,incrementalConsistencyDryRun:Y,setIncrementalConsistencyDryRun:Q,lookbackCount:$,setLookbackCount:re,checkOnlyMode:pe,setCheckOnlyMode:fe,useGridRepair:ye,setUseGridRepair:le,forceRepairThreshold:Se,setForceRepairThreshold:Ee,loadAllAvatars:Be,setLoadAllAvatars:X,modelSelections:Ve,setModelSelections:Ce}}const Ro=o.lazy(()=>xs(()=>import("./WizardStep2Characters-B4jGUy8-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(r=>({default:r.WizardStep2Characters}))),Eo=o.lazy(()=>xs(()=>Promise.resolve().then(()=>jo),void 0).then(r=>({default:r.WizardStep3BookSettings}))),Fo=o.lazy(()=>xs(()=>import("./WizardStep4StoryType-D_zGXmwP.js"),__vite__mapDeps([24,1,2,3,4,7,17,12,13,5,6,8,18,19,14,20,21,9,22,23,15])).then(r=>({default:r.WizardStep4StoryType}))),zo=o.lazy(()=>xs(()=>import("./WizardStep5ArtStyle-DbI25i0F.js"),__vite__mapDeps([25,1,2,3,4,26,20])).then(r=>({default:r.WizardStep5ArtStyle}))),Bo=o.lazy(()=>xs(()=>import("./WizardStep6Summary-13isz1xE.js"),__vite__mapDeps([27,1,2,3,4,26,17,9,7,5,6,8,18,19,12,13,14,20,21,22,23,15])).then(r=>({default:r.WizardStep6Summary}))),g=ya("StoryWizard"),pi={en:{1:"Add photos of your characters - they'll appear consistently throughout your story!",2:"Set the book length and reading level for your audience",3:"Choose a story type and theme",4:"Pick an illustration style for your book",5:"Review your choices, add plot details, then generate your story!"},de:{1:"FÃ¼ge Fotos deiner Charaktere hinzu - sie erscheinen einheitlich in der gesamten Geschichte!",2:"Lege die BuchlÃ¤nge und das Leseniveau fÃ¼r dein Publikum fest",3:"WÃ¤hle einen Geschichtstyp und ein Thema",4:"WÃ¤hle einen Illustrationsstil fÃ¼r dein Buch",5:"ÃœberprÃ¼fe deine Auswahl, fÃ¼ge Handlungsdetails hinzu und generiere deine Geschichte!"},fr:{1:"Ajoutez des photos de vos personnages - ils apparaÃ®tront de maniÃ¨re cohÃ©rente dans toute votre histoire!",2:"DÃ©finissez la longueur du livre et le niveau de lecture pour votre public",3:"Choisissez un type d'histoire et un thÃ¨me",4:"Choisissez un style d'illustration pour votre livre",5:"VÃ©rifiez vos choix, ajoutez des dÃ©tails de l'intrigue, puis gÃ©nÃ©rez votre histoire!"}};function Mo(){const r=Tn(),[l,n]=In(),{t:y,language:s}=Ot(),{isAuthenticated:C,user:x,updateCredits:A,refreshUser:P,isLoading:m,isImpersonating:T}=va(),{showSuccess:S,showInfo:D,showError:v}=An(),{startTracking:V,stopTracking:d,activeJob:G,isComplete:F,completedStoryId:ne,markCompletionViewed:L,hasUnviewedCompletion:Z}=Pn(),[E,te]=o.useState(()=>{const i=new URLSearchParams(window.location.search);if(i.get("storyId"))return 6;if(i.get("new")==="true")return 1;const h=localStorage.getItem("wizard_step");return h?parseInt(h,10):1}),[Y,Q]=o.useState(()=>!!new URLSearchParams(window.location.search).get("storyId")),[$,re]=o.useState(null),{developerMode:pe,setDeveloperMode:fe,imageGenMode:ye,setImageGenMode:le,generationMode:Se,setGenerationMode:Ee,devSkipOutline:Be,setDevSkipOutline:X,devSkipText:Ve,setDevSkipText:Ce,devSkipSceneDescriptions:Ue,setDevSkipSceneDescriptions:ue,devSkipImages:ge,setDevSkipImages:_,devSkipCovers:Ae,setDevSkipCovers:tt,enableAutoRepair:_e,setEnableAutoRepair:ht,useGridRepair:vt,setUseGridRepair:Yt,forceRepairThreshold:jt,setForceRepairThreshold:Vs,enableFinalChecks:Jr,setEnableFinalChecks:ps,incrementalConsistency:mr,setIncrementalConsistency:a,incrementalConsistencyDryRun:ke,setIncrementalConsistencyDryRun:rt,lookbackCount:he,setLookbackCount:Qr,checkOnlyMode:lt,setCheckOnlyMode:_t,loadAllAvatars:Nt,setLoadAllAvatars:ur,modelSelections:st,setModelSelections:Sr}=Do(),[dt,Xt]=o.useState(()=>localStorage.getItem("story_type")||""),[we,er]=o.useState(()=>localStorage.getItem("story_category")||""),[Fe,tr]=o.useState(()=>localStorage.getItem("story_topic")||""),[Me,Cr]=o.useState(()=>localStorage.getItem("story_theme")||""),[ct,rr]=o.useState(()=>localStorage.getItem("story_custom_theme_text")||""),[He,At]=o.useState(()=>localStorage.getItem("story_art_style")||"watercolor"),[xe,be]=o.useState([]),[Zr,Te]=o.useState(null),[j,ve]=o.useState(null),Yr=o.useRef([]),kr=o.useRef(null),[ot,Rt]=o.useState(!1),[Ar,Ke]=o.useState("photo"),[Pr,sr]=o.useState(!1),[fs,wt]=o.useState(null),[bs,ys]=o.useState(!1),[gr,Tr]=o.useState(!1),[vs,js]=o.useState(void 0),[Ns,Xr]=o.useState(void 0),ar=o.useRef(null),[qs,es]=o.useState(!1),[ws,Ir]=o.useState([]),[$r,hr]=o.useState(null),[ts,ir]=o.useState(null),[Ye,Ht]=o.useState({}),[Et,Ss]=o.useState({}),[xt,Wt]=o.useState([]),nr=o.useRef(null),wa=o.useRef(!1),Vt=o.useRef(!1),[Dr,qt]=o.useState(!1),[St,pt]=o.useState([]),[Xe,Ft]=o.useState([]),Ut=o.useRef(!1),[ft,xr]=o.useState(()=>{try{return localStorage.getItem("story_language_level")||"standard"}catch{return"standard"}}),[bt,rs]=o.useState(()=>{try{const i=localStorage.getItem("story_language");if(i){if(i==="de")return"de-ch";if(i==="fr")return"fr-ch";if(i==="it")return"it-ch";if(i==="en")return"en-gb";if(i.startsWith("de")||i.startsWith("fr")||i.startsWith("it")||i.startsWith("en")||i.startsWith("gsw"))return i}return"de-ch"}catch{return"de-ch"}}),[at,Rr]=o.useState(()=>{try{const i=localStorage.getItem("story_pages");return i?parseInt(i):30}catch{return 30}}),[zt,Er]=o.useState(()=>localStorage.getItem("story_dedication")||""),[t,f]=o.useState(()=>localStorage.getItem("story_details")||""),[b,z]=o.useState(!1),[u,se]=o.useState(!1),[de,Qe]=o.useState(!1),[Bt,Pt]=o.useState(0),[pr,Kt]=o.useState(0),[ce,mt]=o.useState(null),[ss,Fr]=o.useState(""),[Tt,zr]=o.useState([]),[wi,Sa]=o.useState(null),[Ca,Si]=o.useState(null),fr=o.useRef(null),[br,ka]=o.useState(null),[yr,Ci]=o.useState(()=>ji()),[or,Br]=o.useState(!1),[ki,Aa]=o.useState(new Set),[Ai,Pa]=o.useState(!1),[Pi,Cs]=o.useState(!1),[Ti,Us]=o.useState(!1),[Ii,Ks]=o.useState(!1),[$i,Ta]=o.useState(!1),[Di,ks]=o.useState(!1),[Js,vr]=o.useState({current:0,total:0,message:""}),[Mt,as]=o.useState(null),[Ri,Mr]=o.useState(!1),[Qs,lr]=o.useState(""),[Lr,is]=o.useState(""),[Ei,Ia]=o.useState(""),[Fi,$a]=o.useState(""),[zi,Da]=o.useState(""),[Bi,Ra]=o.useState(),[Mi,Ea]=o.useState(),[Li,Fa]=o.useState([]),[Gi,Gr]=o.useState(null),[Oi,As]=o.useState(null),[_i,Zs]=o.useState([]),[Hi,Ys]=o.useState([]),[Wi,Xs]=o.useState([]),[Vi,za]=o.useState(null),[qi,ns]=o.useState([]),[ea,It]=o.useState([]),[os,Lt]=o.useState({frontCover:null,initialPage:null,backCover:null}),[je,ta]=o.useState(null),[ra,Ps]=o.useState(null),[Ui,Ba]=o.useState(!1),[Ki,Ma]=o.useState(),[Ji,La]=o.useState(),[Qi,Ga]=o.useState(),[Zi,sa]=o.useState(null),aa=o.useRef(!1),Or=o.useRef(!1),[yt,Ts]=o.useState(null),[ia,Is]=o.useState({}),[Yi,$s]=o.useState(!1),[Je,Ds]=o.useState(null),[ls,ds]=o.useState("");o.useEffect(()=>{Yr.current=xe},[xe]),o.useEffect(()=>{kr.current=j},[j]),o.useEffect(()=>{if(!m&&!C){if(!!localStorage.getItem("auth_token")){g.debug("Token found but not authenticated yet, waiting for state sync...");return}const h=window.location.pathname+window.location.search,c=encodeURIComponent(h);r(`/?login=true&redirect=${c}`)}},[C,m,r]);const na=o.useCallback(i=>{var h,c,w,p,N,I,R,k,J,q;if(i){if((h=i.sceneImages)!=null&&h.length&&It(U=>U.map(oe=>{const Ne=i.sceneImages.find(qe=>qe.pageNumber===oe.pageNumber);return Ne?{...oe,prompt:Ne.prompt??oe.prompt,qualityReasoning:Ne.qualityReasoning??oe.qualityReasoning,retryHistory:Ne.retryHistory??oe.retryHistory,repairHistory:Ne.repairHistory??oe.repairHistory,wasRegenerated:Ne.wasRegenerated??oe.wasRegenerated,originalScore:Ne.originalScore??oe.originalScore,originalReasoning:Ne.originalReasoning??oe.originalReasoning,totalAttempts:Ne.totalAttempts??oe.totalAttempts,faceEvaluation:Ne.faceEvaluation??oe.faceEvaluation,referencePhotos:Ne.referencePhotos??oe.referencePhotos,landmarkPhotos:Ne.landmarkPhotos??oe.landmarkPhotos,consistencyRegen:Ne.consistencyRegen??oe.consistencyRegen}:oe})),i.coverImages&&Lt(U=>{var qe;const oe={...U},Ne=["frontCover","initialPage","backCover"];for(const We of Ne){const K=(qe=i.coverImages)==null?void 0:qe[We],ze=U[We];K&&typeof ze=="object"&&ze!==null&&(oe[We]={...ze,prompt:K.prompt??ze.prompt,qualityReasoning:K.qualityReasoning??ze.qualityReasoning,retryHistory:K.retryHistory??ze.retryHistory,referencePhotos:K.referencePhotos??ze.referencePhotos,landmarkPhotos:K.landmarkPhotos??ze.landmarkPhotos})}return oe}),console.log("[StoryWizard] Dev metadata generationLog:",((c=i.generationLog)==null?void 0:c.length)||0,"entries"),(w=i.generationLog)!=null&&w.length&&Xs(i.generationLog),(p=i.styledAvatarGeneration)!=null&&p.length&&(console.log("[StoryWizard] Dev metadata styledAvatarGeneration:",((N=i.styledAvatarGeneration)==null?void 0:N.length)??0,"entries"),Zs(i.styledAvatarGeneration)),(I=i.costumedAvatarGeneration)!=null&&I.length&&(console.log("[StoryWizard] Dev metadata costumedAvatarGeneration:",((R=i.costumedAvatarGeneration)==null?void 0:R.length)??0,"entries"),Ys(i.costumedAvatarGeneration)),i.finalChecksReport&&(console.log("[StoryWizard] Dev metadata finalChecksReport:",i.finalChecksReport.totalIssues,"issues"),za(i.finalChecksReport)),(k=i.sceneDescriptions)!=null&&k.length){const U=i.sceneDescriptions;console.log("[StoryWizard] Dev metadata sceneDescriptions:",U.length,"entries"),console.log("[StoryWizard] First scene keys:",Object.keys(U[0]||{})),console.log("[StoryWizard] First scene has outlineExtract:",!!((J=U[0])!=null&&J.outlineExtract)),console.log("[StoryWizard] First scene has scenePrompt:",!!((q=U[0])!=null&&q.scenePrompt)),ns(i.sceneDescriptions)}i.visualBible&&(console.log("[StoryWizard] Dev metadata visualBible loaded"),Gr(i.visualBible))}},[]);o.useEffect(()=>{Oe.getUserLocation().then(i=>{ka(i),i!=null&&i.city&&Oe.triggerLandmarkDiscovery(i.city,i.country)})},[]),o.useEffect(()=>{C&&Oe.getStories({limit:1}).then(({pagination:i})=>{Ta(i.total>0)}).catch(()=>Ta(!1))},[C]);const oa=o.useRef(null);o.useEffect(()=>{const i=l.get("storyId");l.get("new")!=="true"&&(i&&(oa.current=null),G&&!i&&oa.current!==G.jobId&&(g.info("Returning during active generation, restoring progress for job:",G.jobId),oa.current=G.jobId,te(6),Br(!0),lr(G.storyTitle),Ps(G.jobId),Oe.getJobStatus(G.jobId).then(c=>{var w,p;if(g.info("Restored job status:",{progress:c.progress,hasStoryText:!!c.storyText,storyTextKeys:c.storyText?Object.keys(c.storyText):[],pageTextsCount:(w=c.storyText)!=null&&w.pageTexts?Object.keys(c.storyText.pageTexts).length:0,partialPages:((p=c.partialPages)==null?void 0:p.length)||0}),c.progress&&vr(N=>c.progress.current>=N.current?c.progress:{...N,message:c.progress.message}),c.storyText){const N=c.storyText.pageTexts||{};g.info("Setting progressiveStoryData with",Object.keys(N).length,"pages"),Ts({title:c.storyText.title||G.storyTitle,dedication:c.storyText.dedication,pageTexts:N,sceneDescriptions:c.storyText.sceneDescriptions||[],totalPages:c.storyText.totalPages||at})}else g.warn("No storyText in job status response");if(c.partialPages&&c.partialPages.length>0){const N={};c.partialPages.forEach(I=>{I.pageNumber&&I.imageData&&(N[I.pageNumber]=I.imageData)}),g.info("Restored",Object.keys(N).length,"page images"),Is(N)}c.partialCovers&&Lt(N=>{var I,R,k;return{frontCover:((I=c.partialCovers)==null?void 0:I.frontCover)||N.frontCover,initialPage:((R=c.partialCovers)==null?void 0:R.initialPage)||N.initialPage,backCover:((k=c.partialCovers)==null?void 0:k.backCover)||N.backCover}})}).catch(c=>{g.error("Failed to restore job status:",c)})),g.debug("Auto-nav check:",{generationComplete:F,completedStoryId:ne,urlStoryId:i,hasActiveJob:!!G}),F&&ne&&!i&&(g.info("Generation completed, navigating to story:",ne),n({storyId:ne},{replace:!0})))},[G,F,ne,l,n,at]),o.useEffect(()=>{if(l.get("new")==="true"){g.info("New story requested - resetting all story settings"),Xt(""),er(""),tr(""),Cr(""),rr(""),At("watercolor"),xr("standard"),Rr(30),Er(""),f(""),Te(null),localStorage.removeItem("story_type"),localStorage.removeItem("story_category"),localStorage.removeItem("story_topic"),localStorage.removeItem("story_theme"),localStorage.removeItem("story_custom_theme_text"),localStorage.removeItem("story_art_style"),localStorage.removeItem("story_language_level"),localStorage.removeItem("story_pages"),localStorage.removeItem("story_dedication"),localStorage.removeItem("story_details"),localStorage.removeItem("wizard_step");const h=new URLSearchParams(l);h.delete("new"),n(h,{replace:!0}),ve(null),Ke("photo"),te(1)}},[l,n]),o.useEffect(()=>{const i=l.get("storyId");i&&E!==6&&te(6),(async()=>{if(!(!i||!C)){if(aa.current){aa.current=!1,g.info("Skipping story reload - just finished generating");return}g.info("Loading saved story progressively:",i),Q(!0),re(null),as(null);try{await Oe.getStoryProgressively(i,(c,w)=>{var p,N,I,R;g.info("Metadata loaded:",c.title,`(${w} images to load)`),ta(c.id),lr(c.title||""),Xt(c.storyType||""),At(c.artStyle||"pixar"),$a(c.outline||""),Da(c.outlinePrompt||""),Ra(c.outlineModelId),Ea(c.outlineUsage),Fa(c.storyTextPrompts||[]),Zs(c.styledAvatarGeneration||[]),Ys(c.costumedAvatarGeneration||[]),(p=c.generationLog)!=null&&p.length&&(console.log("[StoryWizard] Loading story metadata, generationLog:",((N=c.generationLog)==null?void 0:N.length)??0,"entries"),Xs(c.generationLog)),c.visualBible?Gr({mainCharacters:c.visualBible.mainCharacters||[],secondaryCharacters:c.visualBible.secondaryCharacters||[],animals:c.visualBible.animals||[],artifacts:c.visualBible.artifacts||[],locations:c.visualBible.locations||[],vehicles:c.visualBible.vehicles||[],clothing:c.visualBible.clothing||[],changeLog:c.visualBible.changeLog||[]}):Gr(null),c.clothingRequirements?As(c.clothingRequirements):As(null),It(c.sceneImages||[]),ns(c.sceneDescriptions||[]),Lt(c.coverImages||{frontCover:null,initialPage:null,backCover:null}),xr(c.languageLevel||"standard"),c.language&&rs(c.language),Br(!1),Ba(c.isPartial||!1),Ma(c.failureReason),La(c.generatedPages),Ga(c.totalPages),is(c.story||""),Ia(c.originalStory||c.story||""),sa({storyCategory:c.storyCategory,storyTopic:c.storyTopic,storyTheme:c.storyTheme,storyTypeName:c.storyTypeName,storyDetails:c.storyDetails,artStyle:c.artStyle,language:c.language,languageLevel:c.languageLevel,pages:c.pages,dedication:c.dedication,characters:(I=c.characters)==null?void 0:I.map(k=>{var J;return{id:k.id,name:k.name,isMain:(J=c.mainCharacters)==null?void 0:J.includes(k.id)}}),mainCharacters:c.mainCharacters,relationships:c.relationships,relationshipTexts:c.relationshipTexts,season:c.season,userLocation:c.userLocation}),(R=c.characters)!=null&&R.length&&Te(c.characters.map(k=>{var J,q;return{id:k.id,name:k.name,photoData:k.photoData||((J=k.photos)==null?void 0:J.face)||((q=k.photos)==null?void 0:q.original)}})),te(6),Q(!1),re(null),w>0&&as({loaded:0,total:w}),Or.current=!0,Oe.getStoryDevMetadata(i).then(k=>{na(k),g.debug("Dev metadata merged into story")}).catch(k=>{g.warn("Failed to load dev metadata:",k),Or.current=!1})},(c,w,p,N)=>{if(typeof c=="number")It(I=>I.map(R=>R.pageNumber===c?{...R,imageData:w,imageVersions:p}:R));else{const I=c;Lt(R=>{const k=R[I];return typeof k=="object"&&k!==null?{...R,[I]:{...k,imageData:w}}:{...R,[I]:w}})}N!==void 0&&as(I=>I?{...I,loaded:N}:null)},()=>{g.info("All images loaded"),as(null)})}catch(c){g.error("Failed to load story:",c),Q(!1),re(null),as(null)}}})()},[l,C]),o.useEffect(()=>{E===6&&Z&&(g.info("Clearing unviewed completion - user is viewing story"),L())},[E,Z,L]),o.useEffect(()=>{(async()=>{const h=l.get("payment"),c=l.get("session_id");if(h==="success"&&c){g.info("Payment successful! Checking order status..."),g.info("Session ID:",c);try{const N=await Oe.getOrderStatus(c);if(g.info("Order Status:",N),N.order){const I=`CHF ${(N.order.amount_total/100).toFixed(2)}`,R={en:"Payment Successful!",de:"Zahlung erfolgreich!",fr:"Paiement rÃ©ussi!"},k={en:"Your book order has been received and will be printed soon.",de:"Ihre Buchbestellung wurde entgegengenommen und wird bald gedruckt.",fr:"Votre commande de livre a Ã©tÃ© reÃ§ue et sera bientÃ´t imprimÃ©e."},J=[`${s==="de"?"Kunde":s==="fr"?"Client":"Customer"}: ${N.order.customer_name}`,`Email: ${N.order.customer_email}`,`${s==="de"?"Betrag":s==="fr"?"Montant":"Amount"}: ${I}`,`${s==="de"?"Versand an":s==="fr"?"ExpÃ©diÃ© Ã ":"Shipping to"}: ${N.order.shipping_name}`,`${N.order.shipping_address_line1}`,`${N.order.shipping_postal_code} ${N.order.shipping_city}`,`${N.order.shipping_country}`];S(k[s]||k.en,R[s]||R.en,J)}}catch(N){g.error("Error checking order status:",N)}const p=new URLSearchParams(l);p.delete("payment"),p.delete("session_id"),n(p,{replace:!0})}else if(h==="cancelled"){g.info("Payment cancelled by user");const p={en:"Payment was cancelled. You can try again when ready.",de:"Zahlung wurde abgebrochen. Sie kÃ¶nnen es erneut versuchen.",fr:"Paiement annulÃ©. Vous pouvez rÃ©essayer quand vous Ãªtes prÃªt."};D(p[s]||p.en,s==="de"?"Abgebrochen":s==="fr"?"AnnulÃ©":"Cancelled");const N=new URLSearchParams(l);N.delete("payment"),n(N,{replace:!0})}const w=l.get("credits_payment");if(w==="success"){g.info("Credits payment successful!"),await P();const p={en:"Credits Added!",de:"Credits hinzugefuegt!",fr:"Credits ajoutes!"},N={en:"100 credits have been added to your account.",de:"100 Credits wurden Ihrem Konto gutgeschrieben.",fr:"100 credits ont ete ajoutes a votre compte."};S(N[s]||N.en,p[s]||p.en);const I=new URLSearchParams(l);I.delete("credits_payment"),I.delete("session_id"),n(I,{replace:!0})}else if(w==="cancelled"){g.info("Credits payment cancelled by user");const p={en:"Credits purchase was cancelled.",de:"Kreditkauf wurde abgebrochen.",fr:"L'achat de credits a ete annule."};D(p[s]||p.en,s==="de"?"Abgebrochen":s==="fr"?"Annule":"Cancelled");const N=new URLSearchParams(l);N.delete("credits_payment"),n(N,{replace:!0})}})()},[l,n,s,S,D,P]);const Rs=o.useRef(!1);o.useEffect(()=>{if(l.get("autoGenerate")==="true"&&!Rs.current){Rs.current=!0;const h=localStorage.getItem("pending_story_type"),c=localStorage.getItem("pending_art_style");h&&(Xt(h),localStorage.removeItem("pending_story_type")),c&&(At(c),localStorage.removeItem("pending_art_style")),te(6);const w=new URLSearchParams(l);w.delete("autoGenerate"),n(w,{replace:!0})}},[l,n]);const la=i=>{if(i.length===0)return;const h=i.filter(c=>{const w=parseInt(c.age);return w>=1&&w<=10});if(h.length>0){const c=h.map(w=>w.id);pt(c),g.info(`Auto-selected ${h.length} main character(s) aged 1-10`)}else{const c=i.reduce((w,p)=>{const N=parseInt(p.age)||999,I=parseInt(w.age)||999;return N<I?p:w});pt([c.id]),g.info(`Auto-selected youngest character as main: ${c.name} (age ${c.age})`)}};o.useEffect(()=>{C?(async()=>{try{Q(!0);const h=await De.getCharacterData(Nt);if(g.info("Loaded character data from API:",{characters:h.characters.length,relationships:Object.keys(h.relationships).length}),be(h.characters),Object.keys(h.relationships).length>0&&(Ht(h.relationships),wa.current=!0),Object.keys(h.relationshipTexts).length>0&&Ss(h.relationshipTexts),h.customRelationships.length>0&&Wt(h.customRelationships),h.characters.some(w=>w.storyRole)){const w=[],p=[];for(const N of h.characters)N.storyRole==="main"?w.push(N.id):N.storyRole==="out"&&p.push(N.id);pt(w),Ft(p),g.info(`Loaded character roles from database: ${w.length} main, ${p.length} excluded`)}else h.characters.length>0&&la(h.characters)}catch(h){g.error("Failed to load character data:",h)}finally{Q(!1),qt(!0)}})():m||qt(!0)},[C,m]),o.useEffect(()=>{pe&&je&&!Or.current&&(Or.current=!0,g.info("Developer mode enabled, fetching dev metadata for story:",je),Oe.getStoryDevMetadata(je).then(i=>{na(i),g.debug("Dev metadata merged (triggered by dev mode toggle)")}).catch(i=>{g.warn("Failed to load dev metadata on toggle:",i),Or.current=!1})),(!pe||!je)&&(Or.current=!1)},[pe,je,na]),o.useEffect(()=>{Nt&&C&&Dr&&(async()=>{try{g.info("Reloading characters with full avatars (dev mode)");const h=await De.getCharacterData(!0);be(h.characters),g.info(`Loaded ${h.characters.length} characters with full avatars`)}catch(h){g.error("Failed to reload with full avatars:",h)}})()},[Nt,C,Dr]),o.useEffect(()=>{E===1&&xe.length===0&&!j&&!Y&&Dr&&ca()},[E,xe.length,j,Y,Dr]);const da=o.useRef(Xe);o.useEffect(()=>{da.current!==Xe&&JSON.stringify(da.current)!==JSON.stringify(Xe)&&(zr([]),f(""),da.current=Xe)},[Xe]),o.useEffect(()=>{localStorage.setItem("story_language_level",ft)},[ft]),o.useEffect(()=>{localStorage.setItem("story_language",bt)},[bt]),o.useEffect(()=>{localStorage.setItem("story_pages",at.toString())},[at]),o.useEffect(()=>{localStorage.setItem("story_dedication",zt)},[zt]),o.useEffect(()=>{localStorage.setItem("story_details",t)},[t]),o.useEffect(()=>{localStorage.setItem("story_type",dt)},[dt]),o.useEffect(()=>{we?localStorage.setItem("story_category",we):localStorage.removeItem("story_category")},[we]),o.useEffect(()=>{Fe?localStorage.setItem("story_topic",Fe):localStorage.removeItem("story_topic")},[Fe]),o.useEffect(()=>{Me?localStorage.setItem("story_theme",Me):localStorage.removeItem("story_theme")},[Me]),o.useEffect(()=>{ct?localStorage.setItem("story_custom_theme_text",ct):localStorage.removeItem("story_custom_theme_text")},[ct]);const Oa=o.useRef(we),_a=o.useRef(Fe),Ha=o.useRef(Me),Wa=o.useRef(!0);o.useEffect(()=>{if(Wa.current){Wa.current=!1;return}const i=Oa.current!==we,h=_a.current!==Fe,c=Ha.current!==Me;(i||h||c)&&(f(""),localStorage.removeItem("story_details"),zr([])),Oa.current=we,_a.current=Fe,Ha.current=Me},[we,Fe,Me]),o.useEffect(()=>{localStorage.setItem("story_art_style",He)},[He]);const cs=o.useRef(!1);o.useEffect(()=>{if(E===4&&!cs.current&&!b&&Tt.length===0){const i=!!we,h=!!Me||!!Fe,c=xe.length>0;i&&h&&c&&(cs.current=!0,g.info("[StoryWizard] Pre-generating story ideas while user selects art style"),Ua())}cs.current&&Tt.length===0&&(cs.current=!1)},[E,we,Me,Fe,xe.length,b,Tt.length]);const Va=o.useRef({storyCategory:we,storyTheme:Me,storyTopic:Fe});o.useEffect(()=>{const i=Va.current,h=i.storyCategory!==we||i.storyTheme!==Me||i.storyTopic!==Fe;Va.current={storyCategory:we,storyTheme:Me,storyTopic:Fe},h&&(b||Tt.length>0)&&(g.info("[StoryWizard] Story inputs changed - aborting idea generation and clearing results"),fr.current&&(fr.current.abort(),fr.current=null),z(!1),se(!1),Qe(!1),zr([]),mt(null),Fr(""),cs.current=!1)},[we,Me,Fe,b,Tt.length]),o.useEffect(()=>{if(!b)return;const h=setTimeout(()=>{g.warn("[StoryWizard] Safety timeout - resetting isGeneratingIdeas after 2.5 minutes"),z(!1),se(!1),Qe(!1),v(s==="de"?"ZeitÃ¼berschreitung bei der Ideengenerierung. Bitte versuchen Sie es erneut.":s==="fr"?"DÃ©lai d'attente de gÃ©nÃ©ration d'idÃ©es. Veuillez rÃ©essayer.":"Idea generation timed out. Please try again.")},15e4);return()=>clearTimeout(h)},[b,s]),o.useEffect(()=>{if(!u&&!de){Pt(0),Kt(0);return}const i=35e3,h=80,c=100,w=Date.now(),p=setInterval(()=>{const N=Date.now()-w,I=Math.min(N/i,1),R=1-Math.pow(1-I,3),k=Math.round(R*h);u&&Pt(k),de&&Kt(k),I>=1&&clearInterval(p)},c);return()=>clearInterval(p)},[u,de]),o.useEffect(()=>{E>=1&&E<=5&&localStorage.setItem("wizard_step",E.toString())},[E]);const Xi=i=>{er(i)},en=i=>{Cr(i),!(i==="custom"||i==="realistic"||i==="")&&(we==="adventure"||(we==="life-challenge"||we==="educational")&&Fe!=="")&&Jt(4)},tn=i=>{tr(i),we==="historical"&&i!==""&&Jt(4)},rn=i=>{At(i),Jt(5)};o.useEffect(()=>{if(E===2&&xe.length>=2&&!Y){const i=xe.map(h=>h.id).sort().join("-");if(!nr.current||nr.current!==i){const c=wo(s);g.debug("Initializing relationships for step 2",{charKey:i,existingCount:Object.keys(Ye).length}),Ht(w=>{const p={...w};let N=!1;return xe.forEach((I,R)=>{xe.forEach((k,J)=>{if(R!==J){const q=`${I.id}-${k.id}`;p[q]||(p[q]=c,N=!0,g.debug("Initializing missing relationship:",q))}})}),N?p:w}),nr.current=i}}},[E,xe,s,Y]);const sn=()=>{if(xe.length<2)return!0;for(let i=0;i<xe.length;i++)for(let h=0;h<xe.length;h++)if(i!==h){const c=`${xe[i].id}-${xe[h].id}`,w=Ye[c];if(!w||mi(w))return!1}return!0},an=()=>{if(xe.length<2)return null;let i=0,h=null;for(const c of xe){let w=0;for(const p of xe)if(c.id!==p.id){const N=`${c.id}-${p.id}`,I=Ye[N];(!I||mi(I))&&w++}w>i&&(i=w,h=c)}return h},ca=()=>{ve({id:Date.now(),name:"",gender:void 0,age:"",traits:{strengths:[],flaws:[],challenges:[]}}),Ke("photo"),Rt(!1)},nn=(i,h=1500)=>new Promise(c=>{const w=new Image;w.onload=()=>{const p=document.createElement("canvas");let{width:N,height:I}=w;(N>h||I>h)&&(N>I?(I=Math.round(I*h/N),N=h):(N=Math.round(N*h/I),I=h)),p.width=N,p.height=I;const R=p.getContext("2d");R==null||R.drawImage(w,0,0,N,I),c(p.toDataURL("image/jpeg",.85))},w.onerror=()=>c(i),w.src=i}),on=async(i,h)=>{var p,N,I,R,k;if(g.info(`ðŸ“¸ handlePhotoSelect called: file=${i==null?void 0:i.name}, character=${j==null?void 0:j.name}, developerMode=${pe}`),j&&!pe){const J=!!((p=j.avatars)!=null&&p.winter||(N=j.avatars)!=null&&N.standard||(I=j.avatars)!=null&&I.summer||(R=j.avatars)!=null&&R.hasFullAvatars);if(g.info(`ðŸ“¸ hasAvatars=${J}`),J){const q=Ws(j.id);if(g.info(`ðŸ“¸ cooldown check: canRegenerate=${q.canRegenerate}, waitSeconds=${q.waitSeconds}`),!q.canRegenerate){const U=s==="de"?`Bitte warten Sie ${q.waitSeconds} Sekunden, bevor Sie ein neues Foto hochladen.`:`Please wait ${q.waitSeconds} seconds before uploading a new photo.`;v(U);return}Ni(j.id)}}const c=h&&((k=j==null?void 0:j.clothing)!=null&&k.structured)?{...j.clothing.structured}:null,w=new FileReader;w.onload=async J=>{var U,oe,Ne,qe,We,K,ze,ee,O,B,H,M;const q=(U=J.target)==null?void 0:U.result;j&&(ar.current={physical:j.physical,gender:j.gender,age:j.age}),js(void 0),sr(!0),!(j!=null&&j.name)||j.name.trim().length<2?Ke("name"):(Ke("traits"),g.info("ðŸ“¸ Character has name, going to traits step to show avatar regeneration"));try{const ae=await nn(q),Ie=Math.round(q.length/1024),W=Math.round(ae.length/1024);g.info(`Starting photo analysis... (${Ie}KB -> ${W}KB)`);const Pe=j!=null&&j.id&&j.id>0?j.id:void 0,me=await De.analyzePhoto(ae,s,void 0,void 0,Pe);if(me.success){if(me.multipleFacesDetected&&me.faces&&me.faces.length>1){g.info(`Multiple faces detected (${me.faces.length}), showing selection modal`),hr(ae),ir(c?{structured:c}:null),Ir(me.faces),es(!0),sr(!1);return}g.info("Photo analysis complete:",{hasPhotos:!!me.photos,hasPhysical:!!me.physical,hasClothing:!!me.clothing,age:me.age,gender:me.gender}),me._debug&&(Xr(me._debug),me._debug.rawResponse,me._debug.error&&console.warn("ðŸ“¸ [DEBUG] Gemini error:",me._debug.error));const Le={original:((oe=me.photos)==null?void 0:oe.face)||q,face:(Ne=me.photos)==null?void 0:Ne.face,body:((qe=me.photos)==null?void 0:qe.body)||q,bodyNoBg:(We=me.photos)==null?void 0:We.bodyNoBg,faceBox:(K=me.photos)==null?void 0:K.faceBox,bodyBox:(ze=me.photos)==null?void 0:ze.bodyBox},Ze=(ee=me.photos)!=null&&ee.bodyNoBg?Math.round(me.photos.bodyNoBg.length/1024):0,it=(O=me.photos)!=null&&O.body?Math.round(me.photos.body.length/1024):0,Es=(B=me.photos)!=null&&B.face?Math.round(me.photos.face.length/1024):0;if(g.info(`ðŸ“¸ [PHOTO CHANGE] Analysis returned: bodyNoBg=${Ze}KB, body=${it}KB, face=${Es}KB`),(H=me.photos)!=null&&H.bodyNoBg){const $e=me.photos.bodyNoBg.substring(me.photos.bodyNoBg.indexOf("base64,")+7,me.photos.bodyNoBg.indexOf("base64,")+27);g.info(`ðŸ“¸ [PHOTO CHANGE] bodyNoBg fingerprint: ${$e}...`)}let $t,Fs;c?($t={structured:c},Fs={upperBody:c.upperBody?"user":void 0,lowerBody:c.lowerBody?"user":void 0,shoes:c.shoes?"user":void 0,fullBody:c.fullBody?"user":void 0},g.info(`ðŸ‘• Keeping old clothing (marked as user-edited): ${JSON.stringify(c)}`)):g.info("ðŸ‘• Using new photo's clothing (cleared existing)");const zs=me.characterId,ua=(j==null?void 0:j.id)&&j.id>0,_r=ua?j.id:zs;ua?g.info(`ðŸ“¸ [PHOTO] Keeping existing character ID: ${j.id} (server created new ID ${zs} but ignoring)`):zs&&g.info(`ðŸ“¸ [PHOTO] Using server-created character ID: ${zs}`);const Ct=j?{...j,id:_r||j.id,photos:Le,avatars:{status:"generating"},clothing:$t,clothingSource:Fs}:null;if(Ct){const $e=(M=Ct.photos)==null?void 0:M.bodyNoBg,ut=$e?Math.round($e.length/1024):0;if(g.info(`ðŸ“¸ [CHAR FOR GEN] bodyNoBg=${ut}KB, has photos: ${!!Ct.photos}`),$e){const Re=$e.substring($e.indexOf("base64,")+7,$e.indexOf("base64,")+27);g.info(`ðŸ“¸ [CHAR FOR GEN] fingerprint: ${Re}...`)}}if(ve($e=>{var Re;if(!$e)return null;const ut=(Re=$e.avatars)!=null&&Re.standard?{...$e.avatars,status:"generating",stale:!0}:{status:"generating"};return{...$e,id:_r||$e.id,photos:Le,avatars:ut,clothing:$t,clothingSource:Fs}}),_r&&!ua&&be($e=>{if(!$e.some(Re=>Re.id===_r)){const Re={...j,id:_r,photos:Le,avatars:{status:"generating"},clothing:$t,clothingSource:Fs};return g.info(`ðŸ“¸ Adding new character ${_r} to array to prevent data loss`),[...$e,Re]}return $e}),g.info("ðŸŽ¨ Auto-starting avatar generation in background..."),g.info(`ðŸ“¸ Photo for avatar: bodyNoBg=${!!Le.bodyNoBg}, body=${!!Le.body}, face=${!!Le.face}`),Ct&&Ct.id&&Ct.name&&Ct.name.trim()){const $e=Ct.id;wt($e),De.generateAndSaveAvatarForCharacter(Ct,void 0,{avatarModel:st.avatarModel||void 0}).then(ut=>{ut.success&&ut.character?(ve(Re=>!Re||Re.id!==$e?Re:{...Re,avatars:ut.character.avatars,physical:ut.character.physical,clothing:ut.character.clothing}),be(Re=>Re.map(kt=>kt.id===$e?{...kt,...ut.character,id:kt.id}:kt)),g.success(`âœ… Avatar generated and traits extracted for ${Ct.name}`)):(g.error(`âŒ Avatar generation failed: ${ut.error}`),ve(Re=>Re&&Re.id===$e?{...Re,avatars:{status:"failed"}}:Re),be(Re=>Re.map(kt=>kt.id===$e?{...kt,avatars:{status:"failed"}}:kt)))}).catch(ut=>{g.error("âŒ Avatar generation error:",ut),ve(Re=>Re&&Re.id===$e?{...Re,avatars:{status:"failed"}}:Re),be(Re=>Re.map(kt=>kt.id===$e?{...kt,avatars:{status:"failed"}}:kt))}).finally(()=>{wt(null)})}else Ct&&Ct.id?(g.info("â­ï¸ Skipping auto-generation: character has no name yet"),wt(null),ve($e=>$e&&{...$e,avatars:{status:"pending"}})):(g.warn("â­ï¸ Skipping auto-generation: no character data available"),wt(null))}else me.error==="no_face_detected"?(g.warn("No face detected in photo"),v(y.noFaceDetected)):(g.warn("Photo analysis returned no data, using original photo"),ve(Le=>Le?{...Le,photos:{original:q},avatars:void 0}:null))}catch(ae){g.error("Photo analysis error:",ae),ve(Ie=>Ie?{...Ie,photos:{original:q},avatars:void 0}:null)}finally{sr(!1)}},w.readAsDataURL(i)},ln=async i=>{var h,c,w,p,N,I,R,k;if(!$r){g.error("No pending photo data for face selection");return}es(!1),sr(!0);try{g.info(`Re-analyzing photo with selected face ID: ${i}`);const J=ws.map(oe=>({id:oe.id,x:oe.faceBox.x,y:oe.faceBox.y,width:oe.faceBox.width,height:oe.faceBox.height,confidence:oe.confidence})),q=j!=null&&j.id&&j.id>0?j.id:void 0,U=await De.analyzePhoto($r,s,i,J,q);if(U.success){g.info("Photo analysis complete with selected face:",{hasPhotos:!!U.photos,hasPhysical:!!U.physical,hasClothing:!!U.clothing,age:U.age,gender:U.gender}),U._debug&&Xr(U._debug);const oe=ts==null?void 0:ts.structured,Ne={original:((h=U.photos)==null?void 0:h.face)||$r,face:(c=U.photos)==null?void 0:c.face,body:((w=U.photos)==null?void 0:w.body)||$r,bodyNoBg:(p=U.photos)==null?void 0:p.bodyNoBg,faceBox:(N=U.photos)==null?void 0:N.faceBox,bodyBox:(I=U.photos)==null?void 0:I.bodyBox},qe=(R=U.photos)!=null&&R.bodyNoBg?Math.round(U.photos.bodyNoBg.length/1024):0;if(g.info(`ðŸ“¸ [FACE SELECT] Analysis returned: bodyNoBg=${qe}KB`),(k=U.photos)!=null&&k.bodyNoBg){const H=U.photos.bodyNoBg.substring(U.photos.bodyNoBg.indexOf("base64,")+7,U.photos.bodyNoBg.indexOf("base64,")+27);g.info(`ðŸ“¸ [FACE SELECT] bodyNoBg fingerprint: ${H}...`)}let We,K;oe&&(We={structured:oe},K={upperBody:oe.upperBody?"user":void 0,lowerBody:oe.lowerBody?"user":void 0,shoes:oe.shoes?"user":void 0,fullBody:oe.fullBody?"user":void 0});const ze=U.characterId,ee=(j==null?void 0:j.id)&&j.id>0,O=ee?j.id:ze;ee?g.info(`ðŸ“¸ [FACE SELECT] Keeping existing character ID: ${j.id} (server created new ID ${ze} but ignoring)`):ze&&g.info(`ðŸ“¸ [FACE SELECT] Using server-created character ID: ${ze}`);const B=j?{...j,id:O||j.id,photos:Ne,avatars:{status:"generating"},clothing:We,clothingSource:K}:null;if(ve(H=>{var ae;if(!H)return null;const M=(ae=H.avatars)!=null&&ae.standard?{...H.avatars,status:"generating",stale:!0}:{status:"generating"};return{...H,id:O||H.id,photos:Ne,avatars:M,clothing:We,clothingSource:K}}),O&&!ee&&be(H=>{if(!H.some(ae=>ae.id===O)){const ae={...j,id:O,photos:Ne,avatars:{status:"generating"},clothing:We,clothingSource:K};return g.info(`ðŸ“¸ [FACE SELECT] Adding new character ${O} to array to prevent data loss`),[...H,ae]}return H}),j!=null&&j.name&&j.name.trim().length>=2?(Ke("traits"),g.info("ðŸ“¸ Face selected, character has name, going to traits step")):Ke("name"),g.info("ðŸŽ¨ Auto-starting avatar generation in background after face selection..."),g.info(`ðŸ“¸ Photo for avatar: bodyNoBg=${!!Ne.bodyNoBg}, body=${!!Ne.body}, face=${!!Ne.face}`),B&&B.name&&B.name.trim()){const H=B.id;wt(H),De.generateAndSaveAvatarForCharacter(B,void 0,{avatarModel:st.avatarModel||void 0}).then(M=>{M.success&&M.character?(ve(ae=>!ae||ae.id!==H?ae:{...ae,avatars:M.character.avatars,physical:M.character.physical,clothing:M.character.clothing}),be(ae=>ae.map(Ie=>Ie.id===H?{...Ie,...M.character,id:Ie.id}:Ie)),g.success(`âœ… Avatar generated for ${B.name} (face selection)`)):(g.error(`âŒ Avatar generation failed: ${M.error}`),ve(ae=>ae&&ae.id===H?{...ae,avatars:{status:"failed"}}:ae),be(ae=>ae.map(Ie=>Ie.id===H?{...Ie,avatars:{status:"failed"}}:Ie)))}).catch(M=>{g.error("âŒ Avatar generation error:",M),ve(ae=>ae&&ae.id===H?{...ae,avatars:{status:"failed"}}:ae),be(ae=>ae.map(Ie=>Ie.id===H?{...Ie,avatars:{status:"failed"}}:Ie))}).finally(()=>{wt(null)})}else g.info("â­ï¸ Skipping auto-generation: character has no name yet"),wt(null),ve(H=>H&&{...H,avatars:{status:"pending"}})}else g.warn("Photo analysis failed after face selection"),v(y.noFaceDetected)}catch(J){g.error("Photo analysis error after face selection:",J),v("Failed to analyze photo. Please try again.")}finally{sr(!1),hr(null),ir(null),Ir([])}},dn=()=>{es(!1),hr(null),ir(null),Ir([]),Ke("photo")},cn=async()=>{if(j){ve(i=>i&&{...i,avatars:void 0}),ys(!0);try{g.info(`ðŸ”„ Regenerating avatars for ${j.name}...`);const i=await De.regenerateAvatarsForCharacter(j.id,(h,c)=>g.info(`[${h}] ${c}`),{avatarModel:st.avatarModel||void 0});if(i.success&&i.character){const h={...i.character.avatars,stale:!1};ve(c=>c&&{...c,avatars:h,physical:i.character.physical,clothing:i.character.clothing}),be(c=>c.map(w=>w.id===j.id?{...w,avatars:h,physical:i.character.physical,clothing:i.character.clothing}:w)),g.success(`âœ… Avatars and traits regenerated for ${j.name}`)}else g.error(`âŒ Failed to regenerate avatars: ${i.error}`),v(`Failed to regenerate avatars: ${i.error||"Unknown error"}`)}catch(i){g.error(`âŒ Failed to regenerate avatars for ${j.name}:`,i),v(`Failed to regenerate avatars: ${i instanceof Error?i.message:"Unknown error"}`)}finally{ys(!1)}}},mn=async()=>{var i,h,c,w,p,N,I,R,k,J,q,U,oe,Ne,qe,We;if(j){ve(K=>K&&{...K,avatars:void 0}),Tr(!0);try{g.info(`ðŸ”„ Regenerating avatars WITH TRAITS for ${j.name}...`),g.info(`Physical traits: ${JSON.stringify(j.physical)}`);const K=await De.generateClothingAvatarsWithTraits(j);if(K.success&&K.avatars){const ze={...K.avatars,stale:!1,generatedAt:new Date().toISOString()},ee=j.physicalTraitsSource||{},O=K.extractedTraits?{height:(i=j.physical)==null?void 0:i.height,eyeColor:ee.eyeColor==="user"?(h=j.physical)==null?void 0:h.eyeColor:K.extractedTraits.eyeColor,eyeColorHex:ee.eyeColor==="user"?(c=j.physical)==null?void 0:c.eyeColorHex:K.extractedTraits.eyeColorHex,hairColor:ee.hairColor==="user"?(w=j.physical)==null?void 0:w.hairColor:K.extractedTraits.hairColor,hairColorHex:ee.hairColor==="user"?(p=j.physical)==null?void 0:p.hairColorHex:K.extractedTraits.hairColorHex,hairLength:ee.hairLength==="user"?(N=j.physical)==null?void 0:N.hairLength:K.extractedTraits.hairLength,hairStyle:ee.hairStyle==="user"?(I=j.physical)==null?void 0:I.hairStyle:K.extractedTraits.hairStyle,build:ee.build==="user"?(R=j.physical)==null?void 0:R.build:K.extractedTraits.build,face:ee.face==="user"?(k=j.physical)==null?void 0:k.face:K.extractedTraits.face,facialHair:ee.facialHair==="user"?(J=j.physical)==null?void 0:J.facialHair:K.extractedTraits.facialHair,other:ee.other==="user"?(q=j.physical)==null?void 0:q.other:K.extractedTraits.other,skinTone:ee.skinTone==="user"?(U=j.physical)==null?void 0:U.skinTone:K.extractedTraits.skinTone,skinToneHex:ee.skinTone==="user"?(oe=j.physical)==null?void 0:oe.skinToneHex:K.extractedTraits.skinToneHex,detailedHairAnalysis:K.extractedTraits.detailedHairAnalysis||((Ne=j.physical)==null?void 0:Ne.detailedHairAnalysis),apparentAge:ee.apparentAge==="user"?(qe=j.physical)==null?void 0:qe.apparentAge:K.extractedTraits.apparentAge||((We=j.physical)==null?void 0:We.apparentAge)}:j.physical,B=K.extractedTraits?{eyeColor:ee.eyeColor==="user"?"user":K.extractedTraits.eyeColor?"extracted":void 0,hairColor:ee.hairColor==="user"?"user":K.extractedTraits.hairColor?"extracted":void 0,hairLength:ee.hairLength==="user"?"user":K.extractedTraits.hairLength?"extracted":void 0,hairStyle:ee.hairStyle==="user"?"user":K.extractedTraits.hairStyle?"extracted":void 0,build:ee.build==="user"?"user":K.extractedTraits.build?"extracted":void 0,face:ee.face==="user"?"user":K.extractedTraits.face?"extracted":void 0,facialHair:ee.facialHair==="user"?"user":K.extractedTraits.facialHair?"extracted":void 0,other:ee.other==="user"?"user":K.extractedTraits.other?"extracted":void 0,skinTone:ee.skinTone==="user"?"user":K.extractedTraits.skinTone?"extracted":void 0,apparentAge:ee.apparentAge==="user"?"user":K.extractedTraits.apparentAge?"extracted":void 0}:j.physicalTraitsSource,H=K.extractedClothing?{...j.clothing,structured:{upperBody:K.extractedClothing.upperBody||void 0,lowerBody:K.extractedClothing.lowerBody||void 0,shoes:K.extractedClothing.shoes||void 0,fullBody:K.extractedClothing.fullBody||void 0}}:j.clothing;ve(M=>M&&{...M,avatars:ze,physical:O,physicalTraitsSource:B,clothing:H}),be(M=>M.map(ae=>ae.id===j.id?{...ae,avatars:ze,physical:O,physicalTraitsSource:B,clothing:H}:ae)),g.success(`âœ… Avatars WITH TRAITS regenerated for ${j.name}`),K.extractedTraits&&g.info(`ðŸ“‹ Extracted traits saved: ${JSON.stringify(K.extractedTraits)}`),K.extractedClothing&&g.info(`ðŸ‘• Extracted clothing saved: ${JSON.stringify(K.extractedClothing)}`)}else g.error(`âŒ Failed to regenerate avatars with traits: ${K.error}`),v(`Failed to regenerate avatars: ${K.error||"Unknown error"}`)}catch(K){g.error(`âŒ Failed to regenerate avatars with traits for ${j.name}:`,K),v(`Failed to regenerate avatars: ${K instanceof Error?K.message:"Unknown error"}`)}finally{Tr(!1)}}},un=async()=>{var c,w,p,N,I,R,k,J,q,U,oe,Ne,qe,We,K,ze;if(!j)return;const i={...j},h=j.id;Tr(!0);try{g.info(`ðŸ’¾ Saving character and regenerating avatars for ${i.name}...`),await ma(),g.info(`ðŸ”„ Regenerating avatars WITH TRAITS for ${i.name}...`);const O=(await new Promise(H=>{be(M=>(H(M),M))})).find(H=>H.id===h);if(!O){g.warn("Character not found in characters array after save");return}const B=await De.generateClothingAvatarsWithTraits(O);if(B.success&&B.avatars){const H={...B.avatars,stale:!1,generatedAt:new Date().toISOString()},M=O.physicalTraitsSource||{},ae=B.extractedTraits?{height:(c=O.physical)==null?void 0:c.height,eyeColor:M.eyeColor==="user"?(w=O.physical)==null?void 0:w.eyeColor:B.extractedTraits.eyeColor,eyeColorHex:M.eyeColor==="user"?(p=O.physical)==null?void 0:p.eyeColorHex:B.extractedTraits.eyeColorHex,hairColor:M.hairColor==="user"?(N=O.physical)==null?void 0:N.hairColor:B.extractedTraits.hairColor,hairColorHex:M.hairColor==="user"?(I=O.physical)==null?void 0:I.hairColorHex:B.extractedTraits.hairColorHex,hairLength:M.hairLength==="user"?(R=O.physical)==null?void 0:R.hairLength:B.extractedTraits.hairLength,hairStyle:M.hairStyle==="user"?(k=O.physical)==null?void 0:k.hairStyle:B.extractedTraits.hairStyle,build:M.build==="user"?(J=O.physical)==null?void 0:J.build:B.extractedTraits.build,face:M.face==="user"?(q=O.physical)==null?void 0:q.face:B.extractedTraits.face,facialHair:M.facialHair==="user"?(U=O.physical)==null?void 0:U.facialHair:B.extractedTraits.facialHair,other:M.other==="user"?(oe=O.physical)==null?void 0:oe.other:B.extractedTraits.other,skinTone:M.skinTone==="user"?(Ne=O.physical)==null?void 0:Ne.skinTone:B.extractedTraits.skinTone,skinToneHex:M.skinTone==="user"?(qe=O.physical)==null?void 0:qe.skinToneHex:B.extractedTraits.skinToneHex,detailedHairAnalysis:B.extractedTraits.detailedHairAnalysis||((We=O.physical)==null?void 0:We.detailedHairAnalysis),apparentAge:M.apparentAge==="user"?(K=O.physical)==null?void 0:K.apparentAge:B.extractedTraits.apparentAge||((ze=O.physical)==null?void 0:ze.apparentAge)}:O.physical,Ie=B.extractedTraits?{eyeColor:M.eyeColor==="user"?"user":B.extractedTraits.eyeColor?"extracted":void 0,hairColor:M.hairColor==="user"?"user":B.extractedTraits.hairColor?"extracted":void 0,hairLength:M.hairLength==="user"?"user":B.extractedTraits.hairLength?"extracted":void 0,hairStyle:M.hairStyle==="user"?"user":B.extractedTraits.hairStyle?"extracted":void 0,build:M.build==="user"?"user":B.extractedTraits.build?"extracted":void 0,face:M.face==="user"?"user":B.extractedTraits.face?"extracted":void 0,facialHair:M.facialHair==="user"?"user":B.extractedTraits.facialHair?"extracted":void 0,other:M.other==="user"?"user":B.extractedTraits.other?"extracted":void 0,skinTone:M.skinTone==="user"?"user":B.extractedTraits.skinTone?"extracted":void 0,apparentAge:M.apparentAge==="user"?"user":B.extractedTraits.apparentAge?"extracted":void 0}:O.physicalTraitsSource,W=B.extractedClothing?{...O.clothing,structured:{upperBody:B.extractedClothing.upperBody||void 0,lowerBody:B.extractedClothing.lowerBody||void 0,shoes:B.extractedClothing.shoes||void 0,fullBody:B.extractedClothing.fullBody||void 0}}:O.clothing;ve(Ze=>Ze&&Ze.id===h?{...Ze,avatars:H,physical:ae,physicalTraitsSource:Ie,clothing:W}:Ze),be(Ze=>Ze.map(it=>it.id===h?{...it,avatars:H,physical:ae,physicalTraitsSource:Ie,clothing:W}:it)),g.success(`âœ… Avatars regenerated for ${O.name}`);const Pe={...O,avatars:H,physical:ae,physicalTraitsSource:Ie,clothing:W},Le=(await new Promise(Ze=>{be(it=>(Ze(it),it))})).map(Ze=>Ze.id===h?Pe:Ze);await De.saveCharacterData({characters:Le,relationships:Ye,relationshipTexts:Et,customRelationships:xt,customStrengths:[],customWeaknesses:[],customFears:[]}),g.success("ðŸ’¾ Character saved with new avatars, traits, and clothing"),S(s==="de"?"Charakter gespeichert und Avatar regeneriert":"Character saved and avatar regenerated")}else g.error(`âŒ Failed to regenerate avatars: ${B.error}`),v(`Failed to regenerate avatars: ${B.error||"Unknown error"}`)}catch(ee){g.error("âŒ Failed to save and regenerate:",ee),v(`Failed: ${ee instanceof Error?ee.message:"Unknown error"}`)}finally{Tr(!1)}},gn=async()=>{var w,p,N,I,R,k,J,q,U,oe,Ne,qe,We,K,ze,ee,O,B;if(!j)return;const i=j.id;js(void 0),Ke("traits");const h=(w=j.avatars)==null?void 0:w.status,c=!!((p=j.avatars)!=null&&p.standard||(N=j.avatars)!=null&&N.winter||(I=j.avatars)!=null&&I.summer||(R=j.avatars)!=null&&R.hasFullAvatars);if(h==="generating"||h==="complete"&&c){g.info(`â­ï¸ Skipping avatar generation - already ${h}${c?" with avatars":""}`);return}wt(i),ve(H=>H&&H.id===i?{...H,avatars:{status:"generating"}}:H),g.info(`ðŸŽ¨ Starting avatar generation for ${j.name||"unnamed"} (id: ${i})...`);try{const H=await De.generateClothingAvatarsWithTraits(j);if(H.success&&H.avatars){const M={...H.avatars,stale:!1,generatedAt:new Date().toISOString()},ae=H.extractedTraits?{...j.physical,build:H.extractedTraits.build||((k=j.physical)==null?void 0:k.build),eyeColor:H.extractedTraits.eyeColor||((J=j.physical)==null?void 0:J.eyeColor),eyeColorHex:H.extractedTraits.eyeColorHex||((q=j.physical)==null?void 0:q.eyeColorHex),hairColor:H.extractedTraits.hairColor||((U=j.physical)==null?void 0:U.hairColor),hairColorHex:H.extractedTraits.hairColorHex||((oe=j.physical)==null?void 0:oe.hairColorHex),hairLength:H.extractedTraits.hairLength||((Ne=j.physical)==null?void 0:Ne.hairLength),hairStyle:H.extractedTraits.hairStyle||((qe=j.physical)==null?void 0:qe.hairStyle),facialHair:H.extractedTraits.facialHair||((We=j.physical)==null?void 0:We.facialHair),skinTone:H.extractedTraits.skinTone||((K=j.physical)==null?void 0:K.skinTone),skinToneHex:H.extractedTraits.skinToneHex||((ze=j.physical)==null?void 0:ze.skinToneHex),face:H.extractedTraits.face||((ee=j.physical)==null?void 0:ee.face),other:H.extractedTraits.other||((O=j.physical)==null?void 0:O.other),detailedHairAnalysis:H.extractedTraits.detailedHairAnalysis||((B=j.physical)==null?void 0:B.detailedHairAnalysis)}:j.physical,Ie=H.extractedClothing?{...j.clothing,structured:{upperBody:H.extractedClothing.upperBody||void 0,lowerBody:H.extractedClothing.lowerBody||void 0,shoes:H.extractedClothing.shoes||void 0,fullBody:H.extractedClothing.fullBody||void 0}}:j.clothing;be(W=>W.map(Pe=>Pe.id===i?{...Pe,avatars:M,physical:ae,clothing:Ie}:Pe)),ve(W=>W&&W.id===i?{...W,avatars:M,physical:ae,clothing:Ie}:W),g.success(`âœ… Avatar generated for ${j.name} (id: ${i})`)}else g.error(`âŒ Failed to generate avatar: ${H.error}`),v(`Failed to generate avatar: ${H.error||"Unknown error"}`),be(M=>M.map(ae=>ae.id===i?{...ae,avatars:{status:"failed"}}:ae)),ve(M=>M&&M.id===i?{...M,avatars:{status:"failed"}}:M)}catch(H){g.error("âŒ Avatar generation failed:",H),v(`Avatar generation failed: ${H instanceof Error?H.message:"Unknown error"}`),be(M=>M.map(ae=>ae.id===i?{...ae,avatars:{status:"failed"}}:ae)),ve(M=>M&&M.id===i?{...M,avatars:{status:"failed"}}:M)}finally{wt(null)}},ma=async()=>{var i;if(j){Q(!0);try{const h=kr.current,c=Yr.current;if(!h){g.warn("No current character to save");return}const w=h.id&&c.find(R=>R.id===h.id),p=w?c.map(R=>R.id===h.id?h:R):[...c,h];g.info("Saving characters with relationships:",p.length);const N=!w&&!!((i=h.photos)!=null&&i.original);await De.saveCharacterData({characters:p,relationships:Ye,relationshipTexts:Et,customRelationships:xt,customStrengths:[],customWeaknesses:[],customFears:[]},{includePhotos:N}),Vt.current=!1,g.success("Character data saved successfully"),be(p),la(p);const I=p.find(R=>R.id===j.id);I&&De.needsAvatars(I)&&fs!==I.id&&(g.info(`ðŸŽ¨ Starting background avatar generation for ${I.name}...`),De.generateAndSaveAvatarForCharacter(I,void 0,{avatarModel:st.avatarModel||void 0}).then(R=>{R.success&&R.character?(be(k=>k.map(J=>J.id===I.id?{...J,avatars:R.character.avatars,physical:R.character.physical,clothing:R.character.clothing}:J)),g.success(`âœ… Avatars and traits saved for ${I.name}`)):R.skipped||(g.warn(`Avatar generation failed for ${I.name}: ${R.error}`),be(k=>k.map(J=>J.id===I.id?{...J,avatars:{status:"failed"}}:J)))}).catch(R=>{g.error(`âŒ Background avatar generation error for ${I.name}:`,R),be(k=>k.map(J=>J.id===I.id?{...J,avatars:{status:"failed"}}:J))})),ve(null),Rt(!0)}catch(h){g.error("Failed to save character:",h),v(s==="de"?"Charakter konnte nicht gespeichert werden. Bitte versuche es erneut.":s==="fr"?"Ã‰chec de l'enregistrement du personnage. Veuillez rÃ©essayer.":"Failed to save character. Please try again.")}finally{Q(!1)}}},hn=async i=>{ve({...i}),Ke("traits"),Rt(!1);const h=await De.loadFullCharacter(i.id);h&&(ve(c=>c&&c.id===i.id?{...c,...h}:c),be(c=>c.map(w=>w.id===i.id?{...w,...h}:w)))},xn=async i=>{try{const h=await De.deleteCharacter(i);h.success?(be(c=>c.filter(w=>w.id!==i)),Ht(c=>{const w={...c};return Object.keys(w).forEach(p=>{(p.includes(`${i}-`)||p.includes(`-${i}`))&&delete w[p]}),w}),Ss(c=>{const w={...c};return Object.keys(w).forEach(p=>{(p.includes(`${i}-`)||p.includes(`-${i}`))&&delete w[p]}),w}),pt(c=>c.filter(w=>w!==i)),Ut.current=!0,g.success(`Character ${i} deleted`)):(g.error("Failed to delete character:",h.error),v(s==="de"?"Charakter konnte nicht gelÃ¶scht werden":"Failed to delete character"))}catch(h){g.error("Failed to delete character:",h),v(s==="de"?"Charakter konnte nicht gelÃ¶scht werden":"Failed to delete character")}},pn=(i,h,c)=>{const p=So(c,s),N=`${i}-${h}`,I=`${h}-${i}`;g.debug("Updating relationship:",N,"=",c,", inverse:",I,"=",p),Vt.current=!0,Ht(R=>({...R,[N]:c,[I]:p}))},fn=(i,h)=>{Vt.current=!0;const[c,w]=i.split("-").map(Number),p=`${w}-${c}`;Ss(N=>({...N,[i]:h,[p]:h}))},bn=(i,h)=>{Vt.current=!0,Wt(c=>[...c,{forward:i,inverse:h}])},yn=(i,h)=>{h==="out"?(Ft(c=>c.includes(i)?c:[...c,i]),pt(c=>c.filter(w=>w!==i))):h==="in"?(Ft(c=>c.filter(w=>w!==i)),pt(c=>c.filter(w=>w!==i))):h==="main"&&(Ft(c=>c.filter(w=>w!==i)),pt(c=>c.includes(i)?c:[...c,i])),Ut.current=!0,be(c=>c.map(w=>w.id===i?{...w,storyRole:h}:w))},vn=async()=>{const[i,h,c]=await Promise.all([new Promise(p=>{be(N=>(p(N),N))}),new Promise(p=>{pt(N=>(p(N),N))}),new Promise(p=>{Ft(N=>(p(N),N))})]);if(i.length===0)return;if(!Ut.current){g.debug("Roles not modified, skipping save");return}const w={};for(const p of i)h.includes(p.id)?w[p.id]="main":c.includes(p.id)?w[p.id]="out":w[p.id]="in";try{await De.saveCharacterRoles(w),Ut.current=!1}catch(p){g.error("Failed to save character roles:",p)}},ms=o.useRef(null),Jt=async i=>{i>=0&&i<=7&&(E===1&&j&&i!==1&&await ma(),E===1&&i!==1&&(ms.current=(async()=>{await Nn(),await vn()})(),ms.current.catch(h=>g.error("Background save failed:",h))),i===1&&E!==1&&ve(null),te(i),window.scrollTo(0,0))},jn=i=>i===1?!0:i===2||i===3?xe.length>0:i===4?xe.length>0&&we!=="":i===5?xe.length>0&&we!==""&&He!=="":i===6?Lr!=="":!1,jr=()=>E===1?xe.length>0&&St.length>0:E===2?!0:E===3?!(!we||we==="adventure"&&!Me||(we==="life-challenge"||we==="educational")&&!Fe||we==="historical"&&!Fe||we==="custom"&&!(ct!=null&&ct.trim())):E===4?He!=="":E===5?xe.filter(h=>!Xe.includes(h.id)).length>0&&St.length>0&&t.trim().length>0:!1,Nn=async()=>{const i=await new Promise(h=>{be(c=>(h(c),c))});if(i.length!==0){if(!Vt.current){g.debug("Relationships not modified, skipping save");return}try{g.debug("Auto-saving character data with latest state..."),await De.saveCharacterData({characters:i,relationships:Ye,relationshipTexts:Et,customRelationships:xt,customStrengths:[],customWeaknesses:[],customFears:[]}),Vt.current=!1,g.debug("Character data auto-saved")}catch(h){g.error("Failed to auto-save character data:",h)}}},wn=async()=>{if(E<5&&jr()){if(E===1&&xe.length===1){Ks(!0);return}await Jt(E+1)}},qa=async()=>{E>0&&await Jt(E-1)},Sn=(i,h)=>{f(i),Sa(h??null)},Ua=async()=>{fr.current&&fr.current.abort(),z(!0),se(!0),Qe(!0),zr([]),mt(null),Fr(""),Sa(null);const i=xe.filter(h=>!Xe.includes(h.id));Si({storyType:dt,storyCategory:we||"",storyTopic:Fe||"",storyTheme:Me||"",characters:i.map(h=>({id:h.id,name:h.name})),language:bt,languageLevel:ft,pages:at,userLocation:br||void 0,season:yr||void 0}),fr.current=Oe.generateStoryIdeasStream({storyType:dt,storyTypeName:us(),storyCategory:we||void 0,storyTopic:Fe||void 0,storyTheme:Me||void 0,customThemeText:Me==="custom"?ct:void 0,language:bt,languageLevel:ft,pages:at,characters:i.map(h=>({name:h.name,age:h.age,gender:h.gender,traits:h.traits,isMain:St.includes(h.id)})),relationships:Object.entries(Ye).map(([h,c])=>{const[w,p]=h.split("-").map(Number),N=i.find(R=>R.id===w),I=i.find(R=>R.id===p);return{character1:(N==null?void 0:N.name)||"",character2:(I==null?void 0:I.name)||"",relationship:c}}).filter(h=>h.character1&&h.character2),ideaModel:(x==null?void 0:x.role)==="admin"||T?st.ideaModel:void 0,userLocation:br||void 0,season:yr},{onStatus:(h,c,w)=>{c&&w&&mt({prompt:c,model:w})},onStory1:h=>{zr(c=>{const w=[...c];return w[0]=h,w}),Pt(100),se(!1)},onStory2:h=>{zr(c=>{const w=[...c];return w[1]=h,w}),Kt(100),Qe(!1)},onError:h=>{g.error("Failed to generate story ideas:",h),v(s==="de"?"Fehler beim Generieren von Ideen. Bitte versuchen Sie es erneut.":s==="fr"?"Erreur lors de la gÃ©nÃ©ration d'idÃ©es. Veuillez rÃ©essayer.":"Failed to generate ideas. Please try again."),z(!1),se(!1),Qe(!1)},onDone:h=>{z(!1),se(!1),Qe(!1),h&&Fr(h),fr.current=null,g.info("[IDEAS] onDone complete")}})},us=()=>{const i=ba.find(h=>h.id===dt);return i?i.name[s]:dt},Nr=async i=>{var c,w,p,N,I,R,k,J,q,U,oe,Ne,qe,We,K,ze;if(console.log("[generateStory] Called with overrides:",i),console.log("[generateStory] user:",x==null?void 0:x.email,"emailVerified:",x==null?void 0:x.emailVerified,"isImpersonating:",T),ms.current&&(await ms.current,ms.current=null),!(i!=null&&i.skipEmailCheck)&&!T&&x&&x.emailVerified!==!0){await P();const ee=localStorage.getItem("currentUser");let O=x.emailVerified;if(ee)try{O=JSON.parse(ee).emailVerified}catch{}if(O===!0)console.log("[generateStory] Email verified (confirmed after refresh), proceeding");else{console.log("[generateStory] Email not verified, showing modal"),localStorage.setItem("pendingStoryGeneration","true"),localStorage.setItem("pending_story_type",dt),localStorage.setItem("pending_art_style",He),ks(!0);return}}console.log("[generateStory] Starting generation, setting step to 6"),Br(!0),Cs(!1),te(6),sa({storyCategory:we||void 0,storyTopic:Fe||void 0,storyTheme:Me||void 0,storyTypeName:us(),storyDetails:t||void 0,artStyle:He||void 0,language:bt||void 0,languageLevel:ft||void 0,pages:at||void 0,dedication:zt||void 0,characters:xe.filter(ee=>!Xe.includes(ee.id)).map(ee=>({id:ee.id,name:ee.name})),mainCharacters:St,relationships:Ye,relationshipTexts:Et,season:yr||void 0,userLocation:br||void 0}),is(""),lr(""),It([]),ns([]),Ts(null),Is({}),Lt({frontCover:null,initialPage:null,backCover:null});const h=xe.filter(ee=>!Xe.includes(ee.id)).filter(ee=>!ee.avatars||ee.avatars.stale||ee.avatars.status!=="complete");if(h.length>0){console.log("[generateStory] Characters needing avatar regeneration:",h.map(ee=>ee.name)),vr({current:1,total:100,message:s==="de"?`Aktualisiere Avatare fÃ¼r ${h.length} Charakter(e)...`:s==="fr"?`Mise Ã  jour des avatars pour ${h.length} personnage(s)...`:`Updating avatars for ${h.length} character(s)...`});for(let ee=0;ee<h.length;ee++){const O=h[ee];try{console.log(`[generateStory] Regenerating avatars for ${O.name} (${ee+1}/${h.length})`),vr({current:2,total:100,message:s==="de"?`Generiere Avatare fÃ¼r ${O.name}...`:s==="fr"?`GÃ©nÃ©ration des avatars pour ${O.name}...`:`Generating avatars for ${O.name}...`});const B=await De.generateClothingAvatarsWithTraits(O);if(B.success&&B.avatars){const H={...B.avatars,stale:!1,generatedAt:new Date().toISOString()},M=O.physicalTraitsSource||{},ae=B.extractedTraits?{...O.physical,height:(c=O.physical)==null?void 0:c.height,build:M.build==="user"?(w=O.physical)==null?void 0:w.build:B.extractedTraits.build,eyeColor:M.eyeColor==="user"?(p=O.physical)==null?void 0:p.eyeColor:B.extractedTraits.eyeColor,eyeColorHex:M.eyeColor==="user"?(N=O.physical)==null?void 0:N.eyeColorHex:B.extractedTraits.eyeColorHex,hairColor:M.hairColor==="user"?(I=O.physical)==null?void 0:I.hairColor:B.extractedTraits.hairColor,hairColorHex:M.hairColor==="user"?(R=O.physical)==null?void 0:R.hairColorHex:B.extractedTraits.hairColorHex,hairLength:M.hairLength==="user"?(k=O.physical)==null?void 0:k.hairLength:B.extractedTraits.hairLength,hairStyle:M.hairStyle==="user"?(J=O.physical)==null?void 0:J.hairStyle:B.extractedTraits.hairStyle,facialHair:M.facialHair==="user"?(q=O.physical)==null?void 0:q.facialHair:B.extractedTraits.facialHair,skinTone:M.skinTone==="user"?(U=O.physical)==null?void 0:U.skinTone:B.extractedTraits.skinTone,skinToneHex:M.skinTone==="user"?(oe=O.physical)==null?void 0:oe.skinToneHex:B.extractedTraits.skinToneHex,face:M.face==="user"?(Ne=O.physical)==null?void 0:Ne.face:B.extractedTraits.face,other:M.other==="user"?(qe=O.physical)==null?void 0:qe.other:B.extractedTraits.other,detailedHairAnalysis:B.extractedTraits.detailedHairAnalysis||((We=O.physical)==null?void 0:We.detailedHairAnalysis),apparentAge:M.apparentAge==="user"?(K=O.physical)==null?void 0:K.apparentAge:B.extractedTraits.apparentAge||((ze=O.physical)==null?void 0:ze.apparentAge)}:O.physical,Ie=B.extractedTraits?{...M,build:M.build==="user"?"user":B.extractedTraits.build?"extracted":void 0,eyeColor:M.eyeColor==="user"?"user":B.extractedTraits.eyeColor?"extracted":void 0,hairColor:M.hairColor==="user"?"user":B.extractedTraits.hairColor?"extracted":void 0,hairLength:M.hairLength==="user"?"user":B.extractedTraits.hairLength?"extracted":void 0,hairStyle:M.hairStyle==="user"?"user":B.extractedTraits.hairStyle?"extracted":void 0,face:M.face==="user"?"user":B.extractedTraits.face?"extracted":void 0,facialHair:M.facialHair==="user"?"user":B.extractedTraits.facialHair?"extracted":void 0,other:M.other==="user"?"user":B.extractedTraits.other?"extracted":void 0,skinTone:M.skinTone==="user"?"user":B.extractedTraits.skinTone?"extracted":void 0,apparentAge:M.apparentAge==="user"?"user":B.extractedTraits.apparentAge?"extracted":void 0}:O.physicalTraitsSource,W=B.extractedClothing?{...O.clothing,structured:{upperBody:B.extractedClothing.upperBody||void 0,lowerBody:B.extractedClothing.lowerBody||void 0,shoes:B.extractedClothing.shoes||void 0,fullBody:B.extractedClothing.fullBody||void 0}}:O.clothing;be(Pe=>Pe.map(me=>me.id===O.id?{...me,avatars:H,physical:ae,physicalTraitsSource:Ie,clothing:W}:me)),ve(Pe=>Pe&&Pe.id===O.id?{...Pe,avatars:H,physical:ae,physicalTraitsSource:Ie,clothing:W}:Pe),be(Pe=>{const me=Pe.map(Le=>Le.id===O.id?{...Le,avatars:H,physical:ae,physicalTraitsSource:Ie,clothing:W}:Le);return De.saveCharacterData({characters:me,relationships:Ye,relationshipTexts:Et,customRelationships:xt,customStrengths:[],customWeaknesses:[],customFears:[]}).catch(Le=>console.error("Failed to save avatar update:",Le)),me}),console.log(`[generateStory] âœ… Avatars regenerated for ${O.name}`)}else console.warn(`[generateStory] âš ï¸ Failed to regenerate avatars for ${O.name}: ${B.error}`)}catch(B){console.error(`[generateStory] âŒ Error regenerating avatars for ${O.name}:`,B)}}}vr({current:5,total:100,message:s==="de"?"Starte Generierung...":s==="fr"?"DÃ©marrage de la gÃ©nÃ©ration...":"Starting generation..."});try{const ee=xe.filter(W=>!Xe.includes(W.id)),{jobId:O,creditsRemaining:B}=await Oe.createStoryJob({storyType:dt,storyTypeName:us(),storyCategory:we||void 0,storyTopic:Fe||void 0,storyTheme:Me||void 0,customThemeText:Me==="custom"?ct:void 0,artStyle:He,language:bt,languageLevel:ft,pages:at,dedication:zt,storyDetails:t,characters:ee,mainCharacters:St,relationships:Ye,relationshipTexts:Et,skipImages:(i==null?void 0:i.skipImages)??ge,imageGenMode:ye,generationMode:Se!=="auto"?Se:void 0,skipOutline:Be,skipText:Ve,skipSceneDescriptions:Ue,skipCovers:Ae,enableAutoRepair:_e,useGridRepair:vt,forceRepairThreshold:jt,enableFinalChecks:Jr,checkOnlyMode:lt,incrementalConsistency:mr?{enabled:!0,dryRun:ke,lookbackCount:he}:void 0,modelOverrides:(x==null?void 0:x.role)==="admin"||T?{outlineModel:st.outlineModel,textModel:st.textModel,sceneDescriptionModel:st.sceneDescriptionModel,imageModel:st.imageModel,coverImageModel:st.coverImageModel,qualityModel:st.qualityModel}:void 0,userLocation:br||void 0,season:yr||void 0,ideaGeneration:Ca&&ce&&Tt.length>0?{input:Ca,output:Tt,rawResponse:ss,prompt:ce.prompt,model:ce.model,selectedIndex:wi}:void 0});Ps(O),g.info("Story job created:",O),V(O,us()||"New Story"),B!=null&&A(B);let H=!1,M=0,ae=Date.now();const Ie=180*1e3;for(Mr(!1);!H;){await new Promise(Pe=>setTimeout(Pe,2e3));const W=await Oe.getJobStatus(O);if(W.progress&&(W.progress.current!==M?(g.debug(`Progress: ${W.progress.current}% - ${W.progress.message||""}`),M=W.progress.current,ae=Date.now(),Mr(!1)):Date.now()-ae>=Ie&&Mr(!0),vr(Pe=>W.progress.current>=Pe.current?W.progress:W.progress.message?{...Pe,message:W.progress.message}:Pe)),W.partialCovers){let Pe=!1;Lt(me=>{var Ze,it,Es;const Le={...me};if((Ze=W.partialCovers)!=null&&Ze.frontCover&&!me.frontCover){Le.frontCover=W.partialCovers.frontCover,g.debug("Front cover received during streaming");const $t=W.partialCovers.frontCover;typeof $t=="object"&&($t!=null&&$t.storyTitle)&&(lr($t.storyTitle),g.debug(`Story title from front cover: ${$t.storyTitle}`)),Pe=!0}return(it=W.partialCovers)!=null&&it.initialPage&&!me.initialPage&&(Le.initialPage=W.partialCovers.initialPage,g.debug("Initial page cover received during streaming")),(Es=W.partialCovers)!=null&&Es.backCover&&!me.backCover&&(Le.backCover=W.partialCovers.backCover,g.debug("Back cover received during streaming")),Le}),Pe&&(g.debug("Transitioning to StoryDisplay - front cover ready"),te(6))}if(W.storyText&&!yt&&(Ts(W.storyText),lr(W.storyText.title),g.debug(`Story text received: ${W.storyText.totalPages} pages ready for display`)),W.partialPages&&W.partialPages.length>0&&Is(Pe=>{var Ze;const me={...Pe};let Le=0;return(Ze=W.partialPages)==null||Ze.forEach(it=>{it.imageData&&!Pe[it.pageNumber]&&(me[it.pageNumber]=it.imageData,Le++)}),Le>0&&g.debug(`${Le} new page images received (total: ${Object.keys(me).length})`),me}),console.log("[StoryWizard] Job status check:",{status:W.status,hasResult:!!W.result,resultKeys:W.result?Object.keys(W.result):[],progress:W.progress}),W.status==="completed"&&W.result)ta(W.result.storyId),lr(W.result.title),$a(W.result.outline),Da(W.result.outlinePrompt||""),Ra(W.result.outlineModelId),Ea(W.result.outlineUsage),Fa(W.result.storyTextPrompts||[]),Zs(W.result.styledAvatarGeneration||[]),Ys(W.result.costumedAvatarGeneration||[]),Xs(W.result.generationLog||[]),za(W.result.finalChecksReport||null),W.result.visualBible?Gr({mainCharacters:W.result.visualBible.mainCharacters||[],secondaryCharacters:W.result.visualBible.secondaryCharacters||[],animals:W.result.visualBible.animals||[],artifacts:W.result.visualBible.artifacts||[],locations:W.result.visualBible.locations||[],vehicles:W.result.visualBible.vehicles||[],clothing:W.result.visualBible.clothing||[],changeLog:W.result.visualBible.changeLog||[]}):Gr(null),W.result.clothingRequirements?As(W.result.clothingRequirements):As(null),is(W.result.story),Ia(W.result.story),ns(W.result.sceneDescriptions||[]),It(W.result.sceneImages||[]),Lt(W.result.coverImages||{frontCover:null,initialPage:null,backCover:null}),Ts(null),Is({}),H=!0,W.currentCredits!==null&&W.currentCredits!==void 0&&A(W.currentCredits),te(6),g.success("Story generation completed!"),sa({storyCategory:we||void 0,storyTopic:Fe||void 0,storyTheme:Me||void 0,storyTypeName:us(),storyDetails:t||void 0,artStyle:He||void 0,language:bt||void 0,languageLevel:ft||void 0,pages:at||void 0,dedication:zt||void 0,characters:xe.map(Pe=>({id:Pe.id,name:Pe.name})),mainCharacters:St,relationships:Ye,relationshipTexts:Et,season:yr||void 0,userLocation:br||void 0}),aa.current=!0,d();else if(W.status==="failed")throw new Error(W.error||"Story generation failed")}vr({current:100,total:100,message:s==="de"?"Fertig!":s==="fr"?"TerminÃ©!":"Complete!"})}catch(ee){g.error("Generation failed:",ee);const O=ee instanceof Error?ee.message:String(ee);if(O.includes("already in progress")){const B=O.match(/\|ACTIVE_JOB:(job_[a-z0-9_]+)/i),H=B?B[1]:null,M=s==="de"?"Eine Geschichte wird bereits erstellt. MÃ¶chtest du diese abbrechen und eine neue starten?":s==="fr"?"Une histoire est dÃ©jÃ  en cours de crÃ©ation. Voulez-vous l'annuler et en commencer une nouvelle?":"A story is already being generated. Would you like to cancel it and start a new one?";if(H&&window.confirm(M))try{await Oe.cancelJob(H),g.info("Cancelled existing job:",H),await Nr(i);return}catch(ae){g.error("Failed to cancel existing job:",ae),v(s==="de"?"Abbrechen fehlgeschlagen. Bitte versuche es spÃ¤ter erneut.":s==="fr"?"Ã‰chec de l'annulation. Veuillez rÃ©essayer plus tard.":"Failed to cancel. Please try again later.")}Br(!1);return}else v(s==="de"?`Generierung fehlgeschlagen: ${O}`:s==="fr"?`Ã‰chec de la gÃ©nÃ©ration: ${O}`:`Generation failed: ${O}`)}finally{Mr(!1),d(),setTimeout(()=>Br(!1),500)}};o.useEffect(()=>{if(Rs.current&&C&&xe.length>0&&E===5&&!or){Rs.current=!1;const i=localStorage.getItem("verificationGenerationStarted");if(i){const c=parseInt(i,10),w=Date.now()-120*1e3;if(c>w){console.log("Another window already started generation, skipping auto-generate");return}localStorage.removeItem("verificationGenerationStarted")}localStorage.setItem("verificationGenerationStarted",Date.now().toString()),(async()=>{await P(),setTimeout(()=>{Nr({skipEmailCheck:!0})},500)})()}},[C,xe,E,or,P]);const Cn=()=>{switch(E){case 1:return e.jsx(Ro,{characters:xe,currentCharacter:j,characterStep:Ar,showCharacterCreated:ot,isLoading:Y,isAnalyzingPhoto:Pr,isGeneratingAvatar:fs===(j==null?void 0:j.id),isRegeneratingAvatars:bs,isRegeneratingAvatarsWithTraits:gr,developerMode:pe,isImpersonating:T,changedTraits:vs,photoAnalysisDebug:Ns,mainCharacters:St,excludedCharacters:Xe,onCharacterRoleChange:yn,onCharacterChange:ve,onCharacterStepChange:Ke,onContinueToAvatar:()=>Ke("avatar"),onPhotoSelect:on,onSaveAndGenerateAvatar:gn,onSaveCharacter:ma,onEditCharacter:hn,onDeleteCharacter:xn,onStartNewCharacter:ca,onRegenerateAvatars:cn,onRegenerateAvatarsWithTraits:mn,onSaveAndRegenerateWithTraits:un,onSaveAndTryNewPhoto:async()=>{var c;if(g.info(`ðŸ“¸ onSaveAndTryNewPhoto called, currentCharacter: ${j==null?void 0:j.name}`),!j){g.warn("ðŸ“¸ No currentCharacter, returning early");return}Q(!0);try{const w=j.id&&xe.find(I=>I.id===j.id),p=w?xe.map(I=>I.id===j.id?j:I):[...xe,j],N=!w&&!!((c=j.photos)!=null&&c.original);await De.saveCharacterData({characters:p,relationships:Ye,relationshipTexts:Et,customRelationships:xt,customStrengths:[],customWeaknesses:[],customFears:[]},{includePhotos:N}),be(p),la(p),g.info(`ðŸ“¸ Setting characterStep to 'photo', currentCharacter still: ${j==null?void 0:j.name}`),Ke("photo")}catch(w){g.error("ðŸ“¸ Error saving character:",w)}finally{Q(!1),g.info("ðŸ“¸ onSaveAndTryNewPhoto complete, characterStep should now be 'photo'")}},relationships:Ye,relationshipTexts:Et,onRelationshipChange:pn,onRelationshipTextChange:fn,customRelationships:xt,onAddCustomRelationship:bn});case 2:return e.jsx(Eo,{languageLevel:ft,onLanguageLevelChange:xr,pages:at,onPagesChange:Rr,storyLanguage:bt,onStoryLanguageChange:rs,developerMode:pe,userLocation:br,onLocationChange:ka,season:yr,onSeasonChange:Ci,userCredits:T?-1:(x==null?void 0:x.credits)??0});case 3:return e.jsx(Fo,{storyCategory:we,storyTopic:Fe,storyTheme:Me,customThemeText:ct,onCategoryChange:Xi,onTopicChange:tn,onThemeChange:en,onCustomThemeTextChange:rr,onLegacyStoryTypeChange:Xt});case 4:return e.jsx(zo,{artStyle:He,onArtStyleChange:rn});case 5:return e.jsx(Bo,{characters:xe,mainCharacters:St,excludedCharacters:Xe,storyCategory:we,storyTopic:Fe,storyTheme:Me,customThemeText:ct,onCustomThemeTextChange:rr,artStyle:He,storyLanguage:bt,languageLevel:ft,pages:at,userLocation:br,season:yr,storyDetails:t,onStoryDetailsChange:f,dedication:zt,onDedicationChange:Er,onGenerateIdeas:Ua,isGeneratingIdeas:b,isGeneratingIdea1:u,isGeneratingIdea2:de,ideaProgress1:Bt,ideaProgress2:pr,ideaPrompt:ce,ideaFullResponse:ss,generatedIdeas:Tt,onSelectIdea:Sn,onUseDirectly:()=>Nr(),onEditStep:Jt,developerMode:pe,imageGenMode:ye,onImageGenModeChange:le,generationMode:Se,onGenerationModeChange:Ee});case 6:const i=os.frontCover||os.initialPage||Object.keys(ia).length>0||ea.some(c=>c.imageData);if(Lr&&i||yt&&i||or&&i){const c=Lr?ea:Object.entries(ia).map(([p,N])=>{var I;return{pageNumber:parseInt(p),imageData:N,description:((I=yt==null?void 0:yt.sceneDescriptions.find(R=>R.pageNumber===parseInt(p)))==null?void 0:I.description)||""}}),w=Lr||Object.entries((yt==null?void 0:yt.pageTexts)||{}).sort(([p],[N])=>parseInt(p)-parseInt(N)).map(([p,N])=>`--- Page ${p} ---
${N}`).join(`

`);return e.jsxs(e.Fragment,{children:[Mt&&Mt.total>0&&e.jsxs("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 bg-white/95 backdrop-blur-sm rounded-full shadow-lg px-4 py-2 flex items-center gap-3 border border-indigo-100",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300 ease-out",style:{width:`${Mt.loaded/Mt.total*100}%`}})}),e.jsx("span",{className:"text-sm text-gray-600 whitespace-nowrap",children:s==="de"?`Bilder: ${Mt.loaded}/${Mt.total}`:s==="fr"?`Images: ${Mt.loaded}/${Mt.total}`:`Images: ${Mt.loaded}/${Mt.total}`})]}),e.jsx(ho,{title:Qs,dedication:zt||void 0,story:w,originalStory:Ei,outline:Fi,outlinePrompt:zi,outlineModelId:Bi,outlineUsage:Mi,storyTextPrompts:Li,visualBible:Gi||void 0,sceneImages:c,sceneDescriptions:(yt==null?void 0:yt.sceneDescriptions)||qi,characters:Zr||xe.filter(p=>!Xe.includes(p.id)),progressiveMode:or,progressiveData:yt||void 0,completedPageImages:ia,coverImages:os,regeneratingCovers:ki,languageLevel:ft,storyLanguage:bt,isGenerating:or,developerMode:pe,styledAvatarGeneration:_i,costumedAvatarGeneration:Hi,generationLog:Wi,finalChecksReport:Vi,clothingRequirements:Oi||void 0,storyId:je,onVisualBibleChange:je?async p=>{try{g.info("Updating Visual Bible for story:",je),await Oe.updateVisualBible(je,p),Gr(p),g.success("Visual Bible updated successfully")}catch(N){g.error("Failed to update Visual Bible:",N),v(s==="de"?"Visual Bible konnte nicht aktualisiert werden":s==="fr"?"Ã‰chec de la mise Ã  jour de la Bible Visuelle":"Failed to update Visual Bible")}}:void 0,onRegenerateImage:je?async(p,N,I)=>{var R;try{g.info("Regenerating image for page:",p,N?"(scene edited)":"",I?`(${I.length} characters)`:"");const k=await Oe.regenerateImage(je,p,N,I);if(g.info("Regenerate result:",{hasImageData:!!(k!=null&&k.imageData),length:(R=k==null?void 0:k.imageData)==null?void 0:R.length,versionCount:k==null?void 0:k.versionCount,creditsRemaining:k==null?void 0:k.creditsRemaining}),!(k!=null&&k.imageData))throw g.error("No imageData in response!",k),new Error("No image data returned from server");It(J=>J.map(q=>q.pageNumber===p?{...q,imageData:k.imageData,description:k.newDescription||q.description,prompt:k.newPrompt,qualityScore:k.qualityScore,qualityReasoning:k.qualityReasoning,totalAttempts:k.totalAttempts,retryHistory:k.retryHistory,wasRegenerated:!0,originalImage:k.originalImage,originalScore:k.originalScore,originalReasoning:k.originalReasoning,imageVersions:k.imageVersions}:q)),k.creditsRemaining!==void 0&&A&&A(k.creditsRemaining),g.info("Image regenerated successfully, updated state")}catch(k){g.error("Image regeneration failed:",k);const J=k instanceof Error?k.message:String(k);v(s==="de"?`Bildgenerierung fehlgeschlagen: ${J}`:s==="fr"?`Ã‰chec de la rÃ©gÃ©nÃ©ration: ${J}`:`Image regeneration failed: ${J}`)}}:void 0,onDownloadTxt:()=>{const p=new Blob([Lr],{type:"text/plain"}),N=URL.createObjectURL(p),I=document.createElement("a");I.href=N,I.download=`${Qs}.txt`,I.click(),URL.revokeObjectURL(N)},onDownloadPdf:je?async p=>{try{const N=await Oe.generatePdf(je,p),I=URL.createObjectURL(N),R=document.createElement("a");R.href=I,R.download=`${Qs}.pdf`,R.click(),URL.revokeObjectURL(I)}catch(N){g.error("PDF download failed:",N),v(s==="de"?"PDF-Download fehlgeschlagen":s==="fr"?"Ã‰chec du tÃ©lÃ©chargement PDF":"PDF download failed")}}:void 0,onAddToBook:je?()=>{try{const p=sessionStorage.getItem("mystories_selected"),N=p?JSON.parse(p):[];N.includes(je)||(N.push(je),sessionStorage.setItem("mystories_selected",JSON.stringify(N))),g.info("Added story to book selection:",je),S(s==="de"?"Geschichte zum Buch hinzugefÃ¼gt. Du kannst weitere hinzufÃ¼gen oder das Buch bestellen.":s==="fr"?"Histoire ajoutÃ©e au livre. Vous pouvez en ajouter d'autres ou commander le livre.":"Story added to book. You can add more or order the book.",s==="de"?"Zum Buch hinzugefÃ¼gt":s==="fr"?"AjoutÃ© au livre":"Added to Book"),r("/stories")}catch(p){g.error("Failed to add story to selection:",p)}}:void 0,onPrintBook:je?async()=>{let p=await Yn.getShippingAddress();if(!p){const R=prompt(s==="de"?"Keine Adresse gespeichert. Bitte eingeben (Format: Vorname, Nachname, Strasse, PLZ, Ort, Land, Email):":s==="fr"?"Aucune adresse enregistrÃ©e. Veuillez entrer (Format: PrÃ©nom, Nom, Rue, CP, Ville, Pays, Email):":"No saved address. Please enter (Format: FirstName, LastName, Street, PostCode, City, Country, Email):");if(!R)return;const k=R.split(",").map(J=>J.trim());if(k.length<7){v(s==="de"?"UngÃ¼ltiges Adressformat":s==="fr"?"Format d'adresse invalide":"Invalid address format");return}p={firstName:k[0],lastName:k[1],addressLine1:k[2],postCode:k[3],city:k[4],country:k[5],email:k[6]}}const N=`${p.firstName} ${p.lastName}
${p.addressLine1}
${p.postCode} ${p.city}
${p.country}`,I=s==="de"?`Druckauftrag an folgende Adresse senden?

${N}`:s==="fr"?`Envoyer la commande Ã  cette adresse?

${N}`:`Send print order to this address?

${N}`;if(confirm(I))try{g.info("Creating print order for story:",je);const R=await Oe.createPrintOrder(je,{firstName:p.firstName,lastName:p.lastName,addressLine1:p.addressLine1,city:p.city,postCode:p.postCode,country:p.country,email:p.email||""}),k=s==="de"?`âœ… Druckauftrag erfolgreich erstellt!

Order ID: ${R.orderId}
${R.isDraft?"(Entwurf - muss in Gelato bestÃ¤tigt werden)":""}

MÃ¶chten Sie das Gelato Dashboard Ã¶ffnen, um den Auftrag zu verfolgen?`:s==="fr"?`âœ… Commande d'impression crÃ©Ã©e avec succÃ¨s!

ID de commande: ${R.orderId}
${R.isDraft?"(Brouillon - doit Ãªtre confirmÃ© dans Gelato)":""}

Voulez-vous ouvrir le tableau de bord Gelato pour suivre la commande?`:`âœ… Print order created successfully!

Order ID: ${R.orderId}
${R.isDraft?"(Draft - must be confirmed in Gelato)":""}

Would you like to open the Gelato dashboard to track your order?`;R.dashboardUrl&&confirm(k)?window.open(R.dashboardUrl,"_blank"):R.dashboardUrl||S(s==="de"?`Druckauftrag erstellt! Order ID: ${R.orderId}`:s==="fr"?`Commande crÃ©Ã©e! ID: ${R.orderId}`:`Print order created! Order ID: ${R.orderId}`)}catch(R){g.error("Print order failed:",R);const k=R instanceof Error?R.message:String(R);v(s==="de"?`Druckauftrag fehlgeschlagen: ${k}`:s==="fr"?`Ã‰chec de la commande d'impression: ${k}`:`Print order failed: ${k}`)}}:void 0,onCreateAnother:()=>{g.info("Creating new story - resetting settings"),ta(null),Ps(null),Te(null);const p=new URLSearchParams(l);p.delete("storyId"),n(p,{replace:!0}),is(""),lr(""),ns([]),It([]),Lt({frontCover:null,initialPage:null,backCover:null}),Ba(!1),Ma(void 0),La(void 0),Ga(void 0),Xt(""),er(""),tr(""),Cr(""),At("watercolor"),xr("standard"),Rr(30),Er(""),f(""),localStorage.removeItem("story_type"),localStorage.removeItem("story_category"),localStorage.removeItem("story_topic"),localStorage.removeItem("story_theme"),localStorage.removeItem("story_art_style"),localStorage.removeItem("story_language_level"),localStorage.removeItem("story_pages"),localStorage.removeItem("story_dedication"),localStorage.removeItem("story_details"),localStorage.removeItem("wizard_step"),localStorage.removeItem("verificationGenerationStarted"),ve(null),Ke("photo"),te(1)},onRegenerateCover:je?async(p,N,I,R,k)=>{const J=p==="front"?"frontCover":p==="back"?"backCover":"initialPage";try{g.info("Regenerating cover:",p,N?`with scene: "${N.substring(0,50)}..."`:"",I?`with ${I.length} characters`:""),Aa(U=>new Set(U).add(J));const q=await Oe.regenerateCover(je,p,N,I,R,k);Lt(U=>U&&{...U,[p==="front"?"frontCover":p==="back"?"backCover":"initialPage"]:{imageData:q.imageData,description:q.description,prompt:q.prompt,qualityScore:q.qualityScore,qualityReasoning:q.qualityReasoning,totalAttempts:q.totalAttempts,retryHistory:q.retryHistory,referencePhotos:q.referencePhotos,wasRegenerated:q.wasRegenerated,regenerationCount:q.regenerationCount,previousImage:q.previousImage,previousScore:q.previousScore,originalImage:q.originalImage,originalScore:q.originalScore,modelId:q.modelId}}),q.creditsRemaining!==void 0&&A&&A(q.creditsRemaining),g.info("Cover regenerated successfully")}catch(q){g.error("Cover regeneration failed:",q);const U=q instanceof Error?q.message:String(q);v(s==="de"?`Cover-Generierung fehlgeschlagen: ${U}`:s==="fr"?`Ã‰chec de la rÃ©gÃ©nÃ©ration: ${U}`:`Cover regeneration failed: ${U}`)}finally{Aa(q=>{const U=new Set(q);return U.delete(J),U})}}:void 0,onEditImage:p=>{Ds({type:"image",pageNumber:p}),ds(""),$s(!0)},onEditCover:p=>{Ds({type:"cover",coverType:p}),ds(""),$s(!0)},onRepairImage:je&&((x==null?void 0:x.role)==="admin"||T)?async p=>{var N,I,R;try{g.info("Starting auto-repair for page:",p);const k=ea.find(U=>U.pageNumber===p);let J=k==null?void 0:k.fixTargets;if(!J||J.length===0){const U=(I=(N=k==null?void 0:k.retryHistory)==null?void 0:N.filter(oe=>oe.type==="auto_repair"))==null?void 0:I.slice(-1)[0];(R=U==null?void 0:U.preRepairEval)!=null&&R.fixTargets&&U.preRepairEval.fixTargets.length>0&&(J=U.preRepairEval.fixTargets,g.info(`Using ${J.length} fix targets from retryHistory.preRepairEval`))}J&&J.length>0?g.info(`Using ${J.length} existing fix targets`):g.info("No stored fix targets found, will re-evaluate");const q=await Oe.repairImage(je,p,J);q.repaired?(It(U=>U.map(oe=>oe.pageNumber===p?{...oe,imageData:q.imageData,wasAutoRepaired:!0,repairHistory:q.repairHistory,repairedAt:new Date().toISOString()}:oe)),g.info("Auto-repair completed successfully:",{repaired:q.repaired,repairs:q.repairHistory.length})):q.noErrorsFound&&g.info("No physics errors detected in the image")}catch(k){throw g.error("Auto-repair failed:",k),k}}:void 0,onRevertRepair:je&&((x==null?void 0:x.role)==="admin"||T)?async(p,N)=>{try{g.info("Reverting repair for page:",p),It(I=>I.map(R=>R.pageNumber===p?{...R,imageData:N,wasAutoRepaired:!1}:R)),await Oe.updateSceneImage(je,p,N),g.info("Repair reverted successfully")}catch(I){throw g.error("Failed to revert repair:",I),I}}:void 0,onSaveStoryText:je?async p=>{try{g.info("Saving story text for story:",je),await Oe.saveStoryText(je,p),is(p),g.info("Story text saved successfully")}catch(N){throw g.error("Failed to save story text:",N),N}}:void 0,onSaveTitleChange:je?async p=>{try{g.info("Saving title for story:",je,p),await Oe.saveStoryTitle(je,p),lr(p),g.info("Title saved successfully")}catch(N){throw g.error("Failed to save title:",N),N}}:void 0,userCredits:T?-1:(x==null?void 0:x.credits)||0,imageRegenerationCost:5,isImpersonating:T,onSelectImageVersion:je?async(p,N)=>{try{g.info("Selecting image version:",{pageNumber:p,versionIndex:N});const I=await Oe.setActiveImage(je,p,N);It(R=>R.map(k=>{if(k.pageNumber===p&&k.imageVersions){const J=k.imageVersions[N];return{...k,imageData:(J==null?void 0:J.imageData)||k.imageData,imageVersions:k.imageVersions.map((q,U)=>({...q,isActive:U===N}))}}return k})),g.info("Image version selected:",I)}catch(I){throw g.error("Failed to select image version:",I),I}}:void 0,isPartial:Ui,failureReason:Ki,generatedPages:Ji,totalPages:Qi,generationSettings:Zi||void 0})]})}return l.get("storyId")?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center",children:[e.jsx(gt,{className:"w-12 h-12 text-indigo-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:s==="de"?"Geschichte wird geladen...":s==="fr"?"Chargement de l'histoire...":"Loading story..."})]}):or?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-indigo-700",children:s==="de"?"Geschichte wird erstellt...":s==="fr"?"CrÃ©ation de l'histoire...":"Creating your story..."}),e.jsx("p",{className:"text-indigo-500 mt-2",children:s==="de"?"Einen Moment Geduld bitte":s==="fr"?"Veuillez patienter":"Please wait a moment"})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ur,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:y.generateStory}),e.jsx("p",{className:"text-gray-600 mb-6",children:s==="de"?"Bereit, deine Geschichte zu erstellen!":s==="fr"?"PrÃªt Ã  crÃ©er votre histoire!":"Ready to create your story!"}),e.jsxs(_s,{onClick:()=>Nr(),size:"lg",icon:Ur,children:[y.generateStory," (",at*10," Credits)"]})]});default:return null}};return C?e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(Dn,{currentStep:E,onStepClick:Jt,canAccessStep:jn,developerMode:pe,onDeveloperModeChange:fe,hideSteps:E===6&&!!je,onShowGenerationProgress:()=>{Cs(!1),te(6)}}),e.jsx("div",{className:"px-3 md:px-8 mt-2 md:mt-8 flex-1",children:e.jsxs("div",{className:"md:bg-white md:rounded-2xl md:shadow-xl md:p-8",children:[Y&&!or?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center",children:[e.jsx(gt,{className:"w-12 h-12 text-indigo-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium mb-2",children:$?s==="de"?"Geschichte wird geladen...":s==="fr"?"Chargement de l'histoire...":"Loading story...":s==="de"?"Wird geladen...":s==="fr"?"Chargement...":"Loading..."}),$&&e.jsxs("div",{className:"w-64 mt-2",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all duration-300 ease-out",style:{width:$.total?`${Math.min(100,$.loaded/$.total*100)}%`:"100%"}})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2 text-center",children:[($.loaded/(1024*1024)).toFixed(1)," MB",$.total&&e.jsxs("span",{children:[" (",Math.round($.loaded/$.total*100),"%)"]})]})]})]}):e.jsxs(e.Fragment,{children:[E>=1&&E<=5&&!j&&e.jsx(so,{step:E,text:(pi[s]||pi.en)[E]}),e.jsx(o.Suspense,{fallback:e.jsx(Ja,{}),children:Cn()})]}),E<6&&!j&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[E===1&&xe.length>=2&&!sn()&&(()=>{const i=an();if(!i)return null;const h=s==="de"?`${i.name} hat Beziehungen, die nicht definiert sind ("nicht bekannt")`:s==="fr"?`${i.name} a des relations non dÃ©finies ("ne connaÃ®t pas")`:`${i.name} has undefined relationships ("not known to")`;return e.jsxs("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-600 text-lg",children:"âš ï¸"}),e.jsx("p",{className:"text-amber-700 text-sm",children:h})]})})(),E!==5&&e.jsxs("div",{className:`flex ${E===1?"justify-end":"justify-between"}`,children:[E>1&&e.jsxs("button",{onClick:qa,className:"bg-transparent text-gray-800 hover:bg-gray-100 px-6 py-3 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(ri,{size:20})," ",y.back]}),e.jsxs("button",{onClick:wn,disabled:!jr(),className:`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${jr()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[y.next," ",e.jsx(Gn,{size:20})]})]}),E===5&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>Nr(),disabled:!jr(),className:`w-full py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 ${jr()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-400 text-white cursor-not-allowed"}`,children:[e.jsx(Ur,{size:20})," ",y.generateStory," (",at*10," Credits)"]}),pe&&e.jsxs("button",{onClick:()=>Nr({skipImages:!0}),disabled:!jr(),className:`w-full py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 ${jr()?"bg-yellow-500 text-white hover:bg-yellow-600":"bg-gray-400 text-white cursor-not-allowed"}`,children:[e.jsx(Ur,{size:20}),s==="de"?"Nur Text generieren (ohne Bilder)":s==="fr"?"GÃ©nÃ©rer le texte uniquement (sans images)":"Generate Text Only (no images)"]}),pe&&e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg text-left",children:[e.jsxs("h3",{className:"text-sm font-semibold text-orange-700 mb-3",children:["ðŸ› ï¸ ",s==="de"?"Entwickler-Optionen - Schritte Ã¼berspringen":s==="fr"?"Options dÃ©veloppeur - Sauter des Ã©tapes":"Developer Options - Skip Steps"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Be,onChange:i=>X(i.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Gliederung Ã¼berspringen":s==="fr"?"Sauter le plan":"Skip outline generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Ve,onChange:i=>Ce(i.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Text Ã¼berspringen":s==="fr"?"Sauter le texte":"Skip text generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Ue,onChange:i=>ue(i.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Szenenbeschreibungen Ã¼berspringen":s==="fr"?"Sauter les descriptions de scÃ¨nes":"Skip scene descriptions"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ge,onChange:i=>_(i.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Bilder Ã¼berspringen":s==="fr"?"Sauter les images":"Skip image generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Ae,onChange:i=>tt(i.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Cover Ã¼berspringen":s==="fr"?"Sauter les couvertures":"Skip cover images"})]})]}),e.jsx("p",{className:"text-xs text-orange-600 mt-2",children:s==="de"?"Hinweis: Ãœbersprungene Schritte verwenden Platzhalter/leere Daten":s==="fr"?"Note: Les Ã©tapes sautÃ©es utiliseront des donnÃ©es vides/provisoires":"Note: Skipped steps will use placeholder/empty data"}),e.jsxs("h3",{className:"text-sm font-semibold text-orange-700 mt-4 mb-2",children:["ðŸ”§ ",s==="de"?"Feature-Optionen":s==="fr"?"Options de fonctionnalitÃ©s":"Feature Options"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:_e,onChange:i=>ht(i.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Auto-Reparatur aktivieren":s==="fr"?"Activer la rÃ©paration auto":"Enable auto-repair"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:s==="de"?"Versucht erkannte Bildfehler automatisch zu korrigieren (z.B. fehlende Finger)":s==="fr"?"Essaie de corriger automatiquement les erreurs d'image dÃ©tectÃ©es":"Attempts to automatically fix detected image issues (e.g., missing fingers)"}),_e&&e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2 ml-6",children:[e.jsx("input",{type:"checkbox",checked:vt,onChange:i=>Yt(i.target.checked),className:"rounded border-violet-300 text-violet-600 focus:ring-violet-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Grid-Reparatur verwenden":s==="fr"?"Utiliser la rÃ©paration en grille":"Use grid repair"})]}),_e&&e.jsx("p",{className:"text-xs text-gray-500 ml-12",children:s==="de"?"Extrahiert Problemregionen in ein Grid, repariert mit Gemini, verifiziert mit LPIPS+LLM":s==="fr"?"Extrait les rÃ©gions problÃ©matiques dans une grille, rÃ©pare avec Gemini, vÃ©rifie avec LPIPS+LLM":"Extracts issue regions to grid, repairs with Gemini, verifies with LPIPS+LLM"}),_e&&e.jsxs("div",{className:"mt-2 ml-6",children:[e.jsxs("label",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx("span",{children:s==="de"?"Reparatur-Schwelle:":s==="fr"?"Seuil de rÃ©paration:":"Force repair threshold:"}),e.jsxs("select",{value:jt===null?"default":jt,onChange:i=>Vs(i.target.value==="default"?null:parseInt(i.target.value)),className:"border border-gray-300 rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:"default",children:s==="de"?"Standard (nur bei Fehler)":s==="fr"?"DÃ©faut (seulement si erreur)":"Default (only on failure)"}),e.jsx("option",{value:"100",children:s==="de"?"100% (immer reparieren)":s==="fr"?"100% (toujours rÃ©parer)":"100% (always repair)"}),e.jsx("option",{value:"90",children:"90%"}),e.jsx("option",{value:"80",children:"80%"}),e.jsx("option",{value:"75",children:"75%"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s==="de"?"Bei 100% werden alle Seiten mit Problemen repariert, auch wenn sie die QualitÃ¤tsprÃ¼fung bestehen":s==="fr"?"Ã€ 100%, toutes les pages avec des problÃ¨mes sont rÃ©parÃ©es, mÃªme si elles passent le contrÃ´le qualitÃ©":"At 100%, all pages with issues are repaired even if they pass quality check"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2",children:[e.jsx("input",{type:"checkbox",checked:Jr,onChange:i=>ps(i.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"KonsistenzprÃ¼fung aktivieren":s==="fr"?"Activer la vÃ©rification de cohÃ©rence":"Enable final checks"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:s==="de"?"PrÃ¼ft Bilder und Text auf Konsistenz am Ende der Generierung":s==="fr"?"VÃ©rifie la cohÃ©rence des images et du texte Ã  la fin de la gÃ©nÃ©ration":"Checks images and text for consistency at end of generation"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2",children:[e.jsx("input",{type:"checkbox",checked:mr,onChange:i=>a(i.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Inkrementelle Konsistenz":s==="fr"?"CohÃ©rence incrÃ©mentielle":"Incremental consistency"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:s==="de"?"PrÃ¼ft jedes Bild gegen vorherige Bilder wÃ¤hrend der Generierung":s==="fr"?"VÃ©rifie chaque image par rapport aux images prÃ©cÃ©dentes pendant la gÃ©nÃ©ration":"Checks each image against previous images during generation"}),mr&&e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2 ml-6",children:[e.jsx("input",{type:"checkbox",checked:ke,onChange:i=>rt(i.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Nur Protokoll (Dry Run)":s==="fr"?"Journaliser seulement (Dry Run)":"Dry run (log only)"})]}),mr&&e.jsx("p",{className:"text-xs text-gray-500 ml-12",children:s==="de"?"Zeigt nur an, was repariert wÃ¼rde, ohne tatsÃ¤chlich zu reparieren":s==="fr"?"Affiche uniquement ce qui serait rÃ©parÃ© sans effectuer de rÃ©parations":"Shows what would be fixed without actually fixing"}),mr&&e.jsxs("div",{className:"mt-2 ml-6",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-700 text-sm",children:s==="de"?"Vergleichsfenster:":s==="fr"?"FenÃªtre de comparaison:":"Lookback window:"}),e.jsx("input",{type:"range",min:"1",max:"5",value:he,onChange:i=>Qr(parseInt(i.target.value,10)),className:"w-20 h-2 bg-orange-200 rounded-lg appearance-none cursor-pointer"}),e.jsx("span",{className:"text-gray-600 font-medium w-4",children:he})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s==="de"?`Vergleicht jedes Bild mit den ${he} vorherigen`:s==="fr"?`Compare chaque image avec les ${he} prÃ©cÃ©dentes`:`Compares each image with the previous ${he}`})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-4",children:[e.jsx("input",{type:"checkbox",checked:lt,onChange:i=>_t(i.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Nur PrÃ¼fung (keine Regenerierung)":s==="fr"?"VÃ©rification seule (pas de rÃ©gÃ©nÃ©ration)":"Check only (no regeneration)"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:s==="de"?"FÃ¼hrt alle QualitÃ¤tsprÃ¼fungen durch, Ã¼berspringt aber Regenerierung/Reparatur":s==="fr"?"ExÃ©cute toutes les vÃ©rifications de qualitÃ© mais ignore la rÃ©gÃ©nÃ©ration/rÃ©paration":"Runs all quality checks but skips regeneration/repair"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2",children:[e.jsx("input",{type:"checkbox",checked:Nt,onChange:i=>ur(i.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Alle Avatare laden":s==="fr"?"Charger tous les avatars":"Load all avatars"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:s==="de"?"LÃ¤dt alle Avatar-Varianten (30MB+). NÃ¼tzlich zum Debuggen.":s==="fr"?"Charge toutes les variantes d'avatar (30MB+). Utile pour le dÃ©bogage.":"Loads all avatar variants (30MB+). Useful for debugging."})]}),pe&&((x==null?void 0:x.role)==="admin"||T)&&e.jsx(bo,{selections:st,onChange:Sr}),e.jsxs("button",{onClick:qa,className:"bg-transparent text-gray-800 hover:bg-gray-100 px-6 py-3 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(ri,{size:20})," ",y.back]})]})]})]})}),or&&!Lr&&!yt&&!os.frontCover&&!Pi&&e.jsx(ao,{current:Js.current,total:Js.total,message:Js.message,coverImages:os,characters:xe,jobId:ra||void 0,isStalled:Ri,onDismissStalled:()=>Mr(!1),isImpersonating:T,onMinimize:()=>Us(!0),onCancel:ra?async()=>{try{await Oe.cancelJob(ra),g.info("Job cancelled by user"),Br(!1),Ps(null),Mr(!1),vr({current:0,total:0,message:""}),D(s==="de"?"Generierung abgebrochen":s==="fr"?"GÃ©nÃ©ration annulÃ©e":"Generation cancelled")}catch(i){g.error("Failed to cancel job:",i),v(s==="de"?"Abbruch fehlgeschlagen":s==="fr"?"Ã‰chec de l'annulation":"Failed to cancel")}}:void 0}),Ti&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-sm mx-4 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s==="de"?"Geschichte wird im Hintergrund generiert":s==="fr"?"Histoire en cours de gÃ©nÃ©ration":"Story generating in background"}),e.jsx("p",{className:"text-gray-600 mb-6",children:s==="de"?"Was mÃ¶chtest du tun?":s==="fr"?"Que voulez-vous faire?":"What would you like to do?"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{Cs(!0),Us(!1),r("/create?new=true")},className:"w-full py-3 px-4 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors font-medium",children:s==="de"?"Neue Geschichte erstellen":s==="fr"?"CrÃ©er une autre histoire":"Create another story"}),$i&&e.jsx("button",{onClick:()=>{Cs(!0),Us(!1),r("/stories")},className:"w-full py-3 px-4 bg-gray-100 text-gray-800 rounded-xl hover:bg-gray-200 transition-colors font-medium",children:s==="de"?"Meine Geschichten lesen":s==="fr"?"Lire mes histoires":"Read my stories"})]})]})}),Ii&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-sm mx-4 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s==="de"?"Nur ein Charakter":s==="fr"?"Un seul personnage":"Only One Character"}),e.jsx("p",{className:"text-gray-600 mb-6",children:s==="de"?"Geschichten werden interessanter mit mehreren Charakteren. Du hast nur einen Charakter erstellt.":s==="fr"?"Les histoires sont plus intÃ©ressantes avec plusieurs personnages. Vous n'avez crÃ©Ã© qu'un seul personnage.":"Stories are more interesting with multiple characters. You have only created one character."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{Ks(!1),ca()},className:"w-full py-3 px-4 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors font-medium",children:s==="de"?"Weiteren Charakter erstellen":s==="fr"?"CrÃ©er un autre personnage":"Create another character"}),e.jsx("button",{onClick:async()=>{Ks(!1),await Jt(E+1)},className:"w-full py-3 px-4 bg-gray-100 text-gray-800 rounded-xl hover:bg-gray-200 transition-colors font-medium",children:s==="de"?"Trotzdem weiter":s==="fr"?"Continuer quand mÃªme":"Continue anyway"})]})]})}),Ai&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-sm w-full p-6 text-center",children:[e.jsx("div",{className:"relative inline-block mb-4",children:e.jsx(gt,{size:40,className:"animate-spin text-indigo-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s==="de"?"Bild wird erstellt...":s==="fr"?"CrÃ©ation de l'image...":"Generating image..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:s==="de"?"Dies dauert etwa 30 Sekunden":s==="fr"?"Cela prend environ 30 secondes":"This takes about 30 seconds"})]})}),Yi&&Je&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:s==="de"?"Bild bearbeiten":s==="fr"?"Modifier l'image":"Edit Image"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:Je.type==="image"?s==="de"?`Seite ${Je.pageNumber}`:s==="fr"?`Page ${Je.pageNumber}`:`Page ${Je.pageNumber}`:s==="de"?Je.coverType==="front"?"Titelseite":Je.coverType==="back"?"RÃ¼ckseite":"Einleitungsseite":s==="fr"?Je.coverType==="front"?"Couverture":Je.coverType==="back"?"Dos":"Page de dÃ©dicace":Je.coverType==="front"?"Front Cover":Je.coverType==="back"?"Back Cover":"Dedication Page"}),e.jsx("textarea",{value:ls,onChange:i=>ds(i.target.value),placeholder:s==="de"?`Beschreibe die gewÃ¼nschte Ã„nderung...
z.B. "Mach den Himmel blauer" oder "FÃ¼ge einen Schmetterling hinzu"`:s==="fr"?`DÃ©crivez le changement souhaitÃ©...
par ex. "Rendre le ciel plus bleu" ou "Ajouter un papillon"`:`Describe what you want to change...
e.g. "Make the sky bluer" or "Add a butterfly"`,className:"w-full h-32 p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 resize-none"}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{$s(!1),Ds(null),ds("")},className:"flex-1 px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:s==="de"?"Abbrechen":s==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:async()=>{if(!(!ls.trim()||!je)){$s(!1),Pa(!0);try{if(Je.type==="image"&&Je.pageNumber){const i=await Oe.editImage(je,Je.pageNumber,ls);if(g.info("Edit result:",{hasImageData:!!(i!=null&&i.imageData),score:i==null?void 0:i.qualityScore}),!(i!=null&&i.imageData))throw g.error("No imageData in edit response!",i),new Error("No image data returned from server");It(h=>h.map(c=>c.pageNumber===Je.pageNumber?{...c,imageData:i.imageData,qualityScore:i.qualityScore,qualityReasoning:i.qualityReasoning,wasEdited:!0,originalImage:i.originalImage,originalScore:i.originalScore,originalReasoning:i.originalReasoning}:c)),g.info("Image edited successfully, updated state with quality info")}else if(Je.type==="cover"&&Je.coverType){const i=await Oe.editCover(je,Je.coverType,ls);Lt(h=>{if(!h)return h;const c=Je.coverType==="front"?"frontCover":Je.coverType==="back"?"backCover":"initialPage",w=h[c],p={...typeof w=="object"?w:{},imageData:i.imageData,qualityScore:i.qualityScore,qualityReasoning:i.qualityReasoning,wasEdited:!0,originalImage:i.originalImage,originalScore:i.originalScore,originalReasoning:i.originalReasoning};return{...h,[c]:p}}),g.info("Cover edited successfully with quality info")}}catch(i){g.error("Edit failed:",i),v(s==="de"?"Bearbeitung fehlgeschlagen. Bitte versuche es erneut.":s==="fr"?"Ã‰chec de la modification. Veuillez rÃ©essayer.":"Edit failed. Please try again.")}finally{Pa(!1),Ds(null),ds("")}}},disabled:!ls.trim(),className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:s==="de"?"Bearbeiten":s==="fr"?"Modifier":"Edit"})]})]})}),e.jsx(ko,{isOpen:qs,faces:ws,onSelect:ln,onUploadNew:dn,developerMode:pe}),e.jsx(No,{isOpen:Di,onClose:()=>ks(!1),onVerified:()=>{console.log("[EmailVerification] onVerified callback triggered");const i=localStorage.getItem("verificationGenerationStarted");if(i){const h=parseInt(i,10),c=Date.now()-120*1e3;if(h>c){console.log("[EmailVerification] Another window started recently, skipping"),ks(!1);return}console.log("[EmailVerification] Clearing stale flag"),localStorage.removeItem("verificationGenerationStarted")}localStorage.setItem("verificationGenerationStarted",Date.now().toString()),localStorage.removeItem("pendingStoryGeneration"),localStorage.removeItem("pending_story_type"),localStorage.removeItem("pending_art_style"),console.log("[EmailVerification] Calling generateStory with skipEmailCheck: true"),Nr({skipEmailCheck:!0}),ks(!1)}})]}):e.jsx(Ja,{fullScreen:!0})}const gl=Object.freeze(Object.defineProperty({__proto__:null,default:Mo},Symbol.toStringTag,{value:"Module"}));export{no as I,Qn as S,Zn as U,Hr as a,vi as b,De as c,al as d,dl as e,So as f,wo as g,cl as h,mi as i,ol as j,ml as k,nl as l,ll as m,ul as n,gi as o,hi as p,il as q,Na as r,sl as s,xi as t,rl as u,ba as v,gl as w};
