import{c as N,u as V,a as G,b as $,j as e,e as k,X as D,T as B,E as H}from"./index-DURK5lAz.js";import{u as q,b as o}from"./vendor-react-k5uhsfqB.js";import{s as P}from"./storyService-Y9WabKRl.js";import{N as O}from"./Textarea-Ckw4BZh5.js";import{B as z}from"./Input-B1mk-j9e.js";import{B as v,M as _}from"./Pricing-By1FwaWu.js";import{T as R}from"./trash-2-IR8ja9iH.js";import"./vendor-firebase-Ksn6Afo7.js";import"./api-CL93LcKs.js";import"./arrow-left-D45V4qd3.js";import"./check-B_FxAkep.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=N("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=N("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=N("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),j=$("MyStories");function U({story:s,language:i,onView:x,onDelete:n,formatDate:h,selectionMode:m,isSelected:g,onToggleSelect:l}){const[u,c]=o.useState(!1),[p,b]=o.useState(!1),r=()=>{m&&!s.isPartial&&l()};return e.jsxs("div",{className:`bg-white rounded-xl shadow-md overflow-hidden transition-all flex flex-col ${s.isPartial?"ring-2 ring-amber-400":""} ${m&&!s.isPartial?"cursor-pointer hover:ring-2 hover:ring-indigo-400":"hover:shadow-lg"} ${g?"ring-2 ring-indigo-600 bg-indigo-50":""}`,onClick:r,children:[e.jsxs("div",{className:"relative",children:[s.thumbnail&&!p?e.jsxs("div",{className:"relative w-full h-48 bg-gray-100",children:[!u&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 spinner"})}),e.jsx("img",{src:s.thumbnail,alt:s.title,className:`w-full h-48 object-cover transition-opacity duration-300 ${u?"opacity-100":"opacity-0"}`,onLoad:()=>c(!0),onError:()=>b(!0)})]}):e.jsx("div",{className:"relative w-full h-48 bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center",children:e.jsx(v,{className:"w-12 h-12 text-indigo-300"})}),m&&!s.isPartial&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("div",{className:`w-7 h-7 rounded-lg flex items-center justify-center ${g?"bg-indigo-600":"bg-white/90 border-2 border-gray-300"}`,children:g?e.jsx(C,{size:18,className:"text-white"}):e.jsx(X,{size:18,className:"text-gray-400"})})}),s.isPartial&&e.jsxs("div",{className:"absolute top-2 right-2 bg-amber-500 text-white px-2 py-1 rounded-md text-xs font-medium flex items-center gap-1",children:[e.jsx(B,{size:12}),i==="de"?"Teilweise":i==="fr"?"Partiel":"Partial"]}),m&&s.isPartial&&e.jsx("div",{className:"absolute inset-0 bg-gray-900/50 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-medium px-3 py-1 bg-gray-800/80 rounded-lg",children:i==="de"?"Nicht verfügbar":i==="fr"?"Non disponible":"Not available"})})]}),e.jsxs("div",{className:"p-4 flex flex-col flex-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-2",children:s.title}),s.isPartial?e.jsxs("p",{className:"text-sm text-amber-600 mb-3",children:[s.generatedPages||0,"/",s.totalPages||s.pages," ",i==="de"?"Seiten generiert":i==="fr"?"pages générées":"pages generated"," • ",h(s.created_at||s.createdAt)]}):e.jsxs("p",{className:"text-sm text-gray-500 mb-3",children:[s.pages," ",i==="de"?"Seiten":"pages"," • ",h(s.created_at||s.createdAt)]})]}),!m&&e.jsxs("div",{className:"flex gap-2 mt-auto",children:[e.jsxs("button",{onClick:f=>{f.stopPropagation(),x()},className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[e.jsx(H,{size:18}),i==="de"?"Ansehen":i==="fr"?"Voir":"View"]}),e.jsx("button",{onClick:f=>{f.stopPropagation(),n()},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(R,{size:18})})]})]})]})}function ne(){const s=q(),{language:i}=V(),{isAuthenticated:x}=G(),[n,h]=o.useState([]),[m,g]=o.useState(!0),[l,u]=o.useState(!1),[c,p]=o.useState(new Set),b={en:{myStories:"My Stories",createStory:"Create Story",noStories:"No stories created yet",selectForBook:"Select for Book",cancel:"Cancel",seePricing:"See Pricing",selectHint:"Select stories to combine into one book",selected:"selected",pages:"pages",createBook:"Create Book",tooManyPages:"Too many pages (max 100)"},de:{myStories:"Meine Geschichten",createStory:"Geschichte erstellen",noStories:"Noch keine Geschichten erstellt",selectForBook:"Für Buch auswählen",cancel:"Abbrechen",seePricing:"Preise ansehen",selectHint:"Wähle Geschichten, um sie zu einem Buch zu kombinieren",selected:"ausgewählt",pages:"Seiten",createBook:"Buch erstellen",tooManyPages:"Zu viele Seiten (max. 100)"},fr:{myStories:"Mes histoires",createStory:"Créer une histoire",noStories:"Aucune histoire créée",selectForBook:"Sélectionner pour livre",cancel:"Annuler",seePricing:"Voir les tarifs",selectHint:"Sélectionnez des histoires à combiner en un livre",selected:"sélectionné(s)",pages:"pages",createBook:"Créer le livre",tooManyPages:"Trop de pages (max 100)"}},r=b[i]||b.en;o.useEffect(()=>{if(!x){s("/");return}f()},[x,s]);const f=async()=>{j.debug("Loading stories...");try{g(!0);const t=await P.getStories();j.info("Loaded stories:",t.length),h(t)}catch(t){j.error("Failed to load stories:",t)}finally{g(!1)}},M=async t=>{if(confirm(i==="de"?"Diese Geschichte wirklich löschen?":i==="fr"?"Voulez-vous vraiment supprimer cette histoire?":"Are you sure you want to delete this story?"))try{await P.deleteStory(t),h(n.filter(d=>d.id!==t))}catch(d){j.error("Failed to delete story:",d),alert(i==="de"?"Geschichte konnte nicht gelöscht werden. Bitte versuche es erneut.":i==="fr"?"Impossible de supprimer l'histoire. Veuillez réessayer.":"Failed to delete story. Please try again.")}},L=o.useCallback(t=>{if(!t)return"";try{return new Date(t).toLocaleDateString(i==="de"?"de-DE":i==="fr"?"fr-FR":"en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return""}},[i]),A=t=>{p(a=>{const d=new Set(a);return d.has(t)?d.delete(t):d.add(t),d})},y=o.useMemo(()=>n.filter(t=>c.has(t.id)),[n,c]),w=o.useMemo(()=>y.reduce((t,a)=>t+a.pages,0),[y]),S=w>_,T=()=>{u(!0),p(new Set)},E=()=>{u(!1),p(new Set)},F=()=>{const t=y.map(a=>({id:a.id,title:a.title,pages:a.pages,thumbnail:a.thumbnail}));s("/book-builder",{state:{selectedStories:t}})};if(!x)return e.jsx(k,{fullScreen:!0});const I=n.filter(t=>!t.isPartial).length>=1;return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsx(O,{currentStep:0}),e.jsxs("div",{className:"px-4 md:px-8 py-8 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(v,{size:28}),r.myStories]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("button",{onClick:()=>s("/pricing"),className:"flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:[e.jsx(K,{size:18}),r.seePricing]}),!l&&I&&e.jsxs("button",{onClick:T,className:"flex items-center gap-2 px-4 py-2 border-2 border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50 font-semibold transition-colors",children:[e.jsx(z,{size:18}),r.selectForBook]}),l&&e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-4 py-2 border-2 border-gray-300 text-gray-600 rounded-lg hover:bg-gray-100 font-semibold transition-colors",children:[e.jsx(D,{size:18}),r.cancel]}),!l&&e.jsx("button",{onClick:()=>s("/create"),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold transition-colors",children:r.createStory})]})]}),l&&e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-6 flex items-center gap-3",children:[e.jsx(C,{size:24,className:"text-indigo-600"}),e.jsx("p",{className:"text-indigo-800 font-medium",children:r.selectHint})]}),m?e.jsx(k,{message:i==="de"?"Laden...":i==="fr"?"Chargement...":"Loading..."}):n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:r.noStories}),e.jsx("button",{onClick:()=>s("/create"),className:"mt-4 px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700",children:r.createStory})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:n.map(t=>e.jsx(U,{story:t,language:i,onView:()=>s(`/create?storyId=${t.id}`),onDelete:()=>M(t.id),formatDate:L,selectionMode:l,isSelected:c.has(t.id),onToggleSelect:()=>A(t.id)},t.id))})]}),l&&c.size>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t-2 border-indigo-200 shadow-lg p-4 z-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-gray-800",children:[e.jsx("span",{className:"font-bold text-lg",children:c.size})," ",e.jsx("span",{className:"text-gray-600",children:r.selected})]}),e.jsxs("div",{className:`text-sm ${S?"text-red-600 font-medium":"text-gray-500"}`,children:[w," ",r.pages,S&&e.jsxs("span",{className:"ml-2 flex items-center gap-1 inline-flex",children:[e.jsx(B,{size:14}),r.tooManyPages]})]})]}),e.jsxs("button",{onClick:F,disabled:S||c.size===0,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-bold hover:from-indigo-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(z,{size:20}),r.createBook]})]})})]})}export{ne as default};
