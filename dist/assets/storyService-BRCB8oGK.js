import{a as r}from"./api-CL93LcKs.js";const P={async getDraft(){try{return(await r.get("/api/story-draft")).draft}catch{return null}},async saveDraft(e){await r.post("/api/story-draft",{draft:e})},async deleteDraft(){await r.delete("/api/story-draft")},async getStories(e){const t=new URLSearchParams;e!=null&&e.limit&&t.set("limit",String(e.limit)),e!=null&&e.offset&&t.set("offset",String(e.offset));const s=t.toString(),o=`/api/stories${s?`?${s}`:""}`,n=await r.get(o);return{stories:(n.stories||[]).map(a=>({id:a.id,title:a.title,story_type:"",art_style:"",language:a.language,pages:a.pageCount||a.pages||0,created_at:a.createdAt,hasThumbnail:a.hasThumbnail,isPartial:a.isPartial,generatedPages:a.generatedPages,totalPages:a.totalPages})),pagination:n.pagination}},async getStoryCover(e){try{return(await r.get(`/api/stories/${e}/cover`)).coverImage}catch{return null}},async getStory(e){try{const t=await r.get(`/api/stories/${e}`),s=t.storyText||t.story||"";return{id:t.id,title:t.title,storyType:t.storyType,artStyle:t.artStyle,language:t.language,languageLevel:t.languageLevel,pages:t.pages,dedication:t.dedication,characters:t.characters,mainCharacters:t.mainCharacters,relationships:t.relationships,relationshipTexts:t.relationshipTexts,outline:t.outline,outlinePrompt:t.outlinePrompt,story:s,storyTextPrompts:t.storyTextPrompts,visualBible:t.visualBible,sceneDescriptions:t.sceneDescriptions,sceneImages:t.sceneImages,coverImages:t.coverImages,thumbnail:t.thumbnail,createdAt:t.createdAt,isPartial:t.isPartial,failureReason:t.failureReason,generatedPages:t.generatedPages,totalPages:t.totalPages}}catch{return null}},async getStoryWithProgress(e,t){var s;try{const o=localStorage.getItem("auth_token"),n=await fetch(`/api/stories/${e}`,{headers:o?{Authorization:`Bearer ${o}`}:{}});if(!n.ok)throw new Error(`HTTP ${n.status}`);const c=n.headers.get("Content-Length"),a=c?parseInt(c,10):null,p=(s=n.body)==null?void 0:s.getReader();if(!p){const i=await n.json();return this.mapServerStoryToClient(i)}const g=[];let l=0;for(;;){const{done:i,value:m}=await p.read();if(i)break;g.push(m),l+=m.length,t(l,a)}const u=new Uint8Array(l);let y=0;for(const i of g)u.set(i,y),y+=i.length;const h=new TextDecoder().decode(u),d=JSON.parse(h);return this.mapServerStoryToClient(d)}catch{return null}},mapServerStoryToClient(e){const t=e.storyText||e.story||"";return{id:e.id,title:e.title,storyType:e.storyType,artStyle:e.artStyle,language:e.language,languageLevel:e.languageLevel,pages:e.pages,dedication:e.dedication,characters:e.characters,mainCharacters:e.mainCharacters,relationships:e.relationships,relationshipTexts:e.relationshipTexts,outline:e.outline,outlinePrompt:e.outlinePrompt,story:t,storyTextPrompts:e.storyTextPrompts,visualBible:e.visualBible,sceneDescriptions:e.sceneDescriptions,sceneImages:e.sceneImages,coverImages:e.coverImages,thumbnail:e.thumbnail,createdAt:e.createdAt,isPartial:e.isPartial,failureReason:e.failureReason,generatedPages:e.generatedPages,totalPages:e.totalPages}},async createStory(e){return{id:(await r.post("/api/stories",{title:e.title,story_type:e.storyType,art_style:e.artStyle,language:e.language,language_level:e.languageLevel,pages:e.pages,dedication:e.dedication,characters:e.characters,main_characters:e.mainCharacters,relationships:e.relationships,relationship_texts:e.relationshipTexts,outline:e.outline,story:e.story,scene_descriptions:e.sceneDescriptions,scene_images:e.sceneImages,cover_images:e.coverImages})).id}},async deleteStory(e){await r.delete(`/api/stories/${e}`)},async regenerateSceneDescription(e,t){return await r.post(`/api/stories/${e}/regenerate/scene-description/${t}`)},async regenerateImage(e,t){return await r.post(`/api/stories/${e}/regenerate/image/${t}`)},async regenerateCover(e,t){return await r.post(`/api/stories/${e}/regenerate/cover/${t}`)},async updatePage(e,t,s){await r.patch(`/api/stories/${e}/page/${t}`,{text:s.text,scene_description:s.sceneDescription,image_data:s.imageData})},async updateVisualBible(e,t){await r.put(`/api/stories/${e}/visual-bible`,{visualBible:t})},async editImage(e,t,s){return await r.post(`/api/stories/${e}/edit/image/${t}`,{editPrompt:s})},async editCover(e,t,s){return await r.post(`/api/stories/${e}/edit/cover/${t}`,{editPrompt:s})},async callClaude(e,t=8192){return(await r.post("/api/claude",{prompt:e,max_tokens:t})).content},async callGemini(e,t){return(await r.post("/api/gemini",{prompt:e,images:t})).content},async createStoryJob(e){return{jobId:(await r.post("/api/jobs/create-story",{storyType:e.storyType,storyTypeName:e.storyTypeName,artStyle:e.artStyle,language:e.language,languageLevel:e.languageLevel,pages:e.pages,dedication:e.dedication,storyDetails:e.storyDetails,characters:e.characters,mainCharacters:e.mainCharacters,relationships:e.relationships,relationshipTexts:e.relationshipTexts,skipImages:e.skipImages,imageGenMode:e.imageGenMode,skipOutline:e.skipOutline,skipText:e.skipText,skipSceneDescriptions:e.skipSceneDescriptions,skipCovers:e.skipCovers})).jobId}},async getJobStatus(e){const t=await r.get(`/api/jobs/${e}/status`),s=t.resultData;return{status:t.status,progress:{current:t.progress||0,total:100,message:t.progressMessage||""},result:s?{storyId:s.storyId||"",title:s.title||"",outline:s.outline||"",outlinePrompt:s.outlinePrompt,story:s.storyText||"",storyTextPrompts:s.storyTextPrompts,visualBible:s.visualBible,sceneDescriptions:s.sceneDescriptions||[],sceneImages:s.sceneImages||[],coverImages:s.coverImages}:void 0,partialCovers:t.partialCovers,storyText:t.storyText,partialPages:t.partialPages,currentCredits:t.currentCredits,error:t.errorMessage}},async cancelJob(e){return await r.post(`/api/jobs/${e}/cancel`)},async generatePdf(e){const t=localStorage.getItem("auth_token"),s=await fetch(`/api/stories/${e}/pdf`,{headers:t?{Authorization:`Bearer ${t}`}:{}});if(!s.ok)throw new Error("Failed to generate PDF");return s.blob()},async createCheckoutSession(e,t){return await r.post("/api/stripe/create-checkout-session",{storyId:e,coverType:t||"softcover"})},async createPrintOrder(e,t){return await r.post("/api/print-provider/order",{storyId:e,shippingAddress:t})},async getOrderStatus(e){return await r.get(`/api/stripe/order-status/${e}`)}};export{P as s};
