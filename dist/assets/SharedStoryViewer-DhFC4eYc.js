import{c as j,j as e,L as w,i as N}from"./index-DIxTz-s_.js";import{f as v,b as c,L as f}from"./vendor-react-CqfXSjHo.js";import{S as p}from"./sparkles-DQRWksbl.js";import{B as y}from"./book-open-C8Nb-lSv.js";import{C as S}from"./chevron-right-ovL3-19f.js";import"./vendor-firebase-DTVMaYMy.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=j("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);function C(i,a){const x=c.useRef(null),d=c.useRef(null),m=50;return{onTouchStart:o=>{d.current=null,x.current=o.targetTouches[0].clientX},onTouchMove:o=>{d.current=o.targetTouches[0].clientX},onTouchEnd:()=>{if(!x.current||!d.current)return;const o=x.current-d.current,n=o>m,l=o<-m;n&&i(),l&&a()}}}function I(){const{shareToken:i}=v(),[a,x]=c.useState(null),[d,m]=c.useState(!0),[u,h]=c.useState(null),[t,o]=c.useState(0);c.useEffect(()=>{async function r(){if(!i){h("Invalid share link"),m(!1);return}try{const s=await fetch(`/api/shared/${i}`);if(!s.ok){s.status===404?h("This story is no longer available or the link is invalid."):h("Failed to load story. Please try again later."),m(!1);return}const g=await s.json();x(g)}catch{h("Failed to load story. Please check your connection.")}finally{m(!1)}}r()},[i]);const n=a?a.pages.length+1:0,l=r=>{r>=0&&r<n&&o(r)},b=C(()=>l(t+1),()=>l(t-1));return d?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"w-12 h-12 animate-spin text-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-indigo-800",children:"Loading story..."})]})}):u?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-blue-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(N,{className:"w-16 h-16 text-indigo-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-indigo-900 mb-2",children:"Story Not Found"}),e.jsx("p",{className:"text-indigo-700 mb-6",children:u}),e.jsxs(f,{to:"/",className:"inline-flex items-center gap-2 bg-gradient-to-r from-indigo-500 to-blue-500 text-white px-6 py-3 rounded-full font-semibold hover:from-indigo-600 hover:to-blue-600 transition-all",children:[e.jsx(p,{className:"w-5 h-5"}),"Create Your Own Story"]})]})}):a?e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-blue-50 flex flex-col",children:[e.jsx("header",{className:"bg-white/80 backdrop-blur-sm border-b border-indigo-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-6 h-6 text-indigo-600"}),e.jsx("span",{className:"font-bold text-indigo-900 hidden sm:inline",children:"MagicalStory"})]}),e.jsxs(f,{to:"/",className:"inline-flex items-center gap-1 bg-gradient-to-r from-indigo-500 to-blue-500 text-white px-4 py-2 rounded-full text-sm font-semibold hover:from-indigo-600 hover:to-blue-600 transition-all",children:[e.jsx(p,{className:"w-4 h-4"}),"Create Your Own"]})]})}),e.jsxs("main",{className:"flex-1 max-w-6xl w-full mx-auto px-4 py-6 md:py-8",...b,children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden border-2 border-indigo-200",children:[t===0&&e.jsxs("div",{className:"aspect-[3/4] md:aspect-[4/3] lg:aspect-[16/9] relative bg-gradient-to-br from-indigo-100 to-blue-100",children:[e.jsx("img",{src:`/api/shared/${i}/cover-image/frontCover`,alt:"Story Cover",className:"w-full h-full object-cover",onError:r=>{r.currentTarget.style.display="none"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-6",children:e.jsx("h1",{className:"text-2xl md:text-4xl font-bold text-white text-center drop-shadow-lg",children:a.title})})]}),t>0&&a.pages[t-1]&&e.jsxs("div",{className:"md:grid md:grid-cols-2",children:[e.jsx("div",{className:"aspect-square md:aspect-auto bg-gradient-to-br from-indigo-50 to-blue-50",children:e.jsx("img",{src:`/api/shared/${i}/image/${a.pages[t-1].pageNumber}`,alt:`Page ${t}`,className:"w-full h-full object-cover md:object-contain",loading:"lazy",onError:r=>{r.currentTarget.src="",r.currentTarget.alt="Image not available"}})}),e.jsxs("div",{className:"p-6 md:p-8 lg:p-10 flex flex-col justify-center bg-indigo-50/50 md:min-h-[400px] lg:min-h-[500px]",children:[e.jsx("p",{className:"text-lg md:text-xl lg:text-2xl leading-relaxed text-gray-800 whitespace-pre-wrap",children:a.pages[t-1].text}),e.jsxs("div",{className:"mt-4 text-right text-indigo-400 text-sm",children:["Page ",t," of ",a.pages.length]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-6",children:[e.jsx("button",{onClick:()=>l(t-1),disabled:t===0,className:"p-3 rounded-full bg-white shadow-md border border-indigo-200 text-indigo-600 disabled:opacity-40 disabled:cursor-not-allowed hover:bg-indigo-50 transition-colors","aria-label":"Previous page",children:e.jsx(k,{className:"w-6 h-6"})}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:Math.min(n,10)}).map((r,s)=>{const g=n<=10||s<4?s:s===4?-1:n-(9-s);return g===-1?e.jsx("span",{className:"text-indigo-400",children:"..."},s):e.jsx("button",{onClick:()=>l(g),className:`w-3 h-3 rounded-full transition-all ${t===g?"bg-indigo-500 scale-125":"bg-indigo-200 hover:bg-indigo-300"}`,"aria-label":`Go to page ${g}`},s)})}),e.jsx("button",{onClick:()=>l(t+1),disabled:t>=n-1,className:"p-3 rounded-full bg-white shadow-md border border-indigo-200 text-indigo-600 disabled:opacity-40 disabled:cursor-not-allowed hover:bg-indigo-50 transition-colors","aria-label":"Next page",children:e.jsx(S,{className:"w-6 h-6"})})]}),e.jsx("p",{className:"text-center text-indigo-400 text-sm mt-3 md:hidden",children:"Swipe to navigate"})]})]}):null}export{I as default};
