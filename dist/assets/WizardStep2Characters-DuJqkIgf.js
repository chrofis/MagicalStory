import{c as ye,u as re,j as e,T as Vt,X as _t,a as qt}from"./index-JHDZ1NiM.js";import{B as ae,U as le}from"./Input-7jg65Sgx.js";import{b as z,L as Nt}from"./vendor-react-CqfXSjHo.js";import"./Textarea-B0kEr2DI.js";import{C as Mt}from"./check-DY7H9lnI.js";import{S as wt,r as Jt,i as Wt,f as Rt,g as Yt,u as Zt,U as xe,a as pe,I as kt,b as Ot,c as Qt}from"./StoryWizard-YmbXUtgC.js";import{P as Xt}from"./pen-DU0DTShG.js";import{T as Tt}from"./trash-2-CvnffISg.js";import{P as Lt,R as ea}from"./Modal-CBcwnBQW.js";import{C as sa}from"./download-BuM-5EUH.js";import{C as la}from"./chevron-right-BhsnMaWB.js";import{A as ce}from"./arrow-right-C5J21qSy.js";import{C as ta}from"./camera-BHuWT0O0.js";import{P as Ct}from"./pencil-BQm0YGpA.js";import{S as aa}from"./sparkles-Db7qlSw1.js";import"./vendor-firebase-DTVMaYMy.js";import"./book-open-DxKGOXJ2.js";import"./circle-x-CsG1uVD0.js";import"./clock-D2D0JXsm.js";import"./palette-BTXzzopX.js";import"./book-5KwtuOtf.js";import"./shopping-cart-wmIUBvli.js";import"./arrow-left-a_csx-kO.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=ye("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=ye("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=ye("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);function na({characters:s,showSuccessMessage:n,mainCharacters:d=[],excludedCharacters:p=[],onCharacterRoleChange:r,onEdit:B,onDelete:y,onCreateAnother:N}){const{t:c,language:o}=re(),[C,S]=z.useState(null),P=x=>p.includes(x)?"out":d.includes(x)?"main":"in",w={out:o==="de"?"Nicht dabei":o==="fr"?"Absent":"Out",in:o==="de"?"Dabei":o==="fr"?"Présent":"In",main:o==="de"?"Hauptrolle":o==="fr"?"Principal":"Main"},D=x=>{S({id:x.id,name:x.name})},k=()=>{C&&(y(C.id),S(null))},b=()=>{S(null)};return s.length===0?null:e.jsxs("div",{className:"space-y-4",children:[n&&e.jsx("div",{className:"md:bg-green-50 md:border-2 md:border-green-400 md:rounded-xl p-4 animate-fade-in",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center",children:e.jsx(Mt,{size:20})}),e.jsx("h3",{className:"text-lg font-bold text-green-700",children:o==="de"?"Charakter erfolgreich erstellt!":o==="fr"?"Personnage cre avec succes!":"Character Created Successfully!"})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-2",children:[s.map(x=>{var $,M,U,W,L,E,V,_;const A=P(x.id),j=A==="out",a=A==="in",u=A==="main",g=s.filter(v=>!p.includes(v.id)),m=!j&&g.length===1;return e.jsx("div",{className:`border rounded p-2 transition-all ${j?"border-dashed border-gray-300 bg-gray-50":u?"border-2 border-indigo-600 bg-indigo-50":"border-gray-200 bg-white"}`,children:e.jsxs("div",{className:"flex gap-3",children:[(((M=($=x.avatars)==null?void 0:$.faceThumbnails)==null?void 0:M.standard)||((U=x.photos)==null?void 0:U.face)||((W=x.photos)==null?void 0:W.original))&&e.jsx("button",{onClick:()=>B(x),className:"flex-shrink-0 focus:outline-none focus:ring-2 focus:ring-indigo-400 rounded-full",title:c.editCharacter,children:e.jsx("img",{draggable:!1,src:((E=(L=x.avatars)==null?void 0:L.faceThumbnails)==null?void 0:E.standard)||((V=x.photos)==null?void 0:V.face)||((_=x.photos)==null?void 0:_.original),alt:x.name,className:`w-20 h-20 rounded-full object-cover object-top border-2 border-indigo-200 cursor-pointer hover:border-indigo-400 transition-colors ${j?"grayscale opacity-50":""}`})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-between",children:[e.jsxs("div",{className:`flex items-start justify-between gap-2 ${j?"opacity-50":""}`,children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h4",{className:"font-bold text-sm md:text-base truncate flex items-center gap-1",children:[x.name,u&&e.jsx(wt,{size:14,className:"text-indigo-600 fill-indigo-600 flex-shrink-0"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[x.gender==="male"?c.male:x.gender==="female"?c.female:c.other,","," ",x.age," ",o==="de"?"J":o==="fr"?"ans":"y"]})]}),e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>B(x),className:"bg-indigo-600 text-white p-1.5 rounded text-xs hover:bg-indigo-700",title:c.editCharacter,children:e.jsx(Xt,{size:14})}),e.jsx("button",{onClick:()=>D(x),className:"bg-red-500 text-white p-1.5 rounded text-xs hover:bg-red-600",title:c.deleteCharacter,children:e.jsx(Tt,{size:14})})]})]}),r&&e.jsxs("div",{className:"flex rounded overflow-hidden border border-gray-300 text-[10px] md:text-xs mt-1",children:[e.jsx("button",{onClick:()=>r(x.id,"out"),disabled:m,title:m?o==="de"?"Mindestens ein Charakter muss in der Geschichte sein":o==="fr"?"Au moins un personnage doit être dans l'histoire":"At least one character must be in the story":void 0,className:`flex-1 px-1.5 py-1 font-medium transition-colors ${j?"bg-gray-500 text-white":m?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-600 hover:bg-gray-100"}`,children:w.out}),e.jsx("button",{onClick:()=>r(x.id,"in"),className:`flex-1 px-1.5 py-1 font-medium transition-colors border-l border-r border-gray-300 ${a?"bg-indigo-600 text-white":j?"bg-indigo-50 text-indigo-700 hover:bg-indigo-100":"bg-white text-gray-600 hover:bg-gray-100"}`,children:w.in}),e.jsxs("button",{onClick:()=>r(x.id,"main"),className:`flex-1 px-1.5 py-1 font-medium transition-colors flex items-center justify-center gap-0.5 ${u?"bg-indigo-600 text-white":j?"bg-indigo-50 text-indigo-700 hover:bg-indigo-100":"bg-white text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(wt,{size:10,className:u?"fill-white":""}),w.main]})]})]})]})},x.id)}),e.jsxs("button",{onClick:N,className:"border-2 border-dashed border-indigo-300 rounded p-4 flex flex-col items-center justify-center gap-2 hover:border-indigo-500 hover:bg-indigo-50 transition-colors min-h-[100px]",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx(Lt,{size:24,className:"text-indigo-600"})}),e.jsx("span",{className:"text-sm font-medium text-indigo-600",children:o==="de"?"Weiteren Charakter erstellen":o==="fr"?"Créer un autre personnage":"Create Another Character"})]})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"bg-red-100 text-red-600 rounded-full p-2",children:e.jsx(Vt,{size:24})}),e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:o==="de"?"Charakter löschen?":o==="fr"?"Supprimer le personnage?":"Delete Character?"})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:o==="de"?`Möchtest du "${C.name}" wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden.`:o==="fr"?`Voulez-vous vraiment supprimer "${C.name}"? Cette action est irréversible.`:`Are you sure you want to delete "${C.name}"? This action cannot be undone.`}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:b,className:"flex-1 px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:o==="de"?"Abbrechen":o==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:k,className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 font-medium",children:o==="de"?"Löschen":o==="fr"?"Supprimer":"Delete"})]})]})})]})}function te({label:s,traits:n,selectedTraits:d,onSelect:p,minRequired:r=0,allowCustom:B=!0,defaultExpanded:y=!1}){const{t:N,language:c}=re(),[o,C]=z.useState(""),[S,P]=z.useState(y),[w,D]=z.useState([]),k=a=>{d.includes(a)?p(d.filter(u=>u!==a)):p([...d,a])},b=()=>{if(o.trim()&&!d.includes(o.trim())){const a=o.trim();D([...w,a]),p([...d,a]),C("")}},x=d.filter(a=>!n.includes(a)),A=[...new Set([...w,...x])],j=[...n,...A];return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>P(!S),className:"flex items-center gap-1 mb-2 group cursor-pointer text-left",children:[S?e.jsx(sa,{size:18,className:"text-indigo-500"}):e.jsx(la,{size:18,className:"text-gray-400 group-hover:text-indigo-500"}),e.jsx("span",{className:"text-lg font-semibold text-gray-800",children:s}),r>0&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-1",children:["(",N.selectAtLeast," ",r,")"]}),d.length>0&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-1",children:["- ",d.length," ",c==="de"?"gewählt":c==="fr"?"sélectionné":"selected"]})]}),!S&&d.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 ml-5",children:d.map(a=>e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-indigo-100 text-indigo-700 border border-indigo-200",children:a},a))}),!S&&d.length===0&&e.jsx("div",{className:"ml-5 text-sm text-gray-400 italic",children:c==="de"?"Klicken zum Auswählen...":c==="fr"?"Cliquer pour sélectionner...":"Click to select..."}),S&&e.jsxs("div",{className:"ml-5",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:j.map(a=>e.jsx("button",{onClick:()=>k(a),className:`px-3 py-1 rounded-full text-sm transition-colors ${d.includes(a)?"bg-indigo-500 text-white":"bg-gray-200 text-gray-800 hover:bg-gray-300"}`,children:a},a))}),B&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:o,onChange:a=>C(a.target.value),onKeyDown:a=>a.key==="Enter"&&b(),placeholder:c==="de"?"Eigene hinzufügen...":c==="fr"?"Ajouter personnalisé...":"Add custom...",className:"flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none"}),e.jsx("button",{onClick:b,disabled:!o.trim(),className:`flex-shrink-0 w-10 h-10 rounded-lg font-semibold flex items-center justify-center transition-colors ${o.trim()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:e.jsx(Lt,{size:18})})]})]})]})}function Bt({character:s,allCharacters:n,relationships:d,relationshipTexts:p,onRelationshipChange:r,onRelationshipTextChange:B,customRelationships:y=[],onAddCustomRelationship:N}){var b,x,A,j;const{language:c}=re(),o=c,C=n.filter(a=>a.id!==s.id);if(C.length===0)return null;const S=[...Jt,...y.map(a=>({value:{en:a.forward,de:a.forward,fr:a.forward},inverse:{en:a.inverse,de:a.inverse,fr:a.inverse}}))],P=(a,u,g)=>{if(g==="__CREATE_CUSTOM__"){const m=prompt(c==="de"?'Beziehung eingeben (z.B. "Onkel"):':c==="fr"?'Entrer la relation (ex. "oncle"):':'Enter relationship (e.g. "uncle"):');if(m&&m.trim()){const $=prompt(c==="de"?`Was ist die umgekehrte Beziehung? (z.B. wenn "${m.trim()}" dann vielleicht "Neffe/Nichte"):`:c==="fr"?`Quelle est la relation inverse? (ex. si "${m.trim()}" alors peut-être "neveu/nièce"):`:`What is the inverse relationship? (e.g. if "${m.trim()}" then maybe "nephew/niece"):`);$&&$.trim()&&(N==null||N(m.trim(),$.trim()),r(a,u,m.trim()))}}else r(a,u,g)},w=(a,u)=>a<u?`${a}-${u}`:`${u}-${a}`,D={relationships:c==="de"?"Beziehungen":c==="fr"?"Relations":"Relationships",detailsPlaceholder:c==="de"?"Details...":c==="fr"?"Détails...":"Details..."},k=((x=(b=s.avatars)==null?void 0:b.faceThumbnails)==null?void 0:x.standard)||((A=s.photos)==null?void 0:A.face)||((j=s.photos)==null?void 0:j.original);return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:D.relationships}),e.jsx("div",{className:"space-y-3",children:C.map(a=>{var E,V,_,v;const u=`${s.id}-${a.id}`,g=`${a.id}-${s.id}`,m=d[u],$=m&&!Wt(m),M=m?Rt(m,o,y):null,U=w(s.id,a.id),W=p[U]||"",L=((V=(E=a.avatars)==null?void 0:E.faceThumbnails)==null?void 0:V.standard)||((_=a.photos)==null?void 0:_.face)||((v=a.photos)==null?void 0:v.original);return e.jsx("div",{className:`rounded-lg p-3 md:p-4 w-full ${$?"bg-blue-50 border-2 border-blue-300":"bg-white border-[3px] border-red-500"}`,children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4 w-full",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[k&&e.jsx("img",{draggable:!1,src:k,alt:s.name,className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold text-xs md:text-sm text-center max-w-[60px] sm:max-w-[80px] md:max-w-[100px] truncate",children:s.name})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsxs("select",{value:m||Yt(o),onChange:l=>P(s.id,a.id,l.target.value),className:`w-full px-3 py-2 md:px-4 md:py-2.5 border rounded text-sm md:text-base font-medium text-center ${$?"bg-blue-100 border-blue-400":"bg-white border-red-400 border-2"}`,children:[e.jsxs("option",{value:"__CREATE_CUSTOM__",children:["+ ",o==="de"?"Eigene":o==="fr"?"Personnalisé":"Custom"]}),S.map((l,ne)=>e.jsx("option",{value:l.value[o],children:l.value[o]},ne))]}),$&&M&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ra,{size:12,className:"text-blue-400"}),e.jsx("span",{children:a.name}),e.jsx("span",{className:"font-medium text-blue-600",children:M}),e.jsx("span",{children:s.name})]}),$&&e.jsx("textarea",{value:W,onChange:l=>{B(u,l.target.value),B(g,l.target.value)},placeholder:D.detailsPlaceholder,rows:2,className:"w-full px-3 py-2 md:px-4 md:py-3 border border-blue-300 rounded-lg text-sm md:text-base text-center bg-white resize-none focus:border-indigo-500 focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[L&&e.jsx("img",{draggable:!1,src:L,alt:a.name,className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold text-xs md:text-sm text-center max-w-[60px] sm:max-w-[80px] md:max-w-[100px] truncate",children:a.name})]})]})},a.id)})})]})}const ia={en:["Cheerful","Kind","Caring","Funny","Forgiving","Protective","Loyal","Generous","Fair-minded","Honest","Confident","Brave","Trustworthy","Determined","Hardworking","Leader","Patient","Curious","Imaginative","Smart","Creative","Observant","Resourceful","Energetic","Fast","Strong","Adventurous"],de:["Fröhlich","Freundlich","Hilfsbereit","Lustig","Nachsichtig","Beschützend","Treu","Grosszügig","Gerecht","Ehrlich","Selbstbewusst","Mutig","Vertrauenswürdig","Entschlossen","Fleissig","Leader","Geduldig","Neugierig","Fantasievoll","Klug","Kreativ","Aufmerksam","Einfallsreich","Energiegeladen","Schnell","Stark","Abenteuerlustig"],fr:["Joyeux","Gentil","Attentionné","Drôle","Indulgent","Protecteur","Loyal","Généreux","Équitable","Honnête","Confiant","Courageux","Digne de confiance","Déterminé","Travailleur","Leader","Patient","Curieux","Imaginatif","Intelligent","Créatif","Observateur","Débrouillard","Énergique","Rapide","Fort","Aventureux"]},oa={en:["Impatient","Distracted","Talkative","Whiny","Messy","Forgetful","Tattletale","Sore Loser","Stubborn","Lying","Bossy","Gullible","Jealous","Easily scared","Clingy","Quick-tempered","Selfish","Sneaky","Reckless","Shy","Clumsy","Lazy","Boastful","Indecisive","Perfectionist"],de:["Ungeduldig","Zerstreut","Gesprächig","Weinerlich","Unordentlich","Vergesslich","Petze","Schlechter Verlierer","Stur","Lügnerisch","Rechthaberisch","Leichtgläubig","Eifersüchtig","Ängstlich","Anhänglich","Jähzornig","Egoistisch","Hinterlistig","Leichtsinnig","Schüchtern","Tollpatschig","Faul","Prahlerisch","Unentschlossen","Perfektionist"],fr:["Impatient","Distrait","Bavard","Pleurnicheur","Désordonné","Oublieux","Rapporteur","Mauvais perdant","Têtu","Menteur","Autoritaire","Crédule","Jaloux","Facilement effrayé","Collant","Colérique","Égoïste","Sournois","Imprudent","Timide","Maladroit","Paresseux","Vantard","Indécis","Perfectionniste"]},da={en:["Following rules","Controlling emotions","Sharing with others","Tests and grades","Making new friends","Speaking in public","Trying new things","Accepting and asking for help","Dealing with change","Standing up for oneself","Fear of the dark","Bad dreams and nightmares","Monsters, ghosts and things under the bed","Fear of being alone","Fear of getting lost","Doctors, dentists and shots","Fear of heights","Fear of spiders","Fear of loud noises"],de:["Regeln befolgen","Gefühle kontrollieren","Mit anderen teilen","Prüfungsangst","Neue Freunde finden","Vor anderen sprechen","Neues ausprobieren","Hilfe annehmen und darum bitten","Mit Veränderungen umgehen","Für sich einstehen","Angst vor der Dunkelheit","Albträume und schlechte Träume","Monster, Geister und Dinge unter dem Bett","Angst allein zu sein","Angst sich zu verlaufen","Ärzte, Zahnärzte und Spritzen","Höhenangst","Angst vor Spinnen","Angst vor lauten Geräuschen"],fr:["Suivre les règles","Contrôler ses émotions","Partager avec les autres","Examens et notes","Se faire de nouveaux amis","Parler en public","Essayer de nouvelles choses","Accepter et demander de l'aide","Gérer le changement","Se défendre","Peur du noir","Cauchemars et mauvais rêves","Monstres, fantômes et choses sous le lit","Peur d'être seul","Peur de se perdre","Médecins, dentistes et piqûres","Peur du vide","Peur des araignées","Peur des bruits forts"]},Dt=ia,At=oa,zt=da,ca=[{value:"infant",label:"Infant",labelDe:"Säugling",labelFr:"Nourrisson"},{value:"toddler",label:"Toddler",labelDe:"Kleinkind",labelFr:"Bambin"},{value:"preschooler",label:"Preschooler",labelDe:"Vorschulkind",labelFr:"Préscolaire"},{value:"kindergartner",label:"Kindergartner",labelDe:"Kindergartenkind",labelFr:"Maternelle"},{value:"young-school-age",label:"Young School-Age",labelDe:"Junges Schulkind",labelFr:"Jeune écolier"},{value:"school-age",label:"School-Age",labelDe:"Schulkind",labelFr:"Écolier"},{value:"preteen",label:"Preteen",labelDe:"Vorpubertär",labelFr:"Préadolescent"},{value:"young-teen",label:"Young Teen",labelDe:"Junger Teen",labelFr:"Jeune ado"},{value:"teenager",label:"Teenager",labelDe:"Teenager",labelFr:"Adolescent"},{value:"young-adult",label:"Young Adult",labelDe:"Junger Erwachsener",labelFr:"Jeune adulte"},{value:"adult",label:"Adult",labelDe:"Erwachsener",labelFr:"Adulte"},{value:"middle-aged",label:"Middle-Aged",labelDe:"Mittleres Alter",labelFr:"Âge moyen"},{value:"senior",label:"Senior",labelDe:"Senior",labelFr:"Senior"},{value:"elderly",label:"Elderly",labelDe:"Hochbetagt",labelFr:"Âgé"}],xa=[{value:"slim",label:"Slim",labelDe:"Schlank",labelFr:"Mince"},{value:"average",label:"Average",labelDe:"Durchschnitt",labelFr:"Moyen"},{value:"athletic",label:"Athletic",labelDe:"Athletisch",labelFr:"Athlétique"},{value:"stocky",label:"Stocky",labelDe:"Stämmig",labelFr:"Trapu"},{value:"petite",label:"Petite",labelDe:"Zierlich",labelFr:"Petit"},{value:"tall",label:"Tall",labelDe:"Gross",labelFr:"Grand"},{value:"heavy",label:"Heavy",labelDe:"Kräftig",labelFr:"Corpulent"}],ma=[{value:"bald",label:"Bald",labelDe:"Glatze",labelFr:"Chauve"},{value:"balding",label:"Balding",labelDe:"Halbglatze",labelFr:"Dégarni"},{value:"thinning",label:"Thinning",labelDe:"Dünnes Haar",labelFr:"Clairsemé"},{value:"buzz cut",label:"Buzz Cut",labelDe:"Sehr kurz",labelFr:"Très court"},{value:"cropped",label:"Cropped",labelDe:"Kurz",labelFr:"Court"},{value:"pixie",label:"Pixie",labelDe:"Pixie",labelFr:"Pixie"},{value:"ear-length",label:"Ear-Length",labelDe:"Ohrlang",labelFr:"Aux oreilles"},{value:"chin-length",label:"Chin-Length",labelDe:"Kinnlang",labelFr:"Au menton"},{value:"neck-length",label:"Neck-Length",labelDe:"Nackenlang",labelFr:"Au cou"},{value:"shoulder-length",label:"Shoulder-Length",labelDe:"Schulterlang",labelFr:"Aux épaules"},{value:"armpit-length",label:"Armpit-Length",labelDe:"Achsellang",labelFr:"Aux aisselles"},{value:"mid-back",label:"Mid-Back",labelDe:"Rückenmitte",labelFr:"Mi-dos"},{value:"waist-length",label:"Waist-Length",labelDe:"Hüftlang",labelFr:"Aux hanches"}],ua=[{value:"black",label:"Black",labelDe:"Schwarz",labelFr:"Noir"},{value:"dark brown",label:"Dark Brown",labelDe:"Dunkelbraun",labelFr:"Brun foncé"},{value:"brown",label:"Brown",labelDe:"Braun",labelFr:"Brun"},{value:"light brown",label:"Light Brown",labelDe:"Hellbraun",labelFr:"Châtain clair"},{value:"chestnut",label:"Chestnut",labelDe:"Kastanienbraun",labelFr:"Châtain"},{value:"auburn",label:"Auburn",labelDe:"Rotbraun",labelFr:"Auburn"},{value:"red",label:"Red",labelDe:"Rot",labelFr:"Roux"},{value:"strawberry blonde",label:"Strawberry Blonde",labelDe:"Erdbeerblond",labelFr:"Blond vénitien"},{value:"dark blonde",label:"Dark Blonde",labelDe:"Dunkelblond",labelFr:"Blond foncé"},{value:"blonde",label:"Blonde",labelDe:"Blond",labelFr:"Blond"},{value:"light blonde",label:"Light Blonde",labelDe:"Hellblond",labelFr:"Blond clair"},{value:"platinum blonde",label:"Platinum Blonde",labelDe:"Platinblond",labelFr:"Blond platine"},{value:"gray",label:"Gray",labelDe:"Grau",labelFr:"Gris"},{value:"silver",label:"Silver",labelDe:"Silber",labelFr:"Argenté"},{value:"white",label:"White",labelDe:"Weiss",labelFr:"Blanc"},{value:"salt and pepper",label:"Salt and Pepper",labelDe:"Graumeliert",labelFr:"Poivre et sel"}],ba=[{value:"straight",label:"Straight",labelDe:"Glatt",labelFr:"Lisse"},{value:"wavy",label:"Wavy",labelDe:"Wellig",labelFr:"Ondulé"},{value:"curly",label:"Curly",labelDe:"Lockig",labelFr:"Bouclé"},{value:"coily",label:"Coily",labelDe:"Kraus",labelFr:"Crépu"},{value:"messy",label:"Messy",labelDe:"Zerzaust",labelFr:"Ébouriffé"},{value:"spiky",label:"Spiky",labelDe:"Stachelig",labelFr:"En pointes"},{value:"layered",label:"Layered",labelDe:"Gestuft",labelFr:"Dégradé"},{value:"slicked back",label:"Slicked Back",labelDe:"Zurückgekämmt",labelFr:"Plaqué"},{value:"loose",label:"Loose",labelDe:"Offen",labelFr:"Lâche"},{value:"ponytail",label:"Ponytail",labelDe:"Pferdeschwanz",labelFr:"Queue de cheval"},{value:"braids",label:"Braids",labelDe:"Zöpfe",labelFr:"Tresses"},{value:"bun",label:"Bun",labelDe:"Dutt",labelFr:"Chignon"},{value:"pigtails",label:"Pigtails",labelDe:"Zöpfchen",labelFr:"Couettes"},{value:"bob",label:"Bob",labelDe:"Bob",labelFr:"Carré"},{value:"afro",label:"Afro",labelDe:"Afro",labelFr:"Afro"},{value:"mohawk",label:"Mohawk",labelDe:"Irokese",labelFr:"Crête"},{value:"mullet",label:"Mullet",labelDe:"Vokuhila",labelFr:"Mulet"},{value:"undercut",label:"Undercut",labelDe:"Undercut",labelFr:"Undercut"},{value:"bangs",label:"Bangs",labelDe:"Pony",labelFr:"Frange"},{value:"side bangs",label:"Side Bangs",labelDe:"Seitenpony",labelFr:"Frange de côté"}],ga=[{value:"none",label:"None",labelDe:"Keiner",labelFr:"Aucune"},{value:"clean-shaven",label:"Clean Shaven",labelDe:"Glatt rasiert",labelFr:"Rasé de près"},{value:"stubble",label:"Stubble",labelDe:"Stoppeln",labelFr:"Barbe de 3 jours"},{value:"mustache",label:"Mustache",labelDe:"Schnurrbart",labelFr:"Moustache"},{value:"goatee",label:"Goatee",labelDe:"Ziegenbart",labelFr:"Bouc"},{value:"short beard",label:"Short Beard",labelDe:"Kurzer Bart",labelFr:"Barbe courte"},{value:"full beard",label:"Full Beard",labelDe:"Vollbart",labelFr:"Barbe complète"},{value:"long beard",label:"Long Beard",labelDe:"Langer Bart",labelFr:"Longue barbe"}];function je({label:s,value:n,placeholder:d,onChange:p,isChanged:r,isAiExtracted:B,isUserEdited:y,language:N}){const c=N==="de"?"Von dir bearbeitet - wird bei Neugenerierung beibehalten":N==="fr"?"Modifié par vous - sera conservé lors de la régénération":"Edited by you - will be enforced on regeneration";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${B?"text-gray-400":"text-gray-600"}`,children:[s,":"]}),e.jsx("input",{type:"text",value:n,onChange:o=>p(o.target.value),className:`flex-1 min-w-0 px-2 py-1 text-sm border rounded focus:outline-none focus:border-indigo-400 hover:border-gray-300 ${y?"border-blue-400 bg-blue-50 ring-1 ring-blue-200":r?"border-amber-400 bg-amber-50 text-amber-800":B?"border-gray-200 bg-gray-50 text-gray-500":"border-gray-200 bg-white"}`,placeholder:d}),y&&e.jsx("span",{className:"text-blue-500 text-xs cursor-help",title:c,children:"✎"}),r&&!y&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed from previous photo",children:"●"})]})}function pa({character:s,language:n,updatePhysical:d,updateApparentAge:p,changedTraits:r,isAiExtracted:B}){var C,S,P,w,D,k,b,x,A,j;const y=B?"text-gray-400":"text-gray-600",N=a=>{var u;return((u=s.physicalTraitsSource)==null?void 0:u[a])==="user"},c=(a,u)=>`flex-1 min-w-0 px-2 py-1 text-sm border rounded focus:outline-none focus:border-indigo-400 hover:border-gray-300 ${u&&N(u)?"border-blue-400 bg-blue-50 ring-1 ring-blue-200":a?"border-amber-400 bg-amber-50":B?"border-gray-200 bg-gray-50 text-gray-500":"border-gray-200 bg-white"}`,o=({field:a})=>{if(!N(a))return null;const u=n==="de"?"Von dir bearbeitet - wird bei Neugenerierung beibehalten":n==="fr"?"Modifié par vous - sera conservé lors de la régénération":"Edited by you - will be enforced on regeneration";return e.jsx("span",{className:"text-blue-500 text-xs cursor-help",title:u,children:"✎"})};return e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1.5 text-xs",children:[e.jsx(je,{label:n==="de"?"Augenfarbe":n==="fr"?"Couleur des yeux":"Eye Color",value:((C=s.physical)==null?void 0:C.eyeColor)||"",placeholder:n==="de"?"z.B. blau":"e.g. blue",onChange:a=>d("eyeColor",a),isAiExtracted:B,isChanged:r==null?void 0:r.eyeColor,isUserEdited:N("eyeColor"),language:n}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${y}`,children:[n==="de"?"Visuelles Alter":n==="fr"?"Âge visuel":"Visual Age",":"]}),e.jsxs("select",{value:((S=s.physical)==null?void 0:S.apparentAge)||Ot(s.age)||"",onChange:a=>p(a.target.value),className:c(r==null?void 0:r.apparentAge),children:[e.jsx("option",{value:"",children:"— Auto —"}),ca.map(a=>e.jsx("option",{value:a.value,children:n==="de"?a.labelDe:n==="fr"?a.labelFr:a.label},a.value))]}),(r==null?void 0:r.apparentAge)&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"●"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${y}`,children:[n==="de"?"Haarfarbe":n==="fr"?"Couleur":"Hair Color",":"]}),e.jsxs("select",{value:((P=s.physical)==null?void 0:P.hairColor)||"",onChange:a=>d("hairColor",a.target.value),className:c(r==null?void 0:r.hairColor,"hairColor"),children:[e.jsx("option",{value:"",children:n==="de"?"— Wählen —":n==="fr"?"— Choisir —":"— Select —"}),ua.map(a=>e.jsx("option",{value:a.value,children:n==="de"?a.labelDe:n==="fr"?a.labelFr:a.label},a.value))]}),e.jsx(o,{field:"hairColor"}),(r==null?void 0:r.hairColor)&&!N("hairColor")&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"●"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${y}`,children:[n==="de"?"Haarlänge":n==="fr"?"Longueur":"Hair Length",":"]}),e.jsxs("select",{value:((w=s.physical)==null?void 0:w.hairLength)||"",onChange:a=>d("hairLength",a.target.value),className:c(r==null?void 0:r.hairLength,"hairLength"),children:[e.jsx("option",{value:"",children:n==="de"?"— Wählen —":n==="fr"?"— Choisir —":"— Select —"}),ma.map(a=>e.jsx("option",{value:a.value,children:n==="de"?a.labelDe:n==="fr"?a.labelFr:a.label},a.value))]}),e.jsx(o,{field:"hairLength"}),(r==null?void 0:r.hairLength)&&!N("hairLength")&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"●"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${y}`,children:[n==="de"?"Frisur":n==="fr"?"Coiffure":"Hair Style",":"]}),e.jsxs("select",{value:((D=s.physical)==null?void 0:D.hairStyle)||"",onChange:a=>d("hairStyle",a.target.value),className:c(r==null?void 0:r.hairStyle,"hairStyle"),children:[e.jsx("option",{value:"",children:n==="de"?"— Wählen —":n==="fr"?"— Choisir —":"— Select —"}),ba.map(a=>e.jsx("option",{value:a.value,children:n==="de"?a.labelDe:n==="fr"?a.labelFr:a.label},a.value))]}),e.jsx(o,{field:"hairStyle"}),(r==null?void 0:r.hairStyle)&&!N("hairStyle")&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"●"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${y}`,children:[n==="de"?"Körperbau":n==="fr"?"Corpulence":"Build",":"]}),e.jsxs("select",{value:((k=s.physical)==null?void 0:k.build)||"",onChange:a=>d("build",a.target.value),className:c(r==null?void 0:r.build,"build"),children:[e.jsx("option",{value:"",children:n==="de"?"— Wählen —":n==="fr"?"— Choisir —":"— Select —"}),xa.map(a=>e.jsx("option",{value:a.value,children:n==="de"?a.labelDe:n==="fr"?a.labelFr:a.label},a.value))]}),e.jsx(o,{field:"build"}),(r==null?void 0:r.build)&&!N("build")&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"●"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${y}`,children:[n==="de"?"Hautton":n==="fr"?"Teint":"Skin Tone",":"]}),e.jsx("input",{type:"text",value:((b=s.physical)==null?void 0:b.skinTone)||"",placeholder:n==="de"?"z.B. hell, mittel":"e.g. fair, medium",onChange:a=>d("skinTone",a.target.value),className:`flex-1 min-w-0 px-2 py-1 text-sm border rounded focus:outline-none focus:border-indigo-400 hover:border-gray-300 ${N("skinTone")?"border-blue-400 bg-blue-50 ring-1 ring-blue-200":r!=null&&r.skinTone?"border-amber-400 bg-amber-50":B?"border-gray-200 bg-gray-50 text-gray-500":"border-gray-200 bg-white"}`}),e.jsx(o,{field:"skinTone"}),(r==null?void 0:r.skinTone)&&!N("skinTone")&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"●"})]}),s.gender!=="female"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${y}`,children:[n==="de"?"Bart":n==="fr"?"Barbe":"Facial Hair",":"]}),e.jsxs("select",{value:((x=s.physical)==null?void 0:x.facialHair)||"",onChange:a=>d("facialHair",a.target.value),className:c(r==null?void 0:r.facialHair,"facialHair"),children:[e.jsx("option",{value:"",children:n==="de"?"— Wählen —":n==="fr"?"— Choisir —":"— Select —"}),ga.map(a=>e.jsx("option",{value:a.value,children:n==="de"?a.labelDe:n==="fr"?a.labelFr:a.label},a.value))]}),e.jsx(o,{field:"facialHair"}),(r==null?void 0:r.facialHair)&&!N("facialHair")&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"●"})]}):e.jsx(je,{label:n==="de"?"Sonstiges":n==="fr"?"Autre":"Other",value:((A=s.physical)==null?void 0:A.other)||"",placeholder:n==="de"?"z.B. Brille":"e.g. glasses",onChange:a=>d("other",a),isAiExtracted:B,isChanged:r==null?void 0:r.other,isUserEdited:N("other"),language:n}),s.gender!=="female"&&e.jsx("div",{className:"col-span-2",children:e.jsx(je,{label:n==="de"?"Sonstiges":n==="fr"?"Autre":"Other",value:((j=s.physical)==null?void 0:j.other)||"",placeholder:n==="de"?"z.B. Brille":"e.g. glasses",onChange:a=>d("other",a),isAiExtracted:B,isChanged:r==null?void 0:r.other,isUserEdited:N("other"),language:n})})]})}function Pt({character:s,allCharacters:n=[],onChange:d,onSave:p,onCancel:r,onPhotoChange:B,onSaveAndTryNewPhoto:y,onContinueToTraits:N,onContinueToCharacteristics:c,onContinueToRelationships:o,onContinueToAvatar:C,isNewCharacter:S=!1,onSaveAndGenerateAvatar:P,onSaveAndRegenerateWithTraits:w,onRegenerateAvatars:D,onRegenerateAvatarsWithTraits:k,isLoading:b,isAnalyzingPhoto:x,isGeneratingAvatar:A,isRegeneratingAvatars:j,isRegeneratingAvatarsWithTraits:a,step:u,developerMode:g,isImpersonating:m=!1,changedTraits:$,photoAnalysisDebug:M,relationships:U={},relationshipTexts:W={},onRelationshipChange:L,onRelationshipTextChange:E,customRelationships:V=[],onAddCustomRelationship:_}){var Pe,$e,Me,Oe,Le,Ee,He,Ge,Ke,Ie,Ue,Ve,_e,qe,Je,We,Re,Ye,Ze,Qe,Xe,Te,es,ss,ls,ts,as,rs,ns,is,os,ds,cs,xs,ms,us,bs,gs,ps,hs,fs,vs,js,ys,Ns,ws,ks,Cs,Ss,Fs,Bs,Ds,As,zs,Ps,$s,Ms,Os,Ls,Es,Hs,Gs,Ks,Is,Us,Vs,_s,qs,Js,Ws,Rs,Ys,Zs,Qs,Xs,Ts,el,sl,ll,tl,al,rl,nl,il,ol,dl,cl,xl,ml,ul,bl,gl,pl,hl,fl,vl,jl,yl,Nl,wl,kl,Cl,Sl,Fl,Bl,Dl,Al,zl,Pl,$l,Ml,Ol,Ll,El,Hl,Gl,Kl,Il,Ul,Vl,_l,ql,Jl,Wl,Rl,Yl,Zl,Ql,Xl,Tl,et,st,lt,tt,at,rt,nt,it,ot,dt,ct,xt;const{t:v,language:l}=re(),[ne,K]=z.useState(!1),[R,I]=z.useState(null),[Y,X]=z.useState(!1),[Et,me]=z.useState(!1),[he,fe]=z.useState(!1),[Ne,ve]=z.useState(null),[ie,ue]=z.useState(null),[oe,de]=z.useState(null),[we,ke]=z.useState(!1);z.useEffect(()=>(Y||he?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[Y,he]);const Ht=!!(($e=(Pe=s.clothing)==null?void 0:Pe.structured)!=null&&$e.upperBody||(Oe=(Me=s.clothing)==null?void 0:Me.structured)!=null&&Oe.lowerBody||(Ee=(Le=s.clothing)==null?void 0:Le.structured)!=null&&Ee.shoes||(Ge=(He=s.clothing)==null?void 0:He.structured)!=null&&Ge.fullBody),Gt=!!((Ke=s.avatars)!=null&&Ke.winter||(Ie=s.avatars)!=null&&Ie.standard||(Ue=s.avatars)!=null&&Ue.summer),Ce=t=>{var h;const i=(h=t.target.files)==null?void 0:h[0];i&&(Ht&&Gt?(ve(i),fe(!0)):B(i,!1)),t.target.value=""},Se=t=>{Ne&&B(Ne,t),fe(!1),ve(null)},ee=(t,i)=>{d(t==="age"&&typeof i=="string"?{...s,[t]:i,ageCategory:Ot(i)}:{...s,[t]:i})},be=(t,i)=>{d({...s,physical:{...s.physical,[t]:i},physicalTraitsSource:{...s.physicalTraitsSource,[t]:"user"}})},Z=(t,i)=>{d({...s,traits:{...s.traits,[t]:i}})},{canRegenerate:T,waitSeconds:se,recordRegeneration:Fe}=Zt(s.id),Kt=()=>{T&&(Fe(),k==null||k())},It=async()=>{var h,f;const t=((h=s.photos)==null?void 0:h.body)||((f=s.photos)==null?void 0:f.original);if(!t)return;const i=s.gender==="female"?"female":"male";ke(!0),ue(null),de(null);try{const F=await Qt.generateAvatarOptions(t,i);F.success&&F.options.length>0&&(ue(F.options),de(F.options[0].id))}catch(F){console.error("Failed to generate avatar options:",F)}finally{ke(!1)}},Ut=()=>{if(ie&&oe!==null){const t=ie.find(i=>i.id===oe);t&&(d({...s,avatars:{...s.avatars,standard:t.imageData,status:"complete",generatedAt:new Date().toISOString()}}),ue(null),de(null))}},Be=s.name&&s.name.trim().length>=2&&s.gender&&s.age,ge=s.name&&((Ve=s.traits)==null?void 0:Ve.strengths)&&s.traits.strengths.length>=3&&((_e=s.traits)==null?void 0:_e.flaws)&&s.traits.flaws.length>=2,De=Dt[l]||Dt.en,Ae=At[l]||At.en,ze=zt[l]||zt.en,H=((Je=(qe=s.avatars)==null?void 0:qe.faceThumbnails)==null?void 0:Je.standard)||((We=s.photos)==null?void 0:We.face)||((Re=s.photos)==null?void 0:Re.original);if(u==="name")return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"flex-1 min-w-0 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[x?e.jsx("div",{className:"w-24 h-24 rounded-full bg-indigo-100 border-4 border-indigo-400 shadow-lg flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] text-indigo-600 font-medium",children:l==="de"?"Analysiere...":l==="fr"?"Analyse...":"Analyzing..."})]})}):H?e.jsx("img",{draggable:!1,src:H,alt:"Character",className:"w-24 h-24 rounded-full object-cover border-4 border-indigo-400 shadow-lg cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>I(H),title:l==="de"?"Klicken zum Vergrössern":"Click to enlarge"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-200 border-4 border-gray-300 flex items-center justify-center",children:e.jsx(xe,{size:24,className:"text-gray-400"})}),e.jsxs("label",{className:"cursor-pointer bg-gray-200 text-gray-700 px-3 py-1.5 rounded-lg text-xs hover:bg-gray-300 flex items-center gap-1.5 font-semibold transition-colors",children:[e.jsx(xe,{size:12}),l==="de"?"Ändern":l==="fr"?"Changer":"Change",e.jsx("input",{type:"file",accept:"image/*",onChange:Ce,className:"hidden"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-semibold mb-1 text-gray-700",children:l==="de"?"Name":l==="fr"?"Nom":"Name"}),e.jsx("input",{type:"text",value:s.name,onChange:t=>ee("name",t.target.value),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg text-lg focus:border-indigo-500 focus:outline-none",placeholder:v.characterName,autoFocus:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[10px] font-semibold text-gray-600 mb-0.5",children:[v.gender," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:s.gender||"",onChange:t=>ee("gender",t.target.value),className:`w-full px-2 py-1.5 border rounded text-base focus:border-indigo-500 focus:outline-none ${s.gender?"border-gray-300":"border-red-300"}`,children:[e.jsx("option",{value:"",children:l==="de"?"— Bitte wählen —":l==="fr"?"— Veuillez choisir —":"— Please select —"}),e.jsx("option",{value:"male",children:v.male}),e.jsx("option",{value:"female",children:v.female}),e.jsx("option",{value:"other",children:v.other})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[10px] font-semibold text-gray-600 mb-0.5",children:[v.age," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:s.age,onChange:t=>ee("age",t.target.value),className:`w-full px-2 py-1.5 border rounded text-base focus:border-indigo-500 focus:outline-none ${s.age?"border-gray-300":"border-red-300"}`,min:"1",max:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-600 mb-0.5",children:l==="de"?"Grösse (cm)":l==="fr"?"Taille (cm)":"Height (cm)"}),e.jsx("input",{type:"number",value:((Ye=s.physical)==null?void 0:Ye.height)||"",onChange:t=>be("height",t.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-base focus:border-indigo-500 focus:outline-none",placeholder:"170",min:"50",max:"250"})]})]})]})}),!Be&&((Ze=s.name)==null?void 0:Ze.trim().length)>=2&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:l==="de"?"Bitte Geschlecht und Alter eingeben":l==="fr"?"Veuillez entrer le sexe et l'âge":"Please enter gender and age"}),e.jsxs("div",{className:"flex gap-3",children:[r&&e.jsx("button",{onClick:r,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:v.cancel}),e.jsx(ae,{onClick:N,disabled:!Be||b||x,loading:b,icon:ce,className:r?"flex-1":"w-full",children:l==="de"?"Weiter":l==="fr"?"Suivant":"Next"})]})]});if(S&&u==="traits")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-gray-200",children:[H&&e.jsx("img",{draggable:!1,src:H,alt:s.name,className:"w-16 h-16 rounded-full object-cover border-2 border-indigo-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.gender==="male"?l==="de"?"Männlich":"Male":s.gender==="female"?l==="de"?"Weiblich":"Female":l==="de"?"Andere":"Other",", ",s.age," ",l==="de"?"Jahre":"years"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(te,{label:v.strengths,traits:De,selectedTraits:((Qe=s.traits)==null?void 0:Qe.strengths)||[],onSelect:t=>Z("strengths",t),minRequired:3,defaultExpanded:!0}),e.jsx(te,{label:l==="de"?"Schwächen":l==="fr"?"Défauts":"Flaws",traits:Ae,selectedTraits:((Xe=s.traits)==null?void 0:Xe.flaws)||[],onSelect:t=>Z("flaws",t),minRequired:2,defaultExpanded:!0}),e.jsx(te,{label:l==="de"?"Konflikte / Herausforderungen":l==="fr"?"Conflits / Défis":"Conflicts / Challenges",traits:ze,selectedTraits:((Te=s.traits)==null?void 0:Te.challenges)||[],onSelect:t=>Z("challenges",t),defaultExpanded:!0})]}),e.jsxs("div",{className:"sticky bottom-0 left-0 right-0 bg-white pt-4 pb-2 -mx-4 px-4 md:relative md:mx-0 md:px-0 md:bg-transparent border-t border-gray-200 md:border-0 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] md:shadow-none",children:[!ge&&e.jsx("p",{className:"text-sm text-red-500 text-center mb-3",children:v.selectStrengthsFlaws}),e.jsxs("div",{className:"flex gap-3",children:[r&&e.jsx("button",{onClick:r,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:v.cancel}),e.jsx(ae,{onClick:c,disabled:!ge||b,loading:b,icon:ce,className:r?"flex-1":"w-full",children:l==="de"?"Weiter":l==="fr"?"Suivant":"Next"})]})]})]});if(S&&u==="characteristics")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-gray-200",children:[H&&e.jsx("img",{draggable:!1,src:H,alt:s.name,className:"w-16 h-16 rounded-full object-cover border-2 border-indigo-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.gender==="male"?l==="de"?"Männlich":"Male":s.gender==="female"?l==="de"?"Weiblich":"Female":l==="de"?"Andere":"Other",", ",s.age," ",l==="de"?"Jahre":"years"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold mb-2 text-gray-800",children:v.specialDetails}),e.jsx("textarea",{value:((es=s.traits)==null?void 0:es.specialDetails)||"",onChange:t=>Z("specialDetails",t.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none",placeholder:v.specialDetailsPlaceholder,rows:5}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:l==="de"?"Füge hier besondere Details hinzu, die den Charakter einzigartig machen (optional).":l==="fr"?"Ajoutez ici des détails spéciaux qui rendent le personnage unique (facultatif).":"Add any special details that make this character unique (optional)."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[r&&e.jsx("button",{onClick:r,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:v.cancel}),e.jsx(ae,{onClick:n.length>0?o:C,disabled:b,loading:b,icon:ce,className:r?"flex-1":"w-full",children:l==="de"?"Weiter":l==="fr"?"Suivant":"Next"})]})]});if(S&&u==="relationships")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-gray-200",children:[H&&e.jsx("img",{draggable:!1,src:H,alt:s.name,className:"w-16 h-16 rounded-full object-cover border-2 border-indigo-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.gender==="male"?l==="de"?"Männlich":"Male":s.gender==="female"?l==="de"?"Weiblich":"Female":l==="de"?"Andere":"Other",", ",s.age," ",l==="de"?"Jahre":"years"]})]})]}),n.length>0&&L&&E?e.jsx(Bt,{character:s,allCharacters:n,relationships:U,relationshipTexts:W,onRelationshipChange:L,onRelationshipTextChange:E,customRelationships:V,onAddCustomRelationship:_}):e.jsx("p",{className:"text-center text-gray-500 py-8",children:l==="de"?"Erstelle weitere Charaktere, um Beziehungen hinzuzufügen.":l==="fr"?"Créez d'autres personnages pour ajouter des relations.":"Create more characters to add relationships."}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[r&&e.jsx("button",{onClick:r,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:v.cancel}),e.jsx(ae,{onClick:C,disabled:b,loading:b,icon:ce,className:r?"flex-1":"w-full",children:l==="de"?"Weiter":l==="fr"?"Suivant":"Next"})]})]});if(S&&u==="avatar"){const t=(ss=s.avatars)==null?void 0:ss.status,i=((ts=(ls=s.avatars)==null?void 0:ls.faceThumbnails)==null?void 0:ts.standard)||((as=s.avatars)==null?void 0:as.standard)||((rs=s.avatars)==null?void 0:rs.winter)||((ns=s.avatars)==null?void 0:ns.summer),h=!!i||((is=s.avatars)==null?void 0:is.hasFullAvatars),f=A||a||t==="generating",F=t==="failed";return e.jsxs("div",{className:"space-y-6",children:[!f&&e.jsx("div",{className:"text-center",children:e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:F?l==="de"?"Erstellung fehlgeschlagen":l==="fr"?"Échec de la création":"Creation failed":l==="de"?`${s.name}`:l==="fr"?`${s.name}`:`${s.name}`})}),e.jsx("div",{className:"flex justify-center",children:h?e.jsxs("div",{className:"relative",children:[e.jsx("img",{draggable:!1,src:i,alt:`${s.name} avatar`,className:"w-64 h-80 object-contain rounded-lg bg-white shadow-lg border-2 border-indigo-200 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>I(i||null),title:l==="de"?"Klicken zum Vergrössern":l==="fr"?"Cliquer pour agrandir":"Click to enlarge"}),f&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 rounded-lg pointer-events-none",children:e.jsx("div",{className:"w-8 h-8 border-3 border-white border-t-transparent rounded-full animate-spin"})})]}):f?e.jsxs("div",{className:"w-64 h-80 rounded-lg border-2 border-dashed border-indigo-300 bg-indigo-50 flex flex-col items-center justify-center p-4 text-center",children:[e.jsx("span",{className:"text-indigo-700 font-medium mb-2",children:l==="de"?`So wird ${s.name} in deiner Geschichte aussehen`:l==="fr"?`Voici comment ${s.name} apparaîtra dans ton histoire`:`This is how ${s.name} will look in your story`}),e.jsx("div",{className:"w-10 h-10 border-3 border-indigo-500 border-t-transparent rounded-full animate-spin my-4"}),e.jsx("span",{className:"text-indigo-500 text-sm",children:l==="de"?"Du kannst warten oder direkt weiterfahren":l==="fr"?"Tu peux attendre ou continuer":"You can wait or continue"})]}):e.jsx("div",{className:"w-64 h-80 rounded-lg border-2 border-dashed border-gray-300 bg-gray-100 flex flex-col items-center justify-center",children:e.jsx("span",{className:"text-gray-400",children:F?l==="de"?"Erstellung fehlgeschlagen":l==="fr"?"Échec de génération":"Creation failed":l==="de"?"Kein Bild":l==="fr"?"Pas d'image":"No image"})})}),e.jsxs("div",{className:"flex flex-col gap-3 max-w-md mx-auto",children:[h&&!f&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:p,disabled:b,className:"w-full px-6 py-4 text-lg font-bold bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-3 shadow-lg",children:[b?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Mt,{size:24}),l==="de"?"Weiter":l==="fr"?"Continuer":"Continue"]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:l==="de"?"Du kannst das Aussehen später jederzeit anpassen":l==="fr"?"Tu peux modifier l'apparence plus tard":"You can modify the look later anytime"}),y&&e.jsxs("button",{onClick:y,className:"w-full px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(ta,{size:16}),l==="de"?"Mit neuem Foto versuchen":l==="fr"?"Essayer avec une nouvelle photo":"Try with a new photo"]})]}),f&&!F&&e.jsxs("button",{onClick:p,disabled:b,className:"w-full px-6 py-4 text-base font-semibold bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[b?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(ce,{size:20}),l==="de"?"Weiter ohne zu warten":l==="fr"?"Continuer sans attendre":"Continue without waiting"]}),F&&e.jsxs("button",{onClick:p,disabled:b,className:"w-full px-6 py-4 text-base font-semibold bg-gray-600 text-white rounded-xl hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[b?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(pe,{size:20}),l==="de"?"Charakter trotzdem speichern":l==="fr"?"Enregistrer quand même":"Save character anyway"]})]}),e.jsx(kt,{src:R,onClose:()=>I(null)})]})}return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 lg:gap-6",children:[e.jsx("div",{className:"lg:w-60 flex-shrink-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex-shrink-0",children:x?e.jsx("div",{className:"w-14 h-14 rounded-full bg-indigo-100 border-2 border-indigo-400 flex items-center justify-center",children:e.jsx("div",{className:"w-5 h-5 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"})}):H?e.jsx("img",{draggable:!1,src:H,alt:s.name,className:"w-14 h-14 rounded-full object-cover border-2 border-indigo-400 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{var t;return I(((t=s.avatars)==null?void 0:t.standard)||H)},title:l==="de"?"Klicken zum Vergrössern":"Click to enlarge"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-gray-200 border-2 border-gray-300 flex items-center justify-center",children:e.jsx(xe,{size:18,className:"text-gray-400"})})}),e.jsx("div",{className:"flex flex-col gap-1",children:Et?e.jsx("input",{type:"text",value:s.name,onChange:t=>ee("name",t.target.value),onBlur:()=>me(!1),onKeyDown:t=>{t.key==="Enter"&&me(!1),t.key==="Escape"&&me(!1)},className:"text-xl font-bold text-gray-800 border-b-2 border-indigo-500 bg-transparent focus:outline-none px-0 py-0",autoFocus:!0}):e.jsxs("h3",{className:"text-xl font-bold text-gray-800 cursor-pointer hover:text-indigo-600 flex items-center gap-1 group",onClick:()=>me(!0),title:l==="de"?"Klicken zum Bearbeiten":"Click to edit",children:[s.name,e.jsx(Ct,{size:14,className:"text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]})})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-500 mb-0.5",children:v.gender}),e.jsxs("select",{value:s.gender||"",onChange:t=>ee("gender",t.target.value),className:"w-full px-1.5 py-1 border border-gray-300 rounded text-xs bg-white focus:border-indigo-500 focus:outline-none",children:[e.jsx("option",{value:"",children:l==="de"?"— Unbekannt —":l==="fr"?"— Inconnu —":"— Unknown —"}),e.jsx("option",{value:"male",children:v.male}),e.jsx("option",{value:"female",children:v.female}),e.jsx("option",{value:"other",children:v.other})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-500 mb-0.5",children:v.age}),e.jsx("input",{type:"number",value:s.age,onChange:t=>ee("age",t.target.value),className:"w-full px-1.5 py-1 border border-gray-300 rounded text-xs focus:border-indigo-500 focus:outline-none",min:"1",max:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-500 mb-0.5",children:l==="de"?"Grösse":l==="fr"?"Taille":"Height"}),e.jsx("input",{type:"number",value:((os=s.physical)==null?void 0:os.height)||"",onChange:t=>be("height",t.target.value),className:"w-full px-1.5 py-1 border border-gray-300 rounded text-xs focus:border-indigo-500 focus:outline-none",placeholder:"cm",min:"50",max:"250"})]})]}),e.jsxs("div",{className:"flex flex-col items-center lg:items-start",children:[(()=>{var f,F,q,G,Q;const t=(f=s.avatars)==null?void 0:f.standard,i=((F=s.avatars)==null?void 0:F.hasFullAvatars)&&!((q=s.avatars)!=null&&q.standard),h=A||j||a||((G=s.avatars)==null?void 0:G.status)==="generating";return t?e.jsxs("div",{className:"relative",children:[e.jsx("img",{draggable:!1,src:t,alt:`${s.name} avatar`,className:`w-full max-w-[180px] lg:max-w-full aspect-[3/4] object-contain rounded-lg bg-white cursor-pointer hover:opacity-90 transition-opacity ${(Q=s.avatars)!=null&&Q.stale?"opacity-80":""}`,onClick:()=>K(!0),title:l==="de"?"Klicken zum Vergrössern":"Click to enlarge"}),h&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 rounded-lg",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}):e.jsx("div",{className:"w-full max-w-[180px] lg:max-w-full aspect-[3/4] rounded-lg border-2 border-dashed border-gray-300 bg-gray-100 flex flex-col items-center justify-center",children:h||i?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-indigo-600 font-medium px-2 text-center",children:l==="de"?i?"Lädt...":"Wird erstellt...":i?"Loading...":"Creating..."})]}):e.jsx("span",{className:"text-[10px] text-gray-400 text-center px-2",children:l==="de"?"Kein Bild":"No image"})})})(),ne&&(((ds=s.avatars)==null?void 0:ds.standard)||((xs=(cs=s.avatars)==null?void 0:cs.faceThumbnails)==null?void 0:xs.standard))&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75",onClick:()=>K(!1),children:[e.jsx("img",{draggable:!1,src:((ms=s.avatars)==null?void 0:ms.standard)||((bs=(us=s.avatars)==null?void 0:us.faceThumbnails)==null?void 0:bs.standard),alt:`${s.name} avatar`,className:"max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl",onClick:t=>t.stopPropagation()}),e.jsx("button",{className:"absolute top-4 right-4 text-white text-3xl hover:text-gray-300",onClick:()=>K(!1),children:"×"})]}),e.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row gap-2 w-full",children:[e.jsxs("label",{className:"flex-1 px-4 py-3 text-sm font-medium bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center justify-center gap-2 cursor-pointer transition-colors",children:[e.jsx(xe,{size:16}),l==="de"?"Neues Foto":l==="fr"?"Nouvelle photo":"New Photo",e.jsx("input",{type:"file",accept:"image/*",onChange:Ce,className:"hidden"})]}),e.jsxs("button",{onClick:()=>X(!0),className:"flex-1 px-4 py-3 text-sm font-medium bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Ct,{size:16}),l==="de"?"Anpassen":l==="fr"?"Modifier":"Modify"]})]}),e.jsxs("div",{className:"mt-1 space-y-1",children:[(g||m)&&e.jsxs("button",{onClick:Kt,disabled:!T||j||a||((gs=s.avatars)==null?void 0:gs.status)==="generating",className:"w-full px-2 py-1 text-[10px] font-medium bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1",title:T?void 0:`Wait ${se}s`,children:[e.jsx(ea,{size:10}),T?j||a?l==="de"?"Generiere...":"Generating...":l==="de"?"Neu generieren":"Regenerate":`${se}s`]}),(g||m)&&e.jsx("button",{onClick:It,disabled:we||j||a||!((ps=s.photos)!=null&&ps.original),className:"w-full px-2 py-1 text-[10px] font-medium bg-purple-100 text-purple-700 rounded hover:bg-purple-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1",children:we?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}),l==="de"?"Generiere 3...":"Generating 3..."]}):l==="de"?"3 Optionen generieren":"Generate 3 Options"})]}),(g||m)&&((fs=(hs=s.avatars)==null?void 0:hs.faceMatch)==null?void 0:fs.standard)&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsxs("summary",{className:`text-[10px] font-medium cursor-pointer ${s.avatars.faceMatch.standard.score>=6?"text-green-600":"text-red-600"}`,children:["Face eval: ",s.avatars.faceMatch.standard.score,"/10",s.avatars.faceMatch.standard.lpips&&e.jsxs("span",{className:`ml-2 ${s.avatars.faceMatch.standard.lpips.lpipsScore<.15?"text-green-600":s.avatars.faceMatch.standard.lpips.lpipsScore<.3?"text-yellow-600":"text-red-600"}`,children:["| LPIPS: ",(vs=s.avatars.faceMatch.standard.lpips.lpipsScore)==null?void 0:vs.toFixed(3)]}),s.avatars.faceMatch.standard.arcface&&e.jsxs("span",{className:`ml-2 ${s.avatars.faceMatch.standard.arcface.samePerson?"text-green-600":"text-red-600"}`,children:["| ID: ",((s.avatars.faceMatch.standard.arcface.similarity??0)*100).toFixed(0),"% (",s.avatars.faceMatch.standard.arcface.confidence,")"]})]}),e.jsxs("pre",{className:"mt-1 p-2 rounded text-[9px] whitespace-pre-wrap overflow-auto max-h-48 border bg-gray-100 border-gray-200",children:[s.avatars.faceMatch.standard.details,s.avatars.faceMatch.standard.lpips&&`

LPIPS Perceptual Similarity:
- Score: ${(js=s.avatars.faceMatch.standard.lpips.lpipsScore)==null?void 0:js.toFixed(4)}
- Interpretation: ${s.avatars.faceMatch.standard.lpips.interpretation}
- Note: 0 = identical, <0.15 = very similar, <0.30 = similar`,s.avatars.faceMatch.standard.arcface&&`

ArcFace Identity (style-invariant):
- Similarity: ${((s.avatars.faceMatch.standard.arcface.similarity??0)*100).toFixed(1)}%
- Same Person: ${s.avatars.faceMatch.standard.arcface.samePerson?"Yes":"No"}
- Confidence: ${s.avatars.faceMatch.standard.arcface.confidence}
- Note: Works photo→anime, >60% = high confidence same person`]})]}),(g||m)&&((ys=s.avatars)==null?void 0:ys.clothing)&&Object.keys(s.avatars.clothing).length>0&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsxs("summary",{className:"text-[10px] font-medium cursor-pointer text-blue-600",children:["Clothing (",Object.keys(s.avatars.clothing).length," avatars)"]}),e.jsx("div",{className:"mt-1 p-2 rounded text-[9px] border bg-gray-100 border-gray-200 space-y-1",children:Object.entries(s.avatars.clothing).map(([t,i])=>e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:[t,":"]})," ",i]},t))})]}),(g||m)&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsx("summary",{className:"text-[10px] font-medium cursor-pointer text-purple-600",children:"Avatar Gen Input"}),e.jsx("div",{className:"mt-1 p-2 rounded text-[9px] border bg-purple-50 border-purple-200 space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold block mb-1",children:"Source Photo:"}),(Ns=s.photos)!=null&&Ns.face||(ws=s.photos)!=null&&ws.original?e.jsx("img",{draggable:!1,src:((ks=s.photos)==null?void 0:ks.face)||((Cs=s.photos)==null?void 0:Cs.original),alt:"Source",className:"w-16 h-16 object-cover rounded border"}):e.jsx("span",{className:"text-red-500",children:"No photo"}),e.jsx("span",{className:"block text-[8px] text-gray-500 mt-0.5",children:(Ss=s.photos)!=null&&Ss.face?"face crop":(Fs=s.photos)!=null&&Fs.original?"original":"none"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-semibold block mb-1",children:"User Trait Edits (sent to API):"}),(()=>{const t=s.physicalTraitsSource||{},i=Object.entries(t).filter(([h,f])=>f==="user").map(([h])=>h);return i.length===0?e.jsx("span",{className:"text-gray-400",children:"None (using extracted)"}):e.jsx("ul",{className:"space-y-0.5",children:i.map(h=>{var f;return e.jsxs("li",{className:"text-purple-700",children:[e.jsxs("span",{className:"font-medium",children:[h,":"]})," ",((f=s.physical)==null?void 0:f[h])||"?"]},h)})})})()]})]})})]})]})]})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-4",children:[e.jsx(te,{label:v.strengths,traits:De,selectedTraits:((Bs=s.traits)==null?void 0:Bs.strengths)||[],onSelect:t=>Z("strengths",t),minRequired:3}),e.jsx(te,{label:l==="de"?"Schwächen":l==="fr"?"Défauts":"Flaws",traits:Ae,selectedTraits:((Ds=s.traits)==null?void 0:Ds.flaws)||[],onSelect:t=>Z("flaws",t),minRequired:2}),e.jsx(te,{label:l==="de"?"Konflikte / Herausforderungen":l==="fr"?"Conflits / Défis":"Conflicts / Challenges",traits:ze,selectedTraits:((As=s.traits)==null?void 0:As.challenges)||[],onSelect:t=>Z("challenges",t)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold mb-2 text-gray-800",children:v.specialDetails}),e.jsx("textarea",{value:((zs=s.traits)==null?void 0:zs.specialDetails)||"",onChange:t=>Z("specialDetails",t.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none",placeholder:v.specialDetailsPlaceholder,rows:3})]}),n.length>1&&L&&E&&e.jsx(Bt,{character:s,allCharacters:n,relationships:U,relationshipTexts:W,onRelationshipChange:L,onRelationshipTextChange:E,customRelationships:V,onAddCustomRelationship:_})]})]}),(g||m)&&((Ps=s.photos)==null?void 0:Ps.bodyNoBg)&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-300 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-yellow-700 mb-2",children:["Body Crop (No Background) ",e.jsx("span",{className:"text-yellow-500 font-normal",children:"(click to download)"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{draggable:!1,src:s.photos.bodyNoBg,alt:`${s.name} body crop`,className:"max-h-48 object-contain rounded border border-gray-300 cursor-pointer hover:opacity-80 transition-opacity",style:{background:"repeating-conic-gradient(#ccc 0% 25%, #fff 0% 50%) 50% / 20px 20px"},onClick:()=>{const t=document.createElement("a");t.href=s.photos.bodyNoBg,t.download=`${s.name.replace(/\s+/g,"_")}_body_no_bg.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t)},title:"Click to download"})})]}),(g||m)&&(M==null?void 0:M.rawResponse)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"text-xs font-semibold text-purple-700 cursor-pointer",children:["Raw Gemini Response (Photo Analysis)",M.error&&e.jsxs("span",{className:"text-red-500 ml-2",children:["⚠️ ",M.error]})]}),e.jsx("pre",{className:"mt-2 p-2 bg-white rounded text-[10px] whitespace-pre-wrap overflow-auto max-h-64 border border-purple-200 font-mono",children:M.rawResponse})]}),(g||m)&&e.jsxs("div",{className:"bg-teal-50 border border-teal-300 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-teal-700 mb-3 flex items-center gap-2",children:[l==="de"?"Kleidungs-Avatare":l==="fr"?"Avatars vestimentaires":"Clothing Avatars",(($s=s.avatars)==null?void 0:$s.status)==="generating"&&e.jsxs("span",{className:"text-xs font-normal text-teal-500 flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-teal-500 border-t-transparent rounded-full animate-spin"}),l==="de"?"Generierung läuft...":"Generating..."]}),((Ms=s.avatars)==null?void 0:Ms.status)==="complete"&&!((Os=s.avatars)!=null&&Os.stale)&&e.jsx("span",{className:"text-xs font-normal text-green-600",children:l==="de"?"Fertig":l==="fr"?"Terminé":"Complete"}),((Ls=s.avatars)==null?void 0:Ls.stale)&&e.jsxs("span",{className:"text-xs font-normal text-amber-600",children:["⚠️ ",l==="de"?"Von altem Foto":l==="fr"?"De l'ancienne photo":"From previous photo"]}),((Es=s.avatars)==null?void 0:Es.status)==="failed"&&e.jsx("span",{className:"text-xs font-normal text-red-600",children:l==="de"?"Fehlgeschlagen":l==="fr"?"Échoué":"Failed"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:["winter","standard","summer"].map(t=>{var i,h,f,F,q,G,Q,O,J,mt,ut,bt,gt,pt,ht,ft,vt,jt;return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-600 mb-1 capitalize",children:[t==="winter"?"❄️":t==="summer"?"☀️":"👕",e.jsx("span",{className:"ml-0.5",children:l==="de"?t==="winter"?"Winter":t==="summer"?"Sommer":"Standard":t})]}),(i=s.avatars)!=null&&i[t]?e.jsxs("div",{className:"relative cursor-pointer group",onClick:()=>{var yt;return I(((yt=s.avatars)==null?void 0:yt[t])||null)},title:l==="de"?"Klicken zum Vergrössern":"Click to enlarge",children:[e.jsx("img",{draggable:!1,src:(h=s.avatars)==null?void 0:h[t],alt:`${s.name} - ${t}`,className:`w-full h-40 object-contain rounded border bg-white transition-all group-hover:shadow-lg group-hover:scale-[1.02] ${(f=s.avatars)!=null&&f.stale?"border-amber-400 opacity-75":"border-teal-200"}`}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-all rounded flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 group-hover:opacity-100 text-lg",children:"🔍"})}),((F=s.avatars)==null?void 0:F.stale)&&e.jsx("div",{className:"absolute top-1 right-1 bg-amber-500 text-white text-[8px] px-1 py-0.5 rounded",children:l==="de"?"Alt":"Old"}),(g||m)&&((G=(q=s.avatars)==null?void 0:q.faceMatch)==null?void 0:G[t])&&e.jsxs("div",{className:`absolute bottom-1 left-1 text-white text-[8px] px-1 py-0.5 rounded font-medium ${s.avatars.faceMatch[t].score>=6?"bg-green-600":"bg-red-600"}`,children:[s.avatars.faceMatch[t].score,"/10"]})]}):e.jsx("div",{className:"w-full h-40 rounded border border-dashed border-teal-300 bg-teal-100/50 flex items-center justify-center text-teal-400 text-[10px]",children:((Q=s.avatars)==null?void 0:Q.status)==="generating"?"...":"—"}),(g||m)&&((J=(O=s.avatars)==null?void 0:O.clothing)==null?void 0:J[t])&&e.jsxs("div",{className:"mt-1 p-1.5 rounded text-[10px] text-left bg-blue-50 border border-blue-200 text-blue-700",children:[e.jsx("span",{className:"font-semibold",children:"👕 "}),s.avatars.clothing[t]]}),(g||m)&&((mt=s.avatars)==null?void 0:mt[t])&&!((bt=(ut=s.avatars)==null?void 0:ut.clothing)!=null&&bt[t])&&e.jsx("div",{className:"mt-1 p-1.5 rounded text-[10px] text-left bg-amber-50 border border-amber-200 text-amber-600",children:"⚠️ No clothing data - regenerate avatar"}),(g||m)&&e.jsxs(e.Fragment,{children:[((pt=(gt=s.avatars)==null?void 0:gt.prompts)==null?void 0:pt[t])&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsx("summary",{className:"text-[10px] text-gray-400 cursor-pointer hover:text-gray-600",children:"Show prompt"}),e.jsx("pre",{className:"mt-1 p-2 rounded text-[9px] whitespace-pre-wrap overflow-auto max-h-48 border bg-gray-100 border-gray-200",children:s.avatars.prompts[t]})]}),((ft=(ht=s.avatars)==null?void 0:ht.faceMatch)==null?void 0:ft[t])&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsxs("summary",{className:"text-[10px] text-gray-400 cursor-pointer hover:text-gray-600",children:["Face eval (",s.avatars.faceMatch[t].score,"/10)",s.avatars.faceMatch[t].lpips&&e.jsxs("span",{className:`ml-1 ${s.avatars.faceMatch[t].lpips.lpipsScore<.15?"text-green-600":s.avatars.faceMatch[t].lpips.lpipsScore<.3?"text-yellow-600":"text-red-600"}`,children:["LPIPS: ",(vt=s.avatars.faceMatch[t].lpips.lpipsScore)==null?void 0:vt.toFixed(3)]}),s.avatars.faceMatch[t].arcface&&e.jsxs("span",{className:`ml-1 ${s.avatars.faceMatch[t].arcface.samePerson?"text-green-600":"text-red-600"}`,children:["ID: ",((s.avatars.faceMatch[t].arcface.similarity??0)*100).toFixed(0),"%"]})]}),e.jsxs("pre",{className:"mt-1 p-2 rounded text-[9px] whitespace-pre-wrap overflow-auto max-h-48 border bg-gray-100 border-gray-200",children:[s.avatars.faceMatch[t].details,s.avatars.faceMatch[t].lpips&&`

LPIPS: ${(jt=s.avatars.faceMatch[t].lpips.lpipsScore)==null?void 0:jt.toFixed(4)} (${s.avatars.faceMatch[t].lpips.interpretation})`,s.avatars.faceMatch[t].arcface&&`

ArcFace ID: ${((s.avatars.faceMatch[t].arcface.similarity??0)*100).toFixed(1)}% (${s.avatars.faceMatch[t].arcface.confidence}, same_person: ${s.avatars.faceMatch[t].arcface.samePerson})`]})]})]})]},t)})}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[((Hs=s.avatars)==null?void 0:Hs.generatedAt)&&e.jsxs("div",{className:"text-xs text-teal-500",children:["Generated: ",new Date(s.avatars.generatedAt).toLocaleString()]}),(g||m)&&((Gs=s.avatars)==null?void 0:Gs.crossLpips)&&e.jsxs("div",{className:"text-[10px] text-gray-500 bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("div",{className:"font-medium mb-1",children:"Cross-Avatar LPIPS:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(s.avatars.crossLpips).map(([t,i])=>{const[h,f]=t.split("_vs_"),F=i<.3?"text-green-600":i<.5?"text-yellow-600":"text-red-600";return e.jsxs("span",{className:F,children:[h," ↔ ",f,": ",i.toFixed(2)]},t)})})]}),(g||m)&&((Ks=s.avatars)==null?void 0:Ks.crossArcface)&&e.jsxs("div",{className:"text-[10px] text-gray-500 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsx("div",{className:"font-medium mb-1",children:"Cross-Avatar ArcFace ID:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(s.avatars.crossArcface).map(([t,i])=>{const[h,f]=t.split("_vs_"),F=i.samePerson?"text-green-600":"text-red-600";return e.jsxs("span",{className:F,children:[h," ↔ ",f,": ",((i.similarity??0)*100).toFixed(0),"% (",i.confidence,")"]},t)})})]}),(g||m)&&e.jsxs("div",{className:"text-[10px] text-gray-500 bg-orange-50 border border-orange-200 rounded p-2",children:[e.jsx("div",{className:"font-medium mb-1",children:"Input Photo for Generation:"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("img",{draggable:!1,src:((Is=s.photos)==null?void 0:Is.bodyNoBg)||((Us=s.photos)==null?void 0:Us.body)||((Vs=s.photos)==null?void 0:Vs.face)||((_s=s.photos)==null?void 0:_s.original),alt:"Generation input",className:"w-16 h-20 object-contain rounded border border-orange-300",style:{background:"repeating-conic-gradient(#ccc 0% 25%, #fff 0% 50%) 50% / 10px 10px"}}),e.jsxs("div",{children:[e.jsxs("div",{className:(qs=s.photos)!=null&&qs.bodyNoBg?"text-green-600 font-bold":"text-gray-400",children:["bodyNoBg: ",(Js=s.photos)!=null&&Js.bodyNoBg?`✅ ${Math.round(s.photos.bodyNoBg.length/1024)}KB`:"❌"]}),e.jsxs("div",{className:!((Ws=s.photos)!=null&&Ws.bodyNoBg)&&((Rs=s.photos)!=null&&Rs.body)?"text-yellow-600 font-bold":"text-gray-400",children:["body: ",(Ys=s.photos)!=null&&Ys.body?`${Math.round(s.photos.body.length/1024)}KB`:"❌"]}),e.jsxs("div",{className:!((Zs=s.photos)!=null&&Zs.bodyNoBg)&&!((Qs=s.photos)!=null&&Qs.body)&&((Xs=s.photos)!=null&&Xs.face)?"text-yellow-600 font-bold":"text-gray-400",children:["face: ",(Ts=s.photos)!=null&&Ts.face?`${Math.round(s.photos.face.length/1024)}KB`:"❌"]}),e.jsxs("div",{className:"mt-1 text-orange-700 font-bold",children:["Using: ",(el=s.photos)!=null&&el.bodyNoBg?"bodyNoBg ✅":(sl=s.photos)!=null&&sl.body?"body ⚠️":(ll=s.photos)!=null&&ll.face?"face ⚠️":"original ❌"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[k&&e.jsx("button",{onClick:k,disabled:j||a||((tl=s.avatars)==null?void 0:tl.status)==="generating",className:"px-3 py-1.5 text-xs font-medium bg-teal-600 text-white rounded hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",title:l==="de"?"Generiert Avatare mit allen physischen Merkmalen (Brille, Haarfarbe, etc.)":"Generates avatars with all physical traits (glasses, hair color, etc.)",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),l==="de"?"Generiere...":"Generating..."]}):e.jsx(e.Fragment,{children:l==="de"?"Neu generieren":l==="fr"?"Régénérer":"Regenerate"})}),D&&e.jsx("button",{onClick:D,disabled:j||a||((al=s.avatars)==null?void 0:al.status)==="generating",className:"px-3 py-1.5 text-xs font-medium bg-gray-500 text-white rounded hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",title:l==="de"?"Alte Methode ohne physische Merkmale":"Old method without physical traits",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),l==="de"?"Generiere...":"Generating..."]}):e.jsx(e.Fragment,{children:l==="de"?"Ohne Merkmale (alt)":l==="fr"?"Sans traits (ancien)":"Without Traits (old)"})})]})]})]}),(g||m)&&((rl=s.avatars)==null?void 0:rl.costumed)&&Object.keys(s.avatars.costumed).length>0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-300 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-orange-700 mb-3 flex items-center gap-2",children:["🎭 ",l==="de"?"Kostümierte Avatare":l==="fr"?"Avatars costumés":"Costumed Avatars",e.jsxs("span",{className:"text-xs font-normal text-orange-500",children:["(",Object.keys(s.avatars.costumed).length," ",l==="de"?"Kostüme":"costumes",")"]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:Object.entries(s.avatars.costumed).map(([t,i])=>{const h=typeof i=="string"?i:i==null?void 0:i.imageData,f=typeof i=="object"?i==null?void 0:i.clothing:void 0;return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs font-medium text-orange-600 mb-1 truncate",title:t,children:["🎭 ",t]}),h?e.jsxs("div",{className:"relative cursor-pointer group",onClick:()=>I(h),title:l==="de"?"Klicken zum Vergrössern":"Click to enlarge",children:[e.jsx("img",{draggable:!1,src:h,alt:`${s.name} - ${t}`,className:"w-full h-40 object-contain rounded border border-orange-200 bg-white transition-all group-hover:shadow-lg group-hover:scale-[1.02]"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-all rounded flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 group-hover:opacity-100 text-lg",children:"🔍"})})]}):e.jsx("div",{className:"w-full h-40 rounded border border-dashed border-orange-300 bg-orange-100/50 flex items-center justify-center text-orange-400 text-[10px]",children:"—"}),f&&e.jsxs("div",{className:"mt-1 p-1.5 rounded text-[10px] text-left bg-orange-100 border border-orange-200 text-orange-700",children:[e.jsx("span",{className:"font-semibold",children:"👕 "}),f]})]},t)})})]}),(g||m)&&((nl=s.avatars)==null?void 0:nl.styledAvatars)&&Object.keys(s.avatars.styledAvatars).length>0&&e.jsxs("div",{className:"bg-purple-50 border border-purple-300 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-purple-700 mb-3 flex items-center gap-2",children:["🎨 ",l==="de"?"Stilisierte Avatare":l==="fr"?"Avatars stylisés":"Styled Avatars",e.jsxs("span",{className:"text-xs font-normal text-purple-500",children:["(",Object.keys(s.avatars.styledAvatars).length," ",l==="de"?"Stile":"styles",")"]})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(s.avatars.styledAvatars).map(([t,i])=>{const f={pixar:{en:"Pixar 3D",de:"Pixar 3D",emoji:"🎬"},watercolor:{en:"Watercolor",de:"Aquarell",emoji:"🎨"},"comic-book":{en:"Comic Book",de:"Comic",emoji:"💥"},anime:{en:"Anime",de:"Anime",emoji:"🌸"},"oil-painting":{en:"Oil Painting",de:"Ölmalerei",emoji:"🖼️"},"colored-pencil":{en:"Colored Pencil",de:"Buntstift",emoji:"✏️"},storybook:{en:"Storybook",de:"Bilderbuch",emoji:"📖"}}[t]||{en:t,de:t,emoji:"🎭"},F=["standard","winter","summer","formal"],q={standard:"👕",winter:"❄️",summer:"☀️",formal:"👔"},G=i.costumed,Q=G?Object.keys(G):[];return e.jsxs("div",{className:"border border-purple-200 rounded-lg p-3 bg-white",children:[e.jsxs("h5",{className:"text-xs font-semibold text-purple-600 mb-2",children:[f.emoji," ",l==="de"?f.de:f.en]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:F.map(O=>{const J=i[O];return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-[10px] text-gray-500 mb-1",children:[q[O]," ",O]}),J?e.jsx("img",{draggable:!1,src:J,alt:`${s.name} - ${t} - ${O}`,className:"w-full h-32 object-contain rounded border border-purple-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>I(J),title:"Click to enlarge"}):e.jsx("div",{className:"w-full h-32 rounded border border-dashed border-purple-200 bg-purple-50/50 flex items-center justify-center text-purple-300 text-[10px]",children:"—"})]},O)})}),Q.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-purple-200",children:[e.jsxs("div",{className:"text-[10px] font-medium text-orange-600 mb-2",children:["🎭 ",l==="de"?"Kostümierte Avatare":"Costumed Avatars"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:Q.map(O=>{const J=G[O];return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-[10px] text-orange-500 mb-1 truncate",title:O,children:["🎭 ",O]}),J?e.jsx("img",{draggable:!1,src:J,alt:`${s.name} - ${t} - ${O}`,className:"w-full h-32 object-contain rounded border border-orange-200 bg-orange-50/50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>I(J),title:"Click to enlarge"}):e.jsx("div",{className:"w-full h-32 rounded border border-dashed border-orange-200 bg-orange-50/50 flex items-center justify-center text-orange-300 text-[10px]",children:"—"})]},O)})})]})]},t)})})]}),(g||m)&&((il=s.avatars)==null?void 0:il.rawEvaluation)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-4",children:[e.jsxs("summary",{className:"text-sm font-semibold text-purple-700 cursor-pointer flex items-center gap-2",children:[e.jsx("span",{children:"📊 Full API Response (Avatar Evaluation)"}),e.jsx("span",{className:"text-xs font-normal text-purple-500",children:"Click to expand"})]}),e.jsx("pre",{className:"mt-3 p-4 bg-white rounded-lg text-xs whitespace-pre-wrap overflow-auto max-h-[600px] border border-purple-200 font-mono leading-relaxed",children:JSON.stringify(s.avatars.rawEvaluation,null,2)})]}),e.jsxs("div",{className:"flex gap-3 max-w-md",children:[r&&e.jsx("button",{onClick:r,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:v.cancel}),e.jsx(ae,{onClick:()=>{var h,f,F,q,G;const t=!!((h=s.avatars)!=null&&h.winter||(f=s.avatars)!=null&&f.standard||(F=s.avatars)!=null&&F.summer||(q=s.avatars)!=null&&q.formal),i=((G=s.avatars)==null?void 0:G.status)==="generating";!t&&!i&&w?w():p()},disabled:!ge||b||a,loading:b||a,icon:pe,className:r?"flex-1":"w-full",children:v.saveCharacter})]}),!ge&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:v.selectStrengthsFlaws}),(g||m)&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 text-yellow-700 text-xs rounded",children:"DEV"}),"Character Data (Database View)"]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-3",children:"Physical Traits"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Eye Color:"}),e.jsxs("div",{className:"font-medium flex items-center gap-1",children:[((ol=s.physical)==null?void 0:ol.eyeColor)||"—",((dl=s.physical)==null?void 0:dl.eyeColorHex)&&e.jsx("span",{className:"inline-block w-4 h-4 rounded border border-gray-300",style:{backgroundColor:s.physical.eyeColorHex},title:s.physical.eyeColorHex})]}),((cl=s.physicalTraitsSource)==null?void 0:cl.eyeColor)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",s.physicalTraitsSource.eyeColor,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Hair Color:"}),e.jsxs("div",{className:"font-medium flex items-center gap-1",children:[((xl=s.physical)==null?void 0:xl.hairColor)||"—",((ml=s.physical)==null?void 0:ml.hairColorHex)&&e.jsx("span",{className:"inline-block w-4 h-4 rounded border border-gray-300",style:{backgroundColor:s.physical.hairColorHex},title:s.physical.hairColorHex})]}),((ul=s.physicalTraitsSource)==null?void 0:ul.hairColor)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",s.physicalTraitsSource.hairColor,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Hair Length:"}),e.jsx("div",{className:"font-medium",children:((bl=s.physical)==null?void 0:bl.hairLength)||"—"}),((gl=s.physicalTraitsSource)==null?void 0:gl.hairLength)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",s.physicalTraitsSource.hairLength,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Hair Style:"}),e.jsx("div",{className:"font-medium",children:((pl=s.physical)==null?void 0:pl.hairStyle)||"—"}),((hl=s.physicalTraitsSource)==null?void 0:hl.hairStyle)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",s.physicalTraitsSource.hairStyle,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Build:"}),e.jsx("div",{className:"font-medium",children:((fl=s.physical)==null?void 0:fl.build)||"—"}),((vl=s.physicalTraitsSource)==null?void 0:vl.build)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",s.physicalTraitsSource.build,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Facial Hair:"}),e.jsx("div",{className:"font-medium",children:((jl=s.physical)==null?void 0:jl.facialHair)||"—"}),((yl=s.physicalTraitsSource)==null?void 0:yl.facialHair)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",s.physicalTraitsSource.facialHair,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Skin Tone:"}),e.jsx("div",{className:"font-medium",children:((Nl=s.physical)==null?void 0:Nl.skinTone)||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Other:"}),e.jsx("div",{className:"font-medium",children:((wl=s.physical)==null?void 0:wl.other)||"—"}),((kl=s.physicalTraitsSource)==null?void 0:kl.other)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",s.physicalTraitsSource.other,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Height:"}),e.jsx("div",{className:"font-medium",children:((Cl=s.physical)==null?void 0:Cl.height)||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Apparent Age:"}),e.jsx("div",{className:"font-medium",children:((Sl=s.physical)==null?void 0:Sl.apparentAge)||"—"})]})]}),((Fl=s.physical)==null?void 0:Fl.detailedHairAnalysis)&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-200",children:[e.jsx("span",{className:"text-gray-500 text-xs block mb-1",children:"Detailed Hair Analysis:"}),e.jsx("p",{className:"text-sm bg-white border border-gray-200 rounded p-2 italic text-gray-700",children:typeof s.physical.detailedHairAnalysis=="object"?JSON.stringify(s.physical.detailedHairAnalysis,null,2):s.physical.detailedHairAnalysis})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-3",children:"Clothing"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Upper Body:"}),e.jsx("div",{className:"font-medium",children:((Dl=(Bl=s.clothing)==null?void 0:Bl.structured)==null?void 0:Dl.upperBody)||"—"}),((Al=s.clothingSource)==null?void 0:Al.upperBody)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",s.clothingSource.upperBody,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Lower Body:"}),e.jsx("div",{className:"font-medium",children:((Pl=(zl=s.clothing)==null?void 0:zl.structured)==null?void 0:Pl.lowerBody)||"—"}),(($l=s.clothingSource)==null?void 0:$l.lowerBody)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",s.clothingSource.lowerBody,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Shoes:"}),e.jsx("div",{className:"font-medium",children:((Ol=(Ml=s.clothing)==null?void 0:Ml.structured)==null?void 0:Ol.shoes)||"—"}),((Ll=s.clothingSource)==null?void 0:Ll.shoes)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",s.clothingSource.shoes,"]"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"Full Body:"}),e.jsx("div",{className:"font-medium",children:((Hl=(El=s.clothing)==null?void 0:El.structured)==null?void 0:Hl.fullBody)||"—"}),((Gl=s.clothingSource)==null?void 0:Gl.fullBody)&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["[",s.clothingSource.fullBody,"]"]})]})]}),((Kl=s.clothing)==null?void 0:Kl.current)&&e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-gray-500 text-xs block mb-1",children:"Legacy (current):"}),e.jsx("div",{className:"text-sm font-medium",children:s.clothing.current})]}),((Il=s.avatars)==null?void 0:Il.clothing)&&Object.keys(s.avatars.clothing).length>0&&e.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[e.jsx("span",{className:"text-gray-500 text-xs block mb-2",children:"Avatar Extracted Clothing:"}),e.jsx("div",{className:"space-y-1 text-sm",children:Object.entries(s.avatars.clothing).map(([t,i])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-gray-500 capitalize w-20",children:[t,":"]}),e.jsx("span",{className:"text-gray-700",children:i})]},t))})]})]})]}),e.jsx(kt,{src:R,onClose:()=>I(null)}),Y&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-white flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-gray-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:l==="de"?"Aussehen anpassen":l==="fr"?"Modifier l'apparence":"Modify Look"}),e.jsx("button",{onClick:()=>X(!1),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-full transition-colors",children:e.jsx(_t,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"flex-shrink-0 flex justify-center md:justify-start",children:(Vl=(Ul=s.avatars)==null?void 0:Ul.faceThumbnails)!=null&&Vl.standard||(_l=s.avatars)!=null&&_l.standard?e.jsx("img",{draggable:!1,src:((Jl=(ql=s.avatars)==null?void 0:ql.faceThumbnails)==null?void 0:Jl.standard)||((Wl=s.avatars)==null?void 0:Wl.standard),alt:`${s.name} avatar`,className:"w-48 h-64 object-contain rounded-lg border-2 border-indigo-300 bg-white shadow-lg"}):e.jsx("div",{className:"w-48 h-64 rounded-lg border-2 border-dashed border-gray-300 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400 text-sm",children:l==="de"?"Kein Bild":"No image"})})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:l==="de"?"Physische Merkmale":l==="fr"?"Caractéristiques physiques":"Physical Features"}),e.jsx(pa,{character:s,language:l,updatePhysical:be,updateApparentAge:t=>be("apparentAge",t)})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:l==="de"?"Kleidung":l==="fr"?"Vêtements":"Clothing"}),e.jsxs("div",{className:"space-y-3",children:[s.gender==="female"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:l==="de"?"Kleid / Overall":l==="fr"?"Robe / Combinaison":"Dress / Jumpsuit"}),e.jsx("input",{type:"text",value:((Yl=(Rl=s.clothing)==null?void 0:Rl.structured)==null?void 0:Yl.fullBody)||"",onChange:t=>{var i;return d({...s,clothing:{...s.clothing,structured:{...(i=s.clothing)==null?void 0:i.structured,fullBody:t.target.value,...t.target.value?{upperBody:"",lowerBody:""}:{}}},clothingSource:{...s.clothingSource,fullBody:"user",...t.target.value?{upperBody:void 0,lowerBody:void 0}:{}}})},placeholder:l==="de"?"z.B. rotes Sommerkleid":l==="fr"?"ex. robe d'été rouge":"e.g. red summer dress",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none"})]}),e.jsxs("div",{className:(Ql=(Zl=s.clothing)==null?void 0:Zl.structured)!=null&&Ql.fullBody?"opacity-50":"",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:l==="de"?"Oberteil":l==="fr"?"Haut":"Upper Body"}),e.jsx("input",{type:"text",value:((Tl=(Xl=s.clothing)==null?void 0:Xl.structured)==null?void 0:Tl.upperBody)||"",onChange:t=>{var i;return d({...s,clothing:{...s.clothing,structured:{...(i=s.clothing)==null?void 0:i.structured,upperBody:t.target.value}},clothingSource:{...s.clothingSource,upperBody:"user"}})},disabled:!!((st=(et=s.clothing)==null?void 0:et.structured)!=null&&st.fullBody),placeholder:l==="de"?"z.B. blaues T-Shirt":l==="fr"?"ex. t-shirt bleu":"e.g. blue t-shirt",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{className:(tt=(lt=s.clothing)==null?void 0:lt.structured)!=null&&tt.fullBody?"opacity-50":"",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:l==="de"?"Unterteil":l==="fr"?"Bas":"Lower Body"}),e.jsx("input",{type:"text",value:((rt=(at=s.clothing)==null?void 0:at.structured)==null?void 0:rt.lowerBody)||"",onChange:t=>{var i;return d({...s,clothing:{...s.clothing,structured:{...(i=s.clothing)==null?void 0:i.structured,lowerBody:t.target.value}},clothingSource:{...s.clothingSource,lowerBody:"user"}})},disabled:!!((it=(nt=s.clothing)==null?void 0:nt.structured)!=null&&it.fullBody),placeholder:l==="de"?"z.B. dunkle Jeans":l==="fr"?"ex. jeans foncé":"e.g. dark jeans",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:l==="de"?"Schuhe":l==="fr"?"Chaussures":"Shoes"}),e.jsx("input",{type:"text",value:((dt=(ot=s.clothing)==null?void 0:ot.structured)==null?void 0:dt.shoes)||"",onChange:t=>{var i;return d({...s,clothing:{...s.clothing,structured:{...(i=s.clothing)==null?void 0:i.structured,shoes:t.target.value}},clothingSource:{...s.clothingSource,shoes:"user"}})},placeholder:l==="de"?"z.B. weiße Turnschuhe":l==="fr"?"ex. baskets blanches":"e.g. white sneakers",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none"})]})]})]})]})]})})}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex gap-3",children:[e.jsx("button",{onClick:()=>X(!1),className:"flex-1 px-4 py-3 text-sm font-medium bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:l==="de"?"Abbrechen":l==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:()=>{X(!1),Fe(),S&&w?w():k&&k()},disabled:a||((ct=s.avatars)==null?void 0:ct.status)==="generating"||!g&&!m&&!T,className:"flex-1 px-4 py-3 text-sm font-medium bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-colors",title:!g&&!m&&!T?l==="de"?`Warten Sie ${se}s`:`Wait ${se}s`:void 0,children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),l==="de"?"Generiere...":"Generating..."]}):!g&&!m&&!T?e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:16}),l==="de"?`Warten (${se}s)`:`Wait (${se}s)`]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:16}),l==="de"?"Speichern & Neu generieren":l==="fr"?"Enregistrer et régénérer":"Save & Regenerate"]})})]})})]}),he&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:l==="de"?"Kleidung für neues Foto":l==="fr"?"Vêtements pour la nouvelle photo":"Clothing for New Photo"}),e.jsx("p",{className:"text-gray-600 mb-6",children:l==="de"?"Möchten Sie die aktuelle Kleidung beibehalten oder die Kleidung aus dem neuen Foto verwenden?":l==="fr"?"Voulez-vous garder les vêtements actuels ou utiliser ceux de la nouvelle photo?":"Do you want to keep the current clothing or use the clothing from the new photo?"}),((xt=s.clothing)==null?void 0:xt.structured)&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-4 text-sm",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:l==="de"?"Aktuelle Kleidung:":l==="fr"?"Vêtements actuels:":"Current clothing:"}),e.jsxs("div",{className:"text-gray-600 space-y-0.5",children:[s.clothing.structured.upperBody&&e.jsxs("div",{children:[l==="de"?"Oberteil":"Top",": ",s.clothing.structured.upperBody]}),s.clothing.structured.lowerBody&&e.jsxs("div",{children:[l==="de"?"Unterteil":"Bottom",": ",s.clothing.structured.lowerBody]}),s.clothing.structured.shoes&&e.jsxs("div",{children:[l==="de"?"Schuhe":"Shoes",": ",s.clothing.structured.shoes]}),s.clothing.structured.fullBody&&e.jsxs("div",{children:[l==="de"?"Ganzkörper":"Full outfit",": ",s.clothing.structured.fullBody]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>Se(!1),className:"w-full px-4 py-3 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2",children:[l==="de"?"Kleidung aus neuem Foto verwenden":l==="fr"?"Utiliser les vêtements de la nouvelle photo":"Use clothing from new photo",e.jsx("span",{className:"text-xs bg-indigo-500 px-2 py-0.5 rounded",children:l==="de"?"Empfohlen":l==="fr"?"Recommandé":"Default"})]}),e.jsx("button",{onClick:()=>Se(!0),className:"w-full px-4 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors",children:l==="de"?"Aktuelle Kleidung beibehalten":l==="fr"?"Garder les vêtements actuels":"Keep current clothing"}),e.jsx("button",{onClick:()=>{fe(!1),ve(null)},className:"w-full px-4 py-2 text-gray-500 hover:text-gray-700 text-sm transition-colors",children:l==="de"?"Abbrechen":l==="fr"?"Annuler":"Cancel"})]})]})}),ie&&ie.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:l==="de"?"Wähle deinen Avatar":"Choose Your Avatar"}),e.jsx("p",{className:"text-gray-600 mb-4 text-sm",children:l==="de"?"Klicke auf das Bild, das dir am besten gefällt":"Click on the image you like best"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4 mb-6",children:ie.map(t=>e.jsxs("div",{onClick:()=>de(t.id),className:`cursor-pointer rounded-xl overflow-hidden border-4 transition-all ${oe===t.id?"border-indigo-500 shadow-lg scale-[1.02]":"border-transparent hover:border-gray-300"}`,children:[e.jsx("img",{draggable:!1,src:t.imageData,alt:`Option ${t.id+1}`,className:"w-full aspect-[9/16] object-cover"}),e.jsxs("div",{className:`text-center py-2 text-sm font-medium ${oe===t.id?"bg-indigo-500 text-white":"bg-gray-100 text-gray-700"}`,children:["Option ",t.id+1]})]},t.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Ut,disabled:oe===null,className:"flex-1 px-4 py-3 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:l==="de"?"Auswahl verwenden":"Use Selected"}),e.jsx("button",{onClick:()=>{ue(null),de(null)},className:"px-4 py-3 text-gray-600 hover:text-gray-800 transition-colors",children:l==="de"?"Abbrechen":"Cancel"})]})]})})]})}const $t={en:{consent1:"I confirm I have the right to use the uploaded photos and, for photos of minors, I am the parent/guardian or have obtained their consent.",consent2:"I agree to the",termsLink:"Terms of Service",and:"and",privacyLink:"Privacy Policy",period:", including the processing of these photos by AI to create illustrated avatars.",pleaseAccept:"Please accept the terms above to upload a photo"},de:{consent1:"Ich bestätige, dass ich das Recht habe, die hochgeladenen Fotos zu verwenden, und bei Fotos von Minderjährigen bin ich der Elternteil/Vormund oder habe deren Zustimmung eingeholt.",consent2:"Ich stimme den",termsLink:"Nutzungsbedingungen",and:"und der",privacyLink:"Datenschutzrichtlinie",period:" zu, einschliesslich der Verarbeitung dieser Fotos durch KI zur Erstellung illustrierter Avatare.",pleaseAccept:"Bitte akzeptieren Sie die obigen Bedingungen, um ein Foto hochzuladen"},fr:{consent1:"Je confirme que j'ai le droit d'utiliser les photos téléchargées et, pour les photos de mineurs, je suis le parent/tuteur ou j'ai obtenu leur consentement.",consent2:"J'accepte les",termsLink:"Conditions d'Utilisation",and:"et la",privacyLink:"Politique de Confidentialité",period:", y compris le traitement de ces photos par l'IA pour créer des avatars illustrés.",pleaseAccept:"Veuillez accepter les conditions ci-dessus pour télécharger une photo"}};function ha({onPhotoSelect:s,showExamples:n=!0}){const{t:d,language:p}=re(),{user:r,recordPhotoConsent:B}=qt(),[y,N]=z.useState(!1),[c,o]=z.useState(!1),[C,S]=z.useState(!1),P=z.useRef(null),w=$t[p]||$t.en,D=!!(r!=null&&r.photoConsentAt);console.log("[PhotoUpload] Mounted/Updated:",{user:r==null?void 0:r.email,photoConsentAt:r==null?void 0:r.photoConsentAt,hasExistingConsent:D});const k=D||y&&c,b=()=>{k&&!C&&P.current&&P.current.click()},x=async j=>{var u;const a=(u=j.target.files)==null?void 0:u[0];if(console.log("[PhotoUpload] handleFileChange:",{file:a==null?void 0:a.name,canUpload:k,hasExistingConsent:D,consent1Checked:y,consent2Checked:c}),a&&k){if(!D&&y&&c){S(!0);try{await B()}catch(g){console.error("Failed to record consent:",g)}finally{S(!1)}}console.log("[PhotoUpload] Calling onPhotoSelect with file:",a.name),s(a)}else console.log("[PhotoUpload] NOT calling onPhotoSelect - file:",!!a,"canUpload:",k)},A=p==="de"?"Deine Geschichte wird basierend auf den hochgeladenen Fotos erstellt. Verwende Fotos mit nur einer Person, idealerweise Ganzkörperaufnahmen, da auch die Kleidung in die Geschichte übernommen wird.":p==="fr"?"Votre histoire sera générée à partir des photos téléchargées. Utilisez des photos d'une seule personne, idéalement en pied, car les vêtements seront également intégrés dans l'histoire.":"Your story will be generated based on the photos you upload. Use photos of a single person, ideally full body shots, as clothing will also be copied into the story.";return e.jsxs("div",{className:"bg-indigo-50 border-2 border-indigo-300 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-4 text-center",children:A}),!D&&e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 space-y-3",children:[e.jsxs("div",{onClick:()=>N(!y),className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5 text-indigo-600 hover:text-indigo-800",children:y?e.jsx(St,{size:20}):e.jsx(Ft,{size:20})}),e.jsx("span",{className:"text-sm text-gray-700 group-hover:text-gray-900",children:w.consent1})]}),e.jsxs("div",{onClick:j=>{j.target.tagName!=="A"&&o(!c)},className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5 text-indigo-600 hover:text-indigo-800",children:c?e.jsx(St,{size:20}):e.jsx(Ft,{size:20})}),e.jsxs("span",{className:"text-sm text-gray-700 group-hover:text-gray-900",children:[w.consent2," ",e.jsx(Nt,{to:"/terms",className:"text-indigo-600 hover:underline",children:w.termsLink})," ",w.and," ",e.jsx(Nt,{to:"/privacy",className:"text-indigo-600 hover:underline",children:w.privacyLink}),w.period]})]})]}),e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("input",{ref:P,type:"file",accept:"image/*",onChange:x,className:"hidden"}),e.jsxs("button",{type:"button",onClick:b,disabled:!k||C,className:`inline-flex items-center justify-center gap-3 px-10 py-4 rounded-xl text-xl font-bold shadow-lg transition-colors ${k&&!C?"cursor-pointer bg-indigo-600 text-white hover:bg-indigo-700":"cursor-not-allowed bg-gray-300 text-gray-500"}`,children:[e.jsx(xe,{size:28})," ",C?"...":d.uploadPhoto]}),!k&&!D&&e.jsx("p",{className:"text-sm text-amber-600 mt-2",children:w.pleaseAccept})]}),n&&e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{draggable:!1,src:"/images/Full body.jpg",alt:"Full body example",className:"w-full md:max-h-32 object-contain rounded border-2 border-green-400 mb-1"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:p==="de"?"Ganzkörper":p==="fr"?"Corps entier":"Full body"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{draggable:!1,src:"/images/Upper body.jpg",alt:"Upper body example",className:"w-full md:max-h-32 object-contain rounded border-2 border-green-400 mb-1"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:p==="de"?"Oberkörper":p==="fr"?"Buste":"Upper body"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{draggable:!1,src:"/images/No zoomed in close up.jpg",alt:"Too close example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:p==="de"?"Zu nah / Unscharf":p==="fr"?"Trop proche / Flou":"Too close / Blurry"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{draggable:!1,src:"/images/No sunglasses, hat or helmets.jpg",alt:"No accessories example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:p==="de"?"Brille / Hut / Helm":p==="fr"?"Lunettes / Chapeau":"Glasses / Hat / Helmet"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{draggable:!1,src:"/images/One person not many.jpg",alt:"One person only example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:p==="de"?"Nur eine Person":p==="fr"?"Une seule personne":"Only one person"})]})]})})]})}function Ia({characters:s,currentCharacter:n,characterStep:d,showCharacterCreated:p,isLoading:r,isAnalyzingPhoto:B,isGeneratingAvatar:y,isRegeneratingAvatars:N,isRegeneratingAvatarsWithTraits:c,developerMode:o,isImpersonating:C=!1,changedTraits:S,photoAnalysisDebug:P,mainCharacters:w,excludedCharacters:D,onCharacterRoleChange:k,onCharacterChange:b,onCharacterStepChange:x,onContinueToAvatar:A,onPhotoSelect:j,onSaveAndGenerateAvatar:a,onSaveCharacter:u,onEditCharacter:g,onDeleteCharacter:m,onStartNewCharacter:$,onRegenerateAvatars:M,onRegenerateAvatarsWithTraits:U,onSaveAndRegenerateWithTraits:W,onSaveAndTryNewPhoto:L,relationships:E,relationshipTexts:V,onRelationshipChange:_,onRelationshipTextChange:v,customRelationships:l,onAddCustomRelationship:ne}){const{t:K,language:R}=re();if(n){if(d==="photo")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(le,{size:24})," ",K.charactersStepTitle]}),e.jsx(ha,{onPhotoSelect:j}),e.jsx("button",{onClick:()=>b(null),className:"w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:K.cancel})]});if(d==="name")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(le,{size:24})," ",K.charactersStepTitle]}),e.jsx(Pt,{character:n,onChange:b,onSave:u,onCancel:()=>b(null),onPhotoChange:j,onContinueToTraits:()=>{var Y,X;((Y=n==null?void 0:n.avatars)==null?void 0:Y.status)==="pending"&&((X=n==null?void 0:n.photos)!=null&&X.original)?a():x("traits")},onSaveAndGenerateAvatar:a,onRegenerateAvatars:M,onRegenerateAvatarsWithTraits:U,isLoading:r,isAnalyzingPhoto:B,isGeneratingAvatar:y,isRegeneratingAvatars:N,isRegeneratingAvatarsWithTraits:c,step:"name",developerMode:o,isImpersonating:C,changedTraits:S,photoAnalysisDebug:P,isNewCharacter:!0})]});const I=!s.find(Y=>Y.id===n.id);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(le,{size:24})," ",K.charactersStepTitle]}),e.jsx(Pt,{character:n,allCharacters:s,onChange:b,onSave:u,onCancel:()=>b(null),onPhotoChange:j,onContinueToCharacteristics:()=>x("characteristics"),onContinueToRelationships:()=>x("relationships"),onContinueToAvatar:A,onRegenerateAvatars:M,onRegenerateAvatarsWithTraits:U,onSaveAndRegenerateWithTraits:W,onSaveAndTryNewPhoto:L,isLoading:r,isAnalyzingPhoto:B,isGeneratingAvatar:y,isRegeneratingAvatars:N,isRegeneratingAvatarsWithTraits:c,step:d,developerMode:o,isImpersonating:C,changedTraits:S,photoAnalysisDebug:P,relationships:E,relationshipTexts:V,onRelationshipChange:_,onRelationshipTextChange:v,customRelationships:l,onAddCustomRelationship:ne,isNewCharacter:I})]})}return s.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(le,{size:24})," ",K.charactersStepTitle]}),w.length===0&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-500 text-xl",children:"⭐"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-800 font-medium",children:R==="de"?"Wähle mindestens einen Hauptcharakter aus":R==="fr"?"Sélectionnez au moins un personnage principal":"Select at least one main character"}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:R==="de"?"Klicke auf den Stern ⭐ neben einem Charakter, um ihn zum Hauptcharakter zu machen.":R==="fr"?"Cliquez sur l'étoile ⭐ à côté d'un personnage pour en faire le personnage principal.":"Click the star ⭐ next to a character to make them the main character."})]})]}),e.jsx(na,{characters:s,showSuccessMessage:p,mainCharacters:w,excludedCharacters:D,onCharacterRoleChange:k,onEdit:g,onDelete:m,onCreateAnother:$})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(le,{size:24})," ",K.charactersStepTitle]}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-6",children:K.startCreating}),e.jsx(ae,{onClick:$,icon:aa,children:R==="de"?"Ersten Charakter erstellen":R==="fr"?"Creer le premier personnage":"Create First Character"})]})]})}export{Ia as WizardStep2Characters};
