import{c as N,f as _,T as E,C as A,I as O,j as t,X as z,u as P,a as S,d as F,L as U}from"./index-CcwZ1Tf_.js";import{b as w,u as D}from"./vendor-react-CqfXSjHo.js";import{B as I,I as k,a as o,C as L,U as G}from"./api-eoxcJg82.js";import{S as V}from"./sparkles-DrSQu59O.js";import{B as q}from"./book-open-5YIpsh0P.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=N("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=N("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=N("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=N("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=N("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=N("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=N("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),X={info:{bg:"bg-blue-50 border-blue-200",text:"text-blue-800",icon:O},success:{bg:"bg-green-50 border-green-200",text:"text-green-800",icon:A},warning:{bg:"bg-yellow-50 border-yellow-200",text:"text-yellow-800",icon:E},error:{bg:"bg-red-50 border-red-200",text:"text-red-800",icon:_}};function Y({children:e,variant:s="info",title:r,onClose:l,className:n=""}){const a=X[s],c=a.icon;return t.jsxs("div",{className:`
        flex gap-3 p-4 rounded-lg border
        ${a.bg} ${a.text}
        ${n}
      `,role:"alert",children:[t.jsx(c,{className:"shrink-0 mt-0.5",size:20}),t.jsxs("div",{className:"flex-1",children:[r&&t.jsx("p",{className:"font-semibold mb-1",children:r}),t.jsx("div",{className:"text-sm",children:e})]}),l&&t.jsx("button",{onClick:l,className:"shrink-0 p-1 rounded hover:bg-black/10 transition-colors","aria-label":"Dismiss",children:t.jsx(z,{size:16})})]})}const $={en:{title:"Change Password",description:"Enter your current password and choose a new one.",currentPassword:"Current password",newPassword:"New password",confirmPassword:"Confirm new password",changePassword:"Change Password",passwordsMatch:"Passwords must match",passwordTooShort:"Password must be at least 6 characters",success:"Password changed successfully!",successDesc:"Your password has been updated.",close:"Close"},de:{title:"Passwort √§ndern",description:"Geben Sie Ihr aktuelles Passwort ein und w√§hlen Sie ein neues.",currentPassword:"Aktuelles Passwort",newPassword:"Neues Passwort",confirmPassword:"Neues Passwort best√§tigen",changePassword:"Passwort √§ndern",passwordsMatch:"Passw√∂rter m√ºssen √ºbereinstimmen",passwordTooShort:"Passwort muss mindestens 6 Zeichen lang sein",success:"Passwort erfolgreich ge√§ndert!",successDesc:"Ihr Passwort wurde aktualisiert.",close:"Schliessen"},fr:{title:"Changer le mot de passe",description:"Entrez votre mot de passe actuel et choisissez-en un nouveau.",currentPassword:"Mot de passe actuel",newPassword:"Nouveau mot de passe",confirmPassword:"Confirmer le nouveau mot de passe",changePassword:"Changer le mot de passe",passwordsMatch:"Les mots de passe doivent correspondre",passwordTooShort:"Le mot de passe doit contenir au moins 6 caracteres",success:"Mot de passe change avec succes!",successDesc:"Votre mot de passe a ete mis a jour.",close:"Fermer"}};function Q({isOpen:e,onClose:s}){const{language:r}=P(),{changePassword:l}=S(),n=$[r]||$.en,[a,c]=w.useState(""),[g,i]=w.useState(""),[x,y]=w.useState(""),[h,f]=w.useState(!1),[v,d]=w.useState(""),[p,u]=w.useState(!1);if(!e)return null;const j=async m=>{if(m.preventDefault(),d(""),g.length<6){d(n.passwordTooShort);return}if(g!==x){d(n.passwordsMatch);return}f(!0);try{await l(a,g),u(!0)}catch(C){d(C instanceof Error?C.message:"Failed to change password")}finally{f(!1)}},b=()=>{c(""),i(""),y(""),d(""),u(!1),s()};return t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-8 animate-fade-in relative",children:[t.jsx("button",{onClick:b,className:"absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:t.jsx(z,{size:20})}),p?t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(A,{className:"w-8 h-8 text-green-600"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:n.success}),t.jsx("p",{className:"text-gray-500 mb-6",children:n.successDesc}),t.jsx(I,{onClick:b,variant:"primary",className:"w-full",children:n.close})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"text-center mb-6",children:[t.jsx("div",{className:"w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(B,{className:"w-8 h-8 text-indigo-600"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:n.title}),t.jsx("p",{className:"text-gray-500",children:n.description})]}),v&&t.jsx(Y,{variant:"error",className:"mb-4",children:v}),t.jsxs("form",{onSubmit:j,className:"space-y-4",children:[t.jsx(k,{type:"password",label:n.currentPassword,value:a,onChange:m=>c(m.target.value),placeholder:"********",required:!0,disabled:h}),t.jsx(k,{type:"password",label:n.newPassword,value:g,onChange:m=>i(m.target.value),placeholder:"********",required:!0,disabled:h}),t.jsx(k,{type:"password",label:n.confirmPassword,value:x,onChange:m=>y(m.target.value),placeholder:"********",required:!0,disabled:h}),t.jsx(I,{type:"submit",variant:"primary",loading:h,className:"w-full",children:n.changePassword})]})]})]})})}const ee={async getDraft(){try{return(await o.get("/api/story-draft")).draft}catch{return null}},async saveDraft(e){await o.post("/api/story-draft",{draft:e})},async deleteDraft(){await o.delete("/api/story-draft")},async getStories(e){const s=new URLSearchParams;e!=null&&e.limit&&s.set("limit",String(e.limit)),e!=null&&e.offset&&s.set("offset",String(e.offset));const r=s.toString(),l=`/api/stories${r?`?${r}`:""}`,n=await o.get(l);return{stories:(n.stories||[]).map(c=>({id:c.id,title:c.title,story_type:"",art_style:"",language:c.language,pages:c.pageCount||c.pages||0,created_at:c.createdAt,hasThumbnail:c.hasThumbnail,isPartial:c.isPartial,generatedPages:c.generatedPages,totalPages:c.totalPages})),pagination:n.pagination}},async getStoryCover(e){try{return(await o.get(`/api/stories/${e}/cover`)).coverImage}catch{return null}},async getStory(e){try{const s=await o.get(`/api/stories/${e}`),r=s.storyText||s.story||"";return{id:s.id,title:s.title,storyType:s.storyType,artStyle:s.artStyle,language:s.language,languageLevel:s.languageLevel,pages:s.pages,dedication:s.dedication,characters:s.characters,mainCharacters:s.mainCharacters,relationships:s.relationships,relationshipTexts:s.relationshipTexts,outline:s.outline,outlinePrompt:s.outlinePrompt,outlineModelId:s.outlineModelId,outlineUsage:s.outlineUsage,story:r,storyTextPrompts:s.storyTextPrompts,visualBible:s.visualBible,sceneDescriptions:s.sceneDescriptions,sceneImages:s.sceneImages,coverImages:s.coverImages,thumbnail:s.thumbnail,createdAt:s.createdAt,isPartial:s.isPartial,failureReason:s.failureReason,generatedPages:s.generatedPages,totalPages:s.totalPages}}catch{return null}},async getStoryWithProgress(e,s){var r;try{const l=localStorage.getItem("auth_token"),n=await fetch(`/api/stories/${e}`,{headers:l?{Authorization:`Bearer ${l}`}:{}});if(!n.ok)throw new Error(`HTTP ${n.status}`);const a=n.headers.get("Content-Length"),c=a?parseInt(a,10):null,g=(r=n.body)==null?void 0:r.getReader();if(!g){const d=await n.json();return this.mapServerStoryToClient(d)}const i=[];let x=0;for(;;){const{done:d,value:p}=await g.read();if(d)break;i.push(p),x+=p.length,s(x,c)}const y=new Uint8Array(x);let h=0;for(const d of i)y.set(d,h),h+=d.length;const f=new TextDecoder().decode(y),v=JSON.parse(f);return this.mapServerStoryToClient(v)}catch{return null}},mapServerStoryToClient(e){const s=e.storyText||e.story||"";return{id:e.id,title:e.title,storyType:e.storyType,artStyle:e.artStyle,language:e.language,languageLevel:e.languageLevel,pages:e.pages,dedication:e.dedication,characters:e.characters,mainCharacters:e.mainCharacters,relationships:e.relationships,relationshipTexts:e.relationshipTexts,outline:e.outline,outlinePrompt:e.outlinePrompt,story:s,storyTextPrompts:e.storyTextPrompts,visualBible:e.visualBible,sceneDescriptions:e.sceneDescriptions,sceneImages:e.sceneImages,coverImages:e.coverImages,thumbnail:e.thumbnail,createdAt:e.createdAt,isPartial:e.isPartial,failureReason:e.failureReason,generatedPages:e.generatedPages,totalPages:e.totalPages}},async getStoryMetadata(e){try{const s=localStorage.getItem("auth_token"),r=await fetch(`/api/stories/${e}/metadata`,{headers:s?{Authorization:`Bearer ${s}`}:{}});if(!r.ok)throw new Error(`HTTP ${r.status}`);const l=await r.json();return{...this.mapServerStoryToClient(l),totalImages:l.totalImages||0}}catch{return null}},async getStoryDevMetadata(e){try{const s=localStorage.getItem("auth_token"),r=await fetch(`/api/stories/${e}/dev-metadata`,{headers:s?{Authorization:`Bearer ${s}`}:{}});return r.ok?await r.json():(console.warn(`Failed to fetch dev metadata: HTTP ${r.status}`),null)}catch(s){return console.warn("Failed to fetch dev metadata:",s),null}},async getPageImage(e,s){try{return await o.get(`/api/stories/${e}/image/${s}`)}catch{return null}},async getCoverImage(e,s){try{return await o.get(`/api/stories/${e}/cover-image/${s}`)}catch{return null}},async getStoryProgressively(e,s,r,l){var f,v,d,p;const n=await this.getStoryMetadata(e);if(!n)throw new Error("Story not found");s(n,n.totalImages);const a=((f=n.sceneImages)==null?void 0:f.filter(u=>u.hasImage!==!1&&u.pageNumber).map(u=>u.pageNumber))||[],c=[],g=(v=n.coverImages)==null?void 0:v.frontCover,i=(d=n.coverImages)==null?void 0:d.initialPage,x=(p=n.coverImages)==null?void 0:p.backCover;g&&(typeof g=="string"||g.hasImage)&&c.push("frontCover"),i&&(typeof i=="string"||i.hasImage)&&c.push("initialPage"),x&&(typeof x=="string"||x.hasImage)&&c.push("backCover");let y=0;for(const u of c){const j=await this.getCoverImage(e,u);j&&(y++,r(u,j.imageData,void 0,y))}const h=3;for(let u=0;u<a.length;u+=h){const j=a.slice(u,u+h);(await Promise.all(j.map(m=>this.getPageImage(e,m)))).forEach((m,C)=>{m&&(y++,r(j[C],m.imageData,m.imageVersions,y))})}l()},async createStory(e){return{id:(await o.post("/api/stories",{title:e.title,story_type:e.storyType,art_style:e.artStyle,language:e.language,language_level:e.languageLevel,pages:e.pages,dedication:e.dedication,characters:e.characters,main_characters:e.mainCharacters,relationships:e.relationships,relationship_texts:e.relationshipTexts,outline:e.outline,story:e.story,scene_descriptions:e.sceneDescriptions,scene_images:e.sceneImages,cover_images:e.coverImages})).id}},async deleteStory(e){await o.delete(`/api/stories/${e}`)},async regenerateSceneDescription(e,s){return await o.post(`/api/stories/${e}/regenerate/scene-description/${s}`)},async regenerateImage(e,s,r,l){return await o.post(`/api/stories/${e}/regenerate/image/${s}`,{editedScene:r,characterIds:l})},async regenerateCover(e,s){return await o.post(`/api/stories/${e}/regenerate/cover/${s}`)},async updatePage(e,s,r){await o.patch(`/api/stories/${e}/page/${s}`,{text:r.text,scene_description:r.sceneDescription,image_data:r.imageData})},async updateVisualBible(e,s){await o.put(`/api/stories/${e}/visual-bible`,{visualBible:s})},async editImage(e,s,r){return await o.post(`/api/stories/${e}/edit/image/${s}`,{editPrompt:r})},async editCover(e,s,r){return await o.post(`/api/stories/${e}/edit/cover/${s}`,{editPrompt:r})},async repairImage(e,s){return await o.post(`/api/stories/${e}/repair/image/${s}`)},async callClaude(e,s=8192){return(await o.post("/api/claude",{prompt:e,max_tokens:s})).content},async callGemini(e,s){return(await o.post("/api/gemini",{prompt:e,images:s})).content},async generateStoryIdeas(e){return await o.post("/api/generate-story-ideas",e)},async createStoryJob(e){const s=`idem_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r=await o.post("/api/jobs/create-story",{idempotencyKey:s,storyType:e.storyType,storyTypeName:e.storyTypeName,storyCategory:e.storyCategory,storyTopic:e.storyTopic,storyTheme:e.storyTheme,artStyle:e.artStyle,language:e.language,languageLevel:e.languageLevel,pages:e.pages,dedication:e.dedication,storyDetails:e.storyDetails,characters:e.characters,mainCharacters:e.mainCharacters,relationships:e.relationships,relationshipTexts:e.relationshipTexts,skipImages:e.skipImages,imageGenMode:e.imageGenMode,generationMode:e.generationMode,skipOutline:e.skipOutline,skipText:e.skipText,skipSceneDescriptions:e.skipSceneDescriptions,skipCovers:e.skipCovers,enableAutoRepair:e.enableAutoRepair,modelOverrides:e.modelOverrides});return{jobId:r.jobId,creditsRemaining:r.creditsRemaining}},async getJobStatus(e){const s=await o.get(`/api/jobs/${e}/status`);console.log("[storyService.getJobStatus] Raw response:",{status:s.status,hasResult:!!s.result,hasResultData:!!s.resultData,resultKeys:s.result?Object.keys(s.result):s.resultData?Object.keys(s.resultData):[],progress:s.progress});const r=s.result||s.resultData;return{status:s.status,progress:{current:s.progress||0,total:100,message:s.progressMessage||""},result:r?{storyId:r.storyId||"",title:r.title||"",outline:r.outline||"",outlinePrompt:r.outlinePrompt,outlineModelId:r.outlineModelId,outlineUsage:r.outlineUsage,story:r.story||r.storyText||"",storyTextPrompts:r.storyTextPrompts,visualBible:r.visualBible,styledAvatarGeneration:r.styledAvatarGeneration,costumedAvatarGeneration:r.costumedAvatarGeneration,generationLog:r.generationLog,sceneDescriptions:r.sceneDescriptions||[],sceneImages:r.sceneImages||[],coverImages:r.coverImages}:void 0,partialCovers:s.partialCovers,storyText:s.storyText,partialPages:s.partialPages,currentCredits:s.currentCredits,error:s.errorMessage}},async cancelJob(e){return await o.post(`/api/jobs/${e}/cancel`)},async generatePdf(e){const s=localStorage.getItem("auth_token"),r=await fetch(`/api/stories/${e}/pdf`,{headers:s?{Authorization:`Bearer ${s}`}:{}});if(!r.ok)throw new Error("Failed to generate PDF");return r.blob()},async createCheckoutSession(e,s){const r=Array.isArray(e)?e:[e];return await o.post("/api/stripe/create-checkout-session",{storyIds:r,coverType:s||"softcover"})},async createCreditsCheckout(e=100,s=500){return await o.post("/api/stripe/create-credits-checkout",{credits:e,amount:s})},async getPricing(){return await o.get("/api/pricing")},async createPrintOrder(e,s){return await o.post("/api/print-provider/order",{storyId:e,shippingAddress:s})},async getOrderStatus(e){return await o.get(`/api/stripe/order-status/${e}`)},async saveStoryText(e,s){return await o.put(`/api/stories/${e}/text`,{story:s})},async saveStoryTitle(e,s){return await o.put(`/api/stories/${e}/title`,{title:s})},async setActiveImage(e,s,r){return await o.put(`/api/stories/${e}/pages/${s}/active-image`,{versionIndex:r})}};function se({isOpen:e,onClose:s}){const{language:r}=P(),{showError:l}=F(),[n,a]=w.useState(!1);if(!e)return null;const c=async()=>{a(!0);try{const{url:i}=await ee.createCreditsCheckout(100,500);i&&(window.location.href=i)}catch(i){console.error("Failed to create checkout:",i),l(r==="de"?"Fehler beim Erstellen der Zahlung. Bitte versuchen Sie es erneut.":r==="fr"?"Erreur lors de la cr√©ation du paiement. Veuillez r√©essayer.":"Failed to create payment. Please try again."),a(!1)}},g={title:r==="de"?"Credits kaufen":r==="fr"?"Acheter des credits":"Buy Credits",credits:r==="de"?"Credits":"credits",description:r==="de"?"100 Credits reichen fuer etwa 3-4 Geschichten":r==="fr"?"100 credits suffisent pour environ 3-4 histoires":"100 credits are enough for about 3-4 stories",securePayment:r==="de"?"Sichere Zahlung mit Stripe":r==="fr"?"Paiement securise avec Stripe":"Secure payment with Stripe",cancel:r==="de"?"Abbrechen":r==="fr"?"Annuler":"Cancel",buyNow:r==="de"?"Jetzt kaufen":r==="fr"?"Acheter maintenant":"Buy Now",loading:r==="de"?"Wird geladen...":r==="fr"?"Chargement...":"Loading..."};return t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>!n&&s(),children:t.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl",onClick:i=>i.stopPropagation(),children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:g.title}),t.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-6 mb-6 border-2 border-indigo-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(L,{className:"text-indigo-600",size:24}),t.jsx("span",{className:"text-2xl font-bold text-gray-900",children:"100"}),t.jsx("span",{className:"text-gray-600",children:g.credits})]}),t.jsx("div",{className:"text-right",children:t.jsx("span",{className:"text-3xl font-bold text-indigo-600",children:"CHF 5.-"})})]}),t.jsx("p",{className:"text-sm text-gray-500",children:g.description})]}),t.jsx("p",{className:"text-sm text-gray-500 mb-4 text-center",children:g.securePayment}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:s,disabled:n,className:"flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-300 font-semibold disabled:opacity-50",children:g.cancel}),t.jsx("button",{onClick:c,disabled:n,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 font-semibold disabled:opacity-50 flex items-center justify-center gap-2",children:n?t.jsxs(t.Fragment,{children:[t.jsx(U,{size:18,className:"animate-spin"}),g.loading]}):g.buyNow})]})]})})}function te({onClose:e,onShowCreditsModal:s,onShowChangePasswordModal:r}){const l=D(),{t:n,language:a,setLanguage:c}=P(),{isAuthenticated:g,user:i,logout:x,isImpersonating:y}=S(),h=(i==null?void 0:i.credits)??0,f=(i==null?void 0:i.credits)===-1||y,v=()=>{x(),e(),l("/")},d=u=>{l(u),e()},p={language:a==="de"?"Sprache":a==="fr"?"Langue":"Language",credits:a==="de"?"Credits":a==="fr"?"cr√©dits":"credits",createNewStory:a==="de"?"Neue Geschichte":a==="fr"?"Nouvelle histoire":"Create New Story",myStories:a==="de"?"Meine Geschichten":a==="fr"?"Mes histoires":"My Stories",myOrders:a==="de"?"Meine Bestellungen":a==="fr"?"Mes commandes":"My Orders",buyCredits:a==="de"?"Credits kaufen":a==="fr"?"Acheter des cr√©dits":"Buy Credits",adminPanel:a==="de"?"Admin Panel":a==="fr"?"Panneau Admin":"Admin Panel",manageUsers:a==="de"?"Benutzer verwalten":a==="fr"?"G√©rer les utilisateurs":"Manage Users",changePassword:a==="de"?"Passwort √§ndern":a==="fr"?"Changer le mot de passe":"Change Password",legal:a==="de"?"Rechtliches":a==="fr"?"Mentions l√©gales":"Legal",terms:a==="de"?"AGB":a==="fr"?"CGU":"Terms",privacy:a==="de"?"Datenschutz":a==="fr"?"Confidentialit√©":"Privacy"};return t.jsxs("div",{className:"absolute right-0 mt-2 bg-gray-800 rounded-lg shadow-lg overflow-hidden z-50 min-w-[200px]",children:[g&&i&&t.jsxs("div",{className:"border-b border-gray-700 px-4 py-3 bg-gray-900",children:[t.jsxs("div",{className:"text-white font-semibold text-sm mb-1",children:[i.username," ",i.role==="admin"&&"üëë"]}),t.jsxs("div",{className:`text-xs px-2 py-1 rounded inline-block ${f?"bg-purple-600 text-white":h===0?"bg-red-600 text-white":h<50?"bg-yellow-600 text-white":"bg-green-600 text-white"}`,children:[f?"‚àû":h," ",p.credits]})]}),t.jsxs("div",{className:"border-b border-gray-700 px-4 py-2",children:[t.jsx("div",{className:"text-xs text-gray-400 mb-2",children:p.language}),t.jsx("div",{className:"flex gap-2",children:["en","de","fr"].map(u=>t.jsx("button",{onClick:()=>{c(u),e()},className:`flex-1 px-3 py-2 rounded text-xs font-semibold ${a===u?"bg-indigo-600 text-white":"bg-gray-700 text-white hover:bg-gray-600"}`,children:u.toUpperCase()},u))})]}),g&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>d("/create?new=true"),className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-2 border-b border-gray-700",children:[t.jsx(V,{size:16}),t.jsx("span",{children:p.createNewStory})]}),t.jsxs("button",{onClick:()=>d("/stories"),className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-2 border-b border-gray-700",children:[t.jsx(q,{size:16}),t.jsx("span",{children:p.myStories})]}),t.jsxs("button",{onClick:()=>d("/orders"),className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-2 border-b border-gray-700",children:[t.jsx(Z,{size:16}),t.jsx("span",{children:p.myOrders})]}),t.jsxs("button",{onClick:()=>{s(),e()},className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-2 border-b border-gray-700",children:[t.jsx(L,{size:16}),t.jsx("span",{children:p.buyCredits})]}),((i==null?void 0:i.role)==="admin"||y)&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>d("/admin"),className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-2 border-b border-gray-700",children:[t.jsx(W,{size:16}),t.jsx("span",{children:p.adminPanel})]}),t.jsxs("button",{onClick:()=>d("/admin?tab=users"),className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-2 border-b border-gray-700",children:[t.jsx(G,{size:16}),t.jsx("span",{children:p.manageUsers})]})]}),t.jsxs("button",{onClick:()=>{r(),e()},className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-2 border-b border-gray-700",children:[t.jsx(B,{size:16}),t.jsx("span",{children:p.changePassword})]}),t.jsxs("button",{onClick:v,className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-2",children:[t.jsx(T,{size:16}),t.jsx("span",{children:n.logout})]})]}),!g&&t.jsxs("button",{onClick:()=>d("/?login=true"),className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-2 border-b border-gray-700",children:[t.jsx(T,{size:16}),t.jsx("span",{children:n.login})]}),t.jsxs("div",{className:"border-t border-gray-700 px-4 py-2",children:[t.jsxs("div",{className:"text-xs text-gray-400 mb-2 flex items-center gap-1",children:[t.jsx(K,{size:12}),p.legal]}),t.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[t.jsx("button",{onClick:()=>d("/terms"),className:"text-gray-400 hover:text-white",children:p.terms}),t.jsx("span",{className:"text-gray-600",children:"‚Ä¢"}),t.jsx("button",{onClick:()=>d("/privacy"),className:"text-gray-400 hover:text-white",children:p.privacy}),t.jsx("span",{className:"text-gray-600",children:"‚Ä¢"}),t.jsx("button",{onClick:()=>d("/impressum"),className:"text-gray-400 hover:text-white",children:"Impressum"})]})]})]})}const M={en:{1:"Characters",2:"Book",3:"Story",4:"Style",5:"Summary"},de:{1:"Figuren",2:"Buch",3:"Story",4:"Stil",5:"√úbersicht"},fr:{1:"Personnages",2:"Livre",3:"Histoire",4:"Style",5:"R√©sum√©"}};function ce({currentStep:e=0,onStepClick:s,canAccessStep:r,developerMode:l=!1,onDeveloperModeChange:n}){const a=D(),{t:c,language:g}=P(),{isAuthenticated:i,user:x,isImpersonating:y}=S(),[h,f]=w.useState(!1),[v,d]=w.useState(!1),[p,u]=w.useState(!1),j=w.useRef(null);return w.useEffect(()=>{const b=m=>{j.current&&!j.current.contains(m.target)&&f(!1)};return h&&document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[h]),t.jsxs("nav",{className:"bg-black text-white px-3 py-3",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsxs("button",{onClick:()=>a("/"),className:"text-sm md:text-base font-bold whitespace-nowrap hover:opacity-80",children:["‚ú® ",c.title]})}),e>0&&s&&r&&t.jsx("div",{className:"flex items-center gap-0.5 md:gap-2 flex-1 justify-center",children:[1,2,3,4,5].map(b=>{const m=r(b),C=e===b,R=M[g]||M.en;return t.jsxs("div",{className:"flex items-center",children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("button",{onClick:()=>m&&s(b),disabled:!m,className:`w-5 h-5 md:w-7 md:h-7 rounded-full flex items-center justify-center text-[10px] md:text-xs font-bold transition-all ${m?C?"bg-indigo-500 text-white ring-2 ring-white scale-110 shadow-lg shadow-indigo-500/50":"bg-indigo-600 text-white hover:bg-indigo-500 cursor-pointer hover:scale-110":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:b}),t.jsx("span",{className:`hidden md:block text-[10px] mt-0.5 transition-all ${C?"text-white font-semibold":"text-gray-400"}`,children:R[b]})]}),b<5&&t.jsx("div",{className:`w-3 md:w-4 h-0.5 mb-4 md:mb-3 ${m?"bg-indigo-500":"bg-gray-600"}`})]},b)})}),t.jsxs("div",{className:"flex items-center gap-3",children:[i&&((x==null?void 0:x.role)==="admin"||y)&&n&&t.jsxs("button",{onClick:()=>n(!l),className:`px-2 py-1 rounded text-xs font-semibold flex items-center gap-1 transition-colors ${l?"bg-yellow-500 text-black":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:g==="de"?"Entwicklermodus":g==="fr"?"Mode d√©veloppeur":"Developer Mode",children:[t.jsx(H,{size:14}),t.jsx("span",{className:"hidden md:inline",children:"DEV"})]}),t.jsxs("div",{className:"relative",ref:j,children:[t.jsxs("button",{onClick:()=>f(!h),className:"bg-gray-800 text-white px-3 py-1.5 rounded text-xs font-semibold hover:bg-gray-700 flex items-center gap-2",children:[t.jsx(J,{size:16}),t.jsx("span",{className:"hidden md:inline",children:"Menu"})]}),h&&t.jsx(te,{onClose:()=>f(!1),onShowCreditsModal:()=>d(!0),onShowChangePasswordModal:()=>u(!0)})]})]})]}),t.jsx(se,{isOpen:v,onClose:()=>d(!1)}),t.jsx(Q,{isOpen:p,onClose:()=>u(!1)})]})}const re=w.forwardRef(({label:e,error:s,helperText:r,className:l="",...n},a)=>t.jsxs("div",{className:"w-full",children:[e&&t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e,n.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("textarea",{ref:a,className:`
            w-full px-4 py-2 rounded-lg border resize-y
            transition-all duration-200
            focus:outline-none focus:ring-2
            ${s?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-purple-500 focus:border-purple-500"}
            disabled:bg-gray-100 disabled:cursor-not-allowed
            ${l}
          `,...n}),s&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:s}),r&&!s&&t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:r})]}));re.displayName="Textarea";export{Y as A,B as K,ce as N,Z as P,ee as s};
