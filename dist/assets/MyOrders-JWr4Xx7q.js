import{c as y,u as w,a as k,d as C,b as g,j as e,g as b,C as u,E as S}from"./index-DEbH-mIP.js";import{u as L,b as c}from"./vendor-react-CqfXSjHo.js";import{N as A,P as p}from"./Textarea-C0UHnn0b.js";import"./Input-BPXF8f5u.js";import{C as z}from"./coins-DhmIHX6_.js";import{C as x}from"./clock-CMZc6Mih.js";import"./vendor-firebase-DTVMaYMy.js";import"./sparkles-CUxyZEt2.js";import"./book-open-BYHR3SIQ.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=y("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=y("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]),h=C("MyOrders");function B({status:t,language:s}){const i=(()=>{switch(t.toLowerCase()){case"delivered":return{icon:e.jsx(u,{size:14}),text:s==="de"?"Geliefert":s==="fr"?"Livré":"Delivered",className:"bg-green-100 text-green-800"};case"shipped":case"in_transit":return{icon:e.jsx(M,{size:14}),text:s==="de"?"Versendet":s==="fr"?"Expédié":"Shipped",className:"bg-blue-100 text-blue-800"};case"printed":return{icon:e.jsx(p,{size:14}),text:s==="de"?"Gedruckt":s==="fr"?"Imprimé":"Printed",className:"bg-indigo-100 text-indigo-800"};case"in_production":case"printing":return{icon:e.jsx(x,{size:14}),text:s==="de"?"Wird gedruckt":s==="fr"?"Impression":"Printing",className:"bg-purple-100 text-purple-800"};case"cancelled":case"canceled":case"failed":return{icon:e.jsx(x,{size:14}),text:s==="de"?"Fehlgeschlagen":s==="fr"?"Échoué":"Failed",className:"bg-red-100 text-red-800"};case"paid":return{icon:e.jsx(u,{size:14}),text:s==="de"?"Bezahlt":s==="fr"?"Payé":"Paid",className:"bg-emerald-100 text-emerald-800"};case"created":case"passed":case"submitted":case"processing":default:return{icon:e.jsx(x,{size:14}),text:s==="de"?"In Bearbeitung":s==="fr"?"En cours":"Processing",className:"bg-amber-100 text-amber-800"}}})();return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${i.className}`,children:[i.icon,i.text]})}function I({order:t,language:s,formatDate:a,formatAmount:i}){return e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow border-l-4 border-amber-400",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center",children:e.jsx(z,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s==="de"?"Guthaben":s==="fr"?"Crédits":"Credits"}),e.jsxs("h3",{className:"font-bold text-lg text-gray-800",children:["+",t.creditsAmount," ",s==="de"?"Credits":s==="fr"?"crédits":"credits"]})]})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(u,{size:14}),s==="de"?"Abgeschlossen":s==="fr"?"Terminé":"Completed"]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:s==="de"?"Datum:":"Date:"})," ",a(t.createdAt)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:s==="de"?"Betrag:":s==="fr"?"Montant:":"Amount:"})," ",i(t.amount,t.currency)]})]})]})})}function E({order:t,language:s,onViewStory:a,formatDate:i,formatAmount:o}){const[d,m]=c.useState(null);return c.useEffect(()=>{t.thumbnailUrl&&g.get(t.thumbnailUrl).then(l=>{l.coverImage&&m(l.coverImage)}).catch(()=>{})},[t.thumbnailUrl]),e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow",children:[d&&e.jsx("div",{className:"h-32 bg-gray-100 overflow-hidden",children:e.jsx("img",{src:d.startsWith("data:")?d:`data:image/jpeg;base64,${d}`,alt:t.storyTitle||"Book cover",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[s==="de"?"Bestellung":s==="fr"?"Commande":"Order"," ",t.displayOrderId||`#${t.id}`]}),e.jsx("h3",{className:"font-bold text-lg text-gray-800 line-clamp-2",children:t.storyTitle||"Untitled Story"})]}),e.jsx(B,{status:t.orderStatus,language:s})]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600 mb-4",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:s==="de"?"Datum:":"Date:"})," ",i(t.createdAt)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:s==="de"?"Betrag:":s==="fr"?"Montant:":"Amount:"})," ",o(t.amount,t.currency)]}),t.shippingAddress&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:s==="de"?"Lieferadresse:":s==="fr"?"Adresse:":"Ship to:"})," ",t.shippingAddress.city,", ",t.shippingAddress.country]})]}),t.trackingNumber&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-1",children:s==="de"?"Sendungsverfolgung":s==="fr"?"Suivi":"Tracking"}),t.trackingUrl?e.jsxs("a",{href:t.trackingUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline text-sm flex items-center gap-1",children:[t.trackingNumber,e.jsx(D,{size:12})]}):e.jsx("p",{className:"text-sm text-blue-700",children:t.trackingNumber})]}),t.storyId&&e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:a,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium",children:[e.jsx(S,{size:16}),s==="de"?"Geschichte ansehen":s==="fr"?"Voir l'histoire":"View Story"]})})]})]})}function W(){const t=L(),{language:s}=w(),{isAuthenticated:a,isLoading:i}=k(),[o,d]=c.useState([]),[m,l]=c.useState(!0);c.useEffect(()=>{if(!i){if(!a){t("/");return}N()}},[a,i,t]);const N=async()=>{var r;h.debug("Loading orders...");try{l(!0);const n=await g.get("/api/user/orders");h.info("Loaded orders:",((r=n.orders)==null?void 0:r.length)||0),d(n.orders||[])}catch(n){h.error("Failed to load orders:",n)}finally{l(!1)}},f=c.useCallback(r=>{if(!r)return"-";try{return new Date(r).toLocaleDateString(s==="de"?"de-DE":s==="fr"?"fr-FR":"en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"-"}},[s]),j=c.useCallback((r,n)=>{const v=r/100;return new Intl.NumberFormat(s==="de"?"de-CH":s==="fr"?"fr-CH":"en-US",{style:"currency",currency:n.toUpperCase()}).format(v)},[s]);return i||!a?e.jsx(b,{fullScreen:!0}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(A,{currentStep:0}),e.jsxs("div",{className:"px-4 md:px-8 py-8 max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(p,{size:28}),s==="de"?"Meine Bestellungen":s==="fr"?"Mes commandes":"My Orders"]})}),m?e.jsx(b,{message:s==="de"?"Laden...":s==="fr"?"Chargement...":"Loading..."}):o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(p,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:s==="de"?"Noch keine Bestellungen":s==="fr"?"Aucune commande":"No orders yet"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:s==="de"?"Wenn du ein Buch bestellst, wird es hier angezeigt.":s==="fr"?"Quand vous commandez un livre, il apparaîtra ici.":"When you order a book, it will appear here."})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:o.map(r=>r.type==="credits"?e.jsx(I,{order:r,language:s,formatDate:f,formatAmount:j},r.id):e.jsx(E,{order:r,language:s,onViewStory:()=>t(`/create?storyId=${r.storyId}`),formatDate:f,formatAmount:j},r.id))})]})]})}export{W as default};
