import{c as O,j as e,u as H,b as pt,d as ft,e as _t,L as it}from"./index-DVOxqZt_.js";import{b,u as Ut,d as qt}from"./vendor-react-BhxjzHy9.js";import{B as ve}from"./Button-CPXBB0an.js";import{N as Lt}from"./Textarea-SdFWO3GF.js";import{B as je,U as X}from"./Input-qdO_AAhI.js";import{P as Mt,L as Ot,D as Vt,F as Ue,R as le}from"./refresh-cw-CPuCYiRu.js";import{T as Ht,a as M,A as lt}from"./api-DyGoe78i.js";import{A as bt,S as oe}from"./sparkles-C1y314uI.js";import{s as J}from"./storyService-DnpU5H4t.js";import"./vendor-firebase-ChSXtidx.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=O("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=O("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=O("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=O("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=O("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=O("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=O("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=O("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=O("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=O("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=O("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=O("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),dt={sm:"h-1",md:"h-2",lg:"h-3"},es={default:"bg-indigo-600",success:"bg-green-500",warning:"bg-yellow-500",gradient:"bg-gradient-to-r from-indigo-500 to-indigo-600"};function ts({value:t,max:i=100,label:x,showPercentage:u=!1,size:n="md",variant:f="gradient",className:N=""}){const d=Math.min(Math.max(t/i*100,0),100);return e.jsxs("div",{className:N,children:[(x||u)&&e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[x&&e.jsx("span",{className:"text-sm font-medium text-gray-700",children:x}),u&&e.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(d),"%"]})]}),e.jsx("div",{className:`w-full bg-gray-200 rounded-full overflow-hidden ${dt[n]}`,children:e.jsx("div",{className:`${dt[n]} ${es[f]} rounded-full transition-all duration-500 ease-out`,style:{width:`${d}%`}})})]})}const yt=[{id:"christmas",name:{en:"Christmas Story",de:`Weihnachts-
Geschichte`,fr:"Histoire de No√´l"},emoji:"üéÑ"},{id:"newyear",name:{en:"New Year Story",de:`Neujahrs-
Geschichte`,fr:"Histoire du Nouvel An"},emoji:"üéÜ"},{id:"pirate",name:{en:"Pirate Adventure",de:"Piraten-Abenteuer",fr:"Aventure de Pirates"},emoji:"üè¥‚Äç‚ò†Ô∏è"},{id:"cowboy",name:{en:"Wild West",de:"Wilder Westen",fr:"Far West"},emoji:"ü§†"},{id:"fireman",name:{en:"Brave Firefighter",de:"Tapferer Feuerwehrmann",fr:"Pompier Courageux"},emoji:"üöí"},{id:"unicorn",name:{en:"Magical Unicorn",de:"Magisches Einhorn",fr:"Licorne Magique"},emoji:"ü¶Ñ"},{id:"ninja",name:{en:"Secret Ninja",de:"Geheimer Ninja",fr:"Ninja Secret"},emoji:"ü•∑"},{id:"space",name:{en:"Space Explorer",de:"Weltraum-Entdecker",fr:"Explorateur Spatial"},emoji:"üöÄ"},{id:"dinosaur",name:{en:"Dinosaur World",de:"Dinosaurier-Welt",fr:"Monde des Dinosaures"},emoji:"ü¶ñ"},{id:"princess",name:{en:"Princess Story",de:"Prinzessinnen-Geschichte",fr:"Histoire de Princesse"},emoji:"üëë"},{id:"knight",name:{en:"Knight Adventure",de:"Ritter-Abenteuer",fr:"Aventure de Chevalier"},emoji:"‚öîÔ∏è"},{id:"detective",name:{en:"Detective Mystery",de:"Detektiv-Geheimnis",fr:"Myst√®re de D√©tective"},emoji:"üîç"}];function ss({selectedType:t,onSelect:i,customTypes:x=[],onAddCustom:u}){const{t:n,language:f}=H(),N=[...yt,...x];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:n.chooseStoryType}),e.jsxs("div",{className:"grid grid-cols-3 md:grid-cols-5 lg:grid-cols-6 gap-2",children:[N.map(d=>e.jsxs("button",{onClick:()=>i(d.id),className:`p-2 rounded-lg border-2 transition-all ${t===d.id?"border-indigo-600 bg-indigo-50 shadow-lg":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:d.emoji}),e.jsx("div",{className:"font-semibold text-xs",children:d.name[f]})]},d.id)),u&&e.jsxs("button",{onClick:u,className:"p-2 rounded-lg border-2 border-dashed border-indigo-300 hover:border-indigo-600 transition-all hover:bg-indigo-50",children:[e.jsx("div",{className:"text-2xl mb-1",children:e.jsx(we,{size:24,className:"mx-auto text-indigo-600"})}),e.jsx("div",{className:"font-semibold text-xs text-indigo-600",children:n.addCustomStoryType})]})]})]})}const rs=[{id:"pixar",name:{en:"Pixar 3D",de:"Pixar 3D",fr:"Pixar 3D"},emoji:"üé¨",image:"/images/Pixar style.jpg",description:{en:"Vibrant, warm Disney/Pixar style 3D animation",de:"Lebendige, warme Disney/Pixar 3D-Animation",fr:"Animation 3D Disney/Pixar vibrante et chaleureuse"},prompt:"pixar style 3d character, vibrant Disney/Pixar 3D animation, warm lighting, child-friendly"},{id:"cartoon",name:{en:"Cartoon",de:"Cartoon",fr:"Dessin anim√©"},emoji:"üé®",image:"/images/cartoon style.jpg",description:{en:"Classic 2D cartoon style with bold colors",de:"Klassischer 2D-Cartoon-Stil mit kr√§ftigen Farben",fr:"Style cartoon 2D classique aux couleurs vives"},prompt:"2D cartoon style, bold outlines, vibrant flat colors, classic animation look"},{id:"anime",name:{en:"Anime",de:"Anime",fr:"Anime"},emoji:"‚≠ê",image:"/images/anime style.jpg",description:{en:"Japanese anime style with expressive features",de:"Japanischer Anime-Stil mit ausdrucksstarken Features",fr:"Style anime japonais aux traits expressifs"},prompt:"anime style, Japanese animation, expressive eyes, dynamic poses, cel-shaded"},{id:"chibi",name:{en:"Chibi",de:"Chibi",fr:"Chibi"},emoji:"üå∏",image:"/images/chibi style.jpg",description:{en:"Cute chibi style with big heads and small bodies",de:"Niedlicher Chibi-Stil mit gro√üen K√∂pfen und kleinen K√∂rpern",fr:"Style chibi mignon avec grandes t√™tes et petits corps"},prompt:"chibi style, super deformed, cute, big head, small body, kawaii, adorable"},{id:"steampunk",name:{en:"Steampunk",de:"Steampunk",fr:"Steampunk"},emoji:"‚öôÔ∏è",image:"/images/steampunk style.jpg",description:{en:"Victorian-era inspired with gears and brass",de:"Von der viktorianischen √Ñra inspiriert mit Zahnr√§dern und Messing",fr:"Inspir√© de l'√®re victorienne avec engrenages et laiton"},prompt:"steampunk anime style, Victorian era, gears, brass, copper, goggles, mechanical details, vintage technology, anime influenced"},{id:"comic",name:{en:"Comic Book",de:"Comic",fr:"Bande dessin√©e"},emoji:"üí•",image:"/images/comic book style.jpg",description:{en:"Comic book style with bold lines and halftone",de:"Comic-Stil mit kr√§ftigen Linien und Raster",fr:"Style bande dessin√©e avec lignes √©paisses et trames"},prompt:"comic book style, bold ink lines, halftone dots, dynamic action, speech bubbles aesthetic, superhero comic art"},{id:"manga",name:{en:"Manga",de:"Manga",fr:"Manga"},emoji:"üìö",image:"/images/manga style.jpg",description:{en:"Japanese manga style, black and white with screentones",de:"Japanischer Manga-Stil, schwarz-wei√ü mit Rastern",fr:"Style manga japonais, noir et blanc avec trames"},prompt:"manga style, Japanese comic art, detailed linework, screentones, dramatic shading, expressive characters"},{id:"watercolor",name:{en:"Watercolor",de:"Aquarell",fr:"Aquarelle"},emoji:"üé®",image:"/images/water color style.jpg",description:{en:"Soft watercolor painting with flowing colors",de:"Sanfte Aquarellmalerei mit flie√üenden Farben",fr:"Peinture aquarelle douce aux couleurs fluides"},prompt:"watercolor painting style, soft edges, flowing colors, delicate washes, artistic brushstrokes, dreamy atmosphere, traditional watercolor illustration"}];function as({selectedStyle:t,onSelect:i}){const{t:x,language:u}=H();return e.jsxs("div",{id:"art-style-section",className:"md:bg-indigo-50 md:border-2 md:border-indigo-200 md:rounded-lg md:p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Yt,{size:18,className:"text-indigo-600"}),e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-800",children:x.chooseArtStyle})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-2 md:mb-3",children:x.artStyleDescription}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 lg:grid-cols-7 gap-2",children:rs.map(n=>e.jsxs("button",{onClick:()=>i(n.id),className:`rounded-lg border-2 transition-all overflow-hidden flex flex-col bg-white ${t===n.id?"border-indigo-600 shadow-lg ring-2 ring-indigo-200":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"relative w-full h-32 overflow-hidden",children:e.jsx("img",{src:n.image,alt:n.name[u],className:"w-full h-full object-cover"})}),e.jsx("div",{className:"p-1.5 flex flex-col items-center text-center",children:e.jsx("div",{className:"font-bold text-xs text-gray-800",children:n.name[u]})})]},n.id))})]})}const Ne=[{value:{en:"Best Friends with",de:"Beste Freunde mit",fr:"Meilleurs amis avec"},inverse:{en:"Best Friends with",de:"Beste Freunde mit",fr:"Meilleurs amis avec"}},{value:{en:"Friends with",de:"Freunde mit",fr:"Amis avec"},inverse:{en:"Friends with",de:"Freunde mit",fr:"Amis avec"}},{value:{en:"Married to",de:"Verheiratet mit",fr:"Mari√©(e) √†"},inverse:{en:"Married to",de:"Verheiratet mit",fr:"Mari√©(e) √†"}},{value:{en:"In a relationship with",de:"In einer Beziehung mit",fr:"En relation avec"},inverse:{en:"In a relationship with",de:"In einer Beziehung mit",fr:"En relation avec"}},{value:{en:"Older Sibling of",de:"√Ñlteres Geschwister von",fr:"Fr√®re/S≈ìur a√Æn√©(e) de"},inverse:{en:"Younger Sibling of",de:"J√ºngeres Geschwister von",fr:"Fr√®re/S≈ìur cadet(te) de"}},{value:{en:"Younger Sibling of",de:"J√ºngeres Geschwister von",fr:"Fr√®re/S≈ìur cadet(te) de"},inverse:{en:"Older Sibling of",de:"√Ñlteres Geschwister von",fr:"Fr√®re/S≈ìur a√Æn√©(e) de"}},{value:{en:"Parent of",de:"Elternteil von",fr:"Parent de"},inverse:{en:"Child of",de:"Kind von",fr:"Enfant de"}},{value:{en:"Child of",de:"Kind von",fr:"Enfant de"},inverse:{en:"Parent of",de:"Elternteil von",fr:"Parent de"}},{value:{en:"Rivals with",de:"Rivalen mit",fr:"Rivaux avec"},inverse:{en:"Rivals with",de:"Rivalen mit",fr:"Rivaux avec"}},{value:{en:"Neighbors with",de:"Nachbarn mit",fr:"Voisins avec"},inverse:{en:"Neighbors with",de:"Nachbarn mit",fr:"Voisins avec"}},{value:{en:"Not Known to",de:"Nicht bekannt mit",fr:"Pas connu de"},inverse:{en:"Not Known to",de:"Nicht bekannt mit",fr:"Pas connu de"}}];function jt(t){const i=Ne.find(x=>x.value.en==="Not Known to");return i?i.value[t]:"Not Known to"}function vt(t){const i=Ne.find(x=>x.value.en==="Not Known to");return i?t===i.value.en||t===i.value.de||t===i.value.fr:!1}function ns(t,i){for(const x of Ne)if(x.value[i]===t)return x.inverse[i];return t}function is({characters:t,relationships:i,relationshipTexts:x,onRelationshipChange:u,onRelationshipTextChange:n,customRelationships:f=[],onAddCustomRelationship:N}){const{t:d,language:g}=H(),z=g,S=[...Ne,...f.map(C=>({value:{en:C,de:C,fr:C},inverse:{en:C,de:C,fr:C}}))],p=(C,k,w)=>{if(w==="__CREATE_CUSTOM__"){const y=prompt(g==="de"?"Beziehung eingeben:":g==="fr"?"Entrer la relation:":"Enter relationship:");y&&y.trim()&&(N==null||N(y.trim()),u(C,k,y.trim()))}else u(C,k,w)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Jt,{size:24})," ",d.defineRelationships]}),e.jsx("p",{className:"text-sm text-gray-500",children:d.defineRelationshipsDesc}),e.jsx("div",{className:"grid gap-3 md:gap-4",children:t.map((C,k)=>t.map((w,y)=>{if(k>=y)return null;const F=`${C.id}-${w.id}`,P=i[F],R=!P||vt(P);return e.jsx("div",{className:`rounded-lg p-2 md:p-3 inline-flex w-auto lg:w-3/4 mx-auto ${R?"bg-white border-red-500 border-[3px]":"bg-blue-50 border-blue-300 border-2"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-3 md:gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[(C.thumbnailUrl||C.photoUrl)&&e.jsx("img",{src:C.thumbnailUrl||C.photoUrl,alt:C.name,className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold text-xs md:text-sm text-center max-w-[60px] sm:max-w-[80px] md:max-w-[100px] truncate",children:C.name})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1 min-w-0 max-w-[200px] sm:max-w-[300px] md:max-w-[400px] lg:max-w-[50%] xl:max-w-[50%]",children:[e.jsxs("select",{value:P||jt(z),onChange:l=>p(C.id,w.id,l.target.value),className:`w-full px-2 py-1.5 md:px-3 md:py-2 border rounded text-sm md:text-base font-medium text-center ${R?"bg-white border-red-400 border-2":"bg-blue-100 border-blue-400"}`,children:[e.jsxs("option",{value:"__CREATE_CUSTOM__",children:["+ ",z==="de"?"Eigene":z==="fr"?"Personnalis√©":"Custom"]}),S.map((l,a)=>e.jsx("option",{value:l.value[z],children:l.value[z]},a))]}),!R&&e.jsx("input",{type:"text",value:x[F]||"",onChange:l=>n(F,l.target.value),placeholder:z==="de"?"Details...":z==="fr"?"D√©tails...":"Details...",className:"w-full px-2 py-1 md:px-3 md:py-1.5 border border-blue-300 rounded text-xs md:text-sm text-center bg-white"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[(w.thumbnailUrl||w.photoUrl)&&e.jsx("img",{src:w.thumbnailUrl||w.photoUrl,alt:w.name,className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold text-xs md:text-sm text-center max-w-[60px] sm:max-w-[80px] md:max-w-[100px] truncate",children:w.name})]})]})},F)}))})]})}function ls({characters:t,mainCharacters:i,onToggleMainCharacter:x,languageLevel:u,onLanguageLevelChange:n,pages:f,onPagesChange:N,dedication:d,onDedicationChange:g,storyDetails:z,onStoryDetailsChange:S,developerMode:p=!1,imageGenMode:C,onImageGenModeChange:k}){const{t:w,language:y}=H(),F=p?[10,30,40,50]:[30,40,50];b.useEffect(()=>{(p?[10,30,40,50]:[30,40,50]).includes(f)||N(30)},[f,p,N]);const P=[{value:"1st-grade",label:w.firstGrade,desc:w.firstGradeDesc,image:"/images/text and image on each page.jpg"},{value:"standard",label:w.standard,desc:w.standardDesc,image:"/images/left page text, right page image.jpg"},{value:"advanced",label:w.advanced,desc:w.advancedDesc,image:"/images/dense text left.jpg"}],R=(l,a=!1)=>{const V=a?" (Test)":"";if(u==="1st-grade")return`${l} ${y==="de"?"Seiten":"pages"}${V}`;const D=l/2,K=l/2;return y==="de"?`${l} Seiten (${D} Text + ${K} Bilder)${V}`:y==="fr"?`${l} pages (${D} texte + ${K} images)${V}`:`${l} pages (${D} text + ${K} images)${V}`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Xt,{size:24})," ",w.storySettings]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:w.selectMainCharacters}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:t.map(l=>e.jsx("button",{onClick:()=>x(l.id),className:`p-4 rounded-lg border-2 transition-all text-left ${i.includes(l.id)?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-indigo-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[(l.thumbnailUrl||l.photoUrl)&&e.jsx("img",{src:l.thumbnailUrl||l.photoUrl,alt:l.name,className:"w-12 h-12 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-bold text-base flex items-center gap-2",children:[l.name,e.jsx("span",{className:i.includes(l.id)?"inline-block":"hidden",children:e.jsx(Zt,{size:16,className:"text-indigo-600"})})]}),e.jsxs("div",{className:"text-sm md:text-base text-gray-500",children:[l.gender==="male"?w.male:l.gender==="female"?w.female:w.other,", ",l.age]})]})]})},l.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:w.readingLevel}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:P.map(l=>e.jsxs("button",{onClick:()=>n(l.value),className:`text-left rounded-lg border-2 transition-all overflow-hidden ${u===l.value?"border-indigo-600 ring-2 ring-indigo-200":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"w-full bg-gray-100 p-2",children:e.jsx("img",{src:l.image,alt:l.label,className:"w-full h-auto object-contain"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"font-semibold text-base",children:l.label}),e.jsx("div",{className:"text-sm text-gray-500",children:l.desc})]})]},l.value))})]}),u&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:w.numberOfPages}),e.jsx("select",{value:f,onChange:l=>N(parseInt(l.target.value)),className:"w-full px-4 py-3 border-2 border-indigo-200 rounded-lg focus:border-indigo-600 focus:outline-none text-base md:text-lg font-semibold",children:F.map(l=>e.jsx("option",{value:l,children:R(l,l===10)},l))}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:u==="1st-grade"?y==="de"?"Jede Seite enth√§lt ein Bild mit Text darunter":y==="fr"?"Chaque page contient une image avec du texte en dessous":"Each page contains an image with text below":y==="de"?"Abwechselnd Textseite und Bildseite":y==="fr"?"Alternance de pages de texte et d'images":"Alternating text page and image page"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-2",children:w.storyDetails}),e.jsx("textarea",{value:z,onChange:l=>S(l.target.value),placeholder:w.storyDetailsPlaceholder,className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-base",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-2",children:y==="de"?"Widmung (Optional)":y==="fr"?"D√©dicace (Facultatif)":"Dedication (Optional)"}),e.jsx("textarea",{value:d,onChange:l=>g(l.target.value),placeholder:y==="de"?'z.B. "F√ºr meine liebe Tochter Emma zum 5. Geburtstag"':y==="fr"?'Par exemple "Pour ma ch√®re fille Emma pour son 5√®me anniversaire"':'e.g. "For my dear daughter Emma on her 5th birthday"',className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-base",rows:2,maxLength:200}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:y==="de"?"Dieser Text wird auf Seite 0 Ihres Buches gedruckt. Wenn Sie nichts eingeben, wird Seite 0 nur eine Illustration ohne Text enthalten.":y==="fr"?"Ce texte sera imprim√© sur la page 0 de votre livre. Si vous ne saisissez rien, la page 0 ne contiendra qu'une illustration sans texte.":"This text will be printed on page 0 of your book. If you leave it empty, page 0 will contain only an illustration with no text."})]}),p&&e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-base font-bold text-gray-800 mb-3 flex items-center gap-2",children:["üõ†Ô∏è ",y==="de"?"Entwickler-Optionen":y==="fr"?"Options d√©veloppeur":"Developer Options"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:y==="de"?"Bildgenerierungsmodus":y==="fr"?"Mode de g√©n√©ration d'images":"Image Generation Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k==null?void 0:k(null),className:`px-3 py-2 rounded-lg text-sm font-medium ${C===null?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:y==="de"?"Server-Standard":y==="fr"?"Par d√©faut serveur":"Server Default"}),e.jsx("button",{onClick:()=>k==null?void 0:k("parallel"),className:`px-3 py-2 rounded-lg text-sm font-medium ${C==="parallel"?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:y==="de"?"Parallel (schnell)":y==="fr"?"Parall√®le (rapide)":"Parallel (fast)"}),e.jsx("button",{onClick:()=>k==null?void 0:k("sequential"),className:`px-3 py-2 rounded-lg text-sm font-medium ${C==="sequential"?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:y==="de"?"Sequenziell (konsistent)":y==="fr"?"S√©quentiel (coh√©rent)":"Sequential (consistent)"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:y==="de"?"Parallel = alle Bilder gleichzeitig. Sequenziell = jedes Bild basiert auf dem vorherigen.":y==="fr"?"Parall√®le = toutes les images simultan√©ment. S√©quentiel = chaque image bas√©e sur la pr√©c√©dente.":"Parallel = all images at once. Sequential = each image based on previous one."})]})]})]})]})}function os({characters:t,showSuccessMessage:i,onEdit:x,onDelete:u,onCreateAnother:n,onContinue:f}){const{t:N,language:d}=H();return t.length===0?null:e.jsxs("div",{className:"space-y-4",children:[i&&e.jsx("div",{className:"md:bg-green-50 md:border-2 md:border-green-400 md:rounded-xl p-4 animate-fade-in",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center",children:e.jsx(Wt,{size:20})}),e.jsx("h3",{className:"text-lg font-bold text-green-700",children:d==="de"?"Charakter erfolgreich erstellt!":d==="fr"?"Personnage cre avec succes!":"Character Created Successfully!"})]})}),e.jsxs("div",{className:"bg-white border-2 border-indigo-200 rounded-lg p-3",children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-2",children:N.yourCharacters}),e.jsx("div",{className:"grid md:grid-cols-2 gap-2",children:t.map(g=>e.jsxs("div",{className:"border border-gray-200 rounded p-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(g.thumbnailUrl||g.photoUrl)&&e.jsx("img",{src:g.thumbnailUrl||g.photoUrl,alt:g.name,className:"w-12 h-12 md:w-16 md:h-16 rounded-full object-cover border-2 border-indigo-200 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-bold text-sm md:text-base truncate",children:g.name}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-500",children:[g.gender==="male"?N.male:g.gender==="female"?N.female:N.other,","," ",g.age," ",d==="de"?"J":d==="fr"?"ans":"y"]})]})]}),e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>x(g),className:"bg-indigo-600 text-white px-2 md:px-3 py-1 rounded text-xs hover:bg-indigo-700 flex items-center gap-1",children:[e.jsx(Mt,{size:12}),N.editCharacter]}),e.jsxs("button",{onClick:()=>u(g.id),className:"bg-red-500 text-white px-2 md:px-3 py-1 rounded text-xs hover:bg-red-600 flex items-center gap-1",children:[e.jsx(Ht,{size:12}),N.deleteCharacter]})]})]}),g.strengths&&g.strengths.length>0&&e.jsxs("p",{className:"text-xs text-gray-800 mb-1",children:[e.jsxs("strong",{className:"text-green-600",children:[N.strengths,":"]})," ",g.strengths.join(", ")]}),g.flaws&&g.flaws.length>0&&e.jsxs("p",{className:"text-xs text-gray-800 mb-1",children:[e.jsxs("strong",{className:"text-orange-600",children:[d==="de"?"Schw√§chen":d==="fr"?"D√©fauts":"Flaws",":"]})," ",g.flaws.join(", ")]}),g.challenges&&g.challenges.length>0&&e.jsxs("p",{className:"text-xs text-gray-800 mb-1",children:[e.jsxs("strong",{className:"text-purple-600",children:[d==="de"?"Herausforderungen":d==="fr"?"D√©fis":"Challenges",":"]})," ",g.challenges.join(", ")]})]},g.id))})]}),e.jsxs("div",{className:"md:bg-indigo-50 md:border-2 md:border-indigo-200 md:rounded-lg p-4",children:[e.jsx("p",{className:"text-gray-800 mb-4 text-center font-semibold",children:d==="de"?"Was mochten Sie als Nachstes tun?":d==="fr"?"Que voulez-vous faire ensuite?":"What would you like to do next?"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx("button",{onClick:n,className:"bg-indigo-500 text-white px-6 py-3 rounded-lg hover:bg-indigo-600 font-semibold flex items-center justify-center gap-2 transition-colors",children:d==="de"?"Weiteren Charakter erstellen":d==="fr"?"Creer un autre personnage":"Create Another Character"}),e.jsx("button",{onClick:f,className:"bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 font-semibold flex items-center justify-center gap-2 transition-colors",children:d==="de"?"Weiter zu Beziehungen":d==="fr"?"Continuer vers les relations":"Continue to Relationships"})]})]})]})}function qe({label:t,traits:i,selectedTraits:x,onSelect:u,minRequired:n=0,allowCustom:f=!0}){const{t:N,language:d}=H(),[g,z]=b.useState(""),[S,p]=b.useState([]),C=P=>{x.includes(P)?u(x.filter(R=>R!==P)):u([...x,P])},k=()=>{if(g.trim()&&!x.includes(g.trim())){const P=g.trim();p([...S,P]),u([...x,P]),z("")}},w=x.filter(P=>!i.includes(P)),y=[...new Set([...S,...w])],F=[...i,...y];return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-lg font-semibold mb-2 text-indigo-700",children:[t,n>0&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(",N.selectAtLeast," ",n,")"]}),x.length>0&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["- ",N.selected,": ",x.length]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:F.map(P=>e.jsx("button",{onClick:()=>C(P),className:`px-3 py-1 rounded-full text-sm transition-colors ${x.includes(P)?"bg-indigo-500 text-white":"bg-gray-200 text-gray-800 hover:bg-gray-300"}`,children:P},P))}),f&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:g,onChange:P=>z(P.target.value),onKeyDown:P=>P.key==="Enter"&&k(),placeholder:d==="de"?"Eigene hinzuf√ºgen...":d==="fr"?"Ajouter personnalis√©...":"Add custom...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-indigo-500 focus:outline-none"}),e.jsx("button",{onClick:k,disabled:!g.trim(),className:`px-4 py-2 rounded-lg font-semibold flex items-center gap-1 transition-colors ${g.trim()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:e.jsx(we,{size:16})})]})]})}const ds={en:["Brave","Smart","Kind","Strong","Fast","Creative","Funny","Leader","Helpful","Patient","Honest","Loyal","Curious","Determined","Caring","Confident","Cheerful","Generous","Clever","Adventurous","Resourceful","Protective","Imaginative","Hardworking","Trustworthy"],de:["Mutig","Klug","Freundlich","Stark","Schnell","Kreativ","Lustig","F√ºhrungspers√∂nlichkeit","Hilfsbereit","Geduldig","Ehrlich","Treu","Neugierig","Entschlossen","F√ºrsorglich","Selbstbewusst","Fr√∂hlich","Grossz√ºgig","Schlau","Abenteuerlustig","Einfallsreich","Besch√ºtzend","Fantasievoll","Fleissig","Vertrauensw√ºrdig"],fr:["Courageux","Intelligent","Gentil","Fort","Rapide","Cr√©atif","Dr√¥le","Leader","Serviable","Patient","Honn√™te","Loyal","Curieux","D√©termin√©","Attentionn√©","Confiant","Joyeux","G√©n√©reux","Astucieux","Aventureux","D√©brouillard","Protecteur","Imaginatif","Travailleur","Digne de confiance"]},cs={en:["Shy","Clumsy","Impatient","Forgetful","Messy","Talkative","Stubborn","Lazy","Greedy","Jealous","Anxious","Distracted","Reckless","Bossy","Easily scared","Too trusting","Perfectionist","Indecisive","Secretive","Boastful","Quick-tempered","Careless","Overly cautious","Selfish"],de:["Sch√ºchtern","Tollpatschig","Ungeduldig","Vergesslich","Unordentlich","Gespr√§chig","Stur","Faul","Gierig","Eifers√ºchtig","√Ñngstlich","Abgelenkt","Leichtsinnig","Herrschs√ºchtig","Leicht √§ngstlich","Zu vertrauensvoll","Perfektionist","Unentschlossen","Verschlossen","Prahlerisch","J√§hzornig","Nachl√§ssig","√úbervorsichtig","Egoistisch"],fr:["Timide","Maladroit","Impatient","Distrait","D√©sordonn√©","Bavard","T√™tu","Paresseux","Avide","Jaloux","Anxieux","Distrait","Imprudent","Autoritaire","Facilement effray√©","Trop confiant","Perfectionniste","Ind√©cis","Secret","Vantard","Col√©rique","N√©gligent","Trop prudent","√âgo√Øste"]},ms={en:["Fear of heights","Fear of spiders","Fear of the dark","Fear of being alone","Fear of loud noises","Making new friends","Speaking in public","Trying new things","Accepting help","Dealing with change","Standing up for oneself","Sharing with others","Following rules","Controlling emotions","Asking for help"],de:["H√∂henangst","Angst vor Spinnen","Angst vor der Dunkelheit","Angst allein zu sein","Angst vor lauten Ger√§uschen","Neue Freunde finden","Vor anderen sprechen","Neues ausprobieren","Hilfe annehmen","Mit Ver√§nderungen umgehen","F√ºr sich einstehen","Mit anderen teilen","Regeln befolgen","Gef√ºhle kontrollieren","Um Hilfe bitten"],fr:["Peur du vide","Peur des araign√©es","Peur du noir","Peur d'√™tre seul","Peur des bruits forts","Se faire de nouveaux amis","Parler en public","Essayer de nouvelles choses","Accepter de l'aide","G√©rer le changement","Se d√©fendre","Partager avec les autres","Suivre les r√®gles","Contr√¥ler ses √©motions","Demander de l'aide"]},ct=ds,mt=cs,ut=ms;function gt({character:t,onChange:i,onSave:x,onCancel:u,onPhotoChange:n,onContinueToTraits:f,isLoading:N,isAnalyzingPhoto:d,step:g,developerMode:z}){const{t:S,language:p}=H(),C=l=>{var V;const a=(V=l.target.files)==null?void 0:V[0];a&&n(a)},k=(l,a)=>{i({...t,[l]:a})},w=t.name&&t.name.trim().length>=2,y=t.name&&t.strengths&&t.strengths.length>=3&&t.flaws&&t.flaws.length>=2,F=ct[p]||ct.en,P=mt[p]||mt.en,R=ut[p]||ut.en;return g==="name"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[d?e.jsx("div",{className:"w-32 h-32 rounded-full bg-indigo-100 border-4 border-indigo-400 shadow-lg flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-3 border-indigo-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-indigo-600 font-medium",children:p==="de"?"Analysiere...":p==="fr"?"Analyse...":"Analyzing..."})]})}):t.photoUrl?e.jsx("img",{src:t.photoUrl,alt:"Character",className:"w-32 h-32 rounded-full object-cover border-4 border-indigo-400 shadow-lg"}):e.jsx("div",{className:"w-32 h-32 rounded-full bg-gray-200 border-4 border-gray-300 flex items-center justify-center",children:e.jsx(ee,{size:32,className:"text-gray-400"})}),e.jsxs("label",{className:"cursor-pointer bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm hover:bg-gray-300 flex items-center gap-2 font-semibold transition-colors",children:[e.jsx(ee,{size:16}),p==="de"?"Anderes Foto":p==="fr"?"Autre photo":"Change Photo",e.jsx("input",{type:"file",accept:"image/*",onChange:C,className:"hidden"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold mb-2 text-center",children:p==="de"?"Wie heisst diese Person?":p==="fr"?"Comment s'appelle cette personne?":"What is this person's name?"}),e.jsx("input",{type:"text",value:t.name,onChange:l=>k("name",l.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg text-center focus:border-indigo-500 focus:outline-none",placeholder:S.characterName,autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[u&&e.jsx("button",{onClick:u,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:S.cancel}),e.jsx(ve,{onClick:f,disabled:!w||N,loading:N,icon:bt,className:u?"flex-1":"w-full",children:p==="de"?"Weiter":p==="fr"?"Continuer":"Continue"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex-shrink-0 relative group cursor-pointer",children:[d?e.jsx("div",{className:"w-20 h-20 rounded-full bg-indigo-100 border-2 border-indigo-400 flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"})}):t.photoUrl?e.jsx("img",{src:t.photoUrl,alt:t.name,className:"w-20 h-20 rounded-full object-cover border-2 border-indigo-400"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-200 border-2 border-gray-300 flex items-center justify-center",children:e.jsx(ee,{size:24,className:"text-gray-400"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ee,{size:20,className:"text-white"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-indigo-600 text-white rounded-full p-1.5 shadow-lg border-2 border-white",children:e.jsx(ee,{size:12})}),e.jsx("input",{type:"file",accept:"image/*",onChange:C,className:"hidden"})]}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:t.name})]}),z&&t.bodyNoBgUrl&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-300 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-700 mb-2",children:"üõ†Ô∏è Developer Mode: Body Crop (No Background)"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:t.bodyNoBgUrl,alt:`${t.name} body crop`,className:"max-h-48 object-contain rounded border border-gray-300",style:{background:"repeating-conic-gradient(#ccc 0% 25%, #fff 0% 50%) 50% / 20px 20px"}})})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-600 mb-3",children:p==="de"?"Erkannte Eigenschaften (bearbeitbar)":p==="fr"?"Caract√©ristiques d√©tect√©es (modifiables)":"Detected Features (editable)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:S.gender}),e.jsxs("select",{value:t.gender,onChange:l=>k("gender",l.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm bg-white focus:border-indigo-500 focus:outline-none",children:[e.jsx("option",{value:"male",children:S.male}),e.jsx("option",{value:"female",children:S.female}),e.jsx("option",{value:"other",children:S.other})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:S.age}),e.jsx("input",{type:"number",value:t.age,onChange:l=>k("age",l.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:border-indigo-500 focus:outline-none",min:"1",max:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:p==="de"?"Gr√∂sse (cm)":p==="fr"?"Taille (cm)":"Height (cm)"}),e.jsx("input",{type:"number",value:t.height||"",onChange:l=>k("height",l.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:border-indigo-500 focus:outline-none",placeholder:"cm",min:"50",max:"250"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:p==="de"?"K√∂rperbau":p==="fr"?"Corpulence":"Build"}),e.jsxs("select",{value:t.build||"",onChange:l=>k("build",l.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm bg-white focus:border-indigo-500 focus:outline-none",children:[e.jsx("option",{value:"",children:p==="de"?"W√§hlen...":p==="fr"?"Choisir...":"Select..."}),e.jsx("option",{value:"slim",children:p==="de"?"Schlank":p==="fr"?"Mince":"Slim"}),e.jsx("option",{value:"average",children:p==="de"?"Durchschnittlich":p==="fr"?"Moyenne":"Average"}),e.jsx("option",{value:"athletic",children:p==="de"?"Athletisch":p==="fr"?"Athl√©tique":"Athletic"}),e.jsx("option",{value:"chubby",children:p==="de"?"Mollig":p==="fr"?"Potel√©":"Chubby"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:S.hairColor}),e.jsx("input",{type:"text",value:t.hairColor||"",onChange:l=>k("hairColor",l.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:border-indigo-500 focus:outline-none",placeholder:p==="de"?"z.B. braun, blond":p==="fr"?"ex. brun, blond":"e.g. brown, blonde"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:S.otherFeatures}),e.jsx("input",{type:"text",value:t.otherFeatures||"",onChange:l=>k("otherFeatures",l.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:border-indigo-500 focus:outline-none",placeholder:p==="de"?"Brille, Bart, etc.":p==="fr"?"Lunettes, barbe, etc.":"Glasses, beard, etc."})]})]})]}),e.jsx(qe,{label:S.strengths,traits:F,selectedTraits:t.strengths||[],onSelect:l=>k("strengths",l),minRequired:3}),e.jsx(qe,{label:p==="de"?"Schw√§chen":p==="fr"?"D√©fauts":"Flaws",traits:P,selectedTraits:t.flaws||[],onSelect:l=>k("flaws",l),minRequired:2}),e.jsx(qe,{label:p==="de"?"Konflikte / Herausforderungen":p==="fr"?"Conflits / D√©fis":"Conflicts / Challenges",traits:R,selectedTraits:t.challenges||[],onSelect:l=>k("challenges",l)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold mb-2",children:S.specialDetails}),e.jsx("textarea",{value:t.specialDetails||"",onChange:l=>k("specialDetails",l.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none",placeholder:S.specialDetailsPlaceholder,rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[u&&e.jsx("button",{onClick:u,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:S.cancel}),e.jsx(ve,{onClick:x,disabled:!y||N,loading:N,icon:Gt,className:u?"flex-1":"w-full",children:S.saveCharacter})]}),!y&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:p==="de"?"Bitte mindestens 3 St√§rken und 2 Schw√§chen w√§hlen":p==="fr"?"Veuillez s√©lectionner au moins 3 forces et 2 d√©fauts":"Please select at least 3 strengths and 2 flaws"})]})}function us({onPhotoSelect:t,showExamples:i=!0}){const{t:x,language:u}=H(),n=f=>{var d;const N=(d=f.target.files)==null?void 0:d[0];N&&t(N)};return e.jsxs("div",{className:"bg-indigo-50 border-2 border-indigo-300 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-indigo-700 mb-4 text-center",children:x.uploadPhotoFirst}),e.jsx("div",{className:"text-center mb-5",children:e.jsxs("label",{className:"cursor-pointer inline-flex items-center justify-center gap-3 bg-indigo-600 text-white px-10 py-4 rounded-xl text-xl hover:bg-indigo-700 font-bold shadow-lg transition-colors",children:[e.jsx(ee,{size:28})," ",x.uploadPhoto,e.jsx("input",{type:"file",accept:"image/*",onChange:n,className:"hidden"})]})}),i&&e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/Full body.jpg",alt:"Full body example",className:"w-full md:max-h-32 object-contain rounded border-2 border-green-400 mb-1"}),e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["‚úì ",u==="de"?"Ganzk√∂rper":u==="fr"?"Corps entier":"Full body"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/Upper body.jpg",alt:"Upper body example",className:"w-full md:max-h-32 object-contain rounded border-2 border-green-400 mb-1"}),e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["‚úì ",u==="de"?"Oberk√∂rper":u==="fr"?"Buste":"Upper body"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/No zoomed in close up.jpg",alt:"Too close example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsxs("span",{className:"text-xs text-red-600 font-medium",children:["‚úó ",u==="de"?"Nahaufnahme/Unscharf":u==="fr"?"Gros plan/Flou":"Close-up/Blurry"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/No sunglasses, hat or helmets.jpg",alt:"No accessories example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsxs("span",{className:"text-xs text-red-600 font-medium",children:["‚úó ",u==="de"?"Brille/Hut/Helm":u==="fr"?"Lunettes/Chapeau":"Glasses/Hat/Helmet"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/One person not many.jpg",alt:"One person only example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsxs("span",{className:"text-xs text-red-600 font-medium",children:["‚úó ",u==="de"?"Eine Person, nicht viele":u==="fr"?"Une personne, pas plusieurs":"One person, not many"]})]})]})})]})}function gs(t,i){var n;if(!t)return"";const x={"Generating picture book story and scenes...":{de:"Geschichte und Szenen werden erstellt...",fr:"Cr√©ation de l'histoire et des sc√®nes..."},"Story text complete.":{de:"Geschichte fertig.",fr:"Texte termin√©."},"images already generating...":{de:"Bilder werden bereits generiert...",fr:"images en cours de g√©n√©ration..."},"Generated image":{de:"Bild erstellt",fr:"Image g√©n√©r√©e"},"Generating cover images...":{de:"Cover-Bilder werden erstellt...",fr:"Cr√©ation des images de couverture..."},"Picture book complete!":{de:"Bilderbuch fertig!",fr:"Livre d'images termin√©!"},"Complete!":{de:"Fertig!",fr:"Termin√©!"}};if(i==="en")return t;if((n=x[t])!=null&&n[i])return x[t][i];let u=t;for(const[f,N]of Object.entries(x))t.includes(f)&&N[i]&&(u=u.replace(f,N[i]));return u}function xs({current:t,total:i,message:x,isGenerating:u=!0}){const{language:n}=H(),{user:f}=pt(),N=!!(f!=null&&f.email);if(!u||i===0)return null;const d=i===100?t:Math.round(t/i*100),g=gs(x||"",n),z={en:{title:"Creating Your Story!",timeInfo:"This typically takes about 10 minutes.",emailInfo:"You will receive an email when ready.",noEmailInfo:"You can close this page and come back later."},de:{title:"Geschichte wird erstellt!",timeInfo:"Dies dauert normalerweise etwa 10 Minuten.",emailInfo:"Du erh√§ltst eine E-Mail wenn die Geschichte bereit ist.",noEmailInfo:"Du kannst diese Seite schlie√üen und sp√§ter zur√ºckkommen."},fr:{title:"Cr√©ation de votre histoire!",timeInfo:"Cela prend g√©n√©ralement environ 10 minutes.",emailInfo:"Vous recevrez un email quand ce sera pr√™t.",noEmailInfo:"Vous pouvez fermer cette page et revenir plus tard."}},S=z[n]||z.en;return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"relative inline-block mb-3",children:[e.jsx(Ot,{size:48,className:"animate-spin text-indigo-600"}),e.jsx("span",{className:"absolute -top-1 -right-1 text-xl",children:"‚ú®"})]}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-800",children:S.title})]}),e.jsx("div",{className:"mb-4",children:e.jsx(ts,{value:d,max:100,showPercentage:!0,size:"lg"})}),g&&e.jsx("p",{className:"text-indigo-600 text-sm text-center font-medium mb-4",children:g}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(Kt,{size:16,className:"text-gray-500 shrink-0"}),e.jsx("p",{className:"text-sm",children:S.timeInfo})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(Qt,{size:16,className:"text-gray-500 shrink-0"}),e.jsx("p",{className:"text-sm",children:N?e.jsxs(e.Fragment,{children:[S.emailInfo," ",e.jsxs("span",{className:"text-gray-500",children:["(",f==null?void 0:f.email,")"]})]}):S.noEmailInfo})]})]})]})})}function hs({title:t,story:i,outline:x,sceneImages:u,sceneDescriptions:n=[],coverImages:f,languageLevel:N="standard",isGenerating:d=!1,onDownloadPdf:g,onBuyBook:z,onPrintBook:S,onCreateAnother:p,onDownloadTxt:C,onRegenerateImage:k,onRegenerateCover:w,onEditImage:y,onEditCover:F,storyId:P,developerMode:R=!1}){const{t:l,language:a}=H(),V=N==="1st-grade",K=(m=>m?m.split(/(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i).slice(1).filter(A=>A.trim().length>0):[])(i),E=u.length>0,T=m=>m?typeof m=="string"?m:m.imageData||null:null,te=m=>m?typeof m=="string"?{imageData:m}:m:null,Q=m=>{var v;const W=(v=n.find(U=>U.pageNumber===m))==null?void 0:v.description;if(W)return W;const A=u.find(U=>U.pageNumber===m);return A==null?void 0:A.description};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center flex-wrap gap-3",children:e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(je,{size:24})," ",l.yourStory]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[R&&C&&e.jsxs("button",{onClick:C,className:"bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 font-semibold flex items-center justify-center gap-2",children:[e.jsx(Vt,{size:20})," ",l.downloadTXT]}),E&&g&&e.jsxs("button",{onClick:g,disabled:d,className:`bg-green-500 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${d?"opacity-50 cursor-not-allowed":"hover:bg-green-600"}`,children:[e.jsx(Ue,{size:20})," ",a==="de"?"PDF herunterladen":a==="fr"?"T√©l√©charger PDF":"Download PDF"]}),E&&P&&z&&e.jsxs("button",{onClick:z,disabled:d,className:`bg-indigo-500 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ot,{size:20})," ",a==="de"?"Buch kaufen (CHF 36)":a==="fr"?"Acheter le livre (CHF 36)":"Buy Book (CHF 36)"]}),R&&E&&P&&S&&e.jsxs("button",{onClick:S,disabled:d,className:`bg-yellow-500 text-black px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${d?"opacity-50 cursor-not-allowed":"hover:bg-yellow-600"}`,children:[e.jsx(je,{size:20})," ",a==="de"?"Buch drucken (DEV)":a==="fr"?"Imprimer livre (DEV)":"Print Book (DEV)"]}),p&&e.jsxs("button",{onClick:p,disabled:d,className:`bg-indigo-500 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 sm:col-span-2 lg:col-span-1 ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(we,{size:20})," ",l.createAnotherStory]})]}),R&&e.jsxs("div",{className:"space-y-4 mt-6",children:[x&&e.jsxs("details",{className:"bg-purple-50 border-2 border-purple-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-purple-800 hover:text-purple-900 flex items-center gap-2",children:[e.jsx(Ue,{size:20}),a==="de"?"Story-√úbersicht (Outline)":a==="fr"?"Aper√ßu de l'histoire":"Story Overview (Outline)"]}),e.jsx("pre",{className:"mt-4 text-sm text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-96 overflow-y-auto",children:x})]}),i&&e.jsxs("details",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(je,{size:20}),a==="de"?"Vollst√§ndiger Story-Text":a==="fr"?"Texte complet de l'histoire":"Full Story Text"]}),e.jsx("pre",{className:"mt-4 text-sm text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-96 overflow-y-auto",children:i})]})]}),f&&(T(f.frontCover)||T(f.initialPage)||T(f.backCover))&&e.jsxs("div",{className:"bg-indigo-50 border-2 border-indigo-200 rounded-xl p-6 mt-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(je,{size:24})," ",a==="de"?"Buchcover":a==="fr"?"Couvertures":"Book Covers"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[T(f.frontCover)&&(()=>{const m=te(f.frontCover);return e.jsxs("div",{className:"bg-white border-2 border-indigo-300 rounded-lg p-4 shadow-lg",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-800 mb-3",children:a==="de"?"Titelseite":a==="fr"?"Couverture":"Front Cover"}),e.jsx("img",{src:T(f.frontCover),alt:"Front Cover",className:"w-full rounded-lg shadow-md"}),R&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[w&&e.jsxs("button",{onClick:()=>w("front"),disabled:d,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(le,{size:14})," ",a==="de"?"Neu":"Regen"]}),F&&e.jsxs("button",{onClick:()=>F("front"),disabled:d,className:`flex-1 bg-gray-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-gray-600"}`,children:[e.jsx(de,{size:14})," ",a==="de"?"Bearbeiten":"Edit"]})]}),(m==null?void 0:m.description)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800",children:a==="de"?"Szenenbeschreibung":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border overflow-x-auto",children:m.description})]}),(m==null?void 0:m.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800",children:a==="de"?"API-Prompt":"API Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border overflow-x-auto max-h-48 overflow-y-auto",children:m.prompt})]}),(m==null?void 0:m.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 flex items-center justify-between",children:[e.jsx("span",{children:a==="de"?"Qualit√§t":"Quality"}),e.jsxs("span",{className:`text-lg font-bold ${m.qualityScore>=70?"text-green-600":m.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(m.qualityScore),"%"]})]}),m.qualityReasoning&&e.jsx("div",{className:"mt-2 text-xs bg-white p-3 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:m.qualityReasoning})})]})]})]})})(),T(f.initialPage)&&(()=>{const m=te(f.initialPage);return e.jsxs("div",{className:"bg-white border-2 border-indigo-300 rounded-lg p-4 shadow-lg",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-800 mb-3",children:a==="de"?"Einleitungsseite":a==="fr"?"Page d'introduction":"Initial Page"}),e.jsx("img",{src:T(f.initialPage),alt:"Initial Page",className:"w-full rounded-lg shadow-md"}),R&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[w&&e.jsxs("button",{onClick:()=>w("initial"),disabled:d,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(le,{size:14})," ",a==="de"?"Neu":"Regen"]}),F&&e.jsxs("button",{onClick:()=>F("initial"),disabled:d,className:`flex-1 bg-gray-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-gray-600"}`,children:[e.jsx(de,{size:14})," ",a==="de"?"Bearbeiten":"Edit"]})]}),(m==null?void 0:m.description)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800",children:a==="de"?"Szenenbeschreibung":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border overflow-x-auto",children:m.description})]}),(m==null?void 0:m.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800",children:a==="de"?"API-Prompt":"API Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border overflow-x-auto max-h-48 overflow-y-auto",children:m.prompt})]}),(m==null?void 0:m.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 flex items-center justify-between",children:[e.jsx("span",{children:a==="de"?"Qualit√§t":"Quality"}),e.jsxs("span",{className:`text-lg font-bold ${m.qualityScore>=70?"text-green-600":m.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(m.qualityScore),"%"]})]}),m.qualityReasoning&&e.jsx("div",{className:"mt-2 text-xs bg-white p-3 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:m.qualityReasoning})})]})]})]})})(),T(f.backCover)&&(()=>{const m=te(f.backCover);return e.jsxs("div",{className:"bg-white border-2 border-indigo-300 rounded-lg p-4 shadow-lg",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-800 mb-3",children:a==="de"?"R√ºckseite":a==="fr"?"Quatri√®me de couverture":"Back Cover"}),e.jsx("img",{src:T(f.backCover),alt:"Back Cover",className:"w-full rounded-lg shadow-md"}),R&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[w&&e.jsxs("button",{onClick:()=>w("back"),disabled:d,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(le,{size:14})," ",a==="de"?"Neu":"Regen"]}),F&&e.jsxs("button",{onClick:()=>F("back"),disabled:d,className:`flex-1 bg-gray-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-gray-600"}`,children:[e.jsx(de,{size:14})," ",a==="de"?"Bearbeiten":"Edit"]})]}),(m==null?void 0:m.description)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800",children:a==="de"?"Szenenbeschreibung":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border overflow-x-auto",children:m.description})]}),(m==null?void 0:m.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800",children:a==="de"?"API-Prompt":"API Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border overflow-x-auto max-h-48 overflow-y-auto",children:m.prompt})]}),(m==null?void 0:m.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 flex items-center justify-between",children:[e.jsx("span",{children:a==="de"?"Qualit√§t":"Quality"}),e.jsxs("span",{className:`text-lg font-bold ${m.qualityScore>=70?"text-green-600":m.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(m.qualityScore),"%"]})]}),m.qualityReasoning&&e.jsx("div",{className:"mt-2 text-xs bg-white p-3 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:m.qualityReasoning})})]})]})]})})()]})]}),E&&i&&e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 text-center mb-6",children:t||(a==="de"?"Ihre Geschichte":a==="fr"?"Votre histoire":"Your Story")}),K.map((m,W)=>{const A=W+1,v=u.find(U=>U.pageNumber===A);return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-4 text-center",children:a==="de"?`Seite ${A}`:a==="fr"?`Page ${A}`:`Page ${A}`}),V?e.jsxs("div",{className:"flex flex-col items-center max-w-2xl mx-auto",children:[v&&v.imageData?e.jsxs("div",{className:"w-full mb-4",children:[e.jsx("img",{src:v.imageData,alt:`Scene for page ${A}`,className:"w-full rounded-lg shadow-md object-cover"}),R&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[k&&e.jsxs("button",{onClick:()=>k(A),disabled:d,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(le,{size:14})," ",a==="de"?"Neu generieren":"Regenerate"]}),y&&e.jsxs("button",{onClick:()=>y(A),disabled:d,className:`flex-1 bg-gray-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-gray-600"}`,children:[e.jsx(de,{size:14})," ",a==="de"?"Bearbeiten":"Edit"]})]}),Q(A)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:a==="de"?"Szenenbeschreibung":a==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Q(A)})]}),v.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:a==="de"?"API-Prompt":a==="fr"?"Prompt API":"API Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:v.prompt})]}),v.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsx("span",{children:a==="de"?"Qualit√§tsbewertung":a==="fr"?"Score de qualit√©":"Quality Score"}),e.jsxs("span",{className:`text-lg font-bold ${v.qualityScore>=70?"text-green-600":v.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(v.qualityScore),"%"]})]}),v.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:a==="de"?"Feedback:":a==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:v.qualityReasoning})]})]}),v.wasRegenerated&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["üîÑ ",a==="de"?"Bild regeneriert":a==="fr"?"Image r√©g√©n√©r√©e":"Image Regenerated"]}),v.originalScore!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(v.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:a==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige Qualit√§t hatte.":a==="fr"?"L'image a √©t√© automatiquement r√©g√©n√©r√©e car la premi√®re version avait une qualit√© faible.":"Image was automatically regenerated because the first version had low quality."}),v.originalImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:a==="de"?"Originalbild:":a==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:v.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),v.originalReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:a==="de"?"Original Feedback:":a==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:v.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:"w-full flex items-center justify-center bg-gray-100 rounded-lg p-8 mb-4",children:e.jsx("p",{className:"text-gray-500 text-center",children:a==="de"?"Kein Bild f√ºr diese Seite":a==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"w-full bg-indigo-50 rounded-lg p-6 border-2 border-indigo-200",children:e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl text-center",children:m.trim()})})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[v&&v.imageData?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("img",{src:v.imageData,alt:`Scene for page ${A}`,className:"w-full rounded-lg shadow-md object-cover"}),R&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[k&&e.jsxs("button",{onClick:()=>k(A),disabled:d,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(le,{size:14})," ",a==="de"?"Neu generieren":"Regenerate"]}),y&&e.jsxs("button",{onClick:()=>y(A),disabled:d,className:`flex-1 bg-gray-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${d?"opacity-50 cursor-not-allowed":"hover:bg-gray-600"}`,children:[e.jsx(de,{size:14})," ",a==="de"?"Bearbeiten":"Edit"]})]}),Q(A)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:a==="de"?"Szenenbeschreibung":a==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Q(A)})]}),v.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:a==="de"?"API-Prompt":a==="fr"?"Prompt API":"API Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:v.prompt})]}),v.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsx("span",{children:a==="de"?"Qualit√§tsbewertung":a==="fr"?"Score de qualit√©":"Quality Score"}),e.jsxs("span",{className:`text-lg font-bold ${v.qualityScore>=70?"text-green-600":v.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(v.qualityScore),"%"]})]}),v.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:a==="de"?"Feedback:":a==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:v.qualityReasoning})]})]}),v.wasRegenerated&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["üîÑ ",a==="de"?"Bild regeneriert":a==="fr"?"Image r√©g√©n√©r√©e":"Image Regenerated"]}),v.originalScore!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(v.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:a==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige Qualit√§t hatte.":a==="fr"?"L'image a √©t√© automatiquement r√©g√©n√©r√©e car la premi√®re version avait une qualit√© faible.":"Image was automatically regenerated because the first version had low quality."}),v.originalImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:a==="de"?"Originalbild:":a==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:v.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),v.originalReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:a==="de"?"Original Feedback:":a==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:v.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg p-8",children:e.jsx("p",{className:"text-gray-500 text-center",children:a==="de"?"Kein Bild f√ºr diese Seite":a==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl",children:m.trim()})})})]})]},A)})]}),E&&i&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-6 mt-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4 text-center",children:a==="de"?"Was m√∂chten Sie als N√§chstes tun?":a==="fr"?"Que souhaitez-vous faire ensuite ?":"What would you like to do next?"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[g&&e.jsxs("button",{onClick:g,disabled:d,className:`bg-green-500 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${d?"opacity-50 cursor-not-allowed":"hover:bg-green-600"}`,children:[e.jsx(Ue,{size:20})," ",a==="de"?"PDF herunterladen":a==="fr"?"T√©l√©charger PDF":"Download PDF"]}),P&&z&&e.jsxs("button",{onClick:z,disabled:d,className:`bg-indigo-500 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ot,{size:20})," ",a==="de"?"Buch kaufen (CHF 36)":a==="fr"?"Acheter le livre (CHF 36)":"Buy Book (CHF 36)"]}),p&&e.jsxs("button",{onClick:p,disabled:d,className:`bg-indigo-500 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${d?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(we,{size:20})," ",l.createAnotherStory]})]})]})]})}const ps={async login(t,i){const x=await M.post("/api/auth/login",{username:t,password:i},{skipAuth:!0}),u={id:x.user.id,username:x.user.username,email:x.user.email,role:x.user.role,storyQuota:x.user.story_quota,storiesGenerated:x.user.stories_generated};return{token:x.token,user:u}},async register(t,i,x){return M.post("/api/auth/register",{username:t,password:i,email:x},{skipAuth:!0})},async loginWithFirebase(t){const i=await M.post("/api/auth/firebase",{idToken:t},{skipAuth:!0}),x={id:i.user.id,username:i.user.username,email:i.user.email,role:i.user.role,storyQuota:i.user.story_quota,storiesGenerated:i.user.stories_generated};return{token:i.token,user:x}},async getQuota(){const t=await M.get("/api/user/quota");return{storyQuota:t.story_quota,storiesGenerated:t.stories_generated,remaining:t.remaining}},async updateEmail(t){await M.put("/api/user/update-email",{email:t})},async getShippingAddress(){try{return await M.get("/api/user/shipping-address")}catch{return null}},async updateShippingAddress(t){await M.put("/api/user/shipping-address",t)}},fs=ft("CharacterService");function xt(t){return{id:t.id,name:t.name,gender:t.gender,age:t.age,height:t.height,build:t.build,hairColor:t.hair_color||t.hairColor,otherFeatures:t.other_features||t.otherFeatures,clothing:t.clothing,specialDetails:t.special_details||t.specialDetails,strengths:t.strengths||[],flaws:t.flaws||t.weaknesses||[],challenges:t.challenges||t.fears||[],weaknesses:t.weaknesses||t.flaws||[],fears:t.fears||t.challenges||[],photoUrl:t.photo_url||t.photoUrl,thumbnailUrl:t.thumbnail_url||t.thumbnailUrl,bodyPhotoUrl:t.body_photo_url||t.bodyPhotoUrl,bodyNoBgUrl:t.body_no_bg_url||t.bodyNoBgUrl,faceBox:t.face_box||t.faceBox,bodyBox:t.body_box||t.bodyBox}}function ht(t){return{id:t.id,name:t.name,gender:t.gender,age:t.age,height:t.height,build:t.build,hair_color:t.hairColor,other_features:t.otherFeatures,clothing:t.clothing,special_details:t.specialDetails,strengths:t.strengths,flaws:t.flaws,challenges:t.challenges,weaknesses:t.flaws||t.weaknesses,fears:t.challenges||t.fears,photo_url:t.photoUrl,thumbnail_url:t.thumbnailUrl,body_photo_url:t.bodyPhotoUrl,body_no_bg_url:t.bodyNoBgUrl,face_box:t.faceBox,body_box:t.bodyBox}}const ce={async getCharacters(){return((await M.get("/api/characters")).characters||[]).map(xt)},async getCharacterData(){const t=await M.get("/api/characters");return{characters:(t.characters||[]).map(xt),relationships:t.relationships||{},relationshipTexts:t.relationshipTexts||{},customRelationships:t.customRelationships||[],customStrengths:t.customStrengths||[],customWeaknesses:t.customWeaknesses||[],customFears:t.customFears||[]}},async saveCharacters(t){await M.post("/api/characters",{characters:t.map(ht)})},async saveCharacterData(t){await M.post("/api/characters",{characters:t.characters.map(ht),relationships:t.relationships,relationshipTexts:t.relationshipTexts,customRelationships:t.customRelationships,customStrengths:t.customStrengths,customWeaknesses:t.customWeaknesses,customFears:t.customFears})},async analyzePhoto(t){try{const i=await M.post("/api/analyze-photo",{imageData:t});return{success:i.success,faceThumbnail:i.faceThumbnail,bodyCrop:i.bodyCrop,bodyNoBg:i.bodyNoBg,faceBox:i.faceBox,bodyBox:i.bodyBox,attributes:i.attributes?{age:i.attributes.age,gender:i.attributes.gender,height:i.attributes.height,build:i.attributes.build,hairColor:i.attributes.hair_color,clothing:i.attributes.clothing,otherFeatures:i.attributes.other_features}:void 0}}catch(i){return fs.error("Photo analysis failed:",i),{success:!1}}}},j=ft("StoryWizard");function Ds(){const t=Ut(),[i,x]=qt(),{t:u,language:n}=H(),{isAuthenticated:f}=pt(),{showSuccess:N,showInfo:d}=_t(),[g,z]=b.useState(()=>new URLSearchParams(window.location.search).get("storyId")?5:1),[S,p]=b.useState(()=>!!new URLSearchParams(window.location.search).get("storyId")),[C,k]=b.useState(!1),[w,y]=b.useState(null),[F,P]=b.useState(""),[R,l]=b.useState("pixar"),[a,V]=b.useState([]),[D,K]=b.useState([]),[E,T]=b.useState(null),[te,Q]=b.useState(!1),[m,W]=b.useState("photo"),[A,v]=b.useState(!1),[U,me]=b.useState({}),[se,Se]=b.useState({}),[ue,Le]=b.useState([]),Ce=b.useRef(null),wt=b.useRef(!1),re=b.useRef(!1),[ae,ge]=b.useState(()=>{try{const s=localStorage.getItem("story_main_characters");return s?JSON.parse(s):[]}catch{return[]}}),[ne,ke]=b.useState(()=>{try{return localStorage.getItem("story_language_level")||"standard"}catch{return"standard"}}),[xe,Me]=b.useState(()=>{try{const s=localStorage.getItem("story_pages");return s?parseInt(s):30}catch{return 30}}),[he,Oe]=b.useState(()=>localStorage.getItem("story_dedication")||""),[pe,Ve]=b.useState(()=>localStorage.getItem("story_details")||""),[Pe,Y]=b.useState(!1),[De,Fe]=b.useState({current:0,total:0,message:""}),[$e,ze]=b.useState(""),[fe,Be]=b.useState(""),[Nt,He]=b.useState(""),[St,Ae]=b.useState([]),[Ct,be]=b.useState([]),[kt,ye]=b.useState({frontCover:null,initialPage:null,backCover:null}),[q,Ie]=b.useState(null),[,We]=b.useState(null);b.useEffect(()=>{f||t("/")},[f,t]),b.useEffect(()=>{(async()=>{const r=i.get("storyId");if(!(!r||!f)){j.info("Loading saved story:",r),p(!0);try{const o=await J.getStory(r);o?(j.info("Loaded story:",o.title),Ie(o.id),ze(o.title||""),P(o.storyType||""),l(o.artStyle||"pixar"),Be(o.story||""),He(o.outline||""),be(o.sceneImages||[]),Ae(o.sceneDescriptions||[]),ye(o.coverImages||{frontCover:null,initialPage:null,backCover:null}),ke(o.languageLevel||"standard"),z(5),Y(!1)):j.error("Story not found:",r)}catch(o){j.error("Failed to load story:",o)}finally{p(!1)}}})()},[i,f]),b.useEffect(()=>{(async()=>{const r=i.get("payment"),o=i.get("session_id");if(r==="success"&&o){j.info("Payment successful! Checking order status..."),j.info("Session ID:",o);try{const h=await J.getOrderStatus(o);if(j.info("Order Status:",h),h.order){const B=`CHF ${(h.order.amount_total/100).toFixed(2)}`,I={en:"Payment Successful!",de:"Zahlung erfolgreich!",fr:"Paiement r√©ussi!"},L={en:"Your book order has been received and will be printed soon.",de:"Ihre Buchbestellung wurde entgegengenommen und wird bald gedruckt.",fr:"Votre commande de livre a √©t√© re√ßue et sera bient√¥t imprim√©e."},$=[`${n==="de"?"Kunde":n==="fr"?"Client":"Customer"}: ${h.order.customer_name}`,`Email: ${h.order.customer_email}`,`${n==="de"?"Betrag":n==="fr"?"Montant":"Amount"}: ${B}`,`${n==="de"?"Versand an":n==="fr"?"Exp√©di√© √†":"Shipping to"}: ${h.order.shipping_name}`,`${h.order.shipping_address_line1}`,`${h.order.shipping_postal_code} ${h.order.shipping_city}`,`${h.order.shipping_country}`];N(L[n]||L.en,I[n]||I.en,$)}}catch(h){j.error("Error checking order status:",h)}const c=new URLSearchParams(i);c.delete("payment"),c.delete("session_id"),x(c,{replace:!0})}else if(r==="cancelled"){j.info("Payment cancelled by user");const c={en:"Payment was cancelled. You can try again when ready.",de:"Zahlung wurde abgebrochen. Sie k√∂nnen es erneut versuchen.",fr:"Paiement annul√©. Vous pouvez r√©essayer quand vous √™tes pr√™t."};d(c[n]||c.en,n==="de"?"Abgebrochen":n==="fr"?"Annul√©":"Cancelled");const h=new URLSearchParams(i);h.delete("payment"),x(h,{replace:!0})}})()},[i,x,n,N,d]);const Ke=s=>{if(s.length===0)return;const r=s.filter(o=>{const c=parseInt(o.age);return c>=1&&c<=10});if(r.length>0){const o=r.map(c=>c.id);ge(o),j.info(`Auto-selected ${r.length} main character(s) aged 1-10`)}else{const o=s.reduce((c,h)=>{const B=parseInt(h.age)||999,I=parseInt(c.age)||999;return B<I?h:c});ge([o.id]),j.info(`Auto-selected youngest character as main: ${o.name} (age ${o.age})`)}};b.useEffect(()=>{f&&(async()=>{try{p(!0);const r=await ce.getCharacterData();j.info("Loaded character data from API:",{characters:r.characters.length,relationships:Object.keys(r.relationships).length}),K(r.characters),Object.keys(r.relationships).length>0&&(me(r.relationships),wt.current=!0),Object.keys(r.relationshipTexts).length>0&&Se(r.relationshipTexts),r.customRelationships.length>0&&Le(r.customRelationships),r.characters.length>0&&Ke(r.characters)}catch(r){j.error("Failed to load character data:",r)}finally{p(!1)}})()},[f]),b.useEffect(()=>{g===2&&D.length===0&&!E&&!S&&Re()},[g,D.length,E,S]),b.useEffect(()=>{localStorage.setItem("story_main_characters",JSON.stringify(ae))},[ae]),b.useEffect(()=>{localStorage.setItem("story_language_level",ne)},[ne]),b.useEffect(()=>{localStorage.setItem("story_pages",xe.toString())},[xe]),b.useEffect(()=>{localStorage.setItem("story_dedication",he)},[he]),b.useEffect(()=>{localStorage.setItem("story_details",pe)},[pe]),b.useEffect(()=>{if(g===3&&D.length>=2&&!S){const s=D.map(r=>r.id).sort().join("-");if(!Ce.current||Ce.current!==s){const o=jt(n);j.debug("Initializing relationships for step 3",{charKey:s,existingCount:Object.keys(U).length}),me(c=>{const h={...c};let B=!1;return D.forEach((I,L)=>{D.forEach(($,Z)=>{if(L!==Z){const ie=`${I.id}-${$.id}`;h[ie]||(h[ie]=o,B=!0,j.debug("Initializing missing relationship:",ie))}})}),B?h:c}),Ce.current=s}}},[g,D,n,S]);const Je=()=>{if(D.length<2)return!0;for(let s=0;s<D.length;s++)for(let r=0;r<D.length;r++)if(s!==r){const o=`${D[s].id}-${D[r].id}`,c=U[o];if(!c||vt(c))return!1}return!0},Re=()=>{T({id:Date.now(),name:"",gender:"other",age:"8",strengths:[],flaws:[],challenges:[]}),W("photo"),Q(!1)},Pt=(s,r=1500)=>new Promise(o=>{const c=new Image;c.onload=()=>{const h=document.createElement("canvas");let{width:B,height:I}=c;(B>r||I>r)&&(B>I?(I=Math.round(I*r/B),B=r):(B=Math.round(B*r/I),I=r)),h.width=B,h.height=I;const L=h.getContext("2d");L==null||L.drawImage(c,0,0,B,I),o(h.toDataURL("image/jpeg",.85))},c.onerror=()=>o(s),c.src=s}),Te=async s=>{const r=new FileReader;r.onload=async o=>{var h;const c=(h=o.target)==null?void 0:h.result;v(!0),m!=="traits"&&W("name");try{const B=await Pt(c),I=Math.round(c.length/1024),L=Math.round(B.length/1024);j.info(`Starting photo analysis... (${I}KB -> ${L}KB)`);const $=await ce.analyzePhoto(B);if($.success){const Z=$.faceThumbnail||c,ie=$.bodyCrop||c,Et=$.bodyNoBg||void 0;j.info("Photo analysis complete:",{hasFaceThumbnail:!!$.faceThumbnail,hasBodyCrop:!!$.bodyCrop,hasBodyNoBg:!!$.bodyNoBg,attributes:$.attributes}),T(_=>{var Xe,et,tt,st,rt,at,nt;return _?{..._,photoUrl:Z,bodyPhotoUrl:ie,bodyNoBgUrl:Et,faceBox:$.faceBox,bodyBox:$.bodyBox,gender:(!_.gender||_.gender==="other")&&((Xe=$.attributes)!=null&&Xe.gender)?$.attributes.gender:_.gender,age:(!_.age||_.age==="8")&&((et=$.attributes)!=null&&et.age)?String($.attributes.age):_.age,height:!_.height&&((tt=$.attributes)!=null&&tt.height)?String($.attributes.height):_.height,build:!_.build&&((st=$.attributes)!=null&&st.build)?$.attributes.build:_.build,hairColor:!_.hairColor&&((rt=$.attributes)!=null&&rt.hairColor)?$.attributes.hairColor:_.hairColor,clothing:!_.clothing&&((at=$.attributes)!=null&&at.clothing)?$.attributes.clothing:_.clothing,otherFeatures:!_.otherFeatures&&((nt=$.attributes)!=null&&nt.otherFeatures)?$.attributes.otherFeatures:_.otherFeatures}:null})}else j.warn("Photo analysis returned no data, using original photo"),T(Z=>Z?{...Z,photoUrl:c}:null)}catch(B){j.error("Photo analysis error:",B),T(I=>I?{...I,photoUrl:c}:null)}finally{v(!1)}},r.readAsDataURL(s)},Qe=async()=>{if(E){p(!0);try{const r=E.id&&D.find(o=>o.id===E.id)?D.map(o=>o.id===E.id?E:o):[...D,E];j.info("Saving characters with relationships:",r.length),await ce.saveCharacterData({characters:r,relationships:U,relationshipTexts:se,customRelationships:ue,customStrengths:[],customWeaknesses:[],customFears:[]}),j.success("Character data saved successfully"),K(r),Ke(r),T(null),Q(!0)}catch(s){j.error("Failed to save character:",s),alert(n==="de"?"Charakter konnte nicht gespeichert werden. Bitte versuche es erneut.":n==="fr"?"√âchec de l'enregistrement du personnage. Veuillez r√©essayer.":"Failed to save character. Please try again.")}finally{p(!1)}}},Dt=s=>{T({...s}),W("traits"),Q(!1)},Ft=async s=>{const r=D.filter(h=>h.id!==s),o={...U},c={...se};Object.keys(o).forEach(h=>{(h.includes(`${s}-`)||h.includes(`-${s}`))&&(delete o[h],delete c[h])});try{await ce.saveCharacterData({characters:r,relationships:o,relationshipTexts:c,customRelationships:ue,customStrengths:[],customWeaknesses:[],customFears:[]}),K(r),me(o),Se(c),ge(h=>h.filter(B=>B!==s))}catch(h){j.error("Failed to delete character:",h)}},$t=(s,r,o)=>{const h=ns(o,n),B=`${s}-${r}`,I=`${r}-${s}`;j.debug("Updating relationship:",B,"=",o,", inverse:",I,"=",h),re.current=!0,me(L=>({...L,[B]:o,[I]:h}))},zt=s=>{re.current=!0,Le(r=>[...r,s])},Bt=()=>{const r=prompt(n==="de"?"Name des Story-Typs eingeben:":n==="fr"?"Entrez le nom du type d'histoire:":"Enter story type name:");if(r){const o={id:`custom-${Date.now()}`,name:{en:r,de:r,fr:r},emoji:"‚ú®"};V(c=>[...c,o]),P(o.id),setTimeout(()=>{const c=document.getElementById("art-style-section");c&&c.scrollIntoView({behavior:"smooth",block:"start"})},100)}},At=s=>{ge(r=>r.includes(s)?r.filter(o=>o!==s):[...r,s])},Ee=s=>{s>=0&&s<=5&&z(s)},It=s=>s===1?!0:s===2?F!=="":s===3?F!==""&&D.length>0:s===4?F!==""&&D.length>0&&Je():s===5?fe!=="":!1,G=()=>g===1?F!=="":g===2?D.length>0:g===3?Je():g===4?ae.length>0:!1,Ye=async()=>{if(D.length!==0){if(!re.current){j.debug("Relationships not modified, skipping save");return}try{await ce.saveCharacterData({characters:D,relationships:U,relationshipTexts:se,customRelationships:ue,customStrengths:[],customWeaknesses:[],customFears:[]}),re.current=!1,j.debug("Character data auto-saved")}catch(s){j.error("Failed to auto-save character data:",s)}}},Ge=async()=>{g<4&&G()&&(g===3&&await Ye(),Ee(g+1))},Ze=async()=>{g>0&&(g===3&&await Ye(),Ee(g-1))},Rt=()=>{const s=a.find(o=>o.id===F);if(s)return s.name[n];const r=yt.find(o=>o.id===F);return r?r.name[n]:F},_e=async(s=!1)=>{Y(!0),z(5),Fe({current:5,total:100,message:n==="de"?"Starte Generierung...":n==="fr"?"D√©marrage de la g√©n√©ration...":"Starting generation..."});try{const{jobId:r}=await J.createStoryJob({storyType:F,storyTypeName:Rt(),artStyle:R,language:n,languageLevel:ne,pages:xe,dedication:he,storyDetails:pe,characters:D,mainCharacters:ae,relationships:U,relationshipTexts:se,skipImages:s,imageGenMode:w});We(r),j.info("Story job created:",r);let o=!1;for(;!o;){await new Promise(h=>setTimeout(h,2e3));const c=await J.getJobStatus(r);if(j.debug("Job status:",c),c.progress&&Fe(c.progress),c.status==="completed"&&c.result)Ie(c.result.storyId),ze(c.result.title),He(c.result.outline),Be(c.result.story),Ae(c.result.sceneDescriptions||[]),be(c.result.sceneImages||[]),ye(c.result.coverImages||{frontCover:null,initialPage:null,backCover:null}),o=!0,j.success("Story generation completed!");else if(c.status==="failed")throw new Error(c.error||"Story generation failed")}Fe({current:100,total:100,message:n==="de"?"Fertig!":n==="fr"?"Termin√©!":"Complete!"})}catch(r){j.error("Generation failed:",r),alert(n==="de"?`Generierung fehlgeschlagen: ${r}`:n==="fr"?`√âchec de la g√©n√©ration: ${r}`:`Generation failed: ${r}`)}finally{setTimeout(()=>Y(!1),500)}},Tt=()=>{switch(g){case 1:return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ss,{selectedType:F,onSelect:s=>{P(s),setTimeout(()=>{const r=document.getElementById("art-style-section");r&&r.scrollIntoView({behavior:"smooth",block:"start"})},100)},customTypes:a,onAddCustom:Bt}),F&&e.jsx(as,{selectedStyle:R,onSelect:l})]});case 2:return E?m==="photo"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(X,{size:24})," ",u.createCharacters]}),e.jsx(us,{onPhotoSelect:Te}),e.jsx("button",{onClick:()=>T(null),className:"w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:u.cancel})]}):m==="name"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(X,{size:24})," ",u.createCharacters]}),e.jsx(gt,{character:E,onChange:T,onSave:Qe,onCancel:()=>T(null),onPhotoChange:Te,onContinueToTraits:()=>W("traits"),isLoading:S,isAnalyzingPhoto:A,step:"name",developerMode:C})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(X,{size:24})," ",u.createCharacters]}),e.jsx(gt,{character:E,onChange:T,onSave:Qe,onCancel:()=>T(null),onPhotoChange:Te,isLoading:S,isAnalyzingPhoto:A,step:"traits",developerMode:C})]}):D.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(X,{size:24})," ",u.createCharacters]}),e.jsx(os,{characters:D,showSuccessMessage:te,onEdit:Dt,onDelete:Ft,onCreateAnother:Re,onContinue:Ge})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(X,{size:24})," ",u.createCharacters]}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(X,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-6",children:u.startCreating}),e.jsx(ve,{onClick:Re,icon:oe,children:n==="de"?"Ersten Charakter erstellen":n==="fr"?"Creer le premier personnage":"Create First Character"})]})]});case 3:return e.jsx(is,{characters:D,relationships:U,relationshipTexts:se,onRelationshipChange:$t,onRelationshipTextChange:(s,r)=>{re.current=!0,Se(o=>({...o,[s]:r}))},customRelationships:ue,onAddCustomRelationship:zt});case 4:return e.jsx(ls,{characters:D,mainCharacters:ae,onToggleMainCharacter:At,languageLevel:ne,onLanguageLevelChange:ke,pages:xe,onPagesChange:Me,dedication:he,onDedicationChange:Oe,storyDetails:pe,onStoryDetailsChange:Ve,developerMode:C,imageGenMode:w,onImageGenModeChange:y});case 5:return fe?e.jsx(hs,{title:$e,story:fe,outline:Nt,sceneImages:Ct,sceneDescriptions:St,coverImages:kt,languageLevel:ne,isGenerating:Pe,developerMode:C,storyId:q,onRegenerateImage:q?async s=>{try{j.info("Regenerating image for page:",s),Y(!0);const{imageData:r}=await J.regenerateImage(q,s);be(o=>o.map(c=>c.pageNumber===s?{...c,imageData:r}:c)),j.info("Image regenerated successfully")}catch(r){j.error("Image regeneration failed:",r),alert(n==="de"?"Bildgenerierung fehlgeschlagen":n==="fr"?"√âchec de la r√©g√©n√©ration de l'image":"Image regeneration failed")}finally{Y(!1)}}:void 0,onDownloadTxt:()=>{const s=new Blob([fe],{type:"text/plain"}),r=URL.createObjectURL(s),o=document.createElement("a");o.href=r,o.download=`${$e}.txt`,o.click(),URL.revokeObjectURL(r)},onDownloadPdf:q?async()=>{try{const s=await J.generatePdf(q),r=URL.createObjectURL(s),o=document.createElement("a");o.href=r,o.download=`${$e}.pdf`,o.click(),URL.revokeObjectURL(r)}catch(s){j.error("PDF download failed:",s),alert(n==="de"?"PDF-Download fehlgeschlagen":n==="fr"?"√âchec du t√©l√©chargement PDF":"PDF download failed")}}:void 0,onBuyBook:q?async()=>{try{j.info("Creating checkout session for story:",q);const{url:s}=await J.createCheckoutSession(q);s&&(window.location.href=s)}catch(s){j.error("Checkout failed:",s),alert(n==="de"?"Checkout fehlgeschlagen. Bitte versuche es erneut.":n==="fr"?"√âchec du paiement. Veuillez r√©essayer.":"Checkout failed. Please try again.")}}:void 0,onPrintBook:q?async()=>{let s=await ps.getShippingAddress();if(!s){const c=prompt(n==="de"?"Keine Adresse gespeichert. Bitte eingeben (Format: Vorname, Nachname, Strasse, PLZ, Ort, Land, Email):":n==="fr"?"Aucune adresse enregistr√©e. Veuillez entrer (Format: Pr√©nom, Nom, Rue, CP, Ville, Pays, Email):":"No saved address. Please enter (Format: FirstName, LastName, Street, PostCode, City, Country, Email):");if(!c)return;const h=c.split(",").map(B=>B.trim());if(h.length<7){alert(n==="de"?"Ung√ºltiges Adressformat":n==="fr"?"Format d'adresse invalide":"Invalid address format");return}s={firstName:h[0],lastName:h[1],addressLine1:h[2],postCode:h[3],city:h[4],country:h[5],email:h[6]}}const r=`${s.firstName} ${s.lastName}
${s.addressLine1}
${s.postCode} ${s.city}
${s.country}`,o=n==="de"?`Druckauftrag an folgende Adresse senden?

${r}`:n==="fr"?`Envoyer la commande √† cette adresse?

${r}`:`Send print order to this address?

${r}`;if(confirm(o))try{j.info("Creating print order for story:",q);const c=await J.createPrintOrder(q,{firstName:s.firstName,lastName:s.lastName,addressLine1:s.addressLine1,city:s.city,postCode:s.postCode,country:s.country,email:s.email||""});alert(n==="de"?`Druckauftrag erstellt! Order ID: ${c.orderId}`:n==="fr"?`Commande d'impression cr√©√©e! ID: ${c.orderId}`:`Print order created! Order ID: ${c.orderId}`)}catch(c){j.error("Print order failed:",c);const h=c instanceof Error?c.message:String(c);alert(n==="de"?`Druckauftrag fehlgeschlagen:
${h}`:n==="fr"?`√âchec de la commande d'impression:
${h}`:`Print order failed:
${h}`)}}:void 0,onCreateAnother:()=>{j.info("Creating new story - resetting settings"),Ie(null),We(null);const s=new URLSearchParams(i);s.delete("storyId"),x(s,{replace:!0}),Be(""),ze(""),Ae([]),be([]),ye({frontCover:null,initialPage:null,backCover:null}),P(""),l("pixar"),ke("standard"),Me(30),Oe(""),Ve(""),localStorage.removeItem("story_language_level"),localStorage.removeItem("story_pages"),localStorage.removeItem("story_dedication"),localStorage.removeItem("story_details"),localStorage.removeItem("story_main_characters"),z(1)},onRegenerateCover:q?async s=>{try{j.info("Regenerating cover:",s),Y(!0);const{imageData:r}=await J.regenerateCover(q,s);ye(o=>o&&{...o,[s==="front"?"frontCover":s==="back"?"backCover":"initialPage"]:{imageData:r}}),j.info("Cover regenerated successfully")}catch(r){j.error("Cover regeneration failed:",r),alert(n==="de"?"Cover-Generierung fehlgeschlagen":n==="fr"?"√âchec de la r√©g√©n√©ration de la couverture":"Cover regeneration failed")}finally{Y(!1)}}:void 0,onEditImage:s=>{alert(n==="de"?`Bildbearbeitung f√ºr Seite ${s} kommt bald`:n==="fr"?`√âdition d'image pour la page ${s} √† venir`:`Image editing for page ${s} coming soon`)},onEditCover:s=>{alert(n==="de"?`Bearbeitung f√ºr ${s==="front"?"Titelseite":s==="back"?"R√ºckseite":"Einleitungsseite"} kommt bald`:n==="fr"?`√âdition de la couverture ${s} √† venir`:`Cover editing for ${s} coming soon`)}}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:u.generateStory}),e.jsx("p",{className:"text-gray-600 mb-6",children:n==="de"?"Bereit, deine Geschichte zu erstellen!":n==="fr"?"Pr√™t √† cr√©er votre histoire!":"Ready to create your story!"}),e.jsx(ve,{onClick:()=>_e(!1),size:"lg",icon:oe,children:u.generateStory})]});default:return null}};return f?e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(Lt,{currentStep:g,onStepClick:Ee,canAccessStep:It,developerMode:C,onDeveloperModeChange:k}),e.jsx("div",{className:"px-3 md:px-8 mt-2 md:mt-8 flex-1",children:e.jsxs("div",{className:"md:bg-white md:rounded-2xl md:shadow-xl md:p-8",children:[S&&!Pe?e.jsx("div",{className:"py-12",children:e.jsx(it,{message:n==="de"?"Laden...":n==="fr"?"Chargement...":"Loading..."})}):Tt(),g<5&&!E&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[g!==4&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("button",{onClick:Ze,className:"bg-transparent text-gray-800 hover:bg-gray-100 px-6 py-3 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(lt,{size:20})," ",u.back]}),e.jsxs("button",{onClick:Ge,disabled:!G(),className:`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${G()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[u.next," ",e.jsx(bt,{size:20})]})]}),g===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:Ze,className:"bg-transparent text-gray-800 hover:bg-gray-100 px-6 py-3 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(lt,{size:20})," ",u.back]}),e.jsxs("button",{onClick:()=>_e(!1),disabled:!G(),className:`w-full py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 ${G()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-400 text-white cursor-not-allowed"}`,children:[e.jsx(oe,{size:20})," ",u.generateStory]}),C&&e.jsxs("button",{onClick:()=>_e(!0),disabled:!G(),className:`w-full py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 ${G()?"bg-yellow-500 text-white hover:bg-yellow-600":"bg-gray-400 text-white cursor-not-allowed"}`,children:[e.jsx(oe,{size:20}),n==="de"?"Nur Text generieren (ohne Bilder)":n==="fr"?"G√©n√©rer le texte uniquement (sans images)":"Generate Text Only (no images)"]})]})]})]})}),Pe&&e.jsx(xs,{current:De.current,total:De.total,message:De.message})]}):e.jsx(it,{fullScreen:!0})}export{Ds as default};
