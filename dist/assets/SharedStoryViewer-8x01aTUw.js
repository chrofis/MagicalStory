import{c as N,j as e,L as y,i as S}from"./index-C7tBk_Ke.js";import{f as k,b as d,L as b}from"./vendor-react-CqfXSjHo.js";import{S as p}from"./sparkles-BeowKw09.js";import{B as C}from"./book-open-C6MTsbgw.js";import{C as j}from"./chevron-right-BK-5s8f4.js";import"./vendor-firebase-DTVMaYMy.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=N("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);function P(a,i){const h=d.useRef(null),g=d.useRef(null),m=50;return{onTouchStart:l=>{g.current=null,h.current=l.targetTouches[0].clientX},onTouchMove:l=>{g.current=l.targetTouches[0].clientX},onTouchEnd:()=>{if(!h.current||!g.current)return;const l=h.current-g.current,n=l>m,u=l<-m;n&&a(),u&&i()}}}function M(){const{shareToken:a}=k(),[i,h]=d.useState(null),[g,m]=d.useState(!0),[f,x]=d.useState(null),[s,l]=d.useState(0);d.useEffect(()=>{async function t(){if(!a){x("Invalid share link"),m(!1);return}try{const r=await fetch(`/api/shared/${a}`);if(!r.ok){r.status===404?x("This story is no longer available or the link is invalid."):x("Failed to load story. Please try again later."),m(!1);return}const o=await r.json();h(o)}catch{x("Failed to load story. Please check your connection.")}finally{m(!1)}}t()},[a]);const n=i?i.pages.length+3:0,u=t=>t>=2&&t<i.pages.length+2?t-2:-1;d.useEffect(()=>{if(!i||!a)return;if(s<=2&&["frontCover","initialPage"].forEach(r=>{const o=new Image;o.src=`/api/shared/${a}/cover-image/${r}`}),s>=n-3){const r=new Image;r.src=`/api/shared/${a}/cover-image/backCover`}const t=u(s);if(t>=0){if(t+1<i.pages.length){const r=new Image;r.src=`/api/shared/${a}/image/${i.pages[t+1].pageNumber}`}if(t>0){const r=new Image;r.src=`/api/shared/${a}/image/${i.pages[t-1].pageNumber}`}}},[s,i,a,n]);const c=t=>{t>=0&&t<n&&l(t)},v=P(()=>c(s+1),()=>c(s-1));return g?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"w-12 h-12 animate-spin text-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-indigo-800",children:"Loading story..."})]})}):f?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-blue-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(S,{className:"w-16 h-16 text-indigo-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-indigo-900 mb-2",children:"Story Not Found"}),e.jsx("p",{className:"text-indigo-700 mb-6",children:f}),e.jsxs(b,{to:"/",className:"inline-flex items-center gap-2 bg-gradient-to-r from-indigo-500 to-blue-500 text-white px-6 py-3 rounded-full font-semibold hover:from-indigo-600 hover:to-blue-600 transition-all",children:[e.jsx(p,{className:"w-5 h-5"}),"Create Your Own Story"]})]})}):i?e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-blue-50 flex flex-col",children:[e.jsx("header",{className:"bg-white/80 backdrop-blur-sm border-b border-indigo-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-6 h-6 text-indigo-600"}),e.jsx("span",{className:"font-bold text-indigo-900 hidden sm:inline",children:"MagicalStory"})]}),e.jsxs(b,{to:"/",className:"inline-flex items-center gap-1 bg-gradient-to-r from-indigo-500 to-blue-500 text-white px-4 py-2 rounded-full text-sm font-semibold hover:from-indigo-600 hover:to-blue-600 transition-all",children:[e.jsx(p,{className:"w-4 h-4"}),"Create Your Own Story"]})]})}),e.jsxs("main",{className:"flex-1 flex items-center justify-center px-2 md:px-4 py-4 md:py-6",...v,children:[e.jsx("button",{onClick:()=>c(s-1),disabled:s===0,className:"hidden md:flex p-2 lg:p-3 rounded-full bg-white shadow-lg border border-indigo-200 text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed hover:bg-indigo-50 transition-colors mr-3 lg:mr-6 flex-shrink-0","aria-label":"Previous page",children:e.jsx(w,{className:"w-6 h-6 lg:w-8 lg:h-8"})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden border-2 border-indigo-200 flex-1 max-w-6xl",children:[s===0&&e.jsx("div",{className:"flex items-center justify-center bg-gradient-to-br from-indigo-100 to-blue-100 p-4",children:e.jsx("img",{src:`/api/shared/${a}/cover-image/frontCover`,alt:i.title,className:"max-h-[calc(100vh-200px)] max-w-full object-contain rounded-lg shadow-lg",loading:"eager",onError:t=>{t.currentTarget.style.display="none"}})}),s===1&&e.jsx("div",{className:"flex items-center justify-center bg-gradient-to-br from-indigo-100 to-blue-100 p-4",children:e.jsx("img",{src:`/api/shared/${a}/cover-image/initialPage`,alt:"Dedication",className:"max-h-[calc(100vh-200px)] max-w-full object-contain rounded-lg shadow-lg",loading:"eager",onError:t=>{t.currentTarget.style.display="none"}})}),(()=>{const t=u(s);if(t<0||!i.pages[t])return null;const r=i.pages[t];return e.jsxs("div",{className:"md:grid md:grid-cols-2 h-[calc(100vh-180px)] md:h-[calc(100vh-160px)] min-h-[400px] max-h-[800px]",children:[e.jsx("div",{className:"h-1/2 md:h-full bg-gradient-to-br from-indigo-50 to-blue-50 flex items-center justify-center",children:e.jsx("img",{src:`/api/shared/${a}/image/${r.pageNumber}`,alt:`Page ${t+1}`,className:"w-full h-full object-contain",loading:"eager",onError:o=>{o.currentTarget.src="",o.currentTarget.alt="Image not available"}})}),e.jsxs("div",{className:"h-1/2 md:h-full p-4 md:p-5 lg:p-6 flex flex-col bg-indigo-50/50 overflow-hidden",children:[e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:e.jsx("p",{className:"text-sm md:text-base leading-relaxed text-gray-800 whitespace-pre-wrap",children:r.text})}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-indigo-100 text-right text-indigo-400 text-xs flex-shrink-0",children:["Page ",t+1," of ",i.pages.length]})]})]})})(),s===n-1&&e.jsx("div",{className:"flex items-center justify-center bg-gradient-to-br from-indigo-100 to-blue-100 p-4",children:e.jsx("img",{src:`/api/shared/${a}/cover-image/backCover`,alt:"Back Cover",className:"max-h-[calc(100vh-200px)] max-w-full object-contain rounded-lg shadow-lg",loading:"eager",onError:t=>{t.currentTarget.style.display="none"}})}),e.jsx("div",{className:"flex items-center justify-center gap-2 py-3 bg-white border-t border-indigo-100",children:Array.from({length:Math.min(n,12)}).map((t,r)=>{const o=n<=12||r<5?r:r===5?-1:n-(11-r);return o===-1?e.jsx("span",{className:"text-indigo-300 text-xs",children:"..."},r):e.jsx("button",{onClick:()=>c(o),className:`w-2.5 h-2.5 rounded-full transition-all ${s===o?"bg-indigo-500 scale-125":"bg-indigo-200 hover:bg-indigo-300"}`,"aria-label":`Go to page ${o}`},r)})})]}),e.jsx("button",{onClick:()=>c(s+1),disabled:s>=n-1,className:"hidden md:flex p-2 lg:p-3 rounded-full bg-white shadow-lg border border-indigo-200 text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed hover:bg-indigo-50 transition-colors ml-3 lg:ml-6 flex-shrink-0","aria-label":"Next page",children:e.jsx(j,{className:"w-6 h-6 lg:w-8 lg:h-8"})})]}),e.jsxs("div",{className:"md:hidden flex items-center justify-center gap-6 pb-4",children:[e.jsx("button",{onClick:()=>c(s-1),disabled:s===0,className:"p-3 rounded-full bg-white shadow-md border border-indigo-200 text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed","aria-label":"Previous page",children:e.jsx(w,{className:"w-6 h-6"})}),e.jsx("p",{className:"text-indigo-400 text-sm",children:"Swipe or tap"}),e.jsx("button",{onClick:()=>c(s+1),disabled:s>=n-1,className:"p-3 rounded-full bg-white shadow-md border border-indigo-200 text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed","aria-label":"Next page",children:e.jsx(j,{className:"w-6 h-6"})})]})]}):null}export{M as default};
