import{c as U,b as p,j as e,L as A,a as Ht,u as Bt,T as ot,i as De,E as ct}from"./index-D6ko9dyL.js";import{b as l,u as Vt,e as Rt}from"./vendor-react-CqfXSjHo.js";import{B as j,U as be,I as Fe,C as dt}from"./Input-DiwyLVa7.js";import{R as ie,C as W,I as xt,F as Jt,b as mt,H as gt,M as Ot,P as qt,a as Kt,c as je}from"./Modal-Iqnj9Sd5.js";import{C as X,D as Qt}from"./download-Dj3mKoI9.js";import{A as Zt}from"./arrow-left-CrjnqqPJ.js";import{P as Wt}from"./printer-B7M-xuPd.js";import{B as Ie}from"./book-open-CWBlVbPa.js";import{T as Ee}from"./trash-2-DGDEwbDf.js";import{C as Xt}from"./camera-s_N_Lozo.js";import{C as Yt}from"./check-TJOJ6qBn.js";import{C as es}from"./clock-Cuq4lj80.js";import"./vendor-firebase-DTVMaYMy.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=U("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=U("CameraOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16",key:"qmtpty"}],["path",{d:"M9.5 4h5L17 7h3a2 2 0 0 1 2 2v7.5",key:"1ufyfc"}],["path",{d:"M14.121 15.121A3 3 0 1 1 9.88 10.88",key:"11zox6"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=U("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=U("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=U("MailX",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h9",key:"1j9vog"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m17 17 4 4",key:"1b3523"}],["path",{d:"m21 17-4 4",key:"uinynz"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=U("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=U("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=U("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=U("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=U("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=U("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),u={async getStats(){return p.get("/api/admin/stats")},async getUsers(a={}){const n=new URLSearchParams;a.page&&n.set("page",String(a.page)),a.limit&&n.set("limit",String(a.limit)),a.search&&n.set("search",a.search);const z=n.toString();return p.get(`/api/admin/users${z?`?${z}`:""}`)},async updateUserCredits(a,n){return p.post(`/api/admin/users/${a}/quota`,{credits:n})},async getCreditHistory(a,n=50){return p.get(`/api/admin/users/${a}/credits?limit=${n}`)},async getUserDetails(a){return p.get(`/api/admin/users/${a}/details`)},async updateUserRole(a,n){return p.post(`/api/admin/users/${a}/role`,{role:n})},async deleteUser(a){return p.delete(`/api/admin/users/${a}`)},async toggleEmailVerified(a,n){return p.post(`/api/admin/users/${a}/email-verified`,{emailVerified:n})},async togglePhotoConsent(a,n){return p.post(`/api/admin/users/${a}/photo-consent`,{hasConsent:n})},async cleanOrphanedFiles(){return p.post("/api/admin/cleanup-orphaned")},async clearCache(){return p.post("/api/admin/clear-cache")},async getSystemLogs(){return p.get("/api/admin/logs")},async exportUserData(){return(await fetch("/api/admin/export",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).blob()},async getPrintProducts(){return p.get("/api/admin/print-products")},async fetchGelatoProducts(){return p.get("/api/admin/print-provider/fetch-products")},async createPrintProduct(a){return p.post("/api/admin/print-products",a)},async updatePrintProduct(a,n){return p.put(`/api/admin/print-products/${a}`,n)},async togglePrintProduct(a,n){return p.put(`/api/admin/print-products/${a}/toggle`,{is_active:n})},async deletePrintProduct(a){return p.delete(`/api/admin/print-products/${a}`)},async getTokenUsage(a=30,n=1e3){return p.get(`/api/admin/token-usage?days=${a}&limit=${n}`)},async getTokenPromo(){return p.get("/api/admin/config/token-promo")},async setTokenPromo(a){return p.post("/api/admin/config/token-promo",{multiplier:a})},async getFailedJobs(){return p.get("/api/admin/jobs/failed")},async retryFailedJob(a){return p.post(`/api/admin/jobs/${a}/retry`)},async startJob(a){return p.post(`/api/admin/jobs/${a}/start`)},async getJobDetails(a){return p.get(`/api/admin/jobs/${a}`)}},yt={en:{title:"Admin Dashboard",stats:"Statistics",users:"User Management",totalUsers:"Total Users",totalStories:"Total Stories",totalCharacters:"Total Characters",totalImages:"Total Images",orphanedFiles:"Orphaned Files",databaseSize:"Database Size",adminActions:"Admin Actions",cleanOrphaned:"Clean Orphaned Files",exportData:"Export User Data",viewLogs:"View System Logs",clearCache:"Clear Cache",accessDenied:"Access Denied",accessDeniedDesc:"You need admin privileges to access this page.",goHome:"Go Home",username:"Username",email:"Email",role:"Role",credits:"Credits",actions:"Actions",editCredits:"Edit Credits",newCredits:"New Credits",save:"Save",cancel:"Cancel",makeAdmin:"Make Admin",removeAdmin:"Remove Admin",deleteUser:"Delete User",confirmDelete:"Are you sure you want to delete this user?",unlimited:"Unlimited",cleaned:"Cleaned {count} orphaned files",cacheCleared:"Cache cleared successfully",refreshStats:"Refresh Stats",creditHistory:"Credit History",viewHistory:"View History",amount:"Amount",balance:"Balance",type:"Type",description:"Description",date:"Date",noTransactions:"No transactions found",currentBalance:"Current Balance",impersonate:"View as User",impersonating:"Now viewing as {username}",userDetails:"User Details",memberSince:"Member Since",lastLogin:"Last Login",never:"Never",stories:"Stories",characters:"Characters",images:"Images",purchases:"Purchases",totalSpent:"Total Spent",storyTitle:"Title",pages:"Pages",purchaseHistory:"Purchase History",status:"Status",product:"Product",noStories:"No stories yet",noPurchases:"No purchases yet",close:"Close",tokens:"Tokens",totalTokens:"Total Tokens",inputTokens:"Input",outputTokens:"Output",apiCalls:"API Calls",printProducts:"Print Products",fetchFromGelato:"Fetch from Gelato",savedProducts:"Saved Products",gelatoProducts:"Gelato Products",productUid:"Product UID",productName:"Product Name",size:"Size",coverType:"Cover Type",minPages:"Min Pages",maxPages:"Max Pages",active:"Active",inactive:"Inactive",addProduct:"Add Product",noProducts:"No products configured yet",noGelatoProducts:'Click "Fetch from Gelato" to load available products',selectProduct:"Select a product from Gelato to add it",softcover:"Softcover",hardcover:"Hardcover",fetching:"Fetching products...",confirmDeleteProduct:"Are you sure you want to delete this product?",editProduct:"Edit Product",editPages:"Edit Page Range",searchUsers:"Search users...",search:"Search",showingUsers:"Showing {from}-{to} of {total}",pageOf:"Page {page} of {total}",tokenUsage:"Token Usage",dailyUsage:"Daily Usage",monthlyUsage:"Monthly Usage",byUserUsage:"By User",provider:"Provider",grandTotal:"Grand Total",storiesCount:"Stories",bookPages:"Book Pages",totalCost:"Total Cost",costPerStory:"Cost/Story",noTokenData:"No token usage data available",loadingTokens:"Loading token usage data...",daysFilter:"Days",anthropic:"Anthropic (Claude)",geminiText:"Gemini Text",geminiImage:"Gemini Image",geminiQuality:"Gemini Quality",runware:"Runware",thinkingTokens:"Thinking",calls:"Calls",failedJobs:"Failed Jobs"},de:{title:"Admin-Dashboard",stats:"Statistiken",users:"Benutzerverwaltung",totalUsers:"Benutzer gesamt",totalStories:"Geschichten gesamt",totalCharacters:"Charaktere gesamt",totalImages:"Bilder gesamt",orphanedFiles:"Verwaiste Dateien",databaseSize:"Datenbankgroesse",adminActions:"Admin-Aktionen",cleanOrphaned:"Verwaiste Dateien bereinigen",exportData:"Benutzerdaten exportieren",viewLogs:"Systemprotokolle anzeigen",clearCache:"Cache leeren",accessDenied:"Zugriff verweigert",accessDeniedDesc:"Sie benoetigen Admin-Rechte um auf diese Seite zuzugreifen.",goHome:"Zur Startseite",username:"Benutzername",email:"E-Mail",role:"Rolle",credits:"Credits",actions:"Aktionen",editCredits:"Credits bearbeiten",newCredits:"Neue Credits",save:"Speichern",cancel:"Abbrechen",makeAdmin:"Zum Admin machen",removeAdmin:"Admin-Rechte entfernen",deleteUser:"Benutzer löschen",confirmDelete:"Sind Sie sicher, dass Sie diesen Benutzer löschen möchten?",unlimited:"Unbegrenzt",cleaned:"{count} verwaiste Dateien bereinigt",cacheCleared:"Cache erfolgreich geleert",refreshStats:"Statistiken aktualisieren",impersonate:"Als Benutzer ansehen",impersonating:"Ansicht als {username}",creditHistory:"Credit-Verlauf",viewHistory:"Verlauf anzeigen",amount:"Betrag",balance:"Guthaben",type:"Typ",description:"Beschreibung",date:"Datum",noTransactions:"Keine Transaktionen gefunden",currentBalance:"Aktuelles Guthaben",userDetails:"Benutzerdetails",memberSince:"Mitglied seit",lastLogin:"Letzter Login",never:"Nie",stories:"Geschichten",characters:"Charaktere",images:"Bilder",purchases:"Käufe",totalSpent:"Gesamtausgaben",storyTitle:"Titel",pages:"Seiten",purchaseHistory:"Kaufhistorie",status:"Status",product:"Produkt",noStories:"Noch keine Geschichten",noPurchases:"Noch keine Käufe",close:"Schliessen",tokens:"Tokens",totalTokens:"Tokens gesamt",inputTokens:"Eingabe",outputTokens:"Ausgabe",apiCalls:"API-Aufrufe",printProducts:"Druckprodukte",fetchFromGelato:"Von Gelato laden",savedProducts:"Gespeicherte Produkte",gelatoProducts:"Gelato Produkte",productUid:"Produkt-UID",productName:"Produktname",size:"Grösse",coverType:"Einbandtyp",minPages:"Min. Seiten",maxPages:"Max. Seiten",active:"Aktiv",inactive:"Inaktiv",addProduct:"Produkt hinzufügen",noProducts:"Noch keine Produkte konfiguriert",noGelatoProducts:'Klicken Sie auf "Von Gelato laden" um verfügbare Produkte zu laden',selectProduct:"Wählen Sie ein Produkt von Gelato aus um es hinzuzufügen",softcover:"Softcover",hardcover:"Hardcover",fetching:"Lade Produkte...",confirmDeleteProduct:"Sind Sie sicher, dass Sie dieses Produkt löschen möchten?",editProduct:"Produkt bearbeiten",editPages:"Seitenbereich bearbeiten",searchUsers:"Benutzer suchen...",search:"Suchen",showingUsers:"Zeige {from}-{to} von {total}",pageOf:"Seite {page} von {total}",tokenUsage:"Token-Verbrauch",dailyUsage:"Täglicher Verbrauch",monthlyUsage:"Monatlicher Verbrauch",byUserUsage:"Nach Benutzer",provider:"Anbieter",grandTotal:"Gesamtsumme",storiesCount:"Geschichten",bookPages:"Buchseiten",totalCost:"Gesamtkosten",costPerStory:"Kosten/Geschichte",noTokenData:"Keine Token-Daten verfügbar",loadingTokens:"Lade Token-Daten...",daysFilter:"Tage",anthropic:"Anthropic (Claude)",geminiText:"Gemini Text",geminiImage:"Gemini Bild",geminiQuality:"Gemini Qualität",runware:"Runware",thinkingTokens:"Denken",calls:"Aufrufe",failedJobs:"Fehlgeschlagene Jobs"},fr:{title:"Tableau de bord Admin",stats:"Statistiques",users:"Gestion des utilisateurs",totalUsers:"Utilisateurs totaux",totalStories:"Histoires totales",totalCharacters:"Personnages totaux",totalImages:"Images totales",orphanedFiles:"Fichiers orphelins",databaseSize:"Taille de la base",adminActions:"Actions Admin",cleanOrphaned:"Nettoyer fichiers orphelins",exportData:"Exporter les donnees",viewLogs:"Voir les logs systeme",clearCache:"Vider le cache",accessDenied:"Acces refuse",accessDeniedDesc:"Vous avez besoin des privileges admin pour acceder a cette page.",goHome:"Accueil",username:"Nom d'utilisateur",email:"E-mail",role:"Role",credits:"Credits",actions:"Actions",editCredits:"Modifier les credits",newCredits:"Nouveaux credits",save:"Enregistrer",cancel:"Annuler",makeAdmin:"Rendre admin",removeAdmin:"Retirer admin",deleteUser:"Supprimer l'utilisateur",confirmDelete:"Etes-vous sur de vouloir supprimer cet utilisateur?",unlimited:"Illimite",cleaned:"{count} fichiers orphelins nettoyes",cacheCleared:"Cache vide avec succes",refreshStats:"Actualiser les stats",impersonate:"Voir comme utilisateur",impersonating:"Vue en tant que {username}",creditHistory:"Historique des credits",viewHistory:"Voir l'historique",amount:"Montant",balance:"Solde",type:"Type",description:"Description",date:"Date",noTransactions:"Aucune transaction trouvee",currentBalance:"Solde actuel",userDetails:"Details utilisateur",memberSince:"Membre depuis",lastLogin:"Derniere connexion",never:"Jamais",stories:"Histoires",characters:"Personnages",images:"Images",purchases:"Achats",totalSpent:"Total depense",storyTitle:"Titre",pages:"Pages",purchaseHistory:"Historique des achats",status:"Statut",product:"Produit",noStories:"Pas encore d'histoires",noPurchases:"Pas encore d'achats",close:"Fermer",tokens:"Tokens",totalTokens:"Tokens totaux",inputTokens:"Entree",outputTokens:"Sortie",apiCalls:"Appels API",printProducts:"Produits d'impression",fetchFromGelato:"Charger depuis Gelato",savedProducts:"Produits enregistres",gelatoProducts:"Produits Gelato",productUid:"UID Produit",productName:"Nom du produit",size:"Taille",coverType:"Type de couverture",minPages:"Pages min",maxPages:"Pages max",active:"Actif",inactive:"Inactif",addProduct:"Ajouter un produit",noProducts:"Aucun produit configure",noGelatoProducts:'Cliquez sur "Charger depuis Gelato" pour charger les produits disponibles',selectProduct:"Selectionnez un produit Gelato pour l'ajouter",softcover:"Couverture souple",hardcover:"Couverture rigide",fetching:"Chargement des produits...",confirmDeleteProduct:"Etes-vous sur de vouloir supprimer ce produit?",editProduct:"Modifier le produit",editPages:"Modifier la plage de pages",searchUsers:"Rechercher des utilisateurs...",search:"Rechercher",showingUsers:"Affichage {from}-{to} sur {total}",pageOf:"Page {page} sur {total}",tokenUsage:"Utilisation des tokens",dailyUsage:"Utilisation quotidienne",monthlyUsage:"Utilisation mensuelle",byUserUsage:"Par utilisateur",provider:"Fournisseur",grandTotal:"Total général",storiesCount:"Histoires",bookPages:"Pages du livre",totalCost:"Coût total",costPerStory:"Coût/Histoire",noTokenData:"Aucune donnée de tokens disponible",loadingTokens:"Chargement des données de tokens...",daysFilter:"Jours",anthropic:"Anthropic (Claude)",geminiText:"Gemini Texte",geminiImage:"Gemini Image",geminiQuality:"Gemini Qualité",runware:"Runware",thinkingTokens:"Réflexion",calls:"Appels",failedJobs:"Jobs échoués"}};function Z({icon:a,title:n,value:z,isString:g=!1}){return e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gray-100 rounded-lg",children:a}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:n}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:g?z:typeof z=="number"?z.toLocaleString():z})]})]})}function ls({texts:a}){var $,m,le,J,oe;const[n,z]=l.useState(null),[g,B]=l.useState(!1),[Y,ne]=l.useState(null),[I,k]=l.useState(30),[C,ee]=l.useState("daily"),y=async()=>{B(!0),ne(null);try{const r=await u.getTokenUsage(I);z(r)}catch(r){ne(r instanceof Error?r.message:"Failed to load token usage")}finally{B(!1)}};l.useEffect(()=>{y()},[I]);const f=r=>`$${r.toFixed(4)}`,E=r=>r>=1e6?`${(r/1e6).toFixed(2)}M`:r>=1e3?`${(r/1e3).toFixed(1)}K`:r.toString();return g&&!n?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(A,{className:"w-8 h-8 animate-spin text-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:a.loadingTokens})]}):Y?e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg",children:Y}):n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:a.tokenUsage}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("select",{value:I,onChange:r=>k(parseInt(r.target.value)),className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsxs("option",{value:7,children:["7 ",a.daysFilter]}),e.jsxs("option",{value:14,children:["14 ",a.daysFilter]}),e.jsxs("option",{value:30,children:["30 ",a.daysFilter]}),e.jsxs("option",{value:90,children:["90 ",a.daysFilter]}),e.jsxs("option",{value:365,children:["365 ",a.daysFilter]})]}),e.jsxs(j,{variant:"secondary",onClick:y,disabled:g,children:[e.jsx(ie,{size:16,className:g?"animate-spin":""}),a.refreshStats]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 mb-2",children:[e.jsx(as,{size:20}),e.jsx("span",{className:"font-medium",children:a.grandTotal})]}),e.jsx("p",{className:"text-3xl font-bold text-green-700",children:f(n.costs.grandTotal)}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:[n.summary.storiesWithTokenData," ",a.storiesCount]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-4 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-600 mb-2",children:[e.jsx(Ne,{size:20}),e.jsx("span",{className:"font-medium",children:a.anthropic})]}),e.jsx("p",{className:"text-2xl font-bold text-purple-700",children:f(n.costs.anthropic.total)}),e.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:[E(n.totals.anthropic.input_tokens)," in / ",E(n.totals.anthropic.output_tokens)," out"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mb-2",children:[e.jsx(Ne,{size:20}),e.jsx("span",{className:"font-medium",children:"Gemini"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:f(((($=n.costs.gemini_text)==null?void 0:$.total)||0)+(((m=n.costs.gemini_image)==null?void 0:m.total)||0)+(((le=n.costs.gemini_quality)==null?void 0:le.total)||0)+(n.costs.totalAvatarCost||0))}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Story Images: ",f(((J=n.costs.gemini_image)==null?void 0:J.total)||0)," (",((oe=n.totals.gemini_image)==null?void 0:oe.calls)||0," calls)"]}),e.jsxs("p",{className:"text-xs text-blue-500 mt-0.5",children:["Avatars: ",f(n.costs.totalAvatarCost||0),n.costs.avatarByModel&&Object.keys(n.costs.avatarByModel).length>0&&e.jsxs("span",{className:"ml-1",children:["(",Object.entries(n.costs.avatarByModel).map(([r,_])=>`${r.replace("gemini-","").replace("-image","")}: ${_.calls}`).join(", "),")"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl p-4 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-600 mb-2",children:[e.jsx(Ne,{size:20}),e.jsx("span",{className:"font-medium",children:a.runware})]}),e.jsx("p",{className:"text-2xl font-bold text-orange-700",children:f(n.costs.runware.total)}),e.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:[n.totals.runware.calls," ",a.calls]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>ee(C==="daily"?null:"daily"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{size:20,className:"text-indigo-600"}),e.jsx("span",{className:"font-semibold text-gray-800",children:a.dailyUsage}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",n.byDay.length," days)"]})]}),C==="daily"?e.jsx(W,{size:20}):e.jsx(X,{size:20})]}),C==="daily"&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-y",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:a.date}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.storiesCount}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.bookPages}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.anthropic}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Gemini"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.runware}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.totalCost})]})}),e.jsx("tbody",{className:"divide-y",children:n.byDay.slice(0,14).map(r=>{var F,h,G,b,w,T,P,N,c;const _=(((F=r.anthropic)==null?void 0:F.input_tokens)||0)/1e6*3+(((h=r.anthropic)==null?void 0:h.output_tokens)||0)/1e6*15+(((G=r.anthropic)==null?void 0:G.thinking_tokens)||0)/1e6*15,D=(((b=r.gemini_text)==null?void 0:b.input_tokens)||0)/1e6*.3+(((w=r.gemini_text)==null?void 0:w.output_tokens)||0)/1e6*2.5,V=(((T=r.gemini_image)==null?void 0:T.calls)||0)*.035,O=(((P=r.gemini_quality)==null?void 0:P.input_tokens)||0)/1e6*.1+(((N=r.gemini_quality)==null?void 0:N.output_tokens)||0)/1e6*.4,R=D+V+O,L=((c=r.runware)==null?void 0:c.direct_cost)||0;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-800",children:r.date}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-600",children:r.storyCount}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-600",children:r.totalBookPages}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-purple-600",children:f(_)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-blue-600",children:f(R)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:f(L)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-700",children:f(r.totalCost)})]},r.date)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>ee(C==="monthly"?null:"monthly"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{size:20,className:"text-indigo-600"}),e.jsx("span",{className:"font-semibold text-gray-800",children:a.monthlyUsage}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",n.byMonth.length," months)"]})]}),C==="monthly"?e.jsx(W,{size:20}):e.jsx(X,{size:20})]}),C==="monthly"&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-y",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:a.date}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.storiesCount}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.bookPages}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.anthropic}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Gemini"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.runware}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.totalCost}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.costPerStory})]})}),e.jsx("tbody",{className:"divide-y",children:n.byMonth.map(r=>{var h,G,b,w,T,P,N,c,M;const _=(((h=r.anthropic)==null?void 0:h.input_tokens)||0)/1e6*3+(((G=r.anthropic)==null?void 0:G.output_tokens)||0)/1e6*15+(((b=r.anthropic)==null?void 0:b.thinking_tokens)||0)/1e6*15,D=(((w=r.gemini_text)==null?void 0:w.input_tokens)||0)/1e6*.3+(((T=r.gemini_text)==null?void 0:T.output_tokens)||0)/1e6*2.5,V=(((P=r.gemini_image)==null?void 0:P.calls)||0)*.035,O=(((N=r.gemini_quality)==null?void 0:N.input_tokens)||0)/1e6*.1+(((c=r.gemini_quality)==null?void 0:c.output_tokens)||0)/1e6*.4,R=D+V+O,L=((M=r.runware)==null?void 0:M.direct_cost)||0,F=r.storyCount>0?r.totalCost/r.storyCount:0;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-800",children:r.month}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-600",children:r.storyCount}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-600",children:r.totalBookPages}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-purple-600",children:f(_)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-blue-600",children:f(R)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:f(L)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-700",children:f(r.totalCost)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-600",children:f(F)})]},r.month)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>ee(C==="user"?null:"user"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{size:20,className:"text-indigo-600"}),e.jsx("span",{className:"font-semibold text-gray-800",children:a.byUserUsage}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",n.byUser.length," users)"]})]}),C==="user"?e.jsx(W,{size:20}):e.jsx(X,{size:20})]}),C==="user"&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-y",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:a.email}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.storiesCount}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.bookPages}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.anthropic}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Gemini"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.runware}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:a.costPerStory})]})}),e.jsx("tbody",{className:"divide-y",children:n.byUser.slice(0,20).map((r,_)=>{var w,T,P,N,c,M,d,S,q;const D=(((w=r.anthropic)==null?void 0:w.input_tokens)||0)/1e6*3+(((T=r.anthropic)==null?void 0:T.output_tokens)||0)/1e6*15+(((P=r.anthropic)==null?void 0:P.thinking_tokens)||0)/1e6*15,V=(((N=r.gemini_text)==null?void 0:N.input_tokens)||0)/1e6*.3+(((c=r.gemini_text)==null?void 0:c.output_tokens)||0)/1e6*2.5,O=(((M=r.gemini_image)==null?void 0:M.calls)||0)*.035,R=(((d=r.gemini_quality)==null?void 0:d.input_tokens)||0)/1e6*.1+(((S=r.gemini_quality)==null?void 0:S.output_tokens)||0)/1e6*.4;let L=0;if(r.avatarByModel)for(const ce of Object.values(r.avatarByModel))L+=(ce.calls||0)*.035;const F=V+O+R+L,h=((q=r.runware)==null?void 0:q.direct_cost)||0,G=D+F+h,b=r.storyCount>0?G/r.storyCount:0;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-800",children:r.email||r.name||"Unknown"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-600",children:r.storyCount}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-600",children:r.totalBookPages}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-purple-600",children:f(D)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-blue-600",children:f(F)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:f(h)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-700",children:f(b)})]},r.email||_)})})]})})]})]}):e.jsx("div",{className:"text-center py-12 text-gray-500",children:a.noTokenData})}function Ns(){var st,at,rt,it,nt,lt;const a=Vt(),[n,z]=Rt(),{user:g,isAuthenticated:B,impersonate:Y,isLoading:ne,isImpersonating:I}=Ht(),{language:k}=Bt(),C=n.get("tab"),ee=C&&["stats","users","products","tokens","jobs"].includes(C)?C:"stats",[y,f]=l.useState(null),[E,$]=l.useState([]),[m,le]=l.useState(null),[J,oe]=l.useState(""),[r,_]=l.useState(1),[D,V]=l.useState(!1),[O,R]=l.useState(!1),[L,F]=l.useState(null),[h,G]=l.useState(ee),[b,w]=l.useState(null),[T,P]=l.useState(""),[N,c]=l.useState(!1),[M,d]=l.useState(null),[S,q]=l.useState(null),[ce,ve]=l.useState([]),[ft,Le]=l.useState(!1),[de,xe]=l.useState(null),[x,ke]=l.useState(null),[jt,Ge]=l.useState(!1),[Q,Me]=l.useState({stories:!1,purchases:!1,credits:!1}),[me,ge]=l.useState([]),[Ce,bt]=l.useState([]),[we,He]=l.useState(!1),[Pe,Be]=l.useState(!1),[K,he]=l.useState(null),[Ve,Re]=l.useState(""),[Je,Oe]=l.useState(""),[pe,qe]=l.useState(1),[Ke,Qe]=l.useState(!1),[te,Nt]=l.useState([]),[Se,Ze]=l.useState(!1),[We,Xe]=l.useState(null),s=yt[k]||yt.en,Ye=async()=>{if(!y){R(!0);try{const t=await u.getStats();f(t)}catch(t){console.error("Failed to load stats:",t)}finally{R(!1)}}},vt=async()=>{try{const t=await u.getTokenPromo();qe(t.multiplier)}catch(t){console.error("Failed to load token promo:",t)}},kt=async()=>{Qe(!0);try{const t=pe===1?2:1;await u.setTokenPromo(t),qe(t),d({type:"success",text:t===2?"2x Token Promotion ENABLED":"2x Token Promotion DISABLED"})}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed to toggle token promo"})}finally{Qe(!1)}},et=async(t=1,i="")=>{V(!0),F(null);try{const o=await u.getUsers({page:t,limit:50,search:i});$(o.users||[]),le(o.pagination||null)}catch(o){F(o instanceof Error?o.message:"Unknown error")}finally{V(!1)}},ue=async(t=1,i="")=>{await et(t,i),h==="stats"&&await Ye()},ye=t=>{_(t),ue(t,J)},tt=()=>{_(1),ue(1,J)};l.useEffect(()=>{B&&((g==null?void 0:g.role)==="admin"||I)&&et()},[B,g,I]),l.useEffect(()=>{B&&((g==null?void 0:g.role)==="admin"||I)&&h==="stats"&&(Ye(),vt())},[B,g,I,h]);const se=t=>{G(t),z(t==="stats"?{}:{tab:t})},Ct=async()=>{c(!0);try{const t=await u.cleanOrphanedFiles();d({type:"success",text:s.cleaned.replace("{count}",String(t.cleaned))}),ue()}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{c(!1)}},wt=async()=>{c(!0);try{const t=await u.exportUserData(),i=URL.createObjectURL(t),o=document.createElement("a");o.href=i,o.download="users-export.json",o.click(),URL.revokeObjectURL(i)}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{c(!1)}},Pt=async()=>{c(!0);try{await u.clearCache(),d({type:"success",text:s.cacheCleared})}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{c(!1)}},St=async()=>{if(b){c(!0);try{const t=T==="-1"?-1:parseInt(T,10);await u.updateUserCredits(b.id,t),$(E.map(i=>i.id===b.id?{...i,credits:t}:i)),w(null),P("")}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{c(!1)}}},Tt=async t=>{const i=t.role==="admin"?"user":"admin";c(!0);try{await u.updateUserRole(t.id,i),$(E.map(o=>o.id===t.id?{...o,role:i}:o))}catch(o){d({type:"error",text:o instanceof Error?o.message:"Failed"})}finally{c(!1)}},zt=async t=>{if(confirm(s.confirmDelete)){c(!0);try{await u.deleteUser(t.id),$(E.filter(i=>i.id!==t.id))}catch(i){d({type:"error",text:i instanceof Error?i.message:"Failed"})}finally{c(!1)}}},At=async t=>{const i=!t.emailVerified;c(!0);try{await u.toggleEmailVerified(t.id,i),$(E.map(o=>o.id===t.id?{...o,emailVerified:i}:o)),d({type:"success",text:`Email ${i?"verified":"unverified"} for ${t.username}`})}catch(o){d({type:"error",text:o instanceof Error?o.message:"Failed"})}finally{c(!1)}},Ut=async t=>{const o=!!!t.photoConsentAt;c(!0);try{const v=await u.togglePhotoConsent(t.id,o);$(E.map(H=>H.id===t.id?{...H,photoConsentAt:v.user.photoConsentAt}:H)),d({type:"success",text:`Photo consent ${o?"granted":"revoked"} for ${t.username}`})}catch(v){d({type:"error",text:v instanceof Error?v.message:"Failed"})}finally{c(!1)}},_t=async t=>{c(!0);try{await Y(t.id),a("/")}catch(i){d({type:"error",text:i instanceof Error?i.message:"Impersonation failed"})}finally{c(!1)}},Dt=async t=>{q(t),Le(!0),ve([]);try{const i=await u.getCreditHistory(t.id);ve(i.transactions)}catch(i){d({type:"error",text:i instanceof Error?i.message:"Failed to load credit history"}),q(null)}finally{Le(!1)}},fe=async t=>{xe(t),Ge(!0),ke(null),Me({stories:!1,purchases:!1,credits:!1});try{const i=await u.getUserDetails(t.id);ke(i)}catch(i){d({type:"error",text:i instanceof Error?i.message:"Failed to load user details"}),xe(null)}finally{Ge(!1)}},Te=t=>{Me(i=>({...i,[t]:!i[t]}))},ze=t=>t?new Date(t).toLocaleDateString()+" "+new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.never,Ae=async()=>{He(!0);try{const t=await u.getPrintProducts();ge(t.products||[])}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed to load products"})}finally{He(!1)}},Ft=async()=>{Be(!0);try{const t=await u.fetchGelatoProducts();bt(t.products||[])}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed to fetch from Gelato"})}finally{Be(!1)}},It=async t=>{var i,o;c(!0);try{const v=(t.name||t.productName||"").match(/(\d+)x(\d+)/i),H=v?`${v[1]}x${v[2]}mm`:"",ae=t.productUid||t.uid||"",re=ae.toLowerCase().includes("hardcover")?"hardcover":"softcover",_e={product_uid:ae,product_name:t.name||t.productName||"Unknown Product",description:t.description||"",size:H,cover_type:re,min_pages:((i=t.pageCount)==null?void 0:i.min)||24,max_pages:((o=t.pageCount)==null?void 0:o.max)||100,available_page_counts:[],is_active:!0};await u.createPrintProduct(_e),d({type:"success",text:"Product added successfully"}),Ae()}catch(v){d({type:"error",text:v instanceof Error?v.message:"Failed to add product"})}finally{c(!1)}},Et=async t=>{c(!0);try{await u.togglePrintProduct(t.id,t.is_active),ge(i=>i.map(o=>o.id===t.id?{...o,is_active:!o.is_active}:o))}catch(i){d({type:"error",text:i instanceof Error?i.message:"Failed to toggle product"})}finally{c(!1)}},$t=async t=>{if(confirm(s.confirmDeleteProduct)){c(!0);try{await u.deletePrintProduct(t.id),ge(i=>i.filter(o=>o.id!==t.id))}catch(i){d({type:"error",text:i instanceof Error?i.message:"Failed to delete product"})}finally{c(!1)}}},Lt=t=>{he(t),Re(String(t.min_pages)),Oe(String(t.max_pages))},Gt=async()=>{if(K){c(!0);try{const t=parseInt(Ve,10),i=parseInt(Je,10);if(isNaN(t)||isNaN(i)||t<1||i<t){d({type:"error",text:"Invalid page range"});return}await u.updatePrintProduct(K.id,{min_pages:t,max_pages:i}),ge(o=>o.map(v=>v.id===K.id?{...v,min_pages:t,max_pages:i}:v)),he(null),d({type:"success",text:"Product updated successfully"})}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed to update product"})}finally{c(!1)}}};l.useEffect(()=>{h==="products"&&me.length===0&&Ae()},[h]);const Ue=async()=>{Ze(!0);try{const t=await u.getFailedJobs();Nt(t.jobs||[])}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed to load jobs"})}finally{Ze(!1)}},Mt=async t=>{Xe(t);try{const i=await u.retryFailedJob(t);await u.startJob(i.newJobId),d({type:"success",text:`Job retried successfully. New job ID: ${i.newJobId}`}),Ue()}catch(i){d({type:"error",text:i instanceof Error?i.message:"Failed to retry job"})}finally{Xe(null)}};return l.useEffect(()=>{h==="jobs"&&Ue()},[h]),ne?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:e.jsx(A,{className:"w-12 h-12 animate-spin text-indigo-600"})}):!B||(g==null?void 0:g.role)!=="admin"&&!I?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center max-w-md",children:[e.jsx(ot,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s.accessDenied}),e.jsx("p",{className:"text-gray-600 mb-6",children:s.accessDeniedDesc}),e.jsx(j,{onClick:()=>a("/"),children:s.goHome})]})}):D?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:e.jsx(A,{className:"w-12 h-12 animate-spin text-indigo-600"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 py-8 px-4",children:[e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>a("/"),className:"p-2 rounded-lg hover:bg-white/50 transition-colors",children:e.jsx(Zt,{size:24})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:s.title})]}),e.jsxs(j,{variant:"outline",onClick:()=>ue(r,J),disabled:D,children:[e.jsx(ie,{size:16,className:D?"animate-spin":""}),s.refreshStats]})]}),L&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:L}),M&&e.jsxs("div",{className:`px-4 py-3 rounded-lg mb-6 ${M.type==="success"?"bg-green-100 border border-green-400 text-green-700":"bg-red-100 border border-red-400 text-red-700"}`,children:[M.text,e.jsx("button",{onClick:()=>d(null),className:"float-right font-bold",children:"×"})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:()=>se("stats"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${h==="stats"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:s.stats}),e.jsx("button",{onClick:()=>se("users"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${h==="users"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:s.users}),e.jsxs("button",{onClick:()=>se("products"),className:`px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 ${h==="products"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(Wt,{size:18}),s.printProducts]}),e.jsxs("button",{onClick:()=>se("tokens"),className:`px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 ${h==="tokens"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(Ne,{size:18}),s.tokenUsage]}),e.jsxs("button",{onClick:()=>se("jobs"),className:`px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 ${h==="jobs"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(De,{size:18}),s.failedJobs||"Failed Jobs",te.length>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:te.length})]})]}),h==="stats"&&e.jsxs(e.Fragment,{children:[O?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(A,{className:"w-8 h-8 animate-spin text-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading statistics..."})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(Z,{icon:e.jsx(be,{className:"w-8 h-8 text-purple-600"}),title:s.totalUsers,value:(y==null?void 0:y.totalUsers)??0}),e.jsx(Z,{icon:e.jsx(Ie,{className:"w-8 h-8 text-pink-600"}),title:s.totalStories,value:(y==null?void 0:y.totalStories)??0}),e.jsx(Z,{icon:e.jsx(be,{className:"w-8 h-8 text-blue-600"}),title:s.totalCharacters,value:(y==null?void 0:y.totalCharacters)??0}),e.jsx(Z,{icon:e.jsx(xt,{className:"w-8 h-8 text-green-600"}),title:s.totalImages,value:(y==null?void 0:y.totalImages)??0}),e.jsx(Z,{icon:e.jsx(ot,{className:"w-8 h-8 text-yellow-600"}),title:s.orphanedFiles,value:(y==null?void 0:y.orphanedFiles)??0}),e.jsx(Z,{icon:e.jsx(ss,{className:"w-8 h-8 text-indigo-600"}),title:s.databaseSize,value:(y==null?void 0:y.databaseSize)??"N/A",isString:!0})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:s.adminActions}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(j,{variant:"secondary",onClick:Ct,disabled:N,children:[e.jsx(Ee,{size:16}),s.cleanOrphaned]}),e.jsxs(j,{variant:"secondary",onClick:wt,disabled:N,children:[e.jsx(Qt,{size:16}),s.exportData]}),e.jsxs(j,{variant:"secondary",onClick:()=>a("/admin/logs"),disabled:N,children:[e.jsx(Jt,{size:16}),s.viewLogs]}),e.jsxs(j,{variant:"danger",onClick:Pt,disabled:N,children:[e.jsx(ie,{size:16}),s.clearCache]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mt-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:k==="de"?"Aktionen":"Promotions"}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:k==="de"?"2x Token Aktion":k==="fr"?"Promotion 2x Jetons":"2x Token Promotion"}),e.jsx("p",{className:"text-sm text-gray-600",children:k==="de"?"Kunden erhalten die doppelte Anzahl Tokens beim Buchkauf (20 pro Seite statt 10)":k==="fr"?"Les clients reçoivent le double de jetons lors de l'achat de livres (20 par page au lieu de 10)":"Customers receive double tokens on book purchases (20 per page instead of 10)"})]}),e.jsxs("button",{onClick:kt,disabled:Ke,className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${pe===2?"bg-green-500 text-white hover:bg-green-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[Ke?e.jsx(A,{className:"w-5 h-5 animate-spin"}):pe===2?e.jsx(ut,{size:20}):e.jsx(pt,{size:20}),pe===2?k==="de"?"AKTIV":k==="fr"?"ACTIF":"ACTIVE":k==="de"?"INAKTIV":k==="fr"?"INACTIF":"INACTIVE"]})]})]})]}),h==="users"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50 flex gap-2 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ht,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:s.searchUsers||"Search users...",value:J,onChange:t=>oe(t.target.value),onKeyDown:t=>t.key==="Enter"&&tt(),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsx(j,{onClick:tt,variant:"secondary",size:"sm",children:s.search||"Search"}),m&&e.jsx("span",{className:"text-sm text-gray-500 ml-auto",children:((st=s.showingUsers)==null?void 0:st.replace("{from}",String((m.page-1)*m.limit+1)).replace("{to}",String(Math.min(m.page*m.limit,m.totalUsers))).replace("{total}",String(m.totalUsers)))||`Showing ${(m.page-1)*m.limit+1}-${Math.min(m.page*m.limit,m.totalUsers)} of ${m.totalUsers}`})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.username}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.email}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.role}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.credits}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.actions})]})}),e.jsx("tbody",{className:"divide-y",children:E.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm cursor-pointer hover:text-indigo-600 hover:underline",onClick:()=>fe(t),children:t.username}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 cursor-pointer hover:text-indigo-600",onClick:()=>fe(t),children:t.email}),e.jsx("td",{className:"px-4 py-3 cursor-pointer",onClick:()=>fe(t),children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.role==="admin"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:t.role})}),e.jsx("td",{className:"px-4 py-3 text-sm cursor-pointer hover:text-indigo-600",onClick:()=>fe(t),children:t.credits===-1?s.unlimited:t.credits}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{w(t),P(String(t.credits))},className:"p-1 rounded hover:bg-gray-100 text-blue-600",title:s.editCredits,children:e.jsx(mt,{size:16})}),e.jsx("button",{onClick:()=>Tt(t),className:`p-1 rounded hover:bg-gray-100 ${t.role==="admin"?"text-yellow-600":"text-purple-600"}`,title:t.role==="admin"?s.removeAdmin:s.makeAdmin,disabled:t.id===(g==null?void 0:g.id),children:t.role==="admin"?e.jsx(is,{size:16}):e.jsx(ns,{size:16})}),e.jsx("button",{onClick:()=>Dt(t),className:"p-1 rounded hover:bg-gray-100 text-green-600",title:s.viewHistory||"View History",children:e.jsx(gt,{size:16})}),e.jsx("button",{onClick:()=>At(t),className:`p-1 rounded hover:bg-gray-100 ${t.emailVerified?"text-emerald-600":"text-orange-500"}`,title:t.emailVerified?"Email verified - click to unverify":"Email NOT verified - click to verify",children:t.emailVerified?e.jsx(Ot,{size:16}):e.jsx(rs,{size:16})}),e.jsx("button",{onClick:()=>Ut(t),className:`p-1 rounded hover:bg-gray-100 ${t.photoConsentAt?"text-emerald-600":"text-orange-500"}`,title:t.photoConsentAt?"Photo consent given - click to revoke":"Photo consent NOT given - click to grant",children:t.photoConsentAt?e.jsx(Xt,{size:16}):e.jsx(ts,{size:16})}),e.jsx("button",{onClick:()=>_t(t),className:"p-1 rounded hover:bg-gray-100 text-cyan-600",title:s.impersonate,disabled:t.id===(g==null?void 0:g.id),children:e.jsx(ct,{size:16})}),e.jsx("button",{onClick:()=>zt(t),className:"p-1 rounded hover:bg-gray-100 text-red-600",title:s.deleteUser,disabled:t.id===(g==null?void 0:g.id),children:e.jsx(Ee,{size:16})})]})})]},t.id))})]})}),m&&m.totalPages>1&&e.jsxs("div",{className:"p-4 border-t bg-gray-50 flex justify-center items-center gap-2",children:[e.jsx(j,{onClick:()=>ye(1),disabled:!m.hasPrevPage,variant:"secondary",size:"sm",children:"<<"}),e.jsx(j,{onClick:()=>ye(r-1),disabled:!m.hasPrevPage,variant:"secondary",size:"sm",children:"<"}),e.jsx("span",{className:"px-4 py-2 text-sm",children:((at=s.pageOf)==null?void 0:at.replace("{page}",String(m.page)).replace("{total}",String(m.totalPages)))||`Page ${m.page} of ${m.totalPages}`}),e.jsx(j,{onClick:()=>ye(r+1),disabled:!m.hasNextPage,variant:"secondary",size:"sm",children:">"}),e.jsx(j,{onClick:()=>ye(m.totalPages),disabled:!m.hasNextPage,variant:"secondary",size:"sm",children:">>"})]})]}),h==="products"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:s.printProducts}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"secondary",onClick:Ae,disabled:we,children:[e.jsx(ie,{size:16,className:we?"animate-spin":""}),s.refreshStats]}),e.jsxs(j,{onClick:Ft,disabled:Pe,children:[e.jsx(ht,{size:16,className:Pe?"animate-spin":""}),s.fetchFromGelato]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:s.savedProducts}),we?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(A,{className:"w-8 h-8 animate-spin text-indigo-600"})}):me.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:s.noProducts}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.productName}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.size}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.coverType}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.pages}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.status}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.actions})]})}),e.jsx("tbody",{className:"divide-y",children:me.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:t.product_name}),e.jsxs("div",{className:"text-xs text-gray-500 font-mono truncate max-w-xs",title:t.product_uid,children:[t.product_uid.substring(0,40),"..."]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.size||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.cover_type==="hardcover"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:t.cover_type==="hardcover"?s.hardcover:s.softcover})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[t.min_pages," - ",t.max_pages]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.is_active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:t.is_active?s.active:s.inactive})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Lt(t),className:"p-1.5 rounded hover:bg-gray-100 text-indigo-600",title:s.editPages,disabled:N,children:e.jsx(mt,{size:16})}),e.jsx("button",{onClick:()=>Et(t),className:`p-1.5 rounded hover:bg-gray-100 ${t.is_active?"text-green-600":"text-gray-400"}`,title:t.is_active?s.active:s.inactive,disabled:N,children:t.is_active?e.jsx(ut,{size:20}):e.jsx(pt,{size:20})}),e.jsx("button",{onClick:()=>$t(t),className:"p-1.5 rounded hover:bg-gray-100 text-red-600",title:s.deleteUser,disabled:N,children:e.jsx(Ee,{size:16})})]})})]},t.id))})]})})]}),Ce.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:[s.gelatoProducts," (",Ce.length,")"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:s.selectProduct}),e.jsx("div",{className:"grid gap-3 max-h-96 overflow-y-auto",children:Ce.map(t=>{const i=t.productUid||t.uid||"",o=t.name||t.productName||"Unknown",v=i.toLowerCase().includes("hardcover"),H=o.match(/(\d+)x(\d+)/i),ae=H?`${H[1]}x${H[2]}mm`:"",re=me.some(_e=>_e.product_uid===i);return e.jsx("div",{className:`p-4 border rounded-lg ${re?"bg-gray-50 opacity-60":"hover:border-indigo-300 cursor-pointer"}`,onClick:()=>!re&&It(t),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:o}),e.jsxs("div",{className:"text-xs text-gray-500 font-mono mt-1 truncate",title:i,children:[i.substring(0,60),"..."]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[ae&&e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:ae}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${v?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:v?s.hardcover:s.softcover})]})]}),re?e.jsx(Yt,{size:20,className:"text-green-600"}):e.jsx(qt,{size:20,className:"text-indigo-600"})]})},i)})})]}),Pe&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 text-center",children:[e.jsx(A,{className:"w-8 h-8 animate-spin text-indigo-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:s.fetching})]})]}),h==="tokens"&&e.jsx(ls,{texts:s}),h==="jobs"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(De,{className:"text-red-500"}),s.failedJobs||"Failed Jobs"," (",te.length,")"]}),e.jsxs(j,{onClick:Ue,variant:"secondary",className:"flex items-center gap-2",disabled:Se,children:[e.jsx(ie,{size:16,className:Se?"animate-spin":""}),"Refresh"]})]}),Se?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(A,{className:"w-8 h-8 animate-spin text-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading failed jobs..."})]}):te.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(De,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No failed jobs in the last 7 days"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500",children:"Job ID"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500",children:"Story"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500",children:"Progress"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500",children:"Error"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500",children:"Created"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500",children:"Actions"})]})}),e.jsx("tbody",{children:te.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:[t.id.substring(0,20),"..."]})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.username||"Unknown"}),e.jsx("div",{className:"text-xs text-gray-500",children:t.email})]}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:t.story_category||t.story_type}),e.jsxs("span",{className:"text-gray-500 ml-2",children:[t.pages," pages"]})]}),e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs",title:t.story_preview,children:t.story_preview||"No preview"})]}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-2 rounded-full",style:{width:`${t.progress}%`}})}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.progress,"%"]})]}),e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs",children:t.progress_message})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-xs text-red-600 max-w-xs truncate",title:t.error_message,children:t.error_message||"Unknown error"})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500",children:ze(t.created_at)}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Mt(t.id),disabled:We===t.id,className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors disabled:opacity-50",title:"Retry this job",children:We===t.id?e.jsx(A,{size:16,className:"animate-spin"}):e.jsx(Kt,{size:16})}),e.jsx("button",{onClick:()=>Y(t.user_id),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Impersonate user",children:e.jsx(ct,{size:16})})]})})]},t.id))})]})})]})]}),e.jsx(je,{isOpen:!!b,onClose:()=>{w(null),P("")},title:s.editCredits,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:[b==null?void 0:b.username," (",b==null?void 0:b.email,")"]}),e.jsx(Fe,{label:s.newCredits,type:"number",value:T,onChange:t=>P(t.target.value),placeholder:"-1 for unlimited"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(j,{variant:"secondary",onClick:()=>w(null),children:s.cancel}),e.jsx(j,{onClick:St,disabled:N,children:s.save})]})]})}),e.jsx(je,{isOpen:!!S,onClose:()=>{q(null),ve([])},title:`${s.creditHistory||"Credit History"}: ${(S==null?void 0:S.username)||""}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:s.currentBalance||"Current Balance"}),e.jsx("p",{className:"text-2xl font-bold text-indigo-800",children:(S==null?void 0:S.credits)===-1?s.unlimited||"Unlimited":S==null?void 0:S.credits})]}),ft?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(A,{className:"w-8 h-8 animate-spin text-indigo-600"})}):ce.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:s.noTransactions||"No transactions found"}):e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:s.date||"Date"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:s.type||"Type"}),e.jsx("th",{className:"px-3 py-2 text-right font-semibold text-gray-700",children:s.amount||"Amount"}),e.jsx("th",{className:"px-3 py-2 text-right font-semibold text-gray-700",children:s.balance||"Balance"})]})}),e.jsx("tbody",{className:"divide-y",children:ce.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-3 py-2 text-gray-600",children:[new Date(t.createdAt).toLocaleDateString()," ",new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${t.type==="story_reserve"?"bg-yellow-100 text-yellow-700":t.type==="story_complete"?"bg-green-100 text-green-700":t.type==="story_refund"?"bg-blue-100 text-blue-700":t.type==="admin_add"?"bg-purple-100 text-purple-700":t.type==="admin_deduct"?"bg-red-100 text-red-700":t.type==="initial"?"bg-gray-100 text-gray-700":t.type==="book_purchase_reward"?"bg-amber-100 text-amber-700":t.type==="purchase"?"bg-emerald-100 text-emerald-700":"bg-gray-100 text-gray-700"}`,children:t.type.replace(/_/g," ")})}),e.jsxs("td",{className:`px-3 py-2 text-right font-medium ${t.amount>0?"text-green-600":t.amount<0?"text-red-600":"text-gray-600"}`,children:[t.amount>0?"+":"",t.amount]}),e.jsx("td",{className:"px-3 py-2 text-right font-medium text-gray-800",children:t.balanceAfter})]},t.id))})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{variant:"secondary",onClick:()=>q(null),children:s.cancel||"Close"})})]})}),e.jsx(je,{isOpen:!!de,onClose:()=>{xe(null),ke(null)},title:`${s.userDetails}: ${(de==null?void 0:de.username)||""}`,children:e.jsxs("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto",children:[jt?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(A,{className:"w-8 h-8 animate-spin text-indigo-600"})}):x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.email}),e.jsx("p",{className:"font-medium text-gray-800",children:x.user.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.role}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${x.user.role==="admin"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:x.user.role})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{size:14,className:"text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.memberSince}),e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:ze(x.user.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{size:14,className:"text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.lastLogin}),e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:ze(x.user.lastLogin)})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-pink-50 rounded-lg p-3 text-center",children:[e.jsx(Ie,{size:20,className:"mx-auto text-pink-600 mb-1"}),e.jsx("p",{className:"text-2xl font-bold text-pink-700",children:x.stats.totalStories}),e.jsx("p",{className:"text-xs text-pink-600",children:s.stories})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx(be,{size:20,className:"mx-auto text-blue-600 mb-1"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:x.stats.totalCharacters}),e.jsx("p",{className:"text-xs text-blue-600",children:s.characters})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[e.jsx(xt,{size:20,className:"mx-auto text-green-600 mb-1"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:x.stats.totalImages}),e.jsx("p",{className:"text-xs text-green-600",children:s.images})]}),e.jsxs("div",{className:"bg-amber-50 rounded-lg p-3 text-center",children:[e.jsx(dt,{size:20,className:"mx-auto text-amber-600 mb-1"}),e.jsx("p",{className:"text-2xl font-bold text-amber-700",children:x.stats.totalPurchases}),e.jsx("p",{className:"text-xs text-amber-600",children:s.purchases})]})]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:s.currentBalance}),e.jsx("p",{className:"text-xl font-bold text-indigo-800",children:x.user.credits===-1?s.unlimited:x.user.credits})]}),x.stats.totalSpent>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:s.totalSpent}),e.jsxs("p",{className:"text-xl font-bold text-indigo-800",children:["$",x.stats.totalSpent.toFixed(2)]})]})]}),x.stats.tokenUsage&&x.stats.tokenUsage.totalInputTokens>0&&e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-600 font-medium mb-2",children:s.totalTokens}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xl font-bold text-orange-700",children:[(x.stats.tokenUsage.totalInputTokens/1e3).toFixed(1),"K"]}),e.jsx("p",{className:"text-xs text-orange-600",children:s.inputTokens})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xl font-bold text-orange-700",children:[(x.stats.tokenUsage.totalOutputTokens/1e3).toFixed(1),"K"]}),e.jsx("p",{className:"text-xs text-orange-600",children:s.outputTokens})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-orange-700",children:x.stats.tokenUsage.totalCalls}),e.jsx("p",{className:"text-xs text-orange-600",children:s.apiCalls})]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-orange-200 text-xs text-orange-600 grid grid-cols-2 gap-1",children:[e.jsxs("span",{children:["Anthropic: ",((((rt=x.stats.tokenUsage.anthropic)==null?void 0:rt.input_tokens)||0)/1e3).toFixed(1),"K in / ",((((it=x.stats.tokenUsage.anthropic)==null?void 0:it.output_tokens)||0)/1e3).toFixed(1),"K out"]}),e.jsxs("span",{children:["Gemini: ",((((nt=x.stats.tokenUsage.gemini_image)==null?void 0:nt.input_tokens)||0)/1e3).toFixed(1),"K in / ",((((lt=x.stats.tokenUsage.gemini_image)==null?void 0:lt.output_tokens)||0)/1e3).toFixed(1),"K out"]})]})]}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("button",{onClick:()=>Te("stories"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Ie,{size:16}),s.stories," (",x.stories.length,")"]}),Q.stories?e.jsx(W,{size:16}):e.jsx(X,{size:16})]}),Q.stories&&e.jsx("div",{className:"border-t px-4 py-3 max-h-48 overflow-y-auto",children:x.stories.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-2",children:s.noStories}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"pb-2",children:s.storyTitle}),e.jsx("th",{className:"pb-2",children:s.pages}),e.jsx("th",{className:"pb-2",children:s.images}),e.jsx("th",{className:"pb-2",children:s.date})]})}),e.jsx("tbody",{children:x.stories.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 font-medium",children:t.title}),e.jsx("td",{className:"py-2",children:t.pageCount}),e.jsx("td",{className:"py-2",children:t.imageCount}),e.jsx("td",{className:"py-2 text-gray-500",children:new Date(t.createdAt).toLocaleDateString()})]},t.id))})]})})]}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("button",{onClick:()=>Te("purchases"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(dt,{size:16}),s.purchaseHistory," (",x.purchases.length,")"]}),Q.purchases?e.jsx(W,{size:16}):e.jsx(X,{size:16})]}),Q.purchases&&e.jsx("div",{className:"border-t px-4 py-3 max-h-48 overflow-y-auto",children:x.purchases.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-2",children:s.noPurchases}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"pb-2",children:s.date}),e.jsx("th",{className:"pb-2",children:s.amount}),e.jsx("th",{className:"pb-2",children:s.status}),e.jsx("th",{className:"pb-2",children:s.product})]})}),e.jsx("tbody",{children:x.purchases.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 text-gray-500",children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"py-2 font-medium",children:[t.currency," ",t.amount]}),e.jsx("td",{className:"py-2",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${t.status==="paid"?"bg-green-100 text-green-700":t.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"py-2 text-gray-600 text-xs",children:t.productVariant||"-"})]},t.id))})]})})]}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("button",{onClick:()=>Te("credits"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(gt,{size:16}),s.creditHistory," (",x.creditHistory.length,")"]}),Q.credits?e.jsx(W,{size:16}):e.jsx(X,{size:16})]}),Q.credits&&e.jsx("div",{className:"border-t px-4 py-3 max-h-48 overflow-y-auto",children:x.creditHistory.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-2",children:s.noTransactions}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"pb-2",children:s.date}),e.jsx("th",{className:"pb-2",children:s.type}),e.jsx("th",{className:"pb-2 text-right",children:s.amount}),e.jsx("th",{className:"pb-2 text-right",children:s.balance})]})}),e.jsx("tbody",{children:x.creditHistory.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 text-gray-500",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"py-2",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${t.type==="admin_add"?"bg-purple-100 text-purple-700":t.type==="story_complete"?"bg-green-100 text-green-700":t.type==="story_refund"?"bg-blue-100 text-blue-700":t.type==="story_reserve"?"bg-yellow-100 text-yellow-700":t.type==="book_purchase_reward"?"bg-amber-100 text-amber-700":t.type==="purchase"?"bg-emerald-100 text-emerald-700":"bg-gray-100 text-gray-700"}`,children:t.type.replace(/_/g," ")})}),e.jsxs("td",{className:`py-2 text-right font-medium ${t.amount>0?"text-green-600":"text-red-600"}`,children:[t.amount>0?"+":"",t.amount]}),e.jsx("td",{className:"py-2 text-right font-medium",children:t.balanceAfter})]},t.id))})]})})]})]}):e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Failed to load user details"}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(j,{variant:"secondary",onClick:()=>xe(null),children:s.close})})]})}),e.jsx(je,{isOpen:!!K,onClose:()=>he(null),title:s.editPages,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:K==null?void 0:K.product_name}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Fe,{label:s.minPages,type:"number",value:Ve,onChange:t=>Re(t.target.value),min:1}),e.jsx(Fe,{label:s.maxPages,type:"number",value:Je,onChange:t=>Oe(t.target.value),min:1})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(j,{variant:"secondary",onClick:()=>he(null),children:s.cancel}),e.jsx(j,{onClick:Gt,disabled:N,children:s.save})]})]})})]})}export{Ns as default};
