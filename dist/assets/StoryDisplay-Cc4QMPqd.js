import{c as Ie,d as sa,j as e,L as pe,s as at,u as it,T as ta,X as Pe}from"./index-C3uMI6QL.js";import{b as P}from"./vendor-react-CqfXSjHo.js";import{U as Nt}from"./Input-Y22R6JyI.js";import{S as ra}from"./Textarea-BM5hOAoI.js";import{H as aa,F as ns}from"./history-CCYLNVCw.js";import{D as qe}from"./download-JtJqkKak.js";import{C as He}from"./chevron-down-B9xDiT37.js";import{C as jt}from"./chevron-right-BggSWfZN.js";import{I as ia}from"./ImageLightbox-BypBh19s.js";import{P as de}from"./StoryWizard-BwbxTX-n.js";import{C as wr}from"./chevron-up-Ctd3lWrq.js";import{R as ke,b as ut}from"./Modal-C079ErNU.js";import{P as na}from"./palette-BtlCJXyJ.js";import{B as la}from"./book-D9tJnE57.js";import{C as oa}from"./check-BfDxjMPu.js";import{S as as}from"./save-C7iIdiHn.js";import{S as Sr}from"./shopping-cart-BRPpAMDc.js";import{P as Cr}from"./plus-Bhh2lyvA.js";import{B as bt}from"./book-open-tlDZzxQl.js";import{W as is}from"./wrench-Swfl6jdK.js";import"./vendor-firebase-DTVMaYMy.js";import"./sparkles-ag-kx_8I.js";import"./circle-x-Bs_QdcBI.js";import"./clock-CIHAPNLz.js";import"./arrow-left-BR22WrXS.js";import"./arrow-right-B4YQ4-r_.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=Ie("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=Ie("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=Ie("Images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=Ie("Link2Off",[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=Ie("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=Ie("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=Ie("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $r=Ie("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=Ie("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Le=sa("ImageLoad");function tt({src:d,alt:$,className:x,label:m}){const[p,R]=P.useState(!0),[S,F]=P.useState(null),b=P.useRef(0),v=P.useRef(null);P.useEffect(()=>{d&&d.length>100?(b.current=Date.now(),Le.info(`‚è≥ Loading ${m||$}`,{isBase64:d==null?void 0:d.startsWith("data:"),sizeKB:Math.round(d.length*3/4/1024)})):b.current=0,R(!0),F(null)},[d,$,m]);const w=()=>{if(R(!1),b.current===0){Le.info(`‚úÖ Loaded ${m||$} (placeholder/empty)`);return}const D=Date.now()-b.current;F(D);const h=(d==null?void 0:d.startsWith("data:"))?Math.round(d.length*3/4/1024):null,c=v.current?`${v.current.naturalWidth}x${v.current.naturalHeight}`:"unknown";D<100?Le.success(`‚úÖ Loaded ${m||$} in ${D}ms`,{sizeKB:h,naturalSize:c}):D<500?Le.info(`‚úÖ Loaded ${m||$} in ${D}ms`,{sizeKB:h,naturalSize:c}):D<2e3?Le.warn(`‚ö†Ô∏è Slow load: ${m||$} took ${D}ms`,{sizeKB:h,naturalSize:c}):Le.error(`üê¢ Very slow: ${m||$} took ${D}ms`,{sizeKB:h,naturalSize:c}),D>1e3&&ga({type:"slow_image_load",label:m||$,loadTimeMs:D,sizeKB:h,naturalSize:c,userAgent:navigator.userAgent,timestamp:new Date().toISOString()})},f=()=>{if(R(!1),b.current===0){Le.error(`‚ùå Failed to load ${m||$} (no data received)`);return}const D=Date.now()-b.current;Le.error(`‚ùå Failed to load ${m||$} after ${D}ms`)};return e.jsx("img",{ref:v,src:d,alt:$,className:x,onLoad:w,onError:f,draggable:!1})}async function ga(d){try{await fetch("/api/log-error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errorType:"Performance",message:`Slow image load: ${d.label} took ${d.loadTimeMs}ms`,userAgent:d.userAgent,timestamp:d.timestamp,url:window.location.href})})}catch{}}function zs(d,$){const x=new Blob([d],{type:"text/plain;charset=utf-8"}),m=URL.createObjectURL(x),p=document.createElement("a");p.href=m,p.download=$,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(m)}function yt(d,$=0){const x="  ".repeat($);if(d==null)return`${x}null`;if(typeof d=="boolean")return`${x}${d?"YES":"NO"}`;if(typeof d=="number")return`${x}${d}`;if(typeof d=="string")return`${x}${d}`;if(Array.isArray(d))return d.length===0?`${x}[]`:d.map((m,p)=>`${x}[${p}]: ${yt(m,0)}`).join(`
`);if(typeof d=="object"){const m=Object.entries(d);return m.length===0?`${x}{}`:m.map(([p,R])=>{const S=yt(R,$+1);return typeof R=="object"&&R!==null?`${x}${p}:
${S}`:`${x}${p}: ${S.trim()}`}).join(`
`)}return`${x}${String(d)}`}function rt({data:d,language:$,title:x}){const[m,p]=P.useState(new Set);if(!d)return e.jsx("div",{className:"text-gray-400 italic text-sm",children:$==="de"?"Keine Daten":"No data"});let R=d;if(typeof d=="string")try{R=JSON.parse(d)}catch{return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-1",children:e.jsxs("button",{onClick:()=>zs(d,`${x||"evaluation"}.txt`),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1",title:"Download as text file",children:[e.jsx(qe,{size:12})," Download"]})}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap bg-gray-50 p-3 rounded max-h-80 overflow-auto font-mono",children:d})]})}const S=v=>{const w=new Set(m);w.has(v)?w.delete(v):w.add(v),p(w)},F=()=>{const v=yt(R);zs(v,`${x||"evaluation"}.txt`)},b=(v,w,f=0)=>{const D=m.has(v);if(w==null)return e.jsx("span",{className:"text-gray-400",children:"null"});if(typeof w=="boolean")return e.jsx("span",{className:w?"text-green-600 font-medium":"text-red-600 font-medium",children:w?"‚úì":"‚úó"});if(typeof w=="number"){const K=w>=70?"text-green-600":w>=50?"text-yellow-600":"text-red-600";return e.jsx("span",{className:`font-bold ${K}`,children:w})}if(typeof w=="string")return w.length>100?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>S(v),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[D?e.jsx(He,{size:14}):e.jsx(jt,{size:14}),D?"Collapse":`Show (${w.length} chars)`]}),D&&e.jsx("div",{className:"mt-1 p-2 bg-gray-100 rounded text-sm whitespace-pre-wrap font-mono",children:w})]}):e.jsx("span",{className:"text-gray-700",children:w});if(Array.isArray(w))return w.length===0?e.jsx("span",{className:"text-gray-400",children:"[]"}):e.jsx("div",{className:"ml-2 border-l-2 border-gray-200 pl-2",children:w.map((K,h)=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"text-gray-400 text-xs",children:["[",h,"]"]})," ",b(`${v}.${h}`,K,f+1)]},h))});if(typeof w=="object"){const K=Object.entries(w);return K.length===0?e.jsx("span",{className:"text-gray-400",children:"{}"}):f>0?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>S(v),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[D?e.jsx(He,{size:14}):e.jsx(jt,{size:14}),D?"Collapse":`{${K.length} fields}`]}),D&&e.jsx("div",{className:"ml-2 mt-1 border-l-2 border-gray-200 pl-2",children:K.map(([h,c])=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-600",children:[h,":"]})," ",b(`${v}.${h}`,c,f+1)]},h))})]}):e.jsx("div",{className:"space-y-1",children:K.map(([h,c])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-600 min-w-[100px]",children:[h,":"]}),e.jsx("div",{className:"flex-1",children:b(`${v}.${h}`,c,f+1)})]},h))})}return e.jsx("span",{children:String(w)})};return e.jsxs("div",{className:"text-sm space-y-1 max-h-[500px] overflow-auto",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("button",{onClick:F,className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-1 bg-blue-50 rounded hover:bg-blue-100",title:"Download as text file",children:[e.jsx(qe,{size:12})," Download"]})}),b("root",R)]})}function ha({beforeImage:d,maskImage:$,onEnlarge:x}){return e.jsxs("div",{className:"relative w-40 h-40 cursor-pointer hover:ring-2 hover:ring-amber-400 rounded overflow-hidden border",onClick:()=>x(d,"Before with Mask"),children:[e.jsx("img",{src:d,alt:"Before",className:"w-full h-full object-contain"}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:{backgroundImage:`url(${$})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",mixBlendMode:"multiply",opacity:.5}}),e.jsx("img",{src:$,alt:"Mask overlay",className:"absolute inset-0 w-full h-full object-contain pointer-events-none",style:{mixBlendMode:"screen",opacity:.7,filter:"sepia(1) saturate(5) hue-rotate(-50deg)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent text-white text-[10px] text-center py-1 font-medium",children:"üéØ Edit Area"})]})}function ls({retryHistory:d,totalAttempts:$,language:x,onRevertRepair:m,storyId:p,pageNumber:R}){const[S,F]=P.useState(null),[b,v]=P.useState({}),[w,f]=P.useState(new Set),D=async T=>{if(!(!p||R===void 0||w.has(T))){f(n=>new Set(n).add(T));try{const n=localStorage.getItem("auth_token"),O=new URLSearchParams({page:String(R),type:"retry",index:String(T)}),G=await fetch(`/api/stories/${p}/dev-image?${O}`,{headers:n?{Authorization:`Bearer ${n}`}:{}});if(G.ok){const U=await G.json();v(u=>({...u,[T]:{imageData:U.imageData,annotatedOriginal:U.annotatedOriginal,grids:U.grids,bboxOverlayImage:U.bboxOverlayImage}}))}}catch(n){console.error(`Failed to load retry images for retry ${T}:`,n)}finally{f(n=>{const O=new Set(n);return O.delete(T),O})}}};if(!d||d.length===0)return null;const K=d.filter(T=>T.type==="auto_repair"||T.type==="grid_repair"||T.type==="grid_repair_failed").length,h=d.filter(T=>T.type==="grid_repair"||T.type==="grid_repair_failed").length,c=d.filter(T=>T.type==="grid_repair_failed").length;return e.jsxs(e.Fragment,{children:[S&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>F(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("div",{className:"absolute -top-8 left-0 text-white text-sm",children:S.title}),e.jsx("img",{src:S.src,alt:S.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute -top-8 right-0 text-white hover:text-gray-300",onClick:()=>F(null),children:"‚úï Close"})]})}),e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(aa,{size:14}),x==="de"?"Generierungshistorie":x==="fr"?"Historique de g√©n√©ration":"Generation History",K>0&&e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded",children:["üîß ",K," ",x==="de"?"Reparatur":"repair",K>1?x==="de"?"en":"s":"",h>0&&e.jsxs("span",{className:"ml-1",children:["(",h," grid",c>0?`, ${c} failed`:"",")"]})]})]}),e.jsxs("span",{className:"text-purple-600",children:[$," ",x==="de"?"Versuche":x==="fr"?"tentatives":"attempts"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:(()=>{const T=d.filter(n=>n.type!=="bbox_detection_only");return T.map((n,O)=>{var G,U;return e.jsxs("div",{className:`border rounded-lg p-3 ${n.type==="grid_repair_failed"?"bg-red-50 border-red-300":n.type==="grid_repair"?"bg-violet-50 border-violet-300":n.type==="auto_repair"?"bg-amber-50 border-amber-300":O===T.length-1?"bg-green-50 border-green-300":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-sm",children:[n.type==="grid_repair_failed"?e.jsx("span",{className:"text-red-700",children:"üî≤ Grid Repair Failed"}):n.type==="grid_repair"?e.jsx("span",{className:"text-violet-700",children:"üî≤ Grid Repair"}):n.type==="auto_repair"?e.jsx("span",{className:"text-amber-700",children:"üîß Auto-Repair"}):e.jsx(e.Fragment,{children:x==="de"?`Versuch ${n.attempt}`:x==="fr"?`Tentative ${n.attempt}`:`Attempt ${n.attempt}`}),n.type==="text_edit"&&e.jsx("span",{className:"text-xs ml-2 text-blue-600",children:"(text edit)"}),n.type==="text_edit_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(text edit failed)"}),n.type==="auto_repair_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(auto-repair failed)"}),O===T.length-1&&n.type!=="auto_repair"&&e.jsx("span",{className:"text-xs ml-2 text-green-600 font-bold",children:"‚úì USED"})]}),n.type==="auto_repair"&&n.preRepairScore!==void 0&&n.postRepairScore!==void 0?e.jsxs("span",{className:"font-bold text-sm",children:[e.jsxs("span",{className:n.preRepairScore>=70?"text-green-600":n.preRepairScore>=50?"text-yellow-600":"text-red-600",children:[n.preRepairScore,"%"]}),e.jsx("span",{className:"text-gray-400 mx-1",children:"‚Üí"}),e.jsxs("span",{className:n.postRepairScore>=70?"text-green-600":n.postRepairScore>=50?"text-yellow-600":"text-red-600",children:[n.postRepairScore,"%"]})]}):n.score!==void 0&&e.jsxs("span",{className:`font-bold ${n.score>=70?"text-green-600":n.score>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(n.score),"%"]})]}),n.error&&e.jsxs("div",{className:"text-xs text-red-600 mb-2",children:["Error: ",n.error]}),n.textIssue&&n.textIssue!=="NONE"&&e.jsxs("div",{className:"text-xs text-orange-600 mb-2",children:["Text issue: ",n.textIssue,n.expectedText&&e.jsxs("span",{className:"block",children:['Expected: "',n.expectedText,'"']}),n.actualText&&e.jsxs("span",{className:"block",children:['Actual: "',n.actualText,'"']})]}),n.type==="auto_repair"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[n.fixTargetsCount&&e.jsxs("div",{className:"text-xs text-amber-700",children:["Fixed ",n.fixTargetsCount," target",n.fixTargetsCount>1?"s":""]}),m&&((U=(G=n.repairDetails)==null?void 0:G[0])==null?void 0:U.beforeImage)&&n.postRepairScore!==void 0&&n.preRepairScore!==void 0&&n.postRepairScore<=n.preRepairScore&&e.jsxs("button",{onClick:()=>m(O,n.repairDetails[0].beforeImage),className:"text-xs px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded border border-red-300 transition-colors",children:["‚Ü©Ô∏è ",x==="de"?"Zur√ºcksetzen":"Revert to Original"]})]}),n.postRepairScore!==void 0&&n.preRepairScore!==void 0&&n.postRepairScore<n.preRepairScore&&e.jsxs("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded border border-red-200",children:["‚ö†Ô∏è ",x==="de"?`Bewertung verschlechtert: ${n.preRepairScore}% ‚Üí ${n.postRepairScore}%`:`Score decreased: ${n.preRepairScore}% ‚Üí ${n.postRepairScore}%`]}),n.bboxDetection&&Array.isArray(n.bboxDetection)&&n.bboxDetection.length>0&&e.jsxs("details",{className:"text-sm mb-2",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-700 font-medium hover:text-blue-900",children:["üì¶ ",x==="de"?"Bounding Box Erkennung":"Bounding Box Detection"," (",n.bboxDetection.length,")"]}),e.jsx("div",{className:"mt-3 space-y-2",children:n.bboxDetection.map((u,W)=>e.jsxs("div",{className:`p-3 rounded-lg border ${u.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:`font-medium text-sm ${u.success?"text-green-800":"text-red-800"}`,children:[u.success?"‚úì":"‚úó"," ",u.issue.substring(0,60),u.issue.length>60?"...":""]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${u.severity==="CRITICAL"?"bg-red-200 text-red-800":u.severity==="MAJOR"?"bg-orange-200 text-orange-800":u.severity==="MODERATE"?"bg-yellow-200 text-yellow-800":"bg-gray-200 text-gray-800"}`,children:[u.severity," ‚Ä¢ ",u.type]})]}),u.success&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${u.faceBox?"bg-purple-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-purple-800",children:"Face Box:"}),u.faceBox?e.jsxs("span",{className:"ml-1 font-mono text-purple-600",children:["[",u.faceBox.map(y=>(y*100).toFixed(0)+"%").join(", "),"]"]}):e.jsx("span",{className:"ml-1 text-gray-500 italic",children:"not detected"})]}),e.jsxs("div",{className:`p-2 rounded ${u.bodyBox?"bg-blue-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-blue-800",children:"Body Box:"}),u.bodyBox?e.jsxs("span",{className:"ml-1 font-mono text-blue-600",children:["[",u.bodyBox.map(y=>(y*100).toFixed(0)+"%").join(", "),"]"]}):e.jsx("span",{className:"ml-1 text-gray-500 italic",children:"not detected"})]})]}),u.label&&u.label!==u.issue&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Detected as:"})," ",u.label]}),u.usage&&e.jsxs("div",{className:"mt-1 text-xs text-gray-400",children:["Tokens: ",u.usage.input_tokens," in / ",u.usage.output_tokens," out"]})]},W))})]}),e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["üìä ",x==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-red-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-red-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 px-2 py-0.5 rounded",children:"Before"}),e.jsxs("span",{className:"text-red-600",children:[n.preRepairScore,"%"]})]}),e.jsx(rt,{data:n.preRepairEval||n.reasoning,language:x,title:`evaluation-before-attempt-${O}`})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-green-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded",children:"After"}),e.jsxs("span",{className:"text-green-600",children:[n.postRepairScore,"%"]})]}),e.jsx(rt,{data:n.postRepairEval,language:x,title:`evaluation-after-attempt-${O}`})]})]})]}),n.repairDetails&&n.repairDetails.length>0&&e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["üñºÔ∏è ",x==="de"?"Reparatur-Details":"Repair Details"," (",n.repairDetails.length,")"]}),e.jsx("div",{className:"mt-3 space-y-3",children:n.repairDetails.map((u,W)=>{var y,C;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-medium text-amber-800 text-base",children:u.description}),u.modelId&&e.jsx("span",{className:"text-xs text-gray-400 bg-gray-100 px-2 py-0.5 rounded",children:u.modelId})]}),e.jsxs("details",{className:"mb-3",children:[e.jsxs("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700 text-sm flex items-center gap-2",children:["Show fix prompt",e.jsxs("button",{onClick:E=>{E.stopPropagation(),zs(u.fullPrompt||u.fixPrompt||"",`fix-prompt-${W}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(qe,{size:10})," Download"]})]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded text-sm text-gray-600 whitespace-pre-wrap font-mono max-h-[500px] overflow-auto",children:u.fullPrompt||u.fixPrompt})]}),e.jsxs("div",{className:"flex gap-4 items-start",children:[u.beforeImage&&u.maskImage?e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before + Mask"}),e.jsx(ha,{beforeImage:u.beforeImage,maskImage:u.maskImage,onEnlarge:(E,H)=>F({src:E,title:H})})]}):u.beforeImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before"}),e.jsx("img",{src:u.beforeImage,alt:"Before",className:"w-32 h-32 object-contain border rounded cursor-pointer hover:ring-2 hover:ring-amber-400",onClick:()=>F({src:u.beforeImage,title:"Before Repair"})})]}),e.jsx("div",{className:"flex items-center h-32 text-gray-400 text-2xl",children:"‚Üí"}),u.afterImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"After"}),e.jsx("img",{src:u.afterImage,alt:"After",className:"w-32 h-32 object-contain border-2 border-green-300 rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>F({src:u.afterImage,title:"After Repair"})})]})]}),u.verification&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded border text-sm",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"üîç Verification:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.verification.lpips&&e.jsxs("div",{className:`p-2 rounded ${u.verification.lpips.changed?"bg-green-100":"bg-yellow-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LPIPS: "}),e.jsx("span",{className:u.verification.lpips.changed?"text-green-700":"text-yellow-700",children:(y=u.verification.lpips.lpipsScore)==null?void 0:y.toFixed(4)}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",u.verification.lpips.changed?"‚úì changed":"‚ö† unchanged",")"]})]}),u.verification.llm&&e.jsxs("div",{className:`p-2 rounded ${u.verification.llm.fixed?"bg-green-100":"bg-red-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LLM: "}),e.jsx("span",{className:u.verification.llm.fixed?"text-green-700":"text-red-700",children:u.verification.llm.fixed?"‚úì Fixed":"‚úó Not fixed"}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",Math.round(u.verification.llm.confidence*100),"%)"]})]})]}),((C=u.verification.llm)==null?void 0:C.explanation)&&e.jsx("div",{className:"mt-2 text-gray-600 text-sm italic",children:u.verification.llm.explanation})]})]},W)})})]})]}),(n.type==="grid_repair"||n.type==="grid_repair_failed")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[n.gridTotalIssues!==void 0&&e.jsxs("span",{className:"text-violet-700",children:[x==="de"?"Probleme:":"Issues:"," ",n.gridTotalIssues]}),n.gridFixedCount!==void 0&&e.jsxs("span",{className:"text-green-600",children:["‚úì ",x==="de"?"Behoben:":"Fixed:"," ",n.gridFixedCount]}),n.gridFailedCount!==void 0&&n.gridFailedCount>0&&e.jsxs("span",{className:"text-red-600",children:["‚úó ",x==="de"?"Fehlgeschlagen:":"Failed:"," ",n.gridFailedCount]})]}),n.type==="grid_repair_failed"&&n.failReason&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-100 p-2 rounded border border-red-200",children:["‚ö†Ô∏è ",x==="de"?"Fehlergrund:":"Failure reason:"," ",n.failReason==="no_repairs_made"?x==="de"?"Keine Reparaturen durchgef√ºhrt":"No repairs were made":n.failReason==="no_image_data"?x==="de"?"Keine Bilddaten zur√ºckgegeben":"No image data returned":n.failReason==="image_too_small"?x==="de"?"Zur√ºckgegebenes Bild zu klein/ung√ºltig":"Returned image too small/invalid":n.failReason==="image_unchanged"?x==="de"?"Bild wurde nicht ver√§ndert":"Image was not changed":n.failReason]}),(()=>{var W;const u=n.annotatedOriginal||((W=b[O])==null?void 0:W.annotatedOriginal);return u?e.jsxs("details",{className:"text-sm",open:!0,children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["üìç ",x==="de"?"Schritt 1: Erkannte Probleme":"Step 1: Detected Issues"]}),e.jsxs("div",{className:"mt-3 bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:[x==="de"?"Originalbild mit markierten Problembereichen":"Original image with marked issue regions",e.jsxs("span",{className:"ml-2 text-gray-400",children:["(üî¥ ",x==="de"?"kritisch":"critical",", üü† ",x==="de"?"wichtig":"major",", üü° ",x==="de"?"gering":"minor",")"]})]}),e.jsx("img",{src:`data:image/jpeg;base64,${u}`,alt:"Annotated original",className:"max-w-md border rounded cursor-pointer hover:ring-2 hover:ring-violet-400",onClick:()=>F({src:`data:image/jpeg;base64,${u}`,title:x==="de"?"Erkannte Probleme":"Detected Issues"})})]})]}):n.hasAnnotatedOriginal&&p&&R!==void 0?e.jsx("button",{onClick:()=>D(O),disabled:w.has(O),className:"text-sm px-3 py-2 bg-violet-100 hover:bg-violet-200 text-violet-700 rounded border border-violet-300 flex items-center gap-2 disabled:opacity-50",children:w.has(O)?e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:14,className:"animate-spin"})," Loading..."]}):e.jsx(e.Fragment,{children:"üìç Load Detected Issues"})}):null})(),e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["üìä ",x==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-red-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-red-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 px-2 py-0.5 rounded",children:"Before"}),e.jsxs("span",{className:"text-red-600",children:[n.preRepairScore,"%"]})]}),e.jsx(rt,{data:n.preRepairEval||n.reasoning,language:x,title:`evaluation-before-grid-${O}`})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-green-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded",children:"After"}),e.jsxs("span",{className:"text-green-600",children:[n.postRepairScore,"%"]})]}),e.jsx(rt,{data:n.postRepairEval,language:x,title:`evaluation-after-grid-${O}`})]})]})]}),(()=>{var W,y;const u=n.grids||((W=b[O])==null?void 0:W.grids);return u&&u.length>0?e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["üî≤ ",x==="de"?"Grid-Details":"Grid Details"," (",u.length," ",u.length===1?"grid":"grids",")"]}),e.jsx("div",{className:"mt-3 space-y-4",children:u.map((C,E)=>{var H,Q;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("span",{className:"font-medium text-violet-800",children:["Grid"," ",C.batchNum||E+1]}),((H=C.manifest)==null?void 0:H.issues)&&e.jsxs("span",{className:"text-xs text-gray-500",children:[C.manifest.issues.length," ",x==="de"?"Regionen":"regions"]})]}),((Q=C.manifest)==null?void 0:Q.issues)&&C.manifest.issues.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-violet-50 rounded text-sm",children:[e.jsx("div",{className:"font-medium text-violet-800 mb-1",children:x==="de"?"Zu reparierende Probleme:":"Issues to repair:"}),e.jsx("div",{className:"space-y-1",children:C.manifest.issues.map((A,ne)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-mono font-bold text-violet-600 min-w-[20px]",children:[A.letter,":"]}),e.jsx("span",{className:"text-gray-700",children:A.fixInstruction||A.description||"Unknown issue"})]},ne))})]}),C.prompt&&e.jsxs("details",{className:"mb-3",children:[e.jsxs("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700 text-sm flex items-center gap-2",children:[x==="de"?"Reparatur-Prompt anzeigen":"Show repair prompt",e.jsxs("button",{onClick:A=>{A.stopPropagation(),zs(C.prompt||"",`grid-repair-prompt-${E}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(qe,{size:10})," Download"]})]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded text-sm text-gray-600 whitespace-pre-wrap font-mono max-h-[500px] overflow-auto",children:C.prompt})]}),e.jsxs("div",{className:"flex gap-4 items-start flex-wrap",children:[C.original&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:x==="de"?"Original-Grid":"Input Grid"}),e.jsx("img",{src:C.original.startsWith("data:")?C.original:`data:image/png;base64,${C.original}`,alt:"Input grid",className:"max-w-xs border rounded cursor-pointer hover:ring-2 hover:ring-violet-400",onClick:()=>F({src:C.original.startsWith("data:")?C.original:`data:image/png;base64,${C.original}`,title:x==="de"?"Original-Grid":"Input Grid"})})]}),C.original&&C.repaired&&e.jsx("div",{className:"flex items-center self-center text-gray-400 text-2xl",children:"‚Üí"}),C.repaired&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:x==="de"?"Repariertes Grid":"Repaired Grid"}),e.jsx("img",{src:C.repaired.startsWith("data:")?C.repaired:`data:image/png;base64,${C.repaired}`,alt:"Repaired grid",className:"max-w-xs border-2 border-green-300 rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>F({src:C.repaired.startsWith("data:")?C.repaired:`data:image/png;base64,${C.repaired}`,title:x==="de"?"Repariertes Grid":"Repaired Grid"})})]})]}),C.repairs&&C.repairs.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"font-medium text-violet-800 mb-2",children:["‚úÖ ",x==="de"?"Verifizierungsergebnisse":"Verification Results"]}),e.jsx("div",{className:"space-y-2",children:C.repairs.map((A,ne)=>{var B,Z,re,le,te,o,ce,Ds,os,We,Ke,ve;return e.jsxs("div",{className:`mb-3 p-3 rounded-lg border ${(B=A.verification)!=null&&B.accepted?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"font-mono font-bold text-xl text-violet-600 w-8",children:A.letter}),e.jsxs("div",{className:"flex items-center gap-2",children:[A.originalThumbnail&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:x==="de"?"Vorher":"Before"}),e.jsx("img",{src:`data:image/jpeg;base64,${A.originalThumbnail}`,alt:"Before",className:"w-16 h-16 object-contain cursor-pointer hover:ring-2 hover:ring-violet-400 rounded border",onClick:()=>F({src:`data:image/jpeg;base64,${A.originalThumbnail}`,title:`${A.letter}: Before`})})]}),A.repairedThumbnail&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:x==="de"?"Nachher":"After"}),e.jsx("img",{src:`data:image/jpeg;base64,${A.repairedThumbnail}`,alt:"After",className:`w-16 h-16 object-contain cursor-pointer hover:ring-2 rounded border ${(Z=A.verification)!=null&&Z.accepted?"border-green-300":"border-red-300"}`,onClick:()=>F({src:`data:image/jpeg;base64,${A.repairedThumbnail}`,title:`${A.letter}: After`})})]}),A.diffImage&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Diff"}),e.jsx("img",{src:`data:image/jpeg;base64,${A.diffImage}`,alt:"Diff",className:"w-16 h-16 object-contain cursor-pointer hover:ring-2 hover:ring-purple-400 rounded border",onClick:()=>F({src:`data:image/jpeg;base64,${A.diffImage}`,title:`${A.letter}: Diff`})})]})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsx("span",{className:`text-2xl ${(re=A.verification)!=null&&re.accepted?"text-green-600":"text-red-600"}`,children:(le=A.verification)!=null&&le.accepted?"‚úì":"‚úó"}),e.jsxs("span",{className:`text-lg font-medium ${(((te=A.verification)==null?void 0:te.confidence)??0)>=.7?"text-green-600":(((o=A.verification)==null?void 0:o.confidence)??0)>=.5?"text-yellow-600":"text-red-600"}`,children:[Math.round((((ce=A.verification)==null?void 0:ce.confidence)??0)*100),"%"]})]})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-xs mr-2 ${A.severity==="critical"?"bg-red-200 text-red-800":A.severity==="major"?"bg-orange-200 text-orange-800":"bg-yellow-200 text-yellow-800"}`,children:A.type||"unknown"}),e.jsx("span",{className:"text-gray-700",children:A.description})]}),A.fixInstruction&&e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Fix:"})," ",A.fixInstruction]}),(((Ds=A.verification)==null?void 0:Ds.explanation)||((os=A.verification)==null?void 0:os.reason))&&e.jsxs("div",{className:`mt-2 text-sm p-2 rounded ${(We=A.verification)!=null&&We.accepted?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:"font-medium",children:x==="de"?"Ergebnis:":"Result:"})," ",((Ke=A.verification)==null?void 0:Ke.explanation)||((ve=A.verification)==null?void 0:ve.reason)]})]},ne)})})]})]},E)})})]}):n.hasGrids&&p&&R!==void 0&&!((y=b[O])!=null&&y.grids)?e.jsx("button",{onClick:()=>D(O),disabled:w.has(O),className:"text-sm px-3 py-2 bg-violet-100 hover:bg-violet-200 text-violet-700 rounded border border-violet-300 flex items-center gap-2 disabled:opacity-50",children:w.has(O)?e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:14,className:"animate-spin"})," Loading..."]}):e.jsxs(e.Fragment,{children:["üî≤ Load Grid Details (",n.gridsCount||"?"," grids)"]})}):null})()]}),n.type!=="auto_repair"&&n.type!=="grid_repair"&&n.type!=="grid_repair_failed"&&n.prompt&&e.jsxs("details",{className:"text-sm mb-2",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-700 font-medium hover:text-blue-900 flex items-center gap-2",children:["üì§ ",x==="de"?"Eingabe-Prompt":"Input Prompt",e.jsxs("button",{onClick:u=>{u.stopPropagation(),zs(n.prompt||"",`prompt-attempt-${n.attempt}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(qe,{size:10})," Download"]})]}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap bg-blue-50 p-3 rounded text-sm overflow-auto max-h-[500px] font-mono border border-blue-200",children:n.prompt})]}),n.type!=="auto_repair"&&n.type!=="grid_repair"&&n.type!=="grid_repair_failed"&&n.reasoning?e.jsxs("details",{className:"text-sm text-gray-600 mb-2",children:[e.jsxs("summary",{className:"cursor-pointer font-medium",children:["üì• ",x==="de"?"Bewertungs-Feedback":"Evaluation Feedback"]}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap bg-gray-50 p-3 rounded text-sm overflow-auto max-h-[500px] font-mono",children:n.reasoning})]}):n.type!=="auto_repair"&&n.type!=="grid_repair"&&n.type!=="grid_repair_failed"&&n.score===0&&e.jsx("div",{className:"text-sm text-gray-500 italic mb-2",children:x==="de"?"Qualit√§tsbewertung fehlgeschlagen":x==="fr"?"√âvaluation de qualit√© √©chou√©e":"Quality evaluation failed"}),(()=>{var W;if(n.type==="auto_repair"||n.type==="grid_repair"||n.type==="grid_repair_failed"||n.type==="bbox_detection_only")return null;const u=n.imageData||((W=b[O])==null?void 0:W.imageData);return u?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:x==="de"?"Generiertes Bild":"Generated Image"}),e.jsx("img",{src:u,alt:`Attempt ${n.attempt}`,className:`w-48 h-48 object-contain rounded border cursor-pointer hover:ring-2 ${O===T.length-1?"border-green-300 hover:ring-green-400":"border-gray-200 opacity-75 hover:ring-gray-400"}`,onClick:()=>F({src:u,title:`${x==="de"?"Versuch":"Attempt"} ${n.attempt}`})})]}):n.type==="generation"&&p&&R!==void 0&&!b[O]?e.jsx("button",{onClick:()=>D(O),disabled:w.has(O),className:"mt-2 text-sm px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded border border-blue-300 flex items-center gap-2 disabled:opacity-50",children:w.has(O)?e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:14,className:"animate-spin"})," Loading..."]}):e.jsxs(e.Fragment,{children:["üñºÔ∏è ",x==="de"?"Bild laden":"Load Image"]})}):null})(),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(n.timestamp).toLocaleTimeString()})]},O)})})()})]})]})}function ua(d){if(!d||d.length===0)return{bboxDetection:null,bboxOverlayImage:null,hasBboxOverlay:!1};const $=d.find(m=>m.type==="bbox_detection_only"&&m.bboxDetection)||d.find(m=>m.bboxDetection);if(!$)return{bboxDetection:null,bboxOverlayImage:null,hasBboxOverlay:!1};const x=$.bboxDetection;return x&&typeof x=="object"&&"figures"in x?{bboxDetection:x,bboxOverlayImage:$.bboxOverlayImage||null,hasBboxOverlay:!!$.hasBboxOverlay||!!$.bboxOverlayImage}:{bboxDetection:null,bboxOverlayImage:null,hasBboxOverlay:!1}}function ba(d,$){const x=new Blob([d],{type:"text/plain;charset=utf-8"}),m=URL.createObjectURL(x),p=document.createElement("a");p.href=m,p.download=$,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(m)}function Is({retryHistory:d,bboxDetection:$,bboxOverlayImage:x,language:m,storyId:p,pageNumber:R,coverType:S}){var u,W;const[F,b]=P.useState(null),[v,w]=P.useState(null),[f,D]=P.useState(!1),K=ua(d),h=$||K.bboxDetection,c=x||K.bboxOverlayImage,T=!!x||K.hasBboxOverlay;if(!h)return null;const n=((u=h.figures)==null?void 0:u.length)||0,O=((W=h.objects)==null?void 0:W.length)||0,G=async()=>{if(!(!p||f)&&!(!S&&R===void 0)){D(!0);try{const y=localStorage.getItem("auth_token"),C=new URLSearchParams({field:"bboxOverlay"});if(S)C.set("cover",S);else{C.set("page",String(R)),C.set("type","retry");const H=(d==null?void 0:d.findIndex(Q=>Q.type==="bbox_detection_only"&&Q.bboxDetection||Q.bboxDetection))??0;C.set("index",String(H))}const E=await fetch(`/api/stories/${p}/dev-image?${C}`,{headers:y?{Authorization:`Bearer ${y}`}:{}});if(E.ok){const H=await E.json();H.bboxOverlayImage&&w(H.bboxOverlayImage)}}catch(y){console.error("Failed to load bbox overlay:",y)}finally{D(!1)}}},U=c||v;return e.jsxs(e.Fragment,{children:[F&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>b(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("div",{className:"absolute -top-8 left-0 text-white text-sm",children:F.title}),e.jsx("img",{src:F.src,alt:F.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute -top-8 right-0 text-white hover:text-gray-300",onClick:()=>b(null),children:"‚úï Close"})]})}),e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-blue-700 flex items-center justify-between",children:e.jsxs("span",{className:"flex items-center gap-2",children:["üì¶ ",m==="de"?"Objekterkennung":"Object Detection",e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded",children:[n," ",m==="de"?"Figuren":"figures",","," ",O," ",m==="de"?"Objekte":"objects"]}),h.positionMismatches&&h.positionMismatches.length>0&&e.jsxs("span",{className:"text-xs bg-yellow-200 text-yellow-800 px-1.5 py-0.5 rounded",children:["‚ö†Ô∏è ",h.positionMismatches.length," ",m==="de"?"Abweichungen":"mismatches"]}),h.missingCharacters&&h.missingCharacters.length>0&&e.jsxs("span",{className:"text-xs bg-red-200 text-red-800 px-1.5 py-0.5 rounded",children:["‚ùå ",h.missingCharacters.length," ",m==="de"?"Char fehlt":"char missing"]}),h.missingObjects&&h.missingObjects.length>0&&e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded",children:["‚ö†Ô∏è ",h.missingObjects.length," ",m==="de"?"Obj fehlt":"obj missing"]}),h.matchedObjects&&h.matchedObjects.length>0&&e.jsxs("span",{className:"text-xs bg-green-200 text-green-800 px-1.5 py-0.5 rounded",children:["‚úì ",h.matchedObjects.length," ",m==="de"?"Obj gefunden":"obj matched"]})]})}),e.jsxs("div",{className:"mt-3 space-y-3",children:[U?e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:[m==="de"?"Erkannte Regionen":"Detected Regions",e.jsx("span",{className:"ml-2 text-gray-400",children:"(üü¢ Body, üîµ Face, üü† Object, üü£ Matched)"})]}),e.jsx("img",{src:U,alt:"Bbox overlay",className:"max-w-md border rounded cursor-pointer hover:ring-2 hover:ring-blue-400",onClick:()=>b({src:U,title:m==="de"?"Erkannte Regionen":"Detected Regions"})})]}):T&&p&&R!==void 0?e.jsx("button",{onClick:G,disabled:f,className:"text-sm px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded border border-blue-300 flex items-center gap-2 disabled:opacity-50",children:f?e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:14,className:"animate-spin"})," ",m==="de"?"L√§dt...":"Loading..."]}):e.jsxs(e.Fragment,{children:["üì¶ ",m==="de"?"Erkannte Regionen laden":"Load Detected Regions"]})}):null,h.expectedCharacters&&h.expectedCharacters.length>0&&e.jsxs("details",{className:"bg-violet-50 p-3 rounded border border-violet-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-violet-800",children:["üë• ",m==="de"?"Erwartete Charaktere":"Expected Characters"," (",h.expectedCharacters.length,")"]}),e.jsx("div",{className:"mt-2 grid grid-cols-1 gap-2 text-sm",children:h.expectedCharacters.map((y,C)=>e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-medium text-violet-700",children:y.name}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[y.description,y.position&&e.jsxs("span",{className:"ml-2 text-violet-500",children:["@ ",y.position]})]})]},C))})]}),h.expectedPositions&&Object.keys(h.expectedPositions).length>0&&e.jsxs("div",{className:"bg-purple-50 p-3 rounded border border-purple-200",children:[e.jsxs("div",{className:"font-medium text-purple-800 mb-2",children:["üìç ",m==="de"?"Erwartete Positionen":"Expected Positions"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:Object.entries(h.expectedPositions).map(([y,C])=>e.jsxs("div",{className:"bg-white p-2 rounded border flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-purple-700",children:y}),e.jsx("span",{className:"text-gray-600 text-xs",children:C})]},y))})]}),h.positionMismatches&&h.positionMismatches.length>0&&e.jsxs("div",{className:"bg-yellow-50 p-3 rounded border border-yellow-300",children:[e.jsxs("div",{className:"font-medium text-yellow-800 mb-2",children:["‚ö†Ô∏è ",m==="de"?"Positionsabweichungen":"Position Mismatches"," (",h.positionMismatches.length,")"]}),e.jsx("div",{className:"space-y-2",children:h.positionMismatches.map((y,C)=>e.jsxs("div",{className:"text-sm bg-white p-2 rounded border border-yellow-200",children:[e.jsx("div",{className:"font-medium text-yellow-700",children:y.character}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1 flex gap-3",children:[e.jsxs("span",{children:[m==="de"?"Erwartet":"Expected",": ",e.jsx("span",{className:"font-medium text-purple-600",children:y.expected}),e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",y.expectedLCR,")"]})]}),e.jsx("span",{className:"text-gray-400",children:"‚Üí"}),e.jsxs("span",{children:[m==="de"?"Erkannt":"Actual",": ",e.jsx("span",{className:"font-medium text-orange-600",children:y.actual})]})]})]},C))})]}),h.missingCharacters&&h.missingCharacters.length>0&&e.jsxs("div",{className:"bg-red-50 p-3 rounded border border-red-300",children:[e.jsxs("div",{className:"font-medium text-red-800 mb-2",children:["‚ùå ",m==="de"?"Fehlende Charaktere":"Missing Characters"," (",h.missingCharacters.length,")"]}),e.jsx("div",{className:"text-sm text-red-700",children:m==="de"?"Diese Charaktere wurden in der Szene erwartet, aber nicht im Bild gefunden:":"These characters were expected in the scene but not detected in the image:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:h.missingCharacters.map((y,C)=>e.jsx("span",{className:"bg-white px-2 py-1 rounded border border-red-200 text-sm font-medium text-red-700",children:y},C))})]}),h.expectedObjects&&h.expectedObjects.length>0&&e.jsxs("div",{className:"bg-indigo-50 p-3 rounded border border-indigo-200",children:[e.jsxs("div",{className:"font-medium text-indigo-800 mb-2",children:["üéØ ",m==="de"?"Erwartete Objekte":"Expected Objects"," (",h.expectedObjects.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:h.expectedObjects.map((y,C)=>{var Q,A;const E=(Q=h.matchedObjects)==null?void 0:Q.find(ne=>ne.expected===y),H=(A=h.missingObjects)==null?void 0:A.includes(y);return e.jsxs("div",{className:`bg-white p-2 rounded border flex justify-between items-center ${H?"border-red-300":E?"border-green-300":""}`,children:[e.jsxs("span",{className:`font-medium ${H?"text-red-600":E?"text-green-600":"text-indigo-700"}`,children:[H?"‚ùå":E?"‚úì":"‚Ä¢"," ",y]}),E&&e.jsxs("span",{className:"text-xs text-gray-500 truncate ml-2",children:["‚Üí ",E.matched]})]},C)})})]}),h.missingObjects&&h.missingObjects.length>0&&!h.expectedObjects&&e.jsxs("div",{className:"bg-amber-50 p-3 rounded border border-amber-300",children:[e.jsxs("div",{className:"font-medium text-amber-800 mb-2",children:["‚ö†Ô∏è ",m==="de"?"Fehlende Objekte":"Missing Objects"," (",h.missingObjects.length,")"]}),e.jsx("div",{className:"text-sm text-amber-700",children:m==="de"?"Diese Objekte wurden in der Szene erwartet, aber nicht im Bild gefunden:":"These objects were expected in the scene but not detected in the image:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:h.missingObjects.map((y,C)=>e.jsx("span",{className:"bg-white px-2 py-1 rounded border border-amber-200 text-sm font-medium text-amber-700",children:y},C))})]}),h.figures&&h.figures.length>0&&e.jsxs("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[e.jsxs("div",{className:"font-medium text-green-800 mb-2",children:[m==="de"?"Figuren":"Figures"," (",h.figures.length,")",h.unknownFigures!==void 0&&h.unknownFigures>0&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 text-gray-700 px-1.5 py-0.5 rounded",children:[h.unknownFigures," ",m==="de"?"unbekannt":"unknown"]})]}),e.jsx("div",{className:"space-y-2",children:h.figures.map((y,C)=>{const E=y.name&&y.name!=="UNKNOWN",H=y.confidence==="high"?"text-green-600":y.confidence==="medium"?"text-yellow-600":"text-orange-600",Q=y.confidence==="high"?"‚òÖ":y.confidence==="medium"?"‚óÜ":"‚óã";return e.jsxs("div",{className:`text-sm bg-white p-2 rounded border ${E?"border-green-300":"border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`font-medium ${E?"text-green-700":"text-gray-600"}`,children:E?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:H,children:Q})," ",y.name]}):e.jsxs(e.Fragment,{children:["? ",y.label||`Figure ${C+1}`]})}),E&&y.confidence&&e.jsx("span",{className:`text-xs ${H}`,children:y.confidence})]}),E&&y.label&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:y.label}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1 grid grid-cols-2 gap-2",children:[y.bodyBox&&e.jsxs("span",{children:["Body: [",y.bodyBox.map(A=>(A*100).toFixed(0)+"%").join(", "),"]"]}),y.faceBox&&e.jsxs("span",{children:["Face: [",y.faceBox.map(A=>(A*100).toFixed(0)+"%").join(", "),"]"]}),y.position&&e.jsxs("span",{children:["Pos: ",y.position]})]})]},C)})})]}),h.objects&&h.objects.length>0&&e.jsxs("div",{className:"bg-orange-50 p-3 rounded border border-orange-200",children:[e.jsxs("div",{className:"font-medium text-orange-800 mb-2",children:[m==="de"?"Objekte":"Objects"," (",h.objects.length,")"]}),e.jsx("div",{className:"space-y-2",children:h.objects.map((y,C)=>{const E=!!y.name,H=y.found!==!1;return e.jsxs("div",{className:`text-sm bg-white p-2 rounded border ${E&&H?"border-green-300":E&&!H?"border-red-300":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`font-medium ${E&&H?"text-green-700":E&&!H?"text-red-600":"text-orange-700"}`,children:E?e.jsxs(e.Fragment,{children:[H?"‚úì":"‚úó"," ",y.name]}):y.label||`Object ${C+1}`}),E&&e.jsx("span",{className:`text-xs ${H?"text-green-600":"text-red-600"}`,children:H?m==="de"?"gefunden":"found":m==="de"?"fehlt":"missing"})]}),E&&y.label&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:y.label}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[y.bodyBox&&e.jsxs("span",{children:["Box: [",y.bodyBox.map(Q=>(Q*100).toFixed(0)+"%").join(", "),"]"]}),y.position&&e.jsxs("span",{className:"ml-2",children:["Pos: ",y.position]})]})]},C)})})]}),h.characterDescriptions&&Object.keys(h.characterDescriptions).length>0&&e.jsxs("details",{className:"bg-cyan-50 p-3 rounded border border-cyan-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-cyan-800",children:["üë§ ",m==="de"?"Charakter-Beschreibungen":"Character Descriptions"," (",Object.keys(h.characterDescriptions).length,")"]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:Object.entries(h.characterDescriptions).map(([y,C])=>e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("span",{className:"font-medium text-cyan-700",children:y}),e.jsxs("span",{className:"text-gray-600 ml-2",children:[C.genderTerm||C.gender||"?",", ",C.age?`${C.age}y`:"?",C.isChild?" (child)":C.isChild===!1?" (adult)":""]})]},y))})]}),h.rawPrompt&&e.jsxs("details",{className:"bg-gray-50 p-3 rounded border border-gray-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-gray-700",children:["üìù ",m==="de"?"Bbox-Prompt":"Bbox Prompt"]}),e.jsx("pre",{className:"mt-2 text-xs bg-white p-2 rounded border overflow-x-auto whitespace-pre-wrap max-h-48 overflow-y-auto",children:h.rawPrompt})]}),h.rawResponse&&e.jsxs("details",{className:"bg-gray-50 p-3 rounded border border-gray-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-gray-700",children:["üì§ ",m==="de"?"Bbox-Antwort":"Bbox Response"]}),e.jsx("pre",{className:"mt-2 text-xs bg-white p-2 rounded border overflow-x-auto whitespace-pre-wrap max-h-64 overflow-y-auto",children:h.rawResponse})]}),e.jsxs("button",{onClick:()=>ba(JSON.stringify(h,null,2),`object-detection-page-${R}.json`),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-1 bg-blue-50 rounded hover:bg-blue-100",children:[e.jsx(qe,{size:12})," ",m==="de"?"JSON herunterladen":"Download JSON"]})]})]})]})}function As({referencePhotos:d,landmarkPhotos:$,visualBibleGrid:x,hasVisualBibleGrid:m,language:p,storyId:R,pageNumber:S}){var te;const[F,b]=P.useState(null),[v,w]=P.useState(null),[f,D]=P.useState(null),[K,h]=P.useState(null),[c,T]=P.useState(!1),[n,O]=P.useState(null),G=d==null?void 0:d.some(o=>o.hasPhoto&&!o.photoUrl),U=$==null?void 0:$.some(o=>o.hasPhoto&&!o.photoData),u=m&&!x,W=P.useCallback(async()=>{if(!(!R||!S||c)&&!(!G&&!U&&!u)){T(!0),O(null);try{if(G||u){const o=await at.getDevImage(R,S,"reference");o!=null&&o.referencePhotos&&w(o.referencePhotos),o!=null&&o.visualBibleGrid&&h(o.visualBibleGrid)}if(U){const o=await at.getDevImage(R,S,"landmark");o!=null&&o.landmarkPhotos&&D(o.landmarkPhotos)}}catch(o){O(o instanceof Error?o.message:"Failed to load images")}finally{T(!1)}}},[R,S,c,G,U,u]),y=v||d,C=f||$,E=K||x,H=y&&y.length>0,Q=C&&C.length>0,A=!!E||m;if(!H&&!Q&&!A)return null;const ne=((d==null?void 0:d.length)||0)+(($==null?void 0:$.length)||0)+(A?1:0),B=o=>{switch(o){case"bodyNoBg":case"body-no-bg":return p==="de"?"Ganzk√∂rper (freigestellt)":p==="fr"?"Corps entier (d√©tour√©)":"Full body (no bg)";case"body":return p==="de"?"Ganzk√∂rper":p==="fr"?"Corps entier":"Full body";case"face":return p==="de"?"Gesicht":p==="fr"?"Visage":"Face only";case"clothing-winter":return p==="de"?"Winter-Avatar":p==="fr"?"Avatar hiver":"Winter avatar";case"clothing-summer":return p==="de"?"Sommer-Avatar":p==="fr"?"Avatar √©t√©":"Summer avatar";case"clothing-formal":return p==="de"?"Formell-Avatar":p==="fr"?"Avatar formel":"Formal avatar";case"clothing-standard":return p==="de"?"Standard-Avatar":p==="fr"?"Avatar standard":"Standard avatar";case"none":return p==="de"?"Kein Foto":p==="fr"?"Pas de photo":"No photo";default:return o}},Z=o=>{switch(o){case"bodyNoBg":case"body-no-bg":return"bg-green-100 text-green-700 border-green-300";case"body":return"bg-blue-100 text-blue-700 border-blue-300";case"face":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"clothing-winter":return"bg-cyan-100 text-cyan-700 border-cyan-300";case"clothing-summer":return"bg-orange-100 text-orange-700 border-orange-300";case"clothing-formal":return"bg-purple-100 text-purple-700 border-purple-300";case"clothing-standard":return"bg-teal-100 text-teal-700 border-teal-300";case"none":return"bg-red-100 text-red-700 border-red-300";default:return"bg-gray-100 text-gray-700 border-gray-300"}},re=(te=y==null?void 0:y.find(o=>o.clothingCategory))==null?void 0:te.clothingCategory,le=o=>{if(!o)return"";switch(o){case"winter":return p==="de"?"Winter":p==="fr"?"Hiver":"Winter";case"summer":return p==="de"?"Sommer":p==="fr"?"√ât√©":"Summer";case"formal":return p==="de"?"Formell":p==="fr"?"Formel":"Formal";case"standard":return"Standard";default:return o}};return e.jsxs("details",{className:"bg-pink-50 border border-pink-300 rounded-lg p-3",onToggle:o=>{o.target.open&&(G||U||u)&&W()},children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-900 flex items-center gap-2",children:[e.jsx("span",{children:"üì∏"}),p==="de"?"Referenzfotos":p==="fr"?"Photos de r√©f√©rence":"Reference Photos",e.jsxs("span",{className:"text-xs text-pink-600",children:["(",ne,")"]}),re&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-pink-200 text-pink-800 text-xs rounded",children:["üëï ",le(re)]}),Q&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-amber-200 text-amber-800 text-xs rounded",children:["üìç ",C.length," ",p==="de"?"Wahrzeichen":"Landmark"]}),A&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-indigo-200 text-indigo-800 text-xs rounded",children:"üî≤ VB Grid"}),c&&e.jsx("span",{className:"ml-2 text-xs text-gray-500 animate-pulse",children:"Loading..."})]}),n&&e.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-50 p-2 rounded",children:n}),H&&e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2",children:y.map((o,ce)=>e.jsxs("div",{className:"bg-white rounded-lg p-2 border border-pink-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:o.name}),o.photoType&&e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap ${Z(o.photoType)}`,children:B(o.photoType)})]}),o.photoUrl?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:o.photoUrl,alt:`${o.name} - ${B(o.photoType||"unknown")}`,className:`w-full max-h-32 object-contain rounded border bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity ${o.isStyled?"border-purple-400 ring-2 ring-purple-200":"border-gray-200"}`,onClick:()=>b(o.photoUrl),title:"Click to enlarge"}),o.isStyled&&e.jsx("span",{className:"absolute top-1 right-1 px-1 py-0.5 text-[9px] font-bold bg-purple-500 text-white rounded",children:"üé® STYLED"})]}),o.photoHash&&e.jsxs("div",{className:"mt-1 text-[9px] font-mono text-gray-500 bg-gray-100 px-1 py-0.5 rounded text-center",children:["üîê ",o.photoHash]})]}):e.jsx("div",{className:"text-xs text-gray-500 italic py-2 text-center bg-gray-100 rounded",children:p==="de"?"Foto nicht geladen":"Photo not loaded"})]},ce))}),Q&&e.jsxs("div",{className:H?"mt-4 pt-3 border-t border-pink-200":"mt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-amber-700 mb-2 flex items-center gap-1",children:["üìç ",p==="de"?"Wahrzeichen-Referenzfotos":p==="fr"?"Photos de monuments":"Landmark Reference Photos"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:C.map((o,ce)=>e.jsxs("div",{className:"bg-amber-50 rounded-lg p-2 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:o.name}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap bg-amber-100 text-amber-700 border-amber-300",children:"üìç LANDMARK"})]}),o.photoData?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:o.photoData,alt:`${o.name} landmark`,className:"w-full max-h-32 object-contain rounded border border-amber-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>b(o.photoData),title:"Click to enlarge"})}),o.attribution&&e.jsxs("div",{className:"mt-1 text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 rounded truncate",title:o.attribution,children:["üì∑ ",o.attribution]}),o.source&&e.jsxs("div",{className:"mt-0.5 text-[9px] text-gray-400",children:["Source: ",o.source]})]}):e.jsx("div",{className:"text-xs text-gray-500 italic py-2 text-center bg-gray-100 rounded",children:p==="de"?"Foto nicht geladen":"Photo not loaded"})]},ce))})]}),A&&e.jsxs("div",{className:H||Q?"mt-4 pt-3 border-t border-pink-200":"mt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-indigo-700 mb-2 flex items-center gap-1",children:["üî≤ ",p==="de"?"Visual Bible Referenzgitter":p==="fr"?"Grille Visual Bible":"Visual Bible Reference Grid"]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-2 border border-indigo-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800",children:p==="de"?"Kombinierte Referenzen":p==="fr"?"R√©f√©rences combin√©es":"Combined References"}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap bg-indigo-100 text-indigo-700 border-indigo-300",children:"üî≤ VB GRID"})]}),e.jsx("div",{className:"text-[10px] text-gray-500 mb-2",children:p==="de"?"Sekund√§re Charaktere, Tiere, Artefakte, Fahrzeuge und zus√§tzliche Wahrzeichen":p==="fr"?"Personnages secondaires, animaux, artefacts, v√©hicules et monuments suppl√©mentaires":"Secondary characters, animals, artifacts, vehicles, and additional landmarks"}),E?e.jsx("img",{src:E,alt:"Visual Bible Reference Grid",className:"w-full max-h-64 object-contain rounded border border-indigo-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>b(E),title:"Click to enlarge"}):e.jsx("div",{className:"text-xs text-gray-500 italic py-4 text-center bg-gray-100 rounded",children:c?p==="de"?"Wird geladen...":"Loading...":p==="de"?"Bild nicht geladen":"Image not loaded"})]})]}),e.jsx(ia,{src:F,onClose:()=>b(null)})]})}function fa({pageNumber:d,scene:$,onSceneChange:x,onClose:m,onRegenerate:p,isRegenerating:R,imageRegenerationCost:S,characters:F=[],selectedCharacterIds:b=[],onCharacterSelectionChange:v,consistencyRegen:w}){const{language:f}=it(),[D,K]=P.useState(!1),[h,c]=P.useState(!1),T=n=>{v&&(b.includes(n)?v(b.filter(O=>O!==n)):v([...b,n]))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(de,{size:20}),f==="de"?`Szene bearbeiten - Seite ${d}`:f==="fr"?`Modifier la sc√®ne - Page ${d}`:`Edit Scene - Page ${d}`]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:f==="de"?"Bearbeiten Sie die Szenenbeschreibung und w√§hlen Sie die Charaktere aus.":f==="fr"?"Modifiez la description de la sc√®ne et s√©lectionnez les personnages.":"Edit the scene description and select the characters."})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[F.length>0&&v&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(Nt,{size:16}),f==="de"?"Charaktere in dieser Szene:":f==="fr"?"Personnages dans cette sc√®ne:":"Characters in this scene:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:F.map(n=>{const O=b.includes(n.id);return e.jsxs("button",{type:"button",onClick:()=>T(n.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${O?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{className:"font-medium",children:n.name}),O&&e.jsx("span",{className:"text-indigo-500",children:"‚úì"})]},n.id)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:f==="de"?"W√§hlen Sie die Charaktere aus, die im Bild erscheinen sollen.":f==="fr"?"S√©lectionnez les personnages qui doivent appara√Ætre dans l'image.":"Select the characters that should appear in the image."})]}),w&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ta,{className:"text-amber-600",size:20}),e.jsx("h4",{className:"font-semibold text-amber-800",children:f==="de"?"Konsistenz-Korrektur angewendet":f==="fr"?"Correction de coh√©rence appliqu√©e":"Consistency Fix Applied"}),e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded",children:["Score: ",w.score,"%"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-amber-700 mb-2",children:f==="de"?"Behobene Probleme:":f==="fr"?"Probl√®mes corrig√©s:":"Issues Fixed:"}),e.jsx("ul",{className:"text-sm text-amber-900 space-y-1",children:w.issues.map((n,O)=>e.jsxs("li",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[n.type.toUpperCase(),n.characterInvolved&&` (${n.characterInvolved})`,":"]}),e.jsx("span",{className:"text-amber-700 ml-2",children:n.description}),e.jsxs("span",{className:"text-amber-600 ml-2 text-xs",children:["‚Üí ",n.recommendation]})]},O))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1 text-center",children:"Original"}),e.jsx("img",{src:w.originalImage,alt:"Original",className:"w-full rounded-lg border border-gray-300",draggable:!1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-600 mb-1 text-center",children:f==="de"?"Korrigiert":f==="fr"?"Corrig√©":"Fixed"}),e.jsx("img",{src:w.fixedImage,alt:"Fixed",className:"w-full rounded-lg border-2 border-green-500",draggable:!1})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>K(!D),className:"flex items-center gap-1 text-xs text-gray-600 hover:text-gray-800",children:[D?e.jsx(wr,{size:14}):e.jsx(He,{size:14}),f==="de"?"Original-Prompt":f==="fr"?"Prompt original":"Original Prompt"]}),D&&e.jsx("pre",{className:"text-xs bg-gray-100 p-2 rounded overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:w.originalPrompt}),e.jsxs("button",{onClick:()=>c(!h),className:"flex items-center gap-1 text-xs text-green-600 hover:text-green-800",children:[h?e.jsx(wr,{size:14}):e.jsx(He,{size:14}),f==="de"?"Korrigierter Prompt (mit Korrekturen)":f==="fr"?"Prompt corrig√© (avec corrections)":"Fixed Prompt (with corrections)"]}),h&&e.jsx("pre",{className:"text-xs bg-green-50 p-2 rounded border border-green-200 overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:w.fixedPrompt})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xs text-gray-400",children:f==="de"?`Korrigiert am ${new Date(w.timestamp).toLocaleString()}`:f==="fr"?`Corrig√© le ${new Date(w.timestamp).toLocaleString()}`:`Fixed at ${new Date(w.timestamp).toLocaleString()}`}),w.clothing&&e.jsxs("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded",children:["üé® ",w.clothing]})]}),w.avatarsUsed&&w.avatarsUsed.length>0&&e.jsxs("div",{className:"mt-3 p-2 bg-blue-50 rounded border border-blue-200",children:[e.jsx("p",{className:"text-xs font-medium text-blue-700 mb-1",children:f==="de"?"Verwendete Avatare:":f==="fr"?"Avatars utilis√©s:":"Avatars used:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.avatarsUsed.map((n,O)=>e.jsxs("span",{className:`text-xs px-2 py-1 rounded ${n.hasPhoto?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:[n.name,n.category&&n.category!=="standard"&&e.jsxs("span",{className:"ml-1 opacity-75",children:["(",n.category,")"]}),!n.hasPhoto&&" ‚ö†Ô∏è"]},O))})]}),w.retryHistory&&w.retryHistory.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(ls,{retryHistory:w.retryHistory,totalAttempts:w.totalAttempts||1,language:f})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:f==="de"?"Szenenbeschreibung:":f==="fr"?"Description de la sc√®ne:":"Scene description:"}),e.jsx("textarea",{value:$,onChange:n=>x(n.target.value),className:"w-full h-40 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y",placeholder:f==="de"?"Beschreiben Sie die Szene...":f==="fr"?"D√©crivez la sc√®ne...":"Describe the scene..."}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:f==="de"?"Tipp: Beschreiben Sie die Aktionen und die Umgebung. Die ausgew√§hlten Charaktere werden automatisch hinzugef√ºgt.":f==="fr"?"Conseil: D√©crivez les actions et l'environnement. Les personnages s√©lectionn√©s seront ajout√©s automatiquement.":"Tip: Describe the actions and the environment. Selected characters will be added automatically."})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:b.length>0&&e.jsx("span",{children:f==="de"?`${b.length} Charakter(e) ausgew√§hlt`:f==="fr"?`${b.length} personnage(s) s√©lectionn√©(s)`:`${b.length} character(s) selected`})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:m,disabled:R,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700 font-medium disabled:opacity-50 order-2 sm:order-1",children:f==="de"?"Abbrechen":f==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:p,disabled:R||!$.trim(),className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 order-1 sm:order-2 ${R||!$.trim()?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:R?e.jsxs(e.Fragment,{children:[e.jsx(ke,{size:16,className:"animate-spin"}),f==="de"?"Generiere...":f==="fr"?"G√©n√©ration...":"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{size:16}),f==="de"?"Neu generieren":f==="fr"?"R√©g√©n√©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",S,")"]})]})})]})]})]})})}const ja={frontCover:{en:"Front Cover",de:"Titelseite",fr:"Couverture"},initialPage:{en:"Dedication Page",de:"Widmungsseite",fr:"Page de d√©dicace"},backCover:{en:"Back Cover",de:"R√ºckseite",fr:"Quatri√®me de couverture"}};function kr({pageNumber:d,coverType:$,versions:x,onClose:m,onSelectVersion:p,developerMode:R=!1}){const{language:S}=it(),F=()=>{if($){const v=ja[$],w=S==="de"?v.de:S==="fr"?v.fr:v.en;return S==="de"?`Bildversionen - ${w}`:S==="fr"?`Versions d'image - ${w}`:`Image Versions - ${w}`}return S==="de"?`Bildversionen - Seite ${d}`:S==="fr"?`Versions d'image - Page ${d}`:`Image Versions - Page ${d}`},b=v=>{$?p($,v):d!==void 0&&p(d,v)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Ne,{size:20}),F()]}),e.jsx("button",{onClick:m,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Pe,{size:20})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:x.map((v,w)=>e.jsxs("div",{className:`relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${v.isActive?"border-green-500 ring-2 ring-green-200":"border-gray-200 hover:border-indigo-300"}`,onClick:()=>b(w),children:[e.jsx("img",{src:v.imageData,alt:`Version ${w+1}`,className:"w-full aspect-square object-cover"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:w===0?"Original":`V${w+1}`}),e.jsxs("div",{className:"flex items-center gap-1",children:[R&&v.qualityScore!=null&&e.jsxs("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold ${v.qualityScore>=80?"bg-green-600":v.qualityScore>=60?"bg-yellow-600":"bg-red-600"}`,children:[v.qualityScore,"%"]}),v.isActive&&e.jsx("span",{className:"bg-green-500 px-2 py-0.5 rounded text-[10px] font-bold",children:S==="de"?"Aktiv":S==="fr"?"Actif":"Active"})]})]}),e.jsx("div",{className:"text-[10px] text-gray-300 mt-1",children:new Date(v.createdAt).toLocaleDateString()})]})]},w))}),R&&x.length>1&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-700",children:S==="de"?"Szenen- und Prompt-Vergleich":S==="fr"?"Comparaison de sc√®nes et prompts":"Scene & Prompt Comparison"}),x.map((v,w)=>e.jsxs("details",{className:`rounded-lg p-3 ${v.isActive?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-medium text-gray-700",children:[w===0?"Original":`V${w+1}`,v.isActive&&e.jsx("span",{className:"ml-2 text-green-600 text-xs",children:"(Active)"})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[v.userInput&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-purple-700",children:S==="de"?"Benutzer-Eingabe:":S==="fr"?"Entr√©e utilisateur:":"User Input:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-purple-50 p-2 rounded border border-purple-200 max-h-24 overflow-y-auto",children:v.userInput})]}),v.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-amber-700",children:S==="de"?"Erweiterte Szene:":S==="fr"?"Sc√®ne √©tendue:":"Expanded Scene:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-24 overflow-y-auto",children:v.description})]}),v.prompt&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-blue-700",children:S==="de"?"API-Prompt:":S==="fr"?"Prompt API:":"API Prompt:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-32 overflow-y-auto",children:v.prompt})]}),v.modelId&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Model: ",v.modelId]}),v.qualityScore!=null&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Quality:"}),e.jsxs("span",{className:`text-xs font-bold ${v.qualityScore>=80?"text-green-600":v.qualityScore>=60?"text-yellow-600":"text-red-600"}`,children:[v.qualityScore,"%"]}),v.totalAttempts!=null&&v.totalAttempts>1&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",v.totalAttempts," attempts)"]})]}),v.qualityReasoning&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700",children:"Quality Reasoning:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-24 overflow-y-auto",children:v.qualityReasoning})]}),v.fixTargets&&v.fixTargets.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-semibold text-orange-700",children:["Fix Targets (",v.fixTargets.length,"):"]}),e.jsx("ul",{className:"text-xs text-gray-600 list-disc list-inside",children:v.fixTargets.map((f,D)=>e.jsx("li",{children:f.issue},D))})]}),v.referencePhotoNames&&v.referencePhotoNames.length>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Avatars: ",v.referencePhotoNames.map(f=>f.name).join(", ")]})]})]},w))]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 text-sm text-gray-500",children:S==="de"?"Klicken Sie auf ein Bild, um es auszuw√§hlen":S==="fr"?"Cliquez sur une image pour la s√©lectionner":"Click an image to select it"})]})})}function ya({src:d,title:$,onClose:x}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:x,children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] bg-white rounded-lg overflow-hidden",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:$}),e.jsx("button",{onClick:x,className:"text-gray-500 hover:text-gray-700 p-1",children:e.jsx(Pe,{size:20})})]}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsx("img",{src:d,alt:$,className:"max-w-full max-h-[80vh] object-contain mx-auto"})})]})})}function Na({beforeImage:d,afterImage:$,diffImage:x,title:m,onClose:p}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:p,children:e.jsxs("div",{className:"relative bg-white rounded-lg overflow-hidden max-w-[95vw] max-h-[95vh]",onClick:R=>R.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-3 flex items-center justify-between border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:m}),e.jsx("button",{onClick:p,className:"text-gray-500 hover:text-gray-700 p-1",children:e.jsx(Pe,{size:20})})]}),e.jsx("div",{className:"p-4 bg-gray-50 overflow-auto max-h-[calc(95vh-60px)]",children:e.jsxs("div",{className:`grid gap-4 ${x?"grid-cols-1 lg:grid-cols-3":"grid-cols-1 lg:grid-cols-2"}`,children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 mb-2 bg-red-100 px-3 py-1 rounded-full",children:"Before"}),e.jsx("img",{src:d,alt:"Before repair",className:"max-w-full max-h-[70vh] object-contain border rounded shadow-sm"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 mb-2 bg-green-100 px-3 py-1 rounded-full",children:"After"}),e.jsx("img",{src:$,alt:"After repair",className:"max-w-full max-h-[70vh] object-contain border rounded shadow-sm"})]}),x&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 mb-2 bg-purple-100 px-3 py-1 rounded-full",children:"Diff (changes in magenta)"}),e.jsx("img",{src:x,alt:"Difference",className:"max-w-full max-h-[70vh] object-contain border rounded shadow-sm"})]})]})})]})})}const Pr={en:{adventure:"Adventure","life-challenge":"Life Challenge",educational:"Educational",historical:"Historical"},de:{adventure:"Abenteuer","life-challenge":"Lebensherausforderung",educational:"Bildung",historical:"Historisch"},fr:{adventure:"Aventure","life-challenge":"D√©fi de vie",educational:"√âducatif",historical:"Historique"}},Ir={en:{"1st-grade":"Picture Book (1st Grade)",standard:"Standard",advanced:"Advanced"},de:{"1st-grade":"Bilderbuch (1. Klasse)",standard:"Standard",advanced:"Fortgeschritten"},fr:{"1st-grade":"Livre illustr√© (1√®re ann√©e)",standard:"Standard",advanced:"Avanc√©"}},va={"de-CH":"Schweizerdeutsch","de-DE":"Deutsch (Deutschland)",en:"English",fr:"Fran√ßais"};function wa({settings:d,language:$}){var K,h;const[x,m]=P.useState(!1),p=c=>{const T={en:{title:"Story Info",category:"Category",topic:"Topic",theme:"Theme",storyType:"Story Type",storyDetails:"Story Idea",artStyle:"Art Style",language:"Language",readingLevel:"Reading Level",pages:"Length",dedication:"Dedication",mainCharacters:"Main Characters",otherCharacters:"Other Characters",relationships:"Relationships",season:"Season",location:"Location",noData:"Not specified",spring:"Spring",summer:"Summer",autumn:"Autumn",winter:"Winter"},de:{title:"Story-Info",category:"Kategorie",topic:"Thema",theme:"Thema",storyType:"Story-Typ",storyDetails:"Story-Idee",artStyle:"Kunststil",language:"Sprache",readingLevel:"Lesestufe",pages:"L√§nge",dedication:"Widmung",mainCharacters:"Hauptfiguren",otherCharacters:"Andere Figuren",relationships:"Beziehungen",season:"Jahreszeit",location:"Ort",noData:"Nicht angegeben",spring:"Fr√ºhling",summer:"Sommer",autumn:"Herbst",winter:"Winter"},fr:{title:"Info histoire",category:"Cat√©gorie",topic:"Sujet",theme:"Th√®me",storyType:"Type d'histoire",storyDetails:"Id√©e d'histoire",artStyle:"Style artistique",language:"Langue",readingLevel:"Niveau de lecture",pages:"Longueur",dedication:"D√©dicace",mainCharacters:"Personnages principaux",otherCharacters:"Autres personnages",relationships:"Relations",season:"Saison",location:"Lieu",noData:"Non sp√©cifi√©",spring:"Printemps",summer:"√ât√©",autumn:"Automne",winter:"Hiver"}};return(T[$]||T.en)[c]||c},R=c=>(Pr[$]||Pr.en)[c]||c,S=c=>(Ir[$]||Ir.en)[c]||c,F=(c,T)=>c==null||c===""?e.jsx("span",{className:"text-gray-400 italic",children:p("noData")}):e.jsx("span",{className:"text-gray-800",children:c}),b=d.mainCharacters||[],v=((K=d.characters)==null?void 0:K.filter(c=>b.includes(c.id)))||[],w=((h=d.characters)==null?void 0:h.filter(c=>!b.includes(c.id)))||[],f=c=>p(c)||c,D=()=>{if(!d.userLocation)return null;const c=[d.userLocation.city,d.userLocation.region,d.userLocation.country].filter(Boolean);return c.length>0?c.join(", "):null};return e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>m(!x),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-amber-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ra,{size:16,className:"text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-800",children:p("title")}),e.jsx("span",{className:"text-xs bg-amber-200 text-amber-700 px-2 py-0.5 rounded",children:"DEV"})]}),x?e.jsx(He,{size:18,className:"text-amber-600"}):e.jsx(jt,{size:18,className:"text-amber-600"})]}),x&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[v.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(ft,{size:12}),p("mainCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(c=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-indigo-100 text-indigo-800 border border-indigo-200",children:[e.jsx(ft,{size:10}),e.jsx("span",{children:c.name})]},c.id))})]}),w.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(Nt,{size:12}),p("otherCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(c=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700 border border-gray-200",children:[e.jsx(ft,{size:10}),e.jsx("span",{children:c.name})]},c.id))})]}),d.relationships&&Object.keys(d.relationships).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-2",children:p("relationships")}),e.jsx("div",{className:"text-xs bg-white/50 p-2 rounded border border-amber-100 space-y-1",children:Object.entries(d.relationships).map(([c,T])=>{var u,W;const[n,O]=c.split("-").map(y=>parseInt(y,10)),G=(u=d.characters)==null?void 0:u.find(y=>y.id===n),U=(W=d.characters)==null?void 0:W.find(y=>y.id===O);return!G||!U?null:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-amber-600 font-medium whitespace-nowrap",children:[G.name," ‚Üí ",U.name,":"]}),e.jsx("span",{className:"text-gray-700",children:T})]},c)})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(ca,{size:12}),p("language")]}),e.jsx("div",{className:"text-sm",children:d.language?va[d.language]||d.language:F(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:p("readingLevel")}),e.jsx("div",{className:"text-sm",children:d.languageLevel?S(d.languageLevel):F(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:p("pages")}),e.jsx("div",{className:"text-sm",children:d.pages?`${d.pages} ${$==="de"?"Seiten":"pages"}`:F(void 0)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:p("season")}),e.jsx("div",{className:"text-sm",children:d.season?f(d.season):F(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:p("location")}),e.jsx("div",{className:"text-sm",children:D()||F(void 0)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(na,{size:12}),p("artStyle")]}),e.jsx("div",{className:"text-sm capitalize",children:F(d.artStyle)})]})]}),d.storyDetails&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(ns,{size:12}),p("storyDetails")]}),e.jsx("div",{className:"text-sm bg-white/50 p-2 rounded border border-amber-100 whitespace-pre-wrap",children:d.storyDetails})]}),(d.storyCategory||d.storyTheme||d.storyTopic)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-amber-100",children:[d.storyCategory&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(la,{size:12}),p("category")]}),e.jsx("div",{className:"text-sm",children:R(d.storyCategory)})]}),(d.storyTheme||d.storyTopic)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:d.storyCategory==="adventure"?p("theme"):p("topic")}),e.jsx("div",{className:"text-sm",children:d.storyCategory==="adventure"?d.storyTheme:d.storyTopic})]})]})]})]})}function Ar({storyId:d,onShareStatusChange:$,variant:x="compact"}){const{language:m}=it(),[p,R]=P.useState(!1),[S,F]=P.useState(null),[b,v]=P.useState(!1),[w,f]=P.useState(!1),[D,K]=P.useState(null),h=x==="full",c={share:m==="de"?"Teilen":m==="fr"?"Partager":"Share",shareStory:m==="de"?"Geschichte teilen":m==="fr"?"Partager l'histoire":"Share Story",enableSharing:m==="de"?"Link aktivieren":m==="fr"?"Activer le lien":"Enable sharing",disableSharing:m==="de"?"Link deaktivieren":m==="fr"?"D√©sactiver le lien":"Disable sharing",copyLink:m==="de"?"Link kopieren":m==="fr"?"Copier le lien":"Copy link",copied:m==="de"?"Kopiert!":m==="fr"?"Copi√©!":"Copied!",shareWhatsApp:m==="de"?"Per WhatsApp teilen":m==="fr"?"Partager sur WhatsApp":"Share on WhatsApp",sharingEnabled:m==="de"?"Teilen aktiv":m==="fr"?"Partage actif":"Sharing enabled",sharingDisabled:m==="de"?"Teilen inaktiv":m==="fr"?"Partage inactif":"Sharing disabled",anyoneWithLink:m==="de"?"Jeder mit dem Link kann die Geschichte lesen":m==="fr"?"Toute personne avec le lien peut lire l'histoire":"Anyone with the link can read the story",errorLoading:m==="de"?"Fehler beim Laden":m==="fr"?"Erreur de chargement":"Error loading"};P.useEffect(()=>{p&&!S&&T()},[p]);const T=async()=>{v(!0),K(null);try{const U=localStorage.getItem("auth_token"),u=await fetch(`/api/stories/${d}/share-status`,{headers:U?{Authorization:`Bearer ${U}`}:{}});if(!u.ok)throw new Error("Failed to fetch status");const W=await u.json();F(W)}catch{K(c.errorLoading)}finally{v(!1)}},n=async()=>{v(!0),K(null);try{const u=(S==null?void 0:S.isShared)?"DELETE":"POST",W=localStorage.getItem("auth_token"),y=await fetch(`/api/stories/${d}/share`,{method:u,headers:W?{Authorization:`Bearer ${W}`}:{}});if(!y.ok)throw new Error("Failed to toggle sharing");const C=await y.json();F({isShared:C.isShared,shareToken:C.shareToken,shareUrl:C.shareUrl}),$==null||$(C.isShared)}catch{K("Failed to update sharing")}finally{v(!1)}},O=async()=>{if(S!=null&&S.shareUrl)try{await navigator.clipboard.writeText(S.shareUrl),f(!0),setTimeout(()=>f(!1),2e3)}catch{const u=document.createElement("textarea");u.value=S.shareUrl,document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),f(!0),setTimeout(()=>f(!1),2e3)}},G=()=>{if(!(S!=null&&S.shareUrl))return;const U=encodeURIComponent(S.shareUrl);window.open(`https://wa.me/?text=${U}`,"_blank")};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>R(!p),className:h?"bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full hover:bg-indigo-600":"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-lg hover:from-blue-600 hover:to-indigo-600 transition-all shadow-md hover:shadow-lg",title:c.share,children:[e.jsx($r,{className:"w-4 h-4"}),e.jsx("span",{className:h?"":"hidden sm:inline",children:c.share}),(S==null?void 0:S.isShared)&&e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>R(!1)}),e.jsxs("div",{className:"fixed inset-x-4 bottom-4 sm:absolute sm:inset-auto sm:right-0 sm:bottom-auto sm:mt-2 w-auto sm:w-80 bg-white rounded-xl shadow-xl border border-gray-200 z-50 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx($r,{className:"w-5 h-5 text-blue-600"}),c.shareStory]})}),e.jsx("div",{className:"p-4 space-y-4",children:b&&!S?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(pe,{className:"w-6 h-6 animate-spin text-blue-500"})}):D?e.jsx("div",{className:"text-red-500 text-sm py-2",children:D}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[S!=null&&S.isShared?e.jsx(ma,{className:"w-5 h-5 text-green-500"}):e.jsx(xa,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:S!=null&&S.isShared?"text-green-700":"text-gray-600",children:S!=null&&S.isShared?c.sharingEnabled:c.sharingDisabled})]}),e.jsx("button",{onClick:n,disabled:b,className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${S!=null&&S.isShared?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"} disabled:opacity-50`,children:b?e.jsx(pe,{className:"w-4 h-4 animate-spin"}):S!=null&&S.isShared?c.disableSharing:c.enableSharing})]}),(S==null?void 0:S.isShared)&&S.shareUrl&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500",children:c.anyoneWithLink}),e.jsx("button",{onClick:O,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:w?e.jsxs(e.Fragment,{children:[e.jsx(oa,{className:"w-4 h-4 text-green-500"}),c.copied]}):e.jsxs(e.Fragment,{children:[e.jsx(da,{className:"w-4 h-4"}),c.copyLink]})}),e.jsxs("button",{onClick:G,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors",children:[e.jsx(pa,{className:"w-4 h-4"}),c.shareWhatsApp]})]})]})})]})]})]})}function Xa({title:d,dedication:$,story:x,outline:m,outlinePrompt:p,outlineModelId:R,outlineUsage:S,storyTextPrompts:F=[],visualBible:b,sceneImages:v,sceneDescriptions:w=[],coverImages:f,regeneratingCovers:D=new Set,languageLevel:K="standard",storyLanguage:h,isGenerating:c=!1,onDownloadPdf:T,onAddToBook:n,onPrintBook:O,onCreateAnother:G,onDownloadTxt:U,onRegenerateImage:u,onRegenerateCover:W,characters:y=[],onEditImage:C,onEditCover:E,onRepairImage:H,onIteratePage:Q,onRevertRepair:A,onVisualBibleChange:ne,storyId:B,developerMode:Z=!1,styledAvatarGeneration:re=[],costumedAvatarGeneration:le=[],generationLog:te=[],finalChecksReport:o,clothingRequirements:ce,isPartial:Ds=!1,failureReason:os,generatedPages:We,totalPages:Ke,progressiveMode:ve=!1,progressiveData:Ue,completedPageImages:vt={},originalStory:Os,onSaveStoryText:Fs,onSaveTitleChange:nt,userCredits:wt=0,imageRegenerationCost:Ae=5,isImpersonating:zr=!1,onSelectImageVersion:St,onSelectCoverVersion:Ct,generationSettings:$t,onRefreshStory:Je}){var Kt,Ut,Jt,Qt,Gt,Zt,Yt,Xt,er,sr,tr,rr,ar;const{t:Dr,language:t}=it(),q=h?h.startsWith("de")?"de":h:t,ae=zr||wt===-1||wt>=Ae,[V,lt]=P.useState(null),[ue,Ee]=P.useState(""),[Qe,Rs]=P.useState(!1),[Ls,Es]=P.useState(x),[ds,kt]=P.useState(!1),[ot,Bs]=P.useState(!1),[Ts,Ms]=P.useState(d||""),[dt,Pt]=P.useState(!1),[ct,Vs]=P.useState(null),[xt,cs]=P.useState(null),[ge,xs]=P.useState(null),[,It]=P.useState(!1),[we,mt]=P.useState(new Set),[J,Be]=P.useState(null),[be,At]=P.useState(null),[Ge,zt]=P.useState(null),[ms,Dt]=P.useState(null),[ie,Ot]=P.useState(null),[Te,Ft]=P.useState(null),[_s,Me]=P.useState(null),[oe,ze]=P.useState("fresh"),[pt,ee]=P.useState(null),[ps,qs]=P.useState(null),[Ze,Hs]=P.useState("square"),[Ye,Ws]=P.useState(!1),[Ks,Or]=P.useState({}),[Xe,Rt]=P.useState(new Set),Lt=async s=>{if(!(!B||Ks[s]||Xe.has(s))){Rt(i=>new Set(i).add(s));try{const i=localStorage.getItem("auth_token"),a=await fetch(`/api/stories/${B}/visual-bible-image/${s}`,{headers:i?{Authorization:`Bearer ${i}`}:{}});if(a.ok){const l=await a.json();Or(r=>({...r,[s]:l.imageData}))}}catch(i){console.error(`Failed to load reference image for ${s}:`,i)}finally{Rt(i=>{const a=new Set(i);return a.delete(s),a})}}},gs=(s,i)=>{if(!i||!Z)return null;const a=Ks[s],l=Xe.has(s);return a?e.jsx("img",{src:a,alt:"Reference",className:"w-16 h-16 object-cover rounded border border-rose-300 cursor-pointer hover:opacity-80",onClick:()=>ee({src:a,title:"Reference Image"})}):e.jsx("button",{onClick:()=>Lt(s),disabled:l,className:"w-16 h-16 flex items-center justify-center bg-rose-100 border border-rose-300 rounded text-rose-500 hover:bg-rose-200 disabled:opacity-50",title:"Load reference image",children:l?e.jsx(pe,{size:16,className:"animate-spin"}):e.jsx(Ne,{size:16})})},[Ve,Fr]=P.useState({}),[De,Et]=P.useState(new Set),gt=async(s,i)=>{const a=`${s}-${i}`;if(!(!B||Ve[a]||De.has(a))){Et(l=>new Set(l).add(a));try{const l=await at.getAvatarGenerationImage(B,s,i);l&&Fr(r=>({...r,[a]:l}))}catch(l){console.error(`Failed to load avatar generation images for ${a}:`,l)}finally{Et(l=>{const r=new Set(l);return r.delete(a),r})}}},Rr=async()=>{if(!B||!re)return;const s=re.map((i,a)=>a).filter(i=>!Ve[`styled-${i}`]&&!De.has(`styled-${i}`));await Promise.all(s.map(i=>gt("styled",i)))},Lr=async()=>{if(!B||!le)return;const s=le.map((i,a)=>a).filter(i=>!Ve[`costumed-${i}`]&&!De.has(`costumed-${i}`));await Promise.all(s.map(i=>gt("costumed",i)))},Er=async()=>{if(!B||!b)return;const i=[...b.secondaryCharacters||[],...b.animals||[],...b.artifacts||[],...b.locations||[],...b.vehicles||[]].filter(a=>a.hasReferenceImage&&!Ks[a.id]&&!Xe.has(a.id)).map(a=>a.id);await Promise.all(i.map(a=>Lt(a)))},[hs,Br]=P.useState({}),[us,Bt]=P.useState(new Set),Tt=async s=>{if(!(!B||hs[s]!==void 0||us.has(s))){Bt(i=>new Set(i).add(s));try{const i=await at.getEntityGridImageByIndex(B,s);i!=null&&i.gridImage&&Br(a=>({...a,[s]:i.gridImage}))}catch(i){console.error(`Failed to load entity grid image for index ${s}:`,i)}finally{Bt(i=>{const a=new Set(i);return a.delete(s),a})}}},Tr=async()=>{var a;if(!B)return;const i=(((a=o==null?void 0:o.entity)==null?void 0:a.grids)||[]).map((l,r)=>({grid:l,idx:r})).filter(({grid:l,idx:r})=>!l.gridImage&&hs[r]===void 0).map(({idx:l})=>l);await Promise.all(i.map(l=>Tt(l)))},Mr=async(s,i,a)=>new Promise((l,r)=>{const g=new Image;g.onload=()=>{const N=document.createElement("canvas"),z=N.getContext("2d");if(!z){r(new Error("Could not get canvas context"));return}const{cellSize:I,cols:_}=a,Y=Math.floor(i/_),xe=i%_*I,me=Y*I;N.width=I,N.height=I,z.drawImage(g,xe,me,I,I,0,0,I,I),l(N.toDataURL("image/png"))},g.onerror=()=>r(new Error("Failed to load grid image")),g.src=s}),Vr=async(s,i)=>{try{const a=s.manifest.cells[i],l=await Mr(s.gridImage,i,s.manifest),r=a.isReference?"Reference":`Page ${a.pageNumber}`,g=a.clothing&&a.clothing!=="standard"?` (${a.clothing})`:"";ee({src:l,title:`${s.entityName} - ${r}${g}`})}catch(a){console.error("Failed to crop cell:",a)}},_r=(s,i,a,l)=>{var N,z,I,_,Y,X;const r=`${s}-${i}`,g=Ve[r];return g&&g[l]?g[l]:l==="output"&&((N=a.output)!=null&&N.imageData)?a.output.imageData:l==="facePhoto"&&((z=a.inputs.facePhoto)!=null&&z.imageData)?a.inputs.facePhoto.imageData:l==="originalAvatar"&&"originalAvatar"in a.inputs&&((I=a.inputs.originalAvatar)!=null&&I.imageData)?a.inputs.originalAvatar.imageData:l==="styleSample"&&"styleSample"in a.inputs&&((_=a.inputs.styleSample)!=null&&_.imageData)?a.inputs.styleSample.imageData:l==="standardAvatar"&&"standardAvatar"in a.inputs&&((Y=a.inputs.standardAvatar)!=null&&Y.imageData)?a.inputs.standardAvatar.imageData||null:l==="referenceAvatar"&&"referenceAvatar"in a.inputs&&((X=a.inputs.referenceAvatar)!=null&&X.imageData)&&a.inputs.referenceAvatar.imageData||null},Se=(s,i,a,l,r,g)=>{const N=_r(s,i,a,l),z=`${s}-${i}`,I=De.has(z),_=!!Ve[z];return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:r}),N?e.jsx("img",{src:N,alt:r,className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>ee({src:N,title:r}),title:g?`${g} KB - Click to enlarge`:"Click to enlarge"}):g?e.jsx("button",{onClick:()=>gt(s,i),disabled:I||_,className:"w-16 h-16 flex flex-col items-center justify-center bg-blue-50 border border-blue-300 rounded text-blue-500 hover:bg-blue-100 disabled:opacity-50 text-[10px]",title:"Click to load images",children:I?e.jsx(pe,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{size:14}),e.jsxs("span",{className:"mt-0.5",children:[g," KB"]})]})}):e.jsx("span",{className:"text-gray-400 italic text-[10px]",children:"N/A"})]})};P.useEffect(()=>{Qe||Es(x)},[x,Qe]),P.useEffect(()=>{ot||Ms(d||"")},[d,ot]);const qr=async()=>{if(Fs){kt(!0);try{await Fs(Ls),Rs(!1)}catch(s){console.error("Failed to save story text:",s)}finally{kt(!1)}}},Mt=async()=>{if(!(!nt||!Ts.trim())){Pt(!0);try{await nt(Ts.trim()),Bs(!1)}catch(s){console.error("Failed to save title:",s)}finally{Pt(!1)}}},Hr=()=>{Es(x),Rs(!1)},Vt=async s=>{if(!(!H||be!==null)){At(s);try{await H(s)}catch(i){console.error("Failed to repair image:",i)}finally{At(null)}}},_t=async(s,i)=>{if(!(!Q||Te!==null)){Ft(s),Me(null);try{await Q(s,i)}catch(a){console.error("Failed to iterate page:",a)}finally{Ft(null)}}},Wr=async s=>{if(!(!B||Ge!==null)){zt(s);try{const i=await fetch(`/api/stories/${B}/repair-entity-consistency`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({entityName:s,entityType:"character"})});if(!i.ok){const l=await i.json();throw new Error(l.error||"Repair failed")}const a=await i.json();console.log("Entity repair result:",a),a.success&&!a.noChanges&&(Je?await Je():window.location.reload())}catch(i){console.error("Failed to repair entity consistency:",i),alert(`Failed to repair: ${i instanceof Error?i.message:"Unknown error"}`)}finally{zt(null)}}},Kr=async(s,i)=>{if(!(!B||ie!==null)){Ot({entity:s,page:i});try{const a=await fetch(`/api/stories/${B}/repair-entity-consistency`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({entityName:s,entityType:"character",pageNumber:i})});if(!a.ok){const r=await a.json();throw new Error(r.error||"Repair failed")}const l=await a.json();if(console.log("Single-page entity repair result:",l),l.rejected&&l.comparison){qs({beforeImage:l.comparison.before,afterImage:l.comparison.after,title:`Repair rejected for ${s} on page ${i}: ${l.reason||"Did not improve consistency"}`});return}l.success?Je?await Je():window.location.reload():l.rejected||alert(`Repair failed: ${l.error||"Unknown error"}`)}catch(a){console.error("Failed to repair single page:",a),alert(`Failed to repair page ${i}: ${a instanceof Error?a.message:"Unknown error"}`)}finally{Ot(null)}}},Ur=async(s,i)=>{if(!(!B||ms!==null)){Dt(s);try{const a=await fetch(`/api/stories/${B}/repair/image/${s}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({correctionNotes:`${i.type||""}: ${i.description||""}
Target: ${i.canonicalVersion||""}
Fix: ${i.recommendation||""}`})});if(!a.ok){const r=await a.json();throw new Error(r.error||"Repair failed")}const l=await a.json();console.log("Image issue repair result:",l),l.success&&(Je?await Je():window.location.reload())}catch(a){console.error("Failed to repair image issue:",a),alert(`Failed to repair: ${a instanceof Error?a.message:"Unknown error"}`)}finally{Dt(null)}}},qt=(s,i)=>{const a=Ls.split(/(?=---\s*(?:Page|Seite)\s+\d+\s*---|(?=##\s*(?:Page|Seite)\s+\d+))/i);let l=0;for(let g=0;g<a.length;g++)if(/^(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i.test(a[g].trim())){l=g;break}const r=l+s;if(r<a.length){const g=a[r].match(/^(---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i),N=g?g[0]:"";a[r]=N+`
`+i.trim()+`
`}Es(a.join(""))},es=s=>{const i=v.find(a=>a.pageNumber===s);return(i==null?void 0:i.imageVersions)||[]},Jr=async(s,i)=>{if(St)try{await St(s,i),Vs(null)}catch(a){console.error("Failed to select image version:",a)}},Qr=async(s,i)=>{if(Ct)try{await Ct(s,i),cs(null)}catch(a){console.error("Failed to select cover image version:",a)}},Ce=s=>{const i=f==null?void 0:f[s];return i?i.imageVersions||[]:[]},Gr=s=>{if(!s)return"";let i;if(typeof s!="string"){const g=s;if(g.output)if(typeof g.output=="string")i=g.output;else if(typeof g.output=="object"){const N=g.output.translatedSummary||g.output.imageSummary||"";if(N)return N;i=JSON.stringify(s)}else i=JSON.stringify(s);else i=JSON.stringify(s)}else i=s;if(i.trim().startsWith("{"))try{const g=JSON.parse(i);if(g.output){if(typeof g.output=="string")i=g.output;else if(typeof g.output=="object"){const N=g.output.translatedSummary||g.output.imageSummary;if(N)return N}}}catch{}const a=i.match(/(?:#{1,3}\s*)?(?:\*\*)?6\.?\s*(?:\*\*)?\s*\*?\*?(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*\*?\*?\s*:?\s*\n?([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n---|\n```|$)/i);if(a&&a[2]&&a[2].trim())return a[2].trim();const l=i.match(/(?:#{1,3}\s*)?\*?\*?(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*:?\s*\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n\*\*|\n#{1,3}\s|$)/i);if(l&&l[2]&&l[2].trim())return l[2].trim();if(!i.includes("**")&&i.length<1e3)return i.trim();const r=i.match(/\*?\*?(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:\*\*)?\d+\.\s*\*\*|\n\s*\*\*\d+\.|$)/i);return r&&r[2]&&r[2].trim()?r[2].trim():i.substring(0,500).trim()+"..."},Zr=s=>{if(!s||!y.length)return y.map(l=>l.id);let i;if(typeof s!="string"){const l=s;i=l.output&&typeof l.output=="string"?l.output:JSON.stringify(s)}else i=s;if(i.trim().startsWith("{"))try{const l=JSON.parse(i);l.output&&typeof l.output=="string"&&(i=l.output)}catch{}const a=i.toLowerCase();return y.filter(l=>a.includes(l.name.toLowerCase())).map(l=>l.id)},Ht=s=>{const i=v.find(N=>N.pageNumber===s),a=w.find(N=>N.pageNumber===s),l=(i==null?void 0:i.description)||(a==null?void 0:a.description)||"",r=(a==null?void 0:a.translatedSummary)||Gr(l)||(a==null?void 0:a.imageSummary)||"",g=Zr(l);xs({pageNumber:s,scene:r,selectedCharacterIds:g})},Yr=async()=>{if(!ge||!u)return;const s=ge.pageNumber,i=ge.scene,a=ge.selectedCharacterIds;xs(null),mt(l=>new Set(l).add(s)),It(!0);try{await u(s,i,a)}catch(l){console.error("Failed to regenerate image:",l)}finally{mt(l=>{const r=new Set(l);return r.delete(s),r}),mt(l=>(l.size===0&&It(!1),l))}},ht=s=>{let i="",a=[];if(s==="front"&&(f!=null&&f.frontCover)){const N=f.frontCover;typeof N=="object"&&(i=N.translatedDescription||N.description||"",a=N.referencePhotos||[])}else if(s==="initial"&&(f!=null&&f.initialPage)){const N=f.initialPage;typeof N=="object"&&(i=N.translatedDescription||N.description||"",a=N.referencePhotos||[])}else if(s==="back"&&(f!=null&&f.backCover)){const N=f.backCover;typeof N=="object"&&(i=N.translatedDescription||N.description||"",a=N.referencePhotos||[])}let l=[];a.length>0&&y.length>0&&(l=y.filter(N=>a.some(z=>z.name===N.name)).map(N=>N.id)),l.length===0&&(l=y.map(N=>N.id)),Be({coverType:s,scene:i,selectedCharacterIds:l,title:s==="front"?d:void 0,dedication:s==="initial"?$:void 0})},Xr=async()=>{if(!J||!W)return;const{coverType:s,scene:i,selectedCharacterIds:a,title:l,dedication:r}=J;Be(null);try{await W(s,i,a,l,r)}catch(g){console.error("Failed to regenerate cover:",g)}},Us=(s,i,a,l)=>{lt({type:s,id:i,field:a}),Ee(l||"")},Js=()=>{if(!V||!b||!ne)return;const{type:s,id:i,field:a}=V,l={...b};if(s==="secondaryCharacter")l.secondaryCharacters=(l.secondaryCharacters||[]).map(r=>r.id===i?{...r,[a]:ue}:r);else if(s==="animal")l.animals=(l.animals||[]).map(r=>r.id===i?{...r,[a]:ue}:r);else if(s==="artifact")l.artifacts=(l.artifacts||[]).map(r=>r.id===i?{...r,[a]:ue}:r);else if(s==="location")l.locations=(l.locations||[]).map(r=>r.id===i?{...r,[a]:ue}:r);else if(s==="mainCharacter"){const r=parseInt(i);l.mainCharacters=(l.mainCharacters||[]).map(g=>g.id!==r?g:a==="physical.face"?{...g,physical:{...g.physical,face:ue}}:a==="physical.hair"?{...g,physical:{...g.physical,hair:ue}}:a==="physical.build"?{...g,physical:{...g.physical,build:ue}}:g)}ne(l),lt(null),Ee("")},Qs=()=>{lt(null),Ee("")},ss=(s=>s?s.split(/(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i).slice(1).filter(a=>a.trim().length>0):[])(Qe?Ls:x),ts=v.length>0,Gs=K==="1st-grade",Wt=(()=>{if(!ve)return ss.length;if(ss.length===0)return 0;let s=1;for(let i=2;i<=ss.length;i++){const a=i-1;if(v.some(r=>r.pageNumber===a&&r.imageData)||!!vt[a])s=i;else break}return s})(),ea=(Ue==null?void 0:Ue.totalPages)||ss.length;Ue!=null&&Ue.totalScenes||v.length||Math.ceil(ea/(Gs?1:2));const rs=s=>(s==null?void 0:s.imageData)||null,Zs=s=>{var g,N;const a=((g=w.find(z=>z.pageNumber===s))==null?void 0:g.description)||((N=v.find(z=>z.pageNumber===s))==null?void 0:N.description);if(!a)return;const l=z=>{if(typeof z!="string")return z;try{const I=JSON.parse(z);return typeof I=="string"&&(I.startsWith("{")||I.startsWith("["))?l(I):I}catch{return z}},r=l(a);return typeof r=="object"&&r!==null?JSON.stringify(r,null,2):String(r)},Ys=s=>{const i=w.find(a=>a.pageNumber===s);return s===1&&i&&(console.log("[StoryDisplay] Page 1 scene keys:",Object.keys(i)),console.log("[StoryDisplay] Page 1 has outlineExtract:",!!i.outlineExtract),console.log("[StoryDisplay] Page 1 has scenePrompt:",!!i.scenePrompt)),i==null?void 0:i.outlineExtract},Xs=s=>{var i;return(i=w.find(a=>a.pageNumber===s))==null?void 0:i.scenePrompt},et=s=>{var i;return(i=w.find(a=>a.pageNumber===s))==null?void 0:i.textModelId};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center gap-2",children:ot?e.jsxs("div",{className:"flex items-center gap-2 w-full max-w-2xl",children:[e.jsx("input",{type:"text",value:Ts,onChange:s=>Ms(s.target.value),className:"flex-1 text-2xl md:text-3xl font-bold text-gray-800 text-center border-2 border-indigo-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-500",autoFocus:!0,onKeyDown:s=>{s.key==="Enter"&&Mt(),s.key==="Escape"&&(Ms(d||""),Bs(!1))}}),e.jsx("button",{onClick:Mt,disabled:dt||!Ts.trim(),className:"p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50",title:t==="de"?"Speichern":t==="fr"?"Sauvegarder":"Save",children:dt?e.jsx(_e,{className:"animate-spin",size:20}):e.jsx(as,{size:20})}),e.jsx("button",{onClick:()=>{Ms(d||""),Bs(!1)},disabled:dt,className:"p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",title:t==="de"?"Abbrechen":t==="fr"?"Annuler":"Cancel",children:e.jsx(Pe,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-800 text-center",children:d||Dr.yourStory}),nt&&!c&&e.jsx("button",{onClick:()=>Bs(!0),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:t==="de"?"Titel bearbeiten":t==="fr"?"Modifier le titre":"Edit title",children:e.jsx(de,{size:18})})]})}),Ds&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-400 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-amber-500 text-2xl",children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-amber-800",children:t==="de"?"Unvollst√§ndige Geschichte":t==="fr"?"Histoire incompl√®te":"Incomplete Story"}),e.jsx("p",{className:"text-amber-700 text-sm mt-1",children:t==="de"?`Diese Geschichte konnte nicht vollst√§ndig generiert werden. ${We||v.length} von ${Ke||"unbekannt"} Seiten wurden erstellt.`:t==="fr"?`Cette histoire n'a pas pu √™tre g√©n√©r√©e compl√®tement. ${We||v.length} sur ${Ke||"inconnu"} pages ont √©t√© cr√©√©es.`:`This story could not be fully generated. ${We||v.length} of ${Ke||"unknown"} pages were created.`}),os&&Z&&e.jsxs("details",{className:"mt-2 text-sm",children:[e.jsx("summary",{className:"cursor-pointer text-amber-600 hover:text-amber-700",children:t==="de"?"Fehlerdetails":t==="fr"?"D√©tails de l'erreur":"Error details"}),e.jsx("p",{className:"mt-1 bg-amber-100 p-2 rounded text-amber-800 font-mono text-xs",children:os})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[ts&&B&&n&&e.jsxs("button",{onClick:n,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Sr,{size:16})," ",t==="de"?"Buch erstellen":t==="fr"?"Cr√©er le livre":"Create Book"]}),ts&&T&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>Ws(!Ye),disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ns,{size:16}),t==="de"?"PDF herunterladen":t==="fr"?"T√©l√©charger PDF":"Download PDF",e.jsx(He,{size:14,className:`transition-transform ${Ye?"rotate-180":""}`})]}),Ye&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:Ze==="square",onChange:()=>Hs("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20√ó20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:Ze==="A4",onChange:()=>Hs("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21√ó28cm)"})]})]}),e.jsx("button",{onClick:()=>{T(Ze),Ws(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:t==="de"?"Herunterladen":t==="fr"?"T√©l√©charger":"Download"})]})]}),ts&&B&&!c&&e.jsx(Ar,{storyId:B,variant:"full"}),G&&e.jsxs("button",{onClick:G,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Cr,{size:16})," ",t==="de"?"Neue Geschichte":t==="fr"?"Nouvelle histoire":"New Story"]})]}),Z&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[U&&e.jsxs("button",{onClick:U,className:"bg-gray-500 text-white px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 hover:bg-gray-600",children:[e.jsx(qe,{size:14})," TXT"]}),ts&&B&&O&&e.jsxs("button",{onClick:O,disabled:c,className:`bg-yellow-500 text-black px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 ${c?"opacity-50 cursor-not-allowed":"hover:bg-yellow-600"}`,children:[e.jsx(bt,{size:14})," Print (DEV)"]})]}),Z&&$t&&e.jsx("div",{className:"mt-4",children:e.jsx(wa,{settings:$t,language:t})}),Z&&e.jsxs("div",{className:"space-y-4 mt-6",children:[m&&e.jsxs("details",{className:"bg-purple-50 border-2 border-purple-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-purple-800 hover:text-purple-900 flex items-center gap-2",children:[e.jsx(ns,{size:20}),Gs?t==="de"?"Vollst√§ndige API-Ausgabe (Kombiniert)":t==="fr"?"Sortie API compl√®te (Combin√©e)":"Full API Output (Combined)":t==="de"?"Vollst√§ndige API-Ausgabe (Outline)":t==="fr"?"Sortie API compl√®te (Plan)":"Full API Output (Outline)",R&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-purple-600",children:["(",R,")"]}),S&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-purple-500",children:["[",S.input_tokens.toLocaleString()," in / ",S.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[p&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:t==="de"?"üì§ Prompt (Eingabe)":t==="fr"?"üì§ Prompt (Entr√©e)":"üì§ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:p})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:Gs?t==="de"?"üì• API-Antwort (Kombiniert)":t==="fr"?"üì• R√©ponse API (Combin√©e)":"üì• API Response (Combined)":t==="de"?"üì• API-Antwort (Outline)":t==="fr"?"üì• R√©ponse API (Plan)":"üì• API Response (Outline)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:m})]})]})]}),x&&F.length>0&&e.jsxs("details",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(bt,{size:20}),t==="de"?"Vollst√§ndige API-Ausgabe (Story-Text)":t==="fr"?"Sortie API compl√®te (Texte)":"Full API Output (Story Text)",((Kt=F[0])==null?void 0:Kt.modelId)&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-amber-600",children:["(",F[0].modelId,")"]}),((Ut=F[0])==null?void 0:Ut.usage)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-500",children:["[",F[0].usage.input_tokens.toLocaleString()," in / ",F[0].usage.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:t==="de"?"üì§ Prompt (Eingabe)":t==="fr"?"üì§ Prompt (Entr√©e)":"üì§ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((Jt=F[0])==null?void 0:Jt.prompt)||"No prompt available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:t==="de"?"üì• Rohe API-Antwort (ungefiltert)":t==="fr"?"üì• R√©ponse API brute (non filtr√©e)":"üì• Raw API Response (unfiltered)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((Qt=F[0])==null?void 0:Qt.rawResponse)||x})]})]})]}),b&&e.jsxs("details",{className:"bg-rose-50 border-2 border-rose-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-rose-800 hover:text-rose-900 flex items-center gap-2",children:[e.jsx(bt,{size:20}),t==="de"?"Visual Bible (Wiederkehrende Elemente)":t==="fr"?"Bible Visuelle (√âl√©ments R√©currents)":"Visual Bible (Recurring Elements)",b.changeLog&&b.changeLog.length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-rose-200 text-rose-800 rounded-full text-xs font-medium",children:[b.changeLog.length," ",t==="de"?"√Ñnderungen":t==="fr"?"changements":"changes"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[(()=>{const i=[...b.secondaryCharacters||[],...b.animals||[],...b.artifacts||[],...b.locations||[],...b.vehicles||[]].filter(a=>a.hasReferenceImage&&!Ks[a.id]).length;return i===0?null:e.jsx("button",{onClick:Er,disabled:Xe.size>0,className:"text-xs px-3 py-1.5 bg-rose-500 text-white rounded hover:bg-rose-600 disabled:bg-rose-300",children:Xe.size>0?`Loading ${Xe.size} images...`:`Load All Reference Images (${i})`})})(),b.mainCharacters&&b.mainCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-purple-300 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-purple-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üëó"}),t==="de"?"Hauptcharaktere (Style Profile)":t==="fr"?"Personnages Principaux (Profil Style)":"Main Characters (Style Profile)"]}),e.jsx("div",{className:"space-y-3",children:b.mainCharacters.map(s=>{var i,a,l,r;return e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-sm",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-800 hover:text-purple-900",children:[s.name,Object.keys(s.generatedOutfits||{}).length>0&&e.jsxs("span",{className:"ml-2 px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:[Object.keys(s.generatedOutfits).length," ",t==="de"?"Outfits":t==="fr"?"tenues":"outfits"]})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Physical:"}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[((i=s.physical)==null?void 0:i.skinTone)||"N/A"," | ",((a=s.physical)==null?void 0:a.hair)||"N/A"," | ",((l=s.physical)==null?void 0:l.build)||"N/A",((r=s.physical)==null?void 0:r.other)&&` | ${s.physical.other}`]})]}),s.generatedOutfits&&Object.keys(s.generatedOutfits).length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-200",children:[e.jsx("span",{className:"font-medium text-gray-600 text-xs",children:"Generated Outfits:"}),e.jsx("div",{className:"mt-1 space-y-1",children:Object.entries(s.generatedOutfits).map(([g,N])=>{var z;return e.jsxs("div",{className:"bg-white p-1.5 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-purple-600",children:["Page ",g,":"]}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[(z=N.outfit)==null?void 0:z.substring(0,80),"..."]}),e.jsx("span",{className:`ml-1 px-1 py-0.5 rounded text-[10px] ${N.setting==="outdoor-cold"?"bg-blue-100 text-blue-700":N.setting==="outdoor-warm"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:N.setting})]},g)})})]})]})]},s.id)})})]}),b.secondaryCharacters&&b.secondaryCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Nebencharaktere":t==="fr"?"Personnages Secondaires":"Secondary Characters"}),e.jsx("div",{className:"space-y-2",children:b.secondaryCharacters.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[gs(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(V==null?void 0:V.type)==="secondaryCharacter"&&(V==null?void 0:V.id)===s.id&&(V==null?void 0:V.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:ue,onChange:a=>Ee(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Js,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(as,{size:12})," Save"]}),e.jsxs("button",{onClick:Qs,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Pe,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&ne&&e.jsx("button",{onClick:()=>Us("secondaryCharacter",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(de,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),((Gt=b.animals)==null?void 0:Gt.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Tiere & Wesen":t==="fr"?"Animaux & Cr√©atures":"Animals & Creatures"}),e.jsx("div",{className:"space-y-2",children:b.animals.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[gs(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(V==null?void 0:V.type)==="animal"&&(V==null?void 0:V.id)===s.id&&(V==null?void 0:V.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:ue,onChange:a=>Ee(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Js,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(as,{size:12})," Save"]}),e.jsxs("button",{onClick:Qs,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Pe,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&ne&&e.jsx("button",{onClick:()=>Us("animal",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(de,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),((Zt=b.artifacts)==null?void 0:Zt.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Artefakte & Objekte":t==="fr"?"Artefacts & Objets":"Artifacts & Objects"}),e.jsx("div",{className:"space-y-2",children:b.artifacts.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[gs(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(V==null?void 0:V.type)==="artifact"&&(V==null?void 0:V.id)===s.id&&(V==null?void 0:V.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:ue,onChange:a=>Ee(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Js,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(as,{size:12})," Save"]}),e.jsxs("button",{onClick:Qs,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Pe,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&ne&&e.jsx("button",{onClick:()=>Us("artifact",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(de,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),((Yt=b.locations)==null?void 0:Yt.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Wiederkehrende Orte":t==="fr"?"Lieux R√©currents":"Recurring Locations"}),e.jsx("div",{className:"space-y-2",children:b.locations.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[!s.isRealLandmark&&gs(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.isRealLandmark&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-amber-100 text-amber-700 font-semibold",children:"üìç LANDMARK"}),s.photoFetchStatus==="success"&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-green-100 text-green-700",children:"üì∑ Photo"}),!s.isRealLandmark&&s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),s.isRealLandmark&&s.landmarkQuery&&e.jsxs("div",{className:"text-amber-700 text-xs mt-1",children:["Landmark: ",e.jsx("span",{className:"font-mono bg-amber-50 px-1 rounded",children:s.landmarkQuery})]}),(V==null?void 0:V.type)==="location"&&(V==null?void 0:V.id)===s.id&&(V==null?void 0:V.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:ue,onChange:a=>Ee(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Js,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(as,{size:12})," Save"]}),e.jsxs("button",{onClick:Qs,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Pe,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&ne&&e.jsx("button",{onClick:()=>Us("location",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(de,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]}),s.referencePhotoData&&e.jsxs("div",{className:"mt-2 border border-amber-200 rounded overflow-hidden",children:[e.jsx("img",{src:s.referencePhotoData,alt:`${s.name} reference`,className:"w-full max-h-32 object-contain bg-gray-50"}),s.photoAttribution&&e.jsxs("div",{className:"text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 truncate",children:["üì∑ ",s.photoAttribution]})]})]})]},s.id)})})]}),b.vehicles&&b.vehicles.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Fahrzeuge":t==="fr"?"V√©hicules":"Vehicles"}),e.jsx("div",{className:"space-y-2",children:b.vehicles.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[gs(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:s.description}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),b.clothing&&b.clothing.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Kleidung & Kost√ºme":t==="fr"?"V√™tements & Costumes":"Clothing & Costumes"}),e.jsx("div",{className:"space-y-2",children:b.clothing.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.wornBy&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:["worn by ",s.wornBy]}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:s.description}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id)})})]}),b.changeLog&&b.changeLog.length>0&&e.jsxs("details",{className:"bg-white border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-bold text-amber-700 hover:text-amber-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üìù"}),t==="de"?"√Ñnderungsprotokoll":t==="fr"?"Journal des Modifications":"Change Log",e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-amber-100 text-amber-700 rounded text-xs",children:b.changeLog.length})]}),e.jsx("div",{className:"mt-2 space-y-1 max-h-[500px] overflow-y-auto",children:b.changeLog.slice().reverse().map((s,i)=>{var a;return e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs border-l-2 border-amber-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${s.type==="mainCharacter"?"bg-purple-100 text-purple-700":s.type==="secondaryCharacter"?"bg-rose-100 text-rose-700":s.type==="generatedOutfit"?"bg-green-100 text-green-700":s.type==="animal"?"bg-orange-100 text-orange-700":s.type==="artifact"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:s.type}),e.jsx("span",{className:"font-semibold text-amber-800",children:s.element}),e.jsxs("span",{className:"text-gray-500",children:[q==="de"?"Seite":"Page"," ",s.page]})]}),e.jsxs("div",{className:"mt-1 text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:[s.change,":"]}),e.jsxs("span",{className:"ml-1 text-gray-700",children:[(a=s.after)==null?void 0:a.substring(0,100),s.after&&s.after.length>100?"...":""]})]}),s.before&&e.jsxs("div",{className:"text-gray-400 line-through text-[10px] mt-0.5",children:[t==="de"?"Vorher":t==="fr"?"Avant":"Before",": ",s.before.substring(0,50),"..."]}),e.jsx("div",{className:"text-gray-400 text-[10px] mt-0.5",children:new Date(s.timestamp).toLocaleTimeString()})]},i)})})]}),(!b.mainCharacters||b.mainCharacters.length===0)&&(!b.secondaryCharacters||b.secondaryCharacters.length===0)&&(!b.animals||b.animals.length===0)&&(!b.artifacts||b.artifacts.length===0)&&(!b.locations||b.locations.length===0)&&(!b.vehicles||b.vehicles.length===0)&&(!b.clothing||b.clothing.length===0)&&e.jsx("div",{className:"text-gray-500 text-sm italic",children:t==="de"?"Keine wiederkehrenden Elemente gefunden":t==="fr"?"Aucun √©l√©ment r√©current trouv√©":"No recurring elements found in this story"})]})]}),ce&&Object.keys(ce).length>0&&e.jsxs("details",{className:"bg-teal-50 border-2 border-teal-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-teal-800 hover:text-teal-900 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"üëî"}),t==="de"?`Kleidungsanforderungen (${Object.keys(ce).length} Charaktere)`:t==="fr"?`Exigences vestimentaires (${Object.keys(ce).length} personnages)`:`Clothing Requirements (${Object.keys(ce).length} characters)`]}),e.jsx("div",{className:"mt-4 space-y-3",children:Object.entries(ce).map(([s,i])=>{var a,l,r,g,N,z,I,_,Y,X,xe,me,fe,je,ye;return e.jsxs("div",{className:"bg-white border border-teal-200 rounded-lg p-3",children:[e.jsx("h4",{className:"font-bold text-teal-700 mb-2",children:s}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${(a=i.standard)!=null&&a.used?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(l=i.standard)!=null&&l.used?"‚úÖ":"‚¨ú"," Standard"]}),((r=i.standard)==null?void 0:r.used)&&((g=i.standard)==null?void 0:g.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:i.standard.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(N=i.winter)!=null&&N.used?"bg-blue-50 border border-blue-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(z=i.winter)!=null&&z.used?"‚ùÑÔ∏è":"‚¨ú"," Winter"]}),((I=i.winter)==null?void 0:I.used)&&((_=i.winter)==null?void 0:_.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:i.winter.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(Y=i.summer)!=null&&Y.used?"bg-yellow-50 border border-yellow-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(X=i.summer)!=null&&X.used?"‚òÄÔ∏è":"‚¨ú"," Summer"]}),((xe=i.summer)==null?void 0:xe.used)&&((me=i.summer)==null?void 0:me.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:i.summer.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(fe=i.costumed)!=null&&fe.used?"bg-purple-50 border border-purple-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(je=i.costumed)!=null&&je.used?"üé≠":"‚¨ú"," Costumed"]}),((ye=i.costumed)==null?void 0:ye.used)&&e.jsxs("div",{className:"text-gray-600 mt-1",children:[i.costumed.costume&&e.jsxs("span",{className:"font-medium",children:[i.costumed.costume,": "]}),i.costumed.description]})]})]})]},s)})})]}),re&&re.length>0&&e.jsxs("details",{className:"bg-pink-50 border-2 border-pink-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-pink-800 hover:text-pink-900 flex items-center gap-2",children:[e.jsx(Ne,{size:20}),t==="de"?`Stilisierte Avatare (${re.length})`:t==="fr"?`Avatars stylis√©s (${re.length})`:`Styled Avatars (${re.length})`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[(()=>{const s=re.filter((i,a)=>!Ve[`styled-${a}`]).length;return s===0?null:e.jsx("button",{onClick:Rr,disabled:De.size>0,className:"text-xs px-3 py-1.5 bg-pink-500 text-white rounded hover:bg-pink-600 disabled:bg-pink-300",children:De.size>0?"Loading...":`Load All Images (${s})`})})(),re.map((s,i)=>{var a,l;return e.jsxs("details",{className:`border rounded-lg p-3 ${s.success?"bg-white border-pink-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-800 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.success?"bg-green-500":"bg-red-500"}`}),s.characterName," - ",s.artStyle," (",s.clothingCategory||"standard",")",s.faceMatchScore!=null&&e.jsxs("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold ${s.faceMatchScore>=7?"bg-green-100 text-green-700":s.faceMatchScore>=5?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:["Face: ",s.faceMatchScore,"/10"]}),s.clothingMatchScore!=null&&e.jsxs("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold ${s.clothingMatchScore>=7?"bg-green-100 text-green-700":s.clothingMatchScore>=5?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:["Clothing: ",s.clothingMatchScore,"/10"]}),s.attempt&&s.attempt>1&&e.jsxs("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-bold bg-orange-100 text-orange-700",children:["Attempt ",s.attempt]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(s.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[Se("styled",i,s,"facePhoto","Face Photo",(a=s.inputs.facePhoto)==null?void 0:a.sizeKB),Se("styled",i,s,"originalAvatar","Original Avatar",(l=s.inputs.originalAvatar)==null?void 0:l.sizeKB),s.inputs.styleSample&&Se("styled",i,s,"styleSample","Style Sample",s.inputs.styleSample.sizeKB)]})]}),s.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",s.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-[500px] overflow-y-auto",children:s.prompt})]}),s.success&&s.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2",children:Se("styled",i,s,"output","Styled Avatar Output",s.output.sizeKB)})]}),(s.faceMatchScore!=null||s.clothingMatchScore!=null)&&e.jsxs("div",{className:`p-2 rounded text-xs ${(s.faceMatchScore==null||s.faceMatchScore>=5)&&(s.clothingMatchScore==null||s.clothingMatchScore>=5)?"bg-emerald-50 border border-emerald-200":"bg-amber-50 border border-amber-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Quality Check:"}),s.faceMatchScore!=null&&e.jsxs("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${s.faceMatchScore>=5?"bg-emerald-200 text-emerald-800":"bg-amber-200 text-amber-800"}`,children:["Face: ",s.faceMatchScore>=5?"PASS":"FAIL"," (",s.faceMatchScore,"/10)"]}),s.clothingMatchScore!=null&&e.jsxs("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${s.clothingMatchScore>=5?"bg-emerald-200 text-emerald-800":"bg-amber-200 text-amber-800"}`,children:["Clothing: ",s.clothingMatchScore>=5?"PASS":"FAIL"," (",s.clothingMatchScore,"/10)"]})]}),s.faceMatchDetails&&e.jsx("p",{className:"mt-1 text-gray-700",children:s.faceMatchDetails}),s.clothingMatchReason&&e.jsx("p",{className:"mt-1 text-gray-600",children:s.clothingMatchReason})]}),!s.success&&s.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:s.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(s.timestamp).toLocaleString()]})]})]},i)})]})]}),le&&le.length>0&&e.jsxs("details",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-orange-800 hover:text-orange-900 flex items-center gap-2",children:[e.jsx(Ne,{size:20}),t==="de"?`Kost√ºm-Avatare (${le.length})`:t==="fr"?`Avatars costum√©s (${le.length})`:`Costumed Avatars (${le.length})`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[(()=>{const s=le.filter((i,a)=>!Ve[`costumed-${a}`]).length;return s===0?null:e.jsx("button",{onClick:Lr,disabled:De.size>0,className:"text-xs px-3 py-1.5 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:bg-orange-300",children:De.size>0?"Loading...":`Load All Images (${s})`})})(),le.map((s,i)=>{var a,l,r,g,N,z,I,_,Y,X,xe,me,fe,je,ye,Oe,Fe;return e.jsxs("details",{className:`border rounded-lg p-3 ${s.success?"bg-white border-orange-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 hover:text-orange-800 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.success?"bg-green-500":"bg-red-500"}`}),s.characterName," - ",s.costumeType," (",s.artStyle,")",s.faceMatchScore!=null&&e.jsxs("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold ${s.faceMatchScore>=7?"bg-green-100 text-green-700":s.faceMatchScore>=5?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:["Face: ",s.faceMatchScore,"/10"]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(s.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[s.costumeDescription&&e.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-yellow-700",children:"Costume:"}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.costumeDescription})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[((a=s.inputs)==null?void 0:a.facePhoto)&&Se("costumed",i,s,"facePhoto","Face Photo",(l=s.inputs.facePhoto)==null?void 0:l.sizeKB),((r=s.inputs)==null?void 0:r.standardAvatar)&&Se("costumed",i,s,"standardAvatar","Standard Avatar",(g=s.inputs.standardAvatar)==null?void 0:g.sizeKB),((N=s.inputs)==null?void 0:N.referenceAvatar)&&!((z=s.inputs)!=null&&z.standardAvatar)&&Se("costumed",i,s,"referenceAvatar","Reference Avatar",(I=s.inputs.referenceAvatar)==null?void 0:I.sizeKB),((_=s.inputs)==null?void 0:_.styleSample)&&Se("costumed",i,s,"styleSample","Style Sample",(Y=s.inputs.styleSample)==null?void 0:Y.sizeKB)]})]}),s.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",s.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-[500px] overflow-y-auto",children:s.prompt})]}),s.success&&s.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2",children:Se("costumed",i,s,"output","Costumed Avatar Output",s.output.sizeKB)})]}),s.costumeEvaluation&&e.jsxs("div",{className:`p-2 rounded text-xs ${s.costumeEvaluation.pass?"bg-emerald-50 border border-emerald-200":"bg-amber-50 border border-amber-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-semibold ${s.costumeEvaluation.pass?"text-emerald-700":"text-amber-700"}`,children:"Costume Check:"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${s.costumeEvaluation.pass?"bg-emerald-200 text-emerald-800":"bg-amber-200 text-amber-800"}`,children:s.costumeEvaluation.pass?"PASS":"FAIL"}),e.jsxs("span",{className:"text-gray-500",children:["(",s.costumeEvaluation.confidence," confidence)"]})]}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.costumeEvaluation.reason}),s.costumeEvaluation.details&&e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-[10px]",children:[e.jsxs("div",{className:`p-1 rounded ${((X=s.costumeEvaluation.details.bottomLeft)==null?void 0:X.costumeMatch)==="full"?"bg-emerald-100":((xe=s.costumeEvaluation.details.bottomLeft)==null?void 0:xe.costumeMatch)==="none"?"bg-red-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-semibold",children:"Bottom-Left:"})," ",((me=s.costumeEvaluation.details.bottomLeft)==null?void 0:me.costumeMatch)||"N/A",((fe=s.costumeEvaluation.details.bottomLeft)==null?void 0:fe.description)&&e.jsx("div",{className:"text-gray-600 truncate",children:s.costumeEvaluation.details.bottomLeft.description})]}),e.jsxs("div",{className:`p-1 rounded ${((je=s.costumeEvaluation.details.bottomRight)==null?void 0:je.costumeMatch)==="full"?"bg-emerald-100":((ye=s.costumeEvaluation.details.bottomRight)==null?void 0:ye.costumeMatch)==="none"?"bg-red-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-semibold",children:"Bottom-Right:"})," ",((Oe=s.costumeEvaluation.details.bottomRight)==null?void 0:Oe.costumeMatch)||"N/A",((Fe=s.costumeEvaluation.details.bottomRight)==null?void 0:Fe.description)&&e.jsx("div",{className:"text-gray-600 truncate",children:s.costumeEvaluation.details.bottomRight.description})]})]})]}),!s.success&&s.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:s.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(s.timestamp).toLocaleString()]})]})]},i)})]})]}),te&&te.length>0&&e.jsxs("details",{className:"bg-slate-50 border-2 border-slate-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-slate-800 hover:text-slate-900 flex items-center gap-2",children:[e.jsx(ns,{size:20}),t==="de"?`Generierungslog (${te.length})`:t==="fr"?`Journal de g√©n√©ration (${te.length})`:`Generation Log (${te.length})`,te.filter(s=>s.level==="warn").length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-yellow-200 text-yellow-800 text-xs rounded-full",children:[te.filter(s=>s.level==="warn").length," warnings"]}),te.filter(s=>s.level==="error").length>0&&e.jsxs("span",{className:"ml-1 px-2 py-0.5 bg-red-200 text-red-800 text-xs rounded-full",children:[te.filter(s=>s.level==="error").length," errors"]})]}),e.jsx("div",{className:"mt-4 space-y-1 max-h-96 overflow-y-auto",children:te.map((s,i)=>e.jsxs("div",{className:`text-xs p-2 rounded flex items-start gap-2 ${s.level==="error"?"bg-red-50 text-red-800":s.level==="warn"?"bg-yellow-50 text-yellow-800":s.level==="debug"?"bg-gray-50 text-gray-600":"bg-white text-slate-700"}`,children:[e.jsx("span",{className:"text-gray-400 font-mono text-[10px] whitespace-nowrap",children:new Date(s.timestamp).toLocaleTimeString()}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium whitespace-nowrap ${s.stage==="outline"?"bg-blue-100 text-blue-700":s.stage==="avatars"?"bg-purple-100 text-purple-700":s.stage==="scenes"?"bg-green-100 text-green-700":s.stage==="images"?"bg-orange-100 text-orange-700":s.stage==="covers"?"bg-pink-100 text-pink-700":"bg-gray-100 text-gray-700"}`,children:s.stage}),s.character&&e.jsxs("span",{className:"font-medium text-slate-600",children:["[",s.character,"]"]}),e.jsx("span",{className:"flex-1",children:s.message}),e.jsx("span",{className:"text-gray-400 text-[10px]",children:s.event})]},i))})]}),((Xt=o==null?void 0:o.entity)==null?void 0:Xt.grids)&&o.entity.grids.length>0&&e.jsxs("details",{className:`border-2 rounded-xl p-4 ${o.entity.overallConsistent!==!1?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("summary",{className:`cursor-pointer text-lg font-bold flex items-center gap-2 ${o.entity.overallConsistent!==!1?"text-green-800 hover:text-green-900":"text-amber-800 hover:text-amber-900"}`,children:[o.entity.overallConsistent!==!1?"‚úì":"‚ö†Ô∏è",t==="de"?`Charakterkonsistenz (${o.entity.totalIssues||0} Probleme)`:t==="fr"?`Coh√©rence des personnages (${o.entity.totalIssues||0} probl√®mes)`:`Character Consistency (${o.entity.totalIssues||0} issues)`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700",children:o.entity.summary}),(()=>{var a;const i=(((a=o.entity)==null?void 0:a.grids)||[]).filter((l,r)=>!l.gridImage&&hs[r]===void 0).length;return i===0?null:e.jsx("button",{onClick:Tr,disabled:us.size>0,className:"text-xs px-3 py-1.5 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-blue-300",children:us.size>0?`Loading ${us.size} grids...`:`Load All Grids (${i})`})})(),e.jsx("div",{className:"space-y-2",children:o.entity.grids.map((s,i)=>{var z,I,_,Y,X,xe,me,fe,je,ye,Oe,Fe,bs,fs,js,ys,Ns,vs,ws,Ss,Cs,$s,ks,k,he,ir,nr,lr,or,dr,cr,xr,mr,pr,gr,hr,ur,br,fr,jr,yr,Nr;const a=(I=(z=o.entity)==null?void 0:z.characters)==null?void 0:I[s.entityName],l=(a==null?void 0:a.overallConsistent)??(a==null?void 0:a.consistent)??!0,r=(a==null?void 0:a.overallScore)??(a==null?void 0:a.score)??0,g=(a==null?void 0:a.issues)??[],N=s.clothingCategory;return e.jsxs("details",{className:`bg-white border rounded-lg overflow-hidden ${l?"border-green-200":"border-amber-200"}`,children:[e.jsxs("summary",{className:"cursor-pointer p-3 flex items-center gap-2 hover:bg-gray-50",children:[e.jsx("span",{className:`text-sm ${l?"text-green-600":"text-amber-600"}`,children:l?"‚úì":"‚ö†Ô∏è"}),e.jsxs("span",{className:"font-medium text-sm text-gray-800",children:[s.entityName,N&&e.jsx("span",{className:`ml-1.5 text-xs font-normal px-1.5 py-0.5 rounded ${N.startsWith("costumed:")?"bg-purple-100 text-purple-700":N==="winter"?"bg-blue-100 text-blue-700":N==="summer"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:N})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.cellCount," appearance",s.cellCount!==1?"s":"",")"]}),e.jsxs("span",{className:`ml-auto text-xs px-2 py-0.5 rounded ${r>=8?"bg-green-100 text-green-700":r>=5?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:["Score: ",r,"/10"]})]}),e.jsxs("div",{className:"p-3 border-t border-gray-100 space-y-3",children:[(()=>{const j=s.gridImage||hs[i],M=us.has(i),L=s.gridImageSizeKB;return j?e.jsx("div",{className:"flex justify-center bg-gray-50 rounded p-2",children:e.jsx("img",{src:j,alt:`${s.entityName} consistency grid`,className:"max-w-full h-auto rounded shadow-sm cursor-pointer hover:opacity-90 transition-opacity",style:{maxHeight:"400px"},onClick:()=>ee({src:j,title:`${s.entityName}${N?` (${N})`:""} - Entity Consistency Grid`}),title:"Click to enlarge"})}):M?e.jsx("div",{className:"flex justify-center items-center bg-gray-100 rounded p-4 h-32",children:e.jsx("span",{className:"text-sm text-gray-500",children:"Loading grid image..."})}):e.jsxs("div",{className:"flex flex-col items-center bg-gray-100 rounded p-4",children:[e.jsxs("span",{className:"text-xs text-gray-500 mb-2",children:["Grid image not loaded ",L?`(${L} KB)`:""]}),e.jsx("button",{onClick:()=>Tt(i),className:"text-xs px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Load Grid"})]})})(),((_=s.manifest)==null?void 0:_.cells)&&e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Cells: "}),s.manifest.cells.map((j,M)=>{const L=s.gridImage||hs[i];return e.jsxs("span",{className:"inline-flex items-center bg-gray-100 rounded px-1.5 py-0.5 mr-1 mb-1 gap-1",children:[e.jsxs("button",{onClick:()=>L&&Vr({...s,gridImage:L},M),className:`${L?"hover:text-blue-600 hover:underline cursor-pointer":"text-gray-400 cursor-not-allowed"}`,title:L?"Click to enlarge this cell":"Load grid image first",disabled:!L,children:[j.letter,": ",j.isReference?"Ref":`P${j.pageNumber}`,j.clothing&&j.clothing!=="standard"&&` (${j.clothing})`]}),!j.isReference&&B&&typeof j.pageNumber=="number"&&e.jsx("button",{onClick:$e=>{$e.stopPropagation(),Kr(s.entityName,j.pageNumber)},disabled:c||ie!==null||Ge!==null,className:`ml-0.5 px-1 py-0 text-[9px] rounded transition-colors ${(ie==null?void 0:ie.entity)===s.entityName&&(ie==null?void 0:ie.page)===j.pageNumber?"bg-amber-300 text-amber-800":c||ie!==null||Ge!==null?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"}`,title:`Repair page ${j.pageNumber} for ${s.entityName}`,children:(ie==null?void 0:ie.entity)===s.entityName&&(ie==null?void 0:ie.page)===j.pageNumber?"...":"‚ö°"})]},M)})]}),g.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700",children:"Issues:"}),g.map((j,M)=>{var L;return e.jsxs("div",{className:`text-xs p-2 rounded ${j.severity==="critical"?"bg-red-50 border-l-4 border-red-400":j.severity==="major"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${j.severity==="critical"?"bg-red-200 text-red-800":j.severity==="major"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:j.severity}),j.cells&&e.jsxs("span",{className:"text-gray-500",children:["Cells: ",j.cells.map(($e,Re)=>{var Ps;const st=(((Ps=s.manifest)==null?void 0:Ps.cells)||[]).some(vr=>vr.letter===$e&&!vr.isReference);return e.jsxs("span",{className:st?"font-semibold text-gray-800":"text-gray-400",children:[Re>0?", ":"",$e]},Re)})]}),j.pagesToFix&&j.pagesToFix.length>0&&(()=>{var Re;const $e=new Set((((Re=s.manifest)==null?void 0:Re.cells)||[]).filter(se=>!se.isReference&&se.pageNumber!=null).map(se=>se.pageNumber));return e.jsxs("span",{className:"text-[10px]",children:["Fix: Page"," ",j.pagesToFix.map((se,st)=>{const Ps=$e.has(se);return e.jsxs("span",{className:`px-1 py-0.5 rounded ${Ps?"bg-orange-200 text-orange-800 font-semibold":"bg-gray-200 text-gray-500"}`,title:Ps?"Visible in grid above":"Not in this grid",children:[st>0?" ":"",se]},st)})]})})(),j.clothingCategory&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded text-[10px]",children:j.clothingCategory}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:j.subType||((L=j.type)==null?void 0:L.replace(/_/g," "))})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:j.description}),j.fixInstruction&&e.jsxs("p",{className:"text-green-700 mt-1 text-[10px]",children:["‚Üí ",j.fixInstruction]})]},M)})]}),B&&(!l||r<8)&&s.entityType==="character"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>Wr(s.entityName),disabled:c||Ge!==null,className:`flex items-center gap-2 px-3 py-1.5 text-xs font-medium rounded transition-colors ${c||Ge!==null?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"}`,children:Ge===s.entityName?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{children:"Repairing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{className:"w-3 h-3"}),e.jsx("span",{children:"Repair All"})]})}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Regenerate all appearances to match reference"})]}),((Y=o.entityRepairs)==null?void 0:Y[s.entityName])&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-green-700",children:"‚úì Repaired"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(xe=(X=o.entityRepairs)==null?void 0:X[s.entityName])!=null&&xe.cellsRepaired?`${(me=o.entityRepairs[s.entityName])==null?void 0:me.cellsRepaired} pages updated`:(je=(fe=o.entityRepairs)==null?void 0:fe[s.entityName])!=null&&je.pages?`${Object.keys(((ye=o.entityRepairs[s.entityName])==null?void 0:ye.pages)||{}).length} page(s) repaired individually`:"",(((Fe=(Oe=o.entityRepairs)==null?void 0:Oe[s.entityName])==null?void 0:Fe.clothingGroupCount)??0)>1&&` (${(fs=(bs=o.entityRepairs)==null?void 0:bs[s.entityName])==null?void 0:fs.clothingGroupCount} clothing groups)`]})]}),(Ns=(ys=(js=o.entityRepairs)==null?void 0:js[s.entityName])==null?void 0:ys.gridsByClothing)!=null&&Ns.length?e.jsx("div",{className:"space-y-3",children:(Ss=(ws=(vs=o.entityRepairs)==null?void 0:vs[s.entityName])==null?void 0:ws.gridsByClothing)==null?void 0:Ss.map(j=>{var M;return e.jsxs("div",{className:"border border-gray-200 rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700",children:j.clothingCategory}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:["(",j.cropCount," crops, ref: ",j.referenceUsed,")"]})]}),(M=j.cellComparisons)!=null&&M.length?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[9px] font-medium text-gray-500 px-1",children:[e.jsx("span",{children:"Cell"}),e.jsx("span",{children:"Before"}),e.jsx("span",{children:"After"}),e.jsx("span",{children:"Diff"})]}),j.cellComparisons.map(L=>e.jsxs("div",{className:"grid grid-cols-4 gap-1 items-center bg-gray-50 rounded p-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700",children:L.letter}),e.jsxs("div",{className:"text-[9px] text-gray-400",children:["P",L.pageNumber]})]}),e.jsx("img",{src:L.before,alt:`${L.letter} before`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>L.before&&ee({src:L.before,title:`${s.entityName} - Cell ${L.letter} Page ${L.pageNumber} Before (${j.clothingCategory})`})}),e.jsx("img",{src:L.after,alt:`${L.letter} after`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>L.after&&ee({src:L.after,title:`${s.entityName} - Cell ${L.letter} Page ${L.pageNumber} After (${j.clothingCategory})`})}),e.jsx("div",{className:"bg-gray-900 rounded",children:e.jsx("img",{src:L.diff,alt:`${L.letter} diff`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>L.diff&&ee({src:L.diff,title:`${s.entityName} - Cell ${L.letter} Page ${L.pageNumber} Diff (${j.clothingCategory})`})})})]},`${j.clothingCategory}-${L.letter}`))]}):e.jsxs("div",{className:`grid gap-2 ${j.gridDiff?"grid-cols-3":"grid-cols-2"}`,children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] font-medium text-gray-500",children:"Before"}),e.jsx("div",{className:"bg-gray-50 rounded p-0.5",children:e.jsx("img",{src:j.gridBefore,alt:"Before repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>j.gridBefore&&ee({src:j.gridBefore,title:`${s.entityName} - ${j.clothingCategory} Grid Before`})})})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] font-medium text-gray-500",children:"After"}),e.jsx("div",{className:"bg-gray-50 rounded p-0.5",children:e.jsx("img",{src:j.gridAfter,alt:"After repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>j.gridAfter&&ee({src:j.gridAfter,title:`${s.entityName} - ${j.clothingCategory} Grid After`})})})]}),j.gridDiff&&e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] font-medium text-gray-500",children:"Diff"}),e.jsx("div",{className:"bg-gray-900 rounded p-0.5",children:e.jsx("img",{src:j.gridDiff,alt:"Difference",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>ee({src:j.gridDiff,title:`${s.entityName} - ${j.clothingCategory} Grid Diff`})})})]})]})]},j.clothingCategory)})}):(ks=($s=(Cs=o.entityRepairs)==null?void 0:Cs[s.entityName])==null?void 0:$s.cellComparisons)!=null&&ks.length?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[10px] font-medium text-gray-500 px-1",children:[e.jsx("span",{children:"Cell"}),e.jsx("span",{children:"Before"}),e.jsx("span",{children:"After"}),e.jsx("span",{children:"Diff"})]}),(ir=(he=(k=o.entityRepairs)==null?void 0:k[s.entityName])==null?void 0:he.cellComparisons)==null?void 0:ir.map(j=>e.jsxs("div",{className:"grid grid-cols-4 gap-1 items-center bg-gray-50 rounded p-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700",children:j.letter}),e.jsxs("div",{className:"text-[9px] text-gray-400",children:["P",j.pageNumber]})]}),e.jsx("img",{src:j.before,alt:`${j.letter} before`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>j.before&&ee({src:j.before,title:`${s.entityName} - Cell ${j.letter} Page ${j.pageNumber} Before`})}),e.jsx("img",{src:j.after,alt:`${j.letter} after`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>j.after&&ee({src:j.after,title:`${s.entityName} - Cell ${j.letter} Page ${j.pageNumber} After`})}),e.jsx("div",{className:"bg-gray-900 rounded",children:e.jsx("img",{src:j.diff,alt:`${j.letter} diff`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>j.diff&&ee({src:j.diff,title:`${s.entityName} - Cell ${j.letter} Page ${j.pageNumber} Diff`})})})]},j.letter))]}):(lr=(nr=o.entityRepairs)==null?void 0:nr[s.entityName])!=null&&lr.pages&&Object.keys(((or=o.entityRepairs[s.entityName])==null?void 0:or.pages)||{}).length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[10px] font-medium text-gray-500 px-1",children:[e.jsx("span",{children:"Page"}),e.jsx("span",{children:"Before"}),e.jsx("span",{children:"After"}),e.jsx("span",{children:"Diff"})]}),Object.entries(((dr=o.entityRepairs[s.entityName])==null?void 0:dr.pages)||{}).map(([j,M])=>{var L,$e,Re;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 items-center bg-gray-50 rounded p-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-700",children:["P",j]}),M.clothingCategory&&M.clothingCategory!=="standard"&&e.jsx("div",{className:"text-[8px] text-gray-400",children:M.clothingCategory})]}),e.jsx("img",{src:(L=M.comparison)==null?void 0:L.before,alt:`P${j} before`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var se;return((se=M.comparison)==null?void 0:se.before)&&ee({src:M.comparison.before,title:`${s.entityName} - Page ${j} Before${M.clothingCategory?` (${M.clothingCategory})`:""}`})}}),e.jsx("img",{src:($e=M.comparison)==null?void 0:$e.after,alt:`P${j} after`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var se;return((se=M.comparison)==null?void 0:se.after)&&ee({src:M.comparison.after,title:`${s.entityName} - Page ${j} After${M.clothingCategory?` (${M.clothingCategory})`:""}`})}}),e.jsx("div",{className:"bg-gray-900 rounded",children:e.jsx("img",{src:(Re=M.comparison)==null?void 0:Re.diff,alt:`P${j} diff`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var se;return((se=M.comparison)==null?void 0:se.diff)&&ee({src:M.comparison.diff,title:`${s.entityName} - Page ${j} Diff${M.clothingCategory?` (${M.clothingCategory})`:""}`})}})})]}),M.promptUsed&&e.jsxs("details",{className:"text-[10px]",children:[e.jsx("summary",{className:"cursor-pointer text-blue-600 hover:text-blue-800",children:"Show Prompt"}),e.jsx("pre",{className:"mt-1 p-2 bg-gray-100 rounded text-gray-700 whitespace-pre-wrap overflow-x-auto max-h-48 text-[9px]",children:M.promptUsed})]})]},j)})]}):(xr=(cr=o.entityRepairs)==null?void 0:cr[s.entityName])!=null&&xr.gridBeforeRepair?e.jsxs("div",{className:`grid gap-3 ${(pr=(mr=o.entityRepairs)==null?void 0:mr[s.entityName])!=null&&pr.gridDiff?"grid-cols-3":"grid-cols-2"}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"Before Repair"}),e.jsx("div",{className:"bg-gray-50 rounded p-1",children:e.jsx("img",{src:(hr=(gr=o.entityRepairs)==null?void 0:gr[s.entityName])==null?void 0:hr.gridBeforeRepair,alt:"Before repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var M,L;const j=(L=(M=o.entityRepairs)==null?void 0:M[s.entityName])==null?void 0:L.gridBeforeRepair;j&&ee({src:j,title:`${s.entityName} - Grid Before Repair`})}})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"After Repair"}),e.jsx("div",{className:"bg-gray-50 rounded p-1",children:e.jsx("img",{src:(br=(ur=o.entityRepairs)==null?void 0:ur[s.entityName])==null?void 0:br.gridAfterRepair,alt:"After repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var M,L;const j=(L=(M=o.entityRepairs)==null?void 0:M[s.entityName])==null?void 0:L.gridAfterRepair;j&&ee({src:j,title:`${s.entityName} - Grid After Repair`})}})})]}),((jr=(fr=o.entityRepairs)==null?void 0:fr[s.entityName])==null?void 0:jr.gridDiff)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"Difference"}),e.jsx("div",{className:"bg-gray-900 rounded p-1",children:e.jsx("img",{src:((Nr=(yr=o.entityRepairs)==null?void 0:yr[s.entityName])==null?void 0:Nr.gridDiff)??void 0,alt:"Difference",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var M,L;const j=(L=(M=o.entityRepairs)==null?void 0:M[s.entityName])==null?void 0:L.gridDiff;j&&ee({src:j,title:`${s.entityName} - Grid Diff`})}})})]})]}):null]})]})]},i)})})]})]}),o&&e.jsxs("details",{className:`border-2 rounded-xl p-4 ${o.overallConsistent?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("summary",{className:`cursor-pointer text-lg font-bold flex items-center gap-2 ${o.overallConsistent?"text-green-800 hover:text-green-900":"text-amber-800 hover:text-amber-900"}`,children:[o.overallConsistent?"‚úì":"‚ö†Ô∏è",t==="de"?`Konsistenzpr√ºfung (${Math.max(0,(o.totalIssues||0)-(((er=o.entity)==null?void 0:er.totalIssues)||0))} Probleme)`:t==="fr"?`V√©rification de coh√©rence (${Math.max(0,(o.totalIssues||0)-(((sr=o.entity)==null?void 0:sr.totalIssues)||0))} probl√®mes)`:`Final Checks (${Math.max(0,(o.totalIssues||0)-(((tr=o.entity)==null?void 0:tr.totalIssues)||0))} issues)`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700",children:o.summary}),o.imageChecks&&o.imageChecks.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:t==="de"?"Bildkonsistenz":t==="fr"?"Coh√©rence des images":"Image Consistency"}),o.imageChecks.map((s,i)=>{var a,l;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${s.consistent?"text-green-600":"text-amber-600"}`,children:s.consistent?"‚úì":"‚ö†Ô∏è"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:s.type==="full"?"Full Check":s.type==="character"?`Character: ${s.characterName}`:s.type==="sequence"?"Sequence Check":s.type}),s.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",s.overallScore,"/10"]})]}),s.issues&&s.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:s.issues.map((r,g)=>{var N,z;return e.jsxs("div",{className:`text-xs p-2 rounded ${r.severity==="high"?"bg-red-50 border-l-4 border-red-400":r.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${r.severity==="high"?"bg-red-200 text-red-800":r.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:r.severity}),e.jsxs("span",{className:"text-gray-500",children:["Pages ",(N=r.images)==null?void 0:N.join(", ")]}),r.pagesToFix&&r.pagesToFix.length>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-orange-100 text-orange-700 rounded text-[10px]",children:["Fix: ",r.pagesToFix.join(", ")]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:(z=r.type)==null?void 0:z.replace(/_/g," ")}),r.characterInvolved&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded text-[10px]",children:r.characterInvolved})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:r.description}),r.details&&Object.keys(r.details).length>0&&e.jsx("div",{className:"mt-1 pl-2 border-l-2 border-gray-200",children:Object.entries(r.details).map(([I,_])=>e.jsxs("p",{className:"text-gray-500 text-[10px]",children:[e.jsxs("span",{className:"font-medium",children:[I,":"]})," ",_]},I))}),r.canonicalVersion&&e.jsxs("p",{className:"text-blue-700 mt-1",children:["üéØ Target: ",r.canonicalVersion]}),r.recommendation&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:["üí° ",r.recommendation]}),B&&r.pagesToFix&&r.pagesToFix.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:r.pagesToFix.map(I=>e.jsx("button",{onClick:()=>Ur(I,r),disabled:c||ms!==null,className:`flex items-center gap-1 px-2 py-1 text-[10px] font-medium rounded transition-colors ${ms===I?"bg-amber-300 text-amber-800":c||ms!==null?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"}`,children:ms===I?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-3 h-3 animate-spin"}),e.jsxs("span",{children:["Repairing P",I,"..."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{className:"w-3 h-3"}),e.jsxs("span",{children:["Repair P",I]})]})},I))})]},g)})}),s.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:s.summary}),(s.evaluationPrompts||s.evaluationPrompt)&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:["üîç View Evaluation Prompt",(((a=s.evaluationPrompts)==null?void 0:a.length)??0)>1?`s (${(l=s.evaluationPrompts)==null?void 0:l.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:(s.evaluationPrompts??(s.evaluationPrompt?[s.evaluationPrompt]:[])).map((r,g)=>{var N;return e.jsxs("div",{children:[(((N=s.evaluationPrompts)==null?void 0:N.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-blue-700 mb-1",children:["Batch ",g+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto bg-white p-2 rounded border",children:r})]},g)})})]}),e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"üîß View Parsed Result (Full JSON)"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-96 overflow-y-auto bg-white p-2 rounded border",children:JSON.stringify({type:s.type,characterName:s.characterName,consistent:s.consistent,overallScore:s.overallScore,issues:s.issues,summary:s.summary},null,2)})]}),s.rawResponses&&s.rawResponses.length>0&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:["üìù View Raw Response",s.rawResponses.length>1?`s (${s.rawResponses.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:s.rawResponses.map((r,g)=>{var N;return e.jsxs("div",{children:[(((N=s.rawResponses)==null?void 0:N.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-purple-700 mb-1",children:["Batch ",g+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto bg-white p-2 rounded border",children:r})]},g)})})]})]},i)})]}),o.textCheck&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:t==="de"?"Textqualit√§t":t==="fr"?"Qualit√© du texte":"Text Quality"}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${o.textCheck.quality==="good"?"text-green-600":o.textCheck.quality==="needs_review"?"text-amber-600":"text-red-600"}`,children:o.textCheck.quality==="good"?"‚úì":"‚ö†Ô∏è"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:o.textCheck.quality==="good"?"Good":o.textCheck.quality==="needs_review"?"Needs Review":"Has Issues"}),o.textCheck.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",o.textCheck.overallScore,"/10"]})]}),o.textCheck.issues&&o.textCheck.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:o.textCheck.issues.map((s,i)=>e.jsxs("div",{className:`text-xs p-2 rounded ${s.severity==="high"?"bg-red-50 border-l-4 border-red-400":s.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${s.severity==="high"?"bg-red-200 text-red-800":s.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:s.severity}),s.page&&e.jsxs("span",{className:"text-gray-500",children:["Page ",s.page]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:s.type})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:s.issue}),(s.originalText||s.text)&&e.jsxs("p",{className:"text-red-600 mt-1 line-through",children:['"',s.originalText||s.text,'"']}),s.correctedText&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:['‚úì "',s.correctedText,'"']}),!s.correctedText&&s.suggestion&&e.jsxs("p",{className:"text-green-700 mt-1",children:["‚Üí ",s.suggestion]})]},i))}),o.textCheck.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:o.textCheck.summary}),o.textCheck.fullOriginalText&&e.jsxs("details",{className:"mt-3 bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-gray-700",children:"üìÑ View Original Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-600 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:o.textCheck.fullOriginalText})]}),o.textCheck.fullCorrectedText&&e.jsxs("details",{className:"mt-3 bg-green-50 border border-green-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-green-800",children:"üìã View Full Corrected Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:o.textCheck.fullCorrectedText})]}),o.textCheck.rawResponse&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:"üìù View Raw Response"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:o.textCheck.rawResponse})]}),o.textCheck&&e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"üîß View Parsed Result"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:JSON.stringify({quality:o.textCheck.quality,overallScore:o.textCheck.overallScore,issues:o.textCheck.issues,summary:o.textCheck.summary,parseError:o.textCheck.parseError},null,2)})]}),o.textCheck.evaluationPrompt&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:"üîç View Evaluation Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:o.textCheck.evaluationPrompt})]})]})]}),o.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-2 text-xs text-red-700",children:["Error: ",o.error]})]})]}),w.length>0&&e.jsxs("details",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-green-800 hover:text-green-900 flex items-center gap-2",children:[e.jsx(ns,{size:20}),t==="de"?`Alle Szenenbeschreibungen (${w.length})`:t==="fr"?`Toutes les descriptions de sc√®nes (${w.length})`:`All Scene Descriptions (${w.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:w.map(s=>e.jsxs("details",{className:"bg-white border border-green-200 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-700 hover:text-green-800",children:q==="de"?`Seite ${s.pageNumber}`:q==="fr"?`Page ${s.pageNumber}`:`Page ${s.pageNumber}`}),e.jsxs("div",{className:"mt-2 space-y-2",children:[s.outlineExtract&&e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-amber-700",children:"Outline Extract:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:s.outlineExtract})]}),s.scenePrompt&&e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-purple-700",children:"Scene Prompt:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:s.scenePrompt})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Scene Description:"}),s.textModelId&&e.jsxs("span",{className:"ml-2 text-green-600",children:["(",s.textModelId,")"]}),e.jsx("pre",{className:"text-gray-700 mt-1 whitespace-pre-wrap font-mono text-xs overflow-x-auto",children:(()=>{var r;const i=g=>{if(typeof g!="string")return g;try{const N=JSON.parse(g);return typeof N=="string"&&(N.startsWith("{")||N.startsWith("["))?i(N):N}catch{return g}},a=typeof s.description=="object"&&((r=s.description)!=null&&r.text)?s.description.text:s.description,l=i(a);return typeof l=="object"&&l!==null?JSON.stringify(l,null,2):String(l)})()})]})]})]},s.pageNumber))})]})]}),f&&(rs(f.frontCover)||((rr=f.frontCover)==null?void 0:rr.hasImage))&&(()=>{var l,r,g;const s=f.frontCover,i=rs(f.frontCover),a=!i&&(s==null?void 0:s.hasImage);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:q==="de"?"Titelseite":q==="fr"?"Couverture":"Front Cover"}),e.jsxs("div",{className:"relative",children:[a?e.jsxs("div",{className:"aspect-[3/4] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-lg flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-600 font-medium",children:q==="de"?"Cover wird geladen...":q==="fr"?"Chargement de la couverture...":"Loading cover..."})]}):e.jsx(tt,{src:i,alt:"Front Cover",className:"w-full rounded-lg shadow-lg",label:"Front Cover"}),D.has("frontCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(pe,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),W&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>ht("front"),disabled:c||!ae||D.has("frontCover"),className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||!ae||D.has("frontCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:ae?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(ke,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Ae," ",t==="de"?"Credits":"credits",")"]})]}),Ce("frontCover").length>1&&e.jsxs("button",{onClick:()=>cs({coverType:"frontCover",versions:Ce("frontCover")}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(Ne,{size:14}),Ce("frontCover").length]})]}),Z&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[E&&e.jsxs("button",{onClick:()=>E("front"),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(de,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:(()=>{const N=Y=>{if(typeof Y!="string")return Y;try{const X=JSON.parse(Y);return typeof X=="string"&&(X.startsWith("{")||X.startsWith("["))?N(X):X}catch{return Y}},z=s.description,I=typeof z=="object"&&(z!=null&&z.text)?z.text:z,_=N(I);return typeof _=="object"&&_!==null?JSON.stringify(_,null,2):String(_)})()})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:s.prompt})]}),((((l=s.referencePhotos)==null?void 0:l.length)??0)>0||(((r=s.landmarkPhotos)==null?void 0:r.length)??0)>0||s.visualBibleGrid)&&e.jsx(As,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,visualBibleGrid:s.visualBibleGrid,language:t}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),e.jsx(Is,{retryHistory:s.retryHistory,bboxDetection:s.bboxDetection,bboxOverlayImage:s.bboxOverlayImage,language:t,storyId:B,coverType:"front"}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(ls,{retryHistory:s.retryHistory,totalAttempts:Math.max(s.totalAttempts||0,s.retryHistory.filter(N=>N.type!=="bbox_detection_only").length||0,((g=s.imageVersions)==null?void 0:g.length)||0),language:t}),s.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[t==="de"?"Vorherige Version":t==="fr"?"Version pr√©c√©dente":"Previous Version",s.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(s.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),s.originalImage&&s.originalImage!==s.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[t==="de"?"Originalbild":t==="fr"?"Image originale":"Original Image",s.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(s.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),f&&rs(f.initialPage)&&(()=>{var i,a,l;const s=f.initialPage;return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:q==="de"?"Widmungsseite":q==="fr"?"Page de d√©dicace":"Dedication Page"}),e.jsxs("div",{className:"relative",children:[e.jsx(tt,{src:rs(f.initialPage),alt:"Dedication Page",className:"w-full rounded-lg shadow-lg",label:"Dedication Page"}),D.has("initialPage")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(pe,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),W&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>ht("initial"),disabled:c||!ae||D.has("initialPage"),className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||!ae||D.has("initialPage")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:ae?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(ke,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Ae," ",t==="de"?"Credits":"credits",")"]})]}),Ce("initialPage").length>1&&e.jsxs("button",{onClick:()=>cs({coverType:"initialPage",versions:Ce("initialPage")}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(Ne,{size:14}),Ce("initialPage").length]})]}),Z&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[E&&e.jsxs("button",{onClick:()=>E("initial"),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(de,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:(()=>{const r=I=>{if(typeof I!="string")return I;try{const _=JSON.parse(I);return typeof _=="string"&&(_.startsWith("{")||_.startsWith("["))?r(_):_}catch{return I}},g=s.description,N=typeof g=="object"&&(g!=null&&g.text)?g.text:g,z=r(N);return typeof z=="object"&&z!==null?JSON.stringify(z,null,2):String(z)})()})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:s.prompt})]}),((((i=s.referencePhotos)==null?void 0:i.length)??0)>0||(((a=s.landmarkPhotos)==null?void 0:a.length)??0)>0||s.visualBibleGrid)&&e.jsx(As,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,visualBibleGrid:s.visualBibleGrid,language:t}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),e.jsx(Is,{retryHistory:s.retryHistory,bboxDetection:s.bboxDetection,bboxOverlayImage:s.bboxOverlayImage,language:t,storyId:B,coverType:"initial"}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(ls,{retryHistory:s.retryHistory,totalAttempts:Math.max(s.totalAttempts||0,s.retryHistory.filter(r=>r.type!=="bbox_detection_only").length,((l=s.imageVersions)==null?void 0:l.length)||0),language:t}),s.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[t==="de"?"Vorherige Version":t==="fr"?"Version pr√©c√©dente":"Previous Version",s.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(s.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),s.originalImage&&s.originalImage!==s.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[t==="de"?"Originalbild":t==="fr"?"Image originale":"Original Image",s.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(s.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),ve&&!x&&(f==null?void 0:f.frontCover)&&e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-8 mt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-indigo-700",children:q==="de"?"Geschichte wird erstellt...":q==="fr"?"Cr√©ation de l'histoire...":"Creating your story..."}),e.jsx("p",{className:"text-indigo-500 mt-2",children:q==="de"?"Die Seiten werden gleich angezeigt":q==="fr"?"Les pages seront bient√¥t affich√©es":"Pages will appear shortly"})]})}),ts&&x&&e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 text-center mb-6",children:d||(q==="de"?"Ihre Geschichte":q==="fr"?"Votre histoire":"Your Story")}),ss.slice(0,ve?Wt:ss.length).map((s,i)=>{var _,Y,X,xe,me,fe,je,ye,Oe,Fe,bs,fs,js,ys,Ns,vs,ws,Ss,Cs,$s,ks;const a=i+1,l=a,r=v.find(k=>k.pageNumber===l),g=ve?vt[l]:void 0,N=!!(r!=null&&r.imageData||g),z=ve&&a===Wt&&!N,I=!ve&&(r==null?void 0:r.hasImage)&&!(r!=null&&r.imageData);return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-4 text-center",children:q==="de"?`Seite ${a}`:q==="fr"?`Page ${a}`:`Page ${a}`}),Gs?e.jsxs("div",{className:"flex flex-col items-center max-w-2xl mx-auto",children:[z||I?e.jsxs("div",{className:"w-full mb-4 aspect-[4/3] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-md flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-600 font-medium",children:I?q==="de"?"Bild wird geladen...":q==="fr"?"Chargement de l'image...":"Loading image...":q==="de"?"Bild wird erstellt...":q==="fr"?"Cr√©ation de l'image...":"Creating image..."}),z&&e.jsx("p",{className:"text-indigo-400 text-sm mt-1",children:q==="de"?"Die n√§chste Seite erscheint bald":q==="fr"?"La page suivante arrive bient√¥t":"Next page coming soon"})]}):r!=null&&r.imageData||g?e.jsxs("div",{className:"w-full mb-4 relative",children:[e.jsx(tt,{src:((r==null?void 0:r.imageData)||g)??"",alt:`Scene for page ${a}`,className:`w-full rounded-lg shadow-md object-cover ${we.has(a)?"opacity-50":""}`,label:`Page ${a}`}),we.has(a)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(_e,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:t==="de"?"Neues Bild wird erstellt...":t==="fr"?"Nouvelle image en cours...":"Generating new image..."})]}),u&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>Ht(a),disabled:c||we.has(a)||!ae,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||we.has(a)||!ae?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:ae?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(ke,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Ae," ",t==="de"?"Credits":"credits",")"]})]}),Fs&&e.jsxs("button",{onClick:()=>Rs(!0),disabled:c,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(de,{size:14}),t==="de"?"Text bearbeiten":t==="fr"?"Modifier le texte":"Edit Text"]}),es(a).length>1&&e.jsxs("button",{onClick:()=>Vs({pageNumber:a,versions:es(a)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(Ne,{size:14}),es(a).length]})]})}),Z&&e.jsxs("div",{className:"mt-3 space-y-2",children:[Q&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{_s===a?Me(null):(Me(a),ze("fresh"))},disabled:c||Te!==null||be!==null,className:`w-full bg-purple-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||Te!==null||be!==null?"opacity-50 cursor-not-allowed":"hover:bg-purple-600"}`,title:t==="de"?"Bild analysieren, 17 Checks durchf√ºhren, mit korrigierter Szene neu generieren":t==="fr"?"Analyser l'image, ex√©cuter 17 v√©rifications, r√©g√©n√©rer avec sc√®ne corrig√©e":"Analyze image, run 17 checks, regenerate with corrected scene",children:Te===a?e.jsxs(e.Fragment,{children:[e.jsx(_e,{size:14,className:"animate-spin"}),t==="de"?"Iteriere...":t==="fr"?"It√©ration...":"Iterating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ut,{size:14}),t==="de"?"N√§chste Iteration":t==="fr"?"Prochaine It√©ration":"Next Iteration"]})}),_s===a&&e.jsxs("div",{className:"mt-2 bg-purple-50 border border-purple-200 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`iterateMode-${a}`,checked:oe==="fresh",onChange:()=>ze("fresh"),className:"text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:t==="de"?"Neue Generierung":"Fresh generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`iterateMode-${a}`,checked:oe==="reference",onChange:()=>ze("reference"),className:"text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:t==="de"?"Aktuelles Bild als Referenz":"Use original as reference"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`iterateMode-${a}`,checked:oe==="blackout",onChange:()=>ze("blackout"),className:"text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:t==="de"?"Fehler schw√§rzen":"Blackout issues"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:oe==="fresh"?t==="de"?"Neue Generierung aus KI-korrigierter Szene":"Fresh generation from AI-corrected scene":oe==="reference"?t==="de"?"Erh√§lt Komposition, kann aber Korrekturen einschr√§nken":"Preserves composition but may limit corrections":t==="de"?"Schw√§rzt fehlerhafte Bereiche, erzwingt Neugenerierung":"Blacks out broken areas, forces regeneration"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_t(a,{useOriginalAsReference:oe==="reference",blackoutIssues:oe==="blackout"}),className:"flex-1 bg-purple-600 text-white px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-purple-700",children:t==="de"?"Iteration starten":t==="fr"?"D√©marrer l'it√©ration":"Start Iteration"}),e.jsx("button",{onClick:()=>Me(null),className:"px-3 py-1.5 rounded-lg text-sm text-gray-600 hover:bg-purple-100",children:"‚úï"})]})]})]}),H&&e.jsx("button",{onClick:()=>Vt(a),disabled:c||be!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||be!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:t==="de"?"Physik-Fehler automatisch erkennen und reparieren":t==="fr"?"D√©tecter et r√©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:be===a?e.jsxs(e.Fragment,{children:[e.jsx(_e,{size:14,className:"animate-spin"}),t==="de"?"Repariere...":t==="fr"?"R√©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{size:14}),t==="de"?"Auto-Reparatur":t==="fr"?"Auto-R√©paration":"Auto-Repair"]})}),C&&e.jsxs("button",{onClick:()=>C(a),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(de,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),(r==null?void 0:r.repairHistory)&&r.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(is,{size:14}),t==="de"?"Reparatur-Historie":t==="fr"?"Historique de r√©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",r.repairHistory.length," ",t==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:r.repairHistory.map((k,he)=>e.jsxs("div",{className:`border rounded-lg p-3 ${k.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[t==="de"?`Reparatur ${k.attempt}`:`Repair ${k.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${k.success?"text-green-600":"text-red-600"}`,children:["(",k.success?"‚úì":"‚úó"," ",k.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:k.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:t==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:t==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",k.fixPrompt]}),k.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:t==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:k.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),k.beforeImage&&k.afterImage&&e.jsxs("div",{className:"flex gap-4 cursor-pointer p-2 -m-2 rounded-lg hover:bg-amber-100 transition-colors",onClick:()=>qs({beforeImage:k.beforeImage,afterImage:k.afterImage,diffImage:k.diffImage,title:t==="de"?`Reparatur ${k.attempt}`:`Repair ${k.attempt}`}),title:t==="de"?"Klicken f√ºr Vergleichsansicht":"Click to compare",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:k.beforeImage,alt:"Before repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Nachher:":"After:"}),e.jsx("img",{src:k.afterImage,alt:"After repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),k.diffImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:"Diff:"}),e.jsx("img",{src:k.diffImage,alt:"Difference",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(k.timestamp).toLocaleTimeString()})]},he))})]}),Ys(a)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:t==="de"?"Auszug aus Gliederung":t==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Ys(a)})]}),Xs(a)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:t==="de"?"Szenen-Prompt":t==="fr"?"Prompt de sc√®ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:Xs(a)})]}),Zs(a)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description",et(a)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",et(a),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Zs(a)})]}),(r==null?void 0:r.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",(r==null?void 0:r.modelId)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:r==null?void 0:r.prompt})]}),((((_=r==null?void 0:r.referencePhotos)==null?void 0:_.length)??0)>0||(((Y=r==null?void 0:r.landmarkPhotos)==null?void 0:Y.length)??0)>0||(r==null?void 0:r.visualBibleGrid)||(r==null?void 0:r.hasVisualBibleGrid))&&r&&e.jsx(As,{referencePhotos:r.referencePhotos||[],landmarkPhotos:r.landmarkPhotos,visualBibleGrid:r.visualBibleGrid,hasVisualBibleGrid:r.hasVisualBibleGrid,language:t,storyId:B||void 0,pageNumber:a}),(r==null?void 0:r.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",(r==null?void 0:r.qualityModelId)&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${((r==null?void 0:r.qualityScore)??0)>=70?"text-green-600":((r==null?void 0:r.qualityScore)??0)>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round((r==null?void 0:r.qualityScore)??0),"%"]})]}),(r==null?void 0:r.qualityReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),(r==null?void 0:r.semanticResult)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 hover:text-purple-900 flex items-center justify-between",children:[e.jsx("span",{className:"flex items-center gap-2",children:t==="de"?"Semantische Treue":t==="fr"?"Fid√©lit√© s√©mantique":"Semantic Fidelity"}),e.jsx("span",{className:`text-lg font-bold ${(r.semanticScore??0)>=70?"text-green-600":(r.semanticScore??0)>=50?"text-yellow-600":"text-red-600"}`,children:r.semanticScore!==null&&r.semanticScore!==void 0?`${Math.round(r.semanticScore)}%`:"N/A"})]}),e.jsxs("div",{className:"mt-2 text-xs",children:[r.semanticResult.visible&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border border-purple-200",children:[e.jsx("div",{className:"font-medium text-purple-800 mb-1",children:"üëÅÔ∏è Visible:"}),(((X=r.semanticResult.visible.characters)==null?void 0:X.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Characters:"})," ",(xe=r.semanticResult.visible.characters)==null?void 0:xe.join(", ")]}),(((me=r.semanticResult.visible.objects)==null?void 0:me.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Objects:"})," ",(fe=r.semanticResult.visible.objects)==null?void 0:fe.join(", ")]}),r.semanticResult.visible.setting&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Setting:"})," ",r.semanticResult.visible.setting]}),r.semanticResult.visible.action&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Action:"})," ",r.semanticResult.visible.action]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-purple-200",children:[e.jsx("div",{className:"font-medium text-purple-800 mb-1",children:"üéØ Expected:"}),(((ye=(je=r.semanticResult.expected)==null?void 0:je.characters)==null?void 0:ye.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Characters:"})," ",(Fe=(Oe=r.semanticResult.expected)==null?void 0:Oe.characters)==null?void 0:Fe.join(", ")]}),(((fs=(bs=r.semanticResult.expected)==null?void 0:bs.objects)==null?void 0:fs.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Objects:"})," ",(ys=(js=r.semanticResult.expected)==null?void 0:js.objects)==null?void 0:ys.join(", ")]}),((Ns=r.semanticResult.expected)==null?void 0:Ns.setting)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Setting:"})," ",r.semanticResult.expected.setting]}),((vs=r.semanticResult.expected)==null?void 0:vs.action)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Action:"})," ",r.semanticResult.expected.action]})]})]}),((ws=r.semanticResult.semanticIssues)==null?void 0:ws.length)>0&&e.jsx("ul",{className:"list-disc list-inside text-purple-700 bg-white p-2 rounded border border-purple-200",children:r.semanticResult.semanticIssues.map((k,he)=>e.jsxs("li",{children:[e.jsxs("span",{className:`font-medium ${k.severity==="CRITICAL"?"text-red-600":k.severity==="MAJOR"?"text-orange-600":"text-yellow-600"}`,children:["[",k.severity,"]"]})," ",k.problem]},he))}),(!r.semanticResult.semanticIssues||r.semanticResult.semanticIssues.length===0)&&!r.semanticResult.visible&&e.jsx("span",{className:"text-green-600",children:"‚úì No semantic issues"})]})]}),e.jsx(Is,{retryHistory:r==null?void 0:r.retryHistory,language:t,storyId:B,pageNumber:r==null?void 0:r.pageNumber}),(r==null?void 0:r.retryHistory)&&r.retryHistory.length>0&&e.jsx(ls,{retryHistory:r.retryHistory,totalAttempts:Math.max((r==null?void 0:r.totalAttempts)||0,r.retryHistory.filter(k=>k.type!=="bbox_detection_only").length,((Ss=r==null?void 0:r.imageVersions)==null?void 0:Ss.length)||0),language:t,onRevertRepair:A?(k,he)=>A(r.pageNumber,he):void 0,storyId:B,pageNumber:r.pageNumber}),(r==null?void 0:r.wasRegenerated)&&(!(r!=null&&r.retryHistory)||r.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["üîÑ ",t==="de"?"Bild regeneriert":t==="fr"?"Image r√©g√©n√©r√©e":"Image Regenerated"]}),(r==null?void 0:r.originalScore)!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(r.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:t==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige Qualit√§t hatte.":t==="fr"?"L'image a √©t√© automatiquement r√©g√©n√©r√©e car la premi√®re version avait une qualit√© faible.":"Image was automatically regenerated because the first version had low quality."}),(r==null?void 0:r.originalImage)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:t==="de"?"Originalbild:":t==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:r.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),(r==null?void 0:r.originalReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Original Feedback:":t==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`w-full flex flex-col items-center justify-center rounded-lg p-8 mb-4 ${c?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:q==="de"?"Bild wird noch erstellt...":q==="fr"?"Image en cours de cr√©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:q==="de"?"Kein Bild f√ºr diese Seite":q==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"w-full bg-indigo-50 rounded-lg p-6 border-2 border-indigo-200",children:Qe?e.jsx("textarea",{value:s.trim(),onChange:k=>qt(i,k.target.value),className:"w-full min-h-[400px] p-3 text-gray-800 leading-snug font-serif text-xl text-center bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:t==="de"?"Text eingeben...":t==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl text-center",children:s.trim()})})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 items-stretch",children:[I?e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"aspect-[4/3] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-md flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-sm",children:q==="de"?"Bild wird geladen...":q==="fr"?"Chargement de l'image...":"Loading image..."})]})}):r&&r.imageData?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.imageData,alt:`Scene for page ${a}`,className:`w-full rounded-lg shadow-md object-cover ${we.has(a)?"opacity-50":""}`}),we.has(a)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(_e,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:t==="de"?"Neues Bild wird erstellt...":t==="fr"?"Nouvelle image en cours...":"Generating new image..."})]})]}),u&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>Ht(a),disabled:c||we.has(a)||!ae,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||we.has(a)||!ae?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:ae?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(ke,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Ae," ",t==="de"?"Credits":"credits",")"]})]}),Fs&&e.jsxs("button",{onClick:()=>Rs(!0),disabled:c,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(de,{size:14}),t==="de"?"Text bearbeiten":t==="fr"?"Modifier le texte":"Edit Text"]}),es(a).length>1&&e.jsxs("button",{onClick:()=>Vs({pageNumber:a,versions:es(a)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(Ne,{size:14}),es(a).length]})]})}),Z&&e.jsxs("div",{className:"mt-3 space-y-2",children:[Q&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{_s===a?Me(null):(Me(a),ze("fresh"))},disabled:c||Te!==null||be!==null,className:`w-full bg-purple-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||Te!==null||be!==null?"opacity-50 cursor-not-allowed":"hover:bg-purple-600"}`,title:t==="de"?"Bild analysieren, 17 Checks durchf√ºhren, mit korrigierter Szene neu generieren":t==="fr"?"Analyser l'image, ex√©cuter 17 v√©rifications, r√©g√©n√©rer avec sc√®ne corrig√©e":"Analyze image, run 17 checks, regenerate with corrected scene",children:Te===a?e.jsxs(e.Fragment,{children:[e.jsx(_e,{size:14,className:"animate-spin"}),t==="de"?"Iteriere...":t==="fr"?"It√©ration...":"Iterating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ut,{size:14}),t==="de"?"N√§chste Iteration":t==="fr"?"Prochaine It√©ration":"Next Iteration"]})}),_s===a&&e.jsxs("div",{className:"mt-2 bg-purple-50 border border-purple-200 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`iterateMode-${a}`,checked:oe==="fresh",onChange:()=>ze("fresh"),className:"text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:t==="de"?"Neue Generierung":"Fresh generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`iterateMode-${a}`,checked:oe==="reference",onChange:()=>ze("reference"),className:"text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:t==="de"?"Aktuelles Bild als Referenz":"Use original as reference"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`iterateMode-${a}`,checked:oe==="blackout",onChange:()=>ze("blackout"),className:"text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:t==="de"?"Fehler schw√§rzen":"Blackout issues"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:oe==="fresh"?t==="de"?"Neue Generierung aus KI-korrigierter Szene":"Fresh generation from AI-corrected scene":oe==="reference"?t==="de"?"Erh√§lt Komposition, kann aber Korrekturen einschr√§nken":"Preserves composition but may limit corrections":t==="de"?"Schw√§rzt fehlerhafte Bereiche, erzwingt Neugenerierung":"Blacks out broken areas, forces regeneration"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_t(a,{useOriginalAsReference:oe==="reference",blackoutIssues:oe==="blackout"}),className:"flex-1 bg-purple-600 text-white px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-purple-700",children:t==="de"?"Iteration starten":t==="fr"?"D√©marrer l'it√©ration":"Start Iteration"}),e.jsx("button",{onClick:()=>Me(null),className:"px-3 py-1.5 rounded-lg text-sm text-gray-600 hover:bg-purple-100",children:"‚úï"})]})]})]}),H&&e.jsx("button",{onClick:()=>Vt(a),disabled:c||be!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||be!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:t==="de"?"Physik-Fehler automatisch erkennen und reparieren":t==="fr"?"D√©tecter et r√©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:be===a?e.jsxs(e.Fragment,{children:[e.jsx(_e,{size:14,className:"animate-spin"}),t==="de"?"Repariere...":t==="fr"?"R√©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{size:14}),t==="de"?"Auto-Reparatur":t==="fr"?"Auto-R√©paration":"Auto-Repair"]})}),C&&e.jsxs("button",{onClick:()=>C(a),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(de,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),(r==null?void 0:r.repairHistory)&&r.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(is,{size:14}),t==="de"?"Reparatur-Historie":t==="fr"?"Historique de r√©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",r.repairHistory.length," ",t==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:r.repairHistory.map((k,he)=>e.jsxs("div",{className:`border rounded-lg p-3 ${k.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[t==="de"?`Reparatur ${k.attempt}`:`Repair ${k.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${k.success?"text-green-600":"text-red-600"}`,children:["(",k.success?"‚úì":"‚úó"," ",k.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:k.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:t==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:t==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",k.fixPrompt]}),k.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:t==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:k.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),k.beforeImage&&k.afterImage&&e.jsxs("div",{className:"flex gap-4 cursor-pointer p-2 -m-2 rounded-lg hover:bg-amber-100 transition-colors",onClick:()=>qs({beforeImage:k.beforeImage,afterImage:k.afterImage,diffImage:k.diffImage,title:t==="de"?`Reparatur ${k.attempt}`:`Repair ${k.attempt}`}),title:t==="de"?"Klicken f√ºr Vergleichsansicht":"Click to compare",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:k.beforeImage,alt:"Before repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Nachher:":"After:"}),e.jsx("img",{src:k.afterImage,alt:"After repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),k.diffImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:"Diff:"}),e.jsx("img",{src:k.diffImage,alt:"Difference",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(k.timestamp).toLocaleTimeString()})]},he))})]}),Ys(a)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:t==="de"?"Auszug aus Gliederung":t==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Ys(a)})]}),Xs(a)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:t==="de"?"Szenen-Prompt":t==="fr"?"Prompt de sc√®ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:Xs(a)})]}),Zs(a)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description",et(a)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",et(a),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Zs(a)})]}),r.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",r.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:r.prompt})]}),((((Cs=r.referencePhotos)==null?void 0:Cs.length)??0)>0||((($s=r.landmarkPhotos)==null?void 0:$s.length)??0)>0||r.visualBibleGrid||r.hasVisualBibleGrid)&&e.jsx(As,{referencePhotos:r.referencePhotos||[],landmarkPhotos:r.landmarkPhotos,visualBibleGrid:r.visualBibleGrid,hasVisualBibleGrid:r.hasVisualBibleGrid,language:t,storyId:B||void 0,pageNumber:a}),r.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",r.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${r.qualityScore>=70?"text-green-600":r.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(r.qualityScore),"%"]})]}),r.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),e.jsx(Is,{retryHistory:r.retryHistory,language:t,storyId:B,pageNumber:r.pageNumber}),r.retryHistory&&r.retryHistory.length>0&&e.jsx(ls,{retryHistory:r.retryHistory,totalAttempts:Math.max(r.totalAttempts||0,r.retryHistory.filter(k=>k.type!=="bbox_detection_only").length,((ks=r.imageVersions)==null?void 0:ks.length)||0),language:t,onRevertRepair:A?(k,he)=>A(r.pageNumber,he):void 0,storyId:B,pageNumber:r.pageNumber}),r.wasRegenerated&&(!r.retryHistory||r.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["üîÑ ",t==="de"?"Bild regeneriert":t==="fr"?"Image r√©g√©n√©r√©e":"Image Regenerated"]}),r.originalScore!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(r.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:t==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige Qualit√§t hatte.":t==="fr"?"L'image a √©t√© automatiquement r√©g√©n√©r√©e car la premi√®re version avait une qualit√© faible.":"Image was automatically regenerated because the first version had low quality."}),r.originalImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:t==="de"?"Originalbild:":t==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:r.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),r.originalReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Original Feedback:":t==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`flex flex-col items-center justify-center rounded-lg p-8 ${c?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:q==="de"?"Bild wird noch erstellt...":q==="fr"?"Image en cours de cr√©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:q==="de"?"Kein Bild f√ºr diese Seite":q==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"flex flex-col w-full h-full",children:Qe?e.jsx("textarea",{value:s.trim(),onChange:k=>qt(i,k.target.value),className:"w-full flex-1 min-h-[300px] p-4 text-gray-800 leading-snug font-serif text-xl bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:t==="de"?"Text eingeben...":t==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl",children:s.trim()})})})]})]},a)})]}),f&&rs(f.backCover)&&(()=>{var i,a,l;const s=f.backCover;return e.jsxs("div",{className:"mt-8 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:q==="de"?"R√ºckseite":q==="fr"?"Quatri√®me de couverture":"Back Cover"}),e.jsxs("div",{className:"relative",children:[e.jsx(tt,{src:rs(f.backCover),alt:"Back Cover",className:"w-full rounded-lg shadow-lg",label:"Back Cover"}),D.has("backCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(pe,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),W&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>ht("back"),disabled:c||!ae||D.has("backCover"),className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||!ae||D.has("backCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:ae?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(ke,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Ae," ",t==="de"?"Credits":"credits",")"]})]}),Ce("backCover").length>1&&e.jsxs("button",{onClick:()=>cs({coverType:"backCover",versions:Ce("backCover")}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(Ne,{size:14}),Ce("backCover").length]})]}),Z&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[E&&e.jsxs("button",{onClick:()=>E("back"),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(de,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:(()=>{const r=I=>{if(typeof I!="string")return I;try{const _=JSON.parse(I);return typeof _=="string"&&(_.startsWith("{")||_.startsWith("["))?r(_):_}catch{return I}},g=s.description,N=typeof g=="object"&&(g!=null&&g.text)?g.text:g,z=r(N);return typeof z=="object"&&z!==null?JSON.stringify(z,null,2):String(z)})()})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:s.prompt})]}),((((i=s.referencePhotos)==null?void 0:i.length)??0)>0||(((a=s.landmarkPhotos)==null?void 0:a.length)??0)>0||s.visualBibleGrid)&&e.jsx(As,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,visualBibleGrid:s.visualBibleGrid,language:t}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),e.jsx(Is,{retryHistory:s.retryHistory,bboxDetection:s.bboxDetection,bboxOverlayImage:s.bboxOverlayImage,language:t,storyId:B,coverType:"back"}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(ls,{retryHistory:s.retryHistory,totalAttempts:Math.max(s.totalAttempts||0,s.retryHistory.filter(r=>r.type!=="bbox_detection_only").length,((l=s.imageVersions)==null?void 0:l.length)||0),language:t}),s.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[t==="de"?"Vorherige Version":t==="fr"?"Version pr√©c√©dente":"Previous Version",s.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(s.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),s.originalImage&&s.originalImage!==s.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[t==="de"?"Originalbild":t==="fr"?"Image originale":"Original Image",s.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(s.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),ts&&x&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-4 mt-6",children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-3 text-center",children:t==="de"?"Was m√∂chten Sie als N√§chstes tun?":t==="fr"?"Que souhaitez-vous faire ensuite ?":"What would you like to do next?"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[B&&n&&e.jsxs("button",{onClick:n,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Sr,{size:16})," ",t==="de"?"Buch erstellen":t==="fr"?"Cr√©er le livre":"Create Book"]}),T&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>Ws(!Ye),disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ns,{size:16}),t==="de"?"PDF herunterladen":t==="fr"?"T√©l√©charger PDF":"Download PDF",e.jsx(He,{size:14,className:`transition-transform ${Ye?"rotate-180":""}`})]}),Ye&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:Ze==="square",onChange:()=>Hs("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20√ó20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:Ze==="A4",onChange:()=>Hs("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21√ó28cm)"})]})]}),e.jsx("button",{onClick:()=>{T(Ze),Ws(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:t==="de"?"Herunterladen":t==="fr"?"T√©l√©charger":"Download"})]})]}),B&&!c&&e.jsx(Ar,{storyId:B,variant:"full"}),G&&e.jsxs("button",{onClick:G,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Cr,{size:16})," ",t==="de"?"Neue Geschichte":t==="fr"?"Nouvelle histoire":"New Story"]})]})]}),Qe&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 shadow-lg p-3 md:p-4 z-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(de,{size:18,className:"flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-sm md:text-base",children:t==="de"?"Bearbeitungsmodus":t==="fr"?"Mode √©dition":"Edit Mode"}),Os&&e.jsxs("span",{className:"text-xs text-gray-500 hidden sm:inline",children:["(",t==="de"?"Original gespeichert":t==="fr"?"Original sauvegard√©":"Original saved",")"]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-center md:justify-end",children:[e.jsxs("button",{onClick:Hr,disabled:ds,className:"px-3 md:px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(Pe,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:t==="de"?"Abbrechen":t==="fr"?"Annuler":"Cancel"})]}),Os&&Ls!==Os&&e.jsxs("button",{onClick:()=>Es(Os),disabled:ds,className:"px-3 md:px-4 py-2 border border-amber-400 text-amber-700 rounded-lg hover:bg-amber-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(ut,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:t==="de"?"Zur√ºcksetzen":t==="fr"?"Restaurer":"Restore"})]}),e.jsxs("button",{onClick:qr,disabled:ds,className:`px-3 md:px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-semibold flex items-center gap-1.5 ${ds?"opacity-50 cursor-not-allowed":"hover:bg-green-600"}`,children:[e.jsx(as,{size:16}),ds?t==="de"?"Speichern...":t==="fr"?"Sauvegarde...":"Saving...":t==="de"?"Speichern":t==="fr"?"Sauvegarder":"Save"]})]})]})}),ge&&e.jsx(fa,{pageNumber:ge.pageNumber,scene:ge.scene,onSceneChange:s=>xs({...ge,scene:s}),onClose:()=>xs(null),onRegenerate:Yr,isRegenerating:we.has(ge.pageNumber),imageRegenerationCost:Ae,characters:y.map(s=>({id:s.id,name:s.name})),selectedCharacterIds:ge.selectedCharacterIds,onCharacterSelectionChange:s=>xs({...ge,selectedCharacterIds:s}),consistencyRegen:Z?(ar=v.find(s=>s.pageNumber===ge.pageNumber))==null?void 0:ar.consistencyRegen:void 0}),J&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ke,{size:20}),t==="de"?"Cover bearbeiten":t==="fr"?"Modifier la couverture":"Edit Cover"," - ",J.coverType==="front"?t==="de"?"Titelseite":t==="fr"?"Couverture":"Front Cover":J.coverType==="initial"?t==="de"?"Einleitungsseite":t==="fr"?"Page de d√©dicace":"Dedication Page":t==="de"?"R√ºckseite":t==="fr"?"Dos":"Back Cover"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t==="de"?"Bearbeite die Szenenbeschreibung und w√§hle die Charaktere aus":t==="fr"?"Modifiez la description de la sc√®ne et s√©lectionnez les personnages":"Edit the scene description and select the characters"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[y.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(Nt,{size:16}),t==="de"?"Charaktere auf dem Cover:":t==="fr"?"Personnages sur la couverture:":"Characters on the cover:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map(s=>{const i=J.selectedCharacterIds.includes(s.id);return e.jsxs("button",{type:"button",onClick:()=>{const a=i?J.selectedCharacterIds.filter(l=>l!==s.id):[...J.selectedCharacterIds,s.id];Be({...J,selectedCharacterIds:a})},className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${i?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{className:"font-medium",children:s.name}),i&&e.jsx("span",{className:"text-indigo-500",children:"‚úì"})]},s.id)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:t==="de"?"W√§hle die Charaktere aus, die auf dem Cover erscheinen sollen.":t==="fr"?"S√©lectionnez les personnages qui doivent appara√Ætre sur la couverture.":"Select the characters that should appear on the cover."})]}),J.coverType==="front"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t==="de"?"Titel:":t==="fr"?"Titre:":"Title:"}),e.jsx("input",{type:"text",value:J.title||"",onChange:s=>Be({...J,title:s.target.value}),placeholder:t==="de"?"Der Titel des Buches":t==="fr"?"Le titre du livre":"The book title",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),J.coverType==="initial"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t==="de"?"Widmung:":t==="fr"?"D√©dicace:":"Dedication:"}),e.jsx("input",{type:"text",value:J.dedication||"",onChange:s=>Be({...J,dedication:s.target.value}),placeholder:t==="de"?'z.B. "F√ºr meine liebste Tochter Emma"':t==="fr"?'par ex. "Pour ma ch√®re fille Emma"':'e.g. "For my dear daughter Emma"',className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t==="de"?"Leer lassen f√ºr keine Widmung":t==="fr"?"Laisser vide pour aucune d√©dicace":"Leave empty for no dedication"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t==="de"?"Szenenbeschreibung:":t==="fr"?"Description de la sc√®ne:":"Scene description:"}),e.jsx("textarea",{value:J.scene,onChange:s=>Be({...J,scene:s.target.value}),placeholder:t==="de"?'z.B. "Die Hauptfigur steht vor einem magischen Schloss bei Sonnenuntergang"':t==="fr"?'par ex. "Le personnage principal devant un ch√¢teau magique au coucher du soleil"':'e.g. "The main character standing in front of a magical castle at sunset"',className:"w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y"}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:t==="de"?"Tipp: Beschreibe die Aktionen und die Umgebung. Die ausgew√§hlten Charaktere werden automatisch hinzugef√ºgt.":t==="fr"?"Conseil: D√©crivez les actions et l'environnement. Les personnages s√©lectionn√©s seront ajout√©s automatiquement.":"Tip: Describe the actions and the environment. Selected characters will be added automatically."})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:J.selectedCharacterIds.length>0&&e.jsx("span",{children:t==="de"?`${J.selectedCharacterIds.length} Charakter(e) ausgew√§hlt`:t==="fr"?`${J.selectedCharacterIds.length} personnage(s) s√©lectionn√©(s)`:`${J.selectedCharacterIds.length} character(s) selected`})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>Be(null),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium order-2 sm:order-1",children:t==="de"?"Abbrechen":t==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{onClick:Xr,disabled:D.has(J.coverType==="front"?"frontCover":J.coverType==="initial"?"initialPage":"backCover")||J.selectedCharacterIds.length===0,className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 order-1 sm:order-2 ${D.has(J.coverType==="front"?"frontCover":J.coverType==="initial"?"initialPage":"backCover")||J.selectedCharacterIds.length===0?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:[e.jsx(ke,{size:16}),t==="de"?"Neu generieren":t==="fr"?"R√©g√©n√©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Ae," ",t==="de"?"Credits":"credits",")"]})]})]})]})]})}),ct&&e.jsx(kr,{pageNumber:ct.pageNumber,versions:ct.versions,onClose:()=>Vs(null),onSelectVersion:(s,i)=>Jr(s,i),developerMode:Z}),xt&&e.jsx(kr,{coverType:xt.coverType,versions:xt.versions,onClose:()=>cs(null),onSelectVersion:(s,i)=>Qr(s,i),developerMode:Z}),pt&&e.jsx(ya,{src:pt.src,title:pt.title,onClose:()=>ee(null)}),ps&&e.jsx(Na,{beforeImage:ps.beforeImage,afterImage:ps.afterImage,diffImage:ps.diffImage,title:ps.title,onClose:()=>qs(null)})]})}export{Xa as StoryDisplay,Xa as default};
