import{c as $e,d as sa,j as e,L as de,s as tt,u as rt,T as ta,X as Ce}from"./index-BF-AYD4v.js";import{b as A}from"./vendor-react-CqfXSjHo.js";import{U as jt}from"./Input-C9xplvbO.js";import{S as ra}from"./Textarea-CUckJYrT.js";import{H as aa,F as rs}from"./history-Bfg8kW-J.js";import{D as Be}from"./download-6e4RmTQd.js";import{C as Me}from"./chevron-down-DWmqmINp.js";import{C as bt}from"./chevron-right-CixWotl0.js";import{I as ia,S as ss}from"./ImageLightbox-3gHeBNs1.js";import{P as ie}from"./StoryWizard-CBRp6hAV.js";import{C as wr}from"./chevron-up-DqY8P3AN.js";import{R as Se}from"./Modal-CbcHKVx7.js";import{P as na}from"./palette-CxN9wC6G.js";import{B as la}from"./book-Dvo_IK3j.js";import{C as oa}from"./check-BRTZT8OS.js";import{S as Sr}from"./shopping-cart-Cgb7s5hj.js";import{P as Cr}from"./plus-DHDU99ez.js";import{B as gt}from"./book-open-zANuDzOV.js";import{W as ts}from"./wrench-7GXQecIc.js";import{R as ht}from"./rotate-ccw-BHDIV6es.js";import"./vendor-firebase-DTVMaYMy.js";import"./sparkles-Dw7UzahM.js";import"./circle-x-CHYdJM0q.js";import"./clock-B0t0vO6k.js";import"./arrow-left-Cen1YJKX.js";import"./arrow-right-iPEYjHAK.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=$e("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=$e("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=$e("Images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=$e("Link2Off",[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=$e("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=$e("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=$e("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $r=$e("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=$e("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),De=sa("ImageLoad");function et({src:d,alt:k,className:x,label:o}){const[$,L]=A.useState(!0),[S,D]=A.useState(null),b=A.useRef(0),y=A.useRef(null);A.useEffect(()=>{d&&d.length>100?(b.current=Date.now(),De.info(`‚è≥ Loading ${o||k}`,{isBase64:d==null?void 0:d.startsWith("data:"),sizeKB:Math.round(d.length*3/4/1024)})):b.current=0,L(!0),D(null)},[d,k,o]);const v=()=>{if(L(!1),b.current===0){De.info(`‚úÖ Loaded ${o||k} (placeholder/empty)`);return}const z=Date.now()-b.current;D(z);const m=(d==null?void 0:d.startsWith("data:"))?Math.round(d.length*3/4/1024):null,c=y.current?`${y.current.naturalWidth}x${y.current.naturalHeight}`:"unknown";z<100?De.success(`‚úÖ Loaded ${o||k} in ${z}ms`,{sizeKB:m,naturalSize:c}):z<500?De.info(`‚úÖ Loaded ${o||k} in ${z}ms`,{sizeKB:m,naturalSize:c}):z<2e3?De.warn(`‚ö†Ô∏è Slow load: ${o||k} took ${z}ms`,{sizeKB:m,naturalSize:c}):De.error(`üê¢ Very slow: ${o||k} took ${z}ms`,{sizeKB:m,naturalSize:c}),z>1e3&&ga({type:"slow_image_load",label:o||k,loadTimeMs:z,sizeKB:m,naturalSize:c,userAgent:navigator.userAgent,timestamp:new Date().toISOString()})},h=()=>{if(L(!1),b.current===0){De.error(`‚ùå Failed to load ${o||k} (no data received)`);return}const z=Date.now()-b.current;De.error(`‚ùå Failed to load ${o||k} after ${z}ms`)};return e.jsx("img",{ref:y,src:d,alt:k,className:x,onLoad:v,onError:h,draggable:!1})}async function ga(d){try{await fetch("/api/log-error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errorType:"Performance",message:`Slow image load: ${d.label} took ${d.loadTimeMs}ms`,userAgent:d.userAgent,timestamp:d.timestamp,url:window.location.href})})}catch{}}function Ps(d,k){const x=new Blob([d],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(x),$=document.createElement("a");$.href=o,$.download=k,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(o)}function ft(d,k=0){const x="  ".repeat(k);if(d==null)return`${x}null`;if(typeof d=="boolean")return`${x}${d?"YES":"NO"}`;if(typeof d=="number")return`${x}${d}`;if(typeof d=="string")return`${x}${d}`;if(Array.isArray(d))return d.length===0?`${x}[]`:d.map((o,$)=>`${x}[${$}]: ${ft(o,0)}`).join(`
`);if(typeof d=="object"){const o=Object.entries(d);return o.length===0?`${x}{}`:o.map(([$,L])=>{const S=ft(L,k+1);return typeof L=="object"&&L!==null?`${x}${$}:
${S}`:`${x}${$}: ${S.trim()}`}).join(`
`)}return`${x}${String(d)}`}function st({data:d,language:k,title:x}){const[o,$]=A.useState(new Set);if(!d)return e.jsx("div",{className:"text-gray-400 italic text-sm",children:k==="de"?"Keine Daten":"No data"});let L=d;if(typeof d=="string")try{L=JSON.parse(d)}catch{return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-1",children:e.jsxs("button",{onClick:()=>Ps(d,`${x||"evaluation"}.txt`),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1",title:"Download as text file",children:[e.jsx(Be,{size:12})," Download"]})}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap bg-gray-50 p-3 rounded max-h-80 overflow-auto font-mono",children:d})]})}const S=y=>{const v=new Set(o);v.has(y)?v.delete(y):v.add(y),$(v)},D=()=>{const y=ft(L);Ps(y,`${x||"evaluation"}.txt`)},b=(y,v,h=0)=>{const z=o.has(y);if(v==null)return e.jsx("span",{className:"text-gray-400",children:"null"});if(typeof v=="boolean")return e.jsx("span",{className:v?"text-green-600 font-medium":"text-red-600 font-medium",children:v?"‚úì":"‚úó"});if(typeof v=="number"){const H=v>=70?"text-green-600":v>=50?"text-yellow-600":"text-red-600";return e.jsx("span",{className:`font-bold ${H}`,children:v})}if(typeof v=="string")return v.length>100?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>S(y),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[z?e.jsx(Me,{size:14}):e.jsx(bt,{size:14}),z?"Collapse":`Show (${v.length} chars)`]}),z&&e.jsx("div",{className:"mt-1 p-2 bg-gray-100 rounded text-sm whitespace-pre-wrap font-mono",children:v})]}):e.jsx("span",{className:"text-gray-700",children:v});if(Array.isArray(v))return v.length===0?e.jsx("span",{className:"text-gray-400",children:"[]"}):e.jsx("div",{className:"ml-2 border-l-2 border-gray-200 pl-2",children:v.map((H,m)=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"text-gray-400 text-xs",children:["[",m,"]"]})," ",b(`${y}.${m}`,H,h+1)]},m))});if(typeof v=="object"){const H=Object.entries(v);return H.length===0?e.jsx("span",{className:"text-gray-400",children:"{}"}):h>0?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>S(y),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[z?e.jsx(Me,{size:14}):e.jsx(bt,{size:14}),z?"Collapse":`{${H.length} fields}`]}),z&&e.jsx("div",{className:"ml-2 mt-1 border-l-2 border-gray-200 pl-2",children:H.map(([m,c])=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-600",children:[m,":"]})," ",b(`${y}.${m}`,c,h+1)]},m))})]}):e.jsx("div",{className:"space-y-1",children:H.map(([m,c])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-600 min-w-[100px]",children:[m,":"]}),e.jsx("div",{className:"flex-1",children:b(`${y}.${m}`,c,h+1)})]},m))})}return e.jsx("span",{children:String(v)})};return e.jsxs("div",{className:"text-sm space-y-1 max-h-[500px] overflow-auto",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("button",{onClick:D,className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-1 bg-blue-50 rounded hover:bg-blue-100",title:"Download as text file",children:[e.jsx(Be,{size:12})," Download"]})}),b("root",L)]})}function ha({beforeImage:d,maskImage:k,onEnlarge:x}){return e.jsxs("div",{className:"relative w-40 h-40 cursor-pointer hover:ring-2 hover:ring-amber-400 rounded overflow-hidden border",onClick:()=>x(d,"Before with Mask"),children:[e.jsx("img",{src:d,alt:"Before",className:"w-full h-full object-contain"}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:{backgroundImage:`url(${k})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",mixBlendMode:"multiply",opacity:.5}}),e.jsx("img",{src:k,alt:"Mask overlay",className:"absolute inset-0 w-full h-full object-contain pointer-events-none",style:{mixBlendMode:"screen",opacity:.7,filter:"sepia(1) saturate(5) hue-rotate(-50deg)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent text-white text-[10px] text-center py-1 font-medium",children:"üéØ Edit Area"})]})}function as({retryHistory:d,totalAttempts:k,language:x,onRevertRepair:o,storyId:$,pageNumber:L}){const[S,D]=A.useState(null),[b,y]=A.useState({}),[v,h]=A.useState(new Set),z=async T=>{if(!(!$||L===void 0||v.has(T))){h(n=>new Set(n).add(T));try{const n=localStorage.getItem("auth_token"),F=new URLSearchParams({page:String(L),type:"retry",index:String(T)}),Q=await fetch(`/api/stories/${$}/dev-image?${F}`,{headers:n?{Authorization:`Bearer ${n}`}:{}});if(Q.ok){const W=await Q.json();y(g=>({...g,[T]:{imageData:W.imageData,annotatedOriginal:W.annotatedOriginal,grids:W.grids,bboxOverlayImage:W.bboxOverlayImage}}))}}catch(n){console.error(`Failed to load retry images for retry ${T}:`,n)}finally{h(n=>{const F=new Set(n);return F.delete(T),F})}}};if(!d||d.length===0)return null;const H=d.filter(T=>T.type==="auto_repair"||T.type==="grid_repair"||T.type==="grid_repair_failed").length,m=d.filter(T=>T.type==="grid_repair"||T.type==="grid_repair_failed").length,c=d.filter(T=>T.type==="grid_repair_failed").length;return e.jsxs(e.Fragment,{children:[S&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>D(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("div",{className:"absolute -top-8 left-0 text-white text-sm",children:S.title}),e.jsx("img",{src:S.src,alt:S.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute -top-8 right-0 text-white hover:text-gray-300",onClick:()=>D(null),children:"‚úï Close"})]})}),e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(aa,{size:14}),x==="de"?"Generierungshistorie":x==="fr"?"Historique de g√©n√©ration":"Generation History",H>0&&e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded",children:["üîß ",H," ",x==="de"?"Reparatur":"repair",H>1?x==="de"?"en":"s":"",m>0&&e.jsxs("span",{className:"ml-1",children:["(",m," grid",c>0?`, ${c} failed`:"",")"]})]})]}),e.jsxs("span",{className:"text-purple-600",children:[k," ",x==="de"?"Versuche":x==="fr"?"tentatives":"attempts"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:(()=>{const T=d.filter(n=>n.type!=="bbox_detection_only");return T.map((n,F)=>{var Q,W;return e.jsxs("div",{className:`border rounded-lg p-3 ${n.type==="grid_repair_failed"?"bg-red-50 border-red-300":n.type==="grid_repair"?"bg-violet-50 border-violet-300":n.type==="auto_repair"?"bg-amber-50 border-amber-300":F===T.length-1?"bg-green-50 border-green-300":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-sm",children:[n.type==="grid_repair_failed"?e.jsx("span",{className:"text-red-700",children:"üî≤ Grid Repair Failed"}):n.type==="grid_repair"?e.jsx("span",{className:"text-violet-700",children:"üî≤ Grid Repair"}):n.type==="auto_repair"?e.jsx("span",{className:"text-amber-700",children:"üîß Auto-Repair"}):e.jsx(e.Fragment,{children:x==="de"?`Versuch ${n.attempt}`:x==="fr"?`Tentative ${n.attempt}`:`Attempt ${n.attempt}`}),n.type==="text_edit"&&e.jsx("span",{className:"text-xs ml-2 text-blue-600",children:"(text edit)"}),n.type==="text_edit_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(text edit failed)"}),n.type==="auto_repair_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(auto-repair failed)"}),F===T.length-1&&n.type!=="auto_repair"&&e.jsx("span",{className:"text-xs ml-2 text-green-600 font-bold",children:"‚úì USED"})]}),n.type==="auto_repair"&&n.preRepairScore!==void 0&&n.postRepairScore!==void 0?e.jsxs("span",{className:"font-bold text-sm",children:[e.jsxs("span",{className:n.preRepairScore>=70?"text-green-600":n.preRepairScore>=50?"text-yellow-600":"text-red-600",children:[n.preRepairScore,"%"]}),e.jsx("span",{className:"text-gray-400 mx-1",children:"‚Üí"}),e.jsxs("span",{className:n.postRepairScore>=70?"text-green-600":n.postRepairScore>=50?"text-yellow-600":"text-red-600",children:[n.postRepairScore,"%"]})]}):n.score!==void 0&&e.jsxs("span",{className:`font-bold ${n.score>=70?"text-green-600":n.score>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(n.score),"%"]})]}),n.error&&e.jsxs("div",{className:"text-xs text-red-600 mb-2",children:["Error: ",n.error]}),n.textIssue&&n.textIssue!=="NONE"&&e.jsxs("div",{className:"text-xs text-orange-600 mb-2",children:["Text issue: ",n.textIssue,n.expectedText&&e.jsxs("span",{className:"block",children:['Expected: "',n.expectedText,'"']}),n.actualText&&e.jsxs("span",{className:"block",children:['Actual: "',n.actualText,'"']})]}),n.type==="auto_repair"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[n.fixTargetsCount&&e.jsxs("div",{className:"text-xs text-amber-700",children:["Fixed ",n.fixTargetsCount," target",n.fixTargetsCount>1?"s":""]}),o&&((W=(Q=n.repairDetails)==null?void 0:Q[0])==null?void 0:W.beforeImage)&&n.postRepairScore!==void 0&&n.preRepairScore!==void 0&&n.postRepairScore<=n.preRepairScore&&e.jsxs("button",{onClick:()=>o(F,n.repairDetails[0].beforeImage),className:"text-xs px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded border border-red-300 transition-colors",children:["‚Ü©Ô∏è ",x==="de"?"Zur√ºcksetzen":"Revert to Original"]})]}),n.postRepairScore!==void 0&&n.preRepairScore!==void 0&&n.postRepairScore<n.preRepairScore&&e.jsxs("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded border border-red-200",children:["‚ö†Ô∏è ",x==="de"?`Bewertung verschlechtert: ${n.preRepairScore}% ‚Üí ${n.postRepairScore}%`:`Score decreased: ${n.preRepairScore}% ‚Üí ${n.postRepairScore}%`]}),n.bboxDetection&&Array.isArray(n.bboxDetection)&&n.bboxDetection.length>0&&e.jsxs("details",{className:"text-sm mb-2",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-700 font-medium hover:text-blue-900",children:["üì¶ ",x==="de"?"Bounding Box Erkennung":"Bounding Box Detection"," (",n.bboxDetection.length,")"]}),e.jsx("div",{className:"mt-3 space-y-2",children:n.bboxDetection.map((g,q)=>e.jsxs("div",{className:`p-3 rounded-lg border ${g.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:`font-medium text-sm ${g.success?"text-green-800":"text-red-800"}`,children:[g.success?"‚úì":"‚úó"," ",g.issue.substring(0,60),g.issue.length>60?"...":""]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${g.severity==="CRITICAL"?"bg-red-200 text-red-800":g.severity==="MAJOR"?"bg-orange-200 text-orange-800":g.severity==="MODERATE"?"bg-yellow-200 text-yellow-800":"bg-gray-200 text-gray-800"}`,children:[g.severity," ‚Ä¢ ",g.type]})]}),g.success&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${g.faceBox?"bg-purple-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-purple-800",children:"Face Box:"}),g.faceBox?e.jsxs("span",{className:"ml-1 font-mono text-purple-600",children:["[",g.faceBox.map(j=>(j*100).toFixed(0)+"%").join(", "),"]"]}):e.jsx("span",{className:"ml-1 text-gray-500 italic",children:"not detected"})]}),e.jsxs("div",{className:`p-2 rounded ${g.bodyBox?"bg-blue-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-blue-800",children:"Body Box:"}),g.bodyBox?e.jsxs("span",{className:"ml-1 font-mono text-blue-600",children:["[",g.bodyBox.map(j=>(j*100).toFixed(0)+"%").join(", "),"]"]}):e.jsx("span",{className:"ml-1 text-gray-500 italic",children:"not detected"})]})]}),g.label&&g.label!==g.issue&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Detected as:"})," ",g.label]}),g.usage&&e.jsxs("div",{className:"mt-1 text-xs text-gray-400",children:["Tokens: ",g.usage.input_tokens," in / ",g.usage.output_tokens," out"]})]},q))})]}),e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["üìä ",x==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-red-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-red-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 px-2 py-0.5 rounded",children:"Before"}),e.jsxs("span",{className:"text-red-600",children:[n.preRepairScore,"%"]})]}),e.jsx(st,{data:n.preRepairEval||n.reasoning,language:x,title:`evaluation-before-attempt-${F}`})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-green-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded",children:"After"}),e.jsxs("span",{className:"text-green-600",children:[n.postRepairScore,"%"]})]}),e.jsx(st,{data:n.postRepairEval,language:x,title:`evaluation-after-attempt-${F}`})]})]})]}),n.repairDetails&&n.repairDetails.length>0&&e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["üñºÔ∏è ",x==="de"?"Reparatur-Details":"Repair Details"," (",n.repairDetails.length,")"]}),e.jsx("div",{className:"mt-3 space-y-3",children:n.repairDetails.map((g,q)=>{var j,C;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-medium text-amber-800 text-base",children:g.description}),g.modelId&&e.jsx("span",{className:"text-xs text-gray-400 bg-gray-100 px-2 py-0.5 rounded",children:g.modelId})]}),e.jsxs("details",{className:"mb-3",children:[e.jsxs("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700 text-sm flex items-center gap-2",children:["Show fix prompt",e.jsxs("button",{onClick:B=>{B.stopPropagation(),Ps(g.fullPrompt||g.fixPrompt||"",`fix-prompt-${q}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(Be,{size:10})," Download"]})]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded text-sm text-gray-600 whitespace-pre-wrap font-mono max-h-[500px] overflow-auto",children:g.fullPrompt||g.fixPrompt})]}),e.jsxs("div",{className:"flex gap-4 items-start",children:[g.beforeImage&&g.maskImage?e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before + Mask"}),e.jsx(ha,{beforeImage:g.beforeImage,maskImage:g.maskImage,onEnlarge:(B,U)=>D({src:B,title:U})})]}):g.beforeImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before"}),e.jsx("img",{src:g.beforeImage,alt:"Before",className:"w-32 h-32 object-contain border rounded cursor-pointer hover:ring-2 hover:ring-amber-400",onClick:()=>D({src:g.beforeImage,title:"Before Repair"})})]}),e.jsx("div",{className:"flex items-center h-32 text-gray-400 text-2xl",children:"‚Üí"}),g.afterImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"After"}),e.jsx("img",{src:g.afterImage,alt:"After",className:"w-32 h-32 object-contain border-2 border-green-300 rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>D({src:g.afterImage,title:"After Repair"})})]})]}),g.verification&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded border text-sm",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"üîç Verification:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[g.verification.lpips&&e.jsxs("div",{className:`p-2 rounded ${g.verification.lpips.changed?"bg-green-100":"bg-yellow-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LPIPS: "}),e.jsx("span",{className:g.verification.lpips.changed?"text-green-700":"text-yellow-700",children:(j=g.verification.lpips.lpipsScore)==null?void 0:j.toFixed(4)}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",g.verification.lpips.changed?"‚úì changed":"‚ö† unchanged",")"]})]}),g.verification.llm&&e.jsxs("div",{className:`p-2 rounded ${g.verification.llm.fixed?"bg-green-100":"bg-red-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LLM: "}),e.jsx("span",{className:g.verification.llm.fixed?"text-green-700":"text-red-700",children:g.verification.llm.fixed?"‚úì Fixed":"‚úó Not fixed"}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",Math.round(g.verification.llm.confidence*100),"%)"]})]})]}),((C=g.verification.llm)==null?void 0:C.explanation)&&e.jsx("div",{className:"mt-2 text-gray-600 text-sm italic",children:g.verification.llm.explanation})]})]},q)})})]})]}),(n.type==="grid_repair"||n.type==="grid_repair_failed")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[n.gridTotalIssues!==void 0&&e.jsxs("span",{className:"text-violet-700",children:[x==="de"?"Probleme:":"Issues:"," ",n.gridTotalIssues]}),n.gridFixedCount!==void 0&&e.jsxs("span",{className:"text-green-600",children:["‚úì ",x==="de"?"Behoben:":"Fixed:"," ",n.gridFixedCount]}),n.gridFailedCount!==void 0&&n.gridFailedCount>0&&e.jsxs("span",{className:"text-red-600",children:["‚úó ",x==="de"?"Fehlgeschlagen:":"Failed:"," ",n.gridFailedCount]})]}),n.type==="grid_repair_failed"&&n.failReason&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-100 p-2 rounded border border-red-200",children:["‚ö†Ô∏è ",x==="de"?"Fehlergrund:":"Failure reason:"," ",n.failReason==="no_repairs_made"?x==="de"?"Keine Reparaturen durchgef√ºhrt":"No repairs were made":n.failReason==="no_image_data"?x==="de"?"Keine Bilddaten zur√ºckgegeben":"No image data returned":n.failReason==="image_too_small"?x==="de"?"Zur√ºckgegebenes Bild zu klein/ung√ºltig":"Returned image too small/invalid":n.failReason==="image_unchanged"?x==="de"?"Bild wurde nicht ver√§ndert":"Image was not changed":n.failReason]}),(()=>{var q;const g=n.annotatedOriginal||((q=b[F])==null?void 0:q.annotatedOriginal);return g?e.jsxs("details",{className:"text-sm",open:!0,children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["üìç ",x==="de"?"Schritt 1: Erkannte Probleme":"Step 1: Detected Issues"]}),e.jsxs("div",{className:"mt-3 bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:[x==="de"?"Originalbild mit markierten Problembereichen":"Original image with marked issue regions",e.jsxs("span",{className:"ml-2 text-gray-400",children:["(üî¥ ",x==="de"?"kritisch":"critical",", üü† ",x==="de"?"wichtig":"major",", üü° ",x==="de"?"gering":"minor",")"]})]}),e.jsx("img",{src:`data:image/jpeg;base64,${g}`,alt:"Annotated original",className:"max-w-md border rounded cursor-pointer hover:ring-2 hover:ring-violet-400",onClick:()=>D({src:`data:image/jpeg;base64,${g}`,title:x==="de"?"Erkannte Probleme":"Detected Issues"})})]})]}):n.hasAnnotatedOriginal&&$&&L!==void 0?e.jsx("button",{onClick:()=>z(F),disabled:v.has(F),className:"text-sm px-3 py-2 bg-violet-100 hover:bg-violet-200 text-violet-700 rounded border border-violet-300 flex items-center gap-2 disabled:opacity-50",children:v.has(F)?e.jsxs(e.Fragment,{children:[e.jsx(de,{size:14,className:"animate-spin"})," Loading..."]}):e.jsx(e.Fragment,{children:"üìç Load Detected Issues"})}):null})(),e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["üìä ",x==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-red-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-red-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 px-2 py-0.5 rounded",children:"Before"}),e.jsxs("span",{className:"text-red-600",children:[n.preRepairScore,"%"]})]}),e.jsx(st,{data:n.preRepairEval||n.reasoning,language:x,title:`evaluation-before-grid-${F}`})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-green-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded",children:"After"}),e.jsxs("span",{className:"text-green-600",children:[n.postRepairScore,"%"]})]}),e.jsx(st,{data:n.postRepairEval,language:x,title:`evaluation-after-grid-${F}`})]})]})]}),(()=>{var q,j;const g=n.grids||((q=b[F])==null?void 0:q.grids);return g&&g.length>0?e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["üî≤ ",x==="de"?"Grid-Details":"Grid Details"," (",g.length," ",g.length===1?"grid":"grids",")"]}),e.jsx("div",{className:"mt-3 space-y-4",children:g.map((C,B)=>{var U,X;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("span",{className:"font-medium text-violet-800",children:["Grid"," ",C.batchNum||B+1]}),((U=C.manifest)==null?void 0:U.issues)&&e.jsxs("span",{className:"text-xs text-gray-500",children:[C.manifest.issues.length," ",x==="de"?"Regionen":"regions"]})]}),((X=C.manifest)==null?void 0:X.issues)&&C.manifest.issues.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-violet-50 rounded text-sm",children:[e.jsx("div",{className:"font-medium text-violet-800 mb-1",children:x==="de"?"Zu reparierende Probleme:":"Issues to repair:"}),e.jsx("div",{className:"space-y-1",children:C.manifest.issues.map((O,se)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-mono font-bold text-violet-600 min-w-[20px]",children:[O.letter,":"]}),e.jsx("span",{className:"text-gray-700",children:O.fixInstruction||O.description||"Unknown issue"})]},se))})]}),C.prompt&&e.jsxs("details",{className:"mb-3",children:[e.jsxs("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700 text-sm flex items-center gap-2",children:[x==="de"?"Reparatur-Prompt anzeigen":"Show repair prompt",e.jsxs("button",{onClick:O=>{O.stopPropagation(),Ps(C.prompt||"",`grid-repair-prompt-${B}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(Be,{size:10})," Download"]})]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded text-sm text-gray-600 whitespace-pre-wrap font-mono max-h-[500px] overflow-auto",children:C.prompt})]}),e.jsxs("div",{className:"flex gap-4 items-start flex-wrap",children:[C.original&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:x==="de"?"Original-Grid":"Input Grid"}),e.jsx("img",{src:C.original.startsWith("data:")?C.original:`data:image/png;base64,${C.original}`,alt:"Input grid",className:"max-w-xs border rounded cursor-pointer hover:ring-2 hover:ring-violet-400",onClick:()=>D({src:C.original.startsWith("data:")?C.original:`data:image/png;base64,${C.original}`,title:x==="de"?"Original-Grid":"Input Grid"})})]}),C.original&&C.repaired&&e.jsx("div",{className:"flex items-center self-center text-gray-400 text-2xl",children:"‚Üí"}),C.repaired&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:x==="de"?"Repariertes Grid":"Repaired Grid"}),e.jsx("img",{src:C.repaired.startsWith("data:")?C.repaired:`data:image/png;base64,${C.repaired}`,alt:"Repaired grid",className:"max-w-xs border-2 border-green-300 rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>D({src:C.repaired.startsWith("data:")?C.repaired:`data:image/png;base64,${C.repaired}`,title:x==="de"?"Repariertes Grid":"Repaired Grid"})})]})]}),C.repairs&&C.repairs.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"font-medium text-violet-800 mb-2",children:["‚úÖ ",x==="de"?"Verifizierungsergebnisse":"Verification Results"]}),e.jsx("div",{className:"space-y-2",children:C.repairs.map((O,se)=>{var f,Z,ce,xe,ne,w,je,Is,is,Ve,_e,ye;return e.jsxs("div",{className:`mb-3 p-3 rounded-lg border ${(f=O.verification)!=null&&f.accepted?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"font-mono font-bold text-xl text-violet-600 w-8",children:O.letter}),e.jsxs("div",{className:"flex items-center gap-2",children:[O.originalThumbnail&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:x==="de"?"Vorher":"Before"}),e.jsx("img",{src:`data:image/jpeg;base64,${O.originalThumbnail}`,alt:"Before",className:"w-16 h-16 object-contain cursor-pointer hover:ring-2 hover:ring-violet-400 rounded border",onClick:()=>D({src:`data:image/jpeg;base64,${O.originalThumbnail}`,title:`${O.letter}: Before`})})]}),O.repairedThumbnail&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:x==="de"?"Nachher":"After"}),e.jsx("img",{src:`data:image/jpeg;base64,${O.repairedThumbnail}`,alt:"After",className:`w-16 h-16 object-contain cursor-pointer hover:ring-2 rounded border ${(Z=O.verification)!=null&&Z.accepted?"border-green-300":"border-red-300"}`,onClick:()=>D({src:`data:image/jpeg;base64,${O.repairedThumbnail}`,title:`${O.letter}: After`})})]}),O.diffImage&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Diff"}),e.jsx("img",{src:`data:image/jpeg;base64,${O.diffImage}`,alt:"Diff",className:"w-16 h-16 object-contain cursor-pointer hover:ring-2 hover:ring-purple-400 rounded border",onClick:()=>D({src:`data:image/jpeg;base64,${O.diffImage}`,title:`${O.letter}: Diff`})})]})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsx("span",{className:`text-2xl ${(ce=O.verification)!=null&&ce.accepted?"text-green-600":"text-red-600"}`,children:(xe=O.verification)!=null&&xe.accepted?"‚úì":"‚úó"}),e.jsxs("span",{className:`text-lg font-medium ${(((ne=O.verification)==null?void 0:ne.confidence)??0)>=.7?"text-green-600":(((w=O.verification)==null?void 0:w.confidence)??0)>=.5?"text-yellow-600":"text-red-600"}`,children:[Math.round((((je=O.verification)==null?void 0:je.confidence)??0)*100),"%"]})]})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-xs mr-2 ${O.severity==="critical"?"bg-red-200 text-red-800":O.severity==="major"?"bg-orange-200 text-orange-800":"bg-yellow-200 text-yellow-800"}`,children:O.type||"unknown"}),e.jsx("span",{className:"text-gray-700",children:O.description})]}),O.fixInstruction&&e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Fix:"})," ",O.fixInstruction]}),(((Is=O.verification)==null?void 0:Is.explanation)||((is=O.verification)==null?void 0:is.reason))&&e.jsxs("div",{className:`mt-2 text-sm p-2 rounded ${(Ve=O.verification)!=null&&Ve.accepted?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:"font-medium",children:x==="de"?"Ergebnis:":"Result:"})," ",((_e=O.verification)==null?void 0:_e.explanation)||((ye=O.verification)==null?void 0:ye.reason)]})]},se)})})]})]},B)})})]}):n.hasGrids&&$&&L!==void 0&&!((j=b[F])!=null&&j.grids)?e.jsx("button",{onClick:()=>z(F),disabled:v.has(F),className:"text-sm px-3 py-2 bg-violet-100 hover:bg-violet-200 text-violet-700 rounded border border-violet-300 flex items-center gap-2 disabled:opacity-50",children:v.has(F)?e.jsxs(e.Fragment,{children:[e.jsx(de,{size:14,className:"animate-spin"})," Loading..."]}):e.jsxs(e.Fragment,{children:["üî≤ Load Grid Details (",n.gridsCount||"?"," grids)"]})}):null})()]}),n.type!=="auto_repair"&&n.type!=="grid_repair"&&n.type!=="grid_repair_failed"&&n.prompt&&e.jsxs("details",{className:"text-sm mb-2",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-700 font-medium hover:text-blue-900 flex items-center gap-2",children:["üì§ ",x==="de"?"Eingabe-Prompt":"Input Prompt",e.jsxs("button",{onClick:g=>{g.stopPropagation(),Ps(n.prompt||"",`prompt-attempt-${n.attempt}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(Be,{size:10})," Download"]})]}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap bg-blue-50 p-3 rounded text-sm overflow-auto max-h-[500px] font-mono border border-blue-200",children:n.prompt})]}),n.type!=="auto_repair"&&n.type!=="grid_repair"&&n.type!=="grid_repair_failed"&&n.reasoning?e.jsxs("details",{className:"text-sm text-gray-600 mb-2",children:[e.jsxs("summary",{className:"cursor-pointer font-medium",children:["üì• ",x==="de"?"Bewertungs-Feedback":"Evaluation Feedback"]}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap bg-gray-50 p-3 rounded text-sm overflow-auto max-h-[500px] font-mono",children:n.reasoning})]}):n.type!=="auto_repair"&&n.type!=="grid_repair"&&n.type!=="grid_repair_failed"&&n.score===0&&e.jsx("div",{className:"text-sm text-gray-500 italic mb-2",children:x==="de"?"Qualit√§tsbewertung fehlgeschlagen":x==="fr"?"√âvaluation de qualit√© √©chou√©e":"Quality evaluation failed"}),(()=>{var q;if(n.type==="auto_repair"||n.type==="grid_repair"||n.type==="grid_repair_failed"||n.type==="bbox_detection_only")return null;const g=n.imageData||((q=b[F])==null?void 0:q.imageData);return g?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:x==="de"?"Generiertes Bild":"Generated Image"}),e.jsx("img",{src:g,alt:`Attempt ${n.attempt}`,className:`w-48 h-48 object-contain rounded border cursor-pointer hover:ring-2 ${F===T.length-1?"border-green-300 hover:ring-green-400":"border-gray-200 opacity-75 hover:ring-gray-400"}`,onClick:()=>D({src:g,title:`${x==="de"?"Versuch":"Attempt"} ${n.attempt}`})})]}):n.type==="generation"&&$&&L!==void 0&&!b[F]?e.jsx("button",{onClick:()=>z(F),disabled:v.has(F),className:"mt-2 text-sm px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded border border-blue-300 flex items-center gap-2 disabled:opacity-50",children:v.has(F)?e.jsxs(e.Fragment,{children:[e.jsx(de,{size:14,className:"animate-spin"})," Loading..."]}):e.jsxs(e.Fragment,{children:["üñºÔ∏è ",x==="de"?"Bild laden":"Load Image"]})}):null})(),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(n.timestamp).toLocaleTimeString()})]},F)})})()})]})]})}function ua(d){if(!d||d.length===0)return{bboxDetection:null,bboxOverlayImage:null,hasBboxOverlay:!1};const k=d.find(o=>o.type==="bbox_detection_only"&&o.bboxDetection)||d.find(o=>o.bboxDetection);if(!k)return{bboxDetection:null,bboxOverlayImage:null,hasBboxOverlay:!1};const x=k.bboxDetection;return x&&typeof x=="object"&&"figures"in x?{bboxDetection:x,bboxOverlayImage:k.bboxOverlayImage||null,hasBboxOverlay:!!k.hasBboxOverlay||!!k.bboxOverlayImage}:{bboxDetection:null,bboxOverlayImage:null,hasBboxOverlay:!1}}function ba(d,k){const x=new Blob([d],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(x),$=document.createElement("a");$.href=o,$.download=k,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(o)}function $s({retryHistory:d,bboxDetection:k,bboxOverlayImage:x,language:o,storyId:$,pageNumber:L,coverType:S}){var g,q;const[D,b]=A.useState(null),[y,v]=A.useState(null),[h,z]=A.useState(!1),H=ua(d),m=k||H.bboxDetection,c=x||H.bboxOverlayImage,T=!!x||H.hasBboxOverlay;if(!m)return null;const n=((g=m.figures)==null?void 0:g.length)||0,F=((q=m.objects)==null?void 0:q.length)||0,Q=async()=>{if(!(!$||h)&&!(!S&&L===void 0)){z(!0);try{const j=localStorage.getItem("auth_token"),C=new URLSearchParams({field:"bboxOverlay"});if(S)C.set("cover",S);else{C.set("page",String(L)),C.set("type","retry");const U=(d==null?void 0:d.findIndex(X=>X.type==="bbox_detection_only"&&X.bboxDetection||X.bboxDetection))??0;C.set("index",String(U))}const B=await fetch(`/api/stories/${$}/dev-image?${C}`,{headers:j?{Authorization:`Bearer ${j}`}:{}});if(B.ok){const U=await B.json();U.bboxOverlayImage&&v(U.bboxOverlayImage)}}catch(j){console.error("Failed to load bbox overlay:",j)}finally{z(!1)}}},W=c||y;return e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>b(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("div",{className:"absolute -top-8 left-0 text-white text-sm",children:D.title}),e.jsx("img",{src:D.src,alt:D.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute -top-8 right-0 text-white hover:text-gray-300",onClick:()=>b(null),children:"‚úï Close"})]})}),e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-blue-700 flex items-center justify-between",children:e.jsxs("span",{className:"flex items-center gap-2",children:["üì¶ ",o==="de"?"Objekterkennung":"Object Detection",e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded",children:[n," ",o==="de"?"Figuren":"figures",","," ",F," ",o==="de"?"Objekte":"objects"]}),m.positionMismatches&&m.positionMismatches.length>0&&e.jsxs("span",{className:"text-xs bg-yellow-200 text-yellow-800 px-1.5 py-0.5 rounded",children:["‚ö†Ô∏è ",m.positionMismatches.length," ",o==="de"?"Abweichungen":"mismatches"]}),m.missingCharacters&&m.missingCharacters.length>0&&e.jsxs("span",{className:"text-xs bg-red-200 text-red-800 px-1.5 py-0.5 rounded",children:["‚ùå ",m.missingCharacters.length," ",o==="de"?"Char fehlt":"char missing"]}),m.missingObjects&&m.missingObjects.length>0&&e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded",children:["‚ö†Ô∏è ",m.missingObjects.length," ",o==="de"?"Obj fehlt":"obj missing"]}),m.matchedObjects&&m.matchedObjects.length>0&&e.jsxs("span",{className:"text-xs bg-green-200 text-green-800 px-1.5 py-0.5 rounded",children:["‚úì ",m.matchedObjects.length," ",o==="de"?"Obj gefunden":"obj matched"]})]})}),e.jsxs("div",{className:"mt-3 space-y-3",children:[W?e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:[o==="de"?"Erkannte Regionen":"Detected Regions",e.jsx("span",{className:"ml-2 text-gray-400",children:"(üü¢ Body, üîµ Face, üü† Object, üü£ Matched)"})]}),e.jsx("img",{src:W,alt:"Bbox overlay",className:"max-w-md border rounded cursor-pointer hover:ring-2 hover:ring-blue-400",onClick:()=>b({src:W,title:o==="de"?"Erkannte Regionen":"Detected Regions"})})]}):T&&$&&L!==void 0?e.jsx("button",{onClick:Q,disabled:h,className:"text-sm px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded border border-blue-300 flex items-center gap-2 disabled:opacity-50",children:h?e.jsxs(e.Fragment,{children:[e.jsx(de,{size:14,className:"animate-spin"})," ",o==="de"?"L√§dt...":"Loading..."]}):e.jsxs(e.Fragment,{children:["üì¶ ",o==="de"?"Erkannte Regionen laden":"Load Detected Regions"]})}):null,m.expectedCharacters&&m.expectedCharacters.length>0&&e.jsxs("details",{className:"bg-violet-50 p-3 rounded border border-violet-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-violet-800",children:["üë• ",o==="de"?"Erwartete Charaktere":"Expected Characters"," (",m.expectedCharacters.length,")"]}),e.jsx("div",{className:"mt-2 grid grid-cols-1 gap-2 text-sm",children:m.expectedCharacters.map((j,C)=>e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-medium text-violet-700",children:j.name}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[j.description,j.position&&e.jsxs("span",{className:"ml-2 text-violet-500",children:["@ ",j.position]})]})]},C))})]}),m.expectedPositions&&Object.keys(m.expectedPositions).length>0&&e.jsxs("div",{className:"bg-purple-50 p-3 rounded border border-purple-200",children:[e.jsxs("div",{className:"font-medium text-purple-800 mb-2",children:["üìç ",o==="de"?"Erwartete Positionen":"Expected Positions"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:Object.entries(m.expectedPositions).map(([j,C])=>e.jsxs("div",{className:"bg-white p-2 rounded border flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-purple-700",children:j}),e.jsx("span",{className:"text-gray-600 text-xs",children:C})]},j))})]}),m.positionMismatches&&m.positionMismatches.length>0&&e.jsxs("div",{className:"bg-yellow-50 p-3 rounded border border-yellow-300",children:[e.jsxs("div",{className:"font-medium text-yellow-800 mb-2",children:["‚ö†Ô∏è ",o==="de"?"Positionsabweichungen":"Position Mismatches"," (",m.positionMismatches.length,")"]}),e.jsx("div",{className:"space-y-2",children:m.positionMismatches.map((j,C)=>e.jsxs("div",{className:"text-sm bg-white p-2 rounded border border-yellow-200",children:[e.jsx("div",{className:"font-medium text-yellow-700",children:j.character}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1 flex gap-3",children:[e.jsxs("span",{children:[o==="de"?"Erwartet":"Expected",": ",e.jsx("span",{className:"font-medium text-purple-600",children:j.expected}),e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",j.expectedLCR,")"]})]}),e.jsx("span",{className:"text-gray-400",children:"‚Üí"}),e.jsxs("span",{children:[o==="de"?"Erkannt":"Actual",": ",e.jsx("span",{className:"font-medium text-orange-600",children:j.actual})]})]})]},C))})]}),m.missingCharacters&&m.missingCharacters.length>0&&e.jsxs("div",{className:"bg-red-50 p-3 rounded border border-red-300",children:[e.jsxs("div",{className:"font-medium text-red-800 mb-2",children:["‚ùå ",o==="de"?"Fehlende Charaktere":"Missing Characters"," (",m.missingCharacters.length,")"]}),e.jsx("div",{className:"text-sm text-red-700",children:o==="de"?"Diese Charaktere wurden in der Szene erwartet, aber nicht im Bild gefunden:":"These characters were expected in the scene but not detected in the image:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:m.missingCharacters.map((j,C)=>e.jsx("span",{className:"bg-white px-2 py-1 rounded border border-red-200 text-sm font-medium text-red-700",children:j},C))})]}),m.expectedObjects&&m.expectedObjects.length>0&&e.jsxs("div",{className:"bg-indigo-50 p-3 rounded border border-indigo-200",children:[e.jsxs("div",{className:"font-medium text-indigo-800 mb-2",children:["üéØ ",o==="de"?"Erwartete Objekte":"Expected Objects"," (",m.expectedObjects.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:m.expectedObjects.map((j,C)=>{var X,O;const B=(X=m.matchedObjects)==null?void 0:X.find(se=>se.expected===j),U=(O=m.missingObjects)==null?void 0:O.includes(j);return e.jsxs("div",{className:`bg-white p-2 rounded border flex justify-between items-center ${U?"border-red-300":B?"border-green-300":""}`,children:[e.jsxs("span",{className:`font-medium ${U?"text-red-600":B?"text-green-600":"text-indigo-700"}`,children:[U?"‚ùå":B?"‚úì":"‚Ä¢"," ",j]}),B&&e.jsxs("span",{className:"text-xs text-gray-500 truncate ml-2",children:["‚Üí ",B.matched]})]},C)})})]}),m.missingObjects&&m.missingObjects.length>0&&!m.expectedObjects&&e.jsxs("div",{className:"bg-amber-50 p-3 rounded border border-amber-300",children:[e.jsxs("div",{className:"font-medium text-amber-800 mb-2",children:["‚ö†Ô∏è ",o==="de"?"Fehlende Objekte":"Missing Objects"," (",m.missingObjects.length,")"]}),e.jsx("div",{className:"text-sm text-amber-700",children:o==="de"?"Diese Objekte wurden in der Szene erwartet, aber nicht im Bild gefunden:":"These objects were expected in the scene but not detected in the image:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:m.missingObjects.map((j,C)=>e.jsx("span",{className:"bg-white px-2 py-1 rounded border border-amber-200 text-sm font-medium text-amber-700",children:j},C))})]}),m.figures&&m.figures.length>0&&e.jsxs("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[e.jsxs("div",{className:"font-medium text-green-800 mb-2",children:[o==="de"?"Figuren":"Figures"," (",m.figures.length,")",m.unknownFigures!==void 0&&m.unknownFigures>0&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 text-gray-700 px-1.5 py-0.5 rounded",children:[m.unknownFigures," ",o==="de"?"unbekannt":"unknown"]})]}),e.jsx("div",{className:"space-y-2",children:m.figures.map((j,C)=>{const B=j.name&&j.name!=="UNKNOWN",U=j.confidence==="high"?"text-green-600":j.confidence==="medium"?"text-yellow-600":"text-orange-600",X=j.confidence==="high"?"‚òÖ":j.confidence==="medium"?"‚óÜ":"‚óã";return e.jsxs("div",{className:`text-sm bg-white p-2 rounded border ${B?"border-green-300":"border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`font-medium ${B?"text-green-700":"text-gray-600"}`,children:B?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:U,children:X})," ",j.name]}):e.jsxs(e.Fragment,{children:["? ",j.label||`Figure ${C+1}`]})}),B&&j.confidence&&e.jsx("span",{className:`text-xs ${U}`,children:j.confidence})]}),B&&j.label&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:j.label}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1 grid grid-cols-2 gap-2",children:[j.bodyBox&&e.jsxs("span",{children:["Body: [",j.bodyBox.map(O=>(O*100).toFixed(0)+"%").join(", "),"]"]}),j.faceBox&&e.jsxs("span",{children:["Face: [",j.faceBox.map(O=>(O*100).toFixed(0)+"%").join(", "),"]"]}),j.position&&e.jsxs("span",{children:["Pos: ",j.position]})]})]},C)})})]}),m.objects&&m.objects.length>0&&e.jsxs("div",{className:"bg-orange-50 p-3 rounded border border-orange-200",children:[e.jsxs("div",{className:"font-medium text-orange-800 mb-2",children:[o==="de"?"Objekte":"Objects"," (",m.objects.length,")"]}),e.jsx("div",{className:"space-y-2",children:m.objects.map((j,C)=>{const B=!!j.name,U=j.found!==!1;return e.jsxs("div",{className:`text-sm bg-white p-2 rounded border ${B&&U?"border-green-300":B&&!U?"border-red-300":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`font-medium ${B&&U?"text-green-700":B&&!U?"text-red-600":"text-orange-700"}`,children:B?e.jsxs(e.Fragment,{children:[U?"‚úì":"‚úó"," ",j.name]}):j.label||`Object ${C+1}`}),B&&e.jsx("span",{className:`text-xs ${U?"text-green-600":"text-red-600"}`,children:U?o==="de"?"gefunden":"found":o==="de"?"fehlt":"missing"})]}),B&&j.label&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:j.label}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[j.bodyBox&&e.jsxs("span",{children:["Box: [",j.bodyBox.map(X=>(X*100).toFixed(0)+"%").join(", "),"]"]}),j.position&&e.jsxs("span",{className:"ml-2",children:["Pos: ",j.position]})]})]},C)})})]}),m.characterDescriptions&&Object.keys(m.characterDescriptions).length>0&&e.jsxs("details",{className:"bg-cyan-50 p-3 rounded border border-cyan-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-cyan-800",children:["üë§ ",o==="de"?"Charakter-Beschreibungen":"Character Descriptions"," (",Object.keys(m.characterDescriptions).length,")"]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:Object.entries(m.characterDescriptions).map(([j,C])=>e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("span",{className:"font-medium text-cyan-700",children:j}),e.jsxs("span",{className:"text-gray-600 ml-2",children:[C.genderTerm||C.gender||"?",", ",C.age?`${C.age}y`:"?",C.isChild?" (child)":C.isChild===!1?" (adult)":""]})]},j))})]}),m.rawPrompt&&e.jsxs("details",{className:"bg-gray-50 p-3 rounded border border-gray-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-gray-700",children:["üìù ",o==="de"?"Bbox-Prompt":"Bbox Prompt"]}),e.jsx("pre",{className:"mt-2 text-xs bg-white p-2 rounded border overflow-x-auto whitespace-pre-wrap max-h-48 overflow-y-auto",children:m.rawPrompt})]}),m.rawResponse&&e.jsxs("details",{className:"bg-gray-50 p-3 rounded border border-gray-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-gray-700",children:["üì§ ",o==="de"?"Bbox-Antwort":"Bbox Response"]}),e.jsx("pre",{className:"mt-2 text-xs bg-white p-2 rounded border overflow-x-auto whitespace-pre-wrap max-h-64 overflow-y-auto",children:m.rawResponse})]}),e.jsxs("button",{onClick:()=>ba(JSON.stringify(m,null,2),`object-detection-page-${L}.json`),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-1 bg-blue-50 rounded hover:bg-blue-100",children:[e.jsx(Be,{size:12})," ",o==="de"?"JSON herunterladen":"Download JSON"]})]})]})]})}function ks({referencePhotos:d,landmarkPhotos:k,visualBibleGrid:x,language:o,storyId:$,pageNumber:L}){var se;const[S,D]=A.useState(null),[b,y]=A.useState(null),[v,h]=A.useState(null),[z,H]=A.useState(!1),[m,c]=A.useState(null),T=d==null?void 0:d.some(f=>f.hasPhoto&&!f.photoUrl),n=k==null?void 0:k.some(f=>f.hasPhoto&&!f.photoData),F=A.useCallback(async()=>{if(!(!$||!L||z)&&!(!T&&!n)){H(!0),c(null);try{if(T){const f=await tt.getDevImage($,L,"reference");f!=null&&f.referencePhotos&&y(f.referencePhotos)}if(n){const f=await tt.getDevImage($,L,"landmark");f!=null&&f.landmarkPhotos&&h(f.landmarkPhotos)}}catch(f){c(f instanceof Error?f.message:"Failed to load images")}finally{H(!1)}}},[$,L,z,T,n]),Q=b||d,W=v||k,g=Q&&Q.length>0,q=W&&W.length>0,j=!!x;if(!g&&!q&&!j)return null;const C=((d==null?void 0:d.length)||0)+((k==null?void 0:k.length)||0)+(j?1:0),B=f=>{switch(f){case"bodyNoBg":case"body-no-bg":return o==="de"?"Ganzk√∂rper (freigestellt)":o==="fr"?"Corps entier (d√©tour√©)":"Full body (no bg)";case"body":return o==="de"?"Ganzk√∂rper":o==="fr"?"Corps entier":"Full body";case"face":return o==="de"?"Gesicht":o==="fr"?"Visage":"Face only";case"clothing-winter":return o==="de"?"Winter-Avatar":o==="fr"?"Avatar hiver":"Winter avatar";case"clothing-summer":return o==="de"?"Sommer-Avatar":o==="fr"?"Avatar √©t√©":"Summer avatar";case"clothing-formal":return o==="de"?"Formell-Avatar":o==="fr"?"Avatar formel":"Formal avatar";case"clothing-standard":return o==="de"?"Standard-Avatar":o==="fr"?"Avatar standard":"Standard avatar";case"none":return o==="de"?"Kein Foto":o==="fr"?"Pas de photo":"No photo";default:return f}},U=f=>{switch(f){case"bodyNoBg":case"body-no-bg":return"bg-green-100 text-green-700 border-green-300";case"body":return"bg-blue-100 text-blue-700 border-blue-300";case"face":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"clothing-winter":return"bg-cyan-100 text-cyan-700 border-cyan-300";case"clothing-summer":return"bg-orange-100 text-orange-700 border-orange-300";case"clothing-formal":return"bg-purple-100 text-purple-700 border-purple-300";case"clothing-standard":return"bg-teal-100 text-teal-700 border-teal-300";case"none":return"bg-red-100 text-red-700 border-red-300";default:return"bg-gray-100 text-gray-700 border-gray-300"}},X=(se=Q==null?void 0:Q.find(f=>f.clothingCategory))==null?void 0:se.clothingCategory,O=f=>{if(!f)return"";switch(f){case"winter":return o==="de"?"Winter":o==="fr"?"Hiver":"Winter";case"summer":return o==="de"?"Sommer":o==="fr"?"√ât√©":"Summer";case"formal":return o==="de"?"Formell":o==="fr"?"Formel":"Formal";case"standard":return"Standard";default:return f}};return e.jsxs("details",{className:"bg-pink-50 border border-pink-300 rounded-lg p-3",onToggle:f=>{f.target.open&&(T||n)&&F()},children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-900 flex items-center gap-2",children:[e.jsx("span",{children:"üì∏"}),o==="de"?"Referenzfotos":o==="fr"?"Photos de r√©f√©rence":"Reference Photos",e.jsxs("span",{className:"text-xs text-pink-600",children:["(",C,")"]}),X&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-pink-200 text-pink-800 text-xs rounded",children:["üëï ",O(X)]}),q&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-amber-200 text-amber-800 text-xs rounded",children:["üìç ",W.length," ",o==="de"?"Wahrzeichen":"Landmark"]}),j&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-indigo-200 text-indigo-800 text-xs rounded",children:"üî≤ VB Grid"}),z&&e.jsx("span",{className:"ml-2 text-xs text-gray-500 animate-pulse",children:"Loading..."})]}),m&&e.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-50 p-2 rounded",children:m}),g&&e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2",children:Q.map((f,Z)=>e.jsxs("div",{className:"bg-white rounded-lg p-2 border border-pink-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:f.name}),f.photoType&&e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap ${U(f.photoType)}`,children:B(f.photoType)})]}),f.photoUrl?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:f.photoUrl,alt:`${f.name} - ${B(f.photoType||"unknown")}`,className:`w-full max-h-32 object-contain rounded border bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity ${f.isStyled?"border-purple-400 ring-2 ring-purple-200":"border-gray-200"}`,onClick:()=>D(f.photoUrl),title:"Click to enlarge"}),f.isStyled&&e.jsx("span",{className:"absolute top-1 right-1 px-1 py-0.5 text-[9px] font-bold bg-purple-500 text-white rounded",children:"üé® STYLED"})]}),f.photoHash&&e.jsxs("div",{className:"mt-1 text-[9px] font-mono text-gray-500 bg-gray-100 px-1 py-0.5 rounded text-center",children:["üîê ",f.photoHash]})]}):e.jsx("div",{className:"text-xs text-gray-500 italic py-2 text-center bg-gray-100 rounded",children:o==="de"?"Foto nicht geladen":"Photo not loaded"})]},Z))}),q&&e.jsxs("div",{className:g?"mt-4 pt-3 border-t border-pink-200":"mt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-amber-700 mb-2 flex items-center gap-1",children:["üìç ",o==="de"?"Wahrzeichen-Referenzfotos":o==="fr"?"Photos de monuments":"Landmark Reference Photos"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:W.map((f,Z)=>e.jsxs("div",{className:"bg-amber-50 rounded-lg p-2 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:f.name}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap bg-amber-100 text-amber-700 border-amber-300",children:"üìç LANDMARK"})]}),f.photoData?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:f.photoData,alt:`${f.name} landmark`,className:"w-full max-h-32 object-contain rounded border border-amber-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>D(f.photoData),title:"Click to enlarge"})}),f.attribution&&e.jsxs("div",{className:"mt-1 text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 rounded truncate",title:f.attribution,children:["üì∑ ",f.attribution]}),f.source&&e.jsxs("div",{className:"mt-0.5 text-[9px] text-gray-400",children:["Source: ",f.source]})]}):e.jsx("div",{className:"text-xs text-gray-500 italic py-2 text-center bg-gray-100 rounded",children:o==="de"?"Foto nicht geladen":"Photo not loaded"})]},Z))})]}),j&&e.jsxs("div",{className:g||q?"mt-4 pt-3 border-t border-pink-200":"mt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-indigo-700 mb-2 flex items-center gap-1",children:["üî≤ ",o==="de"?"Visual Bible Referenzgitter":o==="fr"?"Grille Visual Bible":"Visual Bible Reference Grid"]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-2 border border-indigo-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800",children:o==="de"?"Kombinierte Referenzen":o==="fr"?"R√©f√©rences combin√©es":"Combined References"}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap bg-indigo-100 text-indigo-700 border-indigo-300",children:"üî≤ VB GRID"})]}),e.jsx("div",{className:"text-[10px] text-gray-500 mb-2",children:o==="de"?"Sekund√§re Charaktere, Tiere, Artefakte, Fahrzeuge und zus√§tzliche Wahrzeichen":o==="fr"?"Personnages secondaires, animaux, artefacts, v√©hicules et monuments suppl√©mentaires":"Secondary characters, animals, artifacts, vehicles, and additional landmarks"}),e.jsx("img",{src:x,alt:"Visual Bible Reference Grid",className:"w-full max-h-64 object-contain rounded border border-indigo-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>D(x),title:"Click to enlarge"})]})]}),e.jsx(ia,{src:S,onClose:()=>D(null)})]})}function fa({pageNumber:d,scene:k,onSceneChange:x,onClose:o,onRegenerate:$,isRegenerating:L,imageRegenerationCost:S,characters:D=[],selectedCharacterIds:b=[],onCharacterSelectionChange:y,consistencyRegen:v}){const{language:h}=rt(),[z,H]=A.useState(!1),[m,c]=A.useState(!1),T=n=>{y&&(b.includes(n)?y(b.filter(F=>F!==n)):y([...b,n]))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ie,{size:20}),h==="de"?`Szene bearbeiten - Seite ${d}`:h==="fr"?`Modifier la sc√®ne - Page ${d}`:`Edit Scene - Page ${d}`]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:h==="de"?"Bearbeiten Sie die Szenenbeschreibung und w√§hlen Sie die Charaktere aus.":h==="fr"?"Modifiez la description de la sc√®ne et s√©lectionnez les personnages.":"Edit the scene description and select the characters."})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[D.length>0&&y&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(jt,{size:16}),h==="de"?"Charaktere in dieser Szene:":h==="fr"?"Personnages dans cette sc√®ne:":"Characters in this scene:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:D.map(n=>{const F=b.includes(n.id);return e.jsxs("button",{type:"button",onClick:()=>T(n.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${F?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{className:"font-medium",children:n.name}),F&&e.jsx("span",{className:"text-indigo-500",children:"‚úì"})]},n.id)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:h==="de"?"W√§hlen Sie die Charaktere aus, die im Bild erscheinen sollen.":h==="fr"?"S√©lectionnez les personnages qui doivent appara√Ætre dans l'image.":"Select the characters that should appear in the image."})]}),v&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ta,{className:"text-amber-600",size:20}),e.jsx("h4",{className:"font-semibold text-amber-800",children:h==="de"?"Konsistenz-Korrektur angewendet":h==="fr"?"Correction de coh√©rence appliqu√©e":"Consistency Fix Applied"}),e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded",children:["Score: ",v.score,"%"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-amber-700 mb-2",children:h==="de"?"Behobene Probleme:":h==="fr"?"Probl√®mes corrig√©s:":"Issues Fixed:"}),e.jsx("ul",{className:"text-sm text-amber-900 space-y-1",children:v.issues.map((n,F)=>e.jsxs("li",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[n.type.toUpperCase(),n.characterInvolved&&` (${n.characterInvolved})`,":"]}),e.jsx("span",{className:"text-amber-700 ml-2",children:n.description}),e.jsxs("span",{className:"text-amber-600 ml-2 text-xs",children:["‚Üí ",n.recommendation]})]},F))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1 text-center",children:"Original"}),e.jsx("img",{src:v.originalImage,alt:"Original",className:"w-full rounded-lg border border-gray-300",draggable:!1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-600 mb-1 text-center",children:h==="de"?"Korrigiert":h==="fr"?"Corrig√©":"Fixed"}),e.jsx("img",{src:v.fixedImage,alt:"Fixed",className:"w-full rounded-lg border-2 border-green-500",draggable:!1})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>H(!z),className:"flex items-center gap-1 text-xs text-gray-600 hover:text-gray-800",children:[z?e.jsx(wr,{size:14}):e.jsx(Me,{size:14}),h==="de"?"Original-Prompt":h==="fr"?"Prompt original":"Original Prompt"]}),z&&e.jsx("pre",{className:"text-xs bg-gray-100 p-2 rounded overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:v.originalPrompt}),e.jsxs("button",{onClick:()=>c(!m),className:"flex items-center gap-1 text-xs text-green-600 hover:text-green-800",children:[m?e.jsx(wr,{size:14}):e.jsx(Me,{size:14}),h==="de"?"Korrigierter Prompt (mit Korrekturen)":h==="fr"?"Prompt corrig√© (avec corrections)":"Fixed Prompt (with corrections)"]}),m&&e.jsx("pre",{className:"text-xs bg-green-50 p-2 rounded border border-green-200 overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:v.fixedPrompt})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xs text-gray-400",children:h==="de"?`Korrigiert am ${new Date(v.timestamp).toLocaleString()}`:h==="fr"?`Corrig√© le ${new Date(v.timestamp).toLocaleString()}`:`Fixed at ${new Date(v.timestamp).toLocaleString()}`}),v.clothing&&e.jsxs("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded",children:["üé® ",v.clothing]})]}),v.avatarsUsed&&v.avatarsUsed.length>0&&e.jsxs("div",{className:"mt-3 p-2 bg-blue-50 rounded border border-blue-200",children:[e.jsx("p",{className:"text-xs font-medium text-blue-700 mb-1",children:h==="de"?"Verwendete Avatare:":h==="fr"?"Avatars utilis√©s:":"Avatars used:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.avatarsUsed.map((n,F)=>e.jsxs("span",{className:`text-xs px-2 py-1 rounded ${n.hasPhoto?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:[n.name,n.category&&n.category!=="standard"&&e.jsxs("span",{className:"ml-1 opacity-75",children:["(",n.category,")"]}),!n.hasPhoto&&" ‚ö†Ô∏è"]},F))})]}),v.retryHistory&&v.retryHistory.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(as,{retryHistory:v.retryHistory,totalAttempts:v.totalAttempts||1,language:h})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:h==="de"?"Szenenbeschreibung:":h==="fr"?"Description de la sc√®ne:":"Scene description:"}),e.jsx("textarea",{value:k,onChange:n=>x(n.target.value),className:"w-full h-40 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y",placeholder:h==="de"?"Beschreiben Sie die Szene...":h==="fr"?"D√©crivez la sc√®ne...":"Describe the scene..."}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:h==="de"?"Tipp: Beschreiben Sie die Aktionen und die Umgebung. Die ausgew√§hlten Charaktere werden automatisch hinzugef√ºgt.":h==="fr"?"Conseil: D√©crivez les actions et l'environnement. Les personnages s√©lectionn√©s seront ajout√©s automatiquement.":"Tip: Describe the actions and the environment. Selected characters will be added automatically."})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:b.length>0&&e.jsx("span",{children:h==="de"?`${b.length} Charakter(e) ausgew√§hlt`:h==="fr"?`${b.length} personnage(s) s√©lectionn√©(s)`:`${b.length} character(s) selected`})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:o,disabled:L,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700 font-medium disabled:opacity-50 order-2 sm:order-1",children:h==="de"?"Abbrechen":h==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:$,disabled:L||!k.trim(),className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 order-1 sm:order-2 ${L||!k.trim()?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:L?e.jsxs(e.Fragment,{children:[e.jsx(Se,{size:16,className:"animate-spin"}),h==="de"?"Generiere...":h==="fr"?"G√©n√©ration...":"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{size:16}),h==="de"?"Neu generieren":h==="fr"?"R√©g√©n√©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",S,")"]})]})})]})]})]})})}const ja={frontCover:{en:"Front Cover",de:"Titelseite",fr:"Couverture"},initialPage:{en:"Dedication Page",de:"Widmungsseite",fr:"Page de d√©dicace"},backCover:{en:"Back Cover",de:"R√ºckseite",fr:"Quatri√®me de couverture"}};function kr({pageNumber:d,coverType:k,versions:x,onClose:o,onSelectVersion:$,developerMode:L=!1}){const{language:S}=rt(),D=()=>{if(k){const y=ja[k],v=S==="de"?y.de:S==="fr"?y.fr:y.en;return S==="de"?`Bildversionen - ${v}`:S==="fr"?`Versions d'image - ${v}`:`Image Versions - ${v}`}return S==="de"?`Bildversionen - Seite ${d}`:S==="fr"?`Versions d'image - Page ${d}`:`Image Versions - Page ${d}`},b=y=>{k?$(k,y):d!==void 0&&$(d,y)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(fe,{size:20}),D()]}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Ce,{size:20})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:x.map((y,v)=>e.jsxs("div",{className:`relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${y.isActive?"border-green-500 ring-2 ring-green-200":"border-gray-200 hover:border-indigo-300"}`,onClick:()=>b(v),children:[e.jsx("img",{src:y.imageData,alt:`Version ${v+1}`,className:"w-full aspect-square object-cover"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:v===0?"Original":`V${v+1}`}),e.jsxs("div",{className:"flex items-center gap-1",children:[L&&y.qualityScore!=null&&e.jsxs("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold ${y.qualityScore>=80?"bg-green-600":y.qualityScore>=60?"bg-yellow-600":"bg-red-600"}`,children:[y.qualityScore,"%"]}),y.isActive&&e.jsx("span",{className:"bg-green-500 px-2 py-0.5 rounded text-[10px] font-bold",children:S==="de"?"Aktiv":S==="fr"?"Actif":"Active"})]})]}),e.jsx("div",{className:"text-[10px] text-gray-300 mt-1",children:new Date(y.createdAt).toLocaleDateString()})]})]},v))}),L&&x.length>1&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-700",children:S==="de"?"Szenen- und Prompt-Vergleich":S==="fr"?"Comparaison de sc√®nes et prompts":"Scene & Prompt Comparison"}),x.map((y,v)=>e.jsxs("details",{className:`rounded-lg p-3 ${y.isActive?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-medium text-gray-700",children:[v===0?"Original":`V${v+1}`,y.isActive&&e.jsx("span",{className:"ml-2 text-green-600 text-xs",children:"(Active)"})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[y.userInput&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-purple-700",children:S==="de"?"Benutzer-Eingabe:":S==="fr"?"Entr√©e utilisateur:":"User Input:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-purple-50 p-2 rounded border border-purple-200 max-h-24 overflow-y-auto",children:y.userInput})]}),y.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-amber-700",children:S==="de"?"Erweiterte Szene:":S==="fr"?"Sc√®ne √©tendue:":"Expanded Scene:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-24 overflow-y-auto",children:y.description})]}),y.prompt&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-blue-700",children:S==="de"?"API-Prompt:":S==="fr"?"Prompt API:":"API Prompt:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-32 overflow-y-auto",children:y.prompt})]}),y.modelId&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Model: ",y.modelId]}),y.qualityScore!=null&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Quality:"}),e.jsxs("span",{className:`text-xs font-bold ${y.qualityScore>=80?"text-green-600":y.qualityScore>=60?"text-yellow-600":"text-red-600"}`,children:[y.qualityScore,"%"]}),y.totalAttempts!=null&&y.totalAttempts>1&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",y.totalAttempts," attempts)"]})]}),y.qualityReasoning&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700",children:"Quality Reasoning:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-24 overflow-y-auto",children:y.qualityReasoning})]}),y.fixTargets&&y.fixTargets.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-semibold text-orange-700",children:["Fix Targets (",y.fixTargets.length,"):"]}),e.jsx("ul",{className:"text-xs text-gray-600 list-disc list-inside",children:y.fixTargets.map((h,z)=>e.jsx("li",{children:h.issue},z))})]}),y.referencePhotoNames&&y.referencePhotoNames.length>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Avatars: ",y.referencePhotoNames.map(h=>h.name).join(", ")]})]})]},v))]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 text-sm text-gray-500",children:S==="de"?"Klicken Sie auf ein Bild, um es auszuw√§hlen":S==="fr"?"Cliquez sur une image pour la s√©lectionner":"Click an image to select it"})]})})}function ya({src:d,title:k,onClose:x}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:x,children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] bg-white rounded-lg overflow-hidden",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:k}),e.jsx("button",{onClick:x,className:"text-gray-500 hover:text-gray-700 p-1",children:e.jsx(Ce,{size:20})})]}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsx("img",{src:d,alt:k,className:"max-w-full max-h-[80vh] object-contain mx-auto"})})]})})}function Na({beforeImage:d,afterImage:k,diffImage:x,title:o,onClose:$}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:$,children:e.jsxs("div",{className:"relative bg-white rounded-lg overflow-hidden max-w-[95vw] max-h-[95vh]",onClick:L=>L.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-3 flex items-center justify-between border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:o}),e.jsx("button",{onClick:$,className:"text-gray-500 hover:text-gray-700 p-1",children:e.jsx(Ce,{size:20})})]}),e.jsx("div",{className:"p-4 bg-gray-50 overflow-auto max-h-[calc(95vh-60px)]",children:e.jsxs("div",{className:`grid gap-4 ${x?"grid-cols-1 lg:grid-cols-3":"grid-cols-1 lg:grid-cols-2"}`,children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 mb-2 bg-red-100 px-3 py-1 rounded-full",children:"Before"}),e.jsx("img",{src:d,alt:"Before repair",className:"max-w-full max-h-[70vh] object-contain border rounded shadow-sm"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 mb-2 bg-green-100 px-3 py-1 rounded-full",children:"After"}),e.jsx("img",{src:k,alt:"After repair",className:"max-w-full max-h-[70vh] object-contain border rounded shadow-sm"})]}),x&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 mb-2 bg-purple-100 px-3 py-1 rounded-full",children:"Diff (changes in magenta)"}),e.jsx("img",{src:x,alt:"Difference",className:"max-w-full max-h-[70vh] object-contain border rounded shadow-sm"})]})]})})]})})}const Pr={en:{adventure:"Adventure","life-challenge":"Life Challenge",educational:"Educational",historical:"Historical"},de:{adventure:"Abenteuer","life-challenge":"Lebensherausforderung",educational:"Bildung",historical:"Historisch"},fr:{adventure:"Aventure","life-challenge":"D√©fi de vie",educational:"√âducatif",historical:"Historique"}},Ir={en:{"1st-grade":"Picture Book (1st Grade)",standard:"Standard",advanced:"Advanced"},de:{"1st-grade":"Bilderbuch (1. Klasse)",standard:"Standard",advanced:"Fortgeschritten"},fr:{"1st-grade":"Livre illustr√© (1√®re ann√©e)",standard:"Standard",advanced:"Avanc√©"}},va={"de-CH":"Schweizerdeutsch","de-DE":"Deutsch (Deutschland)",en:"English",fr:"Fran√ßais"};function wa({settings:d,language:k}){var H,m;const[x,o]=A.useState(!1),$=c=>{const T={en:{title:"Story Info",category:"Category",topic:"Topic",theme:"Theme",storyType:"Story Type",storyDetails:"Story Idea",artStyle:"Art Style",language:"Language",readingLevel:"Reading Level",pages:"Length",dedication:"Dedication",mainCharacters:"Main Characters",otherCharacters:"Other Characters",relationships:"Relationships",season:"Season",location:"Location",noData:"Not specified",spring:"Spring",summer:"Summer",autumn:"Autumn",winter:"Winter"},de:{title:"Story-Info",category:"Kategorie",topic:"Thema",theme:"Thema",storyType:"Story-Typ",storyDetails:"Story-Idee",artStyle:"Kunststil",language:"Sprache",readingLevel:"Lesestufe",pages:"L√§nge",dedication:"Widmung",mainCharacters:"Hauptfiguren",otherCharacters:"Andere Figuren",relationships:"Beziehungen",season:"Jahreszeit",location:"Ort",noData:"Nicht angegeben",spring:"Fr√ºhling",summer:"Sommer",autumn:"Herbst",winter:"Winter"},fr:{title:"Info histoire",category:"Cat√©gorie",topic:"Sujet",theme:"Th√®me",storyType:"Type d'histoire",storyDetails:"Id√©e d'histoire",artStyle:"Style artistique",language:"Langue",readingLevel:"Niveau de lecture",pages:"Longueur",dedication:"D√©dicace",mainCharacters:"Personnages principaux",otherCharacters:"Autres personnages",relationships:"Relations",season:"Saison",location:"Lieu",noData:"Non sp√©cifi√©",spring:"Printemps",summer:"√ât√©",autumn:"Automne",winter:"Hiver"}};return(T[k]||T.en)[c]||c},L=c=>(Pr[k]||Pr.en)[c]||c,S=c=>(Ir[k]||Ir.en)[c]||c,D=(c,T)=>c==null||c===""?e.jsx("span",{className:"text-gray-400 italic",children:$("noData")}):e.jsx("span",{className:"text-gray-800",children:c}),b=d.mainCharacters||[],y=((H=d.characters)==null?void 0:H.filter(c=>b.includes(c.id)))||[],v=((m=d.characters)==null?void 0:m.filter(c=>!b.includes(c.id)))||[],h=c=>$(c)||c,z=()=>{if(!d.userLocation)return null;const c=[d.userLocation.city,d.userLocation.region,d.userLocation.country].filter(Boolean);return c.length>0?c.join(", "):null};return e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>o(!x),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-amber-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ra,{size:16,className:"text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-800",children:$("title")}),e.jsx("span",{className:"text-xs bg-amber-200 text-amber-700 px-2 py-0.5 rounded",children:"DEV"})]}),x?e.jsx(Me,{size:18,className:"text-amber-600"}):e.jsx(bt,{size:18,className:"text-amber-600"})]}),x&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[y.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(ut,{size:12}),$("mainCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map(c=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-indigo-100 text-indigo-800 border border-indigo-200",children:[e.jsx(ut,{size:10}),e.jsx("span",{children:c.name})]},c.id))})]}),v.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(jt,{size:12}),$("otherCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(c=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700 border border-gray-200",children:[e.jsx(ut,{size:10}),e.jsx("span",{children:c.name})]},c.id))})]}),d.relationships&&Object.keys(d.relationships).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-2",children:$("relationships")}),e.jsx("div",{className:"text-xs bg-white/50 p-2 rounded border border-amber-100 space-y-1",children:Object.entries(d.relationships).map(([c,T])=>{var g,q;const[n,F]=c.split("-").map(j=>parseInt(j,10)),Q=(g=d.characters)==null?void 0:g.find(j=>j.id===n),W=(q=d.characters)==null?void 0:q.find(j=>j.id===F);return!Q||!W?null:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-amber-600 font-medium whitespace-nowrap",children:[Q.name," ‚Üí ",W.name,":"]}),e.jsx("span",{className:"text-gray-700",children:T})]},c)})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(ca,{size:12}),$("language")]}),e.jsx("div",{className:"text-sm",children:d.language?va[d.language]||d.language:D(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:$("readingLevel")}),e.jsx("div",{className:"text-sm",children:d.languageLevel?S(d.languageLevel):D(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:$("pages")}),e.jsx("div",{className:"text-sm",children:d.pages?`${d.pages} ${k==="de"?"Seiten":"pages"}`:D(void 0)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:$("season")}),e.jsx("div",{className:"text-sm",children:d.season?h(d.season):D(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:$("location")}),e.jsx("div",{className:"text-sm",children:z()||D(void 0)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(na,{size:12}),$("artStyle")]}),e.jsx("div",{className:"text-sm capitalize",children:D(d.artStyle)})]})]}),d.storyDetails&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(rs,{size:12}),$("storyDetails")]}),e.jsx("div",{className:"text-sm bg-white/50 p-2 rounded border border-amber-100 whitespace-pre-wrap",children:d.storyDetails})]}),(d.storyCategory||d.storyTheme||d.storyTopic)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-amber-100",children:[d.storyCategory&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(la,{size:12}),$("category")]}),e.jsx("div",{className:"text-sm",children:L(d.storyCategory)})]}),(d.storyTheme||d.storyTopic)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:d.storyCategory==="adventure"?$("theme"):$("topic")}),e.jsx("div",{className:"text-sm",children:d.storyCategory==="adventure"?d.storyTheme:d.storyTopic})]})]})]})]})}function Ar({storyId:d,onShareStatusChange:k,variant:x="compact"}){const{language:o}=rt(),[$,L]=A.useState(!1),[S,D]=A.useState(null),[b,y]=A.useState(!1),[v,h]=A.useState(!1),[z,H]=A.useState(null),m=x==="full",c={share:o==="de"?"Teilen":o==="fr"?"Partager":"Share",shareStory:o==="de"?"Geschichte teilen":o==="fr"?"Partager l'histoire":"Share Story",enableSharing:o==="de"?"Link aktivieren":o==="fr"?"Activer le lien":"Enable sharing",disableSharing:o==="de"?"Link deaktivieren":o==="fr"?"D√©sactiver le lien":"Disable sharing",copyLink:o==="de"?"Link kopieren":o==="fr"?"Copier le lien":"Copy link",copied:o==="de"?"Kopiert!":o==="fr"?"Copi√©!":"Copied!",shareWhatsApp:o==="de"?"Per WhatsApp teilen":o==="fr"?"Partager sur WhatsApp":"Share on WhatsApp",sharingEnabled:o==="de"?"Teilen aktiv":o==="fr"?"Partage actif":"Sharing enabled",sharingDisabled:o==="de"?"Teilen inaktiv":o==="fr"?"Partage inactif":"Sharing disabled",anyoneWithLink:o==="de"?"Jeder mit dem Link kann die Geschichte lesen":o==="fr"?"Toute personne avec le lien peut lire l'histoire":"Anyone with the link can read the story",errorLoading:o==="de"?"Fehler beim Laden":o==="fr"?"Erreur de chargement":"Error loading"};A.useEffect(()=>{$&&!S&&T()},[$]);const T=async()=>{y(!0),H(null);try{const W=localStorage.getItem("auth_token"),g=await fetch(`/api/stories/${d}/share-status`,{headers:W?{Authorization:`Bearer ${W}`}:{}});if(!g.ok)throw new Error("Failed to fetch status");const q=await g.json();D(q)}catch{H(c.errorLoading)}finally{y(!1)}},n=async()=>{y(!0),H(null);try{const g=(S==null?void 0:S.isShared)?"DELETE":"POST",q=localStorage.getItem("auth_token"),j=await fetch(`/api/stories/${d}/share`,{method:g,headers:q?{Authorization:`Bearer ${q}`}:{}});if(!j.ok)throw new Error("Failed to toggle sharing");const C=await j.json();D({isShared:C.isShared,shareToken:C.shareToken,shareUrl:C.shareUrl}),k==null||k(C.isShared)}catch{H("Failed to update sharing")}finally{y(!1)}},F=async()=>{if(S!=null&&S.shareUrl)try{await navigator.clipboard.writeText(S.shareUrl),h(!0),setTimeout(()=>h(!1),2e3)}catch{const g=document.createElement("textarea");g.value=S.shareUrl,document.body.appendChild(g),g.select(),document.execCommand("copy"),document.body.removeChild(g),h(!0),setTimeout(()=>h(!1),2e3)}},Q=()=>{if(!(S!=null&&S.shareUrl))return;const W=encodeURIComponent(S.shareUrl);window.open(`https://wa.me/?text=${W}`,"_blank")};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>L(!$),className:m?"bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full hover:bg-indigo-600":"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-lg hover:from-blue-600 hover:to-indigo-600 transition-all shadow-md hover:shadow-lg",title:c.share,children:[e.jsx($r,{className:"w-4 h-4"}),e.jsx("span",{className:m?"":"hidden sm:inline",children:c.share}),(S==null?void 0:S.isShared)&&e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]}),$&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>L(!1)}),e.jsxs("div",{className:"fixed inset-x-4 bottom-4 sm:absolute sm:inset-auto sm:right-0 sm:bottom-auto sm:mt-2 w-auto sm:w-80 bg-white rounded-xl shadow-xl border border-gray-200 z-50 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx($r,{className:"w-5 h-5 text-blue-600"}),c.shareStory]})}),e.jsx("div",{className:"p-4 space-y-4",children:b&&!S?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(de,{className:"w-6 h-6 animate-spin text-blue-500"})}):z?e.jsx("div",{className:"text-red-500 text-sm py-2",children:z}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[S!=null&&S.isShared?e.jsx(ma,{className:"w-5 h-5 text-green-500"}):e.jsx(xa,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:S!=null&&S.isShared?"text-green-700":"text-gray-600",children:S!=null&&S.isShared?c.sharingEnabled:c.sharingDisabled})]}),e.jsx("button",{onClick:n,disabled:b,className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${S!=null&&S.isShared?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"} disabled:opacity-50`,children:b?e.jsx(de,{className:"w-4 h-4 animate-spin"}):S!=null&&S.isShared?c.disableSharing:c.enableSharing})]}),(S==null?void 0:S.isShared)&&S.shareUrl&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500",children:c.anyoneWithLink}),e.jsx("button",{onClick:F,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:v?e.jsxs(e.Fragment,{children:[e.jsx(oa,{className:"w-4 h-4 text-green-500"}),c.copied]}):e.jsxs(e.Fragment,{children:[e.jsx(da,{className:"w-4 h-4"}),c.copyLink]})}),e.jsxs("button",{onClick:Q,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors",children:[e.jsx(pa,{className:"w-4 h-4"}),c.shareWhatsApp]})]})]})})]})]})]})}function Ga({title:d,dedication:k,story:x,outline:o,outlinePrompt:$,outlineModelId:L,outlineUsage:S,storyTextPrompts:D=[],visualBible:b,sceneImages:y,sceneDescriptions:v=[],coverImages:h,regeneratingCovers:z=new Set,languageLevel:H="standard",storyLanguage:m,isGenerating:c=!1,onDownloadPdf:T,onAddToBook:n,onPrintBook:F,onCreateAnother:Q,onDownloadTxt:W,onRegenerateImage:g,onRegenerateCover:q,characters:j=[],onEditImage:C,onEditCover:B,onRepairImage:U,onIteratePage:X,onRevertRepair:O,onVisualBibleChange:se,storyId:f,developerMode:Z=!1,styledAvatarGeneration:ce=[],costumedAvatarGeneration:xe=[],generationLog:ne=[],finalChecksReport:w,clothingRequirements:je,isPartial:Is=!1,failureReason:is,generatedPages:Ve,totalPages:_e,progressiveMode:ye=!1,progressiveData:qe,completedPageImages:yt={},originalStory:As,onSaveStoryText:zs,onSaveTitleChange:at,userCredits:Nt=0,imageRegenerationCost:ke=5,isImpersonating:zr=!1,onSelectImageVersion:vt,onSelectCoverVersion:wt,generationSettings:St,onRefreshStory:He}){var Ht,Wt,Ut,Kt,Jt,Qt,Zt,Yt,Xt,Gt,er,sr,tr;const{t:Dr,language:t}=rt(),_=m?m.startsWith("de")?"de":m:t,te=zr||Nt===-1||Nt>=ke,[V,it]=A.useState(null),[ge,Oe]=A.useState(""),[We,Ds]=A.useState(!1),[Os,Rs]=A.useState(x),[ns,Ct]=A.useState(!1),[nt,Fs]=A.useState(!1),[Ls,Es]=A.useState(d||""),[lt,$t]=A.useState(!1),[ot,Ts]=A.useState(null),[dt,ls]=A.useState(null),[me,os]=A.useState(null),[,kt]=A.useState(!1),[Ne,ct]=A.useState(new Set),[K,Re]=A.useState(null),[he,Pt]=A.useState(null),[Ue,It]=A.useState(null),[ds,At]=A.useState(null),[re,zt]=A.useState(null),[Fe,Dt]=A.useState(null),[Bs,Le]=A.useState(null),[Ke,Ms]=A.useState(!1),[xt,G]=A.useState(null),[cs,Vs]=A.useState(null),[Je,_s]=A.useState("square"),[Qe,qs]=A.useState(!1),[Hs,Or]=A.useState({}),[Ze,Ot]=A.useState(new Set),Rt=async s=>{if(!(!f||Hs[s]||Ze.has(s))){Ot(i=>new Set(i).add(s));try{const i=localStorage.getItem("auth_token"),a=await fetch(`/api/stories/${f}/visual-bible-image/${s}`,{headers:i?{Authorization:`Bearer ${i}`}:{}});if(a.ok){const l=await a.json();Or(r=>({...r,[s]:l.imageData}))}}catch(i){console.error(`Failed to load reference image for ${s}:`,i)}finally{Ot(i=>{const a=new Set(i);return a.delete(s),a})}}},xs=(s,i)=>{if(!i||!Z)return null;const a=Hs[s],l=Ze.has(s);return a?e.jsx("img",{src:a,alt:"Reference",className:"w-16 h-16 object-cover rounded border border-rose-300 cursor-pointer hover:opacity-80",onClick:()=>G({src:a,title:"Reference Image"})}):e.jsx("button",{onClick:()=>Rt(s),disabled:l,className:"w-16 h-16 flex items-center justify-center bg-rose-100 border border-rose-300 rounded text-rose-500 hover:bg-rose-200 disabled:opacity-50",title:"Load reference image",children:l?e.jsx(de,{size:16,className:"animate-spin"}):e.jsx(fe,{size:16})})},[Ee,Rr]=A.useState({}),[Pe,Ft]=A.useState(new Set),mt=async(s,i)=>{const a=`${s}-${i}`;if(!(!f||Ee[a]||Pe.has(a))){Ft(l=>new Set(l).add(a));try{const l=await tt.getAvatarGenerationImage(f,s,i);l&&Rr(r=>({...r,[a]:l}))}catch(l){console.error(`Failed to load avatar generation images for ${a}:`,l)}finally{Ft(l=>{const r=new Set(l);return r.delete(a),r})}}},Fr=async()=>{if(!f||!ce)return;const s=ce.map((i,a)=>a).filter(i=>!Ee[`styled-${i}`]&&!Pe.has(`styled-${i}`));await Promise.all(s.map(i=>mt("styled",i)))},Lr=async()=>{if(!f||!xe)return;const s=xe.map((i,a)=>a).filter(i=>!Ee[`costumed-${i}`]&&!Pe.has(`costumed-${i}`));await Promise.all(s.map(i=>mt("costumed",i)))},Er=async()=>{if(!f||!b)return;const i=[...b.secondaryCharacters||[],...b.animals||[],...b.artifacts||[],...b.locations||[],...b.vehicles||[]].filter(a=>a.hasReferenceImage&&!Hs[a.id]&&!Ze.has(a.id)).map(a=>a.id);await Promise.all(i.map(a=>Rt(a)))},[ms,Tr]=A.useState({}),[ps,Lt]=A.useState(new Set),Et=async s=>{if(!(!f||ms[s]!==void 0||ps.has(s))){Lt(i=>new Set(i).add(s));try{const i=await tt.getEntityGridImageByIndex(f,s);i!=null&&i.gridImage&&Tr(a=>({...a,[s]:i.gridImage}))}catch(i){console.error(`Failed to load entity grid image for index ${s}:`,i)}finally{Lt(i=>{const a=new Set(i);return a.delete(s),a})}}},Br=async()=>{var a;if(!f)return;const i=(((a=w==null?void 0:w.entity)==null?void 0:a.grids)||[]).map((l,r)=>({grid:l,idx:r})).filter(({grid:l,idx:r})=>!l.gridImage&&ms[r]===void 0).map(({idx:l})=>l);await Promise.all(i.map(l=>Et(l)))},Mr=async(s,i,a)=>new Promise((l,r)=>{const N=new Image;N.onload=()=>{const p=document.createElement("canvas"),R=p.getContext("2d");if(!R){r(new Error("Could not get canvas context"));return}const{cellSize:I,cols:J}=a,Y=Math.floor(i/J),le=i%J*I,oe=Y*I;p.width=I,p.height=I,R.drawImage(N,le,oe,I,I,0,0,I,I),l(p.toDataURL("image/png"))},N.onerror=()=>r(new Error("Failed to load grid image")),N.src=s}),Vr=async(s,i)=>{try{const a=s.manifest.cells[i],l=await Mr(s.gridImage,i,s.manifest),r=a.isReference?"Reference":`Page ${a.pageNumber}`,N=a.clothing&&a.clothing!=="standard"?` (${a.clothing})`:"";G({src:l,title:`${s.entityName} - ${r}${N}`})}catch(a){console.error("Failed to crop cell:",a)}},_r=(s,i,a,l)=>{var p,R,I,J,Y,ae;const r=`${s}-${i}`,N=Ee[r];return N&&N[l]?N[l]:l==="output"&&((p=a.output)!=null&&p.imageData)?a.output.imageData:l==="facePhoto"&&((R=a.inputs.facePhoto)!=null&&R.imageData)?a.inputs.facePhoto.imageData:l==="originalAvatar"&&"originalAvatar"in a.inputs&&((I=a.inputs.originalAvatar)!=null&&I.imageData)?a.inputs.originalAvatar.imageData:l==="styleSample"&&"styleSample"in a.inputs&&((J=a.inputs.styleSample)!=null&&J.imageData)?a.inputs.styleSample.imageData:l==="standardAvatar"&&"standardAvatar"in a.inputs&&((Y=a.inputs.standardAvatar)!=null&&Y.imageData)?a.inputs.standardAvatar.imageData||null:l==="referenceAvatar"&&"referenceAvatar"in a.inputs&&((ae=a.inputs.referenceAvatar)!=null&&ae.imageData)&&a.inputs.referenceAvatar.imageData||null},Ie=(s,i,a,l,r,N)=>{const p=_r(s,i,a,l),R=`${s}-${i}`,I=Pe.has(R),J=!!Ee[R];return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:r}),p?e.jsx("img",{src:p,alt:r,className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>G({src:p,title:r}),title:N?`${N} KB - Click to enlarge`:"Click to enlarge"}):N?e.jsx("button",{onClick:()=>mt(s,i),disabled:I||J,className:"w-16 h-16 flex flex-col items-center justify-center bg-blue-50 border border-blue-300 rounded text-blue-500 hover:bg-blue-100 disabled:opacity-50 text-[10px]",title:"Click to load images",children:I?e.jsx(de,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{size:14}),e.jsxs("span",{className:"mt-0.5",children:[N," KB"]})]})}):e.jsx("span",{className:"text-gray-400 italic text-[10px]",children:"N/A"})]})};A.useEffect(()=>{We||Rs(x)},[x,We]),A.useEffect(()=>{nt||Es(d||"")},[d,nt]);const qr=async()=>{if(zs){Ct(!0);try{await zs(Os),Ds(!1)}catch(s){console.error("Failed to save story text:",s)}finally{Ct(!1)}}},Tt=async()=>{if(!(!at||!Ls.trim())){$t(!0);try{await at(Ls.trim()),Fs(!1)}catch(s){console.error("Failed to save title:",s)}finally{$t(!1)}}},Hr=()=>{Rs(x),Ds(!1)},Bt=async s=>{if(!(!U||he!==null)){Pt(s);try{await U(s)}catch(i){console.error("Failed to repair image:",i)}finally{Pt(null)}}},Mt=async(s,i)=>{if(!(!X||Fe!==null)){Dt(s),Le(null);try{await X(s,i)}catch(a){console.error("Failed to iterate page:",a)}finally{Dt(null)}}},Wr=async s=>{if(!(!f||Ue!==null)){It(s);try{const i=await fetch(`/api/stories/${f}/repair-entity-consistency`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({entityName:s,entityType:"character"})});if(!i.ok){const l=await i.json();throw new Error(l.error||"Repair failed")}const a=await i.json();console.log("Entity repair result:",a),a.success&&!a.noChanges&&(He?await He():window.location.reload())}catch(i){console.error("Failed to repair entity consistency:",i),alert(`Failed to repair: ${i instanceof Error?i.message:"Unknown error"}`)}finally{It(null)}}},Ur=async(s,i)=>{if(!(!f||re!==null)){zt({entity:s,page:i});try{const a=await fetch(`/api/stories/${f}/repair-entity-consistency`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({entityName:s,entityType:"character",pageNumber:i})});if(!a.ok){const r=await a.json();throw new Error(r.error||"Repair failed")}const l=await a.json();if(console.log("Single-page entity repair result:",l),l.rejected&&l.comparison){Vs({beforeImage:l.comparison.before,afterImage:l.comparison.after,title:`Repair rejected for ${s} on page ${i}: ${l.reason||"Did not improve consistency"}`});return}l.success?He?await He():window.location.reload():l.rejected||alert(`Repair failed: ${l.error||"Unknown error"}`)}catch(a){console.error("Failed to repair single page:",a),alert(`Failed to repair page ${i}: ${a instanceof Error?a.message:"Unknown error"}`)}finally{zt(null)}}},Kr=async(s,i)=>{if(!(!f||ds!==null)){At(s);try{const a=await fetch(`/api/stories/${f}/repair/image/${s}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({correctionNotes:`${i.type||""}: ${i.description||""}
Target: ${i.canonicalVersion||""}
Fix: ${i.recommendation||""}`})});if(!a.ok){const r=await a.json();throw new Error(r.error||"Repair failed")}const l=await a.json();console.log("Image issue repair result:",l),l.success&&(He?await He():window.location.reload())}catch(a){console.error("Failed to repair image issue:",a),alert(`Failed to repair: ${a instanceof Error?a.message:"Unknown error"}`)}finally{At(null)}}},Vt=(s,i)=>{const a=Os.split(/(?=---\s*(?:Page|Seite)\s+\d+\s*---|(?=##\s*(?:Page|Seite)\s+\d+))/i);let l=0;for(let N=0;N<a.length;N++)if(/^(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i.test(a[N].trim())){l=N;break}const r=l+s;if(r<a.length){const N=a[r].match(/^(---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i),p=N?N[0]:"";a[r]=p+`
`+i.trim()+`
`}Rs(a.join(""))},Ye=s=>{const i=y.find(a=>a.pageNumber===s);return(i==null?void 0:i.imageVersions)||[]},Jr=async(s,i)=>{if(vt)try{await vt(s,i),Ts(null)}catch(a){console.error("Failed to select image version:",a)}},Qr=async(s,i)=>{if(wt)try{await wt(s,i),ls(null)}catch(a){console.error("Failed to select cover image version:",a)}},ve=s=>{const i=h==null?void 0:h[s];return i?i.imageVersions||[]:[]},Zr=s=>{if(!s)return"";let i;if(typeof s!="string"){const N=s;if(N.output)if(typeof N.output=="string")i=N.output;else if(typeof N.output=="object"){const p=N.output.translatedSummary||N.output.imageSummary||"";if(p)return p;i=JSON.stringify(s)}else i=JSON.stringify(s);else i=JSON.stringify(s)}else i=s;if(i.trim().startsWith("{"))try{const N=JSON.parse(i);if(N.output){if(typeof N.output=="string")i=N.output;else if(typeof N.output=="object"){const p=N.output.translatedSummary||N.output.imageSummary;if(p)return p}}}catch{}const a=i.match(/(?:#{1,3}\s*)?(?:\*\*)?6\.?\s*(?:\*\*)?\s*\*?\*?(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*\*?\*?\s*:?\s*\n?([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n---|\n```|$)/i);if(a&&a[2]&&a[2].trim())return a[2].trim();const l=i.match(/(?:#{1,3}\s*)?\*?\*?(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*:?\s*\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n\*\*|\n#{1,3}\s|$)/i);if(l&&l[2]&&l[2].trim())return l[2].trim();if(!i.includes("**")&&i.length<1e3)return i.trim();const r=i.match(/\*?\*?(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:\*\*)?\d+\.\s*\*\*|\n\s*\*\*\d+\.|$)/i);return r&&r[2]&&r[2].trim()?r[2].trim():i.substring(0,500).trim()+"..."},Yr=s=>{if(!s||!j.length)return j.map(l=>l.id);let i;if(typeof s!="string"){const l=s;i=l.output&&typeof l.output=="string"?l.output:JSON.stringify(s)}else i=s;if(i.trim().startsWith("{"))try{const l=JSON.parse(i);l.output&&typeof l.output=="string"&&(i=l.output)}catch{}const a=i.toLowerCase();return j.filter(l=>a.includes(l.name.toLowerCase())).map(l=>l.id)},_t=s=>{const i=y.find(p=>p.pageNumber===s),a=v.find(p=>p.pageNumber===s),l=(i==null?void 0:i.description)||(a==null?void 0:a.description)||"",r=(a==null?void 0:a.translatedSummary)||Zr(l)||(a==null?void 0:a.imageSummary)||"",N=Yr(l);os({pageNumber:s,scene:r,selectedCharacterIds:N})},Xr=async()=>{if(!me||!g)return;const s=me.pageNumber,i=me.scene,a=me.selectedCharacterIds;os(null),ct(l=>new Set(l).add(s)),kt(!0);try{await g(s,i,a)}catch(l){console.error("Failed to regenerate image:",l)}finally{ct(l=>{const r=new Set(l);return r.delete(s),r}),ct(l=>(l.size===0&&kt(!1),l))}},pt=s=>{let i="",a=[];if(s==="front"&&(h!=null&&h.frontCover)){const p=h.frontCover;typeof p=="object"&&(i=p.translatedDescription||p.description||"",a=p.referencePhotos||[])}else if(s==="initial"&&(h!=null&&h.initialPage)){const p=h.initialPage;typeof p=="object"&&(i=p.translatedDescription||p.description||"",a=p.referencePhotos||[])}else if(s==="back"&&(h!=null&&h.backCover)){const p=h.backCover;typeof p=="object"&&(i=p.translatedDescription||p.description||"",a=p.referencePhotos||[])}let l=[];a.length>0&&j.length>0&&(l=j.filter(p=>a.some(R=>R.name===p.name)).map(p=>p.id)),l.length===0&&(l=j.map(p=>p.id)),Re({coverType:s,scene:i,selectedCharacterIds:l,title:s==="front"?d:void 0,dedication:s==="initial"?k:void 0})},Gr=async()=>{if(!K||!q)return;const{coverType:s,scene:i,selectedCharacterIds:a,title:l,dedication:r}=K;Re(null);try{await q(s,i,a,l,r)}catch(N){console.error("Failed to regenerate cover:",N)}},Ws=(s,i,a,l)=>{it({type:s,id:i,field:a}),Oe(l||"")},Us=()=>{if(!V||!b||!se)return;const{type:s,id:i,field:a}=V,l={...b};if(s==="secondaryCharacter")l.secondaryCharacters=(l.secondaryCharacters||[]).map(r=>r.id===i?{...r,[a]:ge}:r);else if(s==="animal")l.animals=(l.animals||[]).map(r=>r.id===i?{...r,[a]:ge}:r);else if(s==="artifact")l.artifacts=(l.artifacts||[]).map(r=>r.id===i?{...r,[a]:ge}:r);else if(s==="location")l.locations=(l.locations||[]).map(r=>r.id===i?{...r,[a]:ge}:r);else if(s==="mainCharacter"){const r=parseInt(i);l.mainCharacters=(l.mainCharacters||[]).map(N=>N.id!==r?N:a==="physical.face"?{...N,physical:{...N.physical,face:ge}}:a==="physical.hair"?{...N,physical:{...N.physical,hair:ge}}:a==="physical.build"?{...N,physical:{...N.physical,build:ge}}:N)}se(l),it(null),Oe("")},Ks=()=>{it(null),Oe("")},Xe=(s=>s?s.split(/(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i).slice(1).filter(a=>a.trim().length>0):[])(We?Os:x),Ge=y.length>0,Js=H==="1st-grade",qt=(()=>{if(!ye)return Xe.length;if(Xe.length===0)return 0;let s=1;for(let i=2;i<=Xe.length;i++){const a=i-1;if(y.some(r=>r.pageNumber===a&&r.imageData)||!!yt[a])s=i;else break}return s})(),ea=(qe==null?void 0:qe.totalPages)||Xe.length;qe!=null&&qe.totalScenes||y.length||Math.ceil(ea/(Js?1:2));const es=s=>(s==null?void 0:s.imageData)||null,Qs=s=>{var N,p;const a=((N=v.find(R=>R.pageNumber===s))==null?void 0:N.description)||((p=y.find(R=>R.pageNumber===s))==null?void 0:p.description);if(!a)return;const l=R=>{if(typeof R!="string")return R;try{const I=JSON.parse(R);return typeof I=="string"&&(I.startsWith("{")||I.startsWith("["))?l(I):I}catch{return R}},r=l(a);return typeof r=="object"&&r!==null?JSON.stringify(r,null,2):String(r)},Zs=s=>{const i=v.find(a=>a.pageNumber===s);return s===1&&i&&(console.log("[StoryDisplay] Page 1 scene keys:",Object.keys(i)),console.log("[StoryDisplay] Page 1 has outlineExtract:",!!i.outlineExtract),console.log("[StoryDisplay] Page 1 has scenePrompt:",!!i.scenePrompt)),i==null?void 0:i.outlineExtract},Ys=s=>{var i;return(i=v.find(a=>a.pageNumber===s))==null?void 0:i.scenePrompt},Xs=s=>{var i;return(i=v.find(a=>a.pageNumber===s))==null?void 0:i.textModelId};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center gap-2",children:nt?e.jsxs("div",{className:"flex items-center gap-2 w-full max-w-2xl",children:[e.jsx("input",{type:"text",value:Ls,onChange:s=>Es(s.target.value),className:"flex-1 text-2xl md:text-3xl font-bold text-gray-800 text-center border-2 border-indigo-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-500",autoFocus:!0,onKeyDown:s=>{s.key==="Enter"&&Tt(),s.key==="Escape"&&(Es(d||""),Fs(!1))}}),e.jsx("button",{onClick:Tt,disabled:lt||!Ls.trim(),className:"p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50",title:t==="de"?"Speichern":t==="fr"?"Sauvegarder":"Save",children:lt?e.jsx(Te,{className:"animate-spin",size:20}):e.jsx(ss,{size:20})}),e.jsx("button",{onClick:()=>{Es(d||""),Fs(!1)},disabled:lt,className:"p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",title:t==="de"?"Abbrechen":t==="fr"?"Annuler":"Cancel",children:e.jsx(Ce,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-800 text-center",children:d||Dr.yourStory}),at&&!c&&e.jsx("button",{onClick:()=>Fs(!0),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:t==="de"?"Titel bearbeiten":t==="fr"?"Modifier le titre":"Edit title",children:e.jsx(ie,{size:18})})]})}),Is&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-400 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-amber-500 text-2xl",children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-amber-800",children:t==="de"?"Unvollst√§ndige Geschichte":t==="fr"?"Histoire incompl√®te":"Incomplete Story"}),e.jsx("p",{className:"text-amber-700 text-sm mt-1",children:t==="de"?`Diese Geschichte konnte nicht vollst√§ndig generiert werden. ${Ve||y.length} von ${_e||"unbekannt"} Seiten wurden erstellt.`:t==="fr"?`Cette histoire n'a pas pu √™tre g√©n√©r√©e compl√®tement. ${Ve||y.length} sur ${_e||"inconnu"} pages ont √©t√© cr√©√©es.`:`This story could not be fully generated. ${Ve||y.length} of ${_e||"unknown"} pages were created.`}),is&&Z&&e.jsxs("details",{className:"mt-2 text-sm",children:[e.jsx("summary",{className:"cursor-pointer text-amber-600 hover:text-amber-700",children:t==="de"?"Fehlerdetails":t==="fr"?"D√©tails de l'erreur":"Error details"}),e.jsx("p",{className:"mt-1 bg-amber-100 p-2 rounded text-amber-800 font-mono text-xs",children:is})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[Ge&&f&&n&&e.jsxs("button",{onClick:n,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Sr,{size:16})," ",t==="de"?"Buch erstellen":t==="fr"?"Cr√©er le livre":"Create Book"]}),Ge&&T&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>qs(!Qe),disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(rs,{size:16}),t==="de"?"PDF herunterladen":t==="fr"?"T√©l√©charger PDF":"Download PDF",e.jsx(Me,{size:14,className:`transition-transform ${Qe?"rotate-180":""}`})]}),Qe&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:Je==="square",onChange:()=>_s("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20√ó20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:Je==="A4",onChange:()=>_s("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21√ó28cm)"})]})]}),e.jsx("button",{onClick:()=>{T(Je),qs(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:t==="de"?"Herunterladen":t==="fr"?"T√©l√©charger":"Download"})]})]}),Ge&&f&&!c&&e.jsx(Ar,{storyId:f,variant:"full"}),Q&&e.jsxs("button",{onClick:Q,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Cr,{size:16})," ",t==="de"?"Neue Geschichte":t==="fr"?"Nouvelle histoire":"New Story"]})]}),Z&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[W&&e.jsxs("button",{onClick:W,className:"bg-gray-500 text-white px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 hover:bg-gray-600",children:[e.jsx(Be,{size:14})," TXT"]}),Ge&&f&&F&&e.jsxs("button",{onClick:F,disabled:c,className:`bg-yellow-500 text-black px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 ${c?"opacity-50 cursor-not-allowed":"hover:bg-yellow-600"}`,children:[e.jsx(gt,{size:14})," Print (DEV)"]})]}),Z&&St&&e.jsx("div",{className:"mt-4",children:e.jsx(wa,{settings:St,language:t})}),Z&&e.jsxs("div",{className:"space-y-4 mt-6",children:[o&&e.jsxs("details",{className:"bg-purple-50 border-2 border-purple-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-purple-800 hover:text-purple-900 flex items-center gap-2",children:[e.jsx(rs,{size:20}),Js?t==="de"?"Vollst√§ndige API-Ausgabe (Kombiniert)":t==="fr"?"Sortie API compl√®te (Combin√©e)":"Full API Output (Combined)":t==="de"?"Vollst√§ndige API-Ausgabe (Outline)":t==="fr"?"Sortie API compl√®te (Plan)":"Full API Output (Outline)",L&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-purple-600",children:["(",L,")"]}),S&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-purple-500",children:["[",S.input_tokens.toLocaleString()," in / ",S.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[$&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:t==="de"?"üì§ Prompt (Eingabe)":t==="fr"?"üì§ Prompt (Entr√©e)":"üì§ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:$})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:Js?t==="de"?"üì• API-Antwort (Kombiniert)":t==="fr"?"üì• R√©ponse API (Combin√©e)":"üì• API Response (Combined)":t==="de"?"üì• API-Antwort (Outline)":t==="fr"?"üì• R√©ponse API (Plan)":"üì• API Response (Outline)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:o})]})]})]}),x&&D.length>0&&e.jsxs("details",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(gt,{size:20}),t==="de"?"Vollst√§ndige API-Ausgabe (Story-Text)":t==="fr"?"Sortie API compl√®te (Texte)":"Full API Output (Story Text)",((Ht=D[0])==null?void 0:Ht.modelId)&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-amber-600",children:["(",D[0].modelId,")"]}),((Wt=D[0])==null?void 0:Wt.usage)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-500",children:["[",D[0].usage.input_tokens.toLocaleString()," in / ",D[0].usage.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:t==="de"?"üì§ Prompt (Eingabe)":t==="fr"?"üì§ Prompt (Entr√©e)":"üì§ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((Ut=D[0])==null?void 0:Ut.prompt)||"No prompt available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:t==="de"?"üì• Rohe API-Antwort (ungefiltert)":t==="fr"?"üì• R√©ponse API brute (non filtr√©e)":"üì• Raw API Response (unfiltered)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((Kt=D[0])==null?void 0:Kt.rawResponse)||x})]})]})]}),b&&e.jsxs("details",{className:"bg-rose-50 border-2 border-rose-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-rose-800 hover:text-rose-900 flex items-center gap-2",children:[e.jsx(gt,{size:20}),t==="de"?"Visual Bible (Wiederkehrende Elemente)":t==="fr"?"Bible Visuelle (√âl√©ments R√©currents)":"Visual Bible (Recurring Elements)",b.changeLog&&b.changeLog.length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-rose-200 text-rose-800 rounded-full text-xs font-medium",children:[b.changeLog.length," ",t==="de"?"√Ñnderungen":t==="fr"?"changements":"changes"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[(()=>{const i=[...b.secondaryCharacters||[],...b.animals||[],...b.artifacts||[],...b.locations||[],...b.vehicles||[]].filter(a=>a.hasReferenceImage&&!Hs[a.id]).length;return i===0?null:e.jsx("button",{onClick:Er,disabled:Ze.size>0,className:"text-xs px-3 py-1.5 bg-rose-500 text-white rounded hover:bg-rose-600 disabled:bg-rose-300",children:Ze.size>0?`Loading ${Ze.size} images...`:`Load All Reference Images (${i})`})})(),b.mainCharacters&&b.mainCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-purple-300 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-purple-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üëó"}),t==="de"?"Hauptcharaktere (Style Profile)":t==="fr"?"Personnages Principaux (Profil Style)":"Main Characters (Style Profile)"]}),e.jsx("div",{className:"space-y-3",children:b.mainCharacters.map(s=>{var i,a,l,r;return e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-sm",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-800 hover:text-purple-900",children:[s.name,Object.keys(s.generatedOutfits||{}).length>0&&e.jsxs("span",{className:"ml-2 px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:[Object.keys(s.generatedOutfits).length," ",t==="de"?"Outfits":t==="fr"?"tenues":"outfits"]})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Physical:"}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[((i=s.physical)==null?void 0:i.skinTone)||"N/A"," | ",((a=s.physical)==null?void 0:a.hair)||"N/A"," | ",((l=s.physical)==null?void 0:l.build)||"N/A",((r=s.physical)==null?void 0:r.other)&&` | ${s.physical.other}`]})]}),s.generatedOutfits&&Object.keys(s.generatedOutfits).length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-200",children:[e.jsx("span",{className:"font-medium text-gray-600 text-xs",children:"Generated Outfits:"}),e.jsx("div",{className:"mt-1 space-y-1",children:Object.entries(s.generatedOutfits).map(([N,p])=>{var R;return e.jsxs("div",{className:"bg-white p-1.5 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-purple-600",children:["Page ",N,":"]}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[(R=p.outfit)==null?void 0:R.substring(0,80),"..."]}),e.jsx("span",{className:`ml-1 px-1 py-0.5 rounded text-[10px] ${p.setting==="outdoor-cold"?"bg-blue-100 text-blue-700":p.setting==="outdoor-warm"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:p.setting})]},N)})})]})]})]},s.id)})})]}),b.secondaryCharacters&&b.secondaryCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Nebencharaktere":t==="fr"?"Personnages Secondaires":"Secondary Characters"}),e.jsx("div",{className:"space-y-2",children:b.secondaryCharacters.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[xs(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(V==null?void 0:V.type)==="secondaryCharacter"&&(V==null?void 0:V.id)===s.id&&(V==null?void 0:V.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:ge,onChange:a=>Oe(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Us,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(ss,{size:12})," Save"]}),e.jsxs("button",{onClick:Ks,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Ce,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&se&&e.jsx("button",{onClick:()=>Ws("secondaryCharacter",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(ie,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),((Jt=b.animals)==null?void 0:Jt.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Tiere & Wesen":t==="fr"?"Animaux & Cr√©atures":"Animals & Creatures"}),e.jsx("div",{className:"space-y-2",children:b.animals.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[xs(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(V==null?void 0:V.type)==="animal"&&(V==null?void 0:V.id)===s.id&&(V==null?void 0:V.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:ge,onChange:a=>Oe(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Us,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(ss,{size:12})," Save"]}),e.jsxs("button",{onClick:Ks,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Ce,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&se&&e.jsx("button",{onClick:()=>Ws("animal",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(ie,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),((Qt=b.artifacts)==null?void 0:Qt.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Artefakte & Objekte":t==="fr"?"Artefacts & Objets":"Artifacts & Objects"}),e.jsx("div",{className:"space-y-2",children:b.artifacts.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[xs(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(V==null?void 0:V.type)==="artifact"&&(V==null?void 0:V.id)===s.id&&(V==null?void 0:V.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:ge,onChange:a=>Oe(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Us,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(ss,{size:12})," Save"]}),e.jsxs("button",{onClick:Ks,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Ce,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&se&&e.jsx("button",{onClick:()=>Ws("artifact",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(ie,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),((Zt=b.locations)==null?void 0:Zt.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Wiederkehrende Orte":t==="fr"?"Lieux R√©currents":"Recurring Locations"}),e.jsx("div",{className:"space-y-2",children:b.locations.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[!s.isRealLandmark&&xs(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.isRealLandmark&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-amber-100 text-amber-700 font-semibold",children:"üìç LANDMARK"}),s.photoFetchStatus==="success"&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-green-100 text-green-700",children:"üì∑ Photo"}),!s.isRealLandmark&&s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),s.isRealLandmark&&s.landmarkQuery&&e.jsxs("div",{className:"text-amber-700 text-xs mt-1",children:["Landmark: ",e.jsx("span",{className:"font-mono bg-amber-50 px-1 rounded",children:s.landmarkQuery})]}),(V==null?void 0:V.type)==="location"&&(V==null?void 0:V.id)===s.id&&(V==null?void 0:V.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:ge,onChange:a=>Oe(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Us,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(ss,{size:12})," Save"]}),e.jsxs("button",{onClick:Ks,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Ce,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&se&&e.jsx("button",{onClick:()=>Ws("location",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(ie,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]}),s.referencePhotoData&&e.jsxs("div",{className:"mt-2 border border-amber-200 rounded overflow-hidden",children:[e.jsx("img",{src:s.referencePhotoData,alt:`${s.name} reference`,className:"w-full max-h-32 object-contain bg-gray-50"}),s.photoAttribution&&e.jsxs("div",{className:"text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 truncate",children:["üì∑ ",s.photoAttribution]})]})]})]},s.id)})})]}),b.vehicles&&b.vehicles.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Fahrzeuge":t==="fr"?"V√©hicules":"Vehicles"}),e.jsx("div",{className:"space-y-2",children:b.vehicles.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[xs(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:s.description}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),b.clothing&&b.clothing.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Kleidung & Kost√ºme":t==="fr"?"V√™tements & Costumes":"Clothing & Costumes"}),e.jsx("div",{className:"space-y-2",children:b.clothing.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.wornBy&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:["worn by ",s.wornBy]}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:s.description}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id)})})]}),b.changeLog&&b.changeLog.length>0&&e.jsxs("details",{className:"bg-white border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-bold text-amber-700 hover:text-amber-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üìù"}),t==="de"?"√Ñnderungsprotokoll":t==="fr"?"Journal des Modifications":"Change Log",e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-amber-100 text-amber-700 rounded text-xs",children:b.changeLog.length})]}),e.jsx("div",{className:"mt-2 space-y-1 max-h-[500px] overflow-y-auto",children:b.changeLog.slice().reverse().map((s,i)=>{var a;return e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs border-l-2 border-amber-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${s.type==="mainCharacter"?"bg-purple-100 text-purple-700":s.type==="secondaryCharacter"?"bg-rose-100 text-rose-700":s.type==="generatedOutfit"?"bg-green-100 text-green-700":s.type==="animal"?"bg-orange-100 text-orange-700":s.type==="artifact"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:s.type}),e.jsx("span",{className:"font-semibold text-amber-800",children:s.element}),e.jsxs("span",{className:"text-gray-500",children:[_==="de"?"Seite":"Page"," ",s.page]})]}),e.jsxs("div",{className:"mt-1 text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:[s.change,":"]}),e.jsxs("span",{className:"ml-1 text-gray-700",children:[(a=s.after)==null?void 0:a.substring(0,100),s.after&&s.after.length>100?"...":""]})]}),s.before&&e.jsxs("div",{className:"text-gray-400 line-through text-[10px] mt-0.5",children:[t==="de"?"Vorher":t==="fr"?"Avant":"Before",": ",s.before.substring(0,50),"..."]}),e.jsx("div",{className:"text-gray-400 text-[10px] mt-0.5",children:new Date(s.timestamp).toLocaleTimeString()})]},i)})})]}),(!b.mainCharacters||b.mainCharacters.length===0)&&(!b.secondaryCharacters||b.secondaryCharacters.length===0)&&(!b.animals||b.animals.length===0)&&(!b.artifacts||b.artifacts.length===0)&&(!b.locations||b.locations.length===0)&&(!b.vehicles||b.vehicles.length===0)&&(!b.clothing||b.clothing.length===0)&&e.jsx("div",{className:"text-gray-500 text-sm italic",children:t==="de"?"Keine wiederkehrenden Elemente gefunden":t==="fr"?"Aucun √©l√©ment r√©current trouv√©":"No recurring elements found in this story"})]})]}),je&&Object.keys(je).length>0&&e.jsxs("details",{className:"bg-teal-50 border-2 border-teal-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-teal-800 hover:text-teal-900 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"üëî"}),t==="de"?`Kleidungsanforderungen (${Object.keys(je).length} Charaktere)`:t==="fr"?`Exigences vestimentaires (${Object.keys(je).length} personnages)`:`Clothing Requirements (${Object.keys(je).length} characters)`]}),e.jsx("div",{className:"mt-4 space-y-3",children:Object.entries(je).map(([s,i])=>{var a,l,r,N,p,R,I,J,Y,ae,le,oe,ue,be,Ae;return e.jsxs("div",{className:"bg-white border border-teal-200 rounded-lg p-3",children:[e.jsx("h4",{className:"font-bold text-teal-700 mb-2",children:s}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${(a=i.standard)!=null&&a.used?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(l=i.standard)!=null&&l.used?"‚úÖ":"‚¨ú"," Standard"]}),((r=i.standard)==null?void 0:r.used)&&((N=i.standard)==null?void 0:N.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:i.standard.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(p=i.winter)!=null&&p.used?"bg-blue-50 border border-blue-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(R=i.winter)!=null&&R.used?"‚ùÑÔ∏è":"‚¨ú"," Winter"]}),((I=i.winter)==null?void 0:I.used)&&((J=i.winter)==null?void 0:J.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:i.winter.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(Y=i.summer)!=null&&Y.used?"bg-yellow-50 border border-yellow-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(ae=i.summer)!=null&&ae.used?"‚òÄÔ∏è":"‚¨ú"," Summer"]}),((le=i.summer)==null?void 0:le.used)&&((oe=i.summer)==null?void 0:oe.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:i.summer.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(ue=i.costumed)!=null&&ue.used?"bg-purple-50 border border-purple-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(be=i.costumed)!=null&&be.used?"üé≠":"‚¨ú"," Costumed"]}),((Ae=i.costumed)==null?void 0:Ae.used)&&e.jsxs("div",{className:"text-gray-600 mt-1",children:[i.costumed.costume&&e.jsxs("span",{className:"font-medium",children:[i.costumed.costume,": "]}),i.costumed.description]})]})]})]},s)})})]}),ce&&ce.length>0&&e.jsxs("details",{className:"bg-pink-50 border-2 border-pink-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-pink-800 hover:text-pink-900 flex items-center gap-2",children:[e.jsx(fe,{size:20}),t==="de"?`Stilisierte Avatare (${ce.length})`:t==="fr"?`Avatars stylis√©s (${ce.length})`:`Styled Avatars (${ce.length})`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[(()=>{const s=ce.filter((i,a)=>!Ee[`styled-${a}`]).length;return s===0?null:e.jsx("button",{onClick:Fr,disabled:Pe.size>0,className:"text-xs px-3 py-1.5 bg-pink-500 text-white rounded hover:bg-pink-600 disabled:bg-pink-300",children:Pe.size>0?"Loading...":`Load All Images (${s})`})})(),ce.map((s,i)=>{var a,l;return e.jsxs("details",{className:`border rounded-lg p-3 ${s.success?"bg-white border-pink-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.success?"bg-green-500":"bg-red-500"}`}),s.characterName," - ",s.artStyle," (",s.clothingCategory||"standard",")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(s.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[Ie("styled",i,s,"facePhoto","Face Photo",(a=s.inputs.facePhoto)==null?void 0:a.sizeKB),Ie("styled",i,s,"originalAvatar","Original Avatar",(l=s.inputs.originalAvatar)==null?void 0:l.sizeKB),s.inputs.styleSample&&Ie("styled",i,s,"styleSample","Style Sample",s.inputs.styleSample.sizeKB)]})]}),s.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",s.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-[500px] overflow-y-auto",children:s.prompt})]}),s.success&&s.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2",children:Ie("styled",i,s,"output","Styled Avatar Output",s.output.sizeKB)})]}),!s.success&&s.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:s.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(s.timestamp).toLocaleString()]})]})]},i)})]})]}),xe&&xe.length>0&&e.jsxs("details",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-orange-800 hover:text-orange-900 flex items-center gap-2",children:[e.jsx(fe,{size:20}),t==="de"?`Kost√ºm-Avatare (${xe.length})`:t==="fr"?`Avatars costum√©s (${xe.length})`:`Costumed Avatars (${xe.length})`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[(()=>{const s=xe.filter((i,a)=>!Ee[`costumed-${a}`]).length;return s===0?null:e.jsx("button",{onClick:Lr,disabled:Pe.size>0,className:"text-xs px-3 py-1.5 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:bg-orange-300",children:Pe.size>0?"Loading...":`Load All Images (${s})`})})(),xe.map((s,i)=>{var a,l,r,N,p,R,I,J,Y,ae,le,oe,ue,be;return e.jsxs("details",{className:`border rounded-lg p-3 ${s.success?"bg-white border-orange-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 hover:text-orange-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.success?"bg-green-500":"bg-red-500"}`}),s.characterName," - ",s.costumeType," (",s.artStyle,")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(s.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[s.costumeDescription&&e.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-yellow-700",children:"Costume:"}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.costumeDescription})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[((a=s.inputs)==null?void 0:a.facePhoto)&&Ie("costumed",i,s,"facePhoto","Face Photo",(l=s.inputs.facePhoto)==null?void 0:l.sizeKB),((r=s.inputs)==null?void 0:r.standardAvatar)&&Ie("costumed",i,s,"standardAvatar","Standard Avatar",(N=s.inputs.standardAvatar)==null?void 0:N.sizeKB),((p=s.inputs)==null?void 0:p.referenceAvatar)&&Ie("costumed",i,s,"referenceAvatar","Reference Avatar",(R=s.inputs.referenceAvatar)==null?void 0:R.sizeKB)]})]}),s.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",s.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-[500px] overflow-y-auto",children:s.prompt})]}),s.success&&s.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2",children:Ie("costumed",i,s,"output","Costumed Avatar Output",s.output.sizeKB)})]}),s.costumeEvaluation&&e.jsxs("div",{className:`p-2 rounded text-xs ${s.costumeEvaluation.pass?"bg-emerald-50 border border-emerald-200":"bg-amber-50 border border-amber-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-semibold ${s.costumeEvaluation.pass?"text-emerald-700":"text-amber-700"}`,children:"Costume Check:"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${s.costumeEvaluation.pass?"bg-emerald-200 text-emerald-800":"bg-amber-200 text-amber-800"}`,children:s.costumeEvaluation.pass?"PASS":"FAIL"}),e.jsxs("span",{className:"text-gray-500",children:["(",s.costumeEvaluation.confidence," confidence)"]})]}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.costumeEvaluation.reason}),s.costumeEvaluation.details&&e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-[10px]",children:[e.jsxs("div",{className:`p-1 rounded ${((I=s.costumeEvaluation.details.bottomLeft)==null?void 0:I.costumeMatch)==="full"?"bg-emerald-100":((J=s.costumeEvaluation.details.bottomLeft)==null?void 0:J.costumeMatch)==="none"?"bg-red-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-semibold",children:"Bottom-Left:"})," ",((Y=s.costumeEvaluation.details.bottomLeft)==null?void 0:Y.costumeMatch)||"N/A",((ae=s.costumeEvaluation.details.bottomLeft)==null?void 0:ae.description)&&e.jsx("div",{className:"text-gray-600 truncate",children:s.costumeEvaluation.details.bottomLeft.description})]}),e.jsxs("div",{className:`p-1 rounded ${((le=s.costumeEvaluation.details.bottomRight)==null?void 0:le.costumeMatch)==="full"?"bg-emerald-100":((oe=s.costumeEvaluation.details.bottomRight)==null?void 0:oe.costumeMatch)==="none"?"bg-red-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-semibold",children:"Bottom-Right:"})," ",((ue=s.costumeEvaluation.details.bottomRight)==null?void 0:ue.costumeMatch)||"N/A",((be=s.costumeEvaluation.details.bottomRight)==null?void 0:be.description)&&e.jsx("div",{className:"text-gray-600 truncate",children:s.costumeEvaluation.details.bottomRight.description})]})]})]}),!s.success&&s.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:s.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(s.timestamp).toLocaleString()]})]})]},i)})]})]}),ne&&ne.length>0&&e.jsxs("details",{className:"bg-slate-50 border-2 border-slate-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-slate-800 hover:text-slate-900 flex items-center gap-2",children:[e.jsx(rs,{size:20}),t==="de"?`Generierungslog (${ne.length})`:t==="fr"?`Journal de g√©n√©ration (${ne.length})`:`Generation Log (${ne.length})`,ne.filter(s=>s.level==="warn").length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-yellow-200 text-yellow-800 text-xs rounded-full",children:[ne.filter(s=>s.level==="warn").length," warnings"]}),ne.filter(s=>s.level==="error").length>0&&e.jsxs("span",{className:"ml-1 px-2 py-0.5 bg-red-200 text-red-800 text-xs rounded-full",children:[ne.filter(s=>s.level==="error").length," errors"]})]}),e.jsx("div",{className:"mt-4 space-y-1 max-h-96 overflow-y-auto",children:ne.map((s,i)=>e.jsxs("div",{className:`text-xs p-2 rounded flex items-start gap-2 ${s.level==="error"?"bg-red-50 text-red-800":s.level==="warn"?"bg-yellow-50 text-yellow-800":s.level==="debug"?"bg-gray-50 text-gray-600":"bg-white text-slate-700"}`,children:[e.jsx("span",{className:"text-gray-400 font-mono text-[10px] whitespace-nowrap",children:new Date(s.timestamp).toLocaleTimeString()}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium whitespace-nowrap ${s.stage==="outline"?"bg-blue-100 text-blue-700":s.stage==="avatars"?"bg-purple-100 text-purple-700":s.stage==="scenes"?"bg-green-100 text-green-700":s.stage==="images"?"bg-orange-100 text-orange-700":s.stage==="covers"?"bg-pink-100 text-pink-700":"bg-gray-100 text-gray-700"}`,children:s.stage}),s.character&&e.jsxs("span",{className:"font-medium text-slate-600",children:["[",s.character,"]"]}),e.jsx("span",{className:"flex-1",children:s.message}),e.jsx("span",{className:"text-gray-400 text-[10px]",children:s.event})]},i))})]}),((Yt=w==null?void 0:w.entity)==null?void 0:Yt.grids)&&w.entity.grids.length>0&&e.jsxs("details",{className:`border-2 rounded-xl p-4 ${w.entity.overallConsistent!==!1?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("summary",{className:`cursor-pointer text-lg font-bold flex items-center gap-2 ${w.entity.overallConsistent!==!1?"text-green-800 hover:text-green-900":"text-amber-800 hover:text-amber-900"}`,children:[w.entity.overallConsistent!==!1?"‚úì":"‚ö†Ô∏è",t==="de"?`Charakterkonsistenz (${w.entity.totalIssues||0} Probleme)`:t==="fr"?`Coh√©rence des personnages (${w.entity.totalIssues||0} probl√®mes)`:`Character Consistency (${w.entity.totalIssues||0} issues)`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700",children:w.entity.summary}),(()=>{var a;const i=(((a=w.entity)==null?void 0:a.grids)||[]).filter((l,r)=>!l.gridImage&&ms[r]===void 0).length;return i===0?null:e.jsx("button",{onClick:Br,disabled:ps.size>0,className:"text-xs px-3 py-1.5 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-blue-300",children:ps.size>0?`Loading ${ps.size} grids...`:`Load All Grids (${i})`})})(),e.jsx("div",{className:"space-y-2",children:w.entity.grids.map((s,i)=>{var R,I,J,Y,ae,le,oe,ue,be,Ae,gs,hs,us,bs,fs,js,ys,Ns,vs,ws,Ss,P,pe,rr,ar,ir,nr,lr,or,dr,cr,xr,mr,pr,gr,hr,ur,br,fr,jr,yr,Nr;const a=(I=(R=w.entity)==null?void 0:R.characters)==null?void 0:I[s.entityName],l=(a==null?void 0:a.overallConsistent)??(a==null?void 0:a.consistent)??!0,r=(a==null?void 0:a.overallScore)??(a==null?void 0:a.score)??0,N=(a==null?void 0:a.issues)??[],p=s.clothingCategory;return e.jsxs("details",{className:`bg-white border rounded-lg overflow-hidden ${l?"border-green-200":"border-amber-200"}`,children:[e.jsxs("summary",{className:"cursor-pointer p-3 flex items-center gap-2 hover:bg-gray-50",children:[e.jsx("span",{className:`text-sm ${l?"text-green-600":"text-amber-600"}`,children:l?"‚úì":"‚ö†Ô∏è"}),e.jsxs("span",{className:"font-medium text-sm text-gray-800",children:[s.entityName,p&&e.jsx("span",{className:`ml-1.5 text-xs font-normal px-1.5 py-0.5 rounded ${p.startsWith("costumed:")?"bg-purple-100 text-purple-700":p==="winter"?"bg-blue-100 text-blue-700":p==="summer"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:p})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.cellCount," appearance",s.cellCount!==1?"s":"",")"]}),e.jsxs("span",{className:`ml-auto text-xs px-2 py-0.5 rounded ${r>=8?"bg-green-100 text-green-700":r>=5?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:["Score: ",r,"/10"]})]}),e.jsxs("div",{className:"p-3 border-t border-gray-100 space-y-3",children:[(()=>{const u=s.gridImage||ms[i],M=ps.has(i),E=s.gridImageSizeKB;return u?e.jsx("div",{className:"flex justify-center bg-gray-50 rounded p-2",children:e.jsx("img",{src:u,alt:`${s.entityName} consistency grid`,className:"max-w-full h-auto rounded shadow-sm cursor-pointer hover:opacity-90 transition-opacity",style:{maxHeight:"400px"},onClick:()=>G({src:u,title:`${s.entityName}${p?` (${p})`:""} - Entity Consistency Grid`}),title:"Click to enlarge"})}):M?e.jsx("div",{className:"flex justify-center items-center bg-gray-100 rounded p-4 h-32",children:e.jsx("span",{className:"text-sm text-gray-500",children:"Loading grid image..."})}):e.jsxs("div",{className:"flex flex-col items-center bg-gray-100 rounded p-4",children:[e.jsxs("span",{className:"text-xs text-gray-500 mb-2",children:["Grid image not loaded ",E?`(${E} KB)`:""]}),e.jsx("button",{onClick:()=>Et(i),className:"text-xs px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Load Grid"})]})})(),((J=s.manifest)==null?void 0:J.cells)&&e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Cells: "}),s.manifest.cells.map((u,M)=>{const E=s.gridImage||ms[i];return e.jsxs("span",{className:"inline-flex items-center bg-gray-100 rounded px-1.5 py-0.5 mr-1 mb-1 gap-1",children:[e.jsxs("button",{onClick:()=>E&&Vr({...s,gridImage:E},M),className:`${E?"hover:text-blue-600 hover:underline cursor-pointer":"text-gray-400 cursor-not-allowed"}`,title:E?"Click to enlarge this cell":"Load grid image first",disabled:!E,children:[u.letter,": ",u.isReference?"Ref":`P${u.pageNumber}`,u.clothing&&u.clothing!=="standard"&&` (${u.clothing})`]}),!u.isReference&&f&&typeof u.pageNumber=="number"&&e.jsx("button",{onClick:we=>{we.stopPropagation(),Ur(s.entityName,u.pageNumber)},disabled:c||re!==null||Ue!==null,className:`ml-0.5 px-1 py-0 text-[9px] rounded transition-colors ${(re==null?void 0:re.entity)===s.entityName&&(re==null?void 0:re.page)===u.pageNumber?"bg-amber-300 text-amber-800":c||re!==null||Ue!==null?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"}`,title:`Repair page ${u.pageNumber} for ${s.entityName}`,children:(re==null?void 0:re.entity)===s.entityName&&(re==null?void 0:re.page)===u.pageNumber?"...":"‚ö°"})]},M)})]}),N.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700",children:"Issues:"}),N.map((u,M)=>{var E;return e.jsxs("div",{className:`text-xs p-2 rounded ${u.severity==="critical"?"bg-red-50 border-l-4 border-red-400":u.severity==="major"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${u.severity==="critical"?"bg-red-200 text-red-800":u.severity==="major"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:u.severity}),u.cells&&e.jsxs("span",{className:"text-gray-500",children:["Cells: ",u.cells.map((we,ze)=>{var Cs;const Gs=(((Cs=s.manifest)==null?void 0:Cs.cells)||[]).some(vr=>vr.letter===we&&!vr.isReference);return e.jsxs("span",{className:Gs?"font-semibold text-gray-800":"text-gray-400",children:[ze>0?", ":"",we]},ze)})]}),u.pagesToFix&&u.pagesToFix.length>0&&(()=>{var ze;const we=new Set((((ze=s.manifest)==null?void 0:ze.cells)||[]).filter(ee=>!ee.isReference&&ee.pageNumber!=null).map(ee=>ee.pageNumber));return e.jsxs("span",{className:"text-[10px]",children:["Fix: Page"," ",u.pagesToFix.map((ee,Gs)=>{const Cs=we.has(ee);return e.jsxs("span",{className:`px-1 py-0.5 rounded ${Cs?"bg-orange-200 text-orange-800 font-semibold":"bg-gray-200 text-gray-500"}`,title:Cs?"Visible in grid above":"Not in this grid",children:[Gs>0?" ":"",ee]},Gs)})]})})(),u.clothingCategory&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded text-[10px]",children:u.clothingCategory}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:u.subType||((E=u.type)==null?void 0:E.replace(/_/g," "))})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:u.description}),u.fixInstruction&&e.jsxs("p",{className:"text-green-700 mt-1 text-[10px]",children:["‚Üí ",u.fixInstruction]})]},M)})]}),f&&(!l||r<8)&&s.entityType==="character"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>Wr(s.entityName),disabled:c||Ue!==null,className:`flex items-center gap-2 px-3 py-1.5 text-xs font-medium rounded transition-colors ${c||Ue!==null?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"}`,children:Ue===s.entityName?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{children:"Repairing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"w-3 h-3"}),e.jsx("span",{children:"Repair All"})]})}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Regenerate all appearances to match reference"})]}),((Y=w.entityRepairs)==null?void 0:Y[s.entityName])&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-green-700",children:"‚úì Repaired"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(le=(ae=w.entityRepairs)==null?void 0:ae[s.entityName])!=null&&le.cellsRepaired?`${(oe=w.entityRepairs[s.entityName])==null?void 0:oe.cellsRepaired} pages updated`:(be=(ue=w.entityRepairs)==null?void 0:ue[s.entityName])!=null&&be.pages?`${Object.keys(((Ae=w.entityRepairs[s.entityName])==null?void 0:Ae.pages)||{}).length} page(s) repaired individually`:"",(((hs=(gs=w.entityRepairs)==null?void 0:gs[s.entityName])==null?void 0:hs.clothingGroupCount)??0)>1&&` (${(bs=(us=w.entityRepairs)==null?void 0:us[s.entityName])==null?void 0:bs.clothingGroupCount} clothing groups)`]})]}),(ys=(js=(fs=w.entityRepairs)==null?void 0:fs[s.entityName])==null?void 0:js.gridsByClothing)!=null&&ys.length?e.jsx("div",{className:"space-y-3",children:(ws=(vs=(Ns=w.entityRepairs)==null?void 0:Ns[s.entityName])==null?void 0:vs.gridsByClothing)==null?void 0:ws.map(u=>{var M;return e.jsxs("div",{className:"border border-gray-200 rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700",children:u.clothingCategory}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:["(",u.cropCount," crops, ref: ",u.referenceUsed,")"]})]}),(M=u.cellComparisons)!=null&&M.length?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[9px] font-medium text-gray-500 px-1",children:[e.jsx("span",{children:"Cell"}),e.jsx("span",{children:"Before"}),e.jsx("span",{children:"After"}),e.jsx("span",{children:"Diff"})]}),u.cellComparisons.map(E=>e.jsxs("div",{className:"grid grid-cols-4 gap-1 items-center bg-gray-50 rounded p-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700",children:E.letter}),e.jsxs("div",{className:"text-[9px] text-gray-400",children:["P",E.pageNumber]})]}),e.jsx("img",{src:E.before,alt:`${E.letter} before`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>E.before&&G({src:E.before,title:`${s.entityName} - Cell ${E.letter} Page ${E.pageNumber} Before (${u.clothingCategory})`})}),e.jsx("img",{src:E.after,alt:`${E.letter} after`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>E.after&&G({src:E.after,title:`${s.entityName} - Cell ${E.letter} Page ${E.pageNumber} After (${u.clothingCategory})`})}),e.jsx("div",{className:"bg-gray-900 rounded",children:e.jsx("img",{src:E.diff,alt:`${E.letter} diff`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>E.diff&&G({src:E.diff,title:`${s.entityName} - Cell ${E.letter} Page ${E.pageNumber} Diff (${u.clothingCategory})`})})})]},`${u.clothingCategory}-${E.letter}`))]}):e.jsxs("div",{className:`grid gap-2 ${u.gridDiff?"grid-cols-3":"grid-cols-2"}`,children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] font-medium text-gray-500",children:"Before"}),e.jsx("div",{className:"bg-gray-50 rounded p-0.5",children:e.jsx("img",{src:u.gridBefore,alt:"Before repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>u.gridBefore&&G({src:u.gridBefore,title:`${s.entityName} - ${u.clothingCategory} Grid Before`})})})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] font-medium text-gray-500",children:"After"}),e.jsx("div",{className:"bg-gray-50 rounded p-0.5",children:e.jsx("img",{src:u.gridAfter,alt:"After repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>u.gridAfter&&G({src:u.gridAfter,title:`${s.entityName} - ${u.clothingCategory} Grid After`})})})]}),u.gridDiff&&e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] font-medium text-gray-500",children:"Diff"}),e.jsx("div",{className:"bg-gray-900 rounded p-0.5",children:e.jsx("img",{src:u.gridDiff,alt:"Difference",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>G({src:u.gridDiff,title:`${s.entityName} - ${u.clothingCategory} Grid Diff`})})})]})]})]},u.clothingCategory)})}):(pe=(P=(Ss=w.entityRepairs)==null?void 0:Ss[s.entityName])==null?void 0:P.cellComparisons)!=null&&pe.length?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[10px] font-medium text-gray-500 px-1",children:[e.jsx("span",{children:"Cell"}),e.jsx("span",{children:"Before"}),e.jsx("span",{children:"After"}),e.jsx("span",{children:"Diff"})]}),(ir=(ar=(rr=w.entityRepairs)==null?void 0:rr[s.entityName])==null?void 0:ar.cellComparisons)==null?void 0:ir.map(u=>e.jsxs("div",{className:"grid grid-cols-4 gap-1 items-center bg-gray-50 rounded p-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700",children:u.letter}),e.jsxs("div",{className:"text-[9px] text-gray-400",children:["P",u.pageNumber]})]}),e.jsx("img",{src:u.before,alt:`${u.letter} before`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>u.before&&G({src:u.before,title:`${s.entityName} - Cell ${u.letter} Page ${u.pageNumber} Before`})}),e.jsx("img",{src:u.after,alt:`${u.letter} after`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>u.after&&G({src:u.after,title:`${s.entityName} - Cell ${u.letter} Page ${u.pageNumber} After`})}),e.jsx("div",{className:"bg-gray-900 rounded",children:e.jsx("img",{src:u.diff,alt:`${u.letter} diff`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>u.diff&&G({src:u.diff,title:`${s.entityName} - Cell ${u.letter} Page ${u.pageNumber} Diff`})})})]},u.letter))]}):(lr=(nr=w.entityRepairs)==null?void 0:nr[s.entityName])!=null&&lr.pages&&Object.keys(((or=w.entityRepairs[s.entityName])==null?void 0:or.pages)||{}).length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[10px] font-medium text-gray-500 px-1",children:[e.jsx("span",{children:"Page"}),e.jsx("span",{children:"Before"}),e.jsx("span",{children:"After"}),e.jsx("span",{children:"Diff"})]}),Object.entries(((dr=w.entityRepairs[s.entityName])==null?void 0:dr.pages)||{}).map(([u,M])=>{var E,we,ze;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 items-center bg-gray-50 rounded p-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-700",children:["P",u]}),M.clothingCategory&&M.clothingCategory!=="standard"&&e.jsx("div",{className:"text-[8px] text-gray-400",children:M.clothingCategory})]}),e.jsx("img",{src:(E=M.comparison)==null?void 0:E.before,alt:`P${u} before`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var ee;return((ee=M.comparison)==null?void 0:ee.before)&&G({src:M.comparison.before,title:`${s.entityName} - Page ${u} Before${M.clothingCategory?` (${M.clothingCategory})`:""}`})}}),e.jsx("img",{src:(we=M.comparison)==null?void 0:we.after,alt:`P${u} after`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var ee;return((ee=M.comparison)==null?void 0:ee.after)&&G({src:M.comparison.after,title:`${s.entityName} - Page ${u} After${M.clothingCategory?` (${M.clothingCategory})`:""}`})}}),e.jsx("div",{className:"bg-gray-900 rounded",children:e.jsx("img",{src:(ze=M.comparison)==null?void 0:ze.diff,alt:`P${u} diff`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var ee;return((ee=M.comparison)==null?void 0:ee.diff)&&G({src:M.comparison.diff,title:`${s.entityName} - Page ${u} Diff${M.clothingCategory?` (${M.clothingCategory})`:""}`})}})})]}),M.promptUsed&&e.jsxs("details",{className:"text-[10px]",children:[e.jsx("summary",{className:"cursor-pointer text-blue-600 hover:text-blue-800",children:"Show Prompt"}),e.jsx("pre",{className:"mt-1 p-2 bg-gray-100 rounded text-gray-700 whitespace-pre-wrap overflow-x-auto max-h-48 text-[9px]",children:M.promptUsed})]})]},u)})]}):(xr=(cr=w.entityRepairs)==null?void 0:cr[s.entityName])!=null&&xr.gridBeforeRepair?e.jsxs("div",{className:`grid gap-3 ${(pr=(mr=w.entityRepairs)==null?void 0:mr[s.entityName])!=null&&pr.gridDiff?"grid-cols-3":"grid-cols-2"}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"Before Repair"}),e.jsx("div",{className:"bg-gray-50 rounded p-1",children:e.jsx("img",{src:(hr=(gr=w.entityRepairs)==null?void 0:gr[s.entityName])==null?void 0:hr.gridBeforeRepair,alt:"Before repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var M,E;const u=(E=(M=w.entityRepairs)==null?void 0:M[s.entityName])==null?void 0:E.gridBeforeRepair;u&&G({src:u,title:`${s.entityName} - Grid Before Repair`})}})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"After Repair"}),e.jsx("div",{className:"bg-gray-50 rounded p-1",children:e.jsx("img",{src:(br=(ur=w.entityRepairs)==null?void 0:ur[s.entityName])==null?void 0:br.gridAfterRepair,alt:"After repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var M,E;const u=(E=(M=w.entityRepairs)==null?void 0:M[s.entityName])==null?void 0:E.gridAfterRepair;u&&G({src:u,title:`${s.entityName} - Grid After Repair`})}})})]}),((jr=(fr=w.entityRepairs)==null?void 0:fr[s.entityName])==null?void 0:jr.gridDiff)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"Difference"}),e.jsx("div",{className:"bg-gray-900 rounded p-1",children:e.jsx("img",{src:((Nr=(yr=w.entityRepairs)==null?void 0:yr[s.entityName])==null?void 0:Nr.gridDiff)??void 0,alt:"Difference",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var M,E;const u=(E=(M=w.entityRepairs)==null?void 0:M[s.entityName])==null?void 0:E.gridDiff;u&&G({src:u,title:`${s.entityName} - Grid Diff`})}})})]})]}):null]})]})]},i)})})]})]}),w&&e.jsxs("details",{className:`border-2 rounded-xl p-4 ${w.overallConsistent?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("summary",{className:`cursor-pointer text-lg font-bold flex items-center gap-2 ${w.overallConsistent?"text-green-800 hover:text-green-900":"text-amber-800 hover:text-amber-900"}`,children:[w.overallConsistent?"‚úì":"‚ö†Ô∏è",t==="de"?`Konsistenzpr√ºfung (${(w.totalIssues||0)-(((Xt=w.entity)==null?void 0:Xt.totalIssues)||0)} Probleme)`:t==="fr"?`V√©rification de coh√©rence (${(w.totalIssues||0)-(((Gt=w.entity)==null?void 0:Gt.totalIssues)||0)} probl√®mes)`:`Final Checks (${(w.totalIssues||0)-(((er=w.entity)==null?void 0:er.totalIssues)||0)} issues)`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700",children:w.summary}),w.imageChecks&&w.imageChecks.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:t==="de"?"Bildkonsistenz":t==="fr"?"Coh√©rence des images":"Image Consistency"}),w.imageChecks.map((s,i)=>{var a,l;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${s.consistent?"text-green-600":"text-amber-600"}`,children:s.consistent?"‚úì":"‚ö†Ô∏è"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:s.type==="full"?"Full Check":s.type==="character"?`Character: ${s.characterName}`:s.type==="sequence"?"Sequence Check":s.type}),s.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",s.overallScore,"/10"]})]}),s.issues&&s.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:s.issues.map((r,N)=>{var p,R;return e.jsxs("div",{className:`text-xs p-2 rounded ${r.severity==="high"?"bg-red-50 border-l-4 border-red-400":r.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${r.severity==="high"?"bg-red-200 text-red-800":r.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:r.severity}),e.jsxs("span",{className:"text-gray-500",children:["Pages ",(p=r.images)==null?void 0:p.join(", ")]}),r.pagesToFix&&r.pagesToFix.length>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-orange-100 text-orange-700 rounded text-[10px]",children:["Fix: ",r.pagesToFix.join(", ")]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:(R=r.type)==null?void 0:R.replace(/_/g," ")}),r.characterInvolved&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded text-[10px]",children:r.characterInvolved})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:r.description}),r.details&&Object.keys(r.details).length>0&&e.jsx("div",{className:"mt-1 pl-2 border-l-2 border-gray-200",children:Object.entries(r.details).map(([I,J])=>e.jsxs("p",{className:"text-gray-500 text-[10px]",children:[e.jsxs("span",{className:"font-medium",children:[I,":"]})," ",J]},I))}),r.canonicalVersion&&e.jsxs("p",{className:"text-blue-700 mt-1",children:["üéØ Target: ",r.canonicalVersion]}),r.recommendation&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:["üí° ",r.recommendation]}),f&&r.pagesToFix&&r.pagesToFix.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:r.pagesToFix.map(I=>e.jsx("button",{onClick:()=>Kr(I,r),disabled:c||ds!==null,className:`flex items-center gap-1 px-2 py-1 text-[10px] font-medium rounded transition-colors ${ds===I?"bg-amber-300 text-amber-800":c||ds!==null?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"}`,children:ds===I?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-3 h-3 animate-spin"}),e.jsxs("span",{children:["Repairing P",I,"..."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"w-3 h-3"}),e.jsxs("span",{children:["Repair P",I]})]})},I))})]},N)})}),s.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:s.summary}),(s.evaluationPrompts||s.evaluationPrompt)&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:["üîç View Evaluation Prompt",(((a=s.evaluationPrompts)==null?void 0:a.length)??0)>1?`s (${(l=s.evaluationPrompts)==null?void 0:l.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:(s.evaluationPrompts??(s.evaluationPrompt?[s.evaluationPrompt]:[])).map((r,N)=>{var p;return e.jsxs("div",{children:[(((p=s.evaluationPrompts)==null?void 0:p.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-blue-700 mb-1",children:["Batch ",N+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto bg-white p-2 rounded border",children:r})]},N)})})]}),e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"üîß View Parsed Result (Full JSON)"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-96 overflow-y-auto bg-white p-2 rounded border",children:JSON.stringify({type:s.type,characterName:s.characterName,consistent:s.consistent,overallScore:s.overallScore,issues:s.issues,summary:s.summary},null,2)})]}),s.rawResponses&&s.rawResponses.length>0&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:["üìù View Raw Response",s.rawResponses.length>1?`s (${s.rawResponses.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:s.rawResponses.map((r,N)=>{var p;return e.jsxs("div",{children:[(((p=s.rawResponses)==null?void 0:p.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-purple-700 mb-1",children:["Batch ",N+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto bg-white p-2 rounded border",children:r})]},N)})})]})]},i)})]}),w.textCheck&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:t==="de"?"Textqualit√§t":t==="fr"?"Qualit√© du texte":"Text Quality"}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${w.textCheck.quality==="good"?"text-green-600":w.textCheck.quality==="needs_review"?"text-amber-600":"text-red-600"}`,children:w.textCheck.quality==="good"?"‚úì":"‚ö†Ô∏è"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:w.textCheck.quality==="good"?"Good":w.textCheck.quality==="needs_review"?"Needs Review":"Has Issues"}),w.textCheck.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",w.textCheck.overallScore,"/10"]})]}),w.textCheck.issues&&w.textCheck.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:w.textCheck.issues.map((s,i)=>e.jsxs("div",{className:`text-xs p-2 rounded ${s.severity==="high"?"bg-red-50 border-l-4 border-red-400":s.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${s.severity==="high"?"bg-red-200 text-red-800":s.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:s.severity}),s.page&&e.jsxs("span",{className:"text-gray-500",children:["Page ",s.page]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:s.type})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:s.issue}),(s.originalText||s.text)&&e.jsxs("p",{className:"text-red-600 mt-1 line-through",children:['"',s.originalText||s.text,'"']}),s.correctedText&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:['‚úì "',s.correctedText,'"']}),!s.correctedText&&s.suggestion&&e.jsxs("p",{className:"text-green-700 mt-1",children:["‚Üí ",s.suggestion]})]},i))}),w.textCheck.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:w.textCheck.summary}),w.textCheck.fullOriginalText&&e.jsxs("details",{className:"mt-3 bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-gray-700",children:"üìÑ View Original Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-600 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:w.textCheck.fullOriginalText})]}),w.textCheck.fullCorrectedText&&e.jsxs("details",{className:"mt-3 bg-green-50 border border-green-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-green-800",children:"üìã View Full Corrected Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:w.textCheck.fullCorrectedText})]}),w.textCheck.rawResponse&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:"üìù View Raw Response"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:w.textCheck.rawResponse})]}),w.textCheck&&e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"üîß View Parsed Result"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:JSON.stringify({quality:w.textCheck.quality,overallScore:w.textCheck.overallScore,issues:w.textCheck.issues,summary:w.textCheck.summary,parseError:w.textCheck.parseError},null,2)})]}),w.textCheck.evaluationPrompt&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:"üîç View Evaluation Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:w.textCheck.evaluationPrompt})]})]})]}),w.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-2 text-xs text-red-700",children:["Error: ",w.error]})]})]}),v.length>0&&e.jsxs("details",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-green-800 hover:text-green-900 flex items-center gap-2",children:[e.jsx(rs,{size:20}),t==="de"?`Alle Szenenbeschreibungen (${v.length})`:t==="fr"?`Toutes les descriptions de sc√®nes (${v.length})`:`All Scene Descriptions (${v.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:v.map(s=>e.jsxs("details",{className:"bg-white border border-green-200 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-700 hover:text-green-800",children:_==="de"?`Seite ${s.pageNumber}`:_==="fr"?`Page ${s.pageNumber}`:`Page ${s.pageNumber}`}),e.jsxs("div",{className:"mt-2 space-y-2",children:[s.outlineExtract&&e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-amber-700",children:"Outline Extract:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:s.outlineExtract})]}),s.scenePrompt&&e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-purple-700",children:"Scene Prompt:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:s.scenePrompt})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Scene Description:"}),s.textModelId&&e.jsxs("span",{className:"ml-2 text-green-600",children:["(",s.textModelId,")"]}),e.jsx("pre",{className:"text-gray-700 mt-1 whitespace-pre-wrap font-mono text-xs overflow-x-auto",children:(()=>{var r;const i=N=>{if(typeof N!="string")return N;try{const p=JSON.parse(N);return typeof p=="string"&&(p.startsWith("{")||p.startsWith("["))?i(p):p}catch{return N}},a=typeof s.description=="object"&&((r=s.description)!=null&&r.text)?s.description.text:s.description,l=i(a);return typeof l=="object"&&l!==null?JSON.stringify(l,null,2):String(l)})()})]})]})]},s.pageNumber))})]})]}),h&&(es(h.frontCover)||((sr=h.frontCover)==null?void 0:sr.hasImage))&&(()=>{var l,r;const s=h.frontCover,i=es(h.frontCover),a=!i&&(s==null?void 0:s.hasImage);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:_==="de"?"Titelseite":_==="fr"?"Couverture":"Front Cover"}),e.jsxs("div",{className:"relative",children:[a?e.jsxs("div",{className:"aspect-[3/4] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-lg flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-600 font-medium",children:_==="de"?"Cover wird geladen...":_==="fr"?"Chargement de la couverture...":"Loading cover..."})]}):e.jsx(et,{src:i,alt:"Front Cover",className:"w-full rounded-lg shadow-lg",label:"Front Cover"}),z.has("frontCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(de,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),q&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>pt("front"),disabled:c||!te||z.has("frontCover"),className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||!te||z.has("frontCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:te?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(Se,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",ke," ",t==="de"?"Credits":"credits",")"]})]}),ve("frontCover").length>1&&e.jsxs("button",{onClick:()=>ls({coverType:"frontCover",versions:ve("frontCover")}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(fe,{size:14}),ve("frontCover").length]})]}),Z&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[B&&e.jsxs("button",{onClick:()=>B("front"),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:(()=>{const N=J=>{if(typeof J!="string")return J;try{const Y=JSON.parse(J);return typeof Y=="string"&&(Y.startsWith("{")||Y.startsWith("["))?N(Y):Y}catch{return J}},p=s.description,R=typeof p=="object"&&(p!=null&&p.text)?p.text:p,I=N(R);return typeof I=="object"&&I!==null?JSON.stringify(I,null,2):String(I)})()})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:s.prompt})]}),((((l=s.referencePhotos)==null?void 0:l.length)??0)>0||(((r=s.landmarkPhotos)==null?void 0:r.length)??0)>0||s.visualBibleGrid)&&e.jsx(ks,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,visualBibleGrid:s.visualBibleGrid,language:t}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),e.jsx($s,{retryHistory:s.retryHistory,bboxDetection:s.bboxDetection,bboxOverlayImage:s.bboxOverlayImage,language:t,storyId:f,coverType:"front"}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(as,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:t}),s.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[t==="de"?"Vorherige Version":t==="fr"?"Version pr√©c√©dente":"Previous Version",s.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(s.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),s.originalImage&&s.originalImage!==s.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[t==="de"?"Originalbild":t==="fr"?"Image originale":"Original Image",s.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(s.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),h&&es(h.initialPage)&&(()=>{var i,a;const s=h.initialPage;return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:_==="de"?"Widmungsseite":_==="fr"?"Page de d√©dicace":"Dedication Page"}),e.jsxs("div",{className:"relative",children:[e.jsx(et,{src:es(h.initialPage),alt:"Dedication Page",className:"w-full rounded-lg shadow-lg",label:"Dedication Page"}),z.has("initialPage")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(de,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),q&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>pt("initial"),disabled:c||!te||z.has("initialPage"),className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||!te||z.has("initialPage")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:te?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(Se,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",ke," ",t==="de"?"Credits":"credits",")"]})]}),ve("initialPage").length>1&&e.jsxs("button",{onClick:()=>ls({coverType:"initialPage",versions:ve("initialPage")}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(fe,{size:14}),ve("initialPage").length]})]}),Z&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[B&&e.jsxs("button",{onClick:()=>B("initial"),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:(()=>{const l=R=>{if(typeof R!="string")return R;try{const I=JSON.parse(R);return typeof I=="string"&&(I.startsWith("{")||I.startsWith("["))?l(I):I}catch{return R}},r=s.description,N=typeof r=="object"&&(r!=null&&r.text)?r.text:r,p=l(N);return typeof p=="object"&&p!==null?JSON.stringify(p,null,2):String(p)})()})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:s.prompt})]}),((((i=s.referencePhotos)==null?void 0:i.length)??0)>0||(((a=s.landmarkPhotos)==null?void 0:a.length)??0)>0||s.visualBibleGrid)&&e.jsx(ks,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,visualBibleGrid:s.visualBibleGrid,language:t}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),e.jsx($s,{retryHistory:s.retryHistory,bboxDetection:s.bboxDetection,bboxOverlayImage:s.bboxOverlayImage,language:t,storyId:f,coverType:"initial"}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(as,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:t}),s.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[t==="de"?"Vorherige Version":t==="fr"?"Version pr√©c√©dente":"Previous Version",s.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(s.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),s.originalImage&&s.originalImage!==s.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[t==="de"?"Originalbild":t==="fr"?"Image originale":"Original Image",s.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(s.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),ye&&!x&&(h==null?void 0:h.frontCover)&&e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-8 mt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-indigo-700",children:_==="de"?"Geschichte wird erstellt...":_==="fr"?"Cr√©ation de l'histoire...":"Creating your story..."}),e.jsx("p",{className:"text-indigo-500 mt-2",children:_==="de"?"Die Seiten werden gleich angezeigt":_==="fr"?"Les pages seront bient√¥t affich√©es":"Pages will appear shortly"})]})}),Ge&&x&&e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 text-center mb-6",children:d||(_==="de"?"Ihre Geschichte":_==="fr"?"Votre histoire":"Your Story")}),Xe.slice(0,ye?qt:Xe.length).map((s,i)=>{var J,Y,ae,le,oe,ue,be,Ae,gs,hs,us,bs,fs,js,ys,Ns,vs,ws,Ss;const a=i+1,l=a,r=y.find(P=>P.pageNumber===l),N=ye?yt[l]:void 0,p=!!(r!=null&&r.imageData||N),R=ye&&a===qt&&!p,I=!ye&&(r==null?void 0:r.hasImage)&&!(r!=null&&r.imageData);return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-4 text-center",children:_==="de"?`Seite ${a}`:_==="fr"?`Page ${a}`:`Page ${a}`}),Js?e.jsxs("div",{className:"flex flex-col items-center max-w-2xl mx-auto",children:[R||I?e.jsxs("div",{className:"w-full mb-4 aspect-[4/3] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-md flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-600 font-medium",children:I?_==="de"?"Bild wird geladen...":_==="fr"?"Chargement de l'image...":"Loading image...":_==="de"?"Bild wird erstellt...":_==="fr"?"Cr√©ation de l'image...":"Creating image..."}),R&&e.jsx("p",{className:"text-indigo-400 text-sm mt-1",children:_==="de"?"Die n√§chste Seite erscheint bald":_==="fr"?"La page suivante arrive bient√¥t":"Next page coming soon"})]}):r!=null&&r.imageData||N?e.jsxs("div",{className:"w-full mb-4 relative",children:[e.jsx(et,{src:((r==null?void 0:r.imageData)||N)??"",alt:`Scene for page ${a}`,className:`w-full rounded-lg shadow-md object-cover ${Ne.has(a)?"opacity-50":""}`,label:`Page ${a}`}),Ne.has(a)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(Te,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:t==="de"?"Neues Bild wird erstellt...":t==="fr"?"Nouvelle image en cours...":"Generating new image..."})]}),g&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>_t(a),disabled:c||Ne.has(a)||!te,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||Ne.has(a)||!te?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:te?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(Se,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",ke," ",t==="de"?"Credits":"credits",")"]})]}),zs&&e.jsxs("button",{onClick:()=>Ds(!0),disabled:c,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14}),t==="de"?"Text bearbeiten":t==="fr"?"Modifier le texte":"Edit Text"]}),Ye(a).length>1&&e.jsxs("button",{onClick:()=>Ts({pageNumber:a,versions:Ye(a)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(fe,{size:14}),Ye(a).length]})]})}),Z&&e.jsxs("div",{className:"mt-3 space-y-2",children:[X&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{Bs===a?Le(null):(Le(a),Ms(!1))},disabled:c||Fe!==null||he!==null,className:`w-full bg-purple-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||Fe!==null||he!==null?"opacity-50 cursor-not-allowed":"hover:bg-purple-600"}`,title:t==="de"?"Bild analysieren, 17 Checks durchf√ºhren, mit korrigierter Szene neu generieren":t==="fr"?"Analyser l'image, ex√©cuter 17 v√©rifications, r√©g√©n√©rer avec sc√®ne corrig√©e":"Analyze image, run 17 checks, regenerate with corrected scene",children:Fe===a?e.jsxs(e.Fragment,{children:[e.jsx(Te,{size:14,className:"animate-spin"}),t==="de"?"Iteriere...":t==="fr"?"It√©ration...":"Iterating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ht,{size:14}),t==="de"?"N√§chste Iteration":t==="fr"?"Prochaine It√©ration":"Next Iteration"]})}),Bs===a&&e.jsxs("div",{className:"mt-2 bg-purple-50 border border-purple-200 rounded-lg p-3 space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Ke,onChange:P=>Ms(P.target.checked),className:"rounded border-purple-300 text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:t==="de"?"Aktuelles Bild als Referenz":t==="fr"?"Utiliser l'image actuelle comme r√©f√©rence":"Use current image as reference"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:Ke?t==="de"?"Erh√§lt Komposition, kann aber Korrekturen bei vielen Referenzbildern einschr√§nken":t==="fr"?"Pr√©serve la composition mais peut limiter les corrections avec beaucoup d'images de r√©f√©rence":"Preserves composition but may limit corrections with many reference images":t==="de"?"Neue Generierung aus KI-korrigierter Szene":t==="fr"?"Nouvelle g√©n√©ration √† partir de la sc√®ne corrig√©e par l'IA":"Fresh generation from AI-corrected scene"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Mt(a,{useOriginalAsReference:Ke}),className:"flex-1 bg-purple-600 text-white px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-purple-700",children:t==="de"?"Iteration starten":t==="fr"?"D√©marrer l'it√©ration":"Start Iteration"}),e.jsx("button",{onClick:()=>Le(null),className:"px-3 py-1.5 rounded-lg text-sm text-gray-600 hover:bg-purple-100",children:"‚úï"})]})]})]}),U&&e.jsx("button",{onClick:()=>Bt(a),disabled:c||he!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||he!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:t==="de"?"Physik-Fehler automatisch erkennen und reparieren":t==="fr"?"D√©tecter et r√©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:he===a?e.jsxs(e.Fragment,{children:[e.jsx(Te,{size:14,className:"animate-spin"}),t==="de"?"Repariere...":t==="fr"?"R√©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{size:14}),t==="de"?"Auto-Reparatur":t==="fr"?"Auto-R√©paration":"Auto-Repair"]})}),C&&e.jsxs("button",{onClick:()=>C(a),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),(r==null?void 0:r.repairHistory)&&r.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(ts,{size:14}),t==="de"?"Reparatur-Historie":t==="fr"?"Historique de r√©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",r.repairHistory.length," ",t==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:r.repairHistory.map((P,pe)=>e.jsxs("div",{className:`border rounded-lg p-3 ${P.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[t==="de"?`Reparatur ${P.attempt}`:`Repair ${P.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${P.success?"text-green-600":"text-red-600"}`,children:["(",P.success?"‚úì":"‚úó"," ",P.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:P.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:t==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:t==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",P.fixPrompt]}),P.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:t==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:P.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),P.beforeImage&&P.afterImage&&e.jsxs("div",{className:"flex gap-4 cursor-pointer p-2 -m-2 rounded-lg hover:bg-amber-100 transition-colors",onClick:()=>Vs({beforeImage:P.beforeImage,afterImage:P.afterImage,diffImage:P.diffImage,title:t==="de"?`Reparatur ${P.attempt}`:`Repair ${P.attempt}`}),title:t==="de"?"Klicken f√ºr Vergleichsansicht":"Click to compare",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:P.beforeImage,alt:"Before repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Nachher:":"After:"}),e.jsx("img",{src:P.afterImage,alt:"After repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),P.diffImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:"Diff:"}),e.jsx("img",{src:P.diffImage,alt:"Difference",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(P.timestamp).toLocaleTimeString()})]},pe))})]}),Zs(a)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:t==="de"?"Auszug aus Gliederung":t==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Zs(a)})]}),Ys(a)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:t==="de"?"Szenen-Prompt":t==="fr"?"Prompt de sc√®ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:Ys(a)})]}),Qs(a)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description",Xs(a)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",Xs(a),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Qs(a)})]}),(r==null?void 0:r.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",(r==null?void 0:r.modelId)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:r==null?void 0:r.prompt})]}),((((J=r==null?void 0:r.referencePhotos)==null?void 0:J.length)??0)>0||(((Y=r==null?void 0:r.landmarkPhotos)==null?void 0:Y.length)??0)>0||(r==null?void 0:r.visualBibleGrid))&&r&&e.jsx(ks,{referencePhotos:r.referencePhotos||[],landmarkPhotos:r.landmarkPhotos,visualBibleGrid:r.visualBibleGrid,language:t,storyId:f||void 0,pageNumber:a}),(r==null?void 0:r.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",(r==null?void 0:r.qualityModelId)&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${((r==null?void 0:r.qualityScore)??0)>=70?"text-green-600":((r==null?void 0:r.qualityScore)??0)>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round((r==null?void 0:r.qualityScore)??0),"%"]})]}),(r==null?void 0:r.qualityReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),(r==null?void 0:r.semanticResult)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 hover:text-purple-900 flex items-center justify-between",children:[e.jsx("span",{className:"flex items-center gap-2",children:t==="de"?"Semantische Treue":t==="fr"?"Fid√©lit√© s√©mantique":"Semantic Fidelity"}),e.jsx("span",{className:`text-lg font-bold ${(r.semanticScore??0)>=70?"text-green-600":(r.semanticScore??0)>=50?"text-yellow-600":"text-red-600"}`,children:r.semanticScore!==null&&r.semanticScore!==void 0?`${Math.round(r.semanticScore)}%`:"N/A"})]}),e.jsxs("div",{className:"mt-2 text-xs",children:[r.semanticResult.visible&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border border-purple-200",children:[e.jsx("div",{className:"font-medium text-purple-800 mb-1",children:"üëÅÔ∏è Visible:"}),(((ae=r.semanticResult.visible.characters)==null?void 0:ae.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Characters:"})," ",(le=r.semanticResult.visible.characters)==null?void 0:le.join(", ")]}),(((oe=r.semanticResult.visible.objects)==null?void 0:oe.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Objects:"})," ",(ue=r.semanticResult.visible.objects)==null?void 0:ue.join(", ")]}),r.semanticResult.visible.setting&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Setting:"})," ",r.semanticResult.visible.setting]}),r.semanticResult.visible.action&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Action:"})," ",r.semanticResult.visible.action]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-purple-200",children:[e.jsx("div",{className:"font-medium text-purple-800 mb-1",children:"üéØ Expected:"}),(((Ae=(be=r.semanticResult.expected)==null?void 0:be.characters)==null?void 0:Ae.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Characters:"})," ",(hs=(gs=r.semanticResult.expected)==null?void 0:gs.characters)==null?void 0:hs.join(", ")]}),(((bs=(us=r.semanticResult.expected)==null?void 0:us.objects)==null?void 0:bs.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Objects:"})," ",(js=(fs=r.semanticResult.expected)==null?void 0:fs.objects)==null?void 0:js.join(", ")]}),((ys=r.semanticResult.expected)==null?void 0:ys.setting)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Setting:"})," ",r.semanticResult.expected.setting]}),((Ns=r.semanticResult.expected)==null?void 0:Ns.action)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Action:"})," ",r.semanticResult.expected.action]})]})]}),((vs=r.semanticResult.semanticIssues)==null?void 0:vs.length)>0&&e.jsx("ul",{className:"list-disc list-inside text-purple-700 bg-white p-2 rounded border border-purple-200",children:r.semanticResult.semanticIssues.map((P,pe)=>e.jsxs("li",{children:[e.jsxs("span",{className:`font-medium ${P.severity==="CRITICAL"?"text-red-600":P.severity==="MAJOR"?"text-orange-600":"text-yellow-600"}`,children:["[",P.severity,"]"]})," ",P.problem]},pe))}),(!r.semanticResult.semanticIssues||r.semanticResult.semanticIssues.length===0)&&!r.semanticResult.visible&&e.jsx("span",{className:"text-green-600",children:"‚úì No semantic issues"})]})]}),e.jsx($s,{retryHistory:r==null?void 0:r.retryHistory,language:t,storyId:f,pageNumber:r==null?void 0:r.pageNumber}),(r==null?void 0:r.retryHistory)&&r.retryHistory.length>0&&e.jsx(as,{retryHistory:r.retryHistory,totalAttempts:(r==null?void 0:r.totalAttempts)||r.retryHistory.length,language:t,onRevertRepair:O?(P,pe)=>O(r.pageNumber,pe):void 0,storyId:f,pageNumber:r.pageNumber}),(r==null?void 0:r.wasRegenerated)&&(!(r!=null&&r.retryHistory)||r.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["üîÑ ",t==="de"?"Bild regeneriert":t==="fr"?"Image r√©g√©n√©r√©e":"Image Regenerated"]}),(r==null?void 0:r.originalScore)!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(r.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:t==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige Qualit√§t hatte.":t==="fr"?"L'image a √©t√© automatiquement r√©g√©n√©r√©e car la premi√®re version avait une qualit√© faible.":"Image was automatically regenerated because the first version had low quality."}),(r==null?void 0:r.originalImage)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:t==="de"?"Originalbild:":t==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:r.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),(r==null?void 0:r.originalReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Original Feedback:":t==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`w-full flex flex-col items-center justify-center rounded-lg p-8 mb-4 ${c?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:_==="de"?"Bild wird noch erstellt...":_==="fr"?"Image en cours de cr√©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:_==="de"?"Kein Bild f√ºr diese Seite":_==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"w-full bg-indigo-50 rounded-lg p-6 border-2 border-indigo-200",children:We?e.jsx("textarea",{value:s.trim(),onChange:P=>Vt(i,P.target.value),className:"w-full min-h-[400px] p-3 text-gray-800 leading-snug font-serif text-xl text-center bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:t==="de"?"Text eingeben...":t==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl text-center",children:s.trim()})})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 items-stretch",children:[I?e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"aspect-[4/3] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-md flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-sm",children:_==="de"?"Bild wird geladen...":_==="fr"?"Chargement de l'image...":"Loading image..."})]})}):r&&r.imageData?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.imageData,alt:`Scene for page ${a}`,className:`w-full rounded-lg shadow-md object-cover ${Ne.has(a)?"opacity-50":""}`}),Ne.has(a)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(Te,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:t==="de"?"Neues Bild wird erstellt...":t==="fr"?"Nouvelle image en cours...":"Generating new image..."})]})]}),g&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>_t(a),disabled:c||Ne.has(a)||!te,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||Ne.has(a)||!te?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:te?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(Se,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",ke," ",t==="de"?"Credits":"credits",")"]})]}),zs&&e.jsxs("button",{onClick:()=>Ds(!0),disabled:c,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14}),t==="de"?"Text bearbeiten":t==="fr"?"Modifier le texte":"Edit Text"]}),Ye(a).length>1&&e.jsxs("button",{onClick:()=>Ts({pageNumber:a,versions:Ye(a)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(fe,{size:14}),Ye(a).length]})]})}),Z&&e.jsxs("div",{className:"mt-3 space-y-2",children:[X&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{Bs===a?Le(null):(Le(a),Ms(!1))},disabled:c||Fe!==null||he!==null,className:`w-full bg-purple-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||Fe!==null||he!==null?"opacity-50 cursor-not-allowed":"hover:bg-purple-600"}`,title:t==="de"?"Bild analysieren, 17 Checks durchf√ºhren, mit korrigierter Szene neu generieren":t==="fr"?"Analyser l'image, ex√©cuter 17 v√©rifications, r√©g√©n√©rer avec sc√®ne corrig√©e":"Analyze image, run 17 checks, regenerate with corrected scene",children:Fe===a?e.jsxs(e.Fragment,{children:[e.jsx(Te,{size:14,className:"animate-spin"}),t==="de"?"Iteriere...":t==="fr"?"It√©ration...":"Iterating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ht,{size:14}),t==="de"?"N√§chste Iteration":t==="fr"?"Prochaine It√©ration":"Next Iteration"]})}),Bs===a&&e.jsxs("div",{className:"mt-2 bg-purple-50 border border-purple-200 rounded-lg p-3 space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Ke,onChange:P=>Ms(P.target.checked),className:"rounded border-purple-300 text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:t==="de"?"Aktuelles Bild als Referenz":t==="fr"?"Utiliser l'image actuelle comme r√©f√©rence":"Use current image as reference"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:Ke?t==="de"?"Erh√§lt Komposition, kann aber Korrekturen bei vielen Referenzbildern einschr√§nken":t==="fr"?"Pr√©serve la composition mais peut limiter les corrections avec beaucoup d'images de r√©f√©rence":"Preserves composition but may limit corrections with many reference images":t==="de"?"Neue Generierung aus KI-korrigierter Szene":t==="fr"?"Nouvelle g√©n√©ration √† partir de la sc√®ne corrig√©e par l'IA":"Fresh generation from AI-corrected scene"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Mt(a,{useOriginalAsReference:Ke}),className:"flex-1 bg-purple-600 text-white px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-purple-700",children:t==="de"?"Iteration starten":t==="fr"?"D√©marrer l'it√©ration":"Start Iteration"}),e.jsx("button",{onClick:()=>Le(null),className:"px-3 py-1.5 rounded-lg text-sm text-gray-600 hover:bg-purple-100",children:"‚úï"})]})]})]}),U&&e.jsx("button",{onClick:()=>Bt(a),disabled:c||he!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||he!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:t==="de"?"Physik-Fehler automatisch erkennen und reparieren":t==="fr"?"D√©tecter et r√©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:he===a?e.jsxs(e.Fragment,{children:[e.jsx(Te,{size:14,className:"animate-spin"}),t==="de"?"Repariere...":t==="fr"?"R√©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{size:14}),t==="de"?"Auto-Reparatur":t==="fr"?"Auto-R√©paration":"Auto-Repair"]})}),C&&e.jsxs("button",{onClick:()=>C(a),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),(r==null?void 0:r.repairHistory)&&r.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(ts,{size:14}),t==="de"?"Reparatur-Historie":t==="fr"?"Historique de r√©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",r.repairHistory.length," ",t==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:r.repairHistory.map((P,pe)=>e.jsxs("div",{className:`border rounded-lg p-3 ${P.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[t==="de"?`Reparatur ${P.attempt}`:`Repair ${P.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${P.success?"text-green-600":"text-red-600"}`,children:["(",P.success?"‚úì":"‚úó"," ",P.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:P.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:t==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:t==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",P.fixPrompt]}),P.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:t==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:P.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),P.beforeImage&&P.afterImage&&e.jsxs("div",{className:"flex gap-4 cursor-pointer p-2 -m-2 rounded-lg hover:bg-amber-100 transition-colors",onClick:()=>Vs({beforeImage:P.beforeImage,afterImage:P.afterImage,diffImage:P.diffImage,title:t==="de"?`Reparatur ${P.attempt}`:`Repair ${P.attempt}`}),title:t==="de"?"Klicken f√ºr Vergleichsansicht":"Click to compare",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:P.beforeImage,alt:"Before repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Nachher:":"After:"}),e.jsx("img",{src:P.afterImage,alt:"After repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),P.diffImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:"Diff:"}),e.jsx("img",{src:P.diffImage,alt:"Difference",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(P.timestamp).toLocaleTimeString()})]},pe))})]}),Zs(a)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:t==="de"?"Auszug aus Gliederung":t==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Zs(a)})]}),Ys(a)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:t==="de"?"Szenen-Prompt":t==="fr"?"Prompt de sc√®ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:Ys(a)})]}),Qs(a)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description",Xs(a)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",Xs(a),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Qs(a)})]}),r.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",r.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:r.prompt})]}),((((ws=r.referencePhotos)==null?void 0:ws.length)??0)>0||(((Ss=r.landmarkPhotos)==null?void 0:Ss.length)??0)>0||r.visualBibleGrid)&&e.jsx(ks,{referencePhotos:r.referencePhotos||[],landmarkPhotos:r.landmarkPhotos,visualBibleGrid:r.visualBibleGrid,language:t,storyId:f||void 0,pageNumber:a}),r.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",r.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${r.qualityScore>=70?"text-green-600":r.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(r.qualityScore),"%"]})]}),r.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),e.jsx($s,{retryHistory:r.retryHistory,language:t,storyId:f,pageNumber:r.pageNumber}),r.retryHistory&&r.retryHistory.length>0&&e.jsx(as,{retryHistory:r.retryHistory,totalAttempts:r.totalAttempts||r.retryHistory.length,language:t,onRevertRepair:O?(P,pe)=>O(r.pageNumber,pe):void 0,storyId:f,pageNumber:r.pageNumber}),r.wasRegenerated&&(!r.retryHistory||r.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["üîÑ ",t==="de"?"Bild regeneriert":t==="fr"?"Image r√©g√©n√©r√©e":"Image Regenerated"]}),r.originalScore!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(r.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:t==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige Qualit√§t hatte.":t==="fr"?"L'image a √©t√© automatiquement r√©g√©n√©r√©e car la premi√®re version avait une qualit√© faible.":"Image was automatically regenerated because the first version had low quality."}),r.originalImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:t==="de"?"Originalbild:":t==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:r.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),r.originalReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Original Feedback:":t==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`flex flex-col items-center justify-center rounded-lg p-8 ${c?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:_==="de"?"Bild wird noch erstellt...":_==="fr"?"Image en cours de cr√©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:_==="de"?"Kein Bild f√ºr diese Seite":_==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"flex flex-col w-full h-full",children:We?e.jsx("textarea",{value:s.trim(),onChange:P=>Vt(i,P.target.value),className:"w-full flex-1 min-h-[300px] p-4 text-gray-800 leading-snug font-serif text-xl bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:t==="de"?"Text eingeben...":t==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl",children:s.trim()})})})]})]},a)})]}),h&&es(h.backCover)&&(()=>{var i,a;const s=h.backCover;return e.jsxs("div",{className:"mt-8 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:_==="de"?"R√ºckseite":_==="fr"?"Quatri√®me de couverture":"Back Cover"}),e.jsxs("div",{className:"relative",children:[e.jsx(et,{src:es(h.backCover),alt:"Back Cover",className:"w-full rounded-lg shadow-lg",label:"Back Cover"}),z.has("backCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(de,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),q&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>pt("back"),disabled:c||!te||z.has("backCover"),className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||!te||z.has("backCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:te?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(Se,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",ke," ",t==="de"?"Credits":"credits",")"]})]}),ve("backCover").length>1&&e.jsxs("button",{onClick:()=>ls({coverType:"backCover",versions:ve("backCover")}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(fe,{size:14}),ve("backCover").length]})]}),Z&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[B&&e.jsxs("button",{onClick:()=>B("back"),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:(()=>{const l=R=>{if(typeof R!="string")return R;try{const I=JSON.parse(R);return typeof I=="string"&&(I.startsWith("{")||I.startsWith("["))?l(I):I}catch{return R}},r=s.description,N=typeof r=="object"&&(r!=null&&r.text)?r.text:r,p=l(N);return typeof p=="object"&&p!==null?JSON.stringify(p,null,2):String(p)})()})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:s.prompt})]}),((((i=s.referencePhotos)==null?void 0:i.length)??0)>0||(((a=s.landmarkPhotos)==null?void 0:a.length)??0)>0||s.visualBibleGrid)&&e.jsx(ks,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,visualBibleGrid:s.visualBibleGrid,language:t}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),e.jsx($s,{retryHistory:s.retryHistory,bboxDetection:s.bboxDetection,bboxOverlayImage:s.bboxOverlayImage,language:t,storyId:f,coverType:"back"}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(as,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:t}),s.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[t==="de"?"Vorherige Version":t==="fr"?"Version pr√©c√©dente":"Previous Version",s.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(s.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),s.originalImage&&s.originalImage!==s.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[t==="de"?"Originalbild":t==="fr"?"Image originale":"Original Image",s.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(s.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),Ge&&x&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-4 mt-6",children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-3 text-center",children:t==="de"?"Was m√∂chten Sie als N√§chstes tun?":t==="fr"?"Que souhaitez-vous faire ensuite ?":"What would you like to do next?"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[f&&n&&e.jsxs("button",{onClick:n,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Sr,{size:16})," ",t==="de"?"Buch erstellen":t==="fr"?"Cr√©er le livre":"Create Book"]}),T&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>qs(!Qe),disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(rs,{size:16}),t==="de"?"PDF herunterladen":t==="fr"?"T√©l√©charger PDF":"Download PDF",e.jsx(Me,{size:14,className:`transition-transform ${Qe?"rotate-180":""}`})]}),Qe&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:Je==="square",onChange:()=>_s("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20√ó20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:Je==="A4",onChange:()=>_s("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21√ó28cm)"})]})]}),e.jsx("button",{onClick:()=>{T(Je),qs(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:t==="de"?"Herunterladen":t==="fr"?"T√©l√©charger":"Download"})]})]}),f&&!c&&e.jsx(Ar,{storyId:f,variant:"full"}),Q&&e.jsxs("button",{onClick:Q,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Cr,{size:16})," ",t==="de"?"Neue Geschichte":t==="fr"?"Nouvelle histoire":"New Story"]})]})]}),We&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 shadow-lg p-3 md:p-4 z-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(ie,{size:18,className:"flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-sm md:text-base",children:t==="de"?"Bearbeitungsmodus":t==="fr"?"Mode √©dition":"Edit Mode"}),As&&e.jsxs("span",{className:"text-xs text-gray-500 hidden sm:inline",children:["(",t==="de"?"Original gespeichert":t==="fr"?"Original sauvegard√©":"Original saved",")"]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-center md:justify-end",children:[e.jsxs("button",{onClick:Hr,disabled:ns,className:"px-3 md:px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(Ce,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:t==="de"?"Abbrechen":t==="fr"?"Annuler":"Cancel"})]}),As&&Os!==As&&e.jsxs("button",{onClick:()=>Rs(As),disabled:ns,className:"px-3 md:px-4 py-2 border border-amber-400 text-amber-700 rounded-lg hover:bg-amber-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(ht,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:t==="de"?"Zur√ºcksetzen":t==="fr"?"Restaurer":"Restore"})]}),e.jsxs("button",{onClick:qr,disabled:ns,className:`px-3 md:px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-semibold flex items-center gap-1.5 ${ns?"opacity-50 cursor-not-allowed":"hover:bg-green-600"}`,children:[e.jsx(ss,{size:16}),ns?t==="de"?"Speichern...":t==="fr"?"Sauvegarde...":"Saving...":t==="de"?"Speichern":t==="fr"?"Sauvegarder":"Save"]})]})]})}),me&&e.jsx(fa,{pageNumber:me.pageNumber,scene:me.scene,onSceneChange:s=>os({...me,scene:s}),onClose:()=>os(null),onRegenerate:Xr,isRegenerating:Ne.has(me.pageNumber),imageRegenerationCost:ke,characters:j.map(s=>({id:s.id,name:s.name})),selectedCharacterIds:me.selectedCharacterIds,onCharacterSelectionChange:s=>os({...me,selectedCharacterIds:s}),consistencyRegen:Z?(tr=y.find(s=>s.pageNumber===me.pageNumber))==null?void 0:tr.consistencyRegen:void 0}),K&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Se,{size:20}),t==="de"?"Cover bearbeiten":t==="fr"?"Modifier la couverture":"Edit Cover"," - ",K.coverType==="front"?t==="de"?"Titelseite":t==="fr"?"Couverture":"Front Cover":K.coverType==="initial"?t==="de"?"Einleitungsseite":t==="fr"?"Page de d√©dicace":"Dedication Page":t==="de"?"R√ºckseite":t==="fr"?"Dos":"Back Cover"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t==="de"?"Bearbeite die Szenenbeschreibung und w√§hle die Charaktere aus":t==="fr"?"Modifiez la description de la sc√®ne et s√©lectionnez les personnages":"Edit the scene description and select the characters"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[j.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(jt,{size:16}),t==="de"?"Charaktere auf dem Cover:":t==="fr"?"Personnages sur la couverture:":"Characters on the cover:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(s=>{const i=K.selectedCharacterIds.includes(s.id);return e.jsxs("button",{type:"button",onClick:()=>{const a=i?K.selectedCharacterIds.filter(l=>l!==s.id):[...K.selectedCharacterIds,s.id];Re({...K,selectedCharacterIds:a})},className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${i?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{className:"font-medium",children:s.name}),i&&e.jsx("span",{className:"text-indigo-500",children:"‚úì"})]},s.id)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:t==="de"?"W√§hle die Charaktere aus, die auf dem Cover erscheinen sollen.":t==="fr"?"S√©lectionnez les personnages qui doivent appara√Ætre sur la couverture.":"Select the characters that should appear on the cover."})]}),K.coverType==="front"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t==="de"?"Titel:":t==="fr"?"Titre:":"Title:"}),e.jsx("input",{type:"text",value:K.title||"",onChange:s=>Re({...K,title:s.target.value}),placeholder:t==="de"?"Der Titel des Buches":t==="fr"?"Le titre du livre":"The book title",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),K.coverType==="initial"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t==="de"?"Widmung:":t==="fr"?"D√©dicace:":"Dedication:"}),e.jsx("input",{type:"text",value:K.dedication||"",onChange:s=>Re({...K,dedication:s.target.value}),placeholder:t==="de"?'z.B. "F√ºr meine liebste Tochter Emma"':t==="fr"?'par ex. "Pour ma ch√®re fille Emma"':'e.g. "For my dear daughter Emma"',className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t==="de"?"Leer lassen f√ºr keine Widmung":t==="fr"?"Laisser vide pour aucune d√©dicace":"Leave empty for no dedication"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t==="de"?"Szenenbeschreibung:":t==="fr"?"Description de la sc√®ne:":"Scene description:"}),e.jsx("textarea",{value:K.scene,onChange:s=>Re({...K,scene:s.target.value}),placeholder:t==="de"?'z.B. "Die Hauptfigur steht vor einem magischen Schloss bei Sonnenuntergang"':t==="fr"?'par ex. "Le personnage principal devant un ch√¢teau magique au coucher du soleil"':'e.g. "The main character standing in front of a magical castle at sunset"',className:"w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y"}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:t==="de"?"Tipp: Beschreibe die Aktionen und die Umgebung. Die ausgew√§hlten Charaktere werden automatisch hinzugef√ºgt.":t==="fr"?"Conseil: D√©crivez les actions et l'environnement. Les personnages s√©lectionn√©s seront ajout√©s automatiquement.":"Tip: Describe the actions and the environment. Selected characters will be added automatically."})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:K.selectedCharacterIds.length>0&&e.jsx("span",{children:t==="de"?`${K.selectedCharacterIds.length} Charakter(e) ausgew√§hlt`:t==="fr"?`${K.selectedCharacterIds.length} personnage(s) s√©lectionn√©(s)`:`${K.selectedCharacterIds.length} character(s) selected`})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>Re(null),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium order-2 sm:order-1",children:t==="de"?"Abbrechen":t==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{onClick:Gr,disabled:z.has(K.coverType==="front"?"frontCover":K.coverType==="initial"?"initialPage":"backCover")||K.selectedCharacterIds.length===0,className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 order-1 sm:order-2 ${z.has(K.coverType==="front"?"frontCover":K.coverType==="initial"?"initialPage":"backCover")||K.selectedCharacterIds.length===0?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:[e.jsx(Se,{size:16}),t==="de"?"Neu generieren":t==="fr"?"R√©g√©n√©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",ke," ",t==="de"?"Credits":"credits",")"]})]})]})]})]})}),ot&&e.jsx(kr,{pageNumber:ot.pageNumber,versions:ot.versions,onClose:()=>Ts(null),onSelectVersion:(s,i)=>Jr(s,i),developerMode:Z}),dt&&e.jsx(kr,{coverType:dt.coverType,versions:dt.versions,onClose:()=>ls(null),onSelectVersion:(s,i)=>Qr(s,i),developerMode:Z}),xt&&e.jsx(ya,{src:xt.src,title:xt.title,onClose:()=>G(null)}),cs&&e.jsx(Na,{beforeImage:cs.beforeImage,afterImage:cs.afterImage,diffImage:cs.diffImage,title:cs.title,onClose:()=>Vs(null)})]})}export{Ga as StoryDisplay,Ga as default};
