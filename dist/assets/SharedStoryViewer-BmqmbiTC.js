import{c as p,j as e,L as j,i as N}from"./index-BPmUxtC0.js";import{f as w,b as i,L as x}from"./vendor-react-CqfXSjHo.js";import{S as b}from"./sparkles-B8w9XxWr.js";import{B as v}from"./book-open-BLMFPr8P.js";import{C as y}from"./chevron-right-aTbt1RZQ.js";import"./vendor-firebase-DTVMaYMy.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=p("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);function T(){const{shareToken:l}=w(),[s,g]=i.useState(null),[f,c]=i.useState(!0),[h,m]=i.useState(null),[a,u]=i.useState(0);i.useEffect(()=>{async function t(){if(!l){m("Invalid share link"),c(!1);return}try{const r=await fetch(`/api/shared/${l}`);if(!r.ok){r.status===404?m("This story is no longer available or the link is invalid."):m("Failed to load story. Please try again later."),c(!1);return}const o=await r.json();g(o)}catch{m("Failed to load story. Please check your connection.")}finally{c(!1)}}t()},[l]);const n=s?s.pages.length+1:0,d=t=>{t>=0&&t<n&&u(t)};return f?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-amber-50 to-orange-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(j,{className:"w-12 h-12 animate-spin text-amber-600 mx-auto mb-4"}),e.jsx("p",{className:"text-amber-800",children:"Loading story..."})]})}):h?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-amber-50 to-orange-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(N,{className:"w-16 h-16 text-amber-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-amber-900 mb-2",children:"Story Not Found"}),e.jsx("p",{className:"text-amber-700 mb-6",children:h}),e.jsxs(x,{to:"/",className:"inline-flex items-center gap-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white px-6 py-3 rounded-full font-semibold hover:from-amber-600 hover:to-orange-600 transition-all",children:[e.jsx(b,{className:"w-5 h-5"}),"Create Your Own Story"]})]})}):s?e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-amber-50 to-orange-50",children:[e.jsx("header",{className:"bg-white/80 backdrop-blur-sm border-b border-amber-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-6 h-6 text-amber-600"}),e.jsx("span",{className:"font-bold text-amber-900 hidden sm:inline",children:"MagicalStory"})]}),e.jsxs(x,{to:"/",className:"inline-flex items-center gap-1 bg-gradient-to-r from-amber-500 to-orange-500 text-white px-4 py-2 rounded-full text-sm font-semibold hover:from-amber-600 hover:to-orange-600 transition-all",children:[e.jsx(b,{className:"w-4 h-4"}),"Create Your Own"]})]})}),e.jsxs("main",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden border-4 border-amber-200",children:[a===0&&e.jsxs("div",{className:"aspect-[3/4] md:aspect-[4/3] relative bg-gradient-to-br from-amber-100 to-orange-100",children:[e.jsx("img",{src:`/api/shared/${l}/cover-image/frontCover`,alt:"Story Cover",className:"w-full h-full object-contain",onError:t=>{t.currentTarget.style.display="none"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-6",children:e.jsx("h1",{className:"text-2xl md:text-4xl font-bold text-white text-center drop-shadow-lg",children:s.title})})]}),a>0&&s.pages[a-1]&&e.jsxs("div",{className:"md:grid md:grid-cols-2",children:[e.jsx("div",{className:"aspect-square bg-gradient-to-br from-amber-50 to-orange-50 flex items-center justify-center",children:e.jsx("img",{src:`/api/shared/${l}/image/${s.pages[a-1].pageNumber}`,alt:`Page ${a}`,className:"w-full h-full object-contain",loading:"lazy",onError:t=>{t.currentTarget.src="",t.currentTarget.alt="Image not available"}})}),e.jsxs("div",{className:"p-6 md:p-8 flex flex-col justify-center bg-amber-50/50",children:[e.jsx("p",{className:"text-lg md:text-xl leading-relaxed text-amber-900 whitespace-pre-wrap",children:s.pages[a-1].text}),e.jsxs("div",{className:"mt-4 text-right text-amber-400 text-sm",children:["Page ",a," of ",s.pages.length]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-6",children:[e.jsx("button",{onClick:()=>d(a-1),disabled:a===0,className:"p-3 rounded-full bg-white shadow-md border border-amber-200 text-amber-600 disabled:opacity-40 disabled:cursor-not-allowed hover:bg-amber-50 transition-colors","aria-label":"Previous page",children:e.jsx(S,{className:"w-6 h-6"})}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:Math.min(n,10)}).map((t,r)=>{const o=n<=10||r<4?r:r===4?-1:n-(9-r);return o===-1?e.jsx("span",{className:"text-amber-400",children:"..."},r):e.jsx("button",{onClick:()=>d(o),className:`w-3 h-3 rounded-full transition-all ${a===o?"bg-amber-500 scale-125":"bg-amber-200 hover:bg-amber-300"}`,"aria-label":`Go to page ${o}`},r)})}),e.jsx("button",{onClick:()=>d(a+1),disabled:a>=n-1,className:"p-3 rounded-full bg-white shadow-md border border-amber-200 text-amber-600 disabled:opacity-40 disabled:cursor-not-allowed hover:bg-amber-50 transition-colors","aria-label":"Next page",children:e.jsx(y,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-12 text-center bg-gradient-to-r from-amber-100 to-orange-100 rounded-2xl p-8 border border-amber-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-900 mb-2",children:"Love this story?"}),e.jsx("p",{className:"text-amber-700 mb-6",children:"Create your own personalized magical story in minutes!"}),e.jsxs(x,{to:"/",className:"inline-flex items-center gap-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white px-8 py-4 rounded-full text-lg font-bold hover:from-amber-600 hover:to-orange-600 transition-all shadow-lg hover:shadow-xl",children:[e.jsx(b,{className:"w-6 h-6"}),"Create Your Own Story"]})]})]}),e.jsx("footer",{className:"bg-white/60 border-t border-amber-200 py-6 mt-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 text-center text-amber-600 text-sm",children:["Shared with love from"," ",e.jsx("a",{href:"https://magicalstory.ch",className:"font-semibold hover:text-amber-800",children:"MagicalStory.ch"})]})})]}):null}export{T as default};
