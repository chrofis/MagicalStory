import{c as ge,j as e,u as xe,T as Cs,X as He,b as Kt,L as Xe,d as Jt,e as ks,f as Ps}from"./index-Xw_MPmPP.js";import{b as N,u as Ds,d as As}from"./vendor-react-BhxjzHy9.js";import{B as et}from"./Button-DHotDVbO.js";import{N as $s}from"./Textarea-B1j-ThGq.js";import{B as Ze,U as Ae}from"./Input-DwVItLKb.js";import{P as zs,C as Fs,D as Ts,F as Be,R as Le,H as Is,A as Bt}from"./refresh-cw-2HGeUN5U.js";import{T as Es,a as se}from"./api-BlHPv6lq.js";import{A as Qt,S as Me}from"./sparkles-ClSeQO9H.js";import{s as de}from"./storyService-DAcaJUEf.js";import"./vendor-firebase-DlZ6VILR.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=ge("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=ge("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=ge("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=ge("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=ge("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=ge("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=ge("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=ge("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=ge("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=ge("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=ge("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),qt={sm:"h-1",md:"h-2",lg:"h-3"},Ms={default:"bg-indigo-600",success:"bg-green-500",warning:"bg-yellow-500",gradient:"bg-gradient-to-r from-indigo-500 to-indigo-600"};function qs({value:t,max:i=100,label:d,showPercentage:c=!1,size:r="md",variant:h="gradient",className:v=""}){const x=Math.min(Math.max(t/i*100,0),100);return e.jsxs("div",{className:v,children:[(d||c)&&e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[d&&e.jsx("span",{className:"text-sm font-medium text-gray-700",children:d}),c&&e.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(x),"%"]})]}),e.jsx("div",{className:`w-full bg-gray-200 rounded-full overflow-hidden ${qt[r]}`,children:e.jsx("div",{className:`${qt[r]} ${Ms[h]} rounded-full transition-all duration-500 ease-out`,style:{width:`${x}%`}})})]})}const Zt=[{id:"christmas",name:{en:"Christmas Story",de:`Weihnachts-
Geschichte`,fr:"Histoire de NoÃ«l"},emoji:"ğŸ„"},{id:"newyear",name:{en:"New Year Story",de:`Neujahrs-
Geschichte`,fr:"Histoire du Nouvel An"},emoji:"ğŸ†"},{id:"pirate",name:{en:"Pirate Adventure",de:"Piraten-Abenteuer",fr:"Aventure de Pirates"},emoji:"ğŸ´â€â˜ ï¸"},{id:"cowboy",name:{en:"Wild West",de:"Wilder Westen",fr:"Far West"},emoji:"ğŸ¤ "},{id:"fireman",name:{en:"Brave Firefighter",de:"Tapferer Feuerwehrmann",fr:"Pompier Courageux"},emoji:"ğŸš’"},{id:"unicorn",name:{en:"Magical Unicorn",de:"Magisches Einhorn",fr:"Licorne Magique"},emoji:"ğŸ¦„"},{id:"ninja",name:{en:"Secret Ninja",de:"Geheimer Ninja",fr:"Ninja Secret"},emoji:"ğŸ¥·"},{id:"space",name:{en:"Space Explorer",de:"Weltraum-Entdecker",fr:"Explorateur Spatial"},emoji:"ğŸš€"},{id:"dinosaur",name:{en:"Dinosaur World",de:"Dinosaurier-Welt",fr:"Monde des Dinosaures"},emoji:"ğŸ¦–"},{id:"princess",name:{en:"Princess Story",de:"Prinzessinnen-Geschichte",fr:"Histoire de Princesse"},emoji:"ğŸ‘‘"},{id:"knight",name:{en:"Knight Adventure",de:"Ritter-Abenteuer",fr:"Aventure de Chevalier"},emoji:"âš”ï¸"},{id:"detective",name:{en:"Detective Mystery",de:"Detektiv-Geheimnis",fr:"MystÃ¨re de DÃ©tective"},emoji:"ğŸ”"}];function _s({selectedType:t,onSelect:i,customTypes:d=[],onAddCustom:c}){const{t:r,language:h}=xe(),v=[...Zt,...d];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:r.chooseStoryType}),e.jsxs("div",{className:"grid grid-cols-3 md:grid-cols-5 lg:grid-cols-6 gap-2",children:[v.map(x=>e.jsxs("button",{onClick:()=>i(x.id),className:`p-2 rounded-lg border-2 transition-all ${t===x.id?"border-indigo-600 bg-indigo-50 shadow-lg":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:x.emoji}),e.jsx("div",{className:"font-semibold text-xs",children:x.name[h]})]},x.id)),c&&e.jsxs("button",{onClick:c,className:"p-2 rounded-lg border-2 border-dashed border-indigo-300 hover:border-indigo-600 transition-all hover:bg-indigo-50",children:[e.jsx("div",{className:"text-2xl mb-1",children:e.jsx(tt,{size:24,className:"mx-auto text-indigo-600"})}),e.jsx("div",{className:"font-semibold text-xs text-indigo-600",children:r.addCustomStoryType})]})]})]})}const Hs=[{id:"pixar",name:{en:"Pixar 3D",de:"Pixar 3D",fr:"Pixar 3D"},emoji:"ğŸ¬",image:"/images/Pixar style.jpg",description:{en:"Vibrant, warm Disney/Pixar style 3D animation",de:"Lebendige, warme Disney/Pixar 3D-Animation",fr:"Animation 3D Disney/Pixar vibrante et chaleureuse"},prompt:"pixar style 3d character, vibrant Disney/Pixar 3D animation, warm lighting, child-friendly"},{id:"cartoon",name:{en:"Cartoon",de:"Cartoon",fr:"Dessin animÃ©"},emoji:"ğŸ¨",image:"/images/cartoon style.jpg",description:{en:"Classic 2D cartoon style with bold colors",de:"Klassischer 2D-Cartoon-Stil mit krÃ¤ftigen Farben",fr:"Style cartoon 2D classique aux couleurs vives"},prompt:"2D cartoon style, bold outlines, vibrant flat colors, classic animation look"},{id:"anime",name:{en:"Anime",de:"Anime",fr:"Anime"},emoji:"â­",image:"/images/anime style.jpg",description:{en:"Japanese anime style with expressive features",de:"Japanischer Anime-Stil mit ausdrucksstarken Features",fr:"Style anime japonais aux traits expressifs"},prompt:"anime style, Japanese animation, expressive eyes, dynamic poses, cel-shaded"},{id:"chibi",name:{en:"Chibi",de:"Chibi",fr:"Chibi"},emoji:"ğŸŒ¸",image:"/images/chibi style.jpg",description:{en:"Cute chibi style with big heads and small bodies",de:"Niedlicher Chibi-Stil mit groÃŸen KÃ¶pfen und kleinen KÃ¶rpern",fr:"Style chibi mignon avec grandes tÃªtes et petits corps"},prompt:"chibi style, super deformed, cute, big head, small body, kawaii, adorable"},{id:"steampunk",name:{en:"Steampunk",de:"Steampunk",fr:"Steampunk"},emoji:"âš™ï¸",image:"/images/steampunk style.jpg",description:{en:"Victorian-era inspired with gears and brass",de:"Von der viktorianischen Ã„ra inspiriert mit ZahnrÃ¤dern und Messing",fr:"InspirÃ© de l'Ã¨re victorienne avec engrenages et laiton"},prompt:"steampunk anime style, Victorian era, gears, brass, copper, goggles, mechanical details, vintage technology, anime influenced"},{id:"comic",name:{en:"Comic Book",de:"Comic",fr:"Bande dessinÃ©e"},emoji:"ğŸ’¥",image:"/images/comic book style.jpg",description:{en:"Comic book style with bold lines and halftone",de:"Comic-Stil mit krÃ¤ftigen Linien und Raster",fr:"Style bande dessinÃ©e avec lignes Ã©paisses et trames"},prompt:"comic book style, bold ink lines, halftone dots, dynamic action, speech bubbles aesthetic, superhero comic art"},{id:"manga",name:{en:"Manga",de:"Manga",fr:"Manga"},emoji:"ğŸ“š",image:"/images/manga style.jpg",description:{en:"Japanese manga style, black and white with screentones",de:"Japanischer Manga-Stil, schwarz-weiÃŸ mit Rastern",fr:"Style manga japonais, noir et blanc avec trames"},prompt:"manga style, Japanese comic art, detailed linework, screentones, dramatic shading, expressive characters"},{id:"watercolor",name:{en:"Watercolor",de:"Aquarell",fr:"Aquarelle"},emoji:"ğŸ¨",image:"/images/water color style.jpg",description:{en:"Soft watercolor painting with flowing colors",de:"Sanfte Aquarellmalerei mit flieÃŸenden Farben",fr:"Peinture aquarelle douce aux couleurs fluides"},prompt:"watercolor painting style, soft edges, flowing colors, delicate washes, artistic brushstrokes, dreamy atmosphere, traditional watercolor illustration"}];function Vs({selectedStyle:t,onSelect:i}){const{t:d,language:c}=xe();return e.jsxs("div",{id:"art-style-section",className:"md:bg-indigo-50 md:border-2 md:border-indigo-200 md:rounded-lg md:p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Os,{size:18,className:"text-indigo-600"}),e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-800",children:d.chooseArtStyle})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-2 md:mb-3",children:d.artStyleDescription}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 lg:grid-cols-7 gap-2",children:Hs.map(r=>e.jsxs("button",{onClick:()=>i(r.id),className:`rounded-lg border-2 transition-all overflow-hidden flex flex-col bg-white ${t===r.id?"border-indigo-600 shadow-lg ring-2 ring-indigo-200":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"relative w-full h-32 overflow-hidden",children:e.jsx("img",{src:r.image,alt:r.name[c],className:"w-full h-full object-cover"})}),e.jsx("div",{className:"p-1.5 flex flex-col items-center text-center",children:e.jsx("div",{className:"font-bold text-xs text-gray-800",children:r.name[c]})})]},r.id))})]})}const st=[{value:{en:"Best Friends with",de:"Beste Freunde mit",fr:"Meilleurs amis avec"},inverse:{en:"Best Friends with",de:"Beste Freunde mit",fr:"Meilleurs amis avec"}},{value:{en:"Friends with",de:"Freunde mit",fr:"Amis avec"},inverse:{en:"Friends with",de:"Freunde mit",fr:"Amis avec"}},{value:{en:"Married to",de:"Verheiratet mit",fr:"MariÃ©(e) Ã "},inverse:{en:"Married to",de:"Verheiratet mit",fr:"MariÃ©(e) Ã "}},{value:{en:"In a relationship with",de:"In einer Beziehung mit",fr:"En relation avec"},inverse:{en:"In a relationship with",de:"In einer Beziehung mit",fr:"En relation avec"}},{value:{en:"Older Sibling of",de:"Ã„lteres Geschwister von",fr:"FrÃ¨re/SÅ“ur aÃ®nÃ©(e) de"},inverse:{en:"Younger Sibling of",de:"JÃ¼ngeres Geschwister von",fr:"FrÃ¨re/SÅ“ur cadet(te) de"}},{value:{en:"Younger Sibling of",de:"JÃ¼ngeres Geschwister von",fr:"FrÃ¨re/SÅ“ur cadet(te) de"},inverse:{en:"Older Sibling of",de:"Ã„lteres Geschwister von",fr:"FrÃ¨re/SÅ“ur aÃ®nÃ©(e) de"}},{value:{en:"Parent of",de:"Elternteil von",fr:"Parent de"},inverse:{en:"Child of",de:"Kind von",fr:"Enfant de"}},{value:{en:"Child of",de:"Kind von",fr:"Enfant de"},inverse:{en:"Parent of",de:"Elternteil von",fr:"Parent de"}},{value:{en:"Rivals with",de:"Rivalen mit",fr:"Rivaux avec"},inverse:{en:"Rivals with",de:"Rivalen mit",fr:"Rivaux avec"}},{value:{en:"Neighbors with",de:"Nachbarn mit",fr:"Voisins avec"},inverse:{en:"Neighbors with",de:"Nachbarn mit",fr:"Voisins avec"}},{value:{en:"Not Known to",de:"Nicht bekannt mit",fr:"Pas connu de"},inverse:{en:"Not Known to",de:"Nicht bekannt mit",fr:"Pas connu de"}}];function Xt(t){const i=st.find(d=>d.value.en==="Not Known to");return i?i.value[t]:"Not Known to"}function es(t){const i=st.find(d=>d.value.en==="Not Known to");return i?t===i.value.en||t===i.value.de||t===i.value.fr:!1}function Us(t,i){for(const d of st)if(d.value[i]===t)return d.inverse[i];return t}function Ws({characters:t,relationships:i,relationshipTexts:d,onRelationshipChange:c,onRelationshipTextChange:r,customRelationships:h=[],onAddCustomRelationship:v}){const{t:x,language:p}=xe(),$=p,j=[...st,...h.map(y=>({value:{en:y,de:y,fr:y},inverse:{en:y,de:y,fr:y}}))],z=(y,o,w)=>{if(w==="__CREATE_CUSTOM__"){const D=prompt(p==="de"?"Beziehung eingeben:":p==="fr"?"Entrer la relation:":"Enter relationship:");D&&D.trim()&&(v==null||v(D.trim()),c(y,o,D.trim()))}else c(y,o,w)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Rs,{size:24})," ",x.defineRelationships]}),e.jsx("p",{className:"text-sm text-gray-500",children:x.defineRelationshipsDesc}),e.jsx("div",{className:"grid gap-3 md:gap-4",children:t.map((y,o)=>t.map((w,D)=>{var S,B,M,R,_,H,G,ce;if(o>=D)return null;const F=`${y.id}-${w.id}`,k=i[F],L=!k||es(k);return e.jsx("div",{className:`rounded-lg p-3 md:p-4 w-full lg:w-3/4 mx-auto ${L?"bg-white border-red-500 border-[3px]":"bg-blue-50 border-blue-300 border-2"}`,children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4 w-full",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[(((S=y.photos)==null?void 0:S.face)||((B=y.photos)==null?void 0:B.original))&&e.jsx("img",{src:((M=y.photos)==null?void 0:M.face)||((R=y.photos)==null?void 0:R.original),alt:y.name,className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold text-xs md:text-sm text-center max-w-[60px] sm:max-w-[80px] md:max-w-[100px] truncate",children:y.name})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsxs("select",{value:k||Xt($),onChange:ee=>z(y.id,w.id,ee.target.value),className:`w-full px-3 py-2 md:px-4 md:py-2.5 border rounded text-sm md:text-base font-medium text-center ${L?"bg-white border-red-400 border-2":"bg-blue-100 border-blue-400"}`,children:[e.jsxs("option",{value:"__CREATE_CUSTOM__",children:["+ ",$==="de"?"Eigene":$==="fr"?"PersonnalisÃ©":"Custom"]}),j.map((ee,n)=>e.jsx("option",{value:ee.value[$],children:ee.value[$]},n))]}),!L&&e.jsx("input",{type:"text",value:d[F]||"",onChange:ee=>r(F,ee.target.value),placeholder:$==="de"?"Details...":$==="fr"?"DÃ©tails...":"Details...",className:"w-full px-3 py-1.5 md:px-4 md:py-2 border border-blue-300 rounded text-xs md:text-sm text-center bg-white"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[(((_=w.photos)==null?void 0:_.face)||((H=w.photos)==null?void 0:H.original))&&e.jsx("img",{src:((G=w.photos)==null?void 0:G.face)||((ce=w.photos)==null?void 0:ce.original),alt:w.name,className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold text-xs md:text-sm text-center max-w-[60px] sm:max-w-[80px] md:max-w-[100px] truncate",children:w.name})]})]})},F)}))})]})}function Gs({characters:t,mainCharacters:i,onToggleMainCharacter:d,languageLevel:c,onLanguageLevelChange:r,pages:h,onPagesChange:v,dedication:x,onDedicationChange:p,storyDetails:$,onStoryDetailsChange:j,developerMode:z=!1,imageGenMode:y,onImageGenModeChange:o}){const{t:w,language:D}=xe(),F=z?[4,10,30,40,50]:[30,40,50];N.useEffect(()=>{(z?[4,10,30,40,50]:[30,40,50]).includes(h)||v(30)},[h,z,v]);const k=[{value:"1st-grade",label:w.firstGrade,desc:w.firstGradeDesc,image:"/images/text and image on each page.jpg"},{value:"standard",label:w.standard,desc:w.standardDesc,image:"/images/left page text, right page image.jpg"},{value:"advanced",label:w.advanced,desc:w.advancedDesc,image:"/images/dense text left.jpg"}],L=(S,B=!1)=>{const M=B?" (Test)":"",R=S*10,_=D==="de"?"Credits":D==="fr"?"crÃ©dits":"credits";if(c==="1st-grade")return`${S} ${D==="de"?"Seiten":"pages"} = ${R} ${_}${M}`;const H=S/2,G=S/2;return D==="de"?`${S} Seiten (${H} Text + ${G} Bilder) = ${R} ${_}${M}`:D==="fr"?`${S} pages (${H} texte + ${G} images) = ${R} ${_}${M}`:`${S} pages (${H} text + ${G} images) = ${R} ${_}${M}`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Ls,{size:24})," ",w.storySettings]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:w.selectMainCharacters}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:t.map(S=>{var B,M,R,_;return e.jsx("button",{onClick:()=>d(S.id),className:`p-4 rounded-lg border-2 transition-all text-left ${i.includes(S.id)?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-indigo-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[(((B=S.photos)==null?void 0:B.face)||((M=S.photos)==null?void 0:M.original))&&e.jsx("img",{src:((R=S.photos)==null?void 0:R.face)||((_=S.photos)==null?void 0:_.original),alt:S.name,className:"w-12 h-12 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-bold text-base flex items-center gap-2",children:[S.name,e.jsx("span",{className:i.includes(S.id)?"inline-block":"hidden",children:e.jsx(Bs,{size:16,className:"text-indigo-600"})})]}),e.jsxs("div",{className:"text-sm md:text-base text-gray-500",children:[S.gender==="male"?w.male:S.gender==="female"?w.female:w.other,", ",S.age]})]})]})},S.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:w.readingLevel}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:k.map(S=>e.jsxs("button",{onClick:()=>r(S.value),className:`text-left rounded-lg border-2 transition-all overflow-hidden ${c===S.value?"border-indigo-600 ring-2 ring-indigo-200":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"w-full bg-gray-100 p-2",children:e.jsx("img",{src:S.image,alt:S.label,className:"w-full h-auto object-contain"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"font-semibold text-base",children:S.label}),e.jsx("div",{className:"text-sm text-gray-500",children:S.desc})]})]},S.value))})]}),c&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:w.numberOfPages}),e.jsx("select",{value:h,onChange:S=>v(parseInt(S.target.value)),className:"w-full px-4 py-3 border-2 border-indigo-200 rounded-lg focus:border-indigo-600 focus:outline-none text-base md:text-lg font-semibold",children:F.map(S=>e.jsx("option",{value:S,children:L(S,S===4||S===10)},S))}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:c==="1st-grade"?D==="de"?"Jede Seite enthÃ¤lt ein Bild mit Text darunter":D==="fr"?"Chaque page contient une image avec du texte en dessous":"Each page contains an image with text below":D==="de"?"Abwechselnd Textseite und Bildseite":D==="fr"?"Alternance de pages de texte et d'images":"Alternating text page and image page"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-2",children:w.storyDetails}),e.jsx("textarea",{value:$,onChange:S=>j(S.target.value),placeholder:w.storyDetailsPlaceholder,className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-base",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-2",children:D==="de"?"Widmung (Optional)":D==="fr"?"DÃ©dicace (Facultatif)":"Dedication (Optional)"}),e.jsx("textarea",{value:x,onChange:S=>p(S.target.value),placeholder:D==="de"?'z.B. "FÃ¼r meine liebe Tochter Emma zum 5. Geburtstag"':D==="fr"?'Par exemple "Pour ma chÃ¨re fille Emma pour son 5Ã¨me anniversaire"':'e.g. "For my dear daughter Emma on her 5th birthday"',className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-base",rows:2,maxLength:200}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:D==="de"?"Dieser Text wird auf Seite 0 Ihres Buches gedruckt. Wenn Sie nichts eingeben, wird Seite 0 nur eine Illustration ohne Text enthalten.":D==="fr"?"Ce texte sera imprimÃ© sur la page 0 de votre livre. Si vous ne saisissez rien, la page 0 ne contiendra qu'une illustration sans texte.":"This text will be printed on page 0 of your book. If you leave it empty, page 0 will contain only an illustration with no text."})]}),z&&e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-base font-bold text-gray-800 mb-3 flex items-center gap-2",children:["ğŸ› ï¸ ",D==="de"?"Entwickler-Optionen":D==="fr"?"Options dÃ©veloppeur":"Developer Options"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:D==="de"?"Bildgenerierungsmodus":D==="fr"?"Mode de gÃ©nÃ©ration d'images":"Image Generation Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o==null?void 0:o(null),className:`px-3 py-2 rounded-lg text-sm font-medium ${y===null?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:D==="de"?"Server-Standard":D==="fr"?"Par dÃ©faut serveur":"Server Default"}),e.jsx("button",{onClick:()=>o==null?void 0:o("parallel"),className:`px-3 py-2 rounded-lg text-sm font-medium ${y==="parallel"?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:D==="de"?"Parallel (schnell)":D==="fr"?"ParallÃ¨le (rapide)":"Parallel (fast)"}),e.jsx("button",{onClick:()=>o==null?void 0:o("sequential"),className:`px-3 py-2 rounded-lg text-sm font-medium ${y==="sequential"?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:D==="de"?"Sequenziell (konsistent)":D==="fr"?"SÃ©quentiel (cohÃ©rent)":"Sequential (consistent)"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:D==="de"?"Parallel = alle Bilder gleichzeitig. Sequenziell = jedes Bild basiert auf dem vorherigen.":D==="fr"?"ParallÃ¨le = toutes les images simultanÃ©ment. SÃ©quentiel = chaque image basÃ©e sur la prÃ©cÃ©dente.":"Parallel = all images at once. Sequential = each image based on previous one."})]})]})]})]})}function Ks({characters:t,showSuccessMessage:i,onEdit:d,onDelete:c,onCreateAnother:r,onContinue:h}){const{t:v,language:x}=xe(),[p,$]=N.useState(null),j=o=>{$({id:o.id,name:o.name})},z=()=>{p&&(c(p.id),$(null))},y=()=>{$(null)};return t.length===0?null:e.jsxs("div",{className:"space-y-4",children:[i&&e.jsx("div",{className:"md:bg-green-50 md:border-2 md:border-green-400 md:rounded-xl p-4 animate-fade-in",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center",children:e.jsx(Yt,{size:20})}),e.jsx("h3",{className:"text-lg font-bold text-green-700",children:x==="de"?"Charakter erfolgreich erstellt!":x==="fr"?"Personnage cre avec succes!":"Character Created Successfully!"})]})}),e.jsxs("div",{className:"bg-white border-2 border-indigo-200 rounded-lg p-3",children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-2",children:v.yourCharacters}),e.jsx("div",{className:"grid md:grid-cols-2 gap-2",children:t.map(o=>{var w,D,F,k,L,S,B;return e.jsxs("div",{className:"border border-gray-200 rounded p-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(((w=o.photos)==null?void 0:w.face)||((D=o.photos)==null?void 0:D.original))&&e.jsx("img",{src:((F=o.photos)==null?void 0:F.face)||((k=o.photos)==null?void 0:k.original),alt:o.name,className:"w-12 h-12 md:w-16 md:h-16 rounded-full object-cover border-2 border-indigo-200 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-bold text-sm md:text-base truncate",children:o.name}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-500",children:[o.gender==="male"?v.male:o.gender==="female"?v.female:v.other,","," ",o.age," ",x==="de"?"J":x==="fr"?"ans":"y"]})]})]}),e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>d(o),className:"bg-indigo-600 text-white px-2 md:px-3 py-1 rounded text-xs hover:bg-indigo-700 flex items-center gap-1",children:[e.jsx(zs,{size:12}),v.editCharacter]}),e.jsxs("button",{onClick:()=>j(o),className:"bg-red-500 text-white px-2 md:px-3 py-1 rounded text-xs hover:bg-red-600 flex items-center gap-1",children:[e.jsx(Es,{size:12}),v.deleteCharacter]})]})]}),((L=o.traits)==null?void 0:L.strengths)&&o.traits.strengths.length>0&&e.jsxs("p",{className:"text-xs text-gray-800 mb-1",children:[e.jsxs("strong",{className:"text-green-600",children:[v.strengths,":"]})," ",o.traits.strengths.join(", ")]}),((S=o.traits)==null?void 0:S.flaws)&&o.traits.flaws.length>0&&e.jsxs("p",{className:"text-xs text-gray-800 mb-1",children:[e.jsxs("strong",{className:"text-orange-600",children:[x==="de"?"SchwÃ¤chen":x==="fr"?"DÃ©fauts":"Flaws",":"]})," ",o.traits.flaws.join(", ")]}),((B=o.traits)==null?void 0:B.challenges)&&o.traits.challenges.length>0&&e.jsxs("p",{className:"text-xs text-gray-800 mb-1",children:[e.jsxs("strong",{className:"text-purple-600",children:[x==="de"?"Herausforderungen":x==="fr"?"DÃ©fis":"Challenges",":"]})," ",o.traits.challenges.join(", ")]})]},o.id)})})]}),e.jsxs("div",{className:"md:bg-indigo-50 md:border-2 md:border-indigo-200 md:rounded-lg p-4",children:[e.jsx("p",{className:"text-gray-800 mb-4 text-center font-semibold",children:x==="de"?"Was mochten Sie als Nachstes tun?":x==="fr"?"Que voulez-vous faire ensuite?":"What would you like to do next?"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx("button",{onClick:r,className:"bg-indigo-500 text-white px-6 py-3 rounded-lg hover:bg-indigo-600 font-semibold flex items-center justify-center gap-2 transition-colors",children:x==="de"?"Weiteren Charakter erstellen":x==="fr"?"Creer un autre personnage":"Create Another Character"}),e.jsx("button",{onClick:h,className:"bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 font-semibold flex items-center justify-center gap-2 transition-colors",children:x==="de"?"Weiter zu Beziehungen":x==="fr"?"Continuer vers les relations":"Continue to Relationships"})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"bg-red-100 text-red-600 rounded-full p-2",children:e.jsx(Cs,{size:24})}),e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:x==="de"?"Charakter lÃ¶schen?":x==="fr"?"Supprimer le personnage?":"Delete Character?"})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:x==="de"?`MÃ¶chtest du "${p.name}" wirklich lÃ¶schen? Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.`:x==="fr"?`Voulez-vous vraiment supprimer "${p.name}"? Cette action est irrÃ©versible.`:`Are you sure you want to delete "${p.name}"? This action cannot be undone.`}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:y,className:"flex-1 px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:x==="de"?"Abbrechen":x==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:z,className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 font-medium",children:x==="de"?"LÃ¶schen":x==="fr"?"Supprimer":"Delete"})]})]})})]})}function pt({label:t,traits:i,selectedTraits:d,onSelect:c,minRequired:r=0,allowCustom:h=!0}){const{t:v,language:x}=xe(),[p,$]=N.useState(""),[j,z]=N.useState([]),y=k=>{d.includes(k)?c(d.filter(L=>L!==k)):c([...d,k])},o=()=>{if(p.trim()&&!d.includes(p.trim())){const k=p.trim();z([...j,k]),c([...d,k]),$("")}},w=d.filter(k=>!i.includes(k)),D=[...new Set([...j,...w])],F=[...i,...D];return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-lg font-semibold mb-2 text-indigo-700",children:[t,r>0&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(",v.selectAtLeast," ",r,")"]}),d.length>0&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["- ",v.selected,": ",d.length]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:F.map(k=>e.jsx("button",{onClick:()=>y(k),className:`px-3 py-1 rounded-full text-sm transition-colors ${d.includes(k)?"bg-indigo-500 text-white":"bg-gray-200 text-gray-800 hover:bg-gray-300"}`,children:k},k))}),h&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:p,onChange:k=>$(k.target.value),onKeyDown:k=>k.key==="Enter"&&o(),placeholder:x==="de"?"Eigene hinzufÃ¼gen...":x==="fr"?"Ajouter personnalisÃ©...":"Add custom...",className:"flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-indigo-500 focus:outline-none"}),e.jsx("button",{onClick:o,disabled:!p.trim(),className:`flex-shrink-0 w-10 h-10 rounded-lg font-semibold flex items-center justify-center transition-colors ${p.trim()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:e.jsx(tt,{size:18})})]})]})}const Js={en:["Cheerful","Kind","Caring","Funny","Forgiving","Protective","Loyal","Generous","Fair-minded","Honest","Confident","Brave","Trustworthy","Determined","Hardworking","Leader","Patient","Curious","Imaginative","Smart","Creative","Observant","Resourceful","Energetic","Fast","Strong","Adventurous"],de:["FrÃ¶hlich","Freundlich","Hilfsbereit","Lustig","Nachsichtig","BeschÃ¼tzend","Treu","GrosszÃ¼gig","Gerecht","Ehrlich","Selbstbewusst","Mutig","VertrauenswÃ¼rdig","Entschlossen","Fleissig","Leader","Geduldig","Neugierig","Fantasievoll","Klug","Kreativ","Aufmerksam","Einfallsreich","Energiegeladen","Schnell","Stark","Abenteuerlustig"],fr:["Joyeux","Gentil","AttentionnÃ©","DrÃ´le","Indulgent","Protecteur","Loyal","GÃ©nÃ©reux","Ã‰quitable","HonnÃªte","Confiant","Courageux","Digne de confiance","DÃ©terminÃ©","Travailleur","Leader","Patient","Curieux","Imaginatif","Intelligent","CrÃ©atif","Observateur","DÃ©brouillard","Ã‰nergique","Rapide","Fort","Aventureux"]},Qs={en:["Impatient","Distracted","Talkative","Whiny","Messy","Forgetful","Tattletale","Sore Loser","Stubborn","Lying","Bossy","Gullible","Jealous","Easily scared","Clingy","Quick-tempered","Selfish","Sneaky","Reckless","Shy","Clumsy","Lazy","Boastful","Indecisive","Perfectionist"],de:["Ungeduldig","Zerstreut","GesprÃ¤chig","Weinerlich","Unordentlich","Vergesslich","Petze","Schlechter Verlierer","Stur","LÃ¼gnerisch","Rechthaberisch","LeichtglÃ¤ubig","EifersÃ¼chtig","Ã„ngstlich","AnhÃ¤nglich","JÃ¤hzornig","Egoistisch","Hinterlistig","Leichtsinnig","SchÃ¼chtern","Tollpatschig","Faul","Prahlerisch","Unentschlossen","Perfektionist"],fr:["Impatient","Distrait","Bavard","Pleurnicheur","DÃ©sordonnÃ©","Oublieux","Rapporteur","Mauvais perdant","TÃªtu","Menteur","Autoritaire","CrÃ©dule","Jaloux","Facilement effrayÃ©","Collant","ColÃ©rique","Ã‰goÃ¯ste","Sournois","Imprudent","Timide","Maladroit","Paresseux","Vantard","IndÃ©cis","Perfectionniste"]},Ys={en:["Following rules","Controlling emotions","Sharing with others","Tests and grades","Making new friends","Speaking in public","Trying new things","Accepting and asking for help","Dealing with change","Standing up for oneself","Fear of the dark","Bad dreams and nightmares","Monsters, ghosts and things under the bed","Fear of being alone","Fear of getting lost","Doctors, dentists and shots","Fear of heights","Fear of spiders","Fear of loud noises"],de:["Regeln befolgen","GefÃ¼hle kontrollieren","Mit anderen teilen","PrÃ¼fungsangst","Neue Freunde finden","Vor anderen sprechen","Neues ausprobieren","Hilfe annehmen und darum bitten","Mit VerÃ¤nderungen umgehen","FÃ¼r sich einstehen","Angst vor der Dunkelheit","AlbtrÃ¤ume und schlechte TrÃ¤ume","Monster, Geister und Dinge unter dem Bett","Angst allein zu sein","Angst sich zu verlaufen","Ã„rzte, ZahnÃ¤rzte und Spritzen","HÃ¶henangst","Angst vor Spinnen","Angst vor lauten GerÃ¤uschen"],fr:["Suivre les rÃ¨gles","ContrÃ´ler ses Ã©motions","Partager avec les autres","Examens et notes","Se faire de nouveaux amis","Parler en public","Essayer de nouvelles choses","Accepter et demander de l'aide","GÃ©rer le changement","Se dÃ©fendre","Peur du noir","Cauchemars et mauvais rÃªves","Monstres, fantÃ´mes et choses sous le lit","Peur d'Ãªtre seul","Peur de se perdre","MÃ©decins, dentistes et piqÃ»res","Peur du vide","Peur des araignÃ©es","Peur des bruits forts"]},_t=Js,Ht=Qs,Vt=Ys;function Zs(t,i){const d=i==="female";return`Subject: Generate a fashion photograph of the person in the input image.

CRITICAL PRIORITIES (in order):
1. FACE IDENTITY: The face MUST be an exact match to the input image - same facial features, skin tone, eye color, hair color and style. This is non-negotiable.
2. CLOTHING STYLE TRANSFER: Copy the EXACT pattern AND colors from the clothing in the input image. Apply these to the new outfit.

COMPOSITION:
- Framing: Wide shot. The entire outfit must be visible from head to toe.
- Background: Pure solid white background (#FFFFFF).

WARDROBE DETAILS:
- Style Transfer Rule: Copy the EXACT pattern AND colors from the clothing in the input image. Apply these to the new outfit.
- Pants Rule: If trousers/pants are visible in the input image, replicate them. If NOT visible, create plain/neutral pants - do NOT match the shirt pattern.
- Outfit: ${(()=>{switch(t){case"winter":return"Heavy winter coat or parka with the SAME pattern AND colors as the input image clothing. Layers visible underneath. Warm pants or leggings. Heavy winter boots. Scarf and gloves optional.";case"standard":return d?"Long-sleeved T-shirt, casual hoodie, or cozy sweater with the SAME pattern AND colors as the input image clothing. Jeans or leggings. Sneakers.":"Long-sleeved T-shirt, casual hoodie, or cozy sweater with the SAME pattern AND colors as the input image clothing. Jeans or casual trousers. Sneakers.";case"summer":return d?"T-shirt, casual sundress, or tank top with the SAME pattern AND colors as the input image clothing. Shorts or skirt. Sandals or flip-flops.":"T-shirt or tank top with the SAME pattern AND colors as the input image clothing. Shorts. Sandals or flip-flops.";case"formal":return d?"Elegant dress, formal gown, or blouse with skirt with the SAME pattern AND colors as the input image clothing (adapted elegantly). Formal heels or dress shoes.":"Formal suit or dress shirt with trousers with the SAME pattern AND colors as the input image clothing (adapted elegantly). Formal dress shoes.";default:return"Full outfit with shoes matching the style of the input image."}})()}

PHOTOGRAPHY STYLE:
- Style: High-End Editorial Photography.
- Lighting: Soft, evenly diffused studio lighting.
- Details: Sharp focus on fabric textures.
- Presentation: Clean, professional, magazine-quality look.

Output Quality: 4k, Photorealistic.`}function $e({label:t,value:i,placeholder:d,isEditing:c,editValue:r,onEditValueChange:h,onStartEdit:v,onSave:x,onCancel:p}){return e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-gray-600 text-xs",children:[t,":"]}),c?e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx("input",{type:"text",value:r,onChange:$=>h($.target.value),className:"flex-1 min-w-0 px-2 py-1 text-sm border border-indigo-300 rounded focus:outline-none focus:border-indigo-500",autoFocus:!0,placeholder:d,onKeyDown:$=>{$.key==="Enter"&&x(),$.key==="Escape"&&p()}}),e.jsx("button",{onClick:x,className:"flex-shrink-0 p-1 text-green-600 hover:bg-green-100 rounded",children:e.jsx(Yt,{size:14})}),e.jsx("button",{onClick:p,className:"flex-shrink-0 p-1 text-gray-500 hover:bg-gray-100 rounded",children:e.jsx(He,{size:14})})]}):e.jsxs("div",{onClick:v,className:"flex items-center gap-1 cursor-pointer hover:bg-purple-100 rounded px-2 py-1 -mx-2 -my-1 group",children:[e.jsx("p",{className:"text-gray-800 text-sm flex-1",children:i||e.jsx("span",{className:"text-gray-400 italic",children:d||"Click to set"})}),e.jsx(je,{size:12,className:"text-purple-400 group-hover:text-purple-600"})]})]})}function Ut({character:t,onChange:i,onSave:d,onCancel:c,onPhotoChange:r,onContinueToTraits:h,onRegenerateAvatars:v,isLoading:x,isAnalyzingPhoto:p,isRegeneratingAvatars:$,step:j,developerMode:z}){var Z,ie,E,re,q,X,ke,oe,te,me,he,pe,fe,s,I,P,f,O;const{t:y,language:o}=xe(),w=b=>{var ae;const U=(ae=b.target.files)==null?void 0:ae[0];U&&r(U)},D=(b,U)=>{i({...t,[b]:U})},F=(b,U)=>{i({...t,physical:{...t.physical,[b]:U}})},k=(b,U)=>{i({...t,traits:{...t.traits,[b]:U}})},[L,S]=N.useState(null),[B,M]=N.useState(""),R=(b,U)=>{const be={...t.referenceOutfit||{garmentType:"",primaryColor:"",secondaryColors:[],pattern:"",patternScale:"",seamColor:"",seamStyle:"",fabric:"",neckline:"",sleeves:"",accessories:[],setting:"neutral"}};b==="garmentType"?be.garmentType=U:b==="primaryColor"?be.primaryColor=U:b==="pattern"?be.pattern=U:b==="setting"&&(be.setting=U),i({...t,referenceOutfit:be})},_=()=>{if(L){const b=L.split(".");b[0]==="physical"?F(b[1],B):b[0]==="referenceOutfit"&&R(b[1],B)}S(null),M("")},H=()=>{S(null),M("")},G=N.useCallback((b,U)=>{S(b),M(U||"")},[]),ce=t.name&&t.name.trim().length>=2,ee=t.name&&((Z=t.traits)==null?void 0:Z.strengths)&&t.traits.strengths.length>=3&&((ie=t.traits)==null?void 0:ie.flaws)&&t.traits.flaws.length>=2,n=_t[o]||_t.en,ve=Ht[o]||Ht.en,T=Vt[o]||Vt.en,ne=((E=t.photos)==null?void 0:E.face)||((re=t.photos)==null?void 0:re.original);return j==="name"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[p?e.jsx("div",{className:"w-32 h-32 rounded-full bg-indigo-100 border-4 border-indigo-400 shadow-lg flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-3 border-indigo-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-indigo-600 font-medium",children:o==="de"?"Analysiere...":o==="fr"?"Analyse...":"Analyzing..."})]})}):ne?e.jsx("img",{src:ne,alt:"Character",className:"w-32 h-32 rounded-full object-cover border-4 border-indigo-400 shadow-lg"}):e.jsx("div",{className:"w-32 h-32 rounded-full bg-gray-200 border-4 border-gray-300 flex items-center justify-center",children:e.jsx(ze,{size:32,className:"text-gray-400"})}),e.jsxs("label",{className:"cursor-pointer bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm hover:bg-gray-300 flex items-center gap-2 font-semibold transition-colors",children:[e.jsx(ze,{size:16}),o==="de"?"Anderes Foto":o==="fr"?"Autre photo":"Change Photo",e.jsx("input",{type:"file",accept:"image/*",onChange:w,className:"hidden"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold mb-2 text-center",children:o==="de"?"Wie heisst diese Person?":o==="fr"?"Comment s'appelle cette personne?":"What is this person's name?"}),e.jsx("input",{type:"text",value:t.name,onChange:b=>D("name",b.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg text-center focus:border-indigo-500 focus:outline-none",placeholder:y.characterName,autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[c&&e.jsx("button",{onClick:c,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:y.cancel}),e.jsx(et,{onClick:h,disabled:!ce||x,loading:x,icon:Qt,className:c?"flex-1":"w-full",children:o==="de"?"Weiter":o==="fr"?"Continuer":"Continue"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex-shrink-0 relative group cursor-pointer",children:[p?e.jsx("div",{className:"w-20 h-20 rounded-full bg-indigo-100 border-2 border-indigo-400 flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"})}):ne?e.jsx("img",{src:ne,alt:t.name,className:"w-20 h-20 rounded-full object-cover border-2 border-indigo-400"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-200 border-2 border-gray-300 flex items-center justify-center",children:e.jsx(ze,{size:24,className:"text-gray-400"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ze,{size:20,className:"text-white"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-indigo-600 text-white rounded-full p-1.5 shadow-lg border-2 border-white",children:e.jsx(ze,{size:12})}),e.jsx("input",{type:"file",accept:"image/*",onChange:w,className:"hidden"})]}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:t.name})]}),z&&((q=t.photos)==null?void 0:q.bodyNoBg)&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-300 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-700 mb-2",children:"Body Crop (No Background)"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:t.photos.bodyNoBg,alt:`${t.name} body crop`,className:"max-h-48 object-contain rounded border border-gray-300",style:{background:"repeating-conic-gradient(#ccc 0% 25%, #fff 0% 50%) 50% / 20px 20px"}})})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-600 mb-3",children:o==="de"?"Grundinformationen":o==="fr"?"Informations de base":"Basic Info"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:y.gender}),e.jsxs("select",{value:t.gender,onChange:b=>D("gender",b.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm bg-white focus:border-indigo-500 focus:outline-none",children:[e.jsx("option",{value:"male",children:y.male}),e.jsx("option",{value:"female",children:y.female}),e.jsx("option",{value:"other",children:y.other})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:y.age}),e.jsx("input",{type:"number",value:t.age,onChange:b=>D("age",b.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:border-indigo-500 focus:outline-none",min:"1",max:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:o==="de"?"GrÃ¶sse (cm)":o==="fr"?"Taille (cm)":"Height (cm)"}),e.jsx("input",{type:"number",value:((X=t.physical)==null?void 0:X.height)||"",onChange:b=>F("height",b.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:border-indigo-500 focus:outline-none",placeholder:"cm",min:"50",max:"250"})]})]})]}),e.jsxs("details",{className:"bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("summary",{className:"p-4 cursor-pointer hover:bg-purple-100 rounded-lg",children:e.jsxs("span",{className:"text-sm font-semibold text-purple-700 inline-flex items-center gap-2",children:[o==="de"?"Physische Merkmale":o==="fr"?"CaractÃ©ristiques physiques":"Physical Features",e.jsxs("span",{className:"text-xs font-normal text-purple-500",children:["(",o==="de"?"klicken zum Bearbeiten":o==="fr"?"cliquez pour modifier":"click to edit",")"]})]})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx($e,{label:o==="de"?"Gesicht":o==="fr"?"Visage":"Face",value:((ke=t.physical)==null?void 0:ke.face)||"",placeholder:o==="de"?"z.B. rund, oval, eckig":"e.g. round, oval, square",isEditing:L==="physical.face",editValue:B,onEditValueChange:M,onStartEdit:()=>{var b;return G("physical.face",((b=t.physical)==null?void 0:b.face)||"")},onSave:_,onCancel:H}),e.jsx($e,{label:o==="de"?"Haare":o==="fr"?"Cheveux":"Hair",value:((oe=t.physical)==null?void 0:oe.hair)||"",placeholder:o==="de"?"z.B. braun, kurz, lockig":"e.g. brown, short, curly",isEditing:L==="physical.hair",editValue:B,onEditValueChange:M,onStartEdit:()=>{var b;return G("physical.hair",((b=t.physical)==null?void 0:b.hair)||"")},onSave:_,onCancel:H}),e.jsx($e,{label:o==="de"?"KÃ¶rperbau":o==="fr"?"Corpulence":"Build",value:((te=t.physical)==null?void 0:te.build)||"",placeholder:o==="de"?"z.B. schlank, athletisch":"e.g. slim, athletic",isEditing:L==="physical.build",editValue:B,onEditValueChange:M,onStartEdit:()=>{var b;return G("physical.build",((b=t.physical)==null?void 0:b.build)||"")},onSave:_,onCancel:H})]})})]}),z&&t.avatars&&e.jsxs("div",{className:"bg-teal-50 border border-teal-300 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-teal-700 mb-3 flex items-center gap-2",children:[o==="de"?"Kleidungs-Avatare":o==="fr"?"Avatars vestimentaires":"Clothing Avatars",t.avatars.status==="generating"&&e.jsxs("span",{className:"text-xs font-normal text-teal-500 flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-teal-500 border-t-transparent rounded-full animate-spin"}),o==="de"?"Generierung lÃ¤uft...":"Generating..."]}),t.avatars.status==="complete"&&e.jsx("span",{className:"text-xs font-normal text-green-600",children:"Complete"}),t.avatars.status==="failed"&&e.jsx("span",{className:"text-xs font-normal text-red-600",children:"Failed"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:["winter","standard","summer","formal"].map(b=>{var U,ae;return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-600 mb-2 capitalize",children:[b==="winter"?"â„ï¸ ":b==="summer"?"â˜€ï¸ ":b==="formal"?"ğŸ‘” ":"ğŸ‘• ",o==="de"?b==="winter"?"Winter":b==="summer"?"Sommer":b==="formal"?"Formal":"Standard":b]}),(U=t.avatars)!=null&&U[b]?e.jsx("img",{src:t.avatars[b],alt:`${t.name} - ${b}`,className:"w-full h-64 object-contain rounded border border-teal-200 bg-white"}):e.jsx("div",{className:"w-full h-64 rounded border border-dashed border-teal-300 bg-teal-100/50 flex items-center justify-center text-teal-400 text-xs",children:((ae=t.avatars)==null?void 0:ae.status)==="generating"?"...":"Not generated"}),z&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsx("summary",{className:"text-[10px] text-gray-400 cursor-pointer hover:text-gray-600",children:"Show prompt"}),e.jsx("pre",{className:"mt-1 p-2 bg-gray-100 rounded text-[9px] text-gray-600 whitespace-pre-wrap overflow-auto max-h-48 border",children:Zs(b,t.gender)})]})]},b)})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[t.avatars.generatedAt&&e.jsxs("div",{className:"text-xs text-teal-500",children:["Generated: ",new Date(t.avatars.generatedAt).toLocaleString()]}),v&&e.jsx("button",{onClick:v,disabled:$||((me=t.avatars)==null?void 0:me.status)==="generating",className:"px-3 py-1.5 text-xs font-medium bg-teal-600 text-white rounded hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:$?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),o==="de"?"Generiere...":"Generating..."]}):e.jsx(e.Fragment,{children:o==="de"?"Neu generieren":o==="fr"?"RÃ©gÃ©nÃ©rer":"Regenerate"})})]})]}),z&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-200 rounded-lg",children:[e.jsxs("summary",{className:"p-4 cursor-pointer text-sm font-semibold text-indigo-700 flex items-center gap-2 hover:bg-indigo-100 rounded-lg transition-colors",children:[o==="de"?"Referenz-Outfit (aus Foto)":o==="fr"?"Tenue de rÃ©fÃ©rence (de la photo)":"Reference Outfit (from photo)",e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",o==="de"?"klicken zum Erweitern":o==="fr"?"cliquez pour dÃ©velopper":"click to expand",")"]})]}),e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx($e,{label:o==="de"?"Kleidungsart":o==="fr"?"Type de vÃªtement":"Garment Type",value:((he=t.referenceOutfit)==null?void 0:he.garmentType)||"",placeholder:"e.g. t-shirt, dress",isEditing:L==="referenceOutfit.garmentType",editValue:B,onEditValueChange:M,onStartEdit:()=>{var b;return G("referenceOutfit.garmentType",((b=t.referenceOutfit)==null?void 0:b.garmentType)||"")},onSave:_,onCancel:H}),e.jsx($e,{label:o==="de"?"Hauptfarbe":o==="fr"?"Couleur principale":"Primary Color",value:((pe=t.referenceOutfit)==null?void 0:pe.primaryColor)||"",placeholder:"e.g. blue, red",isEditing:L==="referenceOutfit.primaryColor",editValue:B,onEditValueChange:M,onStartEdit:()=>{var b;return G("referenceOutfit.primaryColor",((b=t.referenceOutfit)==null?void 0:b.primaryColor)||"")},onSave:_,onCancel:H}),e.jsx($e,{label:o==="de"?"Muster":o==="fr"?"Motif":"Pattern",value:((fe=t.referenceOutfit)==null?void 0:fe.pattern)||"",placeholder:"e.g. stripes, solid",isEditing:L==="referenceOutfit.pattern",editValue:B,onEditValueChange:M,onStartEdit:()=>{var b;return G("referenceOutfit.pattern",((b=t.referenceOutfit)==null?void 0:b.pattern)||"")},onSave:_,onCancel:H}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-gray-600 text-xs",children:[o==="de"?"Umgebung":o==="fr"?"Contexte":"Setting",":"]}),e.jsxs("select",{value:((s=t.referenceOutfit)==null?void 0:s.setting)||"neutral",onChange:b=>R("setting",b.target.value),className:"w-full mt-0.5 px-2 py-1 text-xs border rounded focus:outline-none bg-gray-100 border-gray-300 text-gray-800",children:[e.jsx("option",{value:"neutral",children:"Neutral"}),e.jsx("option",{value:"outdoor-warm",children:o==="de"?"Draussen (warm)":"Outdoor (warm)"}),e.jsx("option",{value:"outdoor-cold",children:o==="de"?"Draussen (kalt)":"Outdoor (cold)"}),e.jsx("option",{value:"indoor-casual",children:o==="de"?"Drinnen (casual)":"Indoor (casual)"}),e.jsx("option",{value:"indoor-formal",children:o==="de"?"Drinnen (formal)":"Indoor (formal)"}),e.jsx("option",{value:"active",children:o==="de"?"Aktiv/Sport":"Active/Sports"}),e.jsx("option",{value:"sleep",children:o==="de"?"Schlaf":"Sleep"})]})]})]})})]}),e.jsx(pt,{label:y.strengths,traits:n,selectedTraits:((I=t.traits)==null?void 0:I.strengths)||[],onSelect:b=>k("strengths",b),minRequired:3}),e.jsx(pt,{label:o==="de"?"SchwÃ¤chen":o==="fr"?"DÃ©fauts":"Flaws",traits:ve,selectedTraits:((P=t.traits)==null?void 0:P.flaws)||[],onSelect:b=>k("flaws",b),minRequired:2}),e.jsx(pt,{label:o==="de"?"Konflikte / Herausforderungen":o==="fr"?"Conflits / DÃ©fis":"Conflicts / Challenges",traits:T,selectedTraits:((f=t.traits)==null?void 0:f.challenges)||[],onSelect:b=>k("challenges",b)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold mb-2",children:y.specialDetails}),e.jsx("textarea",{value:((O=t.traits)==null?void 0:O.specialDetails)||"",onChange:b=>k("specialDetails",b.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none",placeholder:y.specialDetailsPlaceholder,rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[c&&e.jsx("button",{onClick:c,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:y.cancel}),e.jsx(et,{onClick:d,disabled:!ee||x,loading:x,icon:Ve,className:c?"flex-1":"w-full",children:y.saveCharacter})]}),!ee&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:o==="de"?"Bitte mindestens 3 StÃ¤rken und 2 SchwÃ¤chen wÃ¤hlen":o==="fr"?"Veuillez sÃ©lectionner au moins 3 forces et 2 dÃ©fauts":"Please select at least 3 strengths and 2 flaws"})]})}function Xs({onPhotoSelect:t,showExamples:i=!0}){const{t:d,language:c}=xe(),r=v=>{var p;const x=(p=v.target.files)==null?void 0:p[0];x&&t(x)},h=c==="de"?"Deine Geschichte wird basierend auf den hochgeladenen Fotos erstellt. Verwende Fotos mit nur einer Person, idealerweise GanzkÃ¶rperaufnahmen, da auch die Kleidung in die Geschichte Ã¼bernommen wird.":c==="fr"?"Votre histoire sera gÃ©nÃ©rÃ©e Ã  partir des photos tÃ©lÃ©chargÃ©es. Utilisez des photos d'une seule personne, idÃ©alement en pied, car les vÃªtements seront Ã©galement intÃ©grÃ©s dans l'histoire.":"Your story will be generated based on the photos you upload. Use photos of a single person, ideally full body shots, as clothing will also be copied into the story.";return e.jsxs("div",{className:"bg-indigo-50 border-2 border-indigo-300 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-4 text-center",children:h}),e.jsx("div",{className:"text-center mb-5",children:e.jsxs("label",{className:"cursor-pointer inline-flex items-center justify-center gap-3 bg-indigo-600 text-white px-10 py-4 rounded-xl text-xl hover:bg-indigo-700 font-bold shadow-lg transition-colors",children:[e.jsx(ze,{size:28})," ",d.uploadPhoto,e.jsx("input",{type:"file",accept:"image/*",onChange:r,className:"hidden"})]})}),i&&e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/Full body.jpg",alt:"Full body example",className:"w-full md:max-h-32 object-contain rounded border-2 border-green-400 mb-1"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:c==="de"?"GanzkÃ¶rper":c==="fr"?"Corps entier":"Full body"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/Upper body.jpg",alt:"Upper body example",className:"w-full md:max-h-32 object-contain rounded border-2 border-green-400 mb-1"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:c==="de"?"OberkÃ¶rper":c==="fr"?"Buste":"Upper body"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/No zoomed in close up.jpg",alt:"Too close example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:c==="de"?"Zu nah / Unscharf":c==="fr"?"Trop proche / Flou":"Too close / Blurry"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/No sunglasses, hat or helmets.jpg",alt:"No accessories example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:c==="de"?"Brille / Hut / Helm":c==="fr"?"Lunettes / Chapeau":"Glasses / Hat / Helmet"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/One person not many.jpg",alt:"One person only example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:c==="de"?"Nur eine Person":c==="fr"?"Une seule personne":"Only one person"})]})]})})]})}function er(t,i){var r;if(!t)return"";const d=t.match(/^Image (\d+)\/(\d+)\.\.\.$/);if(d){const[,h,v]=d;return i==="de"?`Bild ${h}/${v}...`:i==="fr"?`Image ${h}/${v}...`:t}const c={"Writing story...":{de:"Geschichte wird geschrieben...",fr:"Ã‰criture de l'histoire..."},"Creating covers...":{de:"Cover werden erstellt...",fr:"CrÃ©ation des couvertures..."},"Generating picture book story and scenes...":{de:"Geschichte und Szenen werden erstellt...",fr:"CrÃ©ation de l'histoire et des scÃ¨nes..."},"Picture book complete!":{de:"Bilderbuch fertig!",fr:"Livre d'images terminÃ©!"},"Complete!":{de:"Fertig!",fr:"TerminÃ©!"}};return i==="en"?t:(r=c[t])!=null&&r[i]?c[t][i]:t}function tr({current:t,total:i,message:d,isGenerating:c=!0}){const{language:r}=xe(),{user:h}=Kt(),v=!!(h!=null&&h.email);if(!c||i===0)return null;const x=i===100?t:Math.round(t/i*100),p=er(d||"",r),$={en:{title:"Creating Your Story!",timeInfo:"This typically takes about 10 minutes.",emailInfo:"You will receive an email when your story is ready.",canClose:"You can wait here or close the browser - your story will keep generating.",noEmailInfo:"You can close this page and come back later."},de:{title:"Geschichte wird erstellt!",timeInfo:"Dies dauert normalerweise etwa 10 Minuten.",emailInfo:"Du erhÃ¤ltst eine E-Mail, wenn deine Geschichte bereit ist.",canClose:"Du kannst hier warten oder den Browser schlieÃŸen - deine Geschichte wird weiter generiert.",noEmailInfo:"Du kannst diese Seite schlieÃŸen und spÃ¤ter zurÃ¼ckkommen."},fr:{title:"CrÃ©ation de votre histoire!",timeInfo:"Cela prend gÃ©nÃ©ralement environ 10 minutes.",emailInfo:"Vous recevrez un email quand votre histoire sera prÃªte.",canClose:"Vous pouvez attendre ici ou fermer le navigateur - votre histoire continuera Ã  Ãªtre gÃ©nÃ©rÃ©e.",noEmailInfo:"Vous pouvez fermer cette page et revenir plus tard."}},j=$[r]||$.en;return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"relative inline-block mb-3",children:[e.jsx(Xe,{size:48,className:"animate-spin text-indigo-600"}),e.jsx("span",{className:"absolute -top-1 -right-1 text-xl",children:"âœ¨"})]}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-800",children:j.title})]}),e.jsx("div",{className:"mb-4",children:e.jsx(qs,{value:x,max:100,showPercentage:!0,size:"lg"})}),p&&e.jsx("p",{className:"text-indigo-600 text-sm text-center font-medium mb-4",children:p}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(Fs,{size:16,className:"text-gray-500 shrink-0"}),e.jsx("p",{className:"text-sm",children:j.timeInfo})]}),v?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(Lt,{size:16,className:"text-gray-500 shrink-0"}),e.jsxs("p",{className:"text-sm",children:[j.emailInfo," ",e.jsxs("span",{className:"text-gray-500",children:["(",h==null?void 0:h.email,")"]})]})]}),e.jsx("p",{className:"text-sm text-gray-600 pl-6",children:j.canClose})]}):e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(Lt,{size:16,className:"text-gray-500 shrink-0"}),e.jsx("p",{className:"text-sm",children:j.noEmailInfo})]})]})]})})}function qe({retryHistory:t,totalAttempts:i,language:d}){return!t||t.length===0?null:e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Is,{size:14}),d==="de"?"Generierungshistorie":d==="fr"?"Historique de gÃ©nÃ©ration":"Generation History"]}),e.jsxs("span",{className:"text-purple-600",children:[i," ",d==="de"?"Versuche":d==="fr"?"tentatives":"attempts"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:t.map((c,r)=>e.jsxs("div",{className:`border rounded-lg p-3 ${r===t.length-1?"bg-green-50 border-green-300":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-sm",children:[d==="de"?`Versuch ${c.attempt}`:d==="fr"?`Tentative ${c.attempt}`:`Attempt ${c.attempt}`,c.type==="text_edit"&&e.jsx("span",{className:"text-xs ml-2 text-blue-600",children:"(text edit)"}),c.type==="text_edit_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(text edit failed)"}),r===t.length-1&&e.jsx("span",{className:"text-xs ml-2 text-green-600 font-bold",children:"âœ“ USED"})]}),c.score!==void 0&&e.jsxs("span",{className:`font-bold ${c.score>=70?"text-green-600":c.score>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(c.score),"%"]})]}),c.error&&e.jsxs("div",{className:"text-xs text-red-600 mb-2",children:["Error: ",c.error]}),c.textIssue&&c.textIssue!=="NONE"&&e.jsxs("div",{className:"text-xs text-orange-600 mb-2",children:["Text issue: ",c.textIssue,c.expectedText&&e.jsxs("span",{className:"block",children:['Expected: "',c.expectedText,'"']}),c.actualText&&e.jsxs("span",{className:"block",children:['Actual: "',c.actualText,'"']})]}),c.reasoning&&e.jsxs("details",{className:"text-xs text-gray-600 mb-2",children:[e.jsx("summary",{className:"cursor-pointer",children:"Feedback"}),e.jsx("p",{className:"mt-1 whitespace-pre-wrap bg-gray-50 p-2 rounded",children:c.reasoning})]}),c.imageData&&e.jsxs("details",{children:[e.jsx("summary",{className:"cursor-pointer text-xs text-blue-600",children:d==="de"?"Bild anzeigen":d==="fr"?"Voir image":"View image"}),e.jsx("img",{src:c.imageData,alt:`Attempt ${c.attempt}`,className:`mt-2 w-full rounded border ${r===t.length-1?"border-green-300":"border-gray-200 opacity-75"}`})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(c.timestamp).toLocaleTimeString()})]},r))})]})}function _e({referencePhotos:t,language:i}){var v;if(!t||t.length===0)return null;const d=x=>{switch(x){case"bodyNoBg":case"body-no-bg":return i==="de"?"GanzkÃ¶rper (freigestellt)":i==="fr"?"Corps entier (dÃ©tourÃ©)":"Full body (no bg)";case"body":return i==="de"?"GanzkÃ¶rper":i==="fr"?"Corps entier":"Full body";case"face":return i==="de"?"Gesicht":i==="fr"?"Visage":"Face only";case"clothing-winter":return i==="de"?"Winter-Avatar":i==="fr"?"Avatar hiver":"Winter avatar";case"clothing-summer":return i==="de"?"Sommer-Avatar":i==="fr"?"Avatar Ã©tÃ©":"Summer avatar";case"clothing-formal":return i==="de"?"Formell-Avatar":i==="fr"?"Avatar formel":"Formal avatar";case"clothing-standard":return i==="de"?"Standard-Avatar":i==="fr"?"Avatar standard":"Standard avatar";case"none":return i==="de"?"Kein Foto":i==="fr"?"Pas de photo":"No photo";default:return x}},c=x=>{switch(x){case"bodyNoBg":case"body-no-bg":return"bg-green-100 text-green-700 border-green-300";case"body":return"bg-blue-100 text-blue-700 border-blue-300";case"face":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"clothing-winter":return"bg-cyan-100 text-cyan-700 border-cyan-300";case"clothing-summer":return"bg-orange-100 text-orange-700 border-orange-300";case"clothing-formal":return"bg-purple-100 text-purple-700 border-purple-300";case"clothing-standard":return"bg-teal-100 text-teal-700 border-teal-300";case"none":return"bg-red-100 text-red-700 border-red-300";default:return"bg-gray-100 text-gray-700 border-gray-300"}},r=(v=t.find(x=>x.clothingCategory))==null?void 0:v.clothingCategory,h=x=>{if(!x)return"";switch(x){case"winter":return i==="de"?"Winter":i==="fr"?"Hiver":"Winter";case"summer":return i==="de"?"Sommer":i==="fr"?"Ã‰tÃ©":"Summer";case"formal":return i==="de"?"Formell":i==="fr"?"Formel":"Formal";case"standard":return"Standard";default:return x}};return e.jsxs("details",{className:"bg-pink-50 border border-pink-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-900 flex items-center gap-2",children:[e.jsx("span",{children:"ğŸ“¸"}),i==="de"?"Referenzfotos":i==="fr"?"Photos de rÃ©fÃ©rence":"Reference Photos",e.jsxs("span",{className:"text-xs text-pink-600",children:["(",t.length,")"]}),r&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-pink-200 text-pink-800 text-xs rounded",children:["ğŸ‘• ",h(r)]})]}),e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2",children:t.map((x,p)=>e.jsxs("div",{className:"bg-white rounded-lg p-2 border border-pink-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:x.name}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap ${c(x.photoType)}`,children:d(x.photoType)})]}),x.photoUrl&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:x.photoUrl,alt:`${x.name} - ${d(x.photoType)}`,className:"w-full max-h-32 object-contain rounded border border-gray-200 bg-gray-50"}),x.photoHash&&e.jsxs("div",{className:"mt-1 text-[9px] font-mono text-gray-500 bg-gray-100 px-1 py-0.5 rounded text-center",children:["ğŸ” ",x.photoHash]})]})]},p))})]})}function sr({title:t,story:i,outline:d,outlinePrompt:c,storyTextPrompts:r=[],visualBible:h,sceneImages:v,sceneDescriptions:x=[],coverImages:p,languageLevel:$="standard",isGenerating:j=!1,onDownloadPdf:z,onBuyBook:y,onPrintBook:o,onCreateAnother:w,onDownloadTxt:D,onRegenerateImage:F,onRegenerateCover:k,onEditImage:L,onEditCover:S,onVisualBibleChange:B,storyId:M,developerMode:R=!1,isPartial:_=!1,failureReason:H,generatedPages:G,totalPages:ce}){const{t:ee,language:n}=xe(),ve=$==="1st-grade",[T,ne]=N.useState(null),[Z,ie]=N.useState(""),E=(s,I,P,f)=>{ne({type:s,id:I,field:P}),ie(f||"")},re=()=>{if(!T||!h||!B)return;const{type:s,id:I,field:P}=T,f={...h};if(s==="secondaryCharacter")f.secondaryCharacters=(f.secondaryCharacters||[]).map(O=>O.id===I?{...O,[P]:Z}:O);else if(s==="animal")f.animals=(f.animals||[]).map(O=>O.id===I?{...O,[P]:Z}:O);else if(s==="artifact")f.artifacts=(f.artifacts||[]).map(O=>O.id===I?{...O,[P]:Z}:O);else if(s==="location")f.locations=(f.locations||[]).map(O=>O.id===I?{...O,[P]:Z}:O);else if(s==="mainCharacter"){const O=parseInt(I);f.mainCharacters=(f.mainCharacters||[]).map(b=>b.id!==O?b:P==="physical.face"?{...b,physical:{...b.physical,face:Z}}:P==="physical.hair"?{...b,physical:{...b.physical,hair:Z}}:P==="physical.build"?{...b,physical:{...b.physical,build:Z}}:b)}B(f),ne(null),ie("")},q=()=>{ne(null),ie("")},ke=(s=>s?s.split(/(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i).slice(1).filter(P=>P.trim().length>0):[])(i),oe=v.length>0,te=s=>s?typeof s=="string"?s:s.imageData||null:null,me=s=>s?typeof s=="string"?{imageData:s}:s:null,he=s=>{var f;const I=(f=x.find(O=>O.pageNumber===s))==null?void 0:f.description;if(I)return I;const P=v.find(O=>O.pageNumber===s);return P==null?void 0:P.description},pe=s=>{var I;return(I=x.find(P=>P.pageNumber===s))==null?void 0:I.outlineExtract},fe=s=>{var I;return(I=x.find(P=>P.pageNumber===s))==null?void 0:I.scenePrompt};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-800 text-center",children:t||ee.yourStory}),_&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-400 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-amber-500 text-2xl",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-amber-800",children:n==="de"?"UnvollstÃ¤ndige Geschichte":n==="fr"?"Histoire incomplÃ¨te":"Incomplete Story"}),e.jsx("p",{className:"text-amber-700 text-sm mt-1",children:n==="de"?`Diese Geschichte konnte nicht vollstÃ¤ndig generiert werden. ${G||v.length} von ${ce||"unbekannt"} Seiten wurden erstellt.`:n==="fr"?`Cette histoire n'a pas pu Ãªtre gÃ©nÃ©rÃ©e complÃ¨tement. ${G||v.length} sur ${ce||"inconnu"} pages ont Ã©tÃ© crÃ©Ã©es.`:`This story could not be fully generated. ${G||v.length} of ${ce||"unknown"} pages were created.`}),H&&R&&e.jsxs("details",{className:"mt-2 text-sm",children:[e.jsx("summary",{className:"cursor-pointer text-amber-600 hover:text-amber-700",children:n==="de"?"Fehlerdetails":n==="fr"?"DÃ©tails de l'erreur":"Error details"}),e.jsx("p",{className:"mt-1 bg-amber-100 p-2 rounded text-amber-800 font-mono text-xs",children:H})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[R&&D&&e.jsxs("button",{onClick:D,className:"bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 font-semibold flex items-center justify-center gap-2",children:[e.jsx(Ts,{size:20})," ",ee.downloadTXT]}),oe&&z&&e.jsxs("button",{onClick:z,disabled:j,className:`bg-green-500 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${j?"opacity-50 cursor-not-allowed":"hover:bg-green-600"}`,children:[e.jsx(Be,{size:20})," ",n==="de"?"PDF herunterladen":n==="fr"?"TÃ©lÃ©charger PDF":"Download PDF"]}),oe&&M&&y&&e.jsxs("button",{onClick:y,disabled:j,className:`bg-indigo-500 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${j?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Mt,{size:20})," ",n==="de"?"Buch kaufen (CHF 36)":n==="fr"?"Acheter le livre (CHF 36)":"Buy Book (CHF 36)"]}),R&&oe&&M&&o&&e.jsxs("button",{onClick:o,disabled:j,className:`bg-yellow-500 text-black px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${j?"opacity-50 cursor-not-allowed":"hover:bg-yellow-600"}`,children:[e.jsx(Ze,{size:20})," ",n==="de"?"Buch drucken (DEV)":n==="fr"?"Imprimer livre (DEV)":"Print Book (DEV)"]}),w&&e.jsxs("button",{onClick:w,disabled:j,className:`bg-indigo-500 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 sm:col-span-2 lg:col-span-1 ${j?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(tt,{size:20})," ",ee.createAnotherStory]})]}),R&&e.jsxs("div",{className:"space-y-4 mt-6",children:[d&&e.jsxs("details",{className:"bg-purple-50 border-2 border-purple-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-purple-800 hover:text-purple-900 flex items-center gap-2",children:[e.jsx(Be,{size:20}),n==="de"?"Story-Ãœbersicht (Outline)":n==="fr"?"AperÃ§u de l'histoire":"Story Overview (Outline)"]}),e.jsx("pre",{className:"mt-4 text-sm text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-96 overflow-y-auto",children:d})]}),i&&e.jsxs("details",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(Ze,{size:20}),n==="de"?"VollstÃ¤ndiger Story-Text":n==="fr"?"Texte complet de l'histoire":"Full Story Text"]}),e.jsx("pre",{className:"mt-4 text-sm text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-96 overflow-y-auto",children:i})]}),c&&e.jsxs("details",{className:"bg-cyan-50 border-2 border-cyan-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-cyan-800 hover:text-cyan-900 flex items-center gap-2",children:[e.jsx(Be,{size:20}),n==="de"?"API-Prompt: Outline":n==="fr"?"Prompt API: Plan":"API Prompt: Outline"]}),e.jsx("pre",{className:"mt-4 text-sm text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-cyan-200 overflow-x-auto max-h-96 overflow-y-auto",children:c})]}),r.length>0&&e.jsxs("details",{className:"bg-teal-50 border-2 border-teal-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-teal-800 hover:text-teal-900 flex items-center gap-2",children:[e.jsx(Be,{size:20}),n==="de"?`API-Prompts: Story-Text (${r.length} Batches)`:n==="fr"?`Prompts API: Texte (${r.length} lots)`:`API Prompts: Story Text (${r.length} batches)`]}),e.jsx("div",{className:"mt-4 space-y-4",children:r.map(s=>e.jsxs("details",{className:"bg-white border border-teal-200 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-teal-700",children:n==="de"?`Batch ${s.batch}: Seiten ${s.startPage}-${s.endPage}`:n==="fr"?`Lot ${s.batch}: Pages ${s.startPage}-${s.endPage}`:`Batch ${s.batch}: Pages ${s.startPage}-${s.endPage}`}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-gray-50 p-3 rounded border overflow-x-auto max-h-64 overflow-y-auto",children:s.prompt})]},s.batch))})]}),h&&e.jsxs("details",{className:"bg-rose-50 border-2 border-rose-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-rose-800 hover:text-rose-900 flex items-center gap-2",children:[e.jsx(Ze,{size:20}),n==="de"?"Visual Bible (Wiederkehrende Elemente)":n==="fr"?"Bible Visuelle (Ã‰lÃ©ments RÃ©currents)":"Visual Bible (Recurring Elements)",h.changeLog&&h.changeLog.length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-rose-200 text-rose-800 rounded-full text-xs font-medium",children:[h.changeLog.length," ",n==="de"?"Ã„nderungen":n==="fr"?"changements":"changes"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[h.mainCharacters&&h.mainCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-purple-300 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-purple-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ğŸ‘—"}),n==="de"?"Hauptcharaktere (Style Profile)":n==="fr"?"Personnages Principaux (Profil Style)":"Main Characters (Style Profile)"]}),e.jsx("div",{className:"space-y-3",children:h.mainCharacters.map(s=>{var I,P,f,O,b,U,ae,be,Ne,we;return e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-sm",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-800 hover:text-purple-900",children:[s.name,e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded text-xs font-medium ${((I=s.referenceOutfit)==null?void 0:I.setting)==="outdoor-cold"?"bg-blue-100 text-blue-800":((P=s.referenceOutfit)==null?void 0:P.setting)==="outdoor-warm"?"bg-yellow-100 text-yellow-800":((f=s.referenceOutfit)==null?void 0:f.setting)==="indoor-casual"?"bg-green-100 text-green-800":((O=s.referenceOutfit)==null?void 0:O.setting)==="indoor-formal"?"bg-purple-100 text-purple-800":((b=s.referenceOutfit)==null?void 0:b.setting)==="active"?"bg-orange-100 text-orange-800":((U=s.referenceOutfit)==null?void 0:U.setting)==="sleep"?"bg-indigo-100 text-indigo-800":"bg-gray-100 text-gray-800"}`,children:((ae=s.referenceOutfit)==null?void 0:ae.setting)||"neutral"}),Object.keys(s.generatedOutfits||{}).length>0&&e.jsxs("span",{className:"ml-1 px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:[Object.keys(s.generatedOutfits).length," ",n==="de"?"Outfits":n==="fr"?"tenues":"outfits"]})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Physical:"}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[((be=s.physical)==null?void 0:be.face)||"Not analyzed"," | ",((Ne=s.physical)==null?void 0:Ne.hair)||"N/A"," | ",((we=s.physical)==null?void 0:we.build)||"N/A"]})]}),s.referenceOutfit&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Reference:"}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[s.referenceOutfit.garmentType," in ",s.referenceOutfit.primaryColor,s.referenceOutfit.pattern&&s.referenceOutfit.pattern!=="solid"&&s.referenceOutfit.pattern!=="none"&&` (${s.referenceOutfit.pattern})`]})]}),s.generatedOutfits&&Object.keys(s.generatedOutfits).length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-200",children:[e.jsx("span",{className:"font-medium text-gray-600 text-xs",children:"Generated Outfits:"}),e.jsx("div",{className:"mt-1 space-y-1",children:Object.entries(s.generatedOutfits).map(([Se,ye])=>{var Pe;return e.jsxs("div",{className:"bg-white p-1.5 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-purple-600",children:["Page ",Se,":"]}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[(Pe=ye.outfit)==null?void 0:Pe.substring(0,80),"..."]}),e.jsx("span",{className:`ml-1 px-1 py-0.5 rounded text-[10px] ${ye.setting==="outdoor-cold"?"bg-blue-100 text-blue-700":ye.setting==="outdoor-warm"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:ye.setting})]},Se)})})]})]})]},s.id)})})]}),h.secondaryCharacters&&h.secondaryCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:n==="de"?"Nebencharaktere":n==="fr"?"Personnages Secondaires":"Secondary Characters"}),e.jsx("div",{className:"space-y-2",children:h.secondaryCharacters.map(s=>e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800",children:[s.name," ",e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(T==null?void 0:T.type)==="secondaryCharacter"&&(T==null?void 0:T.id)===s.id&&(T==null?void 0:T.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:Z,onChange:I=>ie(I.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:re,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Ve,{size:12})," Save"]}),e.jsxs("button",{onClick:q,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(He,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),R&&B&&e.jsx("button",{onClick:()=>E("secondaryCharacter",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(je,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id))})]}),h.animals.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:n==="de"?"Tiere & Wesen":n==="fr"?"Animaux & CrÃ©atures":"Animals & Creatures"}),e.jsx("div",{className:"space-y-2",children:h.animals.map(s=>e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800",children:[s.name," ",e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(T==null?void 0:T.type)==="animal"&&(T==null?void 0:T.id)===s.id&&(T==null?void 0:T.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:Z,onChange:I=>ie(I.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:re,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Ve,{size:12})," Save"]}),e.jsxs("button",{onClick:q,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(He,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),R&&B&&e.jsx("button",{onClick:()=>E("animal",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(je,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id))})]}),h.artifacts.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:n==="de"?"Artefakte & Objekte":n==="fr"?"Artefacts & Objets":"Artifacts & Objects"}),e.jsx("div",{className:"space-y-2",children:h.artifacts.map(s=>e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800",children:[s.name," ",e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(T==null?void 0:T.type)==="artifact"&&(T==null?void 0:T.id)===s.id&&(T==null?void 0:T.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:Z,onChange:I=>ie(I.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:re,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Ve,{size:12})," Save"]}),e.jsxs("button",{onClick:q,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(He,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),R&&B&&e.jsx("button",{onClick:()=>E("artifact",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(je,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id))})]}),h.locations.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:n==="de"?"Wiederkehrende Orte":n==="fr"?"Lieux RÃ©currents":"Recurring Locations"}),e.jsx("div",{className:"space-y-2",children:h.locations.map(s=>e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800",children:[s.name," ",e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(T==null?void 0:T.type)==="location"&&(T==null?void 0:T.id)===s.id&&(T==null?void 0:T.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:Z,onChange:I=>ie(I.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:re,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Ve,{size:12})," Save"]}),e.jsxs("button",{onClick:q,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(He,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),R&&B&&e.jsx("button",{onClick:()=>E("location",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(je,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id))})]}),h.changeLog&&h.changeLog.length>0&&e.jsxs("details",{className:"bg-white border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-bold text-amber-700 hover:text-amber-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ğŸ“"}),n==="de"?"Ã„nderungsprotokoll":n==="fr"?"Journal des Modifications":"Change Log",e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-amber-100 text-amber-700 rounded text-xs",children:h.changeLog.length})]}),e.jsx("div",{className:"mt-2 space-y-1 max-h-64 overflow-y-auto",children:h.changeLog.slice().reverse().map((s,I)=>{var P;return e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs border-l-2 border-amber-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${s.type==="mainCharacter"?"bg-purple-100 text-purple-700":s.type==="secondaryCharacter"?"bg-rose-100 text-rose-700":s.type==="generatedOutfit"?"bg-green-100 text-green-700":s.type==="animal"?"bg-orange-100 text-orange-700":s.type==="artifact"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:s.type}),e.jsx("span",{className:"font-semibold text-amber-800",children:s.element}),e.jsxs("span",{className:"text-gray-500",children:[n==="de"?"Seite":"Page"," ",s.page]})]}),e.jsxs("div",{className:"mt-1 text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:[s.change,":"]}),e.jsxs("span",{className:"ml-1 text-gray-700",children:[(P=s.after)==null?void 0:P.substring(0,100),s.after&&s.after.length>100?"...":""]})]}),s.before&&e.jsxs("div",{className:"text-gray-400 line-through text-[10px] mt-0.5",children:[n==="de"?"Vorher":n==="fr"?"Avant":"Before",": ",s.before.substring(0,50),"..."]}),e.jsx("div",{className:"text-gray-400 text-[10px] mt-0.5",children:new Date(s.timestamp).toLocaleTimeString()})]},I)})})]}),(!h.mainCharacters||h.mainCharacters.length===0)&&(!h.secondaryCharacters||h.secondaryCharacters.length===0)&&(!h.animals||h.animals.length===0)&&(!h.artifacts||h.artifacts.length===0)&&(!h.locations||h.locations.length===0)&&e.jsx("div",{className:"text-gray-500 text-sm italic",children:n==="de"?"Keine wiederkehrenden Elemente gefunden":n==="fr"?"Aucun Ã©lÃ©ment rÃ©current trouvÃ©":"No recurring elements found in this story"})]})]})]}),p&&(te(p.frontCover)||te(p.initialPage)||te(p.backCover))&&e.jsxs("div",{className:"bg-indigo-50 border-2 border-indigo-200 rounded-xl p-6 mt-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ze,{size:24})," ",n==="de"?"Buchcover":n==="fr"?"Couvertures":"Book Covers"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[te(p.frontCover)&&(()=>{const s=me(p.frontCover);return e.jsxs("div",{className:"bg-white border-2 border-indigo-300 rounded-lg p-4 shadow-lg",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-800 mb-3",children:n==="de"?"Titelseite":n==="fr"?"Couverture":"Front Cover"}),e.jsx("img",{src:te(p.frontCover),alt:"Front Cover",className:"w-full rounded-lg shadow-md"}),R&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[k&&e.jsxs("button",{onClick:()=>k("front"),disabled:j,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${j?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Le,{size:14})," ",n==="de"?"Neu":"Regen"]}),S&&e.jsxs("button",{onClick:()=>S("front"),disabled:j,className:`flex-1 bg-gray-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${j?"opacity-50 cursor-not-allowed":"hover:bg-gray-600"}`,children:[e.jsx(je,{size:14})," ",n==="de"?"Bearbeiten":"Edit"]})]}),(s==null?void 0:s.description)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800",children:n==="de"?"Szenenbeschreibung":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border overflow-x-auto",children:s.description})]}),(s==null?void 0:s.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800",children:n==="de"?"API-Prompt":"API Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border overflow-x-auto max-h-48 overflow-y-auto",children:s.prompt})]}),(s==null?void 0:s.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 flex items-center justify-between",children:[e.jsx("span",{children:n==="de"?"QualitÃ¤t":"Quality"}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsx("div",{className:"mt-2 text-xs bg-white p-3 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})})]}),(s==null?void 0:s.retryHistory)&&s.retryHistory.length>0&&e.jsx(qe,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:n}),(s==null?void 0:s.referencePhotos)&&s.referencePhotos.length>0&&e.jsx(_e,{referencePhotos:s.referencePhotos,language:n})]})]})})(),te(p.initialPage)&&(()=>{const s=me(p.initialPage);return e.jsxs("div",{className:"bg-white border-2 border-indigo-300 rounded-lg p-4 shadow-lg",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-800 mb-3",children:n==="de"?"Einleitungsseite":n==="fr"?"Page d'introduction":"Initial Page"}),e.jsx("img",{src:te(p.initialPage),alt:"Initial Page",className:"w-full rounded-lg shadow-md"}),R&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[k&&e.jsxs("button",{onClick:()=>k("initial"),disabled:j,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${j?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Le,{size:14})," ",n==="de"?"Neu":"Regen"]}),S&&e.jsxs("button",{onClick:()=>S("initial"),disabled:j,className:`flex-1 bg-gray-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${j?"opacity-50 cursor-not-allowed":"hover:bg-gray-600"}`,children:[e.jsx(je,{size:14})," ",n==="de"?"Bearbeiten":"Edit"]})]}),(s==null?void 0:s.description)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800",children:n==="de"?"Szenenbeschreibung":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border overflow-x-auto",children:s.description})]}),(s==null?void 0:s.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800",children:n==="de"?"API-Prompt":"API Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border overflow-x-auto max-h-48 overflow-y-auto",children:s.prompt})]}),(s==null?void 0:s.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 flex items-center justify-between",children:[e.jsx("span",{children:n==="de"?"QualitÃ¤t":"Quality"}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsx("div",{className:"mt-2 text-xs bg-white p-3 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})})]}),(s==null?void 0:s.retryHistory)&&s.retryHistory.length>0&&e.jsx(qe,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:n}),(s==null?void 0:s.referencePhotos)&&s.referencePhotos.length>0&&e.jsx(_e,{referencePhotos:s.referencePhotos,language:n})]})]})})(),te(p.backCover)&&(()=>{const s=me(p.backCover);return e.jsxs("div",{className:"bg-white border-2 border-indigo-300 rounded-lg p-4 shadow-lg",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-800 mb-3",children:n==="de"?"RÃ¼ckseite":n==="fr"?"QuatriÃ¨me de couverture":"Back Cover"}),e.jsx("img",{src:te(p.backCover),alt:"Back Cover",className:"w-full rounded-lg shadow-md"}),R&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[k&&e.jsxs("button",{onClick:()=>k("back"),disabled:j,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${j?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Le,{size:14})," ",n==="de"?"Neu":"Regen"]}),S&&e.jsxs("button",{onClick:()=>S("back"),disabled:j,className:`flex-1 bg-gray-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${j?"opacity-50 cursor-not-allowed":"hover:bg-gray-600"}`,children:[e.jsx(je,{size:14})," ",n==="de"?"Bearbeiten":"Edit"]})]}),(s==null?void 0:s.description)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800",children:n==="de"?"Szenenbeschreibung":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border overflow-x-auto",children:s.description})]}),(s==null?void 0:s.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800",children:n==="de"?"API-Prompt":"API Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border overflow-x-auto max-h-48 overflow-y-auto",children:s.prompt})]}),(s==null?void 0:s.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 flex items-center justify-between",children:[e.jsx("span",{children:n==="de"?"QualitÃ¤t":"Quality"}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsx("div",{className:"mt-2 text-xs bg-white p-3 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})})]}),(s==null?void 0:s.retryHistory)&&s.retryHistory.length>0&&e.jsx(qe,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:n}),(s==null?void 0:s.referencePhotos)&&s.referencePhotos.length>0&&e.jsx(_e,{referencePhotos:s.referencePhotos,language:n})]})]})})()]})]}),oe&&i&&e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 text-center mb-6",children:t||(n==="de"?"Ihre Geschichte":n==="fr"?"Votre histoire":"Your Story")}),ke.map((s,I)=>{const P=I+1,f=v.find(O=>O.pageNumber===P);return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-4 text-center",children:n==="de"?`Seite ${P}`:n==="fr"?`Page ${P}`:`Page ${P}`}),ve?e.jsxs("div",{className:"flex flex-col items-center max-w-2xl mx-auto",children:[f&&f.imageData?e.jsxs("div",{className:"w-full mb-4",children:[e.jsx("img",{src:f.imageData,alt:`Scene for page ${P}`,className:"w-full rounded-lg shadow-md object-cover"}),R&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[F&&e.jsxs("button",{onClick:()=>F(P),disabled:j,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${j?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Le,{size:14})," ",n==="de"?"Neu generieren":"Regenerate"]}),L&&e.jsxs("button",{onClick:()=>L(P),disabled:j,className:`flex-1 bg-gray-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${j?"opacity-50 cursor-not-allowed":"hover:bg-gray-600"}`,children:[e.jsx(je,{size:14})," ",n==="de"?"Bearbeiten":"Edit"]})]}),pe(P)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:n==="de"?"Auszug aus Gliederung":n==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:pe(P)})]}),fe(P)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:n==="de"?"Szenen-Prompt":n==="fr"?"Prompt de scÃ¨ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-64 overflow-y-auto",children:fe(P)})]}),he(P)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:n==="de"?"Szenenbeschreibung":n==="fr"?"Description de scÃ¨ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:he(P)})]}),f.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[n==="de"?"API-Prompt":n==="fr"?"Prompt API":"API Prompt",f.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",f.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:f.prompt})]}),f.referencePhotos&&f.referencePhotos.length>0&&e.jsx(_e,{referencePhotos:f.referencePhotos,language:n}),f.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsx("span",{children:n==="de"?"QualitÃ¤tsbewertung":n==="fr"?"Score de qualitÃ©":"Quality Score"}),e.jsxs("span",{className:`text-lg font-bold ${f.qualityScore>=70?"text-green-600":f.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(f.qualityScore),"%"]})]}),f.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:n==="de"?"Feedback:":n==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:f.qualityReasoning})]})]}),f.retryHistory&&f.retryHistory.length>0&&e.jsx(qe,{retryHistory:f.retryHistory,totalAttempts:f.totalAttempts||f.retryHistory.length,language:n}),f.wasRegenerated&&(!f.retryHistory||f.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["ğŸ”„ ",n==="de"?"Bild regeneriert":n==="fr"?"Image rÃ©gÃ©nÃ©rÃ©e":"Image Regenerated"]}),f.originalScore!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(f.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:n==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige QualitÃ¤t hatte.":n==="fr"?"L'image a Ã©tÃ© automatiquement rÃ©gÃ©nÃ©rÃ©e car la premiÃ¨re version avait une qualitÃ© faible.":"Image was automatically regenerated because the first version had low quality."}),f.originalImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:n==="de"?"Originalbild:":n==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:f.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),f.originalReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:n==="de"?"Original Feedback:":n==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:f.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:"w-full flex items-center justify-center bg-gray-100 rounded-lg p-8 mb-4",children:e.jsx("p",{className:"text-gray-500 text-center",children:n==="de"?"Kein Bild fÃ¼r diese Seite":n==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"w-full bg-indigo-50 rounded-lg p-6 border-2 border-indigo-200",children:e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl text-center",children:s.trim()})})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[f&&f.imageData?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("img",{src:f.imageData,alt:`Scene for page ${P}`,className:"w-full rounded-lg shadow-md object-cover"}),R&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[F&&e.jsxs("button",{onClick:()=>F(P),disabled:j,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${j?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Le,{size:14})," ",n==="de"?"Neu generieren":"Regenerate"]}),L&&e.jsxs("button",{onClick:()=>L(P),disabled:j,className:`flex-1 bg-gray-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${j?"opacity-50 cursor-not-allowed":"hover:bg-gray-600"}`,children:[e.jsx(je,{size:14})," ",n==="de"?"Bearbeiten":"Edit"]})]}),pe(P)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:n==="de"?"Auszug aus Gliederung":n==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:pe(P)})]}),fe(P)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:n==="de"?"Szenen-Prompt":n==="fr"?"Prompt de scÃ¨ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-64 overflow-y-auto",children:fe(P)})]}),he(P)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:n==="de"?"Szenenbeschreibung":n==="fr"?"Description de scÃ¨ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:he(P)})]}),f.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[n==="de"?"API-Prompt":n==="fr"?"Prompt API":"API Prompt",f.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",f.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:f.prompt})]}),f.referencePhotos&&f.referencePhotos.length>0&&e.jsx(_e,{referencePhotos:f.referencePhotos,language:n}),f.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsx("span",{children:n==="de"?"QualitÃ¤tsbewertung":n==="fr"?"Score de qualitÃ©":"Quality Score"}),e.jsxs("span",{className:`text-lg font-bold ${f.qualityScore>=70?"text-green-600":f.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(f.qualityScore),"%"]})]}),f.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:n==="de"?"Feedback:":n==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:f.qualityReasoning})]})]}),f.retryHistory&&f.retryHistory.length>0&&e.jsx(qe,{retryHistory:f.retryHistory,totalAttempts:f.totalAttempts||f.retryHistory.length,language:n}),f.wasRegenerated&&(!f.retryHistory||f.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["ğŸ”„ ",n==="de"?"Bild regeneriert":n==="fr"?"Image rÃ©gÃ©nÃ©rÃ©e":"Image Regenerated"]}),f.originalScore!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(f.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:n==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige QualitÃ¤t hatte.":n==="fr"?"L'image a Ã©tÃ© automatiquement rÃ©gÃ©nÃ©rÃ©e car la premiÃ¨re version avait une qualitÃ© faible.":"Image was automatically regenerated because the first version had low quality."}),f.originalImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:n==="de"?"Originalbild:":n==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:f.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),f.originalReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:n==="de"?"Original Feedback:":n==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:f.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg p-8",children:e.jsx("p",{className:"text-gray-500 text-center",children:n==="de"?"Kein Bild fÃ¼r diese Seite":n==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"flex items-start",children:e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl",children:s.trim()})})})]})]},P)})]}),oe&&i&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-6 mt-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4 text-center",children:n==="de"?"Was mÃ¶chten Sie als NÃ¤chstes tun?":n==="fr"?"Que souhaitez-vous faire ensuite ?":"What would you like to do next?"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[z&&e.jsxs("button",{onClick:z,disabled:j,className:`bg-green-500 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${j?"opacity-50 cursor-not-allowed":"hover:bg-green-600"}`,children:[e.jsx(Be,{size:20})," ",n==="de"?"PDF herunterladen":n==="fr"?"TÃ©lÃ©charger PDF":"Download PDF"]}),M&&y&&e.jsxs("button",{onClick:y,disabled:j,className:`bg-indigo-500 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${j?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Mt,{size:20})," ",n==="de"?"Buch kaufen (CHF 36)":n==="fr"?"Acheter le livre (CHF 36)":"Buy Book (CHF 36)"]}),w&&e.jsxs("button",{onClick:w,disabled:j,className:`bg-indigo-500 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${j?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(tt,{size:20})," ",ee.createAnotherStory]})]})]})]})}const rr={async login(t,i){const d=await se.post("/api/auth/login",{username:t,password:i},{skipAuth:!0}),c={id:d.user.id,username:d.user.username,email:d.user.email,role:d.user.role,credits:d.user.credits};return{token:d.token,user:c}},async register(t,i,d){return se.post("/api/auth/register",{username:t,password:i,email:d},{skipAuth:!0})},async loginWithFirebase(t){const i=await se.post("/api/auth/firebase",{idToken:t},{skipAuth:!0}),d={id:i.user.id,username:i.user.username,email:i.user.email,role:i.user.role,credits:i.user.credits};return{token:i.token,user:d}},async getQuota(){const t=await se.get("/api/user/quota");return{storyQuota:t.story_quota,storiesGenerated:t.stories_generated,remaining:t.remaining}},async getCredits(){const t=await se.get("/api/user/quota");return{credits:t.credits,unlimited:t.unlimited}},async updateEmail(t){await se.put("/api/user/update-email",{email:t})},async getShippingAddress(){try{return await se.get("/api/user/shipping-address")}catch{return null}},async updateShippingAddress(t){await se.put("/api/user/shipping-address",t)}},Q=Jt("CharacterService");function Wt(t){var c,r,h;const i=t.style_analysis||t.styleAnalysis,d={height:t.height,build:((c=i==null?void 0:i.physical)==null?void 0:c.build)||t.build,face:((r=i==null?void 0:i.physical)==null?void 0:r.face)||t.other_features||t.otherFeatures,hair:((h=i==null?void 0:i.physical)==null?void 0:h.hair)||t.hair_color||t.hairColor};return{id:t.id,name:t.name,gender:t.gender,age:t.age,physical:d.height||d.build||d.face||d.hair?d:void 0,traits:{strengths:t.strengths||[],flaws:t.flaws||t.weaknesses||[],challenges:t.challenges||t.fears||[],specialDetails:t.special_details||t.specialDetails},photos:{original:t.photo_url||t.photoUrl,face:t.thumbnail_url||t.thumbnailUrl,body:t.body_photo_url||t.bodyPhotoUrl,bodyNoBg:t.body_no_bg_url||t.bodyNoBgUrl,faceBox:t.face_box||t.faceBox,bodyBox:t.body_box||t.bodyBox},avatars:t.clothing_avatars||t.clothingAvatars,clothing:t.clothing?{current:t.clothing}:void 0,referenceOutfit:(i==null?void 0:i.referenceOutfit)||t.reference_outfit||t.referenceOutfit,generatedOutfits:t.generated_outfits||t.generatedOutfits}}function Gt(t){var i,d,c,r,h,v,x,p,$,j,z,y,o,w,D,F,k;return{id:t.id,name:t.name,gender:t.gender,age:t.age,height:(i=t.physical)==null?void 0:i.height,build:(d=t.physical)==null?void 0:d.build,hair_color:(c=t.physical)==null?void 0:c.hair,other_features:(r=t.physical)==null?void 0:r.face,photo_url:(h=t.photos)==null?void 0:h.original,thumbnail_url:(v=t.photos)==null?void 0:v.face,body_photo_url:(x=t.photos)==null?void 0:x.body,body_no_bg_url:(p=t.photos)==null?void 0:p.bodyNoBg,face_box:($=t.photos)==null?void 0:$.faceBox,body_box:(j=t.photos)==null?void 0:j.bodyBox,strengths:(z=t.traits)==null?void 0:z.strengths,flaws:(y=t.traits)==null?void 0:y.flaws,challenges:(o=t.traits)==null?void 0:o.challenges,special_details:(w=t.traits)==null?void 0:w.specialDetails,weaknesses:(D=t.traits)==null?void 0:D.flaws,fears:(F=t.traits)==null?void 0:F.challenges,clothing:(k=t.clothing)==null?void 0:k.current,clothing_avatars:t.avatars,style_analysis:t.physical?{physical:{face:t.physical.face,hair:t.physical.hair,build:t.physical.build},referenceOutfit:t.referenceOutfit}:void 0,reference_outfit:t.referenceOutfit,generated_outfits:t.generatedOutfits}}const Y={async getCharacters(){return((await se.get("/api/characters")).characters||[]).map(Wt)},async getCharacterData(){const t=await se.get("/api/characters");return{characters:(t.characters||[]).map(Wt),relationships:t.relationships||{},relationshipTexts:t.relationshipTexts||{},customRelationships:t.customRelationships||[],customStrengths:t.customStrengths||[],customWeaknesses:t.customWeaknesses||[],customFears:t.customFears||[]}},async saveCharacters(t){await se.post("/api/characters",{characters:t.map(Gt)})},async saveCharacterData(t){await se.post("/api/characters",{characters:t.characters.map(Gt),relationships:t.relationships,relationshipTexts:t.relationshipTexts,customRelationships:t.customRelationships,customStrengths:t.customStrengths,customWeaknesses:t.customWeaknesses,customFears:t.customFears})},async generateClothingAvatars(t){var i,d,c,r,h,v,x;try{const p=parseInt(t.age)||10,$=t.gender||"child";let j;$==="male"?j=p>=18?"man":"boy":$==="female"?j=p>=18?"woman":"girl":j=p>=18?"person":"child";let z=`${t.name} is a ${p}-year-old ${j}`;t.physical&&(t.physical.hair&&(z+=`, ${t.physical.hair}`),t.physical.face&&(z+=`, ${t.physical.face}`),t.physical.build&&(z+=`, ${t.physical.build}`));const y=((i=t.photos)==null?void 0:i.bodyNoBg)||((d=t.photos)==null?void 0:d.body)||((c=t.photos)==null?void 0:c.face)||((r=t.photos)==null?void 0:r.original);Q.info(`Generating clothing avatars for ${t.name} (id: ${t.id}), using: ${(h=t.photos)!=null&&h.bodyNoBg?"bodyNoBg":(v=t.photos)!=null&&v.body?"body":(x=t.photos)!=null&&x.face?"face":"original"}`);const o=await se.post("/api/generate-clothing-avatars",{characterId:t.id,facePhoto:y,physicalDescription:z,name:t.name,age:t.age,gender:t.gender});return o.success&&o.clothingAvatars?(Q.success(`Clothing avatars generated for ${t.name}`),{success:!0,avatars:o.clothingAvatars}):(Q.error(`Failed to generate avatars: ${o.error}`),{success:!1,error:o.error})}catch(p){return Q.error("Clothing avatar generation failed:",p),{success:!1,error:String(p)}}},async analyzePhoto(t){var i,d,c,r,h,v,x,p,$,j,z,y;try{const o=await se.post("/api/analyze-photo",{imageData:t}),w={height:(i=o.attributes)==null?void 0:i.height,build:((c=(d=o.styleAnalysis)==null?void 0:d.physical)==null?void 0:c.build)||((r=o.attributes)==null?void 0:r.build),face:((v=(h=o.styleAnalysis)==null?void 0:h.physical)==null?void 0:v.face)||((x=o.attributes)==null?void 0:x.other_features),hair:(($=(p=o.styleAnalysis)==null?void 0:p.physical)==null?void 0:$.hair)||((j=o.attributes)==null?void 0:j.hair_color)};return{success:o.success,photos:{face:o.faceThumbnail,body:o.bodyCrop,bodyNoBg:o.bodyNoBg,faceBox:o.faceBox,bodyBox:o.bodyBox},physical:w.height||w.build||w.face||w.hair?w:void 0,clothing:(z=o.attributes)!=null&&z.clothing?{current:o.attributes.clothing}:void 0,referenceOutfit:(y=o.styleAnalysis)==null?void 0:y.referenceOutfit}}catch(o){return Q.error("Photo analysis failed:",o),{success:!1}}},needsAvatars(t){var r,h,v,x;if(!!!((r=t.photos)!=null&&r.original||(h=t.photos)!=null&&h.face||(v=t.photos)!=null&&v.body||(x=t.photos)!=null&&x.bodyNoBg))return!1;const d=t.avatars;return d?d.status==="generating"||d.status==="pending"?!1:d.status==="failed"?!0:!!!(d.winter||d.standard||d.summer||d.formal):!0},async generateAndSaveAvatarForCharacter(t,i){var c,r,h,v;const d={characterId:t.id,characterName:t.name,success:!1};try{if(!!!((c=t.photos)!=null&&c.original||(r=t.photos)!=null&&r.face||(h=t.photos)!=null&&h.body||(v=t.photos)!=null&&v.bodyNoBg))return d.skipped=!0,d.skipReason="No photo available",d;i==null||i("generating",`Generating avatars for ${t.name}...`),Q.info(`ğŸ¨ Generating avatars for ${t.name} (id: ${t.id})`);const p=await Y.generateClothingAvatars(t);if(!p.success||!p.avatars)return d.error=p.error||"Avatar generation failed",i==null||i("error",d.error),d;d.avatars=p.avatars,i==null||i("saving",`Saving avatars for ${t.name}...`);const $=await Y.getCharacterData(),j=$.characters.map(z=>z.id===t.id?{...z,avatars:p.avatars}:z);return await Y.saveCharacterData({...$,characters:j}),d.success=!0,i==null||i("complete",`Avatars saved for ${t.name}`),Q.success(`âœ… Avatars generated and saved for ${t.name}`),d}catch(x){return d.error=String(x),i==null||i("error",d.error),Q.error(`Failed to generate/save avatars for ${t.name}:`,x),d}},async generateAvatarsForCharacters(t,i){const{forceRegenerate:d=!1,maxConcurrent:c=2,onProgress:r}=i||{};Q.info("ğŸ¨ Starting batch avatar generation...");const h=await Y.getCharacterData();let v;if(t&&t.length>0?v=h.characters.filter(y=>t.includes(y.id)):v=h.characters.filter(y=>{var o,w;return d?!!((o=y.photos)!=null&&o.original||(w=y.photos)!=null&&w.face):Y.needsAvatars(y)}),v.length===0)return Q.info("No characters need avatar generation"),{results:[],successCount:0,failCount:0,skipCount:0};Q.info(`Processing ${v.length} characters for avatar generation`);const x=[],p=new Map;for(let y=0;y<v.length;y+=c){const w=v.slice(y,y+c).map(async F=>{var L,S,B,M,R;const k={characterId:F.id,characterName:F.name,success:!1};try{if(!!!((L=F.photos)!=null&&L.original||(S=F.photos)!=null&&S.face||(B=F.photos)!=null&&B.body||(M=F.photos)!=null&&M.bodyNoBg))return k.skipped=!0,k.skipReason="No photo available",k;if(!d&&((R=F.avatars)!=null&&R.winter))return k.skipped=!0,k.skipReason="Avatars already exist",k;r==null||r(F.id,"generating",`Generating avatars for ${F.name}...`),Q.info(`ğŸ¨ Generating avatars for ${F.name}...`);const H=await Y.generateClothingAvatars(F);return!H.success||!H.avatars?(k.error=H.error||"Avatar generation failed",r==null||r(F.id,"error",k.error),k):(k.avatars=H.avatars,k.success=!0,p.set(F.id,{...F,avatars:H.avatars}),r==null||r(F.id,"complete",`Avatars generated for ${F.name}`),Q.success(`âœ… Avatars generated for ${F.name}`),k)}catch(_){return k.error=String(_),r==null||r(F.id,"error",k.error),Q.error(`Failed to generate avatars for ${F.name}:`,_),k}}),D=await Promise.all(w);x.push(...D)}if(p.size>0){Q.info(`ğŸ’¾ Saving ${p.size} character avatar updates...`);const y=await Y.getCharacterData(),o=y.characters.map(w=>p.get(w.id)||w);await Y.saveCharacterData({...y,characters:o}),Q.success(`ğŸ’¾ Saved avatar updates for ${p.size} characters`)}const $=x.filter(y=>y.success).length,j=x.filter(y=>!y.success&&!y.skipped).length,z=x.filter(y=>y.skipped).length;return Q.info(`Avatar generation complete: ${$} success, ${j} failed, ${z} skipped`),{results:x,successCount:$,failCount:j,skipCount:z}},async regenerateAvatarsForCharacter(t,i){Q.info(`ğŸ”„ Regenerating avatars for character ${t}...`);const c=(await Y.getCharacterData()).characters.find(h=>h.id===t);if(!c)return{characterId:t,characterName:"Unknown",success:!1,error:"Character not found"};const r={...c,avatars:{status:"pending"}};return Y.generateAndSaveAvatarForCharacter(r,i?(h,v)=>i(h,v):void 0)}},C=Jt("StoryWizard");function xr(){const t=Ds(),[i,d]=As(),{t:c,language:r}=xe(),{isAuthenticated:h}=Kt(),{showSuccess:v,showInfo:x}=ks(),[p,$]=N.useState(()=>new URLSearchParams(window.location.search).get("storyId")?5:1),[j,z]=N.useState(()=>!!new URLSearchParams(window.location.search).get("storyId")),[y,o]=N.useState(null),[w,D]=N.useState(!1),[F,k]=N.useState(null),[L,S]=N.useState(!1),[B,M]=N.useState(!1),[R,_]=N.useState(!1),[H,G]=N.useState(!1),[ce,ee]=N.useState(!1),[n,ve]=N.useState(""),[T,ne]=N.useState("pixar"),[Z,ie]=N.useState([]),[E,re]=N.useState([]),[q,X]=N.useState(null),[ke,oe]=N.useState(!1),[te,me]=N.useState("photo"),[he,pe]=N.useState(!1),[fe,s]=N.useState(!1),[I,P]=N.useState({}),[f,O]=N.useState({}),[b,U]=N.useState([]),ae=N.useRef(null),be=N.useRef(!1),Ne=N.useRef(!1),[we,Se]=N.useState(()=>{try{const m=localStorage.getItem("story_main_characters");return m?JSON.parse(m):[]}catch{return[]}}),[ye,Pe]=N.useState(()=>{try{return localStorage.getItem("story_language_level")||"standard"}catch{return"standard"}}),[Ue,ft]=N.useState(()=>{try{const m=localStorage.getItem("story_pages");return m?parseInt(m):30}catch{return 30}}),[We,bt]=N.useState(()=>localStorage.getItem("story_dedication")||""),[Ge,yt]=N.useState(()=>localStorage.getItem("story_details")||""),[rt,Fe]=N.useState(!1),[ts,Ke]=N.useState(!1),[at,nt]=N.useState({current:0,total:0,message:""}),[it,ot]=N.useState(""),[Je,lt]=N.useState(""),[ss,jt]=N.useState(""),[rs,vt]=N.useState(""),[as,Nt]=N.useState([]),[ns,Te]=N.useState(null),[is,dt]=N.useState([]),[os,Ie]=N.useState([]),[ls,Ee]=N.useState({frontCover:null,initialPage:null,backCover:null}),[K,ct]=N.useState(null),[,wt]=N.useState(null),[ds,St]=N.useState(!1),[cs,Ct]=N.useState(),[ms,kt]=N.useState(),[us,Pt]=N.useState(),[gs,Qe]=N.useState(!1),[W,Ye]=N.useState(null),[Re,Oe]=N.useState("");N.useEffect(()=>{if(!h){const m=window.location.pathname+window.location.search,a=encodeURIComponent(m);t(`/?login=true&redirect=${a}`)}},[h,t]),N.useEffect(()=>{(async()=>{const a=i.get("storyId");if(!(!a||!h)){C.info("Loading saved story:",a),z(!0),o({loaded:0,total:null});try{const l=await de.getStoryWithProgress(a,(u,g)=>{o({loaded:u,total:g})});l?(C.info("Loaded story:",l.title,l.isPartial?"(PARTIAL)":""),ct(l.id),ot(l.title||""),ve(l.storyType||""),ne(l.artStyle||"pixar"),jt(l.outline||""),vt(l.outlinePrompt||""),Nt(l.storyTextPrompts||[]),l.visualBible?Te({mainCharacters:l.visualBible.mainCharacters||[],secondaryCharacters:l.visualBible.secondaryCharacters||[],animals:l.visualBible.animals||[],artifacts:l.visualBible.artifacts||[],locations:l.visualBible.locations||[],changeLog:l.visualBible.changeLog||[]}):Te(null),Ie(l.sceneImages||[]),dt(l.sceneDescriptions||[]),Ee(l.coverImages||{frontCover:null,initialPage:null,backCover:null}),Pe(l.languageLevel||"standard"),Fe(!1),St(l.isPartial||!1),Ct(l.failureReason),kt(l.generatedPages),Pt(l.totalPages),lt(l.story||""),$(5),setTimeout(()=>{z(!1),o(null)},50)):(C.error("Story not found:",a),z(!1),o(null))}catch(l){C.error("Failed to load story:",l),z(!1),o(null)}}})()},[i,h]),N.useEffect(()=>{(async()=>{const a=i.get("payment"),l=i.get("session_id");if(a==="success"&&l){C.info("Payment successful! Checking order status..."),C.info("Session ID:",l);try{const g=await de.getOrderStatus(l);if(C.info("Order Status:",g),g.order){const A=`CHF ${(g.order.amount_total/100).toFixed(2)}`,V={en:"Payment Successful!",de:"Zahlung erfolgreich!",fr:"Paiement rÃ©ussi!"},le={en:"Your book order has been received and will be printed soon.",de:"Ihre Buchbestellung wurde entgegengenommen und wird bald gedruckt.",fr:"Votre commande de livre a Ã©tÃ© reÃ§ue et sera bientÃ´t imprimÃ©e."},J=[`${r==="de"?"Kunde":r==="fr"?"Client":"Customer"}: ${g.order.customer_name}`,`Email: ${g.order.customer_email}`,`${r==="de"?"Betrag":r==="fr"?"Montant":"Amount"}: ${A}`,`${r==="de"?"Versand an":r==="fr"?"ExpÃ©diÃ© Ã ":"Shipping to"}: ${g.order.shipping_name}`,`${g.order.shipping_address_line1}`,`${g.order.shipping_postal_code} ${g.order.shipping_city}`,`${g.order.shipping_country}`];v(le[r]||le.en,V[r]||V.en,J)}}catch(g){C.error("Error checking order status:",g)}const u=new URLSearchParams(i);u.delete("payment"),u.delete("session_id"),d(u,{replace:!0})}else if(a==="cancelled"){C.info("Payment cancelled by user");const u={en:"Payment was cancelled. You can try again when ready.",de:"Zahlung wurde abgebrochen. Sie kÃ¶nnen es erneut versuchen.",fr:"Paiement annulÃ©. Vous pouvez rÃ©essayer quand vous Ãªtes prÃªt."};x(u[r]||u.en,r==="de"?"Abgebrochen":r==="fr"?"AnnulÃ©":"Cancelled");const g=new URLSearchParams(i);g.delete("payment"),d(g,{replace:!0})}})()},[i,d,r,v,x]);const Dt=m=>{if(m.length===0)return;const a=m.filter(l=>{const u=parseInt(l.age);return u>=1&&u<=10});if(a.length>0){const l=a.map(u=>u.id);Se(l),C.info(`Auto-selected ${a.length} main character(s) aged 1-10`)}else{const l=m.reduce((u,g)=>{const A=parseInt(g.age)||999,V=parseInt(u.age)||999;return A<V?g:u});Se([l.id]),C.info(`Auto-selected youngest character as main: ${l.name} (age ${l.age})`)}};N.useEffect(()=>{h&&(async()=>{try{z(!0);const a=await Y.getCharacterData();C.info("Loaded character data from API:",{characters:a.characters.length,relationships:Object.keys(a.relationships).length}),re(a.characters),Object.keys(a.relationships).length>0&&(P(a.relationships),be.current=!0),Object.keys(a.relationshipTexts).length>0&&O(a.relationshipTexts),a.customRelationships.length>0&&U(a.customRelationships),a.characters.length>0&&Dt(a.characters)}catch(a){C.error("Failed to load character data:",a)}finally{z(!1)}})()},[h]),N.useEffect(()=>{p===2&&E.length===0&&!q&&!j&&mt()},[p,E.length,q,j]),N.useEffect(()=>{localStorage.setItem("story_main_characters",JSON.stringify(we))},[we]),N.useEffect(()=>{localStorage.setItem("story_language_level",ye)},[ye]),N.useEffect(()=>{localStorage.setItem("story_pages",Ue.toString())},[Ue]),N.useEffect(()=>{localStorage.setItem("story_dedication",We)},[We]),N.useEffect(()=>{localStorage.setItem("story_details",Ge)},[Ge]),N.useEffect(()=>{if(p===3&&E.length>=2&&!j){const m=E.map(a=>a.id).sort().join("-");if(!ae.current||ae.current!==m){const l=Xt(r);C.debug("Initializing relationships for step 3",{charKey:m,existingCount:Object.keys(I).length}),P(u=>{const g={...u};let A=!1;return E.forEach((V,le)=>{E.forEach((J,ue)=>{if(le!==ue){const De=`${V.id}-${J.id}`;g[De]||(g[De]=l,A=!0,C.debug("Initializing missing relationship:",De))}})}),A?g:u}),ae.current=m}}},[p,E,r,j]);const At=()=>{if(E.length<2)return!0;for(let m=0;m<E.length;m++)for(let a=0;a<E.length;a++)if(m!==a){const l=`${E[m].id}-${E[a].id}`,u=I[l];if(!u||es(u))return!1}return!0},mt=()=>{X({id:Date.now(),name:"",gender:"other",age:"8",traits:{strengths:[],flaws:[],challenges:[]}}),me("photo"),oe(!1)},xs=(m,a=1500)=>new Promise(l=>{const u=new Image;u.onload=()=>{const g=document.createElement("canvas");let{width:A,height:V}=u;(A>a||V>a)&&(A>V?(V=Math.round(V*a/A),A=a):(A=Math.round(A*a/V),V=a)),g.width=A,g.height=V;const le=g.getContext("2d");le==null||le.drawImage(u,0,0,A,V),l(g.toDataURL("image/jpeg",.85))},u.onerror=()=>l(m),u.src=m}),ut=async m=>{const a=new FileReader;a.onload=async l=>{var g;const u=(g=l.target)==null?void 0:g.result;pe(!0),te!=="traits"&&me("name");try{const A=await xs(u),V=Math.round(u.length/1024),le=Math.round(A.length/1024);C.info(`Starting photo analysis... (${V}KB -> ${le}KB)`);const J=await Y.analyzePhoto(A);J.success?(C.info("Photo analysis complete:",{hasPhotos:!!J.photos,hasPhysical:!!J.physical,hasClothing:!!J.clothing}),X(ue=>{var De,Tt,It,Et,Rt,Ot;return ue?{...ue,photos:{original:((De=J.photos)==null?void 0:De.face)||u,face:(Tt=J.photos)==null?void 0:Tt.face,body:((It=J.photos)==null?void 0:It.body)||u,bodyNoBg:(Et=J.photos)==null?void 0:Et.bodyNoBg,faceBox:(Rt=J.photos)==null?void 0:Rt.faceBox,bodyBox:(Ot=J.photos)==null?void 0:Ot.bodyBox},physical:J.physical?{...ue.physical,...J.physical}:ue.physical,clothing:J.clothing||ue.clothing,referenceOutfit:J.referenceOutfit||ue.referenceOutfit,avatars:void 0}:null})):(C.warn("Photo analysis returned no data, using original photo"),X(ue=>ue?{...ue,photos:{original:u},avatars:void 0}:null))}catch(A){C.error("Photo analysis error:",A),X(V=>V?{...V,photos:{original:u},avatars:void 0}:null)}finally{pe(!1)}},a.readAsDataURL(m)},$t=async()=>{if(q){X(m=>m&&{...m,avatars:void 0}),s(!0);try{C.info(`ğŸ”„ Regenerating avatars for ${q.name}...`);const m=await Y.regenerateAvatarsForCharacter(q.id,(a,l)=>C.info(`[${a}] ${l}`));m.success&&m.avatars?(X(a=>a&&{...a,avatars:m.avatars}),re(a=>a.map(l=>l.id===q.id?{...l,avatars:m.avatars}:l)),C.success(`âœ… Avatars regenerated for ${q.name}`)):(C.error(`âŒ Failed to regenerate avatars: ${m.error}`),alert(`Failed to regenerate avatars: ${m.error||"Unknown error"}`))}catch(m){C.error(`âŒ Failed to regenerate avatars for ${q.name}:`,m),alert(`Failed to regenerate avatars: ${m instanceof Error?m.message:"Unknown error"}`)}finally{s(!1)}}},gt=async()=>{if(q){z(!0);try{const a=q.id&&E.find(u=>u.id===q.id)?E.map(u=>u.id===q.id?q:u):[...E,q];C.info("Saving characters with relationships:",a.length),await Y.saveCharacterData({characters:a,relationships:I,relationshipTexts:f,customRelationships:b,customStrengths:[],customWeaknesses:[],customFears:[]}),C.success("Character data saved successfully"),re(a),Dt(a);const l=a.find(u=>u.id===q.id);l&&Y.needsAvatars(l)&&(C.info(`ğŸ¨ Starting background avatar generation for ${l.name}...`),Y.generateAndSaveAvatarForCharacter(l).then(u=>{u.success&&u.avatars?(re(g=>g.map(A=>A.id===l.id?{...A,avatars:u.avatars}:A)),C.success(`âœ… Avatars saved for ${l.name}`)):u.skipped||C.warn(`Avatar generation failed for ${l.name}: ${u.error}`)})),X(null),oe(!0)}catch(m){C.error("Failed to save character:",m),alert(r==="de"?"Charakter konnte nicht gespeichert werden. Bitte versuche es erneut.":r==="fr"?"Ã‰chec de l'enregistrement du personnage. Veuillez rÃ©essayer.":"Failed to save character. Please try again.")}finally{z(!1)}}},hs=m=>{X({...m}),me("traits"),oe(!1)},ps=async m=>{const a=E.filter(g=>g.id!==m),l={...I},u={...f};Object.keys(l).forEach(g=>{(g.includes(`${m}-`)||g.includes(`-${m}`))&&(delete l[g],delete u[g])});try{await Y.saveCharacterData({characters:a,relationships:l,relationshipTexts:u,customRelationships:b,customStrengths:[],customWeaknesses:[],customFears:[]}),re(a),P(l),O(u),Se(g=>g.filter(A=>A!==m))}catch(g){C.error("Failed to delete character:",g)}},fs=(m,a,l)=>{const g=Us(l,r),A=`${m}-${a}`,V=`${a}-${m}`;C.debug("Updating relationship:",A,"=",l,", inverse:",V,"=",g),Ne.current=!0,P(le=>({...le,[A]:l,[V]:g}))},bs=m=>{Ne.current=!0,U(a=>[...a,m])},ys=()=>{const a=prompt(r==="de"?"Name des Story-Typs eingeben:":r==="fr"?"Entrez le nom du type d'histoire:":"Enter story type name:");if(a){const l={id:`custom-${Date.now()}`,name:{en:a,de:a,fr:a},emoji:"âœ¨"};ie(u=>[...u,l]),ve(l.id),setTimeout(()=>{const u=document.getElementById("art-style-section");u&&u.scrollIntoView({behavior:"smooth",block:"start"})},100)}},js=m=>{Se(a=>a.includes(m)?a.filter(l=>l!==m):[...a,m])},xt=async m=>{m>=0&&m<=5&&(p===2&&q&&m!==2&&await gt(),p===3&&m!==3&&await Ns(),$(m))},vs=m=>m===1?!0:m===2?n!=="":m===3?n!==""&&E.length>0:m===4?n!==""&&E.length>0&&At():m===5?Je!=="":!1,Ce=()=>p===1?n!=="":p===2?E.length>0:p===3?At():p===4?we.length>0:!1,Ns=async()=>{if(E.length!==0){if(!Ne.current){C.debug("Relationships not modified, skipping save");return}try{await Y.saveCharacterData({characters:E,relationships:I,relationshipTexts:f,customRelationships:b,customStrengths:[],customWeaknesses:[],customFears:[]}),Ne.current=!1,C.debug("Character data auto-saved")}catch(m){C.error("Failed to auto-save character data:",m)}}},zt=async()=>{p<4&&Ce()&&await xt(p+1)},Ft=async()=>{p>0&&await xt(p-1)},ws=()=>{const m=Z.find(l=>l.id===n);if(m)return m.name[r];const a=Zt.find(l=>l.id===n);return a?a.name[r]:n},ht=async m=>{Fe(!0),$(5),nt({current:5,total:100,message:r==="de"?"Starte Generierung...":r==="fr"?"DÃ©marrage de la gÃ©nÃ©ration...":"Starting generation..."});try{const{jobId:a}=await de.createStoryJob({storyType:n,storyTypeName:ws(),artStyle:T,language:r,languageLevel:ye,pages:Ue,dedication:We,storyDetails:Ge,characters:E,mainCharacters:we,relationships:I,relationshipTexts:f,skipImages:(m==null?void 0:m.skipImages)??H,imageGenMode:F,skipOutline:L,skipText:B,skipSceneDescriptions:R,skipCovers:ce});wt(a),C.info("Story job created:",a);let l=!1,u=0;for(;!l;){await new Promise(A=>setTimeout(A,2e3));const g=await de.getJobStatus(a);if(g.progress&&(g.progress.current!==u&&(C.debug(`Progress: ${g.progress.current}% - ${g.progress.message||""}`),u=g.progress.current),nt(g.progress)),g.status==="completed"&&g.result)ct(g.result.storyId),ot(g.result.title),jt(g.result.outline),vt(g.result.outlinePrompt||""),Nt(g.result.storyTextPrompts||[]),g.result.visualBible?Te({mainCharacters:g.result.visualBible.mainCharacters||[],secondaryCharacters:g.result.visualBible.secondaryCharacters||[],animals:g.result.visualBible.animals||[],artifacts:g.result.visualBible.artifacts||[],locations:g.result.visualBible.locations||[],changeLog:g.result.visualBible.changeLog||[]}):Te(null),lt(g.result.story),dt(g.result.sceneDescriptions||[]),Ie(g.result.sceneImages||[]),Ee(g.result.coverImages||{frontCover:null,initialPage:null,backCover:null}),l=!0,C.success("Story generation completed!");else if(g.status==="failed")throw new Error(g.error||"Story generation failed")}nt({current:100,total:100,message:r==="de"?"Fertig!":r==="fr"?"TerminÃ©!":"Complete!"})}catch(a){C.error("Generation failed:",a),alert(r==="de"?`Generierung fehlgeschlagen: ${a}`:r==="fr"?`Ã‰chec de la gÃ©nÃ©ration: ${a}`:`Generation failed: ${a}`)}finally{setTimeout(()=>Fe(!1),500)}},Ss=()=>{switch(p){case 1:return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_s,{selectedType:n,onSelect:a=>{ve(a),setTimeout(()=>{const l=document.getElementById("art-style-section");l&&l.scrollIntoView({behavior:"smooth",block:"start"})},100)},customTypes:Z,onAddCustom:ys}),n&&e.jsx(Vs,{selectedStyle:T,onSelect:ne})]});case 2:return q?te==="photo"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Ae,{size:24})," ",c.createCharacters]}),e.jsx(Xs,{onPhotoSelect:ut}),e.jsx("button",{onClick:()=>X(null),className:"w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:c.cancel})]}):te==="name"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Ae,{size:24})," ",c.createCharacters]}),e.jsx(Ut,{character:q,onChange:X,onSave:gt,onCancel:()=>X(null),onPhotoChange:ut,onContinueToTraits:()=>me("traits"),onRegenerateAvatars:$t,isLoading:j,isAnalyzingPhoto:he,isRegeneratingAvatars:fe,step:"name",developerMode:w})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Ae,{size:24})," ",c.createCharacters]}),e.jsx(Ut,{character:q,onChange:X,onSave:gt,onCancel:()=>X(null),onPhotoChange:ut,onRegenerateAvatars:$t,isLoading:j,isAnalyzingPhoto:he,isRegeneratingAvatars:fe,step:"traits",developerMode:w})]}):E.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Ae,{size:24})," ",c.createCharacters]}),e.jsx(Ks,{characters:E,showSuccessMessage:ke,onEdit:hs,onDelete:ps,onCreateAnother:mt,onContinue:zt})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Ae,{size:24})," ",c.createCharacters]}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ae,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-6",children:c.startCreating}),e.jsx(et,{onClick:mt,icon:Me,children:r==="de"?"Ersten Charakter erstellen":r==="fr"?"Creer le premier personnage":"Create First Character"})]})]});case 3:return e.jsx(Ws,{characters:E,relationships:I,relationshipTexts:f,onRelationshipChange:fs,onRelationshipTextChange:(a,l)=>{Ne.current=!0,O(u=>({...u,[a]:l}))},customRelationships:b,onAddCustomRelationship:bs});case 4:return e.jsx(Gs,{characters:E,mainCharacters:we,onToggleMainCharacter:js,languageLevel:ye,onLanguageLevelChange:Pe,pages:Ue,onPagesChange:ft,dedication:We,onDedicationChange:bt,storyDetails:Ge,onStoryDetailsChange:yt,developerMode:w,imageGenMode:F,onImageGenModeChange:k});case 5:return Je?e.jsx(sr,{title:it,story:Je,outline:ss,outlinePrompt:rs,storyTextPrompts:as,visualBible:ns||void 0,sceneImages:os,sceneDescriptions:is,coverImages:ls,languageLevel:ye,isGenerating:rt,developerMode:w,storyId:K,onVisualBibleChange:K?async a=>{try{C.info("Updating Visual Bible for story:",K),await de.updateVisualBible(K,a),Te(a),C.success("Visual Bible updated successfully")}catch(l){C.error("Failed to update Visual Bible:",l),alert(r==="de"?"Visual Bible konnte nicht aktualisiert werden":r==="fr"?"Ã‰chec de la mise Ã  jour de la Bible Visuelle":"Failed to update Visual Bible")}}:void 0,onRegenerateImage:K?async a=>{var l;try{C.info("Regenerating image for page:",a),Fe(!0);const u=await de.regenerateImage(K,a);if(C.info("Regenerate result:",{hasImageData:!!(u!=null&&u.imageData),length:(l=u==null?void 0:u.imageData)==null?void 0:l.length}),!(u!=null&&u.imageData))throw C.error("No imageData in response!",u),new Error("No image data returned from server");Ie(g=>g.map(A=>A.pageNumber===a?{...A,imageData:u.imageData,qualityScore:u.qualityScore,qualityReasoning:u.qualityReasoning,totalAttempts:u.totalAttempts,retryHistory:u.retryHistory,wasRegenerated:!0}:A)),C.info("Image regenerated successfully, updated state")}catch(u){C.error("Image regeneration failed:",u),alert(r==="de"?"Bildgenerierung fehlgeschlagen":r==="fr"?"Ã‰chec de la rÃ©gÃ©nÃ©ration de l'image":"Image regeneration failed")}finally{Fe(!1)}}:void 0,onDownloadTxt:()=>{const a=new Blob([Je],{type:"text/plain"}),l=URL.createObjectURL(a),u=document.createElement("a");u.href=l,u.download=`${it}.txt`,u.click(),URL.revokeObjectURL(l)},onDownloadPdf:K?async()=>{try{const a=await de.generatePdf(K),l=URL.createObjectURL(a),u=document.createElement("a");u.href=l,u.download=`${it}.pdf`,u.click(),URL.revokeObjectURL(l)}catch(a){C.error("PDF download failed:",a),alert(r==="de"?"PDF-Download fehlgeschlagen":r==="fr"?"Ã‰chec du tÃ©lÃ©chargement PDF":"PDF download failed")}}:void 0,onBuyBook:K?async()=>{try{C.info("Creating checkout session for story:",K);const{url:a}=await de.createCheckoutSession(K);a&&(window.location.href=a)}catch(a){C.error("Checkout failed:",a),alert(r==="de"?"Checkout fehlgeschlagen. Bitte versuche es erneut.":r==="fr"?"Ã‰chec du paiement. Veuillez rÃ©essayer.":"Checkout failed. Please try again.")}}:void 0,onPrintBook:K?async()=>{let a=await rr.getShippingAddress();if(!a){const g=prompt(r==="de"?"Keine Adresse gespeichert. Bitte eingeben (Format: Vorname, Nachname, Strasse, PLZ, Ort, Land, Email):":r==="fr"?"Aucune adresse enregistrÃ©e. Veuillez entrer (Format: PrÃ©nom, Nom, Rue, CP, Ville, Pays, Email):":"No saved address. Please enter (Format: FirstName, LastName, Street, PostCode, City, Country, Email):");if(!g)return;const A=g.split(",").map(V=>V.trim());if(A.length<7){alert(r==="de"?"UngÃ¼ltiges Adressformat":r==="fr"?"Format d'adresse invalide":"Invalid address format");return}a={firstName:A[0],lastName:A[1],addressLine1:A[2],postCode:A[3],city:A[4],country:A[5],email:A[6]}}const l=`${a.firstName} ${a.lastName}
${a.addressLine1}
${a.postCode} ${a.city}
${a.country}`,u=r==="de"?`Druckauftrag an folgende Adresse senden?

${l}`:r==="fr"?`Envoyer la commande Ã  cette adresse?

${l}`:`Send print order to this address?

${l}`;if(confirm(u))try{C.info("Creating print order for story:",K);const g=await de.createPrintOrder(K,{firstName:a.firstName,lastName:a.lastName,addressLine1:a.addressLine1,city:a.city,postCode:a.postCode,country:a.country,email:a.email||""}),A=r==="de"?`âœ… Druckauftrag erfolgreich erstellt!

Order ID: ${g.orderId}
${g.isDraft?"(Entwurf - muss in Gelato bestÃ¤tigt werden)":""}

MÃ¶chten Sie das Gelato Dashboard Ã¶ffnen, um den Auftrag zu verfolgen?`:r==="fr"?`âœ… Commande d'impression crÃ©Ã©e avec succÃ¨s!

ID de commande: ${g.orderId}
${g.isDraft?"(Brouillon - doit Ãªtre confirmÃ© dans Gelato)":""}

Voulez-vous ouvrir le tableau de bord Gelato pour suivre la commande?`:`âœ… Print order created successfully!

Order ID: ${g.orderId}
${g.isDraft?"(Draft - must be confirmed in Gelato)":""}

Would you like to open the Gelato dashboard to track your order?`;g.dashboardUrl&&confirm(A)?window.open(g.dashboardUrl,"_blank"):g.dashboardUrl||alert(r==="de"?`âœ… Druckauftrag erstellt!

Order ID: ${g.orderId}`:r==="fr"?`âœ… Commande crÃ©Ã©e!

ID: ${g.orderId}`:`âœ… Print order created!

Order ID: ${g.orderId}`)}catch(g){C.error("Print order failed:",g);const A=g instanceof Error?g.message:String(g);alert(r==="de"?`Druckauftrag fehlgeschlagen:
${A}`:r==="fr"?`Ã‰chec de la commande d'impression:
${A}`:`Print order failed:
${A}`)}}:void 0,onCreateAnother:()=>{C.info("Creating new story - resetting settings"),ct(null),wt(null);const a=new URLSearchParams(i);a.delete("storyId"),d(a,{replace:!0}),lt(""),ot(""),dt([]),Ie([]),Ee({frontCover:null,initialPage:null,backCover:null}),St(!1),Ct(void 0),kt(void 0),Pt(void 0),ve(""),ne("pixar"),Pe("standard"),ft(30),bt(""),yt(""),localStorage.removeItem("story_language_level"),localStorage.removeItem("story_pages"),localStorage.removeItem("story_dedication"),localStorage.removeItem("story_details"),localStorage.removeItem("story_main_characters"),$(1)},onRegenerateCover:K?async a=>{try{C.info("Regenerating cover:",a),Ke(!0);const l=await de.regenerateCover(K,a);Ee(u=>u&&{...u,[a==="front"?"frontCover":a==="back"?"backCover":"initialPage"]:{imageData:l.imageData,description:l.description,prompt:l.prompt,qualityScore:l.qualityScore,qualityReasoning:l.qualityReasoning,totalAttempts:l.totalAttempts,retryHistory:l.retryHistory}}),C.info("Cover regenerated successfully")}catch(l){C.error("Cover regeneration failed:",l),alert(r==="de"?"Cover-Generierung fehlgeschlagen":r==="fr"?"Ã‰chec de la rÃ©gÃ©nÃ©ration de la couverture":"Cover regeneration failed")}finally{Ke(!1)}}:void 0,onEditImage:a=>{Ye({type:"image",pageNumber:a}),Oe(""),Qe(!0)},onEditCover:a=>{Ye({type:"cover",coverType:a}),Oe(""),Qe(!0)},isPartial:ds,failureReason:cs,generatedPages:ms,totalPages:us}):i.get("storyId")?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center",children:[e.jsx(Xe,{className:"w-12 h-12 text-indigo-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:r==="de"?"Geschichte wird geladen...":r==="fr"?"Chargement de l'histoire...":"Loading story..."})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:c.generateStory}),e.jsx("p",{className:"text-gray-600 mb-6",children:r==="de"?"Bereit, deine Geschichte zu erstellen!":r==="fr"?"PrÃªt Ã  crÃ©er votre histoire!":"Ready to create your story!"}),e.jsx(et,{onClick:()=>ht(),size:"lg",icon:Me,children:c.generateStory})]});default:return null}};return h?e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx($s,{currentStep:p,onStepClick:xt,canAccessStep:vs,developerMode:w,onDeveloperModeChange:D}),e.jsx("div",{className:"px-3 md:px-8 mt-2 md:mt-8 flex-1",children:e.jsxs("div",{className:"md:bg-white md:rounded-2xl md:shadow-xl md:p-8",children:[j&&!rt?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center",children:[e.jsx(Xe,{className:"w-12 h-12 text-indigo-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium mb-2",children:r==="de"?"Geschichte wird geladen...":r==="fr"?"Chargement de l'histoire...":"Loading story..."}),y&&e.jsxs("div",{className:"w-64 mt-2",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all duration-300 ease-out",style:{width:y.total?`${Math.min(100,y.loaded/y.total*100)}%`:"100%"}})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2 text-center",children:[(y.loaded/(1024*1024)).toFixed(1)," MB",y.total&&e.jsxs("span",{children:[" (",Math.round(y.loaded/y.total*100),"%)"]})]})]})]}):Ss(),p<5&&!q&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[p!==4&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("button",{onClick:Ft,className:"bg-transparent text-gray-800 hover:bg-gray-100 px-6 py-3 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(Bt,{size:20})," ",c.back]}),e.jsxs("button",{onClick:zt,disabled:!Ce(),className:`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${Ce()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[c.next," ",e.jsx(Qt,{size:20})]})]}),p===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:Ft,className:"bg-transparent text-gray-800 hover:bg-gray-100 px-6 py-3 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(Bt,{size:20})," ",c.back]}),w&&e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg text-left",children:[e.jsxs("h3",{className:"text-sm font-semibold text-orange-700 mb-3",children:["ğŸ› ï¸ ",r==="de"?"Entwickler-Optionen - Schritte Ã¼berspringen":r==="fr"?"Options dÃ©veloppeur - Sauter des Ã©tapes":"Developer Options - Skip Steps"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:m=>S(m.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Gliederung Ã¼berspringen":r==="fr"?"Sauter le plan":"Skip outline generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:B,onChange:m=>M(m.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Text Ã¼berspringen":r==="fr"?"Sauter le texte":"Skip text generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:m=>_(m.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Szenenbeschreibungen Ã¼berspringen":r==="fr"?"Sauter les descriptions de scÃ¨nes":"Skip scene descriptions"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:m=>G(m.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Bilder Ã¼berspringen":r==="fr"?"Sauter les images":"Skip image generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ce,onChange:m=>ee(m.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:r==="de"?"Cover Ã¼berspringen":r==="fr"?"Sauter les couvertures":"Skip cover images"})]})]}),e.jsx("p",{className:"text-xs text-orange-600 mt-2",children:r==="de"?"Hinweis: Ãœbersprungene Schritte verwenden Platzhalter/leere Daten":r==="fr"?"Note: Les Ã©tapes sautÃ©es utiliseront des donnÃ©es vides/provisoires":"Note: Skipped steps will use placeholder/empty data"})]}),e.jsxs("button",{onClick:()=>ht(),disabled:!Ce(),className:`w-full py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 ${Ce()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-400 text-white cursor-not-allowed"}`,children:[e.jsx(Me,{size:20})," ",c.generateStory]}),w&&e.jsxs("button",{onClick:()=>ht({skipImages:!0}),disabled:!Ce(),className:`w-full py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 ${Ce()?"bg-yellow-500 text-white hover:bg-yellow-600":"bg-gray-400 text-white cursor-not-allowed"}`,children:[e.jsx(Me,{size:20}),r==="de"?"Nur Text generieren (ohne Bilder)":r==="fr"?"GÃ©nÃ©rer le texte uniquement (sans images)":"Generate Text Only (no images)"]})]})]})]})}),rt&&e.jsx(tr,{current:at.current,total:at.total,message:at.message}),ts&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-sm w-full p-6 text-center",children:[e.jsx("div",{className:"relative inline-block mb-4",children:e.jsx(Xe,{size:40,className:"animate-spin text-indigo-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:r==="de"?"Bild wird erstellt...":r==="fr"?"CrÃ©ation de l'image...":"Generating image..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:r==="de"?"Dies dauert etwa 30 Sekunden":r==="fr"?"Cela prend environ 30 secondes":"This takes about 30 seconds"})]})}),gs&&W&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:r==="de"?"Bild bearbeiten":r==="fr"?"Modifier l'image":"Edit Image"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:W.type==="image"?r==="de"?`Seite ${W.pageNumber}`:r==="fr"?`Page ${W.pageNumber}`:`Page ${W.pageNumber}`:r==="de"?W.coverType==="front"?"Titelseite":W.coverType==="back"?"RÃ¼ckseite":"Einleitungsseite":r==="fr"?W.coverType==="front"?"Couverture":W.coverType==="back"?"Dos":"Page de dÃ©dicace":W.coverType==="front"?"Front Cover":W.coverType==="back"?"Back Cover":"Dedication Page"}),e.jsx("textarea",{value:Re,onChange:m=>Oe(m.target.value),placeholder:r==="de"?`Beschreibe die gewÃ¼nschte Ã„nderung...
z.B. "Mach den Himmel blauer" oder "FÃ¼ge einen Schmetterling hinzu"`:r==="fr"?`DÃ©crivez le changement souhaitÃ©...
par ex. "Rendre le ciel plus bleu" ou "Ajouter un papillon"`:`Describe what you want to change...
e.g. "Make the sky bluer" or "Add a butterfly"`,className:"w-full h-32 p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 resize-none"}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{Qe(!1),Ye(null),Oe("")},className:"flex-1 px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:r==="de"?"Abbrechen":r==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:async()=>{var m;if(!(!Re.trim()||!K)){Qe(!1),Ke(!0);try{if(W.type==="image"&&W.pageNumber){const a=await de.editImage(K,W.pageNumber,Re);if(C.info("Edit result:",{hasImageData:!!(a!=null&&a.imageData),length:(m=a==null?void 0:a.imageData)==null?void 0:m.length}),!(a!=null&&a.imageData))throw C.error("No imageData in edit response!",a),new Error("No image data returned from server");Ie(l=>l.map(u=>u.pageNumber===W.pageNumber?{...u,imageData:a.imageData}:u)),C.info("Image edited successfully, updated state")}else if(W.type==="cover"&&W.coverType){const a=await de.editCover(K,W.coverType,Re);Ee(l=>{if(!l)return l;const u=W.coverType==="front"?"frontCover":W.coverType==="back"?"backCover":"initialPage",g=l[u];return typeof g=="string"||!g?{...l,[u]:{imageData:a.imageData}}:{...l,[u]:{...g,imageData:a.imageData}}}),C.info("Cover edited successfully")}}catch(a){C.error("Edit failed:",a),alert(r==="de"?"Bearbeitung fehlgeschlagen. Bitte versuche es erneut.":r==="fr"?"Ã‰chec de la modification. Veuillez rÃ©essayer.":"Edit failed. Please try again.")}finally{Ke(!1),Ye(null),Oe("")}}},disabled:!Re.trim(),className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:r==="de"?"Bearbeiten":r==="fr"?"Modifier":"Edit"})]})]})})]}):e.jsx(Ps,{fullScreen:!0})}export{xr as default};
