const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LandingPage-eHoVZigR.js","assets/vendor-react-CqfXSjHo.js","assets/Input-Y22R6JyI.js","assets/Textarea-BM5hOAoI.js","assets/sparkles-ag-kx_8I.js","assets/book-open-tlDZzxQl.js","assets/arrow-right-B4YQ4-r_.js","assets/chevron-down-B9xDiT37.js","assets/camera-DsTbHD6n.js","assets/palette-BtlCJXyJ.js","assets/printer-EGJz7Kfw.js","assets/download-JtJqkKak.js","assets/vendor-firebase-DTVMaYMy.js","assets/WelcomePage-D4MQOhmh.js","assets/coins-02468_NS.js","assets/StoryWizard-BwbxTX-n.js","assets/circle-x-Bs_QdcBI.js","assets/clock-CIHAPNLz.js","assets/Modal-C079ErNU.js","assets/arrow-left-BR22WrXS.js","assets/MyStories-ByEFmic8.js","assets/Pricing-2Jp0lsGg.js","assets/book-D9tJnE57.js","assets/check-BfDxjMPu.js","assets/trash-2-Cb_bkZi6.js","assets/MyOrders-DSCuCYQ6.js","assets/AdminDashboard-CyjGrrm5.js","assets/chevron-up-Ctd3lWrq.js","assets/history-CCYLNVCw.js","assets/search-DQ7EBw_e.js","assets/pen-B7xGjPJW.js","assets/plus-Bhh2lyvA.js","assets/BookBuilder-RhRwlFHJ.js","assets/shopping-cart-BRPpAMDc.js","assets/ResetPassword-CHdfuZrg.js","assets/EmailVerified-DMGPfPlc.js","assets/TermsOfService-BA434S50.js","assets/PrivacyPolicy-9phlsX-7.js","assets/Impressum-PKsxelrd.js","assets/SharedStoryViewer-BLWNRC73.js","assets/chevron-right-BggSWfZN.js"])))=>i.map(i=>d[i]);
import{r as Ne,a as Ge,b as i,u as he,c as $e,R as Le,d as D,B as ze}from"./vendor-react-CqfXSjHo.js";import{i as Ue,g as Fe,G as Be,s as Me,b as me,a as Ve,c as He,d as Ke}from"./vendor-firebase-DTVMaYMy.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();var Q={exports:{}},W={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ae;function Je(){if(ae)return W;ae=1;var e=Ne(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(u,g,p){var m,T={},I=null,x=null;p!==void 0&&(I=""+p),g.key!==void 0&&(I=""+g.key),g.ref!==void 0&&(x=g.ref);for(m in g)n.call(g,m)&&!s.hasOwnProperty(m)&&(T[m]=g[m]);if(u&&u.defaultProps)for(m in g=u.defaultProps,g)T[m]===void 0&&(T[m]=g[m]);return{$$typeof:t,type:u,key:I,ref:x,props:T,_owner:o.current}}return W.Fragment=r,W.jsx=l,W.jsxs=l,W}var ie;function We(){return ie||(ie=1,Q.exports=Je()),Q.exports}var a=We(),q={},le;function qe(){if(le)return q;le=1;var e=Ge();return q.createRoot=e.createRoot,q.hydrateRoot=e.hydrateRoot,q}var Ye=qe();const Xe="modulepreload",Ze=function(e){return"/"+e},ce={},N=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){let l=function(p){return Promise.all(p.map(m=>Promise.resolve(m).then(T=>({status:"fulfilled",value:T}),T=>({status:"rejected",reason:T}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),g=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));o=l(r.map(p=>{if(p=Ze(p),p in ce)return;ce[p]=!0;const m=p.endsWith(".css"),T=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${T}`))return;const I=document.createElement("link");if(I.rel=m?"stylesheet":Xe,m||(I.as="script"),I.crossOrigin="",I.href=p,g&&I.setAttribute("nonce",g),document.head.appendChild(I),m)return new Promise((x,A)=>{I.addEventListener("load",x),I.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${p}`)))})}))}function s(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return o.then(l=>{for(const u of l||[])u.status==="rejected"&&s(u.reason);return t().catch(s)})};function Qe({size:e="md",fullScreen:t=!1,message:r}){const n={sm:"w-6 h-6 border-2",md:"w-10 h-10 border-3",lg:"w-16 h-16 border-4"},o=a.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[a.jsx("div",{className:`${n[e]} spinner`}),r&&a.jsx("p",{className:"text-indigo-600 font-medium",children:r})]});return t?a.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 flex items-center justify-center z-50",children:o}):o}let R={isAdmin:!1,prefix:"ðŸª„"};const K={debug:"color: #9ca3af; font-weight: normal;",info:"color: #6366f1; font-weight: normal;",warn:"color: #f59e0b; font-weight: bold;",error:"color: #ef4444; font-weight: bold;",success:"color: #22c55e; font-weight: bold;"};function et(e){R={...R,...e},R.isAdmin&&console.log("%cðŸ”“ Admin logging enabled",K.success)}function tt(){return R.isAdmin}function fe(e,...t){R.isAdmin&&console.log(`%c${R.prefix} [DEBUG] ${e}`,K.debug,...t)}function ye(e,...t){R.isAdmin&&console.log(`%c${R.prefix} [INFO] ${e}`,K.info,...t)}function Se(e,...t){R.isAdmin&&console.log(`%c${R.prefix} âœ“ ${e}`,K.success,...t)}function we(e,...t){console.warn(`%c${R.prefix} [WARN] ${e}`,K.warn,...t)}function ve(e,...t){console.error(`%c${R.prefix} [ERROR] ${e}`,K.error,...t)}function Ae(e){R.isAdmin&&console.group(`${R.prefix} ${e}`)}function Te(){R.isAdmin&&console.groupEnd()}function Ce(e){R.isAdmin&&console.table(e)}function be(e){R.isAdmin&&console.time(`${R.prefix} ${e}`)}function Pe(e){R.isAdmin&&console.timeEnd(`${R.prefix} ${e}`)}function rt(e){const t=`[${e}]`;return{debug:(r,...n)=>fe(`${t} ${r}`,...n),info:(r,...n)=>ye(`${t} ${r}`,...n),success:(r,...n)=>Se(`${t} ${r}`,...n),warn:(r,...n)=>we(`${t} ${r}`,...n),error:(r,...n)=>ve(`${t} ${r}`,...n),group:r=>Ae(`${t} ${r}`),groupEnd:Te,table:Ce,time:r=>be(`${t} ${r}`),timeEnd:r=>Pe(`${t} ${r}`)}}const v={configure:et,isVerbose:tt,debug:fe,info:ye,success:Se,warn:we,error:ve,group:Ae,groupEnd:Te,table:Ce,time:be,timeEnd:Pe,create:rt},re={};let M="localStorage",ue=!1;function J(){if(ue)return;ue=!0;const e="__storage_test__";try{localStorage.setItem(e,e),localStorage.removeItem(e),M="localStorage";return}catch{console.warn("localStorage not available, trying sessionStorage")}try{sessionStorage.setItem(e,e),sessionStorage.removeItem(e),M="sessionStorage",console.warn("Using sessionStorage as fallback (session will not persist)");return}catch{console.warn("sessionStorage not available, using memory storage")}M="memory",console.warn("Using memory storage (session will be lost on page refresh)")}function ne(){return J(),M==="localStorage"?localStorage:M==="sessionStorage"?sessionStorage:null}function nt(e){J();const t=ne();if(t)try{return t.getItem(e)}catch{}return re[e]??null}function ot(e,t){J();const r=ne();if(r)try{return r.setItem(e,t),!0}catch(n){console.warn(`Failed to save to ${M}:`,n)}return re[e]=t,M==="memory"}function Ie(e){J();const t=ne();if(t)try{t.removeItem(e)}catch{}delete re[e]}function st(){["auth_token","current_user","impersonation_state","auth_redirect_url","pendingStoryGeneration","developer_mode"].forEach(t=>Ie(t))}function at(){return J(),M}function it(){return J(),M==="localStorage"}const P={AUTH_TOKEN:"auth_token",CURRENT_USER:"current_user",IMPERSONATION_STATE:"impersonation_state",AUTH_REDIRECT_URL:"auth_redirect_url",PENDING_STORY_GENERATION:"pendingStoryGeneration",LANGUAGE:"magicalstory_language",STORIES_SELECTED:"mystories_selected"},y={getItem:nt,setItem:ot,removeItem:Ie,clearAuthStorage:st,getStorageType:at,isPersistentStorage:it,STORAGE_KEYS:P},lt={apiKey:"AIzaSyCtdyVIpckWhIfy1_9O8qOaEnTXFuiRYaQ",authDomain:"magical-story-3b745.firebaseapp.com",projectId:"magical-story-3b745",storageBucket:"magical-story-3b745.firebasestorage.app",messagingSenderId:"69965481554",appId:"1:69965481554:web:d264515ca92d2306f5018b",measurementId:"G-TERDSLHHDG"},ct=Ue(lt),X=Fe(ct),te=new Be;te.setCustomParameters({prompt:"select_account"});async function ut(){try{return(await Me(X,te,me)).user}catch(e){const t=e;throw console.error("Popup sign-in failed:",t.code,t.message),t.code==="auth/popup-blocked"||t.code==="auth/popup-closed-by-user"||t.code==="auth/cancelled-popup-request"?(console.log("Popup failed, trying redirect..."),await Ve(X,te),new Error("Redirecting to Google...")):e}}async function dt(){try{const e=await Ke(X,me);return e?(console.log("Redirect result: user found"),e.user):null}catch(e){return console.error("Error handling redirect result:",e),null}}async function gt(e){return e.getIdToken()}async function pt(){await He(X)}const Ee=i.createContext(null),L="",ht=8640*60*1e3;function mt({children:e}){const[t,r]=i.useState({isAuthenticated:!1,user:null,token:null,isImpersonating:!1,originalAdmin:null}),[n,o]=i.useState(!0),[s,l]=i.useState(null),u=i.useRef(!1),g=i.useRef(!1),p=i.useRef(null);i.useEffect(()=>{const f=y.getStorageType();f==="sessionStorage"?l("Your session will not persist after closing the browser (private mode detected)"):f==="memory"&&l("Your session will be lost on page refresh (storage unavailable)")},[]);const m=i.useCallback(f=>{try{const c=JSON.parse(atob(f.split(".")[1]));return c.exp?c.exp*1e3:null}catch{return null}},[]),T=i.useCallback(async()=>{const f=y.getItem(P.AUTH_TOKEN);if(!f)return!1;try{const c=await fetch(`${L}/api/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`}});if(!c.ok)return v.warn("Token refresh failed, user may need to re-login"),!1;const d=await c.json();return y.setItem(P.AUTH_TOKEN,d.token),r(h=>({...h,token:d.token})),v.info("Token refreshed successfully"),!0}catch(c){return v.error("Token refresh error:",c),!1}},[]),I=i.useCallback(f=>{p.current&&clearInterval(p.current);const c=m(f);if(!c)return;const d=Date.now(),h=c-d-ht;h>0?(p.current=setTimeout(async()=>{if(await T()){const O=y.getItem(P.AUTH_TOKEN);O&&I(O)}},h),v.info(`Token refresh scheduled in ${Math.round(h/1e3/60)} minutes`)):d<c&&T()},[m,T]);i.useEffect(()=>{const f=y.getItem("token");f&&!y.getItem(P.AUTH_TOKEN)&&(y.setItem(P.AUTH_TOKEN,f),y.removeItem("token"));const c=y.getItem(P.AUTH_TOKEN),d=y.getItem(P.CURRENT_USER);if(c&&d)try{const h=m(c);if(h&&Date.now()>=h){v.warn("Stored token has expired, clearing session"),y.clearAuthStorage(),o(!1);return}const E=JSON.parse(d);E.role!=="admin"&&y.removeItem("developer_mode");const O=y.getItem(P.IMPERSONATION_STATE);let H=!1,Z=null;if(O)try{const se=JSON.parse(O);H=se.isImpersonating||!1,Z=se.originalAdmin||null}catch{y.removeItem(P.IMPERSONATION_STATE)}r({isAuthenticated:!0,user:E,token:c,isImpersonating:H,originalAdmin:Z}),v.configure({isAdmin:Z?!0:E.role==="admin"}),v.info(`Session restored for ${E.username}${H?" (impersonating)":""}`),I(c)}catch{y.clearAuthStorage()}o(!1)},[m,I]);const x=i.useCallback((f,c)=>{if(y.setItem(P.AUTH_TOKEN,f),y.setItem(P.CURRENT_USER,JSON.stringify(c)),y.removeItem(P.IMPERSONATION_STATE),c.role!=="admin"&&y.removeItem("developer_mode"),!y.getItem(P.LANGUAGE)&&c.preferredLanguage){const E={English:"en",German:"de",French:"fr"}[c.preferredLanguage]||"en";y.setItem(P.LANGUAGE,E),window.dispatchEvent(new Event("languageUpdated"))}I(f)},[I]),A=i.useCallback(async(f,c)=>{const d=await fetch(`${L}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:f,password:c})});if(!d.ok){const O=await d.json(),H=new Error(O.error||"Login failed");throw H.code=O.code,H}const h=await d.json(),E={id:h.user.id,username:h.user.username,email:h.user.email,role:h.user.role,credits:h.user.credits,preferredLanguage:h.user.preferredLanguage,emailVerified:h.user.emailVerified,photoConsentAt:h.user.photoConsentAt};x(h.token,E),r({isAuthenticated:!0,user:E,token:h.token,isImpersonating:!1,originalAdmin:null}),v.configure({isAdmin:E.role==="admin"}),v.success(`Logged in as ${E.username} (${E.role})`)},[x]),_=i.useCallback(async(f,c,d,h)=>{const E=await fetch(`${L}/api/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:f,password:c,email:d,website:h==null?void 0:h.website,_formStartTime:h==null?void 0:h._formStartTime})});if(!E.ok){const O=await E.json();throw new Error(O.error||"Registration failed")}await A(f,c)},[A]),j=i.useCallback(async f=>{const c=await gt(f),d=await fetch(`${L}/api/auth/firebase`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idToken:c})});if(!d.ok){const O=await d.json();throw new Error(O.error||"Firebase authentication failed")}const h=await d.json(),E={id:h.user.id,username:h.user.username,email:h.user.email,role:h.user.role,credits:h.user.credits,preferredLanguage:h.user.preferredLanguage,emailVerified:h.user.emailVerified,photoConsentAt:h.user.photoConsentAt};return x(h.token,E),r({isAuthenticated:!0,user:E,token:h.token,isImpersonating:!1,originalAdmin:null}),v.configure({isAdmin:E.role==="admin"}),v.success(`Logged in with Google as ${E.username}`),E},[x]),$=i.useCallback(async f=>{const c=f||window.location.pathname||"/create";y.setItem(P.AUTH_REDIRECT_URL,c);try{const d=await ut();await j(d),y.removeItem(P.AUTH_REDIRECT_URL)}catch(d){if(d instanceof Error&&d.message.includes("Redirecting")){v.info("Google sign-in redirecting...");return}throw d}},[j]),F=i.useCallback(async f=>{const c=await fetch(`${L}/api/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:f})});if(!c.ok){const d=await c.json();throw new Error(d.error||"Password reset failed")}},[]),G=i.useCallback(async(f,c)=>{const d=y.getItem(P.AUTH_TOKEN);if(!d)throw new Error("Not authenticated");const h=await fetch(`${L}/api/auth/change-password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({currentPassword:f,newPassword:c})});if(!h.ok){const E=await h.json();throw new Error(E.error||"Password change failed")}v.success("Password changed successfully")},[]),B=i.useCallback(async()=>{v.info("Logging out..."),p.current&&(clearTimeout(p.current),p.current=null);const f=y.getItem(P.AUTH_TOKEN);if(f)try{await fetch(`${L}/api/auth/logout`,{method:"POST",headers:{Authorization:`Bearer ${f}`}})}catch{}y.clearAuthStorage(),pt().catch(c=>{console.warn("Firebase sign out error:",c)}),r({isAuthenticated:!1,user:null,token:null,isImpersonating:!1,originalAdmin:null}),v.configure({isAdmin:!1})},[]),k=i.useCallback(async f=>{const c=await fetch(`${L}/api/admin/impersonate/${f}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.token}`}});if(!c.ok){const O=await c.json();throw new Error(O.error||"Impersonation failed")}const d=await c.json(),h={id:d.user.id,username:d.user.username,email:d.user.email,role:d.user.role,credits:d.user.credits||0,emailVerified:d.user.emailVerified,photoConsentAt:d.user.photoConsentAt},E={isImpersonating:!0,originalAdmin:d.originalAdmin};y.setItem(P.AUTH_TOKEN,d.token),y.setItem(P.CURRENT_USER,JSON.stringify(h)),y.setItem(P.IMPERSONATION_STATE,JSON.stringify(E)),r({isAuthenticated:!0,user:h,token:d.token,isImpersonating:!0,originalAdmin:d.originalAdmin}),v.configure({isAdmin:!0}),v.info(`Now impersonating ${h.username}`)},[t.token]),b=i.useCallback(async()=>{const f=await fetch(`${L}/api/admin/stop-impersonate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.token}`}});if(!f.ok){const h=await f.json();throw new Error(h.error||"Failed to stop impersonation")}const c=await f.json(),d={id:c.user.id,username:c.user.username,email:c.user.email,role:c.user.role,credits:c.user.credits||0,emailVerified:c.user.emailVerified,photoConsentAt:c.user.photoConsentAt};y.setItem(P.AUTH_TOKEN,c.token),y.setItem(P.CURRENT_USER,JSON.stringify(d)),y.removeItem(P.IMPERSONATION_STATE),r({isAuthenticated:!0,user:d,token:c.token,isImpersonating:!1,originalAdmin:null}),v.configure({isAdmin:!0}),v.info(`Stopped impersonating, back to ${d.username}`)},[t.token]);i.useEffect(()=>{(async()=>{if(!u.current){if(u.current=!0,t.isAuthenticated||t.token){v.info("Already authenticated, skipping redirect check");return}try{v.info("Checking for Google redirect result...");const c=await dt();if(c){if(g.current){v.info("Auth already in progress, skipping");return}g.current=!0,v.info("Firebase user from redirect detected, completing login...");try{await j(c);const d=y.getItem(P.AUTH_REDIRECT_URL);d&&d!==window.location.pathname&&(y.removeItem(P.AUTH_REDIRECT_URL),v.info("Navigating to stored redirect URL:",d),window.location.replace(d))}finally{g.current=!1}}else v.info("No pending Google redirect")}catch(c){g.current=!1,console.error("Redirect result error:",c)}}})()},[t.isAuthenticated,t.token,j]);const S=i.useCallback(f=>{r(c=>{if(!c.user)return c;const d={...c.user,credits:f};return y.setItem(P.CURRENT_USER,JSON.stringify(d)),{...c,user:d}})},[]),C=i.useCallback(async()=>{const f=y.getItem(P.AUTH_TOKEN);if(f)try{const c=await fetch(`${L}/api/auth/me`,{headers:{Authorization:`Bearer ${f}`}});if(!c.ok)return;const d=await c.json(),h={id:d.user.id,username:d.user.username,email:d.user.email,role:d.user.role,credits:d.user.credits,preferredLanguage:d.user.preferredLanguage,emailVerified:d.user.emailVerified,photoConsentAt:d.user.photoConsentAt};y.setItem(P.CURRENT_USER,JSON.stringify(h)),r(E=>({...E,user:h}))}catch(c){v.error("Failed to refresh user:",c)}},[]),z=i.useCallback(async()=>{const f=y.getItem(P.AUTH_TOKEN);if(!f)throw new Error("Not authenticated");const c=await fetch(`${L}/api/auth/photo-consent`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`}});if(!c.ok){const h=await c.json();throw new Error(h.error||"Failed to record consent")}const d=await c.json();r(h=>{if(!h.user)return h;const E={...h.user,photoConsentAt:d.photoConsentAt};return y.setItem(P.CURRENT_USER,JSON.stringify(E)),{...h,user:E}}),v.info("Photo consent recorded")},[]);return i.useEffect(()=>()=>{p.current&&clearTimeout(p.current)},[]),a.jsx(Ee.Provider,{value:{...t,login:A,register:_,loginWithGoogle:$,resetPassword:F,changePassword:G,logout:B,updateCredits:S,refreshUser:C,refreshToken:T,impersonate:k,stopImpersonating:b,recordPhotoConsent:z,isLoading:n,storageWarning:s},children:e})}function xe(){const e=i.useContext(Ee);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e}const ft={en:{title:"Magical Story",subtitle:"Personalize your story to create magic",heroTitle:"Become the hero of your story",heroSubtitle:"",heroDescription:"Turn your wildest ideas into a breathtaking personalized tale.",bookText:"Get a beautifully printed book and make someone feel like the legend they truly are.",startJourney:"Start Your Adventure",selectLanguage:"Choose your language",login:"Login",register:"Register",logout:"Logout",username:"Username",password:"Password",email:"Email (optional)",welcomeBack:"Welcome Back!",createAccount:"Create Account",noAccount:"Don't have an account?",haveAccount:"Already have an account?",signUp:"Sign up",signIn:"Sign in",loginRequired:"Please login to continue",continueWithGoogle:"Continue with Google",continueWithApple:"Continue with Apple",orContinueWith:"or continue with",forgotPassword:"Forgot password?",resetPassword:"Reset Password",resetPasswordDesc:"Enter your email and we'll send you a reset link",sendResetLink:"Send Reset Link",resetLinkSent:"Password reset email sent! Check your inbox.",backToLogin:"Back to login",chooseStoryType:"Choose Your Story Type",chooseArtStyle:"Choose Your Art Style",artStyleDescription:"Select the visual style for your story",addCustomStoryType:"Add Custom Story Type",storyTypeName:"Story Type Name",storyTypeEmoji:"Emoji",addStoryType:"Add",createCharacters:"Create Your Characters",charactersStepTitle:"Characters & Story Roles",characterCreated:"Character Created!",createAnother:"Create Another Character",continueToRelationships:"Continue to Relationships",yourCharacters:"Your Characters:",startCreating:"Start Creating Character",characterName:"Character Name",characterPhoto:"Character Photo",uploadPhoto:"Upload Photo",uploadPhotoFirst:"Please upload a photo to continue",photoGoodExamples:"Good: Full body or upper body",photoBadExamples:"Avoid: Close-up face only, sunglasses, hats, helmets, blurry",noFaceDetected:"No face detected in the photo. Please upload a clear photo showing a face.",orDescribe:"OR describe the character",characterAge:"Age",hairColor:"Hair Color",otherFeatures:"Other Features",descriptionPlaceholder:"e.g., Blue eyes, wears glasses, has freckles",gender:"Gender",male:"Male",female:"Female",other:"Unknown",age:"Age",strengths:"Strengths",weaknesses:"Weaknesses",selectAtLeast:"Select at least",selected:"Selected",addCustomStrengths:"Add custom strengths",addCustomWeaknesses:"Add custom weaknesses",addCustomFears:"Add custom fears",specialDetails:"Hobbies, Interests, Favourite Cuddly Toy, Job and Other Details",specialDetailsPlaceholder:"e.g., Enjoys painting, loves dinosaurs, favourite teddy bear called Bruno, wants to be a firefighter",fears:"Fears",addCustomRelationship:"Add custom relationship",cancel:"Cancel",saveCharacter:"Save Character",editCharacter:"Edit",deleteCharacter:"Delete",defineRelationships:"Define Character Relationships",defineRelationshipsDesc:"Define how each character relates to the others.",is:"is",reverseRelationship:"Reverse relationship:",storySettings:"Story Settings",selectMainCharacters:"Select Main Characters (max 2)",numberOfPages:"Number of Pages",readingLevel:"Reading Level",firstGrade:"Picture Book",firstGradeDesc:`Ages: 3-6
Language: simple vocabulary, short sentences
Recommended pages: 10-20
Ideal for: 1-2 characters, simple stories`,standard:"Chapter Book",standardDesc:`Ages: 6-10
Language: accessible vocabulary, normal sentences
Recommended pages: 20-30
Ideal for: 2-4 characters`,advanced:"Young Reader",advancedDesc:`Ages: 10+
Language: rich vocabulary, complex sentences
Recommended pages: 30-50
Ideal for: many characters, complex storylines`,generateStory:"Generate Story!",creating:"Creating Your Story...",storyReady:"Your Story is Ready!",downloadTXT:"Download as TXT",downloadPDF:"Download as PDF",downloadPrompt:"Download Prompt",viewPrompt:"View Prompt",hidePrompt:"Hide Prompt",promptUsed:"Prompt Used to Generate Story:",createAnotherStory:"Create Another Story",back:"Back",next:"Next",exportConfig:"Export Configuration",exportStoryInfo:"Export Story Info (MD)",importConfig:"Import Configuration",charactersCreated:"You've created {count} character{s} so far.",mainCharacter:"Main Character",apiKeyRequired:"API Key Required",apiKeyPrompt:"Please enter your Anthropic API key to generate stories:",apiKeyPlaceholder:"sk-ant-...",saveApiKey:"Save API Key",apiKeyNote:"Your API key is stored locally in your browser and never sent anywhere except to Anthropic.",promptPreview:"Prompt Preview",showPromptPreview:"Show Prompt",hidePromptPreview:"Hide Prompt",editPrompt:"Edit Prompt",resetPrompt:"Reset to Default",storyDetails:"Story Plot / Story Details",storyDetailsOptional:"(optional)",storyDetailsPlaceholder:"e.g., Location: Enchanted forest, Special elements: Magical talking animals, Time period: Medieval times...",generateOutline:"Generate Outline",generatingOutline:"Generating Outline...",outlineReady:"Story Outline",editOutline:"You can edit the outline below before generating the full story:",regenerateOutline:"Regenerate Outline",createScenes:"Create Scene Descriptions",creatingScenes:"Creating Scene Descriptions...",scenesReady:"Scene Descriptions",downloadScenes:"Download Scenes",sceneForPage:"Scene for Page",yourStory:"Your Story",uploadStory:"Upload Story",uploadStoryDesc:"Upload an existing story text file to generate scene descriptions",generateImages:"Generate Scene Images",generatingImages:"Generating Images...",imagesReady:"Scene Images",downloadImage:"Download Image",geminiApiKey:"Gemini API Key",geminiApiKeyPrompt:"Enter your Google Gemini API key to generate images:",geminiApiKeyNote:"Get your key from Google AI Studio",imageForPage:"Image for Page",generateAvatar:"Generate Pixar Avatar",generatingAvatar:"Generating Avatar...",avatarGenerated:"Avatar Generated!",useGeneratedAvatar:"Use Generated Avatar",keepOriginal:"Keep Original Photo",uploadType:"What are you uploading?",uploadRealPhoto:"Real Photo (will generate avatar)",uploadReadyAvatar:"Ready Avatar (already stylized)",editStory:"Edit Story",saveStory:"Save Story",editScene:"Edit Scene",saveScene:"Save Scene",editImage:"Edit Image",regenerateImage:"Regenerate Image",showEditPrompt:"Show Prompt",hideEditPrompt:"Hide Prompt",editInstruction:"What should be changed?",applyEdit:"Apply Edit",passwordMinChars:"Minimum 6 characters",selectStrengthsFlaws:"Please select at least 3 strengths and 2 flaws",fillAllFields:"Please fill in all fields",networkError:"Network error. Please check your connection and try again.",operationTimeout:"The operation timed out. Please try again.",failedGeneric:"An error occurred. Please try again.",generationStalled:"Generation seems stuck",generationStalledDesc:"No progress for a while. This can happen due to high server load.",impersonationViewingAs:"Viewing as",impersonationStopViewing:"Stop viewing",impersonationStopping:"Stopping...",continueWaiting:"Keep Waiting",cancelGeneration:"Cancel"},de:{title:"Magical Story",subtitle:"Personalisiere deine Geschichte fÃ¼r Magie",heroTitle:"Werde zum Helden deiner Geschichte",heroSubtitle:"",heroDescription:"Verwandle deine wildesten Ideen in eine atemberaubende personalisierte Geschichte.",bookText:"Erhalte ein wunderschÃ¶n gedrucktes Buch und gib jemandem das GefÃ¼hl, die Legende zu sein, die er wirklich ist.",startJourney:"Starte dein Abenteuer",selectLanguage:"WÃ¤hle deine Sprache",login:"Anmelden",register:"Registrieren",logout:"Abmelden",username:"Benutzername",password:"Passwort",email:"E-Mail (optional)",welcomeBack:"Willkommen zurÃ¼ck!",createAccount:"Konto erstellen",noAccount:"Noch kein Konto?",haveAccount:"Bereits ein Konto?",signUp:"Registrieren",signIn:"Anmelden",loginRequired:"Bitte melde dich an, um fortzufahren",continueWithGoogle:"Mit Google fortfahren",continueWithApple:"Mit Apple fortfahren",orContinueWith:"oder fortfahren mit",forgotPassword:"Passwort vergessen?",resetPassword:"Passwort zurÃ¼cksetzen",resetPasswordDesc:"Gib deine E-Mail ein und wir senden dir einen Link zum ZurÃ¼cksetzen",sendResetLink:"Link senden",resetLinkSent:"E-Mail zum ZurÃ¼cksetzen gesendet! ÃœberprÃ¼fe deinen Posteingang.",backToLogin:"ZurÃ¼ck zur Anmeldung",chooseStoryType:"WÃ¤hle deinen Geschichtentyp",chooseArtStyle:"WÃ¤hle deinen Kunststil",artStyleDescription:"WÃ¤hle den visuellen Stil fÃ¼r deine Geschichte",addCustomStoryType:"Eigenen Geschichtentyp hinzufÃ¼gen",storyTypeName:"Name des Geschichtentyps",storyTypeEmoji:"Emoji",addStoryType:"HinzufÃ¼gen",createCharacters:"Erstelle deine Charaktere",charactersStepTitle:"Charaktere & Rollen",characterCreated:"Charakter erstellt!",createAnother:"Weiteren Charakter erstellen",continueToRelationships:"Weiter zu Beziehungen",yourCharacters:"Deine Charaktere:",startCreating:"Charakter erstellen beginnen",characterName:"Charaktername",characterPhoto:"Charakterfoto",uploadPhoto:"Foto hochladen",uploadPhotoFirst:"Bitte laden Sie ein Foto hoch, um fortzufahren",photoGoodExamples:"Gut: GanzkÃ¶rper oder OberkÃ¶rper",photoBadExamples:"Vermeiden: Nur Gesicht, Sonnenbrille, HÃ¼te, Helme, unscharf",noFaceDetected:"Kein Gesicht im Foto erkannt. Bitte laden Sie ein klares Foto mit einem sichtbaren Gesicht hoch.",orDescribe:"ODER Figur beschreiben",characterAge:"Alter",hairColor:"Haarfarbe",otherFeatures:"Sonstige Merkmale",descriptionPlaceholder:"z.B. Blaue Augen, trÃ¤gt Brille, hat Sommersprossen",gender:"Geschlecht",male:"MÃ¤nnlich",female:"Weiblich",other:"Unbekannt",age:"Alter",strengths:"StÃ¤rken",weaknesses:"SchwÃ¤chen",selectAtLeast:"WÃ¤hle mindestens",selected:"AusgewÃ¤hlt",addCustomStrengths:"Eigene StÃ¤rken hinzufÃ¼gen",addCustomWeaknesses:"Eigene SchwÃ¤chen hinzufÃ¼gen",addCustomFears:"Eigene Ã„ngste hinzufÃ¼gen",specialDetails:"Hobbys, Interessen, Lieblingskuscheltier, Beruf und andere Besonderheiten",specialDetailsPlaceholder:"z.B. Malt gerne, liebt Dinosaurier, Lieblingsteddy heisst Bruno, will Feuerwehrmann werden",fears:"Ã„ngste",addCustomRelationship:"Eigene Beziehung hinzufÃ¼gen",cancel:"Abbrechen",saveCharacter:"Charakter speichern",editCharacter:"Bearbeiten",deleteCharacter:"LÃ¶schen",defineRelationships:"Charakterbeziehungen definieren",defineRelationshipsDesc:"Definiere, wie die Charaktere zueinander stehen.",is:"ist",reverseRelationship:"Umgekehrte Beziehung:",storySettings:"Geschichten-Einstellungen",selectMainCharacters:"Hauptfiguren auswÃ¤hlen (max 2)",numberOfPages:"Anzahl der Seiten",readingLevel:"Lesestufe",firstGrade:"Bilderbuch",firstGradeDesc:`Alter: 3-6
Sprache: einfacher Wortschatz, kurze SÃ¤tze
Empfohlene Seiten: 10-20
Ideal fÃ¼r: 1-2 Figuren, einfache Geschichten`,standard:"Kinderbuch",standardDesc:`Alter: 6-10
Sprache: verstÃ¤ndlicher Wortschatz, normale SÃ¤tze
Empfohlene Seiten: 20-30
Ideal fÃ¼r: 2-4 Figuren`,advanced:"Jugendbuch",advancedDesc:`Alter: 10+
Sprache: reicher Wortschatz, komplexe SÃ¤tze
Empfohlene Seiten: 30-50
Ideal fÃ¼r: viele Figuren, komplexe Handlung`,generateStory:"Geschichte erstellen!",creating:"Erstelle deine Geschichte...",storyReady:"Deine Geschichte ist fertig!",downloadTXT:"Als TXT herunterladen",downloadPDF:"Als PDF herunterladen",downloadPrompt:"Prompt herunterladen",viewPrompt:"Prompt anzeigen",hidePrompt:"Prompt ausblenden",promptUsed:"Verwendeter Prompt:",createAnotherStory:"Neue Geschichte erstellen",back:"ZurÃ¼ck",next:"Weiter",exportConfig:"Konfiguration exportieren",exportStoryInfo:"Story-Info exportieren (MD)",importConfig:"Konfiguration importieren",charactersCreated:"Du hast bisher {count} Charakter{s} erstellt.",mainCharacter:"Hauptfigur",apiKeyRequired:"API-SchlÃ¼ssel erforderlich",apiKeyPrompt:"Bitte geben Sie Ihren Anthropic API-SchlÃ¼ssel ein:",apiKeyPlaceholder:"sk-ant-...",saveApiKey:"API-SchlÃ¼ssel speichern",apiKeyNote:"Ihr API-SchlÃ¼ssel wird lokal im Browser gespeichert.",promptPreview:"Prompt-Vorschau",showPromptPreview:"Prompt anzeigen",hidePromptPreview:"Prompt ausblenden",editPrompt:"Prompt bearbeiten",resetPrompt:"Auf Standard zurÃ¼cksetzen",storyDetails:"Handlung / Angaben zur Geschichte",storyDetailsOptional:"(optional)",storyDetailsPlaceholder:"z.B. Ort: Verzauberter Wald, Besondere Elemente: Magische sprechende Tiere, Zeitperiode: Mittelalter...",generateOutline:"Gliederung erstellen",generatingOutline:"Gliederung wird erstellt...",outlineReady:"Story-Gliederung",editOutline:"Sie kÃ¶nnen die Gliederung unten bearbeiten, bevor Sie die vollstÃ¤ndige Geschichte erstellen:",regenerateOutline:"Gliederung neu erstellen",createScenes:"Szenen-Beschreibungen erstellen",creatingScenes:"Szenen-Beschreibungen werden erstellt...",scenesReady:"Szenen-Beschreibungen",downloadScenes:"Szenen herunterladen",sceneForPage:"Szene fÃ¼r Seite",yourStory:"Deine Geschichte",uploadStory:"Geschichte hochladen",uploadStoryDesc:"Laden Sie eine vorhandene Story-Textdatei hoch, um Szenenbeschreibungen zu generieren",generateImages:"Szenenbilder generieren",generatingImages:"Bilder werden generiert...",imagesReady:"Szenenbilder",downloadImage:"Bild herunterladen",geminiApiKey:"Gemini API-SchlÃ¼ssel",geminiApiKeyPrompt:"Geben Sie Ihren Google Gemini API-SchlÃ¼ssel ein:",geminiApiKeyNote:"Holen Sie sich Ihren SchlÃ¼ssel von Google AI Studio",imageForPage:"Bild fÃ¼r Seite",generateAvatar:"Pixar-Avatar erstellen",generatingAvatar:"Avatar wird erstellt...",avatarGenerated:"Avatar erstellt!",useGeneratedAvatar:"Generierten Avatar verwenden",keepOriginal:"Originalfoto behalten",uploadType:"Was laden Sie hoch?",uploadRealPhoto:"Echtes Foto (Avatar wird generiert)",uploadReadyAvatar:"Fertiger Avatar (bereits stilisiert)",editStory:"Geschichte bearbeiten",saveStory:"Geschichte speichern",editScene:"Szene bearbeiten",saveScene:"Szene speichern",editImage:"Bild bearbeiten",regenerateImage:"Bild neu generieren",showEditPrompt:"Prompt anzeigen",hideEditPrompt:"Prompt ausblenden",editInstruction:"Was soll geÃ¤ndert werden?",applyEdit:"Ã„nderung anwenden",passwordMinChars:"Mindestens 6 Zeichen",selectStrengthsFlaws:"Bitte mindestens 3 StÃ¤rken und 2 SchwÃ¤chen wÃ¤hlen",fillAllFields:"Bitte alle Felder ausfÃ¼llen",networkError:"Netzwerkfehler. Bitte Verbindung prÃ¼fen und erneut versuchen.",operationTimeout:"Die Anfrage ist abgelaufen. Bitte erneut versuchen.",failedGeneric:"Ein Fehler ist aufgetreten. Bitte erneut versuchen.",generationStalled:"Generierung scheint hÃ¤ngen zu bleiben",generationStalledDesc:"Seit einer Weile kein Fortschritt. Dies kann bei hoher Serverlast passieren.",impersonationViewingAs:"Ansicht als",impersonationStopViewing:"Ansicht beenden",impersonationStopping:"Beenden...",continueWaiting:"Weiter warten",cancelGeneration:"Abbrechen"},fr:{title:"Magical Story",subtitle:"Personnalisez votre histoire pour crÃ©er la magie",heroTitle:"Devenez le hÃ©ros de votre histoire",heroSubtitle:"",heroDescription:"Transformez vos idÃ©es les plus folles en un conte personnalisÃ© Ã©poustouflant.",bookText:"Obtenez un livre magnifiquement imprimÃ© et donnez Ã  quelqu'un le sentiment d'Ãªtre la lÃ©gende qu'il est vraiment.",startJourney:"Commencez votre aventure",selectLanguage:"Choisissez votre langue",login:"Connexion",register:"S'inscrire",logout:"DÃ©connexion",username:"Nom d'utilisateur",password:"Mot de passe",email:"Email (facultatif)",welcomeBack:"Bon retour !",createAccount:"CrÃ©er un compte",noAccount:"Pas encore de compte ?",haveAccount:"Vous avez dÃ©jÃ  un compte ?",signUp:"S'inscrire",signIn:"Se connecter",loginRequired:"Veuillez vous connecter pour continuer",continueWithGoogle:"Continuer avec Google",continueWithApple:"Continuer avec Apple",orContinueWith:"ou continuer avec",forgotPassword:"Mot de passe oubliÃ© ?",resetPassword:"RÃ©initialiser le mot de passe",resetPasswordDesc:"Entrez votre e-mail et nous vous enverrons un lien de rÃ©initialisation",sendResetLink:"Envoyer le lien",resetLinkSent:"E-mail de rÃ©initialisation envoyÃ© ! VÃ©rifiez votre boÃ®te de rÃ©ception.",backToLogin:"Retour Ã  la connexion",chooseStoryType:"Choisissez votre type d'histoire",chooseArtStyle:"Choisissez Votre Style Artistique",artStyleDescription:"SÃ©lectionnez le style visuel pour votre histoire",addCustomStoryType:"Ajouter un type d'histoire personnalisÃ©",storyTypeName:"Nom du type d'histoire",storyTypeEmoji:"Emoji",addStoryType:"Ajouter",createCharacters:"CrÃ©ez vos personnages",charactersStepTitle:"Personnages & RÃ´les",characterCreated:"Personnage crÃ©Ã© !",createAnother:"CrÃ©er un autre personnage",continueToRelationships:"Continuer vers les Relations",yourCharacters:"Vos personnages :",startCreating:"Commencer Ã  crÃ©er un personnage",characterName:"Nom du personnage",characterPhoto:"Photo du personnage",uploadPhoto:"TÃ©lÃ©charger une Photo",uploadPhotoFirst:"Veuillez tÃ©lÃ©charger une photo pour continuer",photoGoodExamples:"Bien : Corps entier ou buste",photoBadExamples:"Ã‰viter : Gros plan visage, lunettes de soleil, chapeaux, casques, flou",noFaceDetected:"Aucun visage dÃ©tectÃ© dans la photo. Veuillez tÃ©lÃ©charger une photo claire montrant un visage.",orDescribe:"OU dÃ©crivez le personnage",characterAge:"Ã‚ge",hairColor:"Couleur des Cheveux",otherFeatures:"Autres CaractÃ©ristiques",descriptionPlaceholder:"ex. Yeux bleus, porte des lunettes, a des taches de rousseur",gender:"Genre",male:"Masculin",female:"FÃ©minin",other:"Inconnu",age:"Ã‚ge",strengths:"Forces",weaknesses:"Faiblesses",selectAtLeast:"SÃ©lectionnez au moins",selected:"SÃ©lectionnÃ©",addCustomStrengths:"Ajouter des forces personnalisÃ©es",addCustomWeaknesses:"Ajouter des faiblesses personnalisÃ©es",addCustomFears:"Ajouter des peurs personnalisÃ©es",specialDetails:"Loisirs, IntÃ©rÃªts, Peluche PrÃ©fÃ©rÃ©e, MÃ©tier et Autres DÃ©tails",specialDetailsPlaceholder:"ex. Aime peindre, adore les dinosaures, son nounours prÃ©fÃ©rÃ© s'appelle Bruno, veut devenir pompier",fears:"Peurs",addCustomRelationship:"Ajouter une relation personnalisÃ©e",cancel:"Annuler",saveCharacter:"Enregistrer le personnage",editCharacter:"Modifier",deleteCharacter:"Supprimer",defineRelationships:"DÃ©finir les relations entre personnages",defineRelationshipsDesc:"DÃ©finissez comment chaque personnage est liÃ© aux autres.",is:"est",reverseRelationship:"Relation inverse :",storySettings:"ParamÃ¨tres de l'histoire",selectMainCharacters:"SÃ©lectionner les personnages principaux (max 2)",numberOfPages:"Nombre de Pages",readingLevel:"Niveau de Lecture",firstGrade:"Album IllustrÃ©",firstGradeDesc:`Ã‚ge: 3-6
Langue: vocabulaire simple, phrases courtes
Pages recommandÃ©es: 10-20
IdÃ©al pour: 1-2 personnages, histoires simples`,standard:"Livre Enfant",standardDesc:`Ã‚ge: 6-10
Langue: vocabulaire accessible, phrases normales
Pages recommandÃ©es: 20-30
IdÃ©al pour: 2-4 personnages`,advanced:"Roman Jeunesse",advancedDesc:`Ã‚ge: 10+
Langue: vocabulaire riche, phrases complexes
Pages recommandÃ©es: 30-50
IdÃ©al pour: plusieurs personnages, intrigues complexes`,generateStory:"GÃ©nÃ©rer l'histoire !",creating:"CrÃ©ation de votre histoire...",storyReady:"Votre histoire est prÃªte !",downloadTXT:"TÃ©lÃ©charger en TXT",downloadPDF:"TÃ©lÃ©charger en PDF",downloadPrompt:"TÃ©lÃ©charger le Prompt",viewPrompt:"Voir le Prompt",hidePrompt:"Masquer le Prompt",promptUsed:"Prompt utilisÃ© pour gÃ©nÃ©rer l'histoire :",createAnotherStory:"CrÃ©er une autre histoire",back:"Retour",next:"Suivant",exportConfig:"Exporter la Configuration",exportStoryInfo:"Exporter les Infos (MD)",importConfig:"Importer la Configuration",charactersCreated:"Vous avez crÃ©Ã© {count} personnage{s} jusqu'Ã  prÃ©sent.",mainCharacter:"Personnage principal",apiKeyRequired:"ClÃ© API Requise",apiKeyPrompt:"Veuillez entrer votre clÃ© API Anthropic pour gÃ©nÃ©rer des histoires :",apiKeyPlaceholder:"sk-ant-...",saveApiKey:"Enregistrer la ClÃ© API",apiKeyNote:"Votre clÃ© API est stockÃ©e localement dans votre navigateur.",promptPreview:"AperÃ§u du Prompt",showPromptPreview:"Afficher le Prompt",hidePromptPreview:"Masquer le Prompt",editPrompt:"Modifier le Prompt",resetPrompt:"RÃ©initialiser par DÃ©faut",storyDetails:"Intrigue / Contexte du rÃ©cit",storyDetailsOptional:"(facultatif)",storyDetailsPlaceholder:"ex. Lieu : ForÃªt enchantÃ©e, Ã‰lÃ©ments spÃ©ciaux : Animaux magiques parlants, PÃ©riode : Moyen Ã‚ge...",generateOutline:"GÃ©nÃ©rer le Plan",generatingOutline:"GÃ©nÃ©ration du Plan...",outlineReady:"Plan de l'histoire",editOutline:"Vous pouvez modifier le plan ci-dessous avant de gÃ©nÃ©rer l'histoire complÃ¨te :",regenerateOutline:"RegÃ©nÃ©rer le Plan",createScenes:"CrÃ©er les Descriptions de ScÃ¨nes",creatingScenes:"CrÃ©ation des Descriptions de ScÃ¨nes...",scenesReady:"Descriptions de ScÃ¨nes",downloadScenes:"TÃ©lÃ©charger les ScÃ¨nes",sceneForPage:"ScÃ¨ne pour la Page",yourStory:"Votre histoire",uploadStory:"TÃ©lÃ©charger une histoire",uploadStoryDesc:"TÃ©lÃ©chargez un fichier texte existant pour gÃ©nÃ©rer des descriptions de scÃ¨nes",generateImages:"GÃ©nÃ©rer les Images de ScÃ¨nes",generatingImages:"GÃ©nÃ©ration des Images...",imagesReady:"Images de ScÃ¨nes",downloadImage:"TÃ©lÃ©charger l'Image",geminiApiKey:"ClÃ© API Gemini",geminiApiKeyPrompt:"Entrez votre clÃ© API Google Gemini pour gÃ©nÃ©rer des images :",geminiApiKeyNote:"Obtenez votre clÃ© sur Google AI Studio",imageForPage:"Image pour la Page",generateAvatar:"GÃ©nÃ©rer un Avatar Pixar",generatingAvatar:"GÃ©nÃ©ration de l'Avatar...",avatarGenerated:"Avatar GÃ©nÃ©rÃ© !",useGeneratedAvatar:"Utiliser l'Avatar GÃ©nÃ©rÃ©",keepOriginal:"Garder la Photo Originale",uploadType:"Que tÃ©lÃ©chargez-vous ?",uploadRealPhoto:"Photo rÃ©elle (avatar sera gÃ©nÃ©rÃ©)",uploadReadyAvatar:"Avatar prÃªt (dÃ©jÃ  stylisÃ©)",editStory:"Modifier l'histoire",saveStory:"Enregistrer l'histoire",editScene:"Modifier la ScÃ¨ne",saveScene:"Enregistrer la ScÃ¨ne",editImage:"Modifier l'Image",regenerateImage:"RegÃ©nÃ©rer l'Image",showEditPrompt:"Afficher le Prompt",hideEditPrompt:"Masquer le Prompt",editInstruction:"Que faut-il changer ?",applyEdit:"Appliquer la Modification",passwordMinChars:"Minimum 6 caractÃ¨res",selectStrengthsFlaws:"Veuillez sÃ©lectionner au moins 3 forces et 2 dÃ©fauts",fillAllFields:"Veuillez remplir tous les champs",networkError:"Erreur rÃ©seau. Veuillez vÃ©rifier votre connexion et rÃ©essayer.",operationTimeout:"L'opÃ©ration a expirÃ©. Veuillez rÃ©essayer.",failedGeneric:"Une erreur est survenue. Veuillez rÃ©essayer.",generationStalled:"La gÃ©nÃ©ration semble bloquÃ©e",generationStalledDesc:"Aucun progrÃ¨s depuis un moment. Cela peut arriver en cas de forte charge serveur.",impersonationViewingAs:"Vue en tant que",impersonationStopViewing:"Arreter la vue",impersonationStopping:"ArrÃªt...",continueWaiting:"Continuer Ã  attendre",cancelGeneration:"Annuler"}},ke=i.createContext(null),Y="magicalstory_language";function yt(){var t;const e=(t=navigator.language)==null?void 0:t.toLowerCase();return!e||e.startsWith("de")?"de":e.startsWith("fr")?"fr":(e.startsWith("en"),"en")}function St({children:e}){const[t,r]=i.useState(()=>{const s=localStorage.getItem(Y);return s&&["en","de","fr"].includes(s)?s:yt()});i.useEffect(()=>{localStorage.setItem(Y,t),document.documentElement.lang=t},[t]),i.useEffect(()=>{const s=u=>{u.key===Y&&u.newValue&&["en","de","fr"].includes(u.newValue)&&r(u.newValue)},l=()=>{const u=localStorage.getItem(Y);u&&["en","de","fr"].includes(u)&&u!==t&&r(u)};return window.addEventListener("storage",s),window.addEventListener("languageUpdated",l),()=>{window.removeEventListener("storage",s),window.removeEventListener("languageUpdated",l)}},[t]);const n=s=>{r(s)},o=ft[t];return a.jsx(ke.Provider,{value:{language:t,setLanguage:n,t:o},children:e})}function wt(){const e=i.useContext(ke);if(!e)throw new Error("useTranslation must be used within a LanguageProvider");return e}const vt=wt;/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Re=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Tt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=i.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:o="",children:s,iconNode:l,...u},g)=>i.createElement("svg",{ref:g,...Tt,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:Re("lucide",o),...u},[...l.map(([p,m])=>i.createElement(p,m)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=(e,t)=>{const r=i.forwardRef(({className:n,...o},s)=>i.createElement(Ct,{ref:s,iconNode:t,className:Re(`lucide-${At(e)}`,n),...o}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=V("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=V("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=V("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=V("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=V("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=V("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=V("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function Rt(){const e=he(),{isImpersonating:t,user:r,originalAdmin:n,stopImpersonating:o}=xe(),{t:s}=vt(),[l,u]=i.useState(!1),[g,p]=i.useState(null);if(!t||!r||!n)return null;const m=async()=>{u(!0),p(null);try{await o(),e("/admin")}catch(T){console.error("Failed to stop impersonating:",T),p(T instanceof Error?T.message:"Failed to stop"),u(!1)}};return a.jsxs("div",{className:"bg-amber-500 text-black py-2 px-4 flex items-center justify-center gap-4 text-sm font-medium sticky top-0 z-50",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(It,{size:16}),a.jsxs("span",{children:[s.impersonationViewingAs,": ",a.jsx("strong",{children:r.username})," (",r.email,")"]})]}),g&&a.jsx("span",{className:"text-red-800 bg-red-200 px-2 py-0.5 rounded text-xs",children:g}),a.jsxs("button",{onClick:m,disabled:l,className:"flex items-center gap-1 bg-black/20 hover:bg-black/30 disabled:opacity-50 px-3 py-1 rounded-full transition-colors",children:[l?a.jsx(xt,{size:14,className:"animate-spin"}):a.jsx(_e,{size:14}),a.jsx("span",{children:l?s.impersonationStopping:s.impersonationStopViewing})]})]})}function _t(){const{pathname:e}=$e();return i.useEffect(()=>{window.scrollTo(0,0),document.documentElement.scrollTop=0,document.body.scrollTop=0},[e]),null}const de="";class jt{getToken(){return localStorage.getItem("auth_token")}getHeaders(t=!1){const r={"Content-Type":"application/json"};if(!t){const n=this.getToken();n&&(r.Authorization=`Bearer ${n}`)}return r}async request(t,r={}){const{skipAuth:n=!1,...o}=r,s=await fetch(`${de}${t}`,{...o,headers:{...this.getHeaders(n),...o.headers}});if(!s.ok){const u=await s.json().catch(()=>({error:"Request failed"}));let g=u.error||u.message||`HTTP ${s.status}`;if(u.details){const m=u.details;m.message?g+=`: ${m.message}`:m.error?g+=`: ${m.error}`:typeof m=="string"&&(g+=`: ${m}`)}u.activeJobId&&(g+=`|ACTIVE_JOB:${u.activeJobId}`);const p=new Error(g);throw u.retryAfter&&(p.retryAfter=u.retryAfter),u.code&&(p.code=u.code),p}const l=await s.text();return l?JSON.parse(l):{}}async get(t,r){return this.request(t,{...r,method:"GET"})}async post(t,r,n){return this.request(t,{...n,method:"POST",body:r?JSON.stringify(r):void 0})}async put(t,r,n){return this.request(t,{...n,method:"PUT",body:r?JSON.stringify(r):void 0})}async patch(t,r,n){return this.request(t,{...n,method:"PATCH",body:r?JSON.stringify(r):void 0})}async delete(t,r){return this.request(t,{...r,method:"DELETE"})}async uploadFile(t,r,n){const o=new FormData;o.append("file",r),n&&Object.entries(n).forEach(([u,g])=>{o.append(u,g)});const s=this.getToken(),l=await fetch(`${de}${t}`,{method:"POST",headers:s?{Authorization:`Bearer ${s}`}:{},body:o});if(!l.ok){const u=await l.json().catch(()=>({error:"Upload failed"}));throw new Error(u.error||"Upload failed")}return l.json()}}const w=new jt;function ee(e){return e?typeof e=="string"?{imageData:e}:e:null}function ge(e){return e?{frontCover:ee(e.frontCover),initialPage:ee(e.initialPage),backCover:ee(e.backCover)}:{frontCover:null,initialPage:null,backCover:null}}const pe={async getDraft(){try{return(await w.get("/api/story-draft")).draft}catch{return null}},async saveDraft(e){await w.post("/api/story-draft",{draft:e})},async deleteDraft(){await w.delete("/api/story-draft")},async getStories(e){const t=new URLSearchParams;e!=null&&e.limit&&t.set("limit",String(e.limit)),e!=null&&e.offset&&t.set("offset",String(e.offset));const r=t.toString(),n=`/api/stories${r?`?${r}`:""}`,o=await w.get(n);return{stories:(o.stories||[]).map(l=>({id:l.id,title:l.title,story_type:"",art_style:"",language:l.language,pages:l.pageCount||l.pages||0,created_at:l.createdAt,hasThumbnail:l.hasThumbnail,isPartial:l.isPartial,generatedPages:l.generatedPages,totalPages:l.totalPages})),pagination:o.pagination}},async getStoryCover(e){try{return(await w.get(`/api/stories/${e}/cover`)).coverImage}catch{return null}},async getQuickMetadata(e){try{const t=localStorage.getItem("auth_token"),r=await fetch(`/api/stories/${e}/quick-metadata`,{headers:t?{Authorization:`Bearer ${t}`}:{}});return r.ok?await r.json():null}catch{return null}},async getStory(e){try{const t=await w.get(`/api/stories/${e}`),r=t.storyText||t.story||"";return{id:t.id,title:t.title,storyType:t.storyType,artStyle:t.artStyle,language:t.language,languageLevel:t.languageLevel,pages:t.pages,dedication:t.dedication,characters:t.characters,mainCharacters:t.mainCharacters,relationships:t.relationships,relationshipTexts:t.relationshipTexts,outline:t.outline,outlinePrompt:t.outlinePrompt,outlineModelId:t.outlineModelId,outlineUsage:t.outlineUsage,story:r,storyTextPrompts:t.storyTextPrompts,visualBible:t.visualBible,sceneDescriptions:t.sceneDescriptions,sceneImages:t.sceneImages,coverImages:ge(t.coverImages),thumbnail:t.thumbnail,createdAt:t.createdAt,isPartial:t.isPartial,failureReason:t.failureReason,generatedPages:t.generatedPages,totalPages:t.totalPages}}catch{return null}},async getStoryWithProgress(e,t){var r;try{const n=localStorage.getItem("auth_token"),o=await fetch(`/api/stories/${e}`,{headers:n?{Authorization:`Bearer ${n}`}:{}});if(!o.ok)throw new Error(`HTTP ${o.status}`);const s=o.headers.get("Content-Length"),l=s?parseInt(s,10):null,u=(r=o.body)==null?void 0:r.getReader();if(!u){const A=await o.json();return this.mapServerStoryToClient(A)}const g=[];let p=0;for(;;){const{done:A,value:_}=await u.read();if(A)break;g.push(_),p+=_.length,t(p,l)}const m=new Uint8Array(p);let T=0;for(const A of g)m.set(A,T),T+=A.length;const I=new TextDecoder().decode(m),x=JSON.parse(I);return this.mapServerStoryToClient(x)}catch{return null}},mapServerStoryToClient(e){const t=e.storyText||e.story||"";return{id:e.id,title:e.title,storyType:e.storyType,storyTypeName:e.storyTypeName,storyCategory:e.storyCategory,storyTopic:e.storyTopic,storyTheme:e.storyTheme,storyDetails:e.storyDetails,artStyle:e.artStyle,language:e.language,languageLevel:e.languageLevel,pages:e.pages,dedication:e.dedication,characters:e.characters,mainCharacters:e.mainCharacters,relationships:e.relationships,relationshipTexts:e.relationshipTexts,season:e.season,userLocation:e.userLocation,outline:e.outline,outlinePrompt:e.outlinePrompt,outlineModelId:e.outlineModelId,outlineUsage:e.outlineUsage,story:t,storyTextPrompts:e.storyTextPrompts,visualBible:e.visualBible,sceneDescriptions:e.sceneDescriptions,sceneImages:e.sceneImages,coverImages:ge(e.coverImages),thumbnail:e.thumbnail,createdAt:e.createdAt,isPartial:e.isPartial,failureReason:e.failureReason,generatedPages:e.generatedPages,totalPages:e.totalPages}},async getStoryMetadata(e,t){try{const r=localStorage.getItem("auth_token"),n=t?`/api/stories/${e}/metadata?devMode=true`:`/api/stories/${e}/metadata`,o=await fetch(n,{headers:r?{Authorization:`Bearer ${r}`}:{}});if(!o.ok)throw new Error(`HTTP ${o.status}`);const s=await o.json();return{...this.mapServerStoryToClient(s),totalImages:s.totalImages||0}}catch{return null}},async getStoryDevMetadata(e){try{const t=localStorage.getItem("auth_token"),r=await fetch(`/api/stories/${e}/dev-metadata`,{headers:t?{Authorization:`Bearer ${t}`}:{}});return r.ok?await r.json():(console.warn(`Failed to fetch dev metadata: HTTP ${r.status}`),null)}catch(t){return console.warn("Failed to fetch dev metadata:",t),null}},async getDevImage(e,t,r,n){try{const o=localStorage.getItem("auth_token"),s=new URLSearchParams({page:String(t),type:r});(n==null?void 0:n.index)!==void 0&&s.append("index",String(n.index)),n!=null&&n.field&&s.append("field",n.field);const l=await fetch(`/api/stories/${e}/dev-image?${s}`,{headers:o?{Authorization:`Bearer ${o}`}:{}});return l.ok?await l.json():(console.warn(`Failed to fetch dev image: HTTP ${l.status}`),null)}catch(o){return console.warn("Failed to fetch dev image:",o),null}},async getAvatarGenerationImage(e,t,r,n){try{const o=localStorage.getItem("auth_token"),s=new URLSearchParams({type:t,index:String(r)});n&&s.append("field",n);const l=await fetch(`/api/stories/${e}/avatar-generation-image?${s}`,{headers:o?{Authorization:`Bearer ${o}`}:{}});return l.ok?await l.json():(console.warn(`Failed to fetch avatar generation image: HTTP ${l.status}`),null)}catch(o){return console.warn("Failed to fetch avatar generation image:",o),null}},async getEntityGridImageByIndex(e,t){try{const r=localStorage.getItem("auth_token"),n=new URLSearchParams({gridIndex:t.toString()}),o=await fetch(`/api/stories/${e}/entity-grid-image?${n}`,{headers:r?{Authorization:`Bearer ${r}`}:{}});return o.ok?await o.json():(console.warn(`Failed to fetch entity grid image: HTTP ${o.status}`),null)}catch(r){return console.warn("Failed to fetch entity grid image:",r),null}},async getRetryHistoryImages(e,t){try{const r=localStorage.getItem("auth_token"),n=await fetch(`/api/stories/${e}/retry-images/${t}`,{headers:r?{Authorization:`Bearer ${r}`}:{}});return n.ok?await n.json():(console.warn(`Failed to fetch retry history images: HTTP ${n.status}`),null)}catch(r){return console.warn("Failed to fetch retry history images:",r),null}},async getPageImage(e,t){try{return await w.get(`/api/stories/${e}/image/${t}`)}catch{return null}},async getCoverImage(e,t){try{return await w.get(`/api/stories/${e}/cover-image/${t}`)}catch{return null}},async getAllImages(e,t=!0){var r;try{const n=t?`/api/stories/${e}/images?activeOnly=true`:`/api/stories/${e}/images`,o=await w.get(n);return console.log(`[getAllImages] ${t?"FAST":"FULL"}: ${((r=o.images)==null?void 0:r.length)||0} pages, ${Object.keys(o.covers||{}).length} covers`),o}catch(n){return console.error("[getAllImages] Failed to load batch images:",n),null}},async getStoryProgressively(e,t,r,n){var $,F,G,B;const o=await this.getStoryMetadata(e);if(!o)throw new Error("Story not found");t(o,o.totalImages);const s=await this.getAllImages(e),l=(s==null?void 0:s.images)||[],u=(s==null?void 0:s.covers)||{};if(l.length>0||Object.keys(u).length>0){let k=0;const b=["frontCover","initialPage","backCover"];for(const S of b){const C=u[S];C!=null&&C.imageData&&(k++,r(S,C.imageData,void 0,k))}for(const S of l)S.imageData&&(k++,r(S.pageNumber,S.imageData,S.imageVersions,k));n();return}console.warn("[getStoryProgressively] Batch load failed, falling back to individual requests");const p=(($=o.sceneImages)==null?void 0:$.filter(k=>k.hasImage!==!1&&k.pageNumber).map(k=>k.pageNumber))||[],m=[],T=(F=o.coverImages)==null?void 0:F.frontCover,I=(G=o.coverImages)==null?void 0:G.initialPage,x=(B=o.coverImages)==null?void 0:B.backCover;T&&(typeof T=="string"||T.hasImage)&&m.push("frontCover"),I&&(typeof I=="string"||I.hasImage)&&m.push("initialPage"),x&&(typeof x=="string"||x.hasImage)&&m.push("backCover");let A=0;const _=await Promise.all(m.map(async k=>{const b=await this.getCoverImage(e,k);return{coverType:k,result:b}}));for(const{coverType:k,result:b}of _)b&&(A++,r(k,b.imageData,void 0,A));const j=3;for(let k=0;k<p.length;k+=j){const b=p.slice(k,k+j);(await Promise.all(b.map(C=>this.getPageImage(e,C)))).forEach((C,z)=>{C&&(A++,r(b[z],C.imageData,C.imageVersions,A))})}n()},async createStory(e){return{id:(await w.post("/api/stories",{title:e.title,story_type:e.storyType,art_style:e.artStyle,language:e.language,language_level:e.languageLevel,pages:e.pages,dedication:e.dedication,characters:e.characters,main_characters:e.mainCharacters,relationships:e.relationships,relationship_texts:e.relationshipTexts,outline:e.outline,story:e.story,scene_descriptions:e.sceneDescriptions,scene_images:e.sceneImages,cover_images:e.coverImages})).id}},async deleteStory(e){await w.delete(`/api/stories/${e}`)},async regenerateSceneDescription(e,t){return await w.post(`/api/stories/${e}/regenerate/scene-description/${t}`)},async regenerateImage(e,t,r,n){return await w.post(`/api/stories/${e}/regenerate/image/${t}`,{editedScene:r,characterIds:n})},async regenerateCover(e,t,r,n,o,s){const l={};return r&&(l.editedScene=r),n&&n.length>0&&(l.characterIds=n),o!==void 0&&(l.editedTitle=o),s!==void 0&&(l.editedDedication=s),await w.post(`/api/stories/${e}/regenerate/cover/${t}`,Object.keys(l).length>0?l:void 0)},async updatePage(e,t,r){await w.patch(`/api/stories/${e}/page/${t}`,{text:r.text,scene_description:r.sceneDescription,image_data:r.imageData})},async updateVisualBible(e,t){await w.put(`/api/stories/${e}/visual-bible`,{visualBible:t})},async editImage(e,t,r){return await w.post(`/api/stories/${e}/edit/image/${t}`,{editPrompt:r})},async editCover(e,t,r){return await w.post(`/api/stories/${e}/edit/cover/${t}`,{editPrompt:r})},async repairImage(e,t,r){return await w.post(`/api/stories/${e}/repair/image/${t}`,{fixTargets:r})},async iteratePage(e,t,r,n){return await w.post(`/api/stories/${e}/iterate/${t}`,{imageModel:r,...(n==null?void 0:n.useOriginalAsReference)&&{useOriginalAsReference:!0},...(n==null?void 0:n.blackoutIssues)&&{blackoutIssues:!0}})},async updateSceneImage(e,t,r){return await w.patch(`/api/stories/${e}/page/${t}`,{imageData:r})},async callClaude(e,t=8192){return(await w.post("/api/claude",{prompt:e,max_tokens:t})).content},async callGemini(e,t){return(await w.post("/api/gemini",{prompt:e,images:t})).content},async generateStoryIdeas(e){return await w.post("/api/generate-story-ideas",e)},generateStoryIdeasStream(e,t){const r=new AbortController,n=localStorage.getItem("auth_token"),o=12e4;let s=null;const l=()=>{s&&clearTimeout(s),s=setTimeout(()=>{var g;console.warn("[generateStoryIdeasStream] Stream timeout - no activity for 2 minutes"),r.abort(),(g=t.onError)==null||g.call(t,"Connection timeout. Please try again.")},o)};return(async()=>{var m,T,I,x,A,_,j,$,F;l();const g=Date.now();let p=!1;try{const G=await fetch("/api/generate-story-ideas-stream",{method:"POST",headers:{"Content-Type":"application/json",...n?{Authorization:`Bearer ${n}`}:{}},body:JSON.stringify(e),signal:r.signal});if(!G.ok){const S=await G.text();(m=t.onError)==null||m.call(t,S||"Failed to generate story ideas");return}const B=(T=G.body)==null?void 0:T.getReader();if(!B){(I=t.onError)==null||I.call(t,"No response body");return}const k=new TextDecoder;let b="";for(;;){const{done:S,value:C}=await B.read();if(S)break;l(),b+=k.decode(C,{stream:!0});const z=b.split(`
`);b=z.pop()||"";for(const f of z)if(f.startsWith("data: "))try{const c=JSON.parse(f.slice(6));if(c.status&&((x=t.onStatus)==null||x.call(t,c.status,c.prompt,c.model)),c.story1&&((A=t.onStory1)==null||A.call(t,c.story1)),c.story2&&((_=t.onStory2)==null||_.call(t,c.story2)),c.error&&((j=t.onError)==null||j.call(t,c.error)),c.done){p=!0;const d=((Date.now()-g)/1e3).toFixed(1);console.log(`[IDEAS] Complete in ${d}s`),($=t.onDone)==null||$.call(t,c.fullResponse)}}catch{}}}catch(G){if(s&&clearTimeout(s),G.name!=="AbortError"){if(p){console.log("[IDEAS] Stream completed successfully (ignoring post-close network error)");return}(F=t.onError)==null||F.call(t,G.message||"Stream error")}}finally{s&&clearTimeout(s)}})(),{abort:()=>{s&&clearTimeout(s),r.abort()}}},async createStoryJob(e){const t=`idem_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r=await w.post("/api/jobs/create-story",{idempotencyKey:t,storyType:e.storyType,storyTypeName:e.storyTypeName,storyCategory:e.storyCategory,storyTopic:e.storyTopic,storyTheme:e.storyTheme,artStyle:e.artStyle,language:e.language,languageLevel:e.languageLevel,pages:e.pages,dedication:e.dedication,storyDetails:e.storyDetails,characters:e.characters,mainCharacters:e.mainCharacters,relationships:e.relationships,relationshipTexts:e.relationshipTexts,skipImages:e.skipImages,imageGenMode:e.imageGenMode,generationMode:e.generationMode,skipOutline:e.skipOutline,skipText:e.skipText,skipSceneDescriptions:e.skipSceneDescriptions,skipCovers:e.skipCovers,enableQualityRetry:e.enableQualityRetry,enableAutoRepair:e.enableAutoRepair,useGridRepair:e.useGridRepair,forceRepairThreshold:e.forceRepairThreshold,enableFinalChecks:e.enableFinalChecks,checkOnlyMode:e.checkOnlyMode,enableSceneValidation:e.enableSceneValidation,separatedEvaluation:e.separatedEvaluation,incrementalConsistency:e.incrementalConsistency,modelOverrides:e.modelOverrides,userLocation:e.userLocation,season:e.season,ideaGeneration:e.ideaGeneration});return{jobId:r.jobId,creditsRemaining:r.creditsRemaining}},async getJobStatus(e){const t=await w.get(`/api/jobs/${e}/status`),r=t.result||t.resultData;return{status:t.status,progress:{current:t.progress||0,total:100,message:t.progressMessage||""},result:r?{storyId:r.storyId||"",title:r.title||"",outline:r.outline||"",outlinePrompt:r.outlinePrompt,outlineModelId:r.outlineModelId,outlineUsage:r.outlineUsage,story:r.story||r.storyText||"",storyTextPrompts:r.storyTextPrompts,visualBible:r.visualBible,styledAvatarGeneration:r.styledAvatarGeneration,costumedAvatarGeneration:r.costumedAvatarGeneration,generationLog:r.generationLog,sceneDescriptions:r.sceneDescriptions||[],sceneImages:r.sceneImages||[],coverImages:r.coverImages}:void 0,partialCovers:t.partialCovers,storyText:t.storyText,partialPages:t.partialPages,currentCredits:t.currentCredits,error:t.errorMessage}},async cancelJob(e){return await w.post(`/api/jobs/${e}/cancel`)},async getActiveJobs(){return(await w.get("/api/jobs/my-jobs?limit=5")).jobs.filter(t=>t.status==="pending"||t.status==="processing").map(t=>({...t,status:t.status}))},async generatePdf(e,t="square"){const r=localStorage.getItem("auth_token"),n=await fetch(`/api/stories/${e}/pdf?format=${t}`,{headers:r?{Authorization:`Bearer ${r}`}:{}});if(!n.ok)throw new Error("Failed to generate PDF");return n.blob()},async createCheckoutSession(e,t,r){const n=Array.isArray(e)?e:[e];return await w.post("/api/stripe/create-checkout-session",{storyIds:n,coverType:t||"softcover",bookFormat:r||"square"})},async createCreditsCheckout(e=100,t=500){return await w.post("/api/stripe/create-credits-checkout",{credits:e,amount:t})},async getPricing(){return await w.get("/api/pricing")},async createPrintOrder(e,t){return await w.post("/api/print-provider/order",{storyId:e,shippingAddress:t})},async getOrderStatus(e){return await w.get(`/api/stripe/order-status/${e}`)},async saveStoryText(e,t){return await w.put(`/api/stories/${e}/text`,{story:t})},async saveStoryTitle(e,t){return await w.put(`/api/stories/${e}/title`,{title:t})},async setActiveImage(e,t,r){return await w.put(`/api/stories/${e}/pages/${t}/active-image`,{versionIndex:r})},async setActiveCoverImage(e,t,r){return await w.put(`/api/stories/${e}/covers/${t}/active-image`,{versionIndex:r})},async getUserLocation(){try{return await w.get("/api/user/location")}catch{return{city:null,region:null,country:null}}},triggerLandmarkDiscovery(e,t){e&&w.post("/api/landmarks/discover",{city:e,country:t}).catch(()=>{})},async collectRepairFeedback(e){return await w.post(`/api/stories/${e}/repair-workflow/collect-feedback`,{})},async redoPages(e,t,r){return await w.post(`/api/stories/${e}/repair-workflow/redo-pages`,{pageNumbers:t,...(r==null?void 0:r.useOriginalAsReference)&&{useOriginalAsReference:!0}})},async reEvaluatePages(e,t){return await w.post(`/api/stories/${e}/repair-workflow/re-evaluate`,{pageNumbers:t})},async runEntityConsistency(e){return await w.post(`/api/stories/${e}/repair-workflow/consistency-check`,{})},async repairCharacters(e,t,r){return await w.post(`/api/stories/${e}/repair-workflow/character-repair`,{repairs:t,...(r==null?void 0:r.useMagicApiRepair)!==void 0&&{useMagicApiRepair:r.useMagicApiRepair}})},async repairArtifacts(e,t){return await w.post(`/api/stories/${e}/repair-workflow/artifact-repair`,{pageNumbers:t})}},U="active_story_job",oe=i.createContext(null),Ot=3e3;function Dt({children:e}){const{user:t}=xe(),[r,n]=i.useState(null),[o,s]=i.useState({current:0,total:100,message:""}),[l,u]=i.useState(!1),[g,p]=i.useState(null),[m,T]=i.useState(!1),[I,x]=i.useState(null),A=i.useRef(null),_=i.useRef(!1),j=i.useRef(null);i.useEffect(()=>{const b=y.getItem(U);if(b)try{const S=JSON.parse(b),C=1800*1e3;Date.now()-S.startedAt<C?(v.info("[GenerationContext] Restoring active job from storage:",S.jobId),n(S)):(v.info("[GenerationContext] Stored job too old, clearing"),y.removeItem(U))}catch{y.removeItem(U)}},[]),i.useEffect(()=>{const b=(t==null?void 0:t.id)||null;b!==j.current&&(j.current!==null&&(v.info("[GenerationContext] User changed, clearing local job state"),n(null),u(!1),p(null),x(null),y.removeItem(U)),j.current=b,b&&(v.info("[GenerationContext] Fetching active jobs for user:",b),pe.getActiveJobs().then(S=>{if(S.length>0){const C=S[0];v.info("[GenerationContext] Found active job from server:",C.id);const z={jobId:C.id,startedAt:new Date(C.created_at).getTime(),storyTitle:""};n(z),s({current:C.progress||0,total:100,message:C.progress_message||""}),y.setItem(U,JSON.stringify(z))}else v.info("[GenerationContext] No active jobs found for user")}).catch(S=>{v.error("[GenerationContext] Failed to fetch active jobs:",S)})))},[t==null?void 0:t.id]);const $=i.useCallback(async b=>{if(!_.current){_.current=!0;try{const S=await pe.getJobStatus(b);if(S.progress&&s(C=>S.progress.current>=C.current?{current:S.progress.current,total:S.progress.total,message:S.progress.message}:{...C,message:S.progress.message}),S.status==="completed"&&S.result)v.success("[GenerationContext] Job completed:",b,"storyId:",S.result.storyId),v.debug("[GenerationContext] Result object:",JSON.stringify(S.result).substring(0,200)),u(!0),p(S.result.storyId),T(!0),s({current:100,total:100,message:"Complete!"}),y.removeItem(U),A.current&&(clearInterval(A.current),A.current=null);else if(S.status==="failed"){const C=S.error||"Generation failed";C.toLowerCase().includes("abandoned")?v.info("[GenerationContext] Old job was cleaned up (abandoned):",S.error):(v.error("[GenerationContext] Job failed:",S.error),x(C)),n(null),y.removeItem(U),A.current&&(clearInterval(A.current),A.current=null)}}catch(S){v.error("[GenerationContext] Polling error:",S)}finally{_.current=!1}}},[]);i.useEffect(()=>(r&&!l&&(v.info("[GenerationContext] Starting polling for job:",r.jobId),$(r.jobId),A.current=setInterval(()=>{$(r.jobId)},Ot)),()=>{A.current&&(clearInterval(A.current),A.current=null)}),[r,l,$]),i.useEffect(()=>{const b=S=>{if(S.key===U)if(S.newValue)try{const C=JSON.parse(S.newValue);n(C),u(!1),p(null),x(null)}catch{}else n(null)};return window.addEventListener("storage",b),()=>window.removeEventListener("storage",b)},[]);const F=i.useCallback((b,S)=>{const C={jobId:b,startedAt:Date.now(),storyTitle:S};v.info("[GenerationContext] Starting to track job:",b),y.setItem(U,JSON.stringify(C)),n(C),u(!1),p(null),T(!1),x(null),s({current:0,total:100,message:"Starting..."})},[]),G=i.useCallback(()=>{v.info("[GenerationContext] Stopping tracking"),A.current&&(clearInterval(A.current),A.current=null),y.removeItem(U),n(null)},[]),B=i.useCallback(()=>{T(!1),u(!1)},[]),k=i.useCallback(()=>{x(null)},[]);return a.jsx(oe.Provider,{value:{activeJob:r,progress:o,isComplete:l,completedStoryId:g,hasUnviewedCompletion:m,error:I,startTracking:F,stopTracking:G,markCompletionViewed:B,clearError:k},children:e})}function ar(){const e=i.useContext(oe);if(!e)throw new Error("useGeneration must be used within a GenerationProvider");return e}function Nt(){return i.useContext(oe)}function Gt(){const e=Nt(),t=he();if(!e||!e.activeJob)return null;const{progress:r,activeJob:n,isComplete:o,error:s}=e,l=Math.round(r.current/r.total*100),u=()=>{t("/create")};return o?null:s?a.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 cursor-pointer",onClick:u,title:`Error: ${s}. Click to view details.`,children:[a.jsx("div",{className:"h-1 bg-red-500 w-full"}),a.jsx("div",{className:"absolute top-1 left-1/2 -translate-x-1/2 bg-red-600 text-white text-xs px-3 py-1 rounded-b shadow-lg",children:"Generation failed - click to view"})]}):a.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 cursor-pointer group",onClick:u,title:`${n.storyTitle} - ${l}% complete. Click to view.`,children:[a.jsx("div",{className:"h-1 bg-gray-200 dark:bg-gray-700",children:a.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 transition-all duration-500 ease-out relative overflow-hidden",style:{width:`${l}%`},children:a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-shimmer"})})}),a.jsxs("div",{className:"absolute top-1 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-xs px-3 py-1.5 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:[a.jsx("span",{className:"font-medium",children:n.storyTitle}),a.jsx("span",{className:"mx-2 text-gray-400",children:"â€¢"}),a.jsxs("span",{children:[l,"%"]}),r.message&&a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"mx-2 text-gray-400",children:"â€¢"}),a.jsx("span",{className:"text-gray-300",children:r.message})]})]})]})}const $t=i.lazy(()=>N(()=>import("./LandingPage-eHoVZigR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),Lt=i.lazy(()=>N(()=>import("./WelcomePage-D4MQOhmh.js"),__vite__mapDeps([13,1,8,4,5,14,6,12]))),zt=i.lazy(()=>N(()=>import("./StoryWizard-BwbxTX-n.js").then(e=>e.v),__vite__mapDeps([15,1,2,3,4,5,16,17,18,9,7,19,6]))),Ut=i.lazy(()=>N(()=>import("./MyStories-ByEFmic8.js"),__vite__mapDeps([20,1,3,2,4,5,21,19,22,23,12,24]))),Ft=i.lazy(()=>N(()=>import("./MyOrders-DSCuCYQ6.js"),__vite__mapDeps([25,1,3,2,4,5,14,17,12]))),Bt=i.lazy(()=>N(()=>import("./AdminDashboard-CyjGrrm5.js"),__vite__mapDeps([26,1,2,18,27,7,19,10,5,24,11,28,29,30,8,23,31,17,12]))),Mt=i.lazy(()=>N(()=>import("./Pricing-2Jp0lsGg.js"),__vite__mapDeps([21,1,3,2,4,5,19,22,23,12]))),Vt=i.lazy(()=>N(()=>import("./BookBuilder-RhRwlFHJ.js"),__vite__mapDeps([32,1,3,2,4,5,21,19,22,23,12,33,10]))),Ht=i.lazy(()=>N(()=>import("./ResetPassword-CHdfuZrg.js"),__vite__mapDeps([34,1,2,3,4,5,16,12]))),Kt=i.lazy(()=>N(()=>import("./EmailVerified-DMGPfPlc.js"),__vite__mapDeps([35,1,2,3,4,5,12]))),Jt=i.lazy(()=>N(()=>import("./TermsOfService-BA434S50.js"),__vite__mapDeps([36,1,3,2,4,5,19,12]))),Wt=i.lazy(()=>N(()=>import("./PrivacyPolicy-9phlsX-7.js"),__vite__mapDeps([37,1,3,2,4,5,19,12]))),qt=i.lazy(()=>N(()=>import("./Impressum-PKsxelrd.js"),__vite__mapDeps([38,1,3,2,4,5,19,12]))),Yt=i.lazy(()=>N(()=>import("./SharedStoryViewer-BLWNRC73.js"),__vite__mapDeps([39,1,4,5,40,12])));function Xt(){return a.jsxs(Dt,{children:[a.jsx(_t,{}),a.jsx(Rt,{}),a.jsx(Gt,{}),a.jsx(i.Suspense,{fallback:a.jsx(Qe,{fullScreen:!0}),children:a.jsxs(Le,{children:[a.jsx(D,{path:"/",element:a.jsx($t,{})}),a.jsx(D,{path:"/welcome",element:a.jsx(Lt,{})}),a.jsx(D,{path:"/create/*",element:a.jsx(zt,{})}),a.jsx(D,{path:"/stories",element:a.jsx(Ut,{})}),a.jsx(D,{path:"/orders",element:a.jsx(Ft,{})}),a.jsx(D,{path:"/pricing",element:a.jsx(Mt,{})}),a.jsx(D,{path:"/book-builder",element:a.jsx(Vt,{})}),a.jsx(D,{path:"/admin",element:a.jsx(Bt,{})}),a.jsx(D,{path:"/reset-password/:token",element:a.jsx(Ht,{})}),a.jsx(D,{path:"/email-verified",element:a.jsx(Kt,{})}),a.jsx(D,{path:"/terms",element:a.jsx(Jt,{})}),a.jsx(D,{path:"/privacy",element:a.jsx(Wt,{})}),a.jsx(D,{path:"/impressum",element:a.jsx(qt,{})}),a.jsx(D,{path:"/shared/:shareToken",element:a.jsx(Yt,{})})]})})]})}const je={storyType:"",artStyle:"",storyDetails:"",characters:[],currentCharacterId:null,relationships:{},relationshipTexts:{},pages:30,languageLevel:"standard",mainCharacters:[],dedication:"",storyOutline:"",generatedStory:"",storyTitle:"",sceneDescriptions:[],sceneImages:[],coverImages:{frontCover:null,initialPage:null,backCover:null},isGenerating:!1,generationProgress:null,currentStoryId:null,currentStep:0};function Zt(e,t){switch(t.type){case"SET_STORY_TYPE":return{...e,storyType:t.payload};case"SET_ART_STYLE":return{...e,artStyle:t.payload};case"SET_STORY_DETAILS":return{...e,storyDetails:t.payload};case"ADD_CHARACTER":return{...e,characters:[...e.characters,t.payload]};case"UPDATE_CHARACTER":return{...e,characters:e.characters.map(r=>r.id===t.payload.id?t.payload:r)};case"DELETE_CHARACTER":{const r=t.payload,n={},o={};return Object.entries(e.relationships).forEach(([s,l])=>{const[u,g]=s.split("-").map(Number);u!==r&&g!==r&&(n[s]=l)}),Object.entries(e.relationshipTexts).forEach(([s,l])=>{const[u,g]=s.split("-").map(Number);u!==r&&g!==r&&(o[s]=l)}),{...e,characters:e.characters.filter(s=>s.id!==r),mainCharacters:e.mainCharacters.filter(s=>s!==r),relationships:n,relationshipTexts:o}}case"SET_CURRENT_CHARACTER":return{...e,currentCharacterId:t.payload};case"SET_CHARACTERS":return{...e,characters:t.payload};case"SET_RELATIONSHIP":return{...e,relationships:{...e.relationships,[t.payload.key]:t.payload.value}};case"SET_RELATIONSHIP_TEXT":return{...e,relationshipTexts:{...e.relationshipTexts,[t.payload.key]:t.payload.value}};case"SET_RELATIONSHIPS":return{...e,relationships:t.payload};case"SET_PAGES":return{...e,pages:t.payload};case"SET_LANGUAGE_LEVEL":return{...e,languageLevel:t.payload};case"SET_MAIN_CHARACTERS":return{...e,mainCharacters:t.payload};case"SET_DEDICATION":return{...e,dedication:t.payload};case"SET_OUTLINE":return{...e,storyOutline:t.payload};case"SET_GENERATED_STORY":return{...e,generatedStory:t.payload.story,storyTitle:t.payload.title};case"SET_SCENE_DESCRIPTIONS":return{...e,sceneDescriptions:t.payload};case"SET_SCENE_IMAGE":return{...e,sceneImages:[...e.sceneImages.filter(r=>r.pageNumber!==t.payload.pageNumber),t.payload].sort((r,n)=>r.pageNumber-n.pageNumber)};case"SET_COVER_IMAGES":return{...e,coverImages:{...e.coverImages,...t.payload}};case"SET_GENERATING":return{...e,isGenerating:t.payload};case"SET_GENERATION_PROGRESS":return{...e,generationProgress:t.payload};case"SET_CURRENT_STORY_ID":return{...e,currentStoryId:t.payload};case"SET_STEP":return{...e,currentStep:t.payload};case"LOAD_STORY":return{...e,...t.payload};case"RESET_STORY":return{...je};default:return e}}const Qt=i.createContext(null);function er({children:e}){const[t,r]=i.useReducer(Zt,je);return a.jsx(Qt.Provider,{value:{state:t,dispatch:r},children:e})}const tr={success:{bg:"bg-green-600",border:"border-green-700",icon:Pt},error:{bg:"bg-red-600",border:"border-red-700",icon:bt},info:{bg:"bg-blue-600",border:"border-blue-700",icon:Et},warning:{bg:"bg-yellow-500",border:"border-yellow-600",icon:kt}};function rr({id:e,message:t,title:r,variant:n="info",duration:o=8e3,onClose:s,details:l}){const[u,g]=i.useState(!1),[p,m]=i.useState(!1),T=tr[n],I=T.icon;i.useEffect(()=>{if(requestAnimationFrame(()=>g(!0)),o>0){const A=setTimeout(()=>{x()},o);return()=>clearTimeout(A)}},[o]);const x=()=>{m(!0),setTimeout(()=>s(e),300)};return a.jsxs("div",{className:`
        transform transition-all duration-300 ease-out
        ${u&&!p?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
        ${T.bg} ${T.border}
        text-white rounded-lg shadow-2xl border
        max-w-md w-full pointer-events-auto
        overflow-hidden
      `,children:[a.jsx("div",{className:"p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(I,{className:"shrink-0 mt-0.5",size:24}),a.jsxs("div",{className:"flex-1 min-w-0",children:[r&&a.jsx("p",{className:"font-bold text-lg mb-1",children:r}),a.jsx("p",{className:"text-sm opacity-95",children:t}),l&&l.length>0&&a.jsx("div",{className:"mt-3 pt-3 border-t border-white/20 space-y-1",children:l.map((A,_)=>a.jsx("p",{className:"text-xs opacity-80",children:A},_))})]}),a.jsx("button",{onClick:x,className:"shrink-0 p-1 rounded hover:bg-white/20 transition-colors","aria-label":"Dismiss",children:a.jsx(_e,{size:18})})]})}),o>0&&a.jsx("div",{className:"h-1 bg-white/20",children:a.jsx("div",{className:"h-full bg-white/40 transition-all ease-linear",style:{width:"100%",animation:`shrink ${o}ms linear forwards`}})}),a.jsx("style",{children:`
        @keyframes shrink {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]})}const Oe=i.createContext(void 0);function nr({children:e}){const[t,r]=i.useState([]),n=i.useCallback(g=>{r(p=>p.filter(m=>m.id!==g))},[]),o=i.useCallback(g=>{const p=`toast-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;r(m=>[...m,{...g,id:p}])},[]),s=i.useCallback((g,p,m)=>{o({message:g,title:p,variant:"success",duration:1e4,details:m})},[o]),l=i.useCallback((g,p)=>{o({message:g,title:p,variant:"error",duration:8e3})},[o]),u=i.useCallback((g,p)=>{o({message:g,title:p,variant:"info",duration:6e3})},[o]);return a.jsxs(Oe.Provider,{value:{showToast:o,showSuccess:s,showError:l,showInfo:u,removeToast:n},children:[e,a.jsx("div",{className:"fixed top-4 right-4 z-[100] flex flex-col gap-3 pointer-events-none",children:t.map(g=>a.jsx(rr,{id:g.id,message:g.message,title:g.title,variant:g.variant,duration:g.duration,details:g.details,onClose:n},g.id))})]})}function ir(){const e=i.useContext(Oe);if(!e)throw new Error("useToast must be used within a ToastProvider");return e}const De=e=>{const t="reason"in e?e.reason:e.error,r=(t==null?void 0:t.message)||(t==null?void 0:t.toString())||"";if(r.includes("Failed to fetch dynamically imported module")||r.includes("Loading chunk")||r.includes("Loading CSS chunk")){const n="chunk_error_reload",o=sessionStorage.getItem(n),s=Date.now();(!o||s-parseInt(o)>1e4)&&(sessionStorage.setItem(n,s.toString()),console.warn("ðŸ”„ Detected stale chunks after deployment, reloading..."),window.location.reload())}};window.addEventListener("error",De);window.addEventListener("unhandledrejection",De);Ye.createRoot(document.getElementById("root")).render(a.jsx(i.StrictMode,{children:a.jsx(ze,{children:a.jsx(St,{children:a.jsx(mt,{children:a.jsx(er,{children:a.jsx(nr,{children:a.jsx(Xt,{})})})})})})}));export{Pt as C,It as E,Et as I,xt as L,kt as T,_e as X,N as _,xe as a,w as b,V as c,rt as d,ir as e,ar as f,Qe as g,Nt as h,bt as i,a as j,pe as s,vt as u};
