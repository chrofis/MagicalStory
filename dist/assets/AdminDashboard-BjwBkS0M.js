import{c as A,j as e,X as H,b as P,u as K,T as F}from"./index-CcLRBHt9.js";import{b as c,u as Z}from"./vendor-react-BhxjzHy9.js";import{a as u,T as I}from"./api-C2gR0YBj.js";import{B as h}from"./Button-CCltBdyg.js";import{U as T,B as X,I as Y}from"./Input-B2gfRnf4.js";import{L as _,A as J,R as M,D as W,F as ee,P as te}from"./refresh-cw-BQ4-mM9c.js";import"./vendor-firebase-ChSXtidx.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=A("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=A("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=A("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=A("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),ie={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-[95vw] max-h-[95vh]"};function le({isOpen:n,onClose:s,title:l,children:j,size:r="md",showCloseButton:w=!0,closeOnOverlayClick:f=!0,closeOnEscape:p=!0}){const y=c.useCallback(N=>{N.key==="Escape"&&p&&s()},[s,p]);return c.useEffect(()=>(n&&(document.addEventListener("keydown",y),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",y),document.body.style.overflow="unset"}),[n,y]),n?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:f?s:void 0}),e.jsxs("div",{className:`
          relative bg-white rounded-2xl shadow-2xl w-full mx-4
          transform transition-all duration-300 ease-out
          animate-in fade-in zoom-in-95
          ${ie[r]}
        `,children:[(l||w)&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[l&&e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:l}),w&&e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:e.jsx(H,{size:20})})]}),e.jsx("div",{className:"p-4 max-h-[80vh] overflow-y-auto",children:j})]})]}):null}const g={async getStats(){return u.get("/api/admin/stats")},async getUsers(){return u.get("/api/admin/users")},async updateUserQuota(n,s){return u.post(`/api/admin/users/${n}/quota`,{quota:s})},async updateUserRole(n,s){return u.post(`/api/admin/users/${n}/role`,{role:s})},async deleteUser(n){return u.delete(`/api/admin/users/${n}`)},async cleanOrphanedFiles(){return u.post("/api/admin/cleanup-orphaned")},async clearCache(){return u.post("/api/admin/clear-cache")},async getSystemLogs(){return u.get("/api/admin/logs")},async exportUserData(){return(await fetch("/api/admin/export",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).blob()}};function ge(){const n=Z(),{user:s,isAuthenticated:l}=P(),{language:j}=K(),[r,w]=c.useState(null),[f,p]=c.useState([]),[y,N]=c.useState(!0),[E,L]=c.useState(null),[k,Q]=c.useState("stats"),[d,S]=c.useState(null),[D,C]=c.useState(""),[v,o]=c.useState(!1),[z,x]=c.useState(null),R={en:{title:"Admin Dashboard",stats:"Statistics",users:"User Management",totalUsers:"Total Users",totalStories:"Total Stories",totalCharacters:"Total Characters",totalImages:"Total Images",orphanedFiles:"Orphaned Files",databaseSize:"Database Size",adminActions:"Admin Actions",cleanOrphaned:"Clean Orphaned Files",exportData:"Export User Data",viewLogs:"View System Logs",clearCache:"Clear Cache",accessDenied:"Access Denied",accessDeniedDesc:"You need admin privileges to access this page.",goHome:"Go Home",username:"Username",email:"Email",role:"Role",quota:"Quota",generated:"Generated",actions:"Actions",editQuota:"Edit Quota",newQuota:"New Quota",save:"Save",cancel:"Cancel",makeAdmin:"Make Admin",removeAdmin:"Remove Admin",deleteUser:"Delete User",confirmDelete:"Are you sure you want to delete this user?",unlimited:"Unlimited",cleaned:"Cleaned {count} orphaned files",cacheCleared:"Cache cleared successfully",refreshStats:"Refresh Stats"},de:{title:"Admin-Dashboard",stats:"Statistiken",users:"Benutzerverwaltung",totalUsers:"Benutzer gesamt",totalStories:"Geschichten gesamt",totalCharacters:"Charaktere gesamt",totalImages:"Bilder gesamt",orphanedFiles:"Verwaiste Dateien",databaseSize:"Datenbankgroesse",adminActions:"Admin-Aktionen",cleanOrphaned:"Verwaiste Dateien bereinigen",exportData:"Benutzerdaten exportieren",viewLogs:"Systemprotokolle anzeigen",clearCache:"Cache leeren",accessDenied:"Zugriff verweigert",accessDeniedDesc:"Sie benoetigen Admin-Rechte um auf diese Seite zuzugreifen.",goHome:"Zur Startseite",username:"Benutzername",email:"E-Mail",role:"Rolle",quota:"Kontingent",generated:"Generiert",actions:"Aktionen",editQuota:"Kontingent bearbeiten",newQuota:"Neues Kontingent",save:"Speichern",cancel:"Abbrechen",makeAdmin:"Zum Admin machen",removeAdmin:"Admin-Rechte entfernen",deleteUser:"Benutzer loeschen",confirmDelete:"Sind Sie sicher, dass Sie diesen Benutzer loeschen moechten?",unlimited:"Unbegrenzt",cleaned:"{count} verwaiste Dateien bereinigt",cacheCleared:"Cache erfolgreich geleert",refreshStats:"Statistiken aktualisieren"},fr:{title:"Tableau de bord Admin",stats:"Statistiques",users:"Gestion des utilisateurs",totalUsers:"Utilisateurs totaux",totalStories:"Histoires totales",totalCharacters:"Personnages totaux",totalImages:"Images totales",orphanedFiles:"Fichiers orphelins",databaseSize:"Taille de la base",adminActions:"Actions Admin",cleanOrphaned:"Nettoyer fichiers orphelins",exportData:"Exporter les donnees",viewLogs:"Voir les logs systeme",clearCache:"Vider le cache",accessDenied:"Acces refuse",accessDeniedDesc:"Vous avez besoin des privileges admin pour acceder a cette page.",goHome:"Accueil",username:"Nom d'utilisateur",email:"E-mail",role:"Role",quota:"Quota",generated:"Genere",actions:"Actions",editQuota:"Modifier le quota",newQuota:"Nouveau quota",save:"Enregistrer",cancel:"Annuler",makeAdmin:"Rendre admin",removeAdmin:"Retirer admin",deleteUser:"Supprimer l'utilisateur",confirmDelete:"Etes-vous sur de vouloir supprimer cet utilisateur?",unlimited:"Illimite",cleaned:"{count} fichiers orphelins nettoyes",cacheCleared:"Cache vide avec succes",refreshStats:"Actualiser les stats"}},a=R[j]||R.en,U=async()=>{N(!0),L(null);try{const[t,i]=await Promise.all([g.getStats(),g.getUsers().catch(()=>[])]);w(t),p(i)}catch(t){L(t instanceof Error?t.message:"Unknown error")}finally{N(!1)}};c.useEffect(()=>{l&&(s==null?void 0:s.role)==="admin"&&U()},[l,s]);const O=async()=>{o(!0);try{const t=await g.cleanOrphanedFiles();x({type:"success",text:a.cleaned.replace("{count}",String(t.cleaned))}),U()}catch(t){x({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{o(!1)}},B=async()=>{o(!0);try{const t=await g.exportUserData(),i=URL.createObjectURL(t),m=document.createElement("a");m.href=i,m.download="users-export.json",m.click(),URL.revokeObjectURL(i)}catch(t){x({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{o(!1)}},$=async()=>{o(!0);try{await g.clearCache(),x({type:"success",text:a.cacheCleared})}catch(t){x({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{o(!1)}},q=async()=>{if(d){o(!0);try{const t=D==="-1"?-1:parseInt(D,10);await g.updateUserQuota(d.id,t),p(f.map(i=>i.id===d.id?{...i,storyQuota:t}:i)),S(null),C("")}catch(t){x({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{o(!1)}}},V=async t=>{const i=t.role==="admin"?"user":"admin";o(!0);try{await g.updateUserRole(t.id,i),p(f.map(m=>m.id===t.id?{...m,role:i}:m))}catch(m){x({type:"error",text:m instanceof Error?m.message:"Failed"})}finally{o(!1)}},G=async t=>{if(confirm(a.confirmDelete)){o(!0);try{await g.deleteUser(t.id),p(f.filter(i=>i.id!==t.id))}catch(i){x({type:"error",text:i instanceof Error?i.message:"Failed"})}finally{o(!1)}}};return!l||(s==null?void 0:s.role)!=="admin"?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center max-w-md",children:[e.jsx(F,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:a.accessDenied}),e.jsx("p",{className:"text-gray-600 mb-6",children:a.accessDeniedDesc}),e.jsx(h,{onClick:()=>n("/"),children:a.goHome})]})}):y?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:e.jsx(_,{className:"w-12 h-12 animate-spin text-indigo-600"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 py-8 px-4",children:[e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>n("/"),className:"p-2 rounded-lg hover:bg-white/50 transition-colors",children:e.jsx(J,{size:24})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:a.title})]}),e.jsxs(h,{variant:"outline",onClick:U,disabled:y,children:[e.jsx(M,{size:16,className:y?"animate-spin":""}),a.refreshStats]})]}),E&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:E}),z&&e.jsxs("div",{className:`px-4 py-3 rounded-lg mb-6 ${z.type==="success"?"bg-green-100 border border-green-400 text-green-700":"bg-red-100 border border-red-400 text-red-700"}`,children:[z.text,e.jsx("button",{onClick:()=>x(null),className:"float-right font-bold",children:"Ã—"})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:()=>Q("stats"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${k==="stats"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:a.stats}),e.jsx("button",{onClick:()=>Q("users"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${k==="users"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:a.users})]}),k==="stats"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(b,{icon:e.jsx(T,{className:"w-8 h-8 text-purple-600"}),title:a.totalUsers,value:(r==null?void 0:r.totalUsers)??0}),e.jsx(b,{icon:e.jsx(X,{className:"w-8 h-8 text-pink-600"}),title:a.totalStories,value:(r==null?void 0:r.totalStories)??0}),e.jsx(b,{icon:e.jsx(T,{className:"w-8 h-8 text-blue-600"}),title:a.totalCharacters,value:(r==null?void 0:r.totalCharacters)??0}),e.jsx(b,{icon:e.jsx(se,{className:"w-8 h-8 text-green-600"}),title:a.totalImages,value:(r==null?void 0:r.totalImages)??0}),e.jsx(b,{icon:e.jsx(F,{className:"w-8 h-8 text-yellow-600"}),title:a.orphanedFiles,value:(r==null?void 0:r.orphanedFiles)??0}),e.jsx(b,{icon:e.jsx(ae,{className:"w-8 h-8 text-indigo-600"}),title:a.databaseSize,value:(r==null?void 0:r.databaseSize)??"N/A",isString:!0})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:a.adminActions}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(h,{variant:"secondary",onClick:O,disabled:v,children:[e.jsx(I,{size:16}),a.cleanOrphaned]}),e.jsxs(h,{variant:"secondary",onClick:B,disabled:v,children:[e.jsx(W,{size:16}),a.exportData]}),e.jsxs(h,{variant:"secondary",onClick:()=>n("/admin/logs"),disabled:v,children:[e.jsx(ee,{size:16}),a.viewLogs]}),e.jsxs(h,{variant:"danger",onClick:$,disabled:v,children:[e.jsx(M,{size:16}),a.clearCache]})]})]})]}),k==="users"&&e.jsx("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:a.username}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:a.email}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:a.role}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:a.quota}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:a.generated}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:a.actions})]})}),e.jsx("tbody",{className:"divide-y",children:f.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:t.username}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.email}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.role==="admin"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:t.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.storyQuota===-1?a.unlimited:t.storyQuota}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.storiesGenerated}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{S(t),C(String(t.storyQuota))},className:"p-1 rounded hover:bg-gray-100 text-blue-600",title:a.editQuota,children:e.jsx(te,{size:16})}),e.jsx("button",{onClick:()=>V(t),className:`p-1 rounded hover:bg-gray-100 ${t.role==="admin"?"text-yellow-600":"text-purple-600"}`,title:t.role==="admin"?a.removeAdmin:a.makeAdmin,disabled:t.id===(s==null?void 0:s.id),children:t.role==="admin"?e.jsx(re,{size:16}):e.jsx(ne,{size:16})}),e.jsx("button",{onClick:()=>G(t),className:"p-1 rounded hover:bg-gray-100 text-red-600",title:a.deleteUser,disabled:t.id===(s==null?void 0:s.id),children:e.jsx(I,{size:16})})]})})]},t.id))})]})})})]}),e.jsx(le,{isOpen:!!d,onClose:()=>{S(null),C("")},title:a.editQuota,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:[d==null?void 0:d.username," (",d==null?void 0:d.email,")"]}),e.jsx(Y,{label:a.newQuota,type:"number",value:D,onChange:t=>C(t.target.value),placeholder:"-1 for unlimited"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(h,{variant:"secondary",onClick:()=>S(null),children:a.cancel}),e.jsx(h,{onClick:q,disabled:v,children:a.save})]})]})})]})}function b({icon:n,title:s,value:l,isString:j=!1}){return e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gray-100 rounded-lg",children:n}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:s}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:j?l:typeof l=="number"?l.toLocaleString():l})]})]})}export{ge as default};
