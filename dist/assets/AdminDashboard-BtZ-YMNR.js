import{c as w,b as g,j as e,X as vt,a as Nt,u as kt,L as z,T as Re,E as wt}from"./index-HXZF-_U0.js";import{b as l,u as Ct,e as Pt}from"./vendor-react-CqfXSjHo.js";import{B as h,U as me,I as xe,C as Be}from"./Input-JvmKnuGz.js";import{A as St}from"./arrow-left-BMrz4mpN.js";import{R as ue,I as Oe,F as zt,a as Ke,H as qe,M as At,P as Dt,C as he}from"./refresh-cw-DCibXt_m.js";import{P as Tt}from"./printer-DdIyKimz.js";import{B as pe}from"./book-open-BiNGDVw-.js";import{T as ge}from"./trash-2-fffh6Bi5.js";import{D as Ut,C as ye}from"./download-CNG-fqQN.js";import{C as Et}from"./camera-pAVolOM5.js";import{C as Lt}from"./check-DKExdclc.js";import{C as $t}from"./clock-BIWu6m1l.js";import"./vendor-firebase-DTVMaYMy.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=w("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=w("CameraOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16",key:"qmtpty"}],["path",{d:"M9.5 4h5L17 7h3a2 2 0 0 1 2 2v7.5",key:"1ufyfc"}],["path",{d:"M14.121 15.121A3 3 0 1 1 9.88 10.88",key:"11zox6"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=w("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=w("MailX",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h9",key:"1j9vog"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m17 17 4 4",key:"1b3523"}],["path",{d:"m21 17-4 4",key:"uinynz"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=w("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=w("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=w("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=w("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=w("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),y={async getStats(){return g.get("/api/admin/stats")},async getUsers(i={}){const c=new URLSearchParams;i.page&&c.set("page",String(i.page)),i.limit&&c.set("limit",String(i.limit)),i.search&&c.set("search",i.search);const f=c.toString();return g.get(`/api/admin/users${f?`?${f}`:""}`)},async updateUserCredits(i,c){return g.post(`/api/admin/users/${i}/quota`,{credits:c})},async getCreditHistory(i,c=50){return g.get(`/api/admin/users/${i}/credits?limit=${c}`)},async getUserDetails(i){return g.get(`/api/admin/users/${i}/details`)},async updateUserRole(i,c){return g.post(`/api/admin/users/${i}/role`,{role:c})},async deleteUser(i){return g.delete(`/api/admin/users/${i}`)},async toggleEmailVerified(i,c){return g.post(`/api/admin/users/${i}/email-verified`,{emailVerified:c})},async togglePhotoConsent(i,c){return g.post(`/api/admin/users/${i}/photo-consent`,{hasConsent:c})},async cleanOrphanedFiles(){return g.post("/api/admin/cleanup-orphaned")},async clearCache(){return g.post("/api/admin/clear-cache")},async getSystemLogs(){return g.get("/api/admin/logs")},async exportUserData(){return(await fetch("/api/admin/export",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).blob()},async getPrintProducts(){return g.get("/api/admin/print-products")},async fetchGelatoProducts(){return g.get("/api/admin/print-provider/fetch-products")},async createPrintProduct(i){return g.post("/api/admin/print-products",i)},async updatePrintProduct(i,c){return g.put(`/api/admin/print-products/${i}`,c)},async togglePrintProduct(i,c){return g.put(`/api/admin/print-products/${i}/toggle`,{is_active:c})},async deletePrintProduct(i){return g.delete(`/api/admin/print-products/${i}`)}},Bt={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-[95vw] max-h-[95vh]"};function J({isOpen:i,onClose:c,title:f,children:m,size:P="md",showCloseButton:_=!0,closeOnOverlayClick:W=!0,closeOnEscape:C=!0}){const E=l.useCallback(L=>{L.key==="Escape"&&C&&c()},[c,C]);return l.useEffect(()=>(i&&(document.addEventListener("keydown",E),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",E),document.body.style.overflow="unset"}),[i,E]),i?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:W?c:void 0}),e.jsxs("div",{className:`
          relative bg-white rounded-2xl shadow-2xl w-full mx-4
          transform transition-all duration-300 ease-out
          animate-in fade-in zoom-in-95
          ${Bt[P]}
        `,children:[(f||_)&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[f&&e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:f}),_&&e.jsx("button",{onClick:c,className:"p-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:e.jsx(vt,{size:20})})]}),e.jsx("div",{className:"p-4 max-h-[80vh] overflow-y-auto",children:m})]})]}):null}const Xe={en:{title:"Admin Dashboard",stats:"Statistics",users:"User Management",totalUsers:"Total Users",totalStories:"Total Stories",totalCharacters:"Total Characters",totalImages:"Total Images",orphanedFiles:"Orphaned Files",databaseSize:"Database Size",adminActions:"Admin Actions",cleanOrphaned:"Clean Orphaned Files",exportData:"Export User Data",viewLogs:"View System Logs",clearCache:"Clear Cache",accessDenied:"Access Denied",accessDeniedDesc:"You need admin privileges to access this page.",goHome:"Go Home",username:"Username",email:"Email",role:"Role",credits:"Credits",actions:"Actions",editCredits:"Edit Credits",newCredits:"New Credits",save:"Save",cancel:"Cancel",makeAdmin:"Make Admin",removeAdmin:"Remove Admin",deleteUser:"Delete User",confirmDelete:"Are you sure you want to delete this user?",unlimited:"Unlimited",cleaned:"Cleaned {count} orphaned files",cacheCleared:"Cache cleared successfully",refreshStats:"Refresh Stats",creditHistory:"Credit History",viewHistory:"View History",amount:"Amount",balance:"Balance",type:"Type",description:"Description",date:"Date",noTransactions:"No transactions found",currentBalance:"Current Balance",impersonate:"View as User",impersonating:"Now viewing as {username}",userDetails:"User Details",memberSince:"Member Since",lastLogin:"Last Login",never:"Never",stories:"Stories",characters:"Characters",images:"Images",purchases:"Purchases",totalSpent:"Total Spent",storyTitle:"Title",pages:"Pages",purchaseHistory:"Purchase History",status:"Status",product:"Product",noStories:"No stories yet",noPurchases:"No purchases yet",close:"Close",tokens:"Tokens",totalTokens:"Total Tokens",inputTokens:"Input",outputTokens:"Output",apiCalls:"API Calls",printProducts:"Print Products",fetchFromGelato:"Fetch from Gelato",savedProducts:"Saved Products",gelatoProducts:"Gelato Products",productUid:"Product UID",productName:"Product Name",size:"Size",coverType:"Cover Type",minPages:"Min Pages",maxPages:"Max Pages",active:"Active",inactive:"Inactive",addProduct:"Add Product",noProducts:"No products configured yet",noGelatoProducts:'Click "Fetch from Gelato" to load available products',selectProduct:"Select a product from Gelato to add it",softcover:"Softcover",hardcover:"Hardcover",fetching:"Fetching products...",confirmDeleteProduct:"Are you sure you want to delete this product?",editProduct:"Edit Product",editPages:"Edit Page Range",searchUsers:"Search users...",search:"Search",showingUsers:"Showing {from}-{to} of {total}",pageOf:"Page {page} of {total}"},de:{title:"Admin-Dashboard",stats:"Statistiken",users:"Benutzerverwaltung",totalUsers:"Benutzer gesamt",totalStories:"Geschichten gesamt",totalCharacters:"Charaktere gesamt",totalImages:"Bilder gesamt",orphanedFiles:"Verwaiste Dateien",databaseSize:"Datenbankgroesse",adminActions:"Admin-Aktionen",cleanOrphaned:"Verwaiste Dateien bereinigen",exportData:"Benutzerdaten exportieren",viewLogs:"Systemprotokolle anzeigen",clearCache:"Cache leeren",accessDenied:"Zugriff verweigert",accessDeniedDesc:"Sie benoetigen Admin-Rechte um auf diese Seite zuzugreifen.",goHome:"Zur Startseite",username:"Benutzername",email:"E-Mail",role:"Rolle",credits:"Credits",actions:"Aktionen",editCredits:"Credits bearbeiten",newCredits:"Neue Credits",save:"Speichern",cancel:"Abbrechen",makeAdmin:"Zum Admin machen",removeAdmin:"Admin-Rechte entfernen",deleteUser:"Benutzer löschen",confirmDelete:"Sind Sie sicher, dass Sie diesen Benutzer löschen möchten?",unlimited:"Unbegrenzt",cleaned:"{count} verwaiste Dateien bereinigt",cacheCleared:"Cache erfolgreich geleert",refreshStats:"Statistiken aktualisieren",impersonate:"Als Benutzer ansehen",impersonating:"Ansicht als {username}",creditHistory:"Credit-Verlauf",viewHistory:"Verlauf anzeigen",amount:"Betrag",balance:"Guthaben",type:"Typ",description:"Beschreibung",date:"Datum",noTransactions:"Keine Transaktionen gefunden",currentBalance:"Aktuelles Guthaben",userDetails:"Benutzerdetails",memberSince:"Mitglied seit",lastLogin:"Letzter Login",never:"Nie",stories:"Geschichten",characters:"Charaktere",images:"Bilder",purchases:"Käufe",totalSpent:"Gesamtausgaben",storyTitle:"Titel",pages:"Seiten",purchaseHistory:"Kaufhistorie",status:"Status",product:"Produkt",noStories:"Noch keine Geschichten",noPurchases:"Noch keine Käufe",close:"Schliessen",tokens:"Tokens",totalTokens:"Tokens gesamt",inputTokens:"Eingabe",outputTokens:"Ausgabe",apiCalls:"API-Aufrufe",printProducts:"Druckprodukte",fetchFromGelato:"Von Gelato laden",savedProducts:"Gespeicherte Produkte",gelatoProducts:"Gelato Produkte",productUid:"Produkt-UID",productName:"Produktname",size:"Grösse",coverType:"Einbandtyp",minPages:"Min. Seiten",maxPages:"Max. Seiten",active:"Aktiv",inactive:"Inaktiv",addProduct:"Produkt hinzufügen",noProducts:"Noch keine Produkte konfiguriert",noGelatoProducts:'Klicken Sie auf "Von Gelato laden" um verfügbare Produkte zu laden',selectProduct:"Wählen Sie ein Produkt von Gelato aus um es hinzuzufügen",softcover:"Softcover",hardcover:"Hardcover",fetching:"Lade Produkte...",confirmDeleteProduct:"Sind Sie sicher, dass Sie dieses Produkt löschen möchten?",editProduct:"Produkt bearbeiten",editPages:"Seitenbereich bearbeiten",searchUsers:"Benutzer suchen...",search:"Suchen",showingUsers:"Zeige {from}-{to} von {total}",pageOf:"Seite {page} von {total}"},fr:{title:"Tableau de bord Admin",stats:"Statistiques",users:"Gestion des utilisateurs",totalUsers:"Utilisateurs totaux",totalStories:"Histoires totales",totalCharacters:"Personnages totaux",totalImages:"Images totales",orphanedFiles:"Fichiers orphelins",databaseSize:"Taille de la base",adminActions:"Actions Admin",cleanOrphaned:"Nettoyer fichiers orphelins",exportData:"Exporter les donnees",viewLogs:"Voir les logs systeme",clearCache:"Vider le cache",accessDenied:"Acces refuse",accessDeniedDesc:"Vous avez besoin des privileges admin pour acceder a cette page.",goHome:"Accueil",username:"Nom d'utilisateur",email:"E-mail",role:"Role",credits:"Credits",actions:"Actions",editCredits:"Modifier les credits",newCredits:"Nouveaux credits",save:"Enregistrer",cancel:"Annuler",makeAdmin:"Rendre admin",removeAdmin:"Retirer admin",deleteUser:"Supprimer l'utilisateur",confirmDelete:"Etes-vous sur de vouloir supprimer cet utilisateur?",unlimited:"Illimite",cleaned:"{count} fichiers orphelins nettoyes",cacheCleared:"Cache vide avec succes",refreshStats:"Actualiser les stats",impersonate:"Voir comme utilisateur",impersonating:"Vue en tant que {username}",creditHistory:"Historique des credits",viewHistory:"Voir l'historique",amount:"Montant",balance:"Solde",type:"Type",description:"Description",date:"Date",noTransactions:"Aucune transaction trouvee",currentBalance:"Solde actuel",userDetails:"Details utilisateur",memberSince:"Membre depuis",lastLogin:"Derniere connexion",never:"Jamais",stories:"Histoires",characters:"Personnages",images:"Images",purchases:"Achats",totalSpent:"Total depense",storyTitle:"Titre",pages:"Pages",purchaseHistory:"Historique des achats",status:"Statut",product:"Produit",noStories:"Pas encore d'histoires",noPurchases:"Pas encore d'achats",close:"Fermer",tokens:"Tokens",totalTokens:"Tokens totaux",inputTokens:"Entree",outputTokens:"Sortie",apiCalls:"Appels API",printProducts:"Produits d'impression",fetchFromGelato:"Charger depuis Gelato",savedProducts:"Produits enregistres",gelatoProducts:"Produits Gelato",productUid:"UID Produit",productName:"Nom du produit",size:"Taille",coverType:"Type de couverture",minPages:"Pages min",maxPages:"Pages max",active:"Actif",inactive:"Inactif",addProduct:"Ajouter un produit",noProducts:"Aucun produit configure",noGelatoProducts:'Cliquez sur "Charger depuis Gelato" pour charger les produits disponibles',selectProduct:"Selectionnez un produit Gelato pour l'ajouter",softcover:"Couverture souple",hardcover:"Couverture rigide",fetching:"Chargement des produits...",confirmDeleteProduct:"Etes-vous sur de vouloir supprimer ce produit?",editProduct:"Modifier le produit",editPages:"Modifier la plage de pages",searchUsers:"Rechercher des utilisateurs...",search:"Rechercher",showingUsers:"Affichage {from}-{to} sur {total}",pageOf:"Page {page} sur {total}"}};function U({icon:i,title:c,value:f,isString:m=!1}){return e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gray-100 rounded-lg",children:i}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:c}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:m?f:typeof f=="number"?f.toLocaleString():f})]})]})}function rs(){var _e,Ie,Me,He,Ge,Ve;const i=Ct(),[c,f]=Pt(),{user:m,isAuthenticated:P,impersonate:_,isLoading:W,isImpersonating:C}=Nt(),{language:E}=kt(),L=c.get("tab"),Je=L&&["stats","users","products"].includes(L)?L:"stats",[u,We]=l.useState(null),[A,D]=l.useState([]),[x,Ye]=l.useState(null),[I,Qe]=l.useState(""),[Y,fe]=l.useState(1),[Q,je]=l.useState(!1),[et,be]=l.useState(!1),[ve,Ne]=l.useState(null),[j,tt]=l.useState(Je),[b,M]=l.useState(null),[ee,H]=l.useState(""),[N,o]=l.useState(!1),[te,d]=l.useState(null),[v,G]=l.useState(null),[ke,se]=l.useState([]),[st,we]=l.useState(!1),[V,R]=l.useState(null),[n,ae]=l.useState(null),[at,Ce]=l.useState(!1),[T,Pe]=l.useState({stories:!1,purchases:!1,credits:!1}),[B,O]=l.useState([]),[re,rt]=l.useState([]),[ie,Se]=l.useState(!1),[ne,ze]=l.useState(!1),[S,K]=l.useState(null),[Ae,De]=l.useState(""),[Te,Ue]=l.useState(""),s=Xe[E]||Xe.en,Ee=async()=>{if(!u){be(!0);try{const t=await y.getStats();We(t)}catch(t){console.error("Failed to load stats:",t)}finally{be(!1)}}},Le=async(t=1,a="")=>{je(!0),Ne(null);try{const r=await y.getUsers({page:t,limit:50,search:a});D(r.users||[]),Ye(r.pagination||null)}catch(r){Ne(r instanceof Error?r.message:"Unknown error")}finally{je(!1)}},q=async(t=1,a="")=>{await Le(t,a),j==="stats"&&await Ee()},Z=t=>{fe(t),q(t,I)},$e=()=>{fe(1),q(1,I)};l.useEffect(()=>{P&&((m==null?void 0:m.role)==="admin"||C)&&Le()},[P,m,C]),l.useEffect(()=>{P&&((m==null?void 0:m.role)==="admin"||C)&&j==="stats"&&Ee()},[P,m,C,j]);const le=t=>{tt(t),f(t==="stats"?{}:{tab:t})},it=async()=>{o(!0);try{const t=await y.cleanOrphanedFiles();d({type:"success",text:s.cleaned.replace("{count}",String(t.cleaned))}),q()}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{o(!1)}},nt=async()=>{o(!0);try{const t=await y.exportUserData(),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="users-export.json",r.click(),URL.revokeObjectURL(a)}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{o(!1)}},lt=async()=>{o(!0);try{await y.clearCache(),d({type:"success",text:s.cacheCleared})}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{o(!1)}},ct=async()=>{if(b){o(!0);try{const t=ee==="-1"?-1:parseInt(ee,10);await y.updateUserCredits(b.id,t),D(A.map(a=>a.id===b.id?{...a,credits:t}:a)),M(null),H("")}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{o(!1)}}},ot=async t=>{const a=t.role==="admin"?"user":"admin";o(!0);try{await y.updateUserRole(t.id,a),D(A.map(r=>r.id===t.id?{...r,role:a}:r))}catch(r){d({type:"error",text:r instanceof Error?r.message:"Failed"})}finally{o(!1)}},dt=async t=>{if(confirm(s.confirmDelete)){o(!0);try{await y.deleteUser(t.id),D(A.filter(a=>a.id!==t.id))}catch(a){d({type:"error",text:a instanceof Error?a.message:"Failed"})}finally{o(!1)}}},mt=async t=>{const a=!t.emailVerified;o(!0);try{await y.toggleEmailVerified(t.id,a),D(A.map(r=>r.id===t.id?{...r,emailVerified:a}:r)),d({type:"success",text:`Email ${a?"verified":"unverified"} for ${t.username}`})}catch(r){d({type:"error",text:r instanceof Error?r.message:"Failed"})}finally{o(!1)}},xt=async t=>{const r=!!!t.photoConsentAt;o(!0);try{const p=await y.togglePhotoConsent(t.id,r);D(A.map(k=>k.id===t.id?{...k,photoConsentAt:p.user.photoConsentAt}:k)),d({type:"success",text:`Photo consent ${r?"granted":"revoked"} for ${t.username}`})}catch(p){d({type:"error",text:p instanceof Error?p.message:"Failed"})}finally{o(!1)}},ut=async t=>{o(!0);try{await _(t.id),i("/")}catch(a){d({type:"error",text:a instanceof Error?a.message:"Impersonation failed"})}finally{o(!1)}},ht=async t=>{G(t),we(!0),se([]);try{const a=await y.getCreditHistory(t.id);se(a.transactions)}catch(a){d({type:"error",text:a instanceof Error?a.message:"Failed to load credit history"}),G(null)}finally{we(!1)}},X=async t=>{R(t),Ce(!0),ae(null),Pe({stories:!1,purchases:!1,credits:!1});try{const a=await y.getUserDetails(t.id);ae(a)}catch(a){d({type:"error",text:a instanceof Error?a.message:"Failed to load user details"}),R(null)}finally{Ce(!1)}},ce=t=>{Pe(a=>({...a,[t]:!a[t]}))},Fe=t=>t?new Date(t).toLocaleDateString()+" "+new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.never,oe=async()=>{Se(!0);try{const t=await y.getPrintProducts();O(t.products||[])}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed to load products"})}finally{Se(!1)}},pt=async()=>{ze(!0);try{const t=await y.fetchGelatoProducts();rt(t.products||[])}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed to fetch from Gelato"})}finally{ze(!1)}},gt=async t=>{var a,r;o(!0);try{const p=(t.name||t.productName||"").match(/(\d+)x(\d+)/i),k=p?`${p[1]}x${p[2]}mm`:"",$=t.productUid||t.uid||"",F=$.toLowerCase().includes("hardcover")?"hardcover":"softcover",de={product_uid:$,product_name:t.name||t.productName||"Unknown Product",description:t.description||"",size:k,cover_type:F,min_pages:((a=t.pageCount)==null?void 0:a.min)||24,max_pages:((r=t.pageCount)==null?void 0:r.max)||100,available_page_counts:[],is_active:!0};await y.createPrintProduct(de),d({type:"success",text:"Product added successfully"}),oe()}catch(p){d({type:"error",text:p instanceof Error?p.message:"Failed to add product"})}finally{o(!1)}},yt=async t=>{o(!0);try{await y.togglePrintProduct(t.id,t.is_active),O(a=>a.map(r=>r.id===t.id?{...r,is_active:!r.is_active}:r))}catch(a){d({type:"error",text:a instanceof Error?a.message:"Failed to toggle product"})}finally{o(!1)}},ft=async t=>{if(confirm(s.confirmDeleteProduct)){o(!0);try{await y.deletePrintProduct(t.id),O(a=>a.filter(r=>r.id!==t.id))}catch(a){d({type:"error",text:a instanceof Error?a.message:"Failed to delete product"})}finally{o(!1)}}},jt=t=>{K(t),De(String(t.min_pages)),Ue(String(t.max_pages))},bt=async()=>{if(S){o(!0);try{const t=parseInt(Ae,10),a=parseInt(Te,10);if(isNaN(t)||isNaN(a)||t<1||a<t){d({type:"error",text:"Invalid page range"});return}await y.updatePrintProduct(S.id,{min_pages:t,max_pages:a}),O(r=>r.map(p=>p.id===S.id?{...p,min_pages:t,max_pages:a}:p)),K(null),d({type:"success",text:"Product updated successfully"})}catch(t){d({type:"error",text:t instanceof Error?t.message:"Failed to update product"})}finally{o(!1)}}};return l.useEffect(()=>{j==="products"&&B.length===0&&oe()},[j]),W?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:e.jsx(z,{className:"w-12 h-12 animate-spin text-indigo-600"})}):!P||(m==null?void 0:m.role)!=="admin"&&!C?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center max-w-md",children:[e.jsx(Re,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s.accessDenied}),e.jsx("p",{className:"text-gray-600 mb-6",children:s.accessDeniedDesc}),e.jsx(h,{onClick:()=>i("/"),children:s.goHome})]})}):Q?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:e.jsx(z,{className:"w-12 h-12 animate-spin text-indigo-600"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 py-8 px-4",children:[e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>i("/"),className:"p-2 rounded-lg hover:bg-white/50 transition-colors",children:e.jsx(St,{size:24})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:s.title})]}),e.jsxs(h,{variant:"outline",onClick:()=>q(Y,I),disabled:Q,children:[e.jsx(ue,{size:16,className:Q?"animate-spin":""}),s.refreshStats]})]}),ve&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:ve}),te&&e.jsxs("div",{className:`px-4 py-3 rounded-lg mb-6 ${te.type==="success"?"bg-green-100 border border-green-400 text-green-700":"bg-red-100 border border-red-400 text-red-700"}`,children:[te.text,e.jsx("button",{onClick:()=>d(null),className:"float-right font-bold",children:"×"})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:()=>le("stats"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${j==="stats"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:s.stats}),e.jsx("button",{onClick:()=>le("users"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${j==="users"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:s.users}),e.jsxs("button",{onClick:()=>le("products"),className:`px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 ${j==="products"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(Tt,{size:18}),s.printProducts]})]}),j==="stats"&&e.jsxs(e.Fragment,{children:[et?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(z,{className:"w-8 h-8 animate-spin text-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading statistics..."})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(U,{icon:e.jsx(me,{className:"w-8 h-8 text-purple-600"}),title:s.totalUsers,value:(u==null?void 0:u.totalUsers)??0}),e.jsx(U,{icon:e.jsx(pe,{className:"w-8 h-8 text-pink-600"}),title:s.totalStories,value:(u==null?void 0:u.totalStories)??0}),e.jsx(U,{icon:e.jsx(me,{className:"w-8 h-8 text-blue-600"}),title:s.totalCharacters,value:(u==null?void 0:u.totalCharacters)??0}),e.jsx(U,{icon:e.jsx(Oe,{className:"w-8 h-8 text-green-600"}),title:s.totalImages,value:(u==null?void 0:u.totalImages)??0}),e.jsx(U,{icon:e.jsx(Re,{className:"w-8 h-8 text-yellow-600"}),title:s.orphanedFiles,value:(u==null?void 0:u.orphanedFiles)??0}),e.jsx(U,{icon:e.jsx(It,{className:"w-8 h-8 text-indigo-600"}),title:s.databaseSize,value:(u==null?void 0:u.databaseSize)??"N/A",isString:!0})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:s.adminActions}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(h,{variant:"secondary",onClick:it,disabled:N,children:[e.jsx(ge,{size:16}),s.cleanOrphaned]}),e.jsxs(h,{variant:"secondary",onClick:nt,disabled:N,children:[e.jsx(Ut,{size:16}),s.exportData]}),e.jsxs(h,{variant:"secondary",onClick:()=>i("/admin/logs"),disabled:N,children:[e.jsx(zt,{size:16}),s.viewLogs]}),e.jsxs(h,{variant:"danger",onClick:lt,disabled:N,children:[e.jsx(ue,{size:16}),s.clearCache]})]})]})]}),j==="users"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50 flex gap-2 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:s.searchUsers||"Search users...",value:I,onChange:t=>Qe(t.target.value),onKeyDown:t=>t.key==="Enter"&&$e(),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsx(h,{onClick:$e,variant:"secondary",size:"sm",children:s.search||"Search"}),x&&e.jsx("span",{className:"text-sm text-gray-500 ml-auto",children:((_e=s.showingUsers)==null?void 0:_e.replace("{from}",String((x.page-1)*x.limit+1)).replace("{to}",String(Math.min(x.page*x.limit,x.totalUsers))).replace("{total}",String(x.totalUsers)))||`Showing ${(x.page-1)*x.limit+1}-${Math.min(x.page*x.limit,x.totalUsers)} of ${x.totalUsers}`})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.username}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.email}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.role}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.credits}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.actions})]})}),e.jsx("tbody",{className:"divide-y",children:A.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm cursor-pointer hover:text-indigo-600 hover:underline",onClick:()=>X(t),children:t.username}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 cursor-pointer hover:text-indigo-600",onClick:()=>X(t),children:t.email}),e.jsx("td",{className:"px-4 py-3 cursor-pointer",onClick:()=>X(t),children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.role==="admin"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:t.role})}),e.jsx("td",{className:"px-4 py-3 text-sm cursor-pointer hover:text-indigo-600",onClick:()=>X(t),children:t.credits===-1?s.unlimited:t.credits}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{M(t),H(String(t.credits))},className:"p-1 rounded hover:bg-gray-100 text-blue-600",title:s.editCredits,children:e.jsx(Ke,{size:16})}),e.jsx("button",{onClick:()=>ot(t),className:`p-1 rounded hover:bg-gray-100 ${t.role==="admin"?"text-yellow-600":"text-purple-600"}`,title:t.role==="admin"?s.removeAdmin:s.makeAdmin,disabled:t.id===(m==null?void 0:m.id),children:t.role==="admin"?e.jsx(Ht,{size:16}):e.jsx(Gt,{size:16})}),e.jsx("button",{onClick:()=>ht(t),className:"p-1 rounded hover:bg-gray-100 text-green-600",title:s.viewHistory||"View History",children:e.jsx(qe,{size:16})}),e.jsx("button",{onClick:()=>mt(t),className:`p-1 rounded hover:bg-gray-100 ${t.emailVerified?"text-emerald-600":"text-orange-500"}`,title:t.emailVerified?"Email verified - click to unverify":"Email NOT verified - click to verify",children:t.emailVerified?e.jsx(At,{size:16}):e.jsx(Mt,{size:16})}),e.jsx("button",{onClick:()=>xt(t),className:`p-1 rounded hover:bg-gray-100 ${t.photoConsentAt?"text-emerald-600":"text-orange-500"}`,title:t.photoConsentAt?"Photo consent given - click to revoke":"Photo consent NOT given - click to grant",children:t.photoConsentAt?e.jsx(Et,{size:16}):e.jsx(_t,{size:16})}),e.jsx("button",{onClick:()=>ut(t),className:"p-1 rounded hover:bg-gray-100 text-cyan-600",title:s.impersonate,disabled:t.id===(m==null?void 0:m.id),children:e.jsx(wt,{size:16})}),e.jsx("button",{onClick:()=>dt(t),className:"p-1 rounded hover:bg-gray-100 text-red-600",title:s.deleteUser,disabled:t.id===(m==null?void 0:m.id),children:e.jsx(ge,{size:16})})]})})]},t.id))})]})}),x&&x.totalPages>1&&e.jsxs("div",{className:"p-4 border-t bg-gray-50 flex justify-center items-center gap-2",children:[e.jsx(h,{onClick:()=>Z(1),disabled:!x.hasPrevPage,variant:"secondary",size:"sm",children:"<<"}),e.jsx(h,{onClick:()=>Z(Y-1),disabled:!x.hasPrevPage,variant:"secondary",size:"sm",children:"<"}),e.jsx("span",{className:"px-4 py-2 text-sm",children:((Ie=s.pageOf)==null?void 0:Ie.replace("{page}",String(x.page)).replace("{total}",String(x.totalPages)))||`Page ${x.page} of ${x.totalPages}`}),e.jsx(h,{onClick:()=>Z(Y+1),disabled:!x.hasNextPage,variant:"secondary",size:"sm",children:">"}),e.jsx(h,{onClick:()=>Z(x.totalPages),disabled:!x.hasNextPage,variant:"secondary",size:"sm",children:">>"})]})]}),j==="products"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:s.printProducts}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"secondary",onClick:oe,disabled:ie,children:[e.jsx(ue,{size:16,className:ie?"animate-spin":""}),s.refreshStats]}),e.jsxs(h,{onClick:pt,disabled:ne,children:[e.jsx(Ze,{size:16,className:ne?"animate-spin":""}),s.fetchFromGelato]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:s.savedProducts}),ie?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(z,{className:"w-8 h-8 animate-spin text-indigo-600"})}):B.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:s.noProducts}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.productName}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.size}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.coverType}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.pages}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.status}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.actions})]})}),e.jsx("tbody",{className:"divide-y",children:B.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:t.product_name}),e.jsxs("div",{className:"text-xs text-gray-500 font-mono truncate max-w-xs",title:t.product_uid,children:[t.product_uid.substring(0,40),"..."]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.size||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.cover_type==="hardcover"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:t.cover_type==="hardcover"?s.hardcover:s.softcover})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[t.min_pages," - ",t.max_pages]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.is_active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:t.is_active?s.active:s.inactive})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>jt(t),className:"p-1.5 rounded hover:bg-gray-100 text-indigo-600",title:s.editPages,disabled:N,children:e.jsx(Ke,{size:16})}),e.jsx("button",{onClick:()=>yt(t),className:`p-1.5 rounded hover:bg-gray-100 ${t.is_active?"text-green-600":"text-gray-400"}`,title:t.is_active?s.active:s.inactive,disabled:N,children:t.is_active?e.jsx(Rt,{size:20}):e.jsx(Vt,{size:20})}),e.jsx("button",{onClick:()=>ft(t),className:"p-1.5 rounded hover:bg-gray-100 text-red-600",title:s.deleteUser,disabled:N,children:e.jsx(ge,{size:16})})]})})]},t.id))})]})})]}),re.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:[s.gelatoProducts," (",re.length,")"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:s.selectProduct}),e.jsx("div",{className:"grid gap-3 max-h-96 overflow-y-auto",children:re.map(t=>{const a=t.productUid||t.uid||"",r=t.name||t.productName||"Unknown",p=a.toLowerCase().includes("hardcover"),k=r.match(/(\d+)x(\d+)/i),$=k?`${k[1]}x${k[2]}mm`:"",F=B.some(de=>de.product_uid===a);return e.jsx("div",{className:`p-4 border rounded-lg ${F?"bg-gray-50 opacity-60":"hover:border-indigo-300 cursor-pointer"}`,onClick:()=>!F&&gt(t),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:r}),e.jsxs("div",{className:"text-xs text-gray-500 font-mono mt-1 truncate",title:a,children:[a.substring(0,60),"..."]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[$&&e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:$}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${p?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:p?s.hardcover:s.softcover})]})]}),F?e.jsx(Lt,{size:20,className:"text-green-600"}):e.jsx(Dt,{size:20,className:"text-indigo-600"})]})},a)})})]}),ne&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 text-center",children:[e.jsx(z,{className:"w-8 h-8 animate-spin text-indigo-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:s.fetching})]})]})]}),e.jsx(J,{isOpen:!!b,onClose:()=>{M(null),H("")},title:s.editCredits,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:[b==null?void 0:b.username," (",b==null?void 0:b.email,")"]}),e.jsx(xe,{label:s.newCredits,type:"number",value:ee,onChange:t=>H(t.target.value),placeholder:"-1 for unlimited"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(h,{variant:"secondary",onClick:()=>M(null),children:s.cancel}),e.jsx(h,{onClick:ct,disabled:N,children:s.save})]})]})}),e.jsx(J,{isOpen:!!v,onClose:()=>{G(null),se([])},title:`${s.creditHistory||"Credit History"}: ${(v==null?void 0:v.username)||""}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:s.currentBalance||"Current Balance"}),e.jsx("p",{className:"text-2xl font-bold text-indigo-800",children:(v==null?void 0:v.credits)===-1?s.unlimited||"Unlimited":v==null?void 0:v.credits})]}),st?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(z,{className:"w-8 h-8 animate-spin text-indigo-600"})}):ke.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:s.noTransactions||"No transactions found"}):e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:s.date||"Date"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:s.type||"Type"}),e.jsx("th",{className:"px-3 py-2 text-right font-semibold text-gray-700",children:s.amount||"Amount"}),e.jsx("th",{className:"px-3 py-2 text-right font-semibold text-gray-700",children:s.balance||"Balance"})]})}),e.jsx("tbody",{className:"divide-y",children:ke.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-3 py-2 text-gray-600",children:[new Date(t.createdAt).toLocaleDateString()," ",new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${t.type==="story_reserve"?"bg-yellow-100 text-yellow-700":t.type==="story_complete"?"bg-green-100 text-green-700":t.type==="story_refund"?"bg-blue-100 text-blue-700":t.type==="admin_add"?"bg-purple-100 text-purple-700":t.type==="admin_deduct"?"bg-red-100 text-red-700":(t.type==="initial","bg-gray-100 text-gray-700")}`,children:t.type.replace(/_/g," ")})}),e.jsxs("td",{className:`px-3 py-2 text-right font-medium ${t.amount>0?"text-green-600":t.amount<0?"text-red-600":"text-gray-600"}`,children:[t.amount>0?"+":"",t.amount]}),e.jsx("td",{className:"px-3 py-2 text-right font-medium text-gray-800",children:t.balanceAfter})]},t.id))})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(h,{variant:"secondary",onClick:()=>G(null),children:s.cancel||"Close"})})]})}),e.jsx(J,{isOpen:!!V,onClose:()=>{R(null),ae(null)},title:`${s.userDetails}: ${(V==null?void 0:V.username)||""}`,children:e.jsxs("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto",children:[at?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(z,{className:"w-8 h-8 animate-spin text-indigo-600"})}):n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.email}),e.jsx("p",{className:"font-medium text-gray-800",children:n.user.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.role}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${n.user.role==="admin"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:n.user.role})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ft,{size:14,className:"text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.memberSince}),e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:Fe(n.user.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($t,{size:14,className:"text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.lastLogin}),e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:Fe(n.user.lastLogin)})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-pink-50 rounded-lg p-3 text-center",children:[e.jsx(pe,{size:20,className:"mx-auto text-pink-600 mb-1"}),e.jsx("p",{className:"text-2xl font-bold text-pink-700",children:n.stats.totalStories}),e.jsx("p",{className:"text-xs text-pink-600",children:s.stories})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx(me,{size:20,className:"mx-auto text-blue-600 mb-1"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:n.stats.totalCharacters}),e.jsx("p",{className:"text-xs text-blue-600",children:s.characters})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[e.jsx(Oe,{size:20,className:"mx-auto text-green-600 mb-1"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:n.stats.totalImages}),e.jsx("p",{className:"text-xs text-green-600",children:s.images})]}),e.jsxs("div",{className:"bg-amber-50 rounded-lg p-3 text-center",children:[e.jsx(Be,{size:20,className:"mx-auto text-amber-600 mb-1"}),e.jsx("p",{className:"text-2xl font-bold text-amber-700",children:n.stats.totalPurchases}),e.jsx("p",{className:"text-xs text-amber-600",children:s.purchases})]})]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:s.currentBalance}),e.jsx("p",{className:"text-xl font-bold text-indigo-800",children:n.user.credits===-1?s.unlimited:n.user.credits})]}),n.stats.totalSpent>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:s.totalSpent}),e.jsxs("p",{className:"text-xl font-bold text-indigo-800",children:["$",n.stats.totalSpent.toFixed(2)]})]})]}),n.stats.tokenUsage&&n.stats.tokenUsage.totalInputTokens>0&&e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-600 font-medium mb-2",children:s.totalTokens}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xl font-bold text-orange-700",children:[(n.stats.tokenUsage.totalInputTokens/1e3).toFixed(1),"K"]}),e.jsx("p",{className:"text-xs text-orange-600",children:s.inputTokens})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xl font-bold text-orange-700",children:[(n.stats.tokenUsage.totalOutputTokens/1e3).toFixed(1),"K"]}),e.jsx("p",{className:"text-xs text-orange-600",children:s.outputTokens})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-orange-700",children:n.stats.tokenUsage.totalCalls}),e.jsx("p",{className:"text-xs text-orange-600",children:s.apiCalls})]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-orange-200 text-xs text-orange-600 grid grid-cols-2 gap-1",children:[e.jsxs("span",{children:["Anthropic: ",((((Me=n.stats.tokenUsage.anthropic)==null?void 0:Me.input_tokens)||0)/1e3).toFixed(1),"K in / ",((((He=n.stats.tokenUsage.anthropic)==null?void 0:He.output_tokens)||0)/1e3).toFixed(1),"K out"]}),e.jsxs("span",{children:["Gemini: ",((((Ge=n.stats.tokenUsage.gemini_image)==null?void 0:Ge.input_tokens)||0)/1e3).toFixed(1),"K in / ",((((Ve=n.stats.tokenUsage.gemini_image)==null?void 0:Ve.output_tokens)||0)/1e3).toFixed(1),"K out"]})]})]}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("button",{onClick:()=>ce("stories"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(pe,{size:16}),s.stories," (",n.stories.length,")"]}),T.stories?e.jsx(he,{size:16}):e.jsx(ye,{size:16})]}),T.stories&&e.jsx("div",{className:"border-t px-4 py-3 max-h-48 overflow-y-auto",children:n.stories.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-2",children:s.noStories}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"pb-2",children:s.storyTitle}),e.jsx("th",{className:"pb-2",children:s.pages}),e.jsx("th",{className:"pb-2",children:s.images}),e.jsx("th",{className:"pb-2",children:s.date})]})}),e.jsx("tbody",{children:n.stories.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 font-medium",children:t.title}),e.jsx("td",{className:"py-2",children:t.pageCount}),e.jsx("td",{className:"py-2",children:t.imageCount}),e.jsx("td",{className:"py-2 text-gray-500",children:new Date(t.createdAt).toLocaleDateString()})]},t.id))})]})})]}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("button",{onClick:()=>ce("purchases"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Be,{size:16}),s.purchaseHistory," (",n.purchases.length,")"]}),T.purchases?e.jsx(he,{size:16}):e.jsx(ye,{size:16})]}),T.purchases&&e.jsx("div",{className:"border-t px-4 py-3 max-h-48 overflow-y-auto",children:n.purchases.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-2",children:s.noPurchases}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"pb-2",children:s.date}),e.jsx("th",{className:"pb-2",children:s.amount}),e.jsx("th",{className:"pb-2",children:s.status}),e.jsx("th",{className:"pb-2",children:s.product})]})}),e.jsx("tbody",{children:n.purchases.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 text-gray-500",children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"py-2 font-medium",children:[t.currency," ",t.amount]}),e.jsx("td",{className:"py-2",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${t.status==="paid"?"bg-green-100 text-green-700":t.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"py-2 text-gray-600 text-xs",children:t.productVariant||"-"})]},t.id))})]})})]}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("button",{onClick:()=>ce("credits"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(qe,{size:16}),s.creditHistory," (",n.creditHistory.length,")"]}),T.credits?e.jsx(he,{size:16}):e.jsx(ye,{size:16})]}),T.credits&&e.jsx("div",{className:"border-t px-4 py-3 max-h-48 overflow-y-auto",children:n.creditHistory.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-2",children:s.noTransactions}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"pb-2",children:s.date}),e.jsx("th",{className:"pb-2",children:s.type}),e.jsx("th",{className:"pb-2 text-right",children:s.amount}),e.jsx("th",{className:"pb-2 text-right",children:s.balance})]})}),e.jsx("tbody",{children:n.creditHistory.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 text-gray-500",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"py-2",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${t.type==="admin_add"?"bg-purple-100 text-purple-700":t.type==="story_complete"?"bg-green-100 text-green-700":t.type==="story_refund"?"bg-blue-100 text-blue-700":t.type==="story_reserve"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:t.type.replace(/_/g," ")})}),e.jsxs("td",{className:`py-2 text-right font-medium ${t.amount>0?"text-green-600":"text-red-600"}`,children:[t.amount>0?"+":"",t.amount]}),e.jsx("td",{className:"py-2 text-right font-medium",children:t.balanceAfter})]},t.id))})]})})]})]}):e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Failed to load user details"}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(h,{variant:"secondary",onClick:()=>R(null),children:s.close})})]})}),e.jsx(J,{isOpen:!!S,onClose:()=>K(null),title:s.editPages,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:S==null?void 0:S.product_name}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(xe,{label:s.minPages,type:"number",value:Ae,onChange:t=>De(t.target.value),min:1}),e.jsx(xe,{label:s.maxPages,type:"number",value:Te,onChange:t=>Ue(t.target.value),min:1})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(h,{variant:"secondary",onClick:()=>K(null),children:s.cancel}),e.jsx(h,{onClick:bt,disabled:N,children:s.save})]})]})})]})}export{rs as default};
