import{c as Pe,d as sa,j as e,L as me,s as tt,u as rt,T as ta,X as ke}from"./index-Z-lQ-nSh.js";import{b as P}from"./vendor-react-CqfXSjHo.js";import{U as jt}from"./Input-BbHCDbuX.js";import{S as ra}from"./Textarea-BTtSVnvt.js";import{H as aa,F as is}from"./history-CqDTu5cr.js";import{D as Ve}from"./download--6AMrbyo.js";import{C as _e}from"./chevron-down-DqC-tVz-.js";import{C as bt}from"./chevron-right-BNt_wdWx.js";import{I as ia}from"./ImageLightbox-C2xNnLcf.js";import{P as oe}from"./StoryWizard-BNtu7JzZ.js";import{C as wr}from"./chevron-up-0zjrdJmW.js";import{R as $e}from"./Modal-BP-IM4BE.js";import{P as na}from"./palette-C1H2NFIr.js";import{B as la}from"./book-BBIVcQUK.js";import{C as oa}from"./check-BM5y4HnJ.js";import{S as rs}from"./save-Cdx_TuGW.js";import{S as Sr}from"./shopping-cart-Bc98iJoV.js";import{P as Cr}from"./plus-CVnxQll3.js";import{B as gt}from"./book-open-BvI9BdsH.js";import{W as as}from"./wrench-MHqRiUbu.js";import{R as ht}from"./rotate-ccw-D0blr0hY.js";import"./vendor-firebase-DTVMaYMy.js";import"./sparkles-k5Ff9_tk.js";import"./circle-x-A0R27HUw.js";import"./clock-CfIpOe4p.js";import"./arrow-left-C-4xOtn4.js";import"./arrow-right-J50q20XW.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=Pe("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=Pe("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=Pe("Images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=Pe("Link2Off",[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=Pe("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=Pe("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=Pe("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $r=Pe("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=Pe("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Re=sa("ImageLoad");function et({src:d,alt:$,className:x,label:m}){const[p,F]=P.useState(!0),[S,R]=P.useState(null),b=P.useRef(0),N=P.useRef(null);P.useEffect(()=>{d&&d.length>100?(b.current=Date.now(),Re.info(`‚è≥ Loading ${m||$}`,{isBase64:d==null?void 0:d.startsWith("data:"),sizeKB:Math.round(d.length*3/4/1024)})):b.current=0,F(!0),R(null)},[d,$,m]);const w=()=>{if(F(!1),b.current===0){Re.info(`‚úÖ Loaded ${m||$} (placeholder/empty)`);return}const z=Date.now()-b.current;R(z);const h=(d==null?void 0:d.startsWith("data:"))?Math.round(d.length*3/4/1024):null,c=N.current?`${N.current.naturalWidth}x${N.current.naturalHeight}`:"unknown";z<100?Re.success(`‚úÖ Loaded ${m||$} in ${z}ms`,{sizeKB:h,naturalSize:c}):z<500?Re.info(`‚úÖ Loaded ${m||$} in ${z}ms`,{sizeKB:h,naturalSize:c}):z<2e3?Re.warn(`‚ö†Ô∏è Slow load: ${m||$} took ${z}ms`,{sizeKB:h,naturalSize:c}):Re.error(`üê¢ Very slow: ${m||$} took ${z}ms`,{sizeKB:h,naturalSize:c}),z>1e3&&ga({type:"slow_image_load",label:m||$,loadTimeMs:z,sizeKB:h,naturalSize:c,userAgent:navigator.userAgent,timestamp:new Date().toISOString()})},f=()=>{if(F(!1),b.current===0){Re.error(`‚ùå Failed to load ${m||$} (no data received)`);return}const z=Date.now()-b.current;Re.error(`‚ùå Failed to load ${m||$} after ${z}ms`)};return e.jsx("img",{ref:N,src:d,alt:$,className:x,onLoad:w,onError:f,draggable:!1})}async function ga(d){try{await fetch("/api/log-error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errorType:"Performance",message:`Slow image load: ${d.label} took ${d.loadTimeMs}ms`,userAgent:d.userAgent,timestamp:d.timestamp,url:window.location.href})})}catch{}}function Ps(d,$){const x=new Blob([d],{type:"text/plain;charset=utf-8"}),m=URL.createObjectURL(x),p=document.createElement("a");p.href=m,p.download=$,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(m)}function ft(d,$=0){const x="  ".repeat($);if(d==null)return`${x}null`;if(typeof d=="boolean")return`${x}${d?"YES":"NO"}`;if(typeof d=="number")return`${x}${d}`;if(typeof d=="string")return`${x}${d}`;if(Array.isArray(d))return d.length===0?`${x}[]`:d.map((m,p)=>`${x}[${p}]: ${ft(m,0)}`).join(`
`);if(typeof d=="object"){const m=Object.entries(d);return m.length===0?`${x}{}`:m.map(([p,F])=>{const S=ft(F,$+1);return typeof F=="object"&&F!==null?`${x}${p}:
${S}`:`${x}${p}: ${S.trim()}`}).join(`
`)}return`${x}${String(d)}`}function st({data:d,language:$,title:x}){const[m,p]=P.useState(new Set);if(!d)return e.jsx("div",{className:"text-gray-400 italic text-sm",children:$==="de"?"Keine Daten":"No data"});let F=d;if(typeof d=="string")try{F=JSON.parse(d)}catch{return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-1",children:e.jsxs("button",{onClick:()=>Ps(d,`${x||"evaluation"}.txt`),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1",title:"Download as text file",children:[e.jsx(Ve,{size:12})," Download"]})}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap bg-gray-50 p-3 rounded max-h-80 overflow-auto font-mono",children:d})]})}const S=N=>{const w=new Set(m);w.has(N)?w.delete(N):w.add(N),p(w)},R=()=>{const N=ft(F);Ps(N,`${x||"evaluation"}.txt`)},b=(N,w,f=0)=>{const z=m.has(N);if(w==null)return e.jsx("span",{className:"text-gray-400",children:"null"});if(typeof w=="boolean")return e.jsx("span",{className:w?"text-green-600 font-medium":"text-red-600 font-medium",children:w?"‚úì":"‚úó"});if(typeof w=="number"){const W=w>=70?"text-green-600":w>=50?"text-yellow-600":"text-red-600";return e.jsx("span",{className:`font-bold ${W}`,children:w})}if(typeof w=="string")return w.length>100?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>S(N),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[z?e.jsx(_e,{size:14}):e.jsx(bt,{size:14}),z?"Collapse":`Show (${w.length} chars)`]}),z&&e.jsx("div",{className:"mt-1 p-2 bg-gray-100 rounded text-sm whitespace-pre-wrap font-mono",children:w})]}):e.jsx("span",{className:"text-gray-700",children:w});if(Array.isArray(w))return w.length===0?e.jsx("span",{className:"text-gray-400",children:"[]"}):e.jsx("div",{className:"ml-2 border-l-2 border-gray-200 pl-2",children:w.map((W,h)=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"text-gray-400 text-xs",children:["[",h,"]"]})," ",b(`${N}.${h}`,W,f+1)]},h))});if(typeof w=="object"){const W=Object.entries(w);return W.length===0?e.jsx("span",{className:"text-gray-400",children:"{}"}):f>0?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>S(N),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[z?e.jsx(_e,{size:14}):e.jsx(bt,{size:14}),z?"Collapse":`{${W.length} fields}`]}),z&&e.jsx("div",{className:"ml-2 mt-1 border-l-2 border-gray-200 pl-2",children:W.map(([h,c])=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-600",children:[h,":"]})," ",b(`${N}.${h}`,c,f+1)]},h))})]}):e.jsx("div",{className:"space-y-1",children:W.map(([h,c])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-600 min-w-[100px]",children:[h,":"]}),e.jsx("div",{className:"flex-1",children:b(`${N}.${h}`,c,f+1)})]},h))})}return e.jsx("span",{children:String(w)})};return e.jsxs("div",{className:"text-sm space-y-1 max-h-[500px] overflow-auto",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("button",{onClick:R,className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-1 bg-blue-50 rounded hover:bg-blue-100",title:"Download as text file",children:[e.jsx(Ve,{size:12})," Download"]})}),b("root",F)]})}function ha({beforeImage:d,maskImage:$,onEnlarge:x}){return e.jsxs("div",{className:"relative w-40 h-40 cursor-pointer hover:ring-2 hover:ring-amber-400 rounded overflow-hidden border",onClick:()=>x(d,"Before with Mask"),children:[e.jsx("img",{src:d,alt:"Before",className:"w-full h-full object-contain"}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:{backgroundImage:`url(${$})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",mixBlendMode:"multiply",opacity:.5}}),e.jsx("img",{src:$,alt:"Mask overlay",className:"absolute inset-0 w-full h-full object-contain pointer-events-none",style:{mixBlendMode:"screen",opacity:.7,filter:"sepia(1) saturate(5) hue-rotate(-50deg)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent text-white text-[10px] text-center py-1 font-medium",children:"üéØ Edit Area"})]})}function ns({retryHistory:d,totalAttempts:$,language:x,onRevertRepair:m,storyId:p,pageNumber:F}){const[S,R]=P.useState(null),[b,N]=P.useState({}),[w,f]=P.useState(new Set),z=async T=>{if(!(!p||F===void 0||w.has(T))){f(n=>new Set(n).add(T));try{const n=localStorage.getItem("auth_token"),D=new URLSearchParams({page:String(F),type:"retry",index:String(T)}),G=await fetch(`/api/stories/${p}/dev-image?${D}`,{headers:n?{Authorization:`Bearer ${n}`}:{}});if(G.ok){const U=await G.json();N(u=>({...u,[T]:{imageData:U.imageData,annotatedOriginal:U.annotatedOriginal,grids:U.grids,bboxOverlayImage:U.bboxOverlayImage}}))}}catch(n){console.error(`Failed to load retry images for retry ${T}:`,n)}finally{f(n=>{const D=new Set(n);return D.delete(T),D})}}};if(!d||d.length===0)return null;const W=d.filter(T=>T.type==="auto_repair"||T.type==="grid_repair"||T.type==="grid_repair_failed").length,h=d.filter(T=>T.type==="grid_repair"||T.type==="grid_repair_failed").length,c=d.filter(T=>T.type==="grid_repair_failed").length;return e.jsxs(e.Fragment,{children:[S&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>R(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("div",{className:"absolute -top-8 left-0 text-white text-sm",children:S.title}),e.jsx("img",{src:S.src,alt:S.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute -top-8 right-0 text-white hover:text-gray-300",onClick:()=>R(null),children:"‚úï Close"})]})}),e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(aa,{size:14}),x==="de"?"Generierungshistorie":x==="fr"?"Historique de g√©n√©ration":"Generation History",W>0&&e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded",children:["üîß ",W," ",x==="de"?"Reparatur":"repair",W>1?x==="de"?"en":"s":"",h>0&&e.jsxs("span",{className:"ml-1",children:["(",h," grid",c>0?`, ${c} failed`:"",")"]})]})]}),e.jsxs("span",{className:"text-purple-600",children:[$," ",x==="de"?"Versuche":x==="fr"?"tentatives":"attempts"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:(()=>{const T=d.filter(n=>n.type!=="bbox_detection_only");return T.map((n,D)=>{var G,U;return e.jsxs("div",{className:`border rounded-lg p-3 ${n.type==="grid_repair_failed"?"bg-red-50 border-red-300":n.type==="grid_repair"?"bg-violet-50 border-violet-300":n.type==="auto_repair"?"bg-amber-50 border-amber-300":D===T.length-1?"bg-green-50 border-green-300":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-sm",children:[n.type==="grid_repair_failed"?e.jsx("span",{className:"text-red-700",children:"üî≤ Grid Repair Failed"}):n.type==="grid_repair"?e.jsx("span",{className:"text-violet-700",children:"üî≤ Grid Repair"}):n.type==="auto_repair"?e.jsx("span",{className:"text-amber-700",children:"üîß Auto-Repair"}):e.jsx(e.Fragment,{children:x==="de"?`Versuch ${n.attempt}`:x==="fr"?`Tentative ${n.attempt}`:`Attempt ${n.attempt}`}),n.type==="text_edit"&&e.jsx("span",{className:"text-xs ml-2 text-blue-600",children:"(text edit)"}),n.type==="text_edit_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(text edit failed)"}),n.type==="auto_repair_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(auto-repair failed)"}),D===T.length-1&&n.type!=="auto_repair"&&e.jsx("span",{className:"text-xs ml-2 text-green-600 font-bold",children:"‚úì USED"})]}),n.type==="auto_repair"&&n.preRepairScore!==void 0&&n.postRepairScore!==void 0?e.jsxs("span",{className:"font-bold text-sm",children:[e.jsxs("span",{className:n.preRepairScore>=70?"text-green-600":n.preRepairScore>=50?"text-yellow-600":"text-red-600",children:[n.preRepairScore,"%"]}),e.jsx("span",{className:"text-gray-400 mx-1",children:"‚Üí"}),e.jsxs("span",{className:n.postRepairScore>=70?"text-green-600":n.postRepairScore>=50?"text-yellow-600":"text-red-600",children:[n.postRepairScore,"%"]})]}):n.score!==void 0&&e.jsxs("span",{className:`font-bold ${n.score>=70?"text-green-600":n.score>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(n.score),"%"]})]}),n.error&&e.jsxs("div",{className:"text-xs text-red-600 mb-2",children:["Error: ",n.error]}),n.textIssue&&n.textIssue!=="NONE"&&e.jsxs("div",{className:"text-xs text-orange-600 mb-2",children:["Text issue: ",n.textIssue,n.expectedText&&e.jsxs("span",{className:"block",children:['Expected: "',n.expectedText,'"']}),n.actualText&&e.jsxs("span",{className:"block",children:['Actual: "',n.actualText,'"']})]}),n.type==="auto_repair"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[n.fixTargetsCount&&e.jsxs("div",{className:"text-xs text-amber-700",children:["Fixed ",n.fixTargetsCount," target",n.fixTargetsCount>1?"s":""]}),m&&((U=(G=n.repairDetails)==null?void 0:G[0])==null?void 0:U.beforeImage)&&n.postRepairScore!==void 0&&n.preRepairScore!==void 0&&n.postRepairScore<=n.preRepairScore&&e.jsxs("button",{onClick:()=>m(D,n.repairDetails[0].beforeImage),className:"text-xs px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded border border-red-300 transition-colors",children:["‚Ü©Ô∏è ",x==="de"?"Zur√ºcksetzen":"Revert to Original"]})]}),n.postRepairScore!==void 0&&n.preRepairScore!==void 0&&n.postRepairScore<n.preRepairScore&&e.jsxs("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded border border-red-200",children:["‚ö†Ô∏è ",x==="de"?`Bewertung verschlechtert: ${n.preRepairScore}% ‚Üí ${n.postRepairScore}%`:`Score decreased: ${n.preRepairScore}% ‚Üí ${n.postRepairScore}%`]}),n.bboxDetection&&Array.isArray(n.bboxDetection)&&n.bboxDetection.length>0&&e.jsxs("details",{className:"text-sm mb-2",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-700 font-medium hover:text-blue-900",children:["üì¶ ",x==="de"?"Bounding Box Erkennung":"Bounding Box Detection"," (",n.bboxDetection.length,")"]}),e.jsx("div",{className:"mt-3 space-y-2",children:n.bboxDetection.map((u,H)=>e.jsxs("div",{className:`p-3 rounded-lg border ${u.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:`font-medium text-sm ${u.success?"text-green-800":"text-red-800"}`,children:[u.success?"‚úì":"‚úó"," ",u.issue.substring(0,60),u.issue.length>60?"...":""]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${u.severity==="CRITICAL"?"bg-red-200 text-red-800":u.severity==="MAJOR"?"bg-orange-200 text-orange-800":u.severity==="MODERATE"?"bg-yellow-200 text-yellow-800":"bg-gray-200 text-gray-800"}`,children:[u.severity," ‚Ä¢ ",u.type]})]}),u.success&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${u.faceBox?"bg-purple-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-purple-800",children:"Face Box:"}),u.faceBox?e.jsxs("span",{className:"ml-1 font-mono text-purple-600",children:["[",u.faceBox.map(y=>(y*100).toFixed(0)+"%").join(", "),"]"]}):e.jsx("span",{className:"ml-1 text-gray-500 italic",children:"not detected"})]}),e.jsxs("div",{className:`p-2 rounded ${u.bodyBox?"bg-blue-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-blue-800",children:"Body Box:"}),u.bodyBox?e.jsxs("span",{className:"ml-1 font-mono text-blue-600",children:["[",u.bodyBox.map(y=>(y*100).toFixed(0)+"%").join(", "),"]"]}):e.jsx("span",{className:"ml-1 text-gray-500 italic",children:"not detected"})]})]}),u.label&&u.label!==u.issue&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Detected as:"})," ",u.label]}),u.usage&&e.jsxs("div",{className:"mt-1 text-xs text-gray-400",children:["Tokens: ",u.usage.input_tokens," in / ",u.usage.output_tokens," out"]})]},H))})]}),e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["üìä ",x==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-red-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-red-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 px-2 py-0.5 rounded",children:"Before"}),e.jsxs("span",{className:"text-red-600",children:[n.preRepairScore,"%"]})]}),e.jsx(st,{data:n.preRepairEval||n.reasoning,language:x,title:`evaluation-before-attempt-${D}`})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-green-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded",children:"After"}),e.jsxs("span",{className:"text-green-600",children:[n.postRepairScore,"%"]})]}),e.jsx(st,{data:n.postRepairEval,language:x,title:`evaluation-after-attempt-${D}`})]})]})]}),n.repairDetails&&n.repairDetails.length>0&&e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["üñºÔ∏è ",x==="de"?"Reparatur-Details":"Repair Details"," (",n.repairDetails.length,")"]}),e.jsx("div",{className:"mt-3 space-y-3",children:n.repairDetails.map((u,H)=>{var y,C;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-medium text-amber-800 text-base",children:u.description}),u.modelId&&e.jsx("span",{className:"text-xs text-gray-400 bg-gray-100 px-2 py-0.5 rounded",children:u.modelId})]}),e.jsxs("details",{className:"mb-3",children:[e.jsxs("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700 text-sm flex items-center gap-2",children:["Show fix prompt",e.jsxs("button",{onClick:E=>{E.stopPropagation(),Ps(u.fullPrompt||u.fixPrompt||"",`fix-prompt-${H}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(Ve,{size:10})," Download"]})]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded text-sm text-gray-600 whitespace-pre-wrap font-mono max-h-[500px] overflow-auto",children:u.fullPrompt||u.fixPrompt})]}),e.jsxs("div",{className:"flex gap-4 items-start",children:[u.beforeImage&&u.maskImage?e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before + Mask"}),e.jsx(ha,{beforeImage:u.beforeImage,maskImage:u.maskImage,onEnlarge:(E,q)=>R({src:E,title:q})})]}):u.beforeImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before"}),e.jsx("img",{src:u.beforeImage,alt:"Before",className:"w-32 h-32 object-contain border rounded cursor-pointer hover:ring-2 hover:ring-amber-400",onClick:()=>R({src:u.beforeImage,title:"Before Repair"})})]}),e.jsx("div",{className:"flex items-center h-32 text-gray-400 text-2xl",children:"‚Üí"}),u.afterImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"After"}),e.jsx("img",{src:u.afterImage,alt:"After",className:"w-32 h-32 object-contain border-2 border-green-300 rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>R({src:u.afterImage,title:"After Repair"})})]})]}),u.verification&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded border text-sm",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"üîç Verification:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.verification.lpips&&e.jsxs("div",{className:`p-2 rounded ${u.verification.lpips.changed?"bg-green-100":"bg-yellow-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LPIPS: "}),e.jsx("span",{className:u.verification.lpips.changed?"text-green-700":"text-yellow-700",children:(y=u.verification.lpips.lpipsScore)==null?void 0:y.toFixed(4)}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",u.verification.lpips.changed?"‚úì changed":"‚ö† unchanged",")"]})]}),u.verification.llm&&e.jsxs("div",{className:`p-2 rounded ${u.verification.llm.fixed?"bg-green-100":"bg-red-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LLM: "}),e.jsx("span",{className:u.verification.llm.fixed?"text-green-700":"text-red-700",children:u.verification.llm.fixed?"‚úì Fixed":"‚úó Not fixed"}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",Math.round(u.verification.llm.confidence*100),"%)"]})]})]}),((C=u.verification.llm)==null?void 0:C.explanation)&&e.jsx("div",{className:"mt-2 text-gray-600 text-sm italic",children:u.verification.llm.explanation})]})]},H)})})]})]}),(n.type==="grid_repair"||n.type==="grid_repair_failed")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[n.gridTotalIssues!==void 0&&e.jsxs("span",{className:"text-violet-700",children:[x==="de"?"Probleme:":"Issues:"," ",n.gridTotalIssues]}),n.gridFixedCount!==void 0&&e.jsxs("span",{className:"text-green-600",children:["‚úì ",x==="de"?"Behoben:":"Fixed:"," ",n.gridFixedCount]}),n.gridFailedCount!==void 0&&n.gridFailedCount>0&&e.jsxs("span",{className:"text-red-600",children:["‚úó ",x==="de"?"Fehlgeschlagen:":"Failed:"," ",n.gridFailedCount]})]}),n.type==="grid_repair_failed"&&n.failReason&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-100 p-2 rounded border border-red-200",children:["‚ö†Ô∏è ",x==="de"?"Fehlergrund:":"Failure reason:"," ",n.failReason==="no_repairs_made"?x==="de"?"Keine Reparaturen durchgef√ºhrt":"No repairs were made":n.failReason==="no_image_data"?x==="de"?"Keine Bilddaten zur√ºckgegeben":"No image data returned":n.failReason==="image_too_small"?x==="de"?"Zur√ºckgegebenes Bild zu klein/ung√ºltig":"Returned image too small/invalid":n.failReason==="image_unchanged"?x==="de"?"Bild wurde nicht ver√§ndert":"Image was not changed":n.failReason]}),(()=>{var H;const u=n.annotatedOriginal||((H=b[D])==null?void 0:H.annotatedOriginal);return u?e.jsxs("details",{className:"text-sm",open:!0,children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["üìç ",x==="de"?"Schritt 1: Erkannte Probleme":"Step 1: Detected Issues"]}),e.jsxs("div",{className:"mt-3 bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:[x==="de"?"Originalbild mit markierten Problembereichen":"Original image with marked issue regions",e.jsxs("span",{className:"ml-2 text-gray-400",children:["(üî¥ ",x==="de"?"kritisch":"critical",", üü† ",x==="de"?"wichtig":"major",", üü° ",x==="de"?"gering":"minor",")"]})]}),e.jsx("img",{src:`data:image/jpeg;base64,${u}`,alt:"Annotated original",className:"max-w-md border rounded cursor-pointer hover:ring-2 hover:ring-violet-400",onClick:()=>R({src:`data:image/jpeg;base64,${u}`,title:x==="de"?"Erkannte Probleme":"Detected Issues"})})]})]}):n.hasAnnotatedOriginal&&p&&F!==void 0?e.jsx("button",{onClick:()=>z(D),disabled:w.has(D),className:"text-sm px-3 py-2 bg-violet-100 hover:bg-violet-200 text-violet-700 rounded border border-violet-300 flex items-center gap-2 disabled:opacity-50",children:w.has(D)?e.jsxs(e.Fragment,{children:[e.jsx(me,{size:14,className:"animate-spin"})," Loading..."]}):e.jsx(e.Fragment,{children:"üìç Load Detected Issues"})}):null})(),e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["üìä ",x==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-red-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-red-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 px-2 py-0.5 rounded",children:"Before"}),e.jsxs("span",{className:"text-red-600",children:[n.preRepairScore,"%"]})]}),e.jsx(st,{data:n.preRepairEval||n.reasoning,language:x,title:`evaluation-before-grid-${D}`})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-green-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded",children:"After"}),e.jsxs("span",{className:"text-green-600",children:[n.postRepairScore,"%"]})]}),e.jsx(st,{data:n.postRepairEval,language:x,title:`evaluation-after-grid-${D}`})]})]})]}),(()=>{var H,y;const u=n.grids||((H=b[D])==null?void 0:H.grids);return u&&u.length>0?e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["üî≤ ",x==="de"?"Grid-Details":"Grid Details"," (",u.length," ",u.length===1?"grid":"grids",")"]}),e.jsx("div",{className:"mt-3 space-y-4",children:u.map((C,E)=>{var q,Q;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("span",{className:"font-medium text-violet-800",children:["Grid"," ",C.batchNum||E+1]}),((q=C.manifest)==null?void 0:q.issues)&&e.jsxs("span",{className:"text-xs text-gray-500",children:[C.manifest.issues.length," ",x==="de"?"Regionen":"regions"]})]}),((Q=C.manifest)==null?void 0:Q.issues)&&C.manifest.issues.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-violet-50 rounded text-sm",children:[e.jsx("div",{className:"font-medium text-violet-800 mb-1",children:x==="de"?"Zu reparierende Probleme:":"Issues to repair:"}),e.jsx("div",{className:"space-y-1",children:C.manifest.issues.map((A,ne)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-mono font-bold text-violet-600 min-w-[20px]",children:[A.letter,":"]}),e.jsx("span",{className:"text-gray-700",children:A.fixInstruction||A.description||"Unknown issue"})]},ne))})]}),C.prompt&&e.jsxs("details",{className:"mb-3",children:[e.jsxs("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700 text-sm flex items-center gap-2",children:[x==="de"?"Reparatur-Prompt anzeigen":"Show repair prompt",e.jsxs("button",{onClick:A=>{A.stopPropagation(),Ps(C.prompt||"",`grid-repair-prompt-${E}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(Ve,{size:10})," Download"]})]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded text-sm text-gray-600 whitespace-pre-wrap font-mono max-h-[500px] overflow-auto",children:C.prompt})]}),e.jsxs("div",{className:"flex gap-4 items-start flex-wrap",children:[C.original&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:x==="de"?"Original-Grid":"Input Grid"}),e.jsx("img",{src:C.original.startsWith("data:")?C.original:`data:image/png;base64,${C.original}`,alt:"Input grid",className:"max-w-xs border rounded cursor-pointer hover:ring-2 hover:ring-violet-400",onClick:()=>R({src:C.original.startsWith("data:")?C.original:`data:image/png;base64,${C.original}`,title:x==="de"?"Original-Grid":"Input Grid"})})]}),C.original&&C.repaired&&e.jsx("div",{className:"flex items-center self-center text-gray-400 text-2xl",children:"‚Üí"}),C.repaired&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:x==="de"?"Repariertes Grid":"Repaired Grid"}),e.jsx("img",{src:C.repaired.startsWith("data:")?C.repaired:`data:image/png;base64,${C.repaired}`,alt:"Repaired grid",className:"max-w-xs border-2 border-green-300 rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>R({src:C.repaired.startsWith("data:")?C.repaired:`data:image/png;base64,${C.repaired}`,title:x==="de"?"Repariertes Grid":"Repaired Grid"})})]})]}),C.repairs&&C.repairs.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"font-medium text-violet-800 mb-2",children:["‚úÖ ",x==="de"?"Verifizierungsergebnisse":"Verification Results"]}),e.jsx("div",{className:"space-y-2",children:C.repairs.map((A,ne)=>{var B,Z,te,le,se,o,de,Is,ls,qe,He,Ne;return e.jsxs("div",{className:`mb-3 p-3 rounded-lg border ${(B=A.verification)!=null&&B.accepted?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"font-mono font-bold text-xl text-violet-600 w-8",children:A.letter}),e.jsxs("div",{className:"flex items-center gap-2",children:[A.originalThumbnail&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:x==="de"?"Vorher":"Before"}),e.jsx("img",{src:`data:image/jpeg;base64,${A.originalThumbnail}`,alt:"Before",className:"w-16 h-16 object-contain cursor-pointer hover:ring-2 hover:ring-violet-400 rounded border",onClick:()=>R({src:`data:image/jpeg;base64,${A.originalThumbnail}`,title:`${A.letter}: Before`})})]}),A.repairedThumbnail&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:x==="de"?"Nachher":"After"}),e.jsx("img",{src:`data:image/jpeg;base64,${A.repairedThumbnail}`,alt:"After",className:`w-16 h-16 object-contain cursor-pointer hover:ring-2 rounded border ${(Z=A.verification)!=null&&Z.accepted?"border-green-300":"border-red-300"}`,onClick:()=>R({src:`data:image/jpeg;base64,${A.repairedThumbnail}`,title:`${A.letter}: After`})})]}),A.diffImage&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Diff"}),e.jsx("img",{src:`data:image/jpeg;base64,${A.diffImage}`,alt:"Diff",className:"w-16 h-16 object-contain cursor-pointer hover:ring-2 hover:ring-purple-400 rounded border",onClick:()=>R({src:`data:image/jpeg;base64,${A.diffImage}`,title:`${A.letter}: Diff`})})]})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsx("span",{className:`text-2xl ${(te=A.verification)!=null&&te.accepted?"text-green-600":"text-red-600"}`,children:(le=A.verification)!=null&&le.accepted?"‚úì":"‚úó"}),e.jsxs("span",{className:`text-lg font-medium ${(((se=A.verification)==null?void 0:se.confidence)??0)>=.7?"text-green-600":(((o=A.verification)==null?void 0:o.confidence)??0)>=.5?"text-yellow-600":"text-red-600"}`,children:[Math.round((((de=A.verification)==null?void 0:de.confidence)??0)*100),"%"]})]})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-xs mr-2 ${A.severity==="critical"?"bg-red-200 text-red-800":A.severity==="major"?"bg-orange-200 text-orange-800":"bg-yellow-200 text-yellow-800"}`,children:A.type||"unknown"}),e.jsx("span",{className:"text-gray-700",children:A.description})]}),A.fixInstruction&&e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Fix:"})," ",A.fixInstruction]}),(((Is=A.verification)==null?void 0:Is.explanation)||((ls=A.verification)==null?void 0:ls.reason))&&e.jsxs("div",{className:`mt-2 text-sm p-2 rounded ${(qe=A.verification)!=null&&qe.accepted?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:"font-medium",children:x==="de"?"Ergebnis:":"Result:"})," ",((He=A.verification)==null?void 0:He.explanation)||((Ne=A.verification)==null?void 0:Ne.reason)]})]},ne)})})]})]},E)})})]}):n.hasGrids&&p&&F!==void 0&&!((y=b[D])!=null&&y.grids)?e.jsx("button",{onClick:()=>z(D),disabled:w.has(D),className:"text-sm px-3 py-2 bg-violet-100 hover:bg-violet-200 text-violet-700 rounded border border-violet-300 flex items-center gap-2 disabled:opacity-50",children:w.has(D)?e.jsxs(e.Fragment,{children:[e.jsx(me,{size:14,className:"animate-spin"})," Loading..."]}):e.jsxs(e.Fragment,{children:["üî≤ Load Grid Details (",n.gridsCount||"?"," grids)"]})}):null})()]}),n.type!=="auto_repair"&&n.type!=="grid_repair"&&n.type!=="grid_repair_failed"&&n.prompt&&e.jsxs("details",{className:"text-sm mb-2",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-700 font-medium hover:text-blue-900 flex items-center gap-2",children:["üì§ ",x==="de"?"Eingabe-Prompt":"Input Prompt",e.jsxs("button",{onClick:u=>{u.stopPropagation(),Ps(n.prompt||"",`prompt-attempt-${n.attempt}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(Ve,{size:10})," Download"]})]}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap bg-blue-50 p-3 rounded text-sm overflow-auto max-h-[500px] font-mono border border-blue-200",children:n.prompt})]}),n.type!=="auto_repair"&&n.type!=="grid_repair"&&n.type!=="grid_repair_failed"&&n.reasoning?e.jsxs("details",{className:"text-sm text-gray-600 mb-2",children:[e.jsxs("summary",{className:"cursor-pointer font-medium",children:["üì• ",x==="de"?"Bewertungs-Feedback":"Evaluation Feedback"]}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap bg-gray-50 p-3 rounded text-sm overflow-auto max-h-[500px] font-mono",children:n.reasoning})]}):n.type!=="auto_repair"&&n.type!=="grid_repair"&&n.type!=="grid_repair_failed"&&n.score===0&&e.jsx("div",{className:"text-sm text-gray-500 italic mb-2",children:x==="de"?"Qualit√§tsbewertung fehlgeschlagen":x==="fr"?"√âvaluation de qualit√© √©chou√©e":"Quality evaluation failed"}),(()=>{var H;if(n.type==="auto_repair"||n.type==="grid_repair"||n.type==="grid_repair_failed"||n.type==="bbox_detection_only")return null;const u=n.imageData||((H=b[D])==null?void 0:H.imageData);return u?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:x==="de"?"Generiertes Bild":"Generated Image"}),e.jsx("img",{src:u,alt:`Attempt ${n.attempt}`,className:`w-48 h-48 object-contain rounded border cursor-pointer hover:ring-2 ${D===T.length-1?"border-green-300 hover:ring-green-400":"border-gray-200 opacity-75 hover:ring-gray-400"}`,onClick:()=>R({src:u,title:`${x==="de"?"Versuch":"Attempt"} ${n.attempt}`})})]}):n.type==="generation"&&p&&F!==void 0&&!b[D]?e.jsx("button",{onClick:()=>z(D),disabled:w.has(D),className:"mt-2 text-sm px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded border border-blue-300 flex items-center gap-2 disabled:opacity-50",children:w.has(D)?e.jsxs(e.Fragment,{children:[e.jsx(me,{size:14,className:"animate-spin"})," Loading..."]}):e.jsxs(e.Fragment,{children:["üñºÔ∏è ",x==="de"?"Bild laden":"Load Image"]})}):null})(),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(n.timestamp).toLocaleTimeString()})]},D)})})()})]})]})}function ua(d){if(!d||d.length===0)return{bboxDetection:null,bboxOverlayImage:null,hasBboxOverlay:!1};const $=d.find(m=>m.type==="bbox_detection_only"&&m.bboxDetection)||d.find(m=>m.bboxDetection);if(!$)return{bboxDetection:null,bboxOverlayImage:null,hasBboxOverlay:!1};const x=$.bboxDetection;return x&&typeof x=="object"&&"figures"in x?{bboxDetection:x,bboxOverlayImage:$.bboxOverlayImage||null,hasBboxOverlay:!!$.hasBboxOverlay||!!$.bboxOverlayImage}:{bboxDetection:null,bboxOverlayImage:null,hasBboxOverlay:!1}}function ba(d,$){const x=new Blob([d],{type:"text/plain;charset=utf-8"}),m=URL.createObjectURL(x),p=document.createElement("a");p.href=m,p.download=$,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(m)}function $s({retryHistory:d,bboxDetection:$,bboxOverlayImage:x,language:m,storyId:p,pageNumber:F,coverType:S}){var u,H;const[R,b]=P.useState(null),[N,w]=P.useState(null),[f,z]=P.useState(!1),W=ua(d),h=$||W.bboxDetection,c=x||W.bboxOverlayImage,T=!!x||W.hasBboxOverlay;if(!h)return null;const n=((u=h.figures)==null?void 0:u.length)||0,D=((H=h.objects)==null?void 0:H.length)||0,G=async()=>{if(!(!p||f)&&!(!S&&F===void 0)){z(!0);try{const y=localStorage.getItem("auth_token"),C=new URLSearchParams({field:"bboxOverlay"});if(S)C.set("cover",S);else{C.set("page",String(F)),C.set("type","retry");const q=(d==null?void 0:d.findIndex(Q=>Q.type==="bbox_detection_only"&&Q.bboxDetection||Q.bboxDetection))??0;C.set("index",String(q))}const E=await fetch(`/api/stories/${p}/dev-image?${C}`,{headers:y?{Authorization:`Bearer ${y}`}:{}});if(E.ok){const q=await E.json();q.bboxOverlayImage&&w(q.bboxOverlayImage)}}catch(y){console.error("Failed to load bbox overlay:",y)}finally{z(!1)}}},U=c||N;return e.jsxs(e.Fragment,{children:[R&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>b(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("div",{className:"absolute -top-8 left-0 text-white text-sm",children:R.title}),e.jsx("img",{src:R.src,alt:R.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute -top-8 right-0 text-white hover:text-gray-300",onClick:()=>b(null),children:"‚úï Close"})]})}),e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-blue-700 flex items-center justify-between",children:e.jsxs("span",{className:"flex items-center gap-2",children:["üì¶ ",m==="de"?"Objekterkennung":"Object Detection",e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded",children:[n," ",m==="de"?"Figuren":"figures",","," ",D," ",m==="de"?"Objekte":"objects"]}),h.positionMismatches&&h.positionMismatches.length>0&&e.jsxs("span",{className:"text-xs bg-yellow-200 text-yellow-800 px-1.5 py-0.5 rounded",children:["‚ö†Ô∏è ",h.positionMismatches.length," ",m==="de"?"Abweichungen":"mismatches"]}),h.missingCharacters&&h.missingCharacters.length>0&&e.jsxs("span",{className:"text-xs bg-red-200 text-red-800 px-1.5 py-0.5 rounded",children:["‚ùå ",h.missingCharacters.length," ",m==="de"?"Char fehlt":"char missing"]}),h.missingObjects&&h.missingObjects.length>0&&e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded",children:["‚ö†Ô∏è ",h.missingObjects.length," ",m==="de"?"Obj fehlt":"obj missing"]}),h.matchedObjects&&h.matchedObjects.length>0&&e.jsxs("span",{className:"text-xs bg-green-200 text-green-800 px-1.5 py-0.5 rounded",children:["‚úì ",h.matchedObjects.length," ",m==="de"?"Obj gefunden":"obj matched"]})]})}),e.jsxs("div",{className:"mt-3 space-y-3",children:[U?e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:[m==="de"?"Erkannte Regionen":"Detected Regions",e.jsx("span",{className:"ml-2 text-gray-400",children:"(üü¢ Body, üîµ Face, üü† Object, üü£ Matched)"})]}),e.jsx("img",{src:U,alt:"Bbox overlay",className:"max-w-md border rounded cursor-pointer hover:ring-2 hover:ring-blue-400",onClick:()=>b({src:U,title:m==="de"?"Erkannte Regionen":"Detected Regions"})})]}):T&&p&&F!==void 0?e.jsx("button",{onClick:G,disabled:f,className:"text-sm px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded border border-blue-300 flex items-center gap-2 disabled:opacity-50",children:f?e.jsxs(e.Fragment,{children:[e.jsx(me,{size:14,className:"animate-spin"})," ",m==="de"?"L√§dt...":"Loading..."]}):e.jsxs(e.Fragment,{children:["üì¶ ",m==="de"?"Erkannte Regionen laden":"Load Detected Regions"]})}):null,h.expectedCharacters&&h.expectedCharacters.length>0&&e.jsxs("details",{className:"bg-violet-50 p-3 rounded border border-violet-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-violet-800",children:["üë• ",m==="de"?"Erwartete Charaktere":"Expected Characters"," (",h.expectedCharacters.length,")"]}),e.jsx("div",{className:"mt-2 grid grid-cols-1 gap-2 text-sm",children:h.expectedCharacters.map((y,C)=>e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-medium text-violet-700",children:y.name}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[y.description,y.position&&e.jsxs("span",{className:"ml-2 text-violet-500",children:["@ ",y.position]})]})]},C))})]}),h.expectedPositions&&Object.keys(h.expectedPositions).length>0&&e.jsxs("div",{className:"bg-purple-50 p-3 rounded border border-purple-200",children:[e.jsxs("div",{className:"font-medium text-purple-800 mb-2",children:["üìç ",m==="de"?"Erwartete Positionen":"Expected Positions"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:Object.entries(h.expectedPositions).map(([y,C])=>e.jsxs("div",{className:"bg-white p-2 rounded border flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-purple-700",children:y}),e.jsx("span",{className:"text-gray-600 text-xs",children:C})]},y))})]}),h.positionMismatches&&h.positionMismatches.length>0&&e.jsxs("div",{className:"bg-yellow-50 p-3 rounded border border-yellow-300",children:[e.jsxs("div",{className:"font-medium text-yellow-800 mb-2",children:["‚ö†Ô∏è ",m==="de"?"Positionsabweichungen":"Position Mismatches"," (",h.positionMismatches.length,")"]}),e.jsx("div",{className:"space-y-2",children:h.positionMismatches.map((y,C)=>e.jsxs("div",{className:"text-sm bg-white p-2 rounded border border-yellow-200",children:[e.jsx("div",{className:"font-medium text-yellow-700",children:y.character}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1 flex gap-3",children:[e.jsxs("span",{children:[m==="de"?"Erwartet":"Expected",": ",e.jsx("span",{className:"font-medium text-purple-600",children:y.expected}),e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",y.expectedLCR,")"]})]}),e.jsx("span",{className:"text-gray-400",children:"‚Üí"}),e.jsxs("span",{children:[m==="de"?"Erkannt":"Actual",": ",e.jsx("span",{className:"font-medium text-orange-600",children:y.actual})]})]})]},C))})]}),h.missingCharacters&&h.missingCharacters.length>0&&e.jsxs("div",{className:"bg-red-50 p-3 rounded border border-red-300",children:[e.jsxs("div",{className:"font-medium text-red-800 mb-2",children:["‚ùå ",m==="de"?"Fehlende Charaktere":"Missing Characters"," (",h.missingCharacters.length,")"]}),e.jsx("div",{className:"text-sm text-red-700",children:m==="de"?"Diese Charaktere wurden in der Szene erwartet, aber nicht im Bild gefunden:":"These characters were expected in the scene but not detected in the image:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:h.missingCharacters.map((y,C)=>e.jsx("span",{className:"bg-white px-2 py-1 rounded border border-red-200 text-sm font-medium text-red-700",children:y},C))})]}),h.expectedObjects&&h.expectedObjects.length>0&&e.jsxs("div",{className:"bg-indigo-50 p-3 rounded border border-indigo-200",children:[e.jsxs("div",{className:"font-medium text-indigo-800 mb-2",children:["üéØ ",m==="de"?"Erwartete Objekte":"Expected Objects"," (",h.expectedObjects.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:h.expectedObjects.map((y,C)=>{var Q,A;const E=(Q=h.matchedObjects)==null?void 0:Q.find(ne=>ne.expected===y),q=(A=h.missingObjects)==null?void 0:A.includes(y);return e.jsxs("div",{className:`bg-white p-2 rounded border flex justify-between items-center ${q?"border-red-300":E?"border-green-300":""}`,children:[e.jsxs("span",{className:`font-medium ${q?"text-red-600":E?"text-green-600":"text-indigo-700"}`,children:[q?"‚ùå":E?"‚úì":"‚Ä¢"," ",y]}),E&&e.jsxs("span",{className:"text-xs text-gray-500 truncate ml-2",children:["‚Üí ",E.matched]})]},C)})})]}),h.missingObjects&&h.missingObjects.length>0&&!h.expectedObjects&&e.jsxs("div",{className:"bg-amber-50 p-3 rounded border border-amber-300",children:[e.jsxs("div",{className:"font-medium text-amber-800 mb-2",children:["‚ö†Ô∏è ",m==="de"?"Fehlende Objekte":"Missing Objects"," (",h.missingObjects.length,")"]}),e.jsx("div",{className:"text-sm text-amber-700",children:m==="de"?"Diese Objekte wurden in der Szene erwartet, aber nicht im Bild gefunden:":"These objects were expected in the scene but not detected in the image:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:h.missingObjects.map((y,C)=>e.jsx("span",{className:"bg-white px-2 py-1 rounded border border-amber-200 text-sm font-medium text-amber-700",children:y},C))})]}),h.figures&&h.figures.length>0&&e.jsxs("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[e.jsxs("div",{className:"font-medium text-green-800 mb-2",children:[m==="de"?"Figuren":"Figures"," (",h.figures.length,")",h.unknownFigures!==void 0&&h.unknownFigures>0&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 text-gray-700 px-1.5 py-0.5 rounded",children:[h.unknownFigures," ",m==="de"?"unbekannt":"unknown"]})]}),e.jsx("div",{className:"space-y-2",children:h.figures.map((y,C)=>{const E=y.name&&y.name!=="UNKNOWN",q=y.confidence==="high"?"text-green-600":y.confidence==="medium"?"text-yellow-600":"text-orange-600",Q=y.confidence==="high"?"‚òÖ":y.confidence==="medium"?"‚óÜ":"‚óã";return e.jsxs("div",{className:`text-sm bg-white p-2 rounded border ${E?"border-green-300":"border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`font-medium ${E?"text-green-700":"text-gray-600"}`,children:E?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:q,children:Q})," ",y.name]}):e.jsxs(e.Fragment,{children:["? ",y.label||`Figure ${C+1}`]})}),E&&y.confidence&&e.jsx("span",{className:`text-xs ${q}`,children:y.confidence})]}),E&&y.label&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:y.label}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1 grid grid-cols-2 gap-2",children:[y.bodyBox&&e.jsxs("span",{children:["Body: [",y.bodyBox.map(A=>(A*100).toFixed(0)+"%").join(", "),"]"]}),y.faceBox&&e.jsxs("span",{children:["Face: [",y.faceBox.map(A=>(A*100).toFixed(0)+"%").join(", "),"]"]}),y.position&&e.jsxs("span",{children:["Pos: ",y.position]})]})]},C)})})]}),h.objects&&h.objects.length>0&&e.jsxs("div",{className:"bg-orange-50 p-3 rounded border border-orange-200",children:[e.jsxs("div",{className:"font-medium text-orange-800 mb-2",children:[m==="de"?"Objekte":"Objects"," (",h.objects.length,")"]}),e.jsx("div",{className:"space-y-2",children:h.objects.map((y,C)=>{const E=!!y.name,q=y.found!==!1;return e.jsxs("div",{className:`text-sm bg-white p-2 rounded border ${E&&q?"border-green-300":E&&!q?"border-red-300":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`font-medium ${E&&q?"text-green-700":E&&!q?"text-red-600":"text-orange-700"}`,children:E?e.jsxs(e.Fragment,{children:[q?"‚úì":"‚úó"," ",y.name]}):y.label||`Object ${C+1}`}),E&&e.jsx("span",{className:`text-xs ${q?"text-green-600":"text-red-600"}`,children:q?m==="de"?"gefunden":"found":m==="de"?"fehlt":"missing"})]}),E&&y.label&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:y.label}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[y.bodyBox&&e.jsxs("span",{children:["Box: [",y.bodyBox.map(Q=>(Q*100).toFixed(0)+"%").join(", "),"]"]}),y.position&&e.jsxs("span",{className:"ml-2",children:["Pos: ",y.position]})]})]},C)})})]}),h.characterDescriptions&&Object.keys(h.characterDescriptions).length>0&&e.jsxs("details",{className:"bg-cyan-50 p-3 rounded border border-cyan-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-cyan-800",children:["üë§ ",m==="de"?"Charakter-Beschreibungen":"Character Descriptions"," (",Object.keys(h.characterDescriptions).length,")"]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:Object.entries(h.characterDescriptions).map(([y,C])=>e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("span",{className:"font-medium text-cyan-700",children:y}),e.jsxs("span",{className:"text-gray-600 ml-2",children:[C.genderTerm||C.gender||"?",", ",C.age?`${C.age}y`:"?",C.isChild?" (child)":C.isChild===!1?" (adult)":""]})]},y))})]}),h.rawPrompt&&e.jsxs("details",{className:"bg-gray-50 p-3 rounded border border-gray-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-gray-700",children:["üìù ",m==="de"?"Bbox-Prompt":"Bbox Prompt"]}),e.jsx("pre",{className:"mt-2 text-xs bg-white p-2 rounded border overflow-x-auto whitespace-pre-wrap max-h-48 overflow-y-auto",children:h.rawPrompt})]}),h.rawResponse&&e.jsxs("details",{className:"bg-gray-50 p-3 rounded border border-gray-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-gray-700",children:["üì§ ",m==="de"?"Bbox-Antwort":"Bbox Response"]}),e.jsx("pre",{className:"mt-2 text-xs bg-white p-2 rounded border overflow-x-auto whitespace-pre-wrap max-h-64 overflow-y-auto",children:h.rawResponse})]}),e.jsxs("button",{onClick:()=>ba(JSON.stringify(h,null,2),`object-detection-page-${F}.json`),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-1 bg-blue-50 rounded hover:bg-blue-100",children:[e.jsx(Ve,{size:12})," ",m==="de"?"JSON herunterladen":"Download JSON"]})]})]})]})}function ks({referencePhotos:d,landmarkPhotos:$,visualBibleGrid:x,hasVisualBibleGrid:m,language:p,storyId:F,pageNumber:S}){var se;const[R,b]=P.useState(null),[N,w]=P.useState(null),[f,z]=P.useState(null),[W,h]=P.useState(null),[c,T]=P.useState(!1),[n,D]=P.useState(null),G=d==null?void 0:d.some(o=>o.hasPhoto&&!o.photoUrl),U=$==null?void 0:$.some(o=>o.hasPhoto&&!o.photoData),u=m&&!x,H=P.useCallback(async()=>{if(!(!F||!S||c)&&!(!G&&!U&&!u)){T(!0),D(null);try{if(G||u){const o=await tt.getDevImage(F,S,"reference");o!=null&&o.referencePhotos&&w(o.referencePhotos),o!=null&&o.visualBibleGrid&&h(o.visualBibleGrid)}if(U){const o=await tt.getDevImage(F,S,"landmark");o!=null&&o.landmarkPhotos&&z(o.landmarkPhotos)}}catch(o){D(o instanceof Error?o.message:"Failed to load images")}finally{T(!1)}}},[F,S,c,G,U,u]),y=N||d,C=f||$,E=W||x,q=y&&y.length>0,Q=C&&C.length>0,A=!!E||m;if(!q&&!Q&&!A)return null;const ne=((d==null?void 0:d.length)||0)+(($==null?void 0:$.length)||0)+(A?1:0),B=o=>{switch(o){case"bodyNoBg":case"body-no-bg":return p==="de"?"Ganzk√∂rper (freigestellt)":p==="fr"?"Corps entier (d√©tour√©)":"Full body (no bg)";case"body":return p==="de"?"Ganzk√∂rper":p==="fr"?"Corps entier":"Full body";case"face":return p==="de"?"Gesicht":p==="fr"?"Visage":"Face only";case"clothing-winter":return p==="de"?"Winter-Avatar":p==="fr"?"Avatar hiver":"Winter avatar";case"clothing-summer":return p==="de"?"Sommer-Avatar":p==="fr"?"Avatar √©t√©":"Summer avatar";case"clothing-formal":return p==="de"?"Formell-Avatar":p==="fr"?"Avatar formel":"Formal avatar";case"clothing-standard":return p==="de"?"Standard-Avatar":p==="fr"?"Avatar standard":"Standard avatar";case"none":return p==="de"?"Kein Foto":p==="fr"?"Pas de photo":"No photo";default:return o}},Z=o=>{switch(o){case"bodyNoBg":case"body-no-bg":return"bg-green-100 text-green-700 border-green-300";case"body":return"bg-blue-100 text-blue-700 border-blue-300";case"face":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"clothing-winter":return"bg-cyan-100 text-cyan-700 border-cyan-300";case"clothing-summer":return"bg-orange-100 text-orange-700 border-orange-300";case"clothing-formal":return"bg-purple-100 text-purple-700 border-purple-300";case"clothing-standard":return"bg-teal-100 text-teal-700 border-teal-300";case"none":return"bg-red-100 text-red-700 border-red-300";default:return"bg-gray-100 text-gray-700 border-gray-300"}},te=(se=y==null?void 0:y.find(o=>o.clothingCategory))==null?void 0:se.clothingCategory,le=o=>{if(!o)return"";switch(o){case"winter":return p==="de"?"Winter":p==="fr"?"Hiver":"Winter";case"summer":return p==="de"?"Sommer":p==="fr"?"√ât√©":"Summer";case"formal":return p==="de"?"Formell":p==="fr"?"Formel":"Formal";case"standard":return"Standard";default:return o}};return e.jsxs("details",{className:"bg-pink-50 border border-pink-300 rounded-lg p-3",onToggle:o=>{o.target.open&&(G||U||u)&&H()},children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-900 flex items-center gap-2",children:[e.jsx("span",{children:"üì∏"}),p==="de"?"Referenzfotos":p==="fr"?"Photos de r√©f√©rence":"Reference Photos",e.jsxs("span",{className:"text-xs text-pink-600",children:["(",ne,")"]}),te&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-pink-200 text-pink-800 text-xs rounded",children:["üëï ",le(te)]}),Q&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-amber-200 text-amber-800 text-xs rounded",children:["üìç ",C.length," ",p==="de"?"Wahrzeichen":"Landmark"]}),A&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-indigo-200 text-indigo-800 text-xs rounded",children:"üî≤ VB Grid"}),c&&e.jsx("span",{className:"ml-2 text-xs text-gray-500 animate-pulse",children:"Loading..."})]}),n&&e.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-50 p-2 rounded",children:n}),q&&e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2",children:y.map((o,de)=>e.jsxs("div",{className:"bg-white rounded-lg p-2 border border-pink-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:o.name}),o.photoType&&e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap ${Z(o.photoType)}`,children:B(o.photoType)})]}),o.photoUrl?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:o.photoUrl,alt:`${o.name} - ${B(o.photoType||"unknown")}`,className:`w-full max-h-32 object-contain rounded border bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity ${o.isStyled?"border-purple-400 ring-2 ring-purple-200":"border-gray-200"}`,onClick:()=>b(o.photoUrl),title:"Click to enlarge"}),o.isStyled&&e.jsx("span",{className:"absolute top-1 right-1 px-1 py-0.5 text-[9px] font-bold bg-purple-500 text-white rounded",children:"üé® STYLED"})]}),o.photoHash&&e.jsxs("div",{className:"mt-1 text-[9px] font-mono text-gray-500 bg-gray-100 px-1 py-0.5 rounded text-center",children:["üîê ",o.photoHash]})]}):e.jsx("div",{className:"text-xs text-gray-500 italic py-2 text-center bg-gray-100 rounded",children:p==="de"?"Foto nicht geladen":"Photo not loaded"})]},de))}),Q&&e.jsxs("div",{className:q?"mt-4 pt-3 border-t border-pink-200":"mt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-amber-700 mb-2 flex items-center gap-1",children:["üìç ",p==="de"?"Wahrzeichen-Referenzfotos":p==="fr"?"Photos de monuments":"Landmark Reference Photos"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:C.map((o,de)=>e.jsxs("div",{className:"bg-amber-50 rounded-lg p-2 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:o.name}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap bg-amber-100 text-amber-700 border-amber-300",children:"üìç LANDMARK"})]}),o.photoData?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:o.photoData,alt:`${o.name} landmark`,className:"w-full max-h-32 object-contain rounded border border-amber-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>b(o.photoData),title:"Click to enlarge"})}),o.attribution&&e.jsxs("div",{className:"mt-1 text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 rounded truncate",title:o.attribution,children:["üì∑ ",o.attribution]}),o.source&&e.jsxs("div",{className:"mt-0.5 text-[9px] text-gray-400",children:["Source: ",o.source]})]}):e.jsx("div",{className:"text-xs text-gray-500 italic py-2 text-center bg-gray-100 rounded",children:p==="de"?"Foto nicht geladen":"Photo not loaded"})]},de))})]}),A&&e.jsxs("div",{className:q||Q?"mt-4 pt-3 border-t border-pink-200":"mt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-indigo-700 mb-2 flex items-center gap-1",children:["üî≤ ",p==="de"?"Visual Bible Referenzgitter":p==="fr"?"Grille Visual Bible":"Visual Bible Reference Grid"]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-2 border border-indigo-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800",children:p==="de"?"Kombinierte Referenzen":p==="fr"?"R√©f√©rences combin√©es":"Combined References"}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap bg-indigo-100 text-indigo-700 border-indigo-300",children:"üî≤ VB GRID"})]}),e.jsx("div",{className:"text-[10px] text-gray-500 mb-2",children:p==="de"?"Sekund√§re Charaktere, Tiere, Artefakte, Fahrzeuge und zus√§tzliche Wahrzeichen":p==="fr"?"Personnages secondaires, animaux, artefacts, v√©hicules et monuments suppl√©mentaires":"Secondary characters, animals, artifacts, vehicles, and additional landmarks"}),E?e.jsx("img",{src:E,alt:"Visual Bible Reference Grid",className:"w-full max-h-64 object-contain rounded border border-indigo-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>b(E),title:"Click to enlarge"}):e.jsx("div",{className:"text-xs text-gray-500 italic py-4 text-center bg-gray-100 rounded",children:c?p==="de"?"Wird geladen...":"Loading...":p==="de"?"Bild nicht geladen":"Image not loaded"})]})]}),e.jsx(ia,{src:R,onClose:()=>b(null)})]})}function fa({pageNumber:d,scene:$,onSceneChange:x,onClose:m,onRegenerate:p,isRegenerating:F,imageRegenerationCost:S,characters:R=[],selectedCharacterIds:b=[],onCharacterSelectionChange:N,consistencyRegen:w}){const{language:f}=rt(),[z,W]=P.useState(!1),[h,c]=P.useState(!1),T=n=>{N&&(b.includes(n)?N(b.filter(D=>D!==n)):N([...b,n]))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(oe,{size:20}),f==="de"?`Szene bearbeiten - Seite ${d}`:f==="fr"?`Modifier la sc√®ne - Page ${d}`:`Edit Scene - Page ${d}`]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:f==="de"?"Bearbeiten Sie die Szenenbeschreibung und w√§hlen Sie die Charaktere aus.":f==="fr"?"Modifiez la description de la sc√®ne et s√©lectionnez les personnages.":"Edit the scene description and select the characters."})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[R.length>0&&N&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(jt,{size:16}),f==="de"?"Charaktere in dieser Szene:":f==="fr"?"Personnages dans cette sc√®ne:":"Characters in this scene:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(n=>{const D=b.includes(n.id);return e.jsxs("button",{type:"button",onClick:()=>T(n.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${D?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{className:"font-medium",children:n.name}),D&&e.jsx("span",{className:"text-indigo-500",children:"‚úì"})]},n.id)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:f==="de"?"W√§hlen Sie die Charaktere aus, die im Bild erscheinen sollen.":f==="fr"?"S√©lectionnez les personnages qui doivent appara√Ætre dans l'image.":"Select the characters that should appear in the image."})]}),w&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ta,{className:"text-amber-600",size:20}),e.jsx("h4",{className:"font-semibold text-amber-800",children:f==="de"?"Konsistenz-Korrektur angewendet":f==="fr"?"Correction de coh√©rence appliqu√©e":"Consistency Fix Applied"}),e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded",children:["Score: ",w.score,"%"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-amber-700 mb-2",children:f==="de"?"Behobene Probleme:":f==="fr"?"Probl√®mes corrig√©s:":"Issues Fixed:"}),e.jsx("ul",{className:"text-sm text-amber-900 space-y-1",children:w.issues.map((n,D)=>e.jsxs("li",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[n.type.toUpperCase(),n.characterInvolved&&` (${n.characterInvolved})`,":"]}),e.jsx("span",{className:"text-amber-700 ml-2",children:n.description}),e.jsxs("span",{className:"text-amber-600 ml-2 text-xs",children:["‚Üí ",n.recommendation]})]},D))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1 text-center",children:"Original"}),e.jsx("img",{src:w.originalImage,alt:"Original",className:"w-full rounded-lg border border-gray-300",draggable:!1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-600 mb-1 text-center",children:f==="de"?"Korrigiert":f==="fr"?"Corrig√©":"Fixed"}),e.jsx("img",{src:w.fixedImage,alt:"Fixed",className:"w-full rounded-lg border-2 border-green-500",draggable:!1})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>W(!z),className:"flex items-center gap-1 text-xs text-gray-600 hover:text-gray-800",children:[z?e.jsx(wr,{size:14}):e.jsx(_e,{size:14}),f==="de"?"Original-Prompt":f==="fr"?"Prompt original":"Original Prompt"]}),z&&e.jsx("pre",{className:"text-xs bg-gray-100 p-2 rounded overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:w.originalPrompt}),e.jsxs("button",{onClick:()=>c(!h),className:"flex items-center gap-1 text-xs text-green-600 hover:text-green-800",children:[h?e.jsx(wr,{size:14}):e.jsx(_e,{size:14}),f==="de"?"Korrigierter Prompt (mit Korrekturen)":f==="fr"?"Prompt corrig√© (avec corrections)":"Fixed Prompt (with corrections)"]}),h&&e.jsx("pre",{className:"text-xs bg-green-50 p-2 rounded border border-green-200 overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:w.fixedPrompt})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xs text-gray-400",children:f==="de"?`Korrigiert am ${new Date(w.timestamp).toLocaleString()}`:f==="fr"?`Corrig√© le ${new Date(w.timestamp).toLocaleString()}`:`Fixed at ${new Date(w.timestamp).toLocaleString()}`}),w.clothing&&e.jsxs("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded",children:["üé® ",w.clothing]})]}),w.avatarsUsed&&w.avatarsUsed.length>0&&e.jsxs("div",{className:"mt-3 p-2 bg-blue-50 rounded border border-blue-200",children:[e.jsx("p",{className:"text-xs font-medium text-blue-700 mb-1",children:f==="de"?"Verwendete Avatare:":f==="fr"?"Avatars utilis√©s:":"Avatars used:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.avatarsUsed.map((n,D)=>e.jsxs("span",{className:`text-xs px-2 py-1 rounded ${n.hasPhoto?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:[n.name,n.category&&n.category!=="standard"&&e.jsxs("span",{className:"ml-1 opacity-75",children:["(",n.category,")"]}),!n.hasPhoto&&" ‚ö†Ô∏è"]},D))})]}),w.retryHistory&&w.retryHistory.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(ns,{retryHistory:w.retryHistory,totalAttempts:w.totalAttempts||1,language:f})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:f==="de"?"Szenenbeschreibung:":f==="fr"?"Description de la sc√®ne:":"Scene description:"}),e.jsx("textarea",{value:$,onChange:n=>x(n.target.value),className:"w-full h-40 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y",placeholder:f==="de"?"Beschreiben Sie die Szene...":f==="fr"?"D√©crivez la sc√®ne...":"Describe the scene..."}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:f==="de"?"Tipp: Beschreiben Sie die Aktionen und die Umgebung. Die ausgew√§hlten Charaktere werden automatisch hinzugef√ºgt.":f==="fr"?"Conseil: D√©crivez les actions et l'environnement. Les personnages s√©lectionn√©s seront ajout√©s automatiquement.":"Tip: Describe the actions and the environment. Selected characters will be added automatically."})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:b.length>0&&e.jsx("span",{children:f==="de"?`${b.length} Charakter(e) ausgew√§hlt`:f==="fr"?`${b.length} personnage(s) s√©lectionn√©(s)`:`${b.length} character(s) selected`})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:m,disabled:F,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700 font-medium disabled:opacity-50 order-2 sm:order-1",children:f==="de"?"Abbrechen":f==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:p,disabled:F||!$.trim(),className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 order-1 sm:order-2 ${F||!$.trim()?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:F?e.jsxs(e.Fragment,{children:[e.jsx($e,{size:16,className:"animate-spin"}),f==="de"?"Generiere...":f==="fr"?"G√©n√©ration...":"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{size:16}),f==="de"?"Neu generieren":f==="fr"?"R√©g√©n√©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",S,")"]})]})})]})]})]})})}const ja={frontCover:{en:"Front Cover",de:"Titelseite",fr:"Couverture"},initialPage:{en:"Dedication Page",de:"Widmungsseite",fr:"Page de d√©dicace"},backCover:{en:"Back Cover",de:"R√ºckseite",fr:"Quatri√®me de couverture"}};function kr({pageNumber:d,coverType:$,versions:x,onClose:m,onSelectVersion:p,developerMode:F=!1}){const{language:S}=rt(),R=()=>{if($){const N=ja[$],w=S==="de"?N.de:S==="fr"?N.fr:N.en;return S==="de"?`Bildversionen - ${w}`:S==="fr"?`Versions d'image - ${w}`:`Image Versions - ${w}`}return S==="de"?`Bildversionen - Seite ${d}`:S==="fr"?`Versions d'image - Page ${d}`:`Image Versions - Page ${d}`},b=N=>{$?p($,N):d!==void 0&&p(d,N)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ye,{size:20}),R()]}),e.jsx("button",{onClick:m,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(ke,{size:20})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:x.map((N,w)=>e.jsxs("div",{className:`relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${N.isActive?"border-green-500 ring-2 ring-green-200":"border-gray-200 hover:border-indigo-300"}`,onClick:()=>b(w),children:[e.jsx("img",{src:N.imageData,alt:`Version ${w+1}`,className:"w-full aspect-square object-cover"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:w===0?"Original":`V${w+1}`}),e.jsxs("div",{className:"flex items-center gap-1",children:[F&&N.qualityScore!=null&&e.jsxs("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold ${N.qualityScore>=80?"bg-green-600":N.qualityScore>=60?"bg-yellow-600":"bg-red-600"}`,children:[N.qualityScore,"%"]}),N.isActive&&e.jsx("span",{className:"bg-green-500 px-2 py-0.5 rounded text-[10px] font-bold",children:S==="de"?"Aktiv":S==="fr"?"Actif":"Active"})]})]}),e.jsx("div",{className:"text-[10px] text-gray-300 mt-1",children:new Date(N.createdAt).toLocaleDateString()})]})]},w))}),F&&x.length>1&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-700",children:S==="de"?"Szenen- und Prompt-Vergleich":S==="fr"?"Comparaison de sc√®nes et prompts":"Scene & Prompt Comparison"}),x.map((N,w)=>e.jsxs("details",{className:`rounded-lg p-3 ${N.isActive?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-medium text-gray-700",children:[w===0?"Original":`V${w+1}`,N.isActive&&e.jsx("span",{className:"ml-2 text-green-600 text-xs",children:"(Active)"})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[N.userInput&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-purple-700",children:S==="de"?"Benutzer-Eingabe:":S==="fr"?"Entr√©e utilisateur:":"User Input:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-purple-50 p-2 rounded border border-purple-200 max-h-24 overflow-y-auto",children:N.userInput})]}),N.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-amber-700",children:S==="de"?"Erweiterte Szene:":S==="fr"?"Sc√®ne √©tendue:":"Expanded Scene:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-24 overflow-y-auto",children:N.description})]}),N.prompt&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-blue-700",children:S==="de"?"API-Prompt:":S==="fr"?"Prompt API:":"API Prompt:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-32 overflow-y-auto",children:N.prompt})]}),N.modelId&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Model: ",N.modelId]}),N.qualityScore!=null&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Quality:"}),e.jsxs("span",{className:`text-xs font-bold ${N.qualityScore>=80?"text-green-600":N.qualityScore>=60?"text-yellow-600":"text-red-600"}`,children:[N.qualityScore,"%"]}),N.totalAttempts!=null&&N.totalAttempts>1&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",N.totalAttempts," attempts)"]})]}),N.qualityReasoning&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700",children:"Quality Reasoning:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-24 overflow-y-auto",children:N.qualityReasoning})]}),N.fixTargets&&N.fixTargets.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-semibold text-orange-700",children:["Fix Targets (",N.fixTargets.length,"):"]}),e.jsx("ul",{className:"text-xs text-gray-600 list-disc list-inside",children:N.fixTargets.map((f,z)=>e.jsx("li",{children:f.issue},z))})]}),N.referencePhotoNames&&N.referencePhotoNames.length>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Avatars: ",N.referencePhotoNames.map(f=>f.name).join(", ")]})]})]},w))]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 text-sm text-gray-500",children:S==="de"?"Klicken Sie auf ein Bild, um es auszuw√§hlen":S==="fr"?"Cliquez sur une image pour la s√©lectionner":"Click an image to select it"})]})})}function ya({src:d,title:$,onClose:x}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:x,children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] bg-white rounded-lg overflow-hidden",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:$}),e.jsx("button",{onClick:x,className:"text-gray-500 hover:text-gray-700 p-1",children:e.jsx(ke,{size:20})})]}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsx("img",{src:d,alt:$,className:"max-w-full max-h-[80vh] object-contain mx-auto"})})]})})}function Na({beforeImage:d,afterImage:$,diffImage:x,title:m,onClose:p}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:p,children:e.jsxs("div",{className:"relative bg-white rounded-lg overflow-hidden max-w-[95vw] max-h-[95vh]",onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-3 flex items-center justify-between border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:m}),e.jsx("button",{onClick:p,className:"text-gray-500 hover:text-gray-700 p-1",children:e.jsx(ke,{size:20})})]}),e.jsx("div",{className:"p-4 bg-gray-50 overflow-auto max-h-[calc(95vh-60px)]",children:e.jsxs("div",{className:`grid gap-4 ${x?"grid-cols-1 lg:grid-cols-3":"grid-cols-1 lg:grid-cols-2"}`,children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 mb-2 bg-red-100 px-3 py-1 rounded-full",children:"Before"}),e.jsx("img",{src:d,alt:"Before repair",className:"max-w-full max-h-[70vh] object-contain border rounded shadow-sm"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 mb-2 bg-green-100 px-3 py-1 rounded-full",children:"After"}),e.jsx("img",{src:$,alt:"After repair",className:"max-w-full max-h-[70vh] object-contain border rounded shadow-sm"})]}),x&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 mb-2 bg-purple-100 px-3 py-1 rounded-full",children:"Diff (changes in magenta)"}),e.jsx("img",{src:x,alt:"Difference",className:"max-w-full max-h-[70vh] object-contain border rounded shadow-sm"})]})]})})]})})}const Pr={en:{adventure:"Adventure","life-challenge":"Life Challenge",educational:"Educational",historical:"Historical"},de:{adventure:"Abenteuer","life-challenge":"Lebensherausforderung",educational:"Bildung",historical:"Historisch"},fr:{adventure:"Aventure","life-challenge":"D√©fi de vie",educational:"√âducatif",historical:"Historique"}},Ir={en:{"1st-grade":"Picture Book (1st Grade)",standard:"Standard",advanced:"Advanced"},de:{"1st-grade":"Bilderbuch (1. Klasse)",standard:"Standard",advanced:"Fortgeschritten"},fr:{"1st-grade":"Livre illustr√© (1√®re ann√©e)",standard:"Standard",advanced:"Avanc√©"}},va={"de-CH":"Schweizerdeutsch","de-DE":"Deutsch (Deutschland)",en:"English",fr:"Fran√ßais"};function wa({settings:d,language:$}){var W,h;const[x,m]=P.useState(!1),p=c=>{const T={en:{title:"Story Info",category:"Category",topic:"Topic",theme:"Theme",storyType:"Story Type",storyDetails:"Story Idea",artStyle:"Art Style",language:"Language",readingLevel:"Reading Level",pages:"Length",dedication:"Dedication",mainCharacters:"Main Characters",otherCharacters:"Other Characters",relationships:"Relationships",season:"Season",location:"Location",noData:"Not specified",spring:"Spring",summer:"Summer",autumn:"Autumn",winter:"Winter"},de:{title:"Story-Info",category:"Kategorie",topic:"Thema",theme:"Thema",storyType:"Story-Typ",storyDetails:"Story-Idee",artStyle:"Kunststil",language:"Sprache",readingLevel:"Lesestufe",pages:"L√§nge",dedication:"Widmung",mainCharacters:"Hauptfiguren",otherCharacters:"Andere Figuren",relationships:"Beziehungen",season:"Jahreszeit",location:"Ort",noData:"Nicht angegeben",spring:"Fr√ºhling",summer:"Sommer",autumn:"Herbst",winter:"Winter"},fr:{title:"Info histoire",category:"Cat√©gorie",topic:"Sujet",theme:"Th√®me",storyType:"Type d'histoire",storyDetails:"Id√©e d'histoire",artStyle:"Style artistique",language:"Langue",readingLevel:"Niveau de lecture",pages:"Longueur",dedication:"D√©dicace",mainCharacters:"Personnages principaux",otherCharacters:"Autres personnages",relationships:"Relations",season:"Saison",location:"Lieu",noData:"Non sp√©cifi√©",spring:"Printemps",summer:"√ât√©",autumn:"Automne",winter:"Hiver"}};return(T[$]||T.en)[c]||c},F=c=>(Pr[$]||Pr.en)[c]||c,S=c=>(Ir[$]||Ir.en)[c]||c,R=(c,T)=>c==null||c===""?e.jsx("span",{className:"text-gray-400 italic",children:p("noData")}):e.jsx("span",{className:"text-gray-800",children:c}),b=d.mainCharacters||[],N=((W=d.characters)==null?void 0:W.filter(c=>b.includes(c.id)))||[],w=((h=d.characters)==null?void 0:h.filter(c=>!b.includes(c.id)))||[],f=c=>p(c)||c,z=()=>{if(!d.userLocation)return null;const c=[d.userLocation.city,d.userLocation.region,d.userLocation.country].filter(Boolean);return c.length>0?c.join(", "):null};return e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>m(!x),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-amber-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ra,{size:16,className:"text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-800",children:p("title")}),e.jsx("span",{className:"text-xs bg-amber-200 text-amber-700 px-2 py-0.5 rounded",children:"DEV"})]}),x?e.jsx(_e,{size:18,className:"text-amber-600"}):e.jsx(bt,{size:18,className:"text-amber-600"})]}),x&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[N.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(ut,{size:12}),p("mainCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(c=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-indigo-100 text-indigo-800 border border-indigo-200",children:[e.jsx(ut,{size:10}),e.jsx("span",{children:c.name})]},c.id))})]}),w.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(jt,{size:12}),p("otherCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(c=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700 border border-gray-200",children:[e.jsx(ut,{size:10}),e.jsx("span",{children:c.name})]},c.id))})]}),d.relationships&&Object.keys(d.relationships).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-2",children:p("relationships")}),e.jsx("div",{className:"text-xs bg-white/50 p-2 rounded border border-amber-100 space-y-1",children:Object.entries(d.relationships).map(([c,T])=>{var u,H;const[n,D]=c.split("-").map(y=>parseInt(y,10)),G=(u=d.characters)==null?void 0:u.find(y=>y.id===n),U=(H=d.characters)==null?void 0:H.find(y=>y.id===D);return!G||!U?null:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-amber-600 font-medium whitespace-nowrap",children:[G.name," ‚Üí ",U.name,":"]}),e.jsx("span",{className:"text-gray-700",children:T})]},c)})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(ca,{size:12}),p("language")]}),e.jsx("div",{className:"text-sm",children:d.language?va[d.language]||d.language:R(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:p("readingLevel")}),e.jsx("div",{className:"text-sm",children:d.languageLevel?S(d.languageLevel):R(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:p("pages")}),e.jsx("div",{className:"text-sm",children:d.pages?`${d.pages} ${$==="de"?"Seiten":"pages"}`:R(void 0)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:p("season")}),e.jsx("div",{className:"text-sm",children:d.season?f(d.season):R(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:p("location")}),e.jsx("div",{className:"text-sm",children:z()||R(void 0)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(na,{size:12}),p("artStyle")]}),e.jsx("div",{className:"text-sm capitalize",children:R(d.artStyle)})]})]}),d.storyDetails&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(is,{size:12}),p("storyDetails")]}),e.jsx("div",{className:"text-sm bg-white/50 p-2 rounded border border-amber-100 whitespace-pre-wrap",children:d.storyDetails})]}),(d.storyCategory||d.storyTheme||d.storyTopic)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-amber-100",children:[d.storyCategory&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(la,{size:12}),p("category")]}),e.jsx("div",{className:"text-sm",children:F(d.storyCategory)})]}),(d.storyTheme||d.storyTopic)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:d.storyCategory==="adventure"?p("theme"):p("topic")}),e.jsx("div",{className:"text-sm",children:d.storyCategory==="adventure"?d.storyTheme:d.storyTopic})]})]})]})]})}function Ar({storyId:d,onShareStatusChange:$,variant:x="compact"}){const{language:m}=rt(),[p,F]=P.useState(!1),[S,R]=P.useState(null),[b,N]=P.useState(!1),[w,f]=P.useState(!1),[z,W]=P.useState(null),h=x==="full",c={share:m==="de"?"Teilen":m==="fr"?"Partager":"Share",shareStory:m==="de"?"Geschichte teilen":m==="fr"?"Partager l'histoire":"Share Story",enableSharing:m==="de"?"Link aktivieren":m==="fr"?"Activer le lien":"Enable sharing",disableSharing:m==="de"?"Link deaktivieren":m==="fr"?"D√©sactiver le lien":"Disable sharing",copyLink:m==="de"?"Link kopieren":m==="fr"?"Copier le lien":"Copy link",copied:m==="de"?"Kopiert!":m==="fr"?"Copi√©!":"Copied!",shareWhatsApp:m==="de"?"Per WhatsApp teilen":m==="fr"?"Partager sur WhatsApp":"Share on WhatsApp",sharingEnabled:m==="de"?"Teilen aktiv":m==="fr"?"Partage actif":"Sharing enabled",sharingDisabled:m==="de"?"Teilen inaktiv":m==="fr"?"Partage inactif":"Sharing disabled",anyoneWithLink:m==="de"?"Jeder mit dem Link kann die Geschichte lesen":m==="fr"?"Toute personne avec le lien peut lire l'histoire":"Anyone with the link can read the story",errorLoading:m==="de"?"Fehler beim Laden":m==="fr"?"Erreur de chargement":"Error loading"};P.useEffect(()=>{p&&!S&&T()},[p]);const T=async()=>{N(!0),W(null);try{const U=localStorage.getItem("auth_token"),u=await fetch(`/api/stories/${d}/share-status`,{headers:U?{Authorization:`Bearer ${U}`}:{}});if(!u.ok)throw new Error("Failed to fetch status");const H=await u.json();R(H)}catch{W(c.errorLoading)}finally{N(!1)}},n=async()=>{N(!0),W(null);try{const u=(S==null?void 0:S.isShared)?"DELETE":"POST",H=localStorage.getItem("auth_token"),y=await fetch(`/api/stories/${d}/share`,{method:u,headers:H?{Authorization:`Bearer ${H}`}:{}});if(!y.ok)throw new Error("Failed to toggle sharing");const C=await y.json();R({isShared:C.isShared,shareToken:C.shareToken,shareUrl:C.shareUrl}),$==null||$(C.isShared)}catch{W("Failed to update sharing")}finally{N(!1)}},D=async()=>{if(S!=null&&S.shareUrl)try{await navigator.clipboard.writeText(S.shareUrl),f(!0),setTimeout(()=>f(!1),2e3)}catch{const u=document.createElement("textarea");u.value=S.shareUrl,document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),f(!0),setTimeout(()=>f(!1),2e3)}},G=()=>{if(!(S!=null&&S.shareUrl))return;const U=encodeURIComponent(S.shareUrl);window.open(`https://wa.me/?text=${U}`,"_blank")};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>F(!p),className:h?"bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full hover:bg-indigo-600":"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-lg hover:from-blue-600 hover:to-indigo-600 transition-all shadow-md hover:shadow-lg",title:c.share,children:[e.jsx($r,{className:"w-4 h-4"}),e.jsx("span",{className:h?"":"hidden sm:inline",children:c.share}),(S==null?void 0:S.isShared)&&e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>F(!1)}),e.jsxs("div",{className:"fixed inset-x-4 bottom-4 sm:absolute sm:inset-auto sm:right-0 sm:bottom-auto sm:mt-2 w-auto sm:w-80 bg-white rounded-xl shadow-xl border border-gray-200 z-50 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx($r,{className:"w-5 h-5 text-blue-600"}),c.shareStory]})}),e.jsx("div",{className:"p-4 space-y-4",children:b&&!S?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(me,{className:"w-6 h-6 animate-spin text-blue-500"})}):z?e.jsx("div",{className:"text-red-500 text-sm py-2",children:z}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[S!=null&&S.isShared?e.jsx(ma,{className:"w-5 h-5 text-green-500"}):e.jsx(xa,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:S!=null&&S.isShared?"text-green-700":"text-gray-600",children:S!=null&&S.isShared?c.sharingEnabled:c.sharingDisabled})]}),e.jsx("button",{onClick:n,disabled:b,className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${S!=null&&S.isShared?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"} disabled:opacity-50`,children:b?e.jsx(me,{className:"w-4 h-4 animate-spin"}):S!=null&&S.isShared?c.disableSharing:c.enableSharing})]}),(S==null?void 0:S.isShared)&&S.shareUrl&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500",children:c.anyoneWithLink}),e.jsx("button",{onClick:D,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:w?e.jsxs(e.Fragment,{children:[e.jsx(oa,{className:"w-4 h-4 text-green-500"}),c.copied]}):e.jsxs(e.Fragment,{children:[e.jsx(da,{className:"w-4 h-4"}),c.copyLink]})}),e.jsxs("button",{onClick:G,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors",children:[e.jsx(pa,{className:"w-4 h-4"}),c.shareWhatsApp]})]})]})})]})]})]})}function ei({title:d,dedication:$,story:x,outline:m,outlinePrompt:p,outlineModelId:F,outlineUsage:S,storyTextPrompts:R=[],visualBible:b,sceneImages:N,sceneDescriptions:w=[],coverImages:f,regeneratingCovers:z=new Set,languageLevel:W="standard",storyLanguage:h,isGenerating:c=!1,onDownloadPdf:T,onAddToBook:n,onPrintBook:D,onCreateAnother:G,onDownloadTxt:U,onRegenerateImage:u,onRegenerateCover:H,characters:y=[],onEditImage:C,onEditCover:E,onRepairImage:q,onIteratePage:Q,onRevertRepair:A,onVisualBibleChange:ne,storyId:B,developerMode:Z=!1,styledAvatarGeneration:te=[],costumedAvatarGeneration:le=[],generationLog:se=[],finalChecksReport:o,clothingRequirements:de,isPartial:Is=!1,failureReason:ls,generatedPages:qe,totalPages:He,progressiveMode:Ne=!1,progressiveData:We,completedPageImages:yt={},originalStory:As,onSaveStoryText:zs,onSaveTitleChange:at,userCredits:Nt=0,imageRegenerationCost:Ie=5,isImpersonating:zr=!1,onSelectImageVersion:vt,onSelectCoverVersion:wt,generationSettings:St,onRefreshStory:Ue}){var Ht,Wt,Ut,Kt,Jt,Qt,Gt,Zt,Yt,Xt,er,sr,tr;const{t:Dr,language:t}=rt(),_=h?h.startsWith("de")?"de":h:t,re=zr||Nt===-1||Nt>=Ie,[V,it]=P.useState(null),[he,Fe]=P.useState(""),[Ke,Ds]=P.useState(!1),[Os,Rs]=P.useState(x),[os,Ct]=P.useState(!1),[nt,Fs]=P.useState(!1),[Ls,Es]=P.useState(d||""),[lt,$t]=P.useState(!1),[ot,Bs]=P.useState(null),[dt,ds]=P.useState(null),[pe,cs]=P.useState(null),[,kt]=P.useState(!1),[ve,ct]=P.useState(new Set),[K,Le]=P.useState(null),[ue,Pt]=P.useState(null),[Je,It]=P.useState(null),[xs,At]=P.useState(null),[ae,zt]=P.useState(null),[Ee,Dt]=P.useState(null),[Ts,Be]=P.useState(null),[Qe,Ms]=P.useState(!1),[xt,X]=P.useState(null),[ms,Vs]=P.useState(null),[Ge,_s]=P.useState("square"),[Ze,qs]=P.useState(!1),[Hs,Or]=P.useState({}),[Ye,Ot]=P.useState(new Set),Rt=async s=>{if(!(!B||Hs[s]||Ye.has(s))){Ot(i=>new Set(i).add(s));try{const i=localStorage.getItem("auth_token"),a=await fetch(`/api/stories/${B}/visual-bible-image/${s}`,{headers:i?{Authorization:`Bearer ${i}`}:{}});if(a.ok){const l=await a.json();Or(r=>({...r,[s]:l.imageData}))}}catch(i){console.error(`Failed to load reference image for ${s}:`,i)}finally{Ot(i=>{const a=new Set(i);return a.delete(s),a})}}},ps=(s,i)=>{if(!i||!Z)return null;const a=Hs[s],l=Ye.has(s);return a?e.jsx("img",{src:a,alt:"Reference",className:"w-16 h-16 object-cover rounded border border-rose-300 cursor-pointer hover:opacity-80",onClick:()=>X({src:a,title:"Reference Image"})}):e.jsx("button",{onClick:()=>Rt(s),disabled:l,className:"w-16 h-16 flex items-center justify-center bg-rose-100 border border-rose-300 rounded text-rose-500 hover:bg-rose-200 disabled:opacity-50",title:"Load reference image",children:l?e.jsx(me,{size:16,className:"animate-spin"}):e.jsx(ye,{size:16})})},[Te,Rr]=P.useState({}),[Ae,Ft]=P.useState(new Set),mt=async(s,i)=>{const a=`${s}-${i}`;if(!(!B||Te[a]||Ae.has(a))){Ft(l=>new Set(l).add(a));try{const l=await tt.getAvatarGenerationImage(B,s,i);l&&Rr(r=>({...r,[a]:l}))}catch(l){console.error(`Failed to load avatar generation images for ${a}:`,l)}finally{Ft(l=>{const r=new Set(l);return r.delete(a),r})}}},Fr=async()=>{if(!B||!te)return;const s=te.map((i,a)=>a).filter(i=>!Te[`styled-${i}`]&&!Ae.has(`styled-${i}`));await Promise.all(s.map(i=>mt("styled",i)))},Lr=async()=>{if(!B||!le)return;const s=le.map((i,a)=>a).filter(i=>!Te[`costumed-${i}`]&&!Ae.has(`costumed-${i}`));await Promise.all(s.map(i=>mt("costumed",i)))},Er=async()=>{if(!B||!b)return;const i=[...b.secondaryCharacters||[],...b.animals||[],...b.artifacts||[],...b.locations||[],...b.vehicles||[]].filter(a=>a.hasReferenceImage&&!Hs[a.id]&&!Ye.has(a.id)).map(a=>a.id);await Promise.all(i.map(a=>Rt(a)))},[gs,Br]=P.useState({}),[hs,Lt]=P.useState(new Set),Et=async s=>{if(!(!B||gs[s]!==void 0||hs.has(s))){Lt(i=>new Set(i).add(s));try{const i=await tt.getEntityGridImageByIndex(B,s);i!=null&&i.gridImage&&Br(a=>({...a,[s]:i.gridImage}))}catch(i){console.error(`Failed to load entity grid image for index ${s}:`,i)}finally{Lt(i=>{const a=new Set(i);return a.delete(s),a})}}},Tr=async()=>{var a;if(!B)return;const i=(((a=o==null?void 0:o.entity)==null?void 0:a.grids)||[]).map((l,r)=>({grid:l,idx:r})).filter(({grid:l,idx:r})=>!l.gridImage&&gs[r]===void 0).map(({idx:l})=>l);await Promise.all(i.map(l=>Et(l)))},Mr=async(s,i,a)=>new Promise((l,r)=>{const v=new Image;v.onload=()=>{const g=document.createElement("canvas"),O=g.getContext("2d");if(!O){r(new Error("Could not get canvas context"));return}const{cellSize:I,cols:J}=a,Y=Math.floor(i/J),ce=i%J*I,xe=Y*I;g.width=I,g.height=I,O.drawImage(v,ce,xe,I,I,0,0,I,I),l(g.toDataURL("image/png"))},v.onerror=()=>r(new Error("Failed to load grid image")),v.src=s}),Vr=async(s,i)=>{try{const a=s.manifest.cells[i],l=await Mr(s.gridImage,i,s.manifest),r=a.isReference?"Reference":`Page ${a.pageNumber}`,v=a.clothing&&a.clothing!=="standard"?` (${a.clothing})`:"";X({src:l,title:`${s.entityName} - ${r}${v}`})}catch(a){console.error("Failed to crop cell:",a)}},_r=(s,i,a,l)=>{var g,O,I,J,Y,ie;const r=`${s}-${i}`,v=Te[r];return v&&v[l]?v[l]:l==="output"&&((g=a.output)!=null&&g.imageData)?a.output.imageData:l==="facePhoto"&&((O=a.inputs.facePhoto)!=null&&O.imageData)?a.inputs.facePhoto.imageData:l==="originalAvatar"&&"originalAvatar"in a.inputs&&((I=a.inputs.originalAvatar)!=null&&I.imageData)?a.inputs.originalAvatar.imageData:l==="styleSample"&&"styleSample"in a.inputs&&((J=a.inputs.styleSample)!=null&&J.imageData)?a.inputs.styleSample.imageData:l==="standardAvatar"&&"standardAvatar"in a.inputs&&((Y=a.inputs.standardAvatar)!=null&&Y.imageData)?a.inputs.standardAvatar.imageData||null:l==="referenceAvatar"&&"referenceAvatar"in a.inputs&&((ie=a.inputs.referenceAvatar)!=null&&ie.imageData)&&a.inputs.referenceAvatar.imageData||null},we=(s,i,a,l,r,v)=>{const g=_r(s,i,a,l),O=`${s}-${i}`,I=Ae.has(O),J=!!Te[O];return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:r}),g?e.jsx("img",{src:g,alt:r,className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>X({src:g,title:r}),title:v?`${v} KB - Click to enlarge`:"Click to enlarge"}):v?e.jsx("button",{onClick:()=>mt(s,i),disabled:I||J,className:"w-16 h-16 flex flex-col items-center justify-center bg-blue-50 border border-blue-300 rounded text-blue-500 hover:bg-blue-100 disabled:opacity-50 text-[10px]",title:"Click to load images",children:I?e.jsx(me,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{size:14}),e.jsxs("span",{className:"mt-0.5",children:[v," KB"]})]})}):e.jsx("span",{className:"text-gray-400 italic text-[10px]",children:"N/A"})]})};P.useEffect(()=>{Ke||Rs(x)},[x,Ke]),P.useEffect(()=>{nt||Es(d||"")},[d,nt]);const qr=async()=>{if(zs){Ct(!0);try{await zs(Os),Ds(!1)}catch(s){console.error("Failed to save story text:",s)}finally{Ct(!1)}}},Bt=async()=>{if(!(!at||!Ls.trim())){$t(!0);try{await at(Ls.trim()),Fs(!1)}catch(s){console.error("Failed to save title:",s)}finally{$t(!1)}}},Hr=()=>{Rs(x),Ds(!1)},Tt=async s=>{if(!(!q||ue!==null)){Pt(s);try{await q(s)}catch(i){console.error("Failed to repair image:",i)}finally{Pt(null)}}},Mt=async(s,i)=>{if(!(!Q||Ee!==null)){Dt(s),Be(null);try{await Q(s,i)}catch(a){console.error("Failed to iterate page:",a)}finally{Dt(null)}}},Wr=async s=>{if(!(!B||Je!==null)){It(s);try{const i=await fetch(`/api/stories/${B}/repair-entity-consistency`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({entityName:s,entityType:"character"})});if(!i.ok){const l=await i.json();throw new Error(l.error||"Repair failed")}const a=await i.json();console.log("Entity repair result:",a),a.success&&!a.noChanges&&(Ue?await Ue():window.location.reload())}catch(i){console.error("Failed to repair entity consistency:",i),alert(`Failed to repair: ${i instanceof Error?i.message:"Unknown error"}`)}finally{It(null)}}},Ur=async(s,i)=>{if(!(!B||ae!==null)){zt({entity:s,page:i});try{const a=await fetch(`/api/stories/${B}/repair-entity-consistency`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({entityName:s,entityType:"character",pageNumber:i})});if(!a.ok){const r=await a.json();throw new Error(r.error||"Repair failed")}const l=await a.json();if(console.log("Single-page entity repair result:",l),l.rejected&&l.comparison){Vs({beforeImage:l.comparison.before,afterImage:l.comparison.after,title:`Repair rejected for ${s} on page ${i}: ${l.reason||"Did not improve consistency"}`});return}l.success?Ue?await Ue():window.location.reload():l.rejected||alert(`Repair failed: ${l.error||"Unknown error"}`)}catch(a){console.error("Failed to repair single page:",a),alert(`Failed to repair page ${i}: ${a instanceof Error?a.message:"Unknown error"}`)}finally{zt(null)}}},Kr=async(s,i)=>{if(!(!B||xs!==null)){At(s);try{const a=await fetch(`/api/stories/${B}/repair/image/${s}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({correctionNotes:`${i.type||""}: ${i.description||""}
Target: ${i.canonicalVersion||""}
Fix: ${i.recommendation||""}`})});if(!a.ok){const r=await a.json();throw new Error(r.error||"Repair failed")}const l=await a.json();console.log("Image issue repair result:",l),l.success&&(Ue?await Ue():window.location.reload())}catch(a){console.error("Failed to repair image issue:",a),alert(`Failed to repair: ${a instanceof Error?a.message:"Unknown error"}`)}finally{At(null)}}},Vt=(s,i)=>{const a=Os.split(/(?=---\s*(?:Page|Seite)\s+\d+\s*---|(?=##\s*(?:Page|Seite)\s+\d+))/i);let l=0;for(let v=0;v<a.length;v++)if(/^(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i.test(a[v].trim())){l=v;break}const r=l+s;if(r<a.length){const v=a[r].match(/^(---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i),g=v?v[0]:"";a[r]=g+`
`+i.trim()+`
`}Rs(a.join(""))},Xe=s=>{const i=N.find(a=>a.pageNumber===s);return(i==null?void 0:i.imageVersions)||[]},Jr=async(s,i)=>{if(vt)try{await vt(s,i),Bs(null)}catch(a){console.error("Failed to select image version:",a)}},Qr=async(s,i)=>{if(wt)try{await wt(s,i),ds(null)}catch(a){console.error("Failed to select cover image version:",a)}},Se=s=>{const i=f==null?void 0:f[s];return i?i.imageVersions||[]:[]},Gr=s=>{if(!s)return"";let i;if(typeof s!="string"){const v=s;if(v.output)if(typeof v.output=="string")i=v.output;else if(typeof v.output=="object"){const g=v.output.translatedSummary||v.output.imageSummary||"";if(g)return g;i=JSON.stringify(s)}else i=JSON.stringify(s);else i=JSON.stringify(s)}else i=s;if(i.trim().startsWith("{"))try{const v=JSON.parse(i);if(v.output){if(typeof v.output=="string")i=v.output;else if(typeof v.output=="object"){const g=v.output.translatedSummary||v.output.imageSummary;if(g)return g}}}catch{}const a=i.match(/(?:#{1,3}\s*)?(?:\*\*)?6\.?\s*(?:\*\*)?\s*\*?\*?(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*\*?\*?\s*:?\s*\n?([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n---|\n```|$)/i);if(a&&a[2]&&a[2].trim())return a[2].trim();const l=i.match(/(?:#{1,3}\s*)?\*?\*?(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*:?\s*\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n\*\*|\n#{1,3}\s|$)/i);if(l&&l[2]&&l[2].trim())return l[2].trim();if(!i.includes("**")&&i.length<1e3)return i.trim();const r=i.match(/\*?\*?(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:\*\*)?\d+\.\s*\*\*|\n\s*\*\*\d+\.|$)/i);return r&&r[2]&&r[2].trim()?r[2].trim():i.substring(0,500).trim()+"..."},Zr=s=>{if(!s||!y.length)return y.map(l=>l.id);let i;if(typeof s!="string"){const l=s;i=l.output&&typeof l.output=="string"?l.output:JSON.stringify(s)}else i=s;if(i.trim().startsWith("{"))try{const l=JSON.parse(i);l.output&&typeof l.output=="string"&&(i=l.output)}catch{}const a=i.toLowerCase();return y.filter(l=>a.includes(l.name.toLowerCase())).map(l=>l.id)},_t=s=>{const i=N.find(g=>g.pageNumber===s),a=w.find(g=>g.pageNumber===s),l=(i==null?void 0:i.description)||(a==null?void 0:a.description)||"",r=(a==null?void 0:a.translatedSummary)||Gr(l)||(a==null?void 0:a.imageSummary)||"",v=Zr(l);cs({pageNumber:s,scene:r,selectedCharacterIds:v})},Yr=async()=>{if(!pe||!u)return;const s=pe.pageNumber,i=pe.scene,a=pe.selectedCharacterIds;cs(null),ct(l=>new Set(l).add(s)),kt(!0);try{await u(s,i,a)}catch(l){console.error("Failed to regenerate image:",l)}finally{ct(l=>{const r=new Set(l);return r.delete(s),r}),ct(l=>(l.size===0&&kt(!1),l))}},pt=s=>{let i="",a=[];if(s==="front"&&(f!=null&&f.frontCover)){const g=f.frontCover;typeof g=="object"&&(i=g.translatedDescription||g.description||"",a=g.referencePhotos||[])}else if(s==="initial"&&(f!=null&&f.initialPage)){const g=f.initialPage;typeof g=="object"&&(i=g.translatedDescription||g.description||"",a=g.referencePhotos||[])}else if(s==="back"&&(f!=null&&f.backCover)){const g=f.backCover;typeof g=="object"&&(i=g.translatedDescription||g.description||"",a=g.referencePhotos||[])}let l=[];a.length>0&&y.length>0&&(l=y.filter(g=>a.some(O=>O.name===g.name)).map(g=>g.id)),l.length===0&&(l=y.map(g=>g.id)),Le({coverType:s,scene:i,selectedCharacterIds:l,title:s==="front"?d:void 0,dedication:s==="initial"?$:void 0})},Xr=async()=>{if(!K||!H)return;const{coverType:s,scene:i,selectedCharacterIds:a,title:l,dedication:r}=K;Le(null);try{await H(s,i,a,l,r)}catch(v){console.error("Failed to regenerate cover:",v)}},Ws=(s,i,a,l)=>{it({type:s,id:i,field:a}),Fe(l||"")},Us=()=>{if(!V||!b||!ne)return;const{type:s,id:i,field:a}=V,l={...b};if(s==="secondaryCharacter")l.secondaryCharacters=(l.secondaryCharacters||[]).map(r=>r.id===i?{...r,[a]:he}:r);else if(s==="animal")l.animals=(l.animals||[]).map(r=>r.id===i?{...r,[a]:he}:r);else if(s==="artifact")l.artifacts=(l.artifacts||[]).map(r=>r.id===i?{...r,[a]:he}:r);else if(s==="location")l.locations=(l.locations||[]).map(r=>r.id===i?{...r,[a]:he}:r);else if(s==="mainCharacter"){const r=parseInt(i);l.mainCharacters=(l.mainCharacters||[]).map(v=>v.id!==r?v:a==="physical.face"?{...v,physical:{...v.physical,face:he}}:a==="physical.hair"?{...v,physical:{...v.physical,hair:he}}:a==="physical.build"?{...v,physical:{...v.physical,build:he}}:v)}ne(l),it(null),Fe("")},Ks=()=>{it(null),Fe("")},es=(s=>s?s.split(/(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i).slice(1).filter(a=>a.trim().length>0):[])(Ke?Os:x),ss=N.length>0,Js=W==="1st-grade",qt=(()=>{if(!Ne)return es.length;if(es.length===0)return 0;let s=1;for(let i=2;i<=es.length;i++){const a=i-1;if(N.some(r=>r.pageNumber===a&&r.imageData)||!!yt[a])s=i;else break}return s})(),ea=(We==null?void 0:We.totalPages)||es.length;We!=null&&We.totalScenes||N.length||Math.ceil(ea/(Js?1:2));const ts=s=>(s==null?void 0:s.imageData)||null,Qs=s=>{var v,g;const a=((v=w.find(O=>O.pageNumber===s))==null?void 0:v.description)||((g=N.find(O=>O.pageNumber===s))==null?void 0:g.description);if(!a)return;const l=O=>{if(typeof O!="string")return O;try{const I=JSON.parse(O);return typeof I=="string"&&(I.startsWith("{")||I.startsWith("["))?l(I):I}catch{return O}},r=l(a);return typeof r=="object"&&r!==null?JSON.stringify(r,null,2):String(r)},Gs=s=>{const i=w.find(a=>a.pageNumber===s);return s===1&&i&&(console.log("[StoryDisplay] Page 1 scene keys:",Object.keys(i)),console.log("[StoryDisplay] Page 1 has outlineExtract:",!!i.outlineExtract),console.log("[StoryDisplay] Page 1 has scenePrompt:",!!i.scenePrompt)),i==null?void 0:i.outlineExtract},Zs=s=>{var i;return(i=w.find(a=>a.pageNumber===s))==null?void 0:i.scenePrompt},Ys=s=>{var i;return(i=w.find(a=>a.pageNumber===s))==null?void 0:i.textModelId};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center gap-2",children:nt?e.jsxs("div",{className:"flex items-center gap-2 w-full max-w-2xl",children:[e.jsx("input",{type:"text",value:Ls,onChange:s=>Es(s.target.value),className:"flex-1 text-2xl md:text-3xl font-bold text-gray-800 text-center border-2 border-indigo-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-500",autoFocus:!0,onKeyDown:s=>{s.key==="Enter"&&Bt(),s.key==="Escape"&&(Es(d||""),Fs(!1))}}),e.jsx("button",{onClick:Bt,disabled:lt||!Ls.trim(),className:"p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50",title:t==="de"?"Speichern":t==="fr"?"Sauvegarder":"Save",children:lt?e.jsx(Me,{className:"animate-spin",size:20}):e.jsx(rs,{size:20})}),e.jsx("button",{onClick:()=>{Es(d||""),Fs(!1)},disabled:lt,className:"p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",title:t==="de"?"Abbrechen":t==="fr"?"Annuler":"Cancel",children:e.jsx(ke,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-800 text-center",children:d||Dr.yourStory}),at&&!c&&e.jsx("button",{onClick:()=>Fs(!0),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:t==="de"?"Titel bearbeiten":t==="fr"?"Modifier le titre":"Edit title",children:e.jsx(oe,{size:18})})]})}),Is&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-400 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-amber-500 text-2xl",children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-amber-800",children:t==="de"?"Unvollst√§ndige Geschichte":t==="fr"?"Histoire incompl√®te":"Incomplete Story"}),e.jsx("p",{className:"text-amber-700 text-sm mt-1",children:t==="de"?`Diese Geschichte konnte nicht vollst√§ndig generiert werden. ${qe||N.length} von ${He||"unbekannt"} Seiten wurden erstellt.`:t==="fr"?`Cette histoire n'a pas pu √™tre g√©n√©r√©e compl√®tement. ${qe||N.length} sur ${He||"inconnu"} pages ont √©t√© cr√©√©es.`:`This story could not be fully generated. ${qe||N.length} of ${He||"unknown"} pages were created.`}),ls&&Z&&e.jsxs("details",{className:"mt-2 text-sm",children:[e.jsx("summary",{className:"cursor-pointer text-amber-600 hover:text-amber-700",children:t==="de"?"Fehlerdetails":t==="fr"?"D√©tails de l'erreur":"Error details"}),e.jsx("p",{className:"mt-1 bg-amber-100 p-2 rounded text-amber-800 font-mono text-xs",children:ls})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[ss&&B&&n&&e.jsxs("button",{onClick:n,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Sr,{size:16})," ",t==="de"?"Buch erstellen":t==="fr"?"Cr√©er le livre":"Create Book"]}),ss&&T&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>qs(!Ze),disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(is,{size:16}),t==="de"?"PDF herunterladen":t==="fr"?"T√©l√©charger PDF":"Download PDF",e.jsx(_e,{size:14,className:`transition-transform ${Ze?"rotate-180":""}`})]}),Ze&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:Ge==="square",onChange:()=>_s("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20√ó20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:Ge==="A4",onChange:()=>_s("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21√ó28cm)"})]})]}),e.jsx("button",{onClick:()=>{T(Ge),qs(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:t==="de"?"Herunterladen":t==="fr"?"T√©l√©charger":"Download"})]})]}),ss&&B&&!c&&e.jsx(Ar,{storyId:B,variant:"full"}),G&&e.jsxs("button",{onClick:G,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Cr,{size:16})," ",t==="de"?"Neue Geschichte":t==="fr"?"Nouvelle histoire":"New Story"]})]}),Z&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[U&&e.jsxs("button",{onClick:U,className:"bg-gray-500 text-white px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 hover:bg-gray-600",children:[e.jsx(Ve,{size:14})," TXT"]}),ss&&B&&D&&e.jsxs("button",{onClick:D,disabled:c,className:`bg-yellow-500 text-black px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 ${c?"opacity-50 cursor-not-allowed":"hover:bg-yellow-600"}`,children:[e.jsx(gt,{size:14})," Print (DEV)"]})]}),Z&&St&&e.jsx("div",{className:"mt-4",children:e.jsx(wa,{settings:St,language:t})}),Z&&e.jsxs("div",{className:"space-y-4 mt-6",children:[m&&e.jsxs("details",{className:"bg-purple-50 border-2 border-purple-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-purple-800 hover:text-purple-900 flex items-center gap-2",children:[e.jsx(is,{size:20}),Js?t==="de"?"Vollst√§ndige API-Ausgabe (Kombiniert)":t==="fr"?"Sortie API compl√®te (Combin√©e)":"Full API Output (Combined)":t==="de"?"Vollst√§ndige API-Ausgabe (Outline)":t==="fr"?"Sortie API compl√®te (Plan)":"Full API Output (Outline)",F&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-purple-600",children:["(",F,")"]}),S&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-purple-500",children:["[",S.input_tokens.toLocaleString()," in / ",S.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[p&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:t==="de"?"üì§ Prompt (Eingabe)":t==="fr"?"üì§ Prompt (Entr√©e)":"üì§ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:p})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:Js?t==="de"?"üì• API-Antwort (Kombiniert)":t==="fr"?"üì• R√©ponse API (Combin√©e)":"üì• API Response (Combined)":t==="de"?"üì• API-Antwort (Outline)":t==="fr"?"üì• R√©ponse API (Plan)":"üì• API Response (Outline)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:m})]})]})]}),x&&R.length>0&&e.jsxs("details",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(gt,{size:20}),t==="de"?"Vollst√§ndige API-Ausgabe (Story-Text)":t==="fr"?"Sortie API compl√®te (Texte)":"Full API Output (Story Text)",((Ht=R[0])==null?void 0:Ht.modelId)&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-amber-600",children:["(",R[0].modelId,")"]}),((Wt=R[0])==null?void 0:Wt.usage)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-500",children:["[",R[0].usage.input_tokens.toLocaleString()," in / ",R[0].usage.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:t==="de"?"üì§ Prompt (Eingabe)":t==="fr"?"üì§ Prompt (Entr√©e)":"üì§ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((Ut=R[0])==null?void 0:Ut.prompt)||"No prompt available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:t==="de"?"üì• Rohe API-Antwort (ungefiltert)":t==="fr"?"üì• R√©ponse API brute (non filtr√©e)":"üì• Raw API Response (unfiltered)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((Kt=R[0])==null?void 0:Kt.rawResponse)||x})]})]})]}),b&&e.jsxs("details",{className:"bg-rose-50 border-2 border-rose-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-rose-800 hover:text-rose-900 flex items-center gap-2",children:[e.jsx(gt,{size:20}),t==="de"?"Visual Bible (Wiederkehrende Elemente)":t==="fr"?"Bible Visuelle (√âl√©ments R√©currents)":"Visual Bible (Recurring Elements)",b.changeLog&&b.changeLog.length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-rose-200 text-rose-800 rounded-full text-xs font-medium",children:[b.changeLog.length," ",t==="de"?"√Ñnderungen":t==="fr"?"changements":"changes"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[(()=>{const i=[...b.secondaryCharacters||[],...b.animals||[],...b.artifacts||[],...b.locations||[],...b.vehicles||[]].filter(a=>a.hasReferenceImage&&!Hs[a.id]).length;return i===0?null:e.jsx("button",{onClick:Er,disabled:Ye.size>0,className:"text-xs px-3 py-1.5 bg-rose-500 text-white rounded hover:bg-rose-600 disabled:bg-rose-300",children:Ye.size>0?`Loading ${Ye.size} images...`:`Load All Reference Images (${i})`})})(),b.mainCharacters&&b.mainCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-purple-300 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-purple-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üëó"}),t==="de"?"Hauptcharaktere (Style Profile)":t==="fr"?"Personnages Principaux (Profil Style)":"Main Characters (Style Profile)"]}),e.jsx("div",{className:"space-y-3",children:b.mainCharacters.map(s=>{var i,a,l,r;return e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-sm",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-800 hover:text-purple-900",children:[s.name,Object.keys(s.generatedOutfits||{}).length>0&&e.jsxs("span",{className:"ml-2 px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:[Object.keys(s.generatedOutfits).length," ",t==="de"?"Outfits":t==="fr"?"tenues":"outfits"]})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Physical:"}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[((i=s.physical)==null?void 0:i.skinTone)||"N/A"," | ",((a=s.physical)==null?void 0:a.hair)||"N/A"," | ",((l=s.physical)==null?void 0:l.build)||"N/A",((r=s.physical)==null?void 0:r.other)&&` | ${s.physical.other}`]})]}),s.generatedOutfits&&Object.keys(s.generatedOutfits).length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-200",children:[e.jsx("span",{className:"font-medium text-gray-600 text-xs",children:"Generated Outfits:"}),e.jsx("div",{className:"mt-1 space-y-1",children:Object.entries(s.generatedOutfits).map(([v,g])=>{var O;return e.jsxs("div",{className:"bg-white p-1.5 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-purple-600",children:["Page ",v,":"]}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[(O=g.outfit)==null?void 0:O.substring(0,80),"..."]}),e.jsx("span",{className:`ml-1 px-1 py-0.5 rounded text-[10px] ${g.setting==="outdoor-cold"?"bg-blue-100 text-blue-700":g.setting==="outdoor-warm"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:g.setting})]},v)})})]})]})]},s.id)})})]}),b.secondaryCharacters&&b.secondaryCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Nebencharaktere":t==="fr"?"Personnages Secondaires":"Secondary Characters"}),e.jsx("div",{className:"space-y-2",children:b.secondaryCharacters.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[ps(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(V==null?void 0:V.type)==="secondaryCharacter"&&(V==null?void 0:V.id)===s.id&&(V==null?void 0:V.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:he,onChange:a=>Fe(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Us,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(rs,{size:12})," Save"]}),e.jsxs("button",{onClick:Ks,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(ke,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&ne&&e.jsx("button",{onClick:()=>Ws("secondaryCharacter",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(oe,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),((Jt=b.animals)==null?void 0:Jt.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Tiere & Wesen":t==="fr"?"Animaux & Cr√©atures":"Animals & Creatures"}),e.jsx("div",{className:"space-y-2",children:b.animals.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[ps(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(V==null?void 0:V.type)==="animal"&&(V==null?void 0:V.id)===s.id&&(V==null?void 0:V.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:he,onChange:a=>Fe(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Us,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(rs,{size:12})," Save"]}),e.jsxs("button",{onClick:Ks,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(ke,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&ne&&e.jsx("button",{onClick:()=>Ws("animal",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(oe,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),((Qt=b.artifacts)==null?void 0:Qt.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Artefakte & Objekte":t==="fr"?"Artefacts & Objets":"Artifacts & Objects"}),e.jsx("div",{className:"space-y-2",children:b.artifacts.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[ps(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(V==null?void 0:V.type)==="artifact"&&(V==null?void 0:V.id)===s.id&&(V==null?void 0:V.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:he,onChange:a=>Fe(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Us,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(rs,{size:12})," Save"]}),e.jsxs("button",{onClick:Ks,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(ke,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&ne&&e.jsx("button",{onClick:()=>Ws("artifact",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(oe,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),((Gt=b.locations)==null?void 0:Gt.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Wiederkehrende Orte":t==="fr"?"Lieux R√©currents":"Recurring Locations"}),e.jsx("div",{className:"space-y-2",children:b.locations.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[!s.isRealLandmark&&ps(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.isRealLandmark&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-amber-100 text-amber-700 font-semibold",children:"üìç LANDMARK"}),s.photoFetchStatus==="success"&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-green-100 text-green-700",children:"üì∑ Photo"}),!s.isRealLandmark&&s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),s.isRealLandmark&&s.landmarkQuery&&e.jsxs("div",{className:"text-amber-700 text-xs mt-1",children:["Landmark: ",e.jsx("span",{className:"font-mono bg-amber-50 px-1 rounded",children:s.landmarkQuery})]}),(V==null?void 0:V.type)==="location"&&(V==null?void 0:V.id)===s.id&&(V==null?void 0:V.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:he,onChange:a=>Fe(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Us,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(rs,{size:12})," Save"]}),e.jsxs("button",{onClick:Ks,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(ke,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&ne&&e.jsx("button",{onClick:()=>Ws("location",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(oe,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]}),s.referencePhotoData&&e.jsxs("div",{className:"mt-2 border border-amber-200 rounded overflow-hidden",children:[e.jsx("img",{src:s.referencePhotoData,alt:`${s.name} reference`,className:"w-full max-h-32 object-contain bg-gray-50"}),s.photoAttribution&&e.jsxs("div",{className:"text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 truncate",children:["üì∑ ",s.photoAttribution]})]})]})]},s.id)})})]}),b.vehicles&&b.vehicles.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Fahrzeuge":t==="fr"?"V√©hicules":"Vehicles"}),e.jsx("div",{className:"space-y-2",children:b.vehicles.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[ps(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:s.description}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),b.clothing&&b.clothing.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Kleidung & Kost√ºme":t==="fr"?"V√™tements & Costumes":"Clothing & Costumes"}),e.jsx("div",{className:"space-y-2",children:b.clothing.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.wornBy&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:["worn by ",s.wornBy]}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:s.description}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id)})})]}),b.changeLog&&b.changeLog.length>0&&e.jsxs("details",{className:"bg-white border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-bold text-amber-700 hover:text-amber-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üìù"}),t==="de"?"√Ñnderungsprotokoll":t==="fr"?"Journal des Modifications":"Change Log",e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-amber-100 text-amber-700 rounded text-xs",children:b.changeLog.length})]}),e.jsx("div",{className:"mt-2 space-y-1 max-h-[500px] overflow-y-auto",children:b.changeLog.slice().reverse().map((s,i)=>{var a;return e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs border-l-2 border-amber-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${s.type==="mainCharacter"?"bg-purple-100 text-purple-700":s.type==="secondaryCharacter"?"bg-rose-100 text-rose-700":s.type==="generatedOutfit"?"bg-green-100 text-green-700":s.type==="animal"?"bg-orange-100 text-orange-700":s.type==="artifact"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:s.type}),e.jsx("span",{className:"font-semibold text-amber-800",children:s.element}),e.jsxs("span",{className:"text-gray-500",children:[_==="de"?"Seite":"Page"," ",s.page]})]}),e.jsxs("div",{className:"mt-1 text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:[s.change,":"]}),e.jsxs("span",{className:"ml-1 text-gray-700",children:[(a=s.after)==null?void 0:a.substring(0,100),s.after&&s.after.length>100?"...":""]})]}),s.before&&e.jsxs("div",{className:"text-gray-400 line-through text-[10px] mt-0.5",children:[t==="de"?"Vorher":t==="fr"?"Avant":"Before",": ",s.before.substring(0,50),"..."]}),e.jsx("div",{className:"text-gray-400 text-[10px] mt-0.5",children:new Date(s.timestamp).toLocaleTimeString()})]},i)})})]}),(!b.mainCharacters||b.mainCharacters.length===0)&&(!b.secondaryCharacters||b.secondaryCharacters.length===0)&&(!b.animals||b.animals.length===0)&&(!b.artifacts||b.artifacts.length===0)&&(!b.locations||b.locations.length===0)&&(!b.vehicles||b.vehicles.length===0)&&(!b.clothing||b.clothing.length===0)&&e.jsx("div",{className:"text-gray-500 text-sm italic",children:t==="de"?"Keine wiederkehrenden Elemente gefunden":t==="fr"?"Aucun √©l√©ment r√©current trouv√©":"No recurring elements found in this story"})]})]}),de&&Object.keys(de).length>0&&e.jsxs("details",{className:"bg-teal-50 border-2 border-teal-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-teal-800 hover:text-teal-900 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"üëî"}),t==="de"?`Kleidungsanforderungen (${Object.keys(de).length} Charaktere)`:t==="fr"?`Exigences vestimentaires (${Object.keys(de).length} personnages)`:`Clothing Requirements (${Object.keys(de).length} characters)`]}),e.jsx("div",{className:"mt-4 space-y-3",children:Object.entries(de).map(([s,i])=>{var a,l,r,v,g,O,I,J,Y,ie,ce,xe,be,fe,je;return e.jsxs("div",{className:"bg-white border border-teal-200 rounded-lg p-3",children:[e.jsx("h4",{className:"font-bold text-teal-700 mb-2",children:s}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${(a=i.standard)!=null&&a.used?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(l=i.standard)!=null&&l.used?"‚úÖ":"‚¨ú"," Standard"]}),((r=i.standard)==null?void 0:r.used)&&((v=i.standard)==null?void 0:v.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:i.standard.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(g=i.winter)!=null&&g.used?"bg-blue-50 border border-blue-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(O=i.winter)!=null&&O.used?"‚ùÑÔ∏è":"‚¨ú"," Winter"]}),((I=i.winter)==null?void 0:I.used)&&((J=i.winter)==null?void 0:J.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:i.winter.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(Y=i.summer)!=null&&Y.used?"bg-yellow-50 border border-yellow-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(ie=i.summer)!=null&&ie.used?"‚òÄÔ∏è":"‚¨ú"," Summer"]}),((ce=i.summer)==null?void 0:ce.used)&&((xe=i.summer)==null?void 0:xe.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:i.summer.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(be=i.costumed)!=null&&be.used?"bg-purple-50 border border-purple-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(fe=i.costumed)!=null&&fe.used?"üé≠":"‚¨ú"," Costumed"]}),((je=i.costumed)==null?void 0:je.used)&&e.jsxs("div",{className:"text-gray-600 mt-1",children:[i.costumed.costume&&e.jsxs("span",{className:"font-medium",children:[i.costumed.costume,": "]}),i.costumed.description]})]})]})]},s)})})]}),te&&te.length>0&&e.jsxs("details",{className:"bg-pink-50 border-2 border-pink-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-pink-800 hover:text-pink-900 flex items-center gap-2",children:[e.jsx(ye,{size:20}),t==="de"?`Stilisierte Avatare (${te.length})`:t==="fr"?`Avatars stylis√©s (${te.length})`:`Styled Avatars (${te.length})`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[(()=>{const s=te.filter((i,a)=>!Te[`styled-${a}`]).length;return s===0?null:e.jsx("button",{onClick:Fr,disabled:Ae.size>0,className:"text-xs px-3 py-1.5 bg-pink-500 text-white rounded hover:bg-pink-600 disabled:bg-pink-300",children:Ae.size>0?"Loading...":`Load All Images (${s})`})})(),te.map((s,i)=>{var a,l;return e.jsxs("details",{className:`border rounded-lg p-3 ${s.success?"bg-white border-pink-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.success?"bg-green-500":"bg-red-500"}`}),s.characterName," - ",s.artStyle," (",s.clothingCategory||"standard",")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(s.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[we("styled",i,s,"facePhoto","Face Photo",(a=s.inputs.facePhoto)==null?void 0:a.sizeKB),we("styled",i,s,"originalAvatar","Original Avatar",(l=s.inputs.originalAvatar)==null?void 0:l.sizeKB),s.inputs.styleSample&&we("styled",i,s,"styleSample","Style Sample",s.inputs.styleSample.sizeKB)]})]}),s.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",s.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-[500px] overflow-y-auto",children:s.prompt})]}),s.success&&s.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2",children:we("styled",i,s,"output","Styled Avatar Output",s.output.sizeKB)})]}),!s.success&&s.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:s.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(s.timestamp).toLocaleString()]})]})]},i)})]})]}),le&&le.length>0&&e.jsxs("details",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-orange-800 hover:text-orange-900 flex items-center gap-2",children:[e.jsx(ye,{size:20}),t==="de"?`Kost√ºm-Avatare (${le.length})`:t==="fr"?`Avatars costum√©s (${le.length})`:`Costumed Avatars (${le.length})`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[(()=>{const s=le.filter((i,a)=>!Te[`costumed-${a}`]).length;return s===0?null:e.jsx("button",{onClick:Lr,disabled:Ae.size>0,className:"text-xs px-3 py-1.5 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:bg-orange-300",children:Ae.size>0?"Loading...":`Load All Images (${s})`})})(),le.map((s,i)=>{var a,l,r,v,g,O,I,J,Y,ie,ce,xe,be,fe,je,ze,De;return e.jsxs("details",{className:`border rounded-lg p-3 ${s.success?"bg-white border-orange-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 hover:text-orange-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.success?"bg-green-500":"bg-red-500"}`}),s.characterName," - ",s.costumeType," (",s.artStyle,")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(s.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[s.costumeDescription&&e.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-yellow-700",children:"Costume:"}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.costumeDescription})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[((a=s.inputs)==null?void 0:a.facePhoto)&&we("costumed",i,s,"facePhoto","Face Photo",(l=s.inputs.facePhoto)==null?void 0:l.sizeKB),((r=s.inputs)==null?void 0:r.standardAvatar)&&we("costumed",i,s,"standardAvatar","Standard Avatar",(v=s.inputs.standardAvatar)==null?void 0:v.sizeKB),((g=s.inputs)==null?void 0:g.referenceAvatar)&&!((O=s.inputs)!=null&&O.standardAvatar)&&we("costumed",i,s,"referenceAvatar","Reference Avatar",(I=s.inputs.referenceAvatar)==null?void 0:I.sizeKB),((J=s.inputs)==null?void 0:J.styleSample)&&we("costumed",i,s,"styleSample","Style Sample",(Y=s.inputs.styleSample)==null?void 0:Y.sizeKB)]})]}),s.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",s.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-[500px] overflow-y-auto",children:s.prompt})]}),s.success&&s.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2",children:we("costumed",i,s,"output","Costumed Avatar Output",s.output.sizeKB)})]}),s.costumeEvaluation&&e.jsxs("div",{className:`p-2 rounded text-xs ${s.costumeEvaluation.pass?"bg-emerald-50 border border-emerald-200":"bg-amber-50 border border-amber-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-semibold ${s.costumeEvaluation.pass?"text-emerald-700":"text-amber-700"}`,children:"Costume Check:"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${s.costumeEvaluation.pass?"bg-emerald-200 text-emerald-800":"bg-amber-200 text-amber-800"}`,children:s.costumeEvaluation.pass?"PASS":"FAIL"}),e.jsxs("span",{className:"text-gray-500",children:["(",s.costumeEvaluation.confidence," confidence)"]})]}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.costumeEvaluation.reason}),s.costumeEvaluation.details&&e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-[10px]",children:[e.jsxs("div",{className:`p-1 rounded ${((ie=s.costumeEvaluation.details.bottomLeft)==null?void 0:ie.costumeMatch)==="full"?"bg-emerald-100":((ce=s.costumeEvaluation.details.bottomLeft)==null?void 0:ce.costumeMatch)==="none"?"bg-red-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-semibold",children:"Bottom-Left:"})," ",((xe=s.costumeEvaluation.details.bottomLeft)==null?void 0:xe.costumeMatch)||"N/A",((be=s.costumeEvaluation.details.bottomLeft)==null?void 0:be.description)&&e.jsx("div",{className:"text-gray-600 truncate",children:s.costumeEvaluation.details.bottomLeft.description})]}),e.jsxs("div",{className:`p-1 rounded ${((fe=s.costumeEvaluation.details.bottomRight)==null?void 0:fe.costumeMatch)==="full"?"bg-emerald-100":((je=s.costumeEvaluation.details.bottomRight)==null?void 0:je.costumeMatch)==="none"?"bg-red-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-semibold",children:"Bottom-Right:"})," ",((ze=s.costumeEvaluation.details.bottomRight)==null?void 0:ze.costumeMatch)||"N/A",((De=s.costumeEvaluation.details.bottomRight)==null?void 0:De.description)&&e.jsx("div",{className:"text-gray-600 truncate",children:s.costumeEvaluation.details.bottomRight.description})]})]})]}),!s.success&&s.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:s.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(s.timestamp).toLocaleString()]})]})]},i)})]})]}),se&&se.length>0&&e.jsxs("details",{className:"bg-slate-50 border-2 border-slate-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-slate-800 hover:text-slate-900 flex items-center gap-2",children:[e.jsx(is,{size:20}),t==="de"?`Generierungslog (${se.length})`:t==="fr"?`Journal de g√©n√©ration (${se.length})`:`Generation Log (${se.length})`,se.filter(s=>s.level==="warn").length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-yellow-200 text-yellow-800 text-xs rounded-full",children:[se.filter(s=>s.level==="warn").length," warnings"]}),se.filter(s=>s.level==="error").length>0&&e.jsxs("span",{className:"ml-1 px-2 py-0.5 bg-red-200 text-red-800 text-xs rounded-full",children:[se.filter(s=>s.level==="error").length," errors"]})]}),e.jsx("div",{className:"mt-4 space-y-1 max-h-96 overflow-y-auto",children:se.map((s,i)=>e.jsxs("div",{className:`text-xs p-2 rounded flex items-start gap-2 ${s.level==="error"?"bg-red-50 text-red-800":s.level==="warn"?"bg-yellow-50 text-yellow-800":s.level==="debug"?"bg-gray-50 text-gray-600":"bg-white text-slate-700"}`,children:[e.jsx("span",{className:"text-gray-400 font-mono text-[10px] whitespace-nowrap",children:new Date(s.timestamp).toLocaleTimeString()}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium whitespace-nowrap ${s.stage==="outline"?"bg-blue-100 text-blue-700":s.stage==="avatars"?"bg-purple-100 text-purple-700":s.stage==="scenes"?"bg-green-100 text-green-700":s.stage==="images"?"bg-orange-100 text-orange-700":s.stage==="covers"?"bg-pink-100 text-pink-700":"bg-gray-100 text-gray-700"}`,children:s.stage}),s.character&&e.jsxs("span",{className:"font-medium text-slate-600",children:["[",s.character,"]"]}),e.jsx("span",{className:"flex-1",children:s.message}),e.jsx("span",{className:"text-gray-400 text-[10px]",children:s.event})]},i))})]}),((Zt=o==null?void 0:o.entity)==null?void 0:Zt.grids)&&o.entity.grids.length>0&&e.jsxs("details",{className:`border-2 rounded-xl p-4 ${o.entity.overallConsistent!==!1?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("summary",{className:`cursor-pointer text-lg font-bold flex items-center gap-2 ${o.entity.overallConsistent!==!1?"text-green-800 hover:text-green-900":"text-amber-800 hover:text-amber-900"}`,children:[o.entity.overallConsistent!==!1?"‚úì":"‚ö†Ô∏è",t==="de"?`Charakterkonsistenz (${o.entity.totalIssues||0} Probleme)`:t==="fr"?`Coh√©rence des personnages (${o.entity.totalIssues||0} probl√®mes)`:`Character Consistency (${o.entity.totalIssues||0} issues)`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700",children:o.entity.summary}),(()=>{var a;const i=(((a=o.entity)==null?void 0:a.grids)||[]).filter((l,r)=>!l.gridImage&&gs[r]===void 0).length;return i===0?null:e.jsx("button",{onClick:Tr,disabled:hs.size>0,className:"text-xs px-3 py-1.5 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-blue-300",children:hs.size>0?`Loading ${hs.size} grids...`:`Load All Grids (${i})`})})(),e.jsx("div",{className:"space-y-2",children:o.entity.grids.map((s,i)=>{var O,I,J,Y,ie,ce,xe,be,fe,je,ze,De,us,bs,fs,js,ys,Ns,vs,ws,Ss,k,ge,rr,ar,ir,nr,lr,or,dr,cr,xr,mr,pr,gr,hr,ur,br,fr,jr,yr,Nr;const a=(I=(O=o.entity)==null?void 0:O.characters)==null?void 0:I[s.entityName],l=(a==null?void 0:a.overallConsistent)??(a==null?void 0:a.consistent)??!0,r=(a==null?void 0:a.overallScore)??(a==null?void 0:a.score)??0,v=(a==null?void 0:a.issues)??[],g=s.clothingCategory;return e.jsxs("details",{className:`bg-white border rounded-lg overflow-hidden ${l?"border-green-200":"border-amber-200"}`,children:[e.jsxs("summary",{className:"cursor-pointer p-3 flex items-center gap-2 hover:bg-gray-50",children:[e.jsx("span",{className:`text-sm ${l?"text-green-600":"text-amber-600"}`,children:l?"‚úì":"‚ö†Ô∏è"}),e.jsxs("span",{className:"font-medium text-sm text-gray-800",children:[s.entityName,g&&e.jsx("span",{className:`ml-1.5 text-xs font-normal px-1.5 py-0.5 rounded ${g.startsWith("costumed:")?"bg-purple-100 text-purple-700":g==="winter"?"bg-blue-100 text-blue-700":g==="summer"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:g})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.cellCount," appearance",s.cellCount!==1?"s":"",")"]}),e.jsxs("span",{className:`ml-auto text-xs px-2 py-0.5 rounded ${r>=8?"bg-green-100 text-green-700":r>=5?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:["Score: ",r,"/10"]})]}),e.jsxs("div",{className:"p-3 border-t border-gray-100 space-y-3",children:[(()=>{const j=s.gridImage||gs[i],M=hs.has(i),L=s.gridImageSizeKB;return j?e.jsx("div",{className:"flex justify-center bg-gray-50 rounded p-2",children:e.jsx("img",{src:j,alt:`${s.entityName} consistency grid`,className:"max-w-full h-auto rounded shadow-sm cursor-pointer hover:opacity-90 transition-opacity",style:{maxHeight:"400px"},onClick:()=>X({src:j,title:`${s.entityName}${g?` (${g})`:""} - Entity Consistency Grid`}),title:"Click to enlarge"})}):M?e.jsx("div",{className:"flex justify-center items-center bg-gray-100 rounded p-4 h-32",children:e.jsx("span",{className:"text-sm text-gray-500",children:"Loading grid image..."})}):e.jsxs("div",{className:"flex flex-col items-center bg-gray-100 rounded p-4",children:[e.jsxs("span",{className:"text-xs text-gray-500 mb-2",children:["Grid image not loaded ",L?`(${L} KB)`:""]}),e.jsx("button",{onClick:()=>Et(i),className:"text-xs px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Load Grid"})]})})(),((J=s.manifest)==null?void 0:J.cells)&&e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Cells: "}),s.manifest.cells.map((j,M)=>{const L=s.gridImage||gs[i];return e.jsxs("span",{className:"inline-flex items-center bg-gray-100 rounded px-1.5 py-0.5 mr-1 mb-1 gap-1",children:[e.jsxs("button",{onClick:()=>L&&Vr({...s,gridImage:L},M),className:`${L?"hover:text-blue-600 hover:underline cursor-pointer":"text-gray-400 cursor-not-allowed"}`,title:L?"Click to enlarge this cell":"Load grid image first",disabled:!L,children:[j.letter,": ",j.isReference?"Ref":`P${j.pageNumber}`,j.clothing&&j.clothing!=="standard"&&` (${j.clothing})`]}),!j.isReference&&B&&typeof j.pageNumber=="number"&&e.jsx("button",{onClick:Ce=>{Ce.stopPropagation(),Ur(s.entityName,j.pageNumber)},disabled:c||ae!==null||Je!==null,className:`ml-0.5 px-1 py-0 text-[9px] rounded transition-colors ${(ae==null?void 0:ae.entity)===s.entityName&&(ae==null?void 0:ae.page)===j.pageNumber?"bg-amber-300 text-amber-800":c||ae!==null||Je!==null?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"}`,title:`Repair page ${j.pageNumber} for ${s.entityName}`,children:(ae==null?void 0:ae.entity)===s.entityName&&(ae==null?void 0:ae.page)===j.pageNumber?"...":"‚ö°"})]},M)})]}),v.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700",children:"Issues:"}),v.map((j,M)=>{var L;return e.jsxs("div",{className:`text-xs p-2 rounded ${j.severity==="critical"?"bg-red-50 border-l-4 border-red-400":j.severity==="major"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${j.severity==="critical"?"bg-red-200 text-red-800":j.severity==="major"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:j.severity}),j.cells&&e.jsxs("span",{className:"text-gray-500",children:["Cells: ",j.cells.map((Ce,Oe)=>{var Cs;const Xs=(((Cs=s.manifest)==null?void 0:Cs.cells)||[]).some(vr=>vr.letter===Ce&&!vr.isReference);return e.jsxs("span",{className:Xs?"font-semibold text-gray-800":"text-gray-400",children:[Oe>0?", ":"",Ce]},Oe)})]}),j.pagesToFix&&j.pagesToFix.length>0&&(()=>{var Oe;const Ce=new Set((((Oe=s.manifest)==null?void 0:Oe.cells)||[]).filter(ee=>!ee.isReference&&ee.pageNumber!=null).map(ee=>ee.pageNumber));return e.jsxs("span",{className:"text-[10px]",children:["Fix: Page"," ",j.pagesToFix.map((ee,Xs)=>{const Cs=Ce.has(ee);return e.jsxs("span",{className:`px-1 py-0.5 rounded ${Cs?"bg-orange-200 text-orange-800 font-semibold":"bg-gray-200 text-gray-500"}`,title:Cs?"Visible in grid above":"Not in this grid",children:[Xs>0?" ":"",ee]},Xs)})]})})(),j.clothingCategory&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded text-[10px]",children:j.clothingCategory}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:j.subType||((L=j.type)==null?void 0:L.replace(/_/g," "))})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:j.description}),j.fixInstruction&&e.jsxs("p",{className:"text-green-700 mt-1 text-[10px]",children:["‚Üí ",j.fixInstruction]})]},M)})]}),B&&(!l||r<8)&&s.entityType==="character"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>Wr(s.entityName),disabled:c||Je!==null,className:`flex items-center gap-2 px-3 py-1.5 text-xs font-medium rounded transition-colors ${c||Je!==null?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"}`,children:Je===s.entityName?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{children:"Repairing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"w-3 h-3"}),e.jsx("span",{children:"Repair All"})]})}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Regenerate all appearances to match reference"})]}),((Y=o.entityRepairs)==null?void 0:Y[s.entityName])&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-green-700",children:"‚úì Repaired"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(ce=(ie=o.entityRepairs)==null?void 0:ie[s.entityName])!=null&&ce.cellsRepaired?`${(xe=o.entityRepairs[s.entityName])==null?void 0:xe.cellsRepaired} pages updated`:(fe=(be=o.entityRepairs)==null?void 0:be[s.entityName])!=null&&fe.pages?`${Object.keys(((je=o.entityRepairs[s.entityName])==null?void 0:je.pages)||{}).length} page(s) repaired individually`:"",(((De=(ze=o.entityRepairs)==null?void 0:ze[s.entityName])==null?void 0:De.clothingGroupCount)??0)>1&&` (${(bs=(us=o.entityRepairs)==null?void 0:us[s.entityName])==null?void 0:bs.clothingGroupCount} clothing groups)`]})]}),(ys=(js=(fs=o.entityRepairs)==null?void 0:fs[s.entityName])==null?void 0:js.gridsByClothing)!=null&&ys.length?e.jsx("div",{className:"space-y-3",children:(ws=(vs=(Ns=o.entityRepairs)==null?void 0:Ns[s.entityName])==null?void 0:vs.gridsByClothing)==null?void 0:ws.map(j=>{var M;return e.jsxs("div",{className:"border border-gray-200 rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700",children:j.clothingCategory}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:["(",j.cropCount," crops, ref: ",j.referenceUsed,")"]})]}),(M=j.cellComparisons)!=null&&M.length?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[9px] font-medium text-gray-500 px-1",children:[e.jsx("span",{children:"Cell"}),e.jsx("span",{children:"Before"}),e.jsx("span",{children:"After"}),e.jsx("span",{children:"Diff"})]}),j.cellComparisons.map(L=>e.jsxs("div",{className:"grid grid-cols-4 gap-1 items-center bg-gray-50 rounded p-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700",children:L.letter}),e.jsxs("div",{className:"text-[9px] text-gray-400",children:["P",L.pageNumber]})]}),e.jsx("img",{src:L.before,alt:`${L.letter} before`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>L.before&&X({src:L.before,title:`${s.entityName} - Cell ${L.letter} Page ${L.pageNumber} Before (${j.clothingCategory})`})}),e.jsx("img",{src:L.after,alt:`${L.letter} after`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>L.after&&X({src:L.after,title:`${s.entityName} - Cell ${L.letter} Page ${L.pageNumber} After (${j.clothingCategory})`})}),e.jsx("div",{className:"bg-gray-900 rounded",children:e.jsx("img",{src:L.diff,alt:`${L.letter} diff`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>L.diff&&X({src:L.diff,title:`${s.entityName} - Cell ${L.letter} Page ${L.pageNumber} Diff (${j.clothingCategory})`})})})]},`${j.clothingCategory}-${L.letter}`))]}):e.jsxs("div",{className:`grid gap-2 ${j.gridDiff?"grid-cols-3":"grid-cols-2"}`,children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] font-medium text-gray-500",children:"Before"}),e.jsx("div",{className:"bg-gray-50 rounded p-0.5",children:e.jsx("img",{src:j.gridBefore,alt:"Before repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>j.gridBefore&&X({src:j.gridBefore,title:`${s.entityName} - ${j.clothingCategory} Grid Before`})})})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] font-medium text-gray-500",children:"After"}),e.jsx("div",{className:"bg-gray-50 rounded p-0.5",children:e.jsx("img",{src:j.gridAfter,alt:"After repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>j.gridAfter&&X({src:j.gridAfter,title:`${s.entityName} - ${j.clothingCategory} Grid After`})})})]}),j.gridDiff&&e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] font-medium text-gray-500",children:"Diff"}),e.jsx("div",{className:"bg-gray-900 rounded p-0.5",children:e.jsx("img",{src:j.gridDiff,alt:"Difference",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>X({src:j.gridDiff,title:`${s.entityName} - ${j.clothingCategory} Grid Diff`})})})]})]})]},j.clothingCategory)})}):(ge=(k=(Ss=o.entityRepairs)==null?void 0:Ss[s.entityName])==null?void 0:k.cellComparisons)!=null&&ge.length?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[10px] font-medium text-gray-500 px-1",children:[e.jsx("span",{children:"Cell"}),e.jsx("span",{children:"Before"}),e.jsx("span",{children:"After"}),e.jsx("span",{children:"Diff"})]}),(ir=(ar=(rr=o.entityRepairs)==null?void 0:rr[s.entityName])==null?void 0:ar.cellComparisons)==null?void 0:ir.map(j=>e.jsxs("div",{className:"grid grid-cols-4 gap-1 items-center bg-gray-50 rounded p-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700",children:j.letter}),e.jsxs("div",{className:"text-[9px] text-gray-400",children:["P",j.pageNumber]})]}),e.jsx("img",{src:j.before,alt:`${j.letter} before`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>j.before&&X({src:j.before,title:`${s.entityName} - Cell ${j.letter} Page ${j.pageNumber} Before`})}),e.jsx("img",{src:j.after,alt:`${j.letter} after`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>j.after&&X({src:j.after,title:`${s.entityName} - Cell ${j.letter} Page ${j.pageNumber} After`})}),e.jsx("div",{className:"bg-gray-900 rounded",children:e.jsx("img",{src:j.diff,alt:`${j.letter} diff`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>j.diff&&X({src:j.diff,title:`${s.entityName} - Cell ${j.letter} Page ${j.pageNumber} Diff`})})})]},j.letter))]}):(lr=(nr=o.entityRepairs)==null?void 0:nr[s.entityName])!=null&&lr.pages&&Object.keys(((or=o.entityRepairs[s.entityName])==null?void 0:or.pages)||{}).length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[10px] font-medium text-gray-500 px-1",children:[e.jsx("span",{children:"Page"}),e.jsx("span",{children:"Before"}),e.jsx("span",{children:"After"}),e.jsx("span",{children:"Diff"})]}),Object.entries(((dr=o.entityRepairs[s.entityName])==null?void 0:dr.pages)||{}).map(([j,M])=>{var L,Ce,Oe;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 items-center bg-gray-50 rounded p-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-700",children:["P",j]}),M.clothingCategory&&M.clothingCategory!=="standard"&&e.jsx("div",{className:"text-[8px] text-gray-400",children:M.clothingCategory})]}),e.jsx("img",{src:(L=M.comparison)==null?void 0:L.before,alt:`P${j} before`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var ee;return((ee=M.comparison)==null?void 0:ee.before)&&X({src:M.comparison.before,title:`${s.entityName} - Page ${j} Before${M.clothingCategory?` (${M.clothingCategory})`:""}`})}}),e.jsx("img",{src:(Ce=M.comparison)==null?void 0:Ce.after,alt:`P${j} after`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var ee;return((ee=M.comparison)==null?void 0:ee.after)&&X({src:M.comparison.after,title:`${s.entityName} - Page ${j} After${M.clothingCategory?` (${M.clothingCategory})`:""}`})}}),e.jsx("div",{className:"bg-gray-900 rounded",children:e.jsx("img",{src:(Oe=M.comparison)==null?void 0:Oe.diff,alt:`P${j} diff`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var ee;return((ee=M.comparison)==null?void 0:ee.diff)&&X({src:M.comparison.diff,title:`${s.entityName} - Page ${j} Diff${M.clothingCategory?` (${M.clothingCategory})`:""}`})}})})]}),M.promptUsed&&e.jsxs("details",{className:"text-[10px]",children:[e.jsx("summary",{className:"cursor-pointer text-blue-600 hover:text-blue-800",children:"Show Prompt"}),e.jsx("pre",{className:"mt-1 p-2 bg-gray-100 rounded text-gray-700 whitespace-pre-wrap overflow-x-auto max-h-48 text-[9px]",children:M.promptUsed})]})]},j)})]}):(xr=(cr=o.entityRepairs)==null?void 0:cr[s.entityName])!=null&&xr.gridBeforeRepair?e.jsxs("div",{className:`grid gap-3 ${(pr=(mr=o.entityRepairs)==null?void 0:mr[s.entityName])!=null&&pr.gridDiff?"grid-cols-3":"grid-cols-2"}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"Before Repair"}),e.jsx("div",{className:"bg-gray-50 rounded p-1",children:e.jsx("img",{src:(hr=(gr=o.entityRepairs)==null?void 0:gr[s.entityName])==null?void 0:hr.gridBeforeRepair,alt:"Before repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var M,L;const j=(L=(M=o.entityRepairs)==null?void 0:M[s.entityName])==null?void 0:L.gridBeforeRepair;j&&X({src:j,title:`${s.entityName} - Grid Before Repair`})}})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"After Repair"}),e.jsx("div",{className:"bg-gray-50 rounded p-1",children:e.jsx("img",{src:(br=(ur=o.entityRepairs)==null?void 0:ur[s.entityName])==null?void 0:br.gridAfterRepair,alt:"After repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var M,L;const j=(L=(M=o.entityRepairs)==null?void 0:M[s.entityName])==null?void 0:L.gridAfterRepair;j&&X({src:j,title:`${s.entityName} - Grid After Repair`})}})})]}),((jr=(fr=o.entityRepairs)==null?void 0:fr[s.entityName])==null?void 0:jr.gridDiff)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"Difference"}),e.jsx("div",{className:"bg-gray-900 rounded p-1",children:e.jsx("img",{src:((Nr=(yr=o.entityRepairs)==null?void 0:yr[s.entityName])==null?void 0:Nr.gridDiff)??void 0,alt:"Difference",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var M,L;const j=(L=(M=o.entityRepairs)==null?void 0:M[s.entityName])==null?void 0:L.gridDiff;j&&X({src:j,title:`${s.entityName} - Grid Diff`})}})})]})]}):null]})]})]},i)})})]})]}),o&&e.jsxs("details",{className:`border-2 rounded-xl p-4 ${o.overallConsistent?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("summary",{className:`cursor-pointer text-lg font-bold flex items-center gap-2 ${o.overallConsistent?"text-green-800 hover:text-green-900":"text-amber-800 hover:text-amber-900"}`,children:[o.overallConsistent?"‚úì":"‚ö†Ô∏è",t==="de"?`Konsistenzpr√ºfung (${(o.totalIssues||0)-(((Yt=o.entity)==null?void 0:Yt.totalIssues)||0)} Probleme)`:t==="fr"?`V√©rification de coh√©rence (${(o.totalIssues||0)-(((Xt=o.entity)==null?void 0:Xt.totalIssues)||0)} probl√®mes)`:`Final Checks (${(o.totalIssues||0)-(((er=o.entity)==null?void 0:er.totalIssues)||0)} issues)`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700",children:o.summary}),o.imageChecks&&o.imageChecks.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:t==="de"?"Bildkonsistenz":t==="fr"?"Coh√©rence des images":"Image Consistency"}),o.imageChecks.map((s,i)=>{var a,l;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${s.consistent?"text-green-600":"text-amber-600"}`,children:s.consistent?"‚úì":"‚ö†Ô∏è"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:s.type==="full"?"Full Check":s.type==="character"?`Character: ${s.characterName}`:s.type==="sequence"?"Sequence Check":s.type}),s.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",s.overallScore,"/10"]})]}),s.issues&&s.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:s.issues.map((r,v)=>{var g,O;return e.jsxs("div",{className:`text-xs p-2 rounded ${r.severity==="high"?"bg-red-50 border-l-4 border-red-400":r.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${r.severity==="high"?"bg-red-200 text-red-800":r.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:r.severity}),e.jsxs("span",{className:"text-gray-500",children:["Pages ",(g=r.images)==null?void 0:g.join(", ")]}),r.pagesToFix&&r.pagesToFix.length>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-orange-100 text-orange-700 rounded text-[10px]",children:["Fix: ",r.pagesToFix.join(", ")]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:(O=r.type)==null?void 0:O.replace(/_/g," ")}),r.characterInvolved&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded text-[10px]",children:r.characterInvolved})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:r.description}),r.details&&Object.keys(r.details).length>0&&e.jsx("div",{className:"mt-1 pl-2 border-l-2 border-gray-200",children:Object.entries(r.details).map(([I,J])=>e.jsxs("p",{className:"text-gray-500 text-[10px]",children:[e.jsxs("span",{className:"font-medium",children:[I,":"]})," ",J]},I))}),r.canonicalVersion&&e.jsxs("p",{className:"text-blue-700 mt-1",children:["üéØ Target: ",r.canonicalVersion]}),r.recommendation&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:["üí° ",r.recommendation]}),B&&r.pagesToFix&&r.pagesToFix.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:r.pagesToFix.map(I=>e.jsx("button",{onClick:()=>Kr(I,r),disabled:c||xs!==null,className:`flex items-center gap-1 px-2 py-1 text-[10px] font-medium rounded transition-colors ${xs===I?"bg-amber-300 text-amber-800":c||xs!==null?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"}`,children:xs===I?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"w-3 h-3 animate-spin"}),e.jsxs("span",{children:["Repairing P",I,"..."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"w-3 h-3"}),e.jsxs("span",{children:["Repair P",I]})]})},I))})]},v)})}),s.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:s.summary}),(s.evaluationPrompts||s.evaluationPrompt)&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:["üîç View Evaluation Prompt",(((a=s.evaluationPrompts)==null?void 0:a.length)??0)>1?`s (${(l=s.evaluationPrompts)==null?void 0:l.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:(s.evaluationPrompts??(s.evaluationPrompt?[s.evaluationPrompt]:[])).map((r,v)=>{var g;return e.jsxs("div",{children:[(((g=s.evaluationPrompts)==null?void 0:g.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-blue-700 mb-1",children:["Batch ",v+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto bg-white p-2 rounded border",children:r})]},v)})})]}),e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"üîß View Parsed Result (Full JSON)"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-96 overflow-y-auto bg-white p-2 rounded border",children:JSON.stringify({type:s.type,characterName:s.characterName,consistent:s.consistent,overallScore:s.overallScore,issues:s.issues,summary:s.summary},null,2)})]}),s.rawResponses&&s.rawResponses.length>0&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:["üìù View Raw Response",s.rawResponses.length>1?`s (${s.rawResponses.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:s.rawResponses.map((r,v)=>{var g;return e.jsxs("div",{children:[(((g=s.rawResponses)==null?void 0:g.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-purple-700 mb-1",children:["Batch ",v+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto bg-white p-2 rounded border",children:r})]},v)})})]})]},i)})]}),o.textCheck&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:t==="de"?"Textqualit√§t":t==="fr"?"Qualit√© du texte":"Text Quality"}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${o.textCheck.quality==="good"?"text-green-600":o.textCheck.quality==="needs_review"?"text-amber-600":"text-red-600"}`,children:o.textCheck.quality==="good"?"‚úì":"‚ö†Ô∏è"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:o.textCheck.quality==="good"?"Good":o.textCheck.quality==="needs_review"?"Needs Review":"Has Issues"}),o.textCheck.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",o.textCheck.overallScore,"/10"]})]}),o.textCheck.issues&&o.textCheck.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:o.textCheck.issues.map((s,i)=>e.jsxs("div",{className:`text-xs p-2 rounded ${s.severity==="high"?"bg-red-50 border-l-4 border-red-400":s.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${s.severity==="high"?"bg-red-200 text-red-800":s.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:s.severity}),s.page&&e.jsxs("span",{className:"text-gray-500",children:["Page ",s.page]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:s.type})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:s.issue}),(s.originalText||s.text)&&e.jsxs("p",{className:"text-red-600 mt-1 line-through",children:['"',s.originalText||s.text,'"']}),s.correctedText&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:['‚úì "',s.correctedText,'"']}),!s.correctedText&&s.suggestion&&e.jsxs("p",{className:"text-green-700 mt-1",children:["‚Üí ",s.suggestion]})]},i))}),o.textCheck.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:o.textCheck.summary}),o.textCheck.fullOriginalText&&e.jsxs("details",{className:"mt-3 bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-gray-700",children:"üìÑ View Original Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-600 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:o.textCheck.fullOriginalText})]}),o.textCheck.fullCorrectedText&&e.jsxs("details",{className:"mt-3 bg-green-50 border border-green-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-green-800",children:"üìã View Full Corrected Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:o.textCheck.fullCorrectedText})]}),o.textCheck.rawResponse&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:"üìù View Raw Response"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:o.textCheck.rawResponse})]}),o.textCheck&&e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"üîß View Parsed Result"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:JSON.stringify({quality:o.textCheck.quality,overallScore:o.textCheck.overallScore,issues:o.textCheck.issues,summary:o.textCheck.summary,parseError:o.textCheck.parseError},null,2)})]}),o.textCheck.evaluationPrompt&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:"üîç View Evaluation Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:o.textCheck.evaluationPrompt})]})]})]}),o.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-2 text-xs text-red-700",children:["Error: ",o.error]})]})]}),w.length>0&&e.jsxs("details",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-green-800 hover:text-green-900 flex items-center gap-2",children:[e.jsx(is,{size:20}),t==="de"?`Alle Szenenbeschreibungen (${w.length})`:t==="fr"?`Toutes les descriptions de sc√®nes (${w.length})`:`All Scene Descriptions (${w.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:w.map(s=>e.jsxs("details",{className:"bg-white border border-green-200 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-700 hover:text-green-800",children:_==="de"?`Seite ${s.pageNumber}`:_==="fr"?`Page ${s.pageNumber}`:`Page ${s.pageNumber}`}),e.jsxs("div",{className:"mt-2 space-y-2",children:[s.outlineExtract&&e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-amber-700",children:"Outline Extract:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:s.outlineExtract})]}),s.scenePrompt&&e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-purple-700",children:"Scene Prompt:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:s.scenePrompt})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Scene Description:"}),s.textModelId&&e.jsxs("span",{className:"ml-2 text-green-600",children:["(",s.textModelId,")"]}),e.jsx("pre",{className:"text-gray-700 mt-1 whitespace-pre-wrap font-mono text-xs overflow-x-auto",children:(()=>{var r;const i=v=>{if(typeof v!="string")return v;try{const g=JSON.parse(v);return typeof g=="string"&&(g.startsWith("{")||g.startsWith("["))?i(g):g}catch{return v}},a=typeof s.description=="object"&&((r=s.description)!=null&&r.text)?s.description.text:s.description,l=i(a);return typeof l=="object"&&l!==null?JSON.stringify(l,null,2):String(l)})()})]})]})]},s.pageNumber))})]})]}),f&&(ts(f.frontCover)||((sr=f.frontCover)==null?void 0:sr.hasImage))&&(()=>{var l,r;const s=f.frontCover,i=ts(f.frontCover),a=!i&&(s==null?void 0:s.hasImage);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:_==="de"?"Titelseite":_==="fr"?"Couverture":"Front Cover"}),e.jsxs("div",{className:"relative",children:[a?e.jsxs("div",{className:"aspect-[3/4] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-lg flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-600 font-medium",children:_==="de"?"Cover wird geladen...":_==="fr"?"Chargement de la couverture...":"Loading cover..."})]}):e.jsx(et,{src:i,alt:"Front Cover",className:"w-full rounded-lg shadow-lg",label:"Front Cover"}),z.has("frontCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(me,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),H&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>pt("front"),disabled:c||!re||z.has("frontCover"),className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||!re||z.has("frontCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:re?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx($e,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Ie," ",t==="de"?"Credits":"credits",")"]})]}),Se("frontCover").length>1&&e.jsxs("button",{onClick:()=>ds({coverType:"frontCover",versions:Se("frontCover")}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(ye,{size:14}),Se("frontCover").length]})]}),Z&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[E&&e.jsxs("button",{onClick:()=>E("front"),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(oe,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:(()=>{const v=J=>{if(typeof J!="string")return J;try{const Y=JSON.parse(J);return typeof Y=="string"&&(Y.startsWith("{")||Y.startsWith("["))?v(Y):Y}catch{return J}},g=s.description,O=typeof g=="object"&&(g!=null&&g.text)?g.text:g,I=v(O);return typeof I=="object"&&I!==null?JSON.stringify(I,null,2):String(I)})()})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:s.prompt})]}),((((l=s.referencePhotos)==null?void 0:l.length)??0)>0||(((r=s.landmarkPhotos)==null?void 0:r.length)??0)>0||s.visualBibleGrid)&&e.jsx(ks,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,visualBibleGrid:s.visualBibleGrid,language:t}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),e.jsx($s,{retryHistory:s.retryHistory,bboxDetection:s.bboxDetection,bboxOverlayImage:s.bboxOverlayImage,language:t,storyId:B,coverType:"front"}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(ns,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:t}),s.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[t==="de"?"Vorherige Version":t==="fr"?"Version pr√©c√©dente":"Previous Version",s.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(s.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),s.originalImage&&s.originalImage!==s.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[t==="de"?"Originalbild":t==="fr"?"Image originale":"Original Image",s.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(s.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),f&&ts(f.initialPage)&&(()=>{var i,a;const s=f.initialPage;return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:_==="de"?"Widmungsseite":_==="fr"?"Page de d√©dicace":"Dedication Page"}),e.jsxs("div",{className:"relative",children:[e.jsx(et,{src:ts(f.initialPage),alt:"Dedication Page",className:"w-full rounded-lg shadow-lg",label:"Dedication Page"}),z.has("initialPage")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(me,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),H&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>pt("initial"),disabled:c||!re||z.has("initialPage"),className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||!re||z.has("initialPage")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:re?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx($e,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Ie," ",t==="de"?"Credits":"credits",")"]})]}),Se("initialPage").length>1&&e.jsxs("button",{onClick:()=>ds({coverType:"initialPage",versions:Se("initialPage")}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(ye,{size:14}),Se("initialPage").length]})]}),Z&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[E&&e.jsxs("button",{onClick:()=>E("initial"),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(oe,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:(()=>{const l=O=>{if(typeof O!="string")return O;try{const I=JSON.parse(O);return typeof I=="string"&&(I.startsWith("{")||I.startsWith("["))?l(I):I}catch{return O}},r=s.description,v=typeof r=="object"&&(r!=null&&r.text)?r.text:r,g=l(v);return typeof g=="object"&&g!==null?JSON.stringify(g,null,2):String(g)})()})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:s.prompt})]}),((((i=s.referencePhotos)==null?void 0:i.length)??0)>0||(((a=s.landmarkPhotos)==null?void 0:a.length)??0)>0||s.visualBibleGrid)&&e.jsx(ks,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,visualBibleGrid:s.visualBibleGrid,language:t}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),e.jsx($s,{retryHistory:s.retryHistory,bboxDetection:s.bboxDetection,bboxOverlayImage:s.bboxOverlayImage,language:t,storyId:B,coverType:"initial"}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(ns,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:t}),s.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[t==="de"?"Vorherige Version":t==="fr"?"Version pr√©c√©dente":"Previous Version",s.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(s.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),s.originalImage&&s.originalImage!==s.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[t==="de"?"Originalbild":t==="fr"?"Image originale":"Original Image",s.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(s.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),Ne&&!x&&(f==null?void 0:f.frontCover)&&e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-8 mt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-indigo-700",children:_==="de"?"Geschichte wird erstellt...":_==="fr"?"Cr√©ation de l'histoire...":"Creating your story..."}),e.jsx("p",{className:"text-indigo-500 mt-2",children:_==="de"?"Die Seiten werden gleich angezeigt":_==="fr"?"Les pages seront bient√¥t affich√©es":"Pages will appear shortly"})]})}),ss&&x&&e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 text-center mb-6",children:d||(_==="de"?"Ihre Geschichte":_==="fr"?"Votre histoire":"Your Story")}),es.slice(0,Ne?qt:es.length).map((s,i)=>{var J,Y,ie,ce,xe,be,fe,je,ze,De,us,bs,fs,js,ys,Ns,vs,ws,Ss;const a=i+1,l=a,r=N.find(k=>k.pageNumber===l),v=Ne?yt[l]:void 0,g=!!(r!=null&&r.imageData||v),O=Ne&&a===qt&&!g,I=!Ne&&(r==null?void 0:r.hasImage)&&!(r!=null&&r.imageData);return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-4 text-center",children:_==="de"?`Seite ${a}`:_==="fr"?`Page ${a}`:`Page ${a}`}),Js?e.jsxs("div",{className:"flex flex-col items-center max-w-2xl mx-auto",children:[O||I?e.jsxs("div",{className:"w-full mb-4 aspect-[4/3] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-md flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-600 font-medium",children:I?_==="de"?"Bild wird geladen...":_==="fr"?"Chargement de l'image...":"Loading image...":_==="de"?"Bild wird erstellt...":_==="fr"?"Cr√©ation de l'image...":"Creating image..."}),O&&e.jsx("p",{className:"text-indigo-400 text-sm mt-1",children:_==="de"?"Die n√§chste Seite erscheint bald":_==="fr"?"La page suivante arrive bient√¥t":"Next page coming soon"})]}):r!=null&&r.imageData||v?e.jsxs("div",{className:"w-full mb-4 relative",children:[e.jsx(et,{src:((r==null?void 0:r.imageData)||v)??"",alt:`Scene for page ${a}`,className:`w-full rounded-lg shadow-md object-cover ${ve.has(a)?"opacity-50":""}`,label:`Page ${a}`}),ve.has(a)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(Me,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:t==="de"?"Neues Bild wird erstellt...":t==="fr"?"Nouvelle image en cours...":"Generating new image..."})]}),u&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>_t(a),disabled:c||ve.has(a)||!re,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||ve.has(a)||!re?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:re?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx($e,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Ie," ",t==="de"?"Credits":"credits",")"]})]}),zs&&e.jsxs("button",{onClick:()=>Ds(!0),disabled:c,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(oe,{size:14}),t==="de"?"Text bearbeiten":t==="fr"?"Modifier le texte":"Edit Text"]}),Xe(a).length>1&&e.jsxs("button",{onClick:()=>Bs({pageNumber:a,versions:Xe(a)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(ye,{size:14}),Xe(a).length]})]})}),Z&&e.jsxs("div",{className:"mt-3 space-y-2",children:[Q&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{Ts===a?Be(null):(Be(a),Ms(!1))},disabled:c||Ee!==null||ue!==null,className:`w-full bg-purple-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||Ee!==null||ue!==null?"opacity-50 cursor-not-allowed":"hover:bg-purple-600"}`,title:t==="de"?"Bild analysieren, 17 Checks durchf√ºhren, mit korrigierter Szene neu generieren":t==="fr"?"Analyser l'image, ex√©cuter 17 v√©rifications, r√©g√©n√©rer avec sc√®ne corrig√©e":"Analyze image, run 17 checks, regenerate with corrected scene",children:Ee===a?e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:14,className:"animate-spin"}),t==="de"?"Iteriere...":t==="fr"?"It√©ration...":"Iterating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ht,{size:14}),t==="de"?"N√§chste Iteration":t==="fr"?"Prochaine It√©ration":"Next Iteration"]})}),Ts===a&&e.jsxs("div",{className:"mt-2 bg-purple-50 border border-purple-200 rounded-lg p-3 space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Qe,onChange:k=>Ms(k.target.checked),className:"rounded border-purple-300 text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:t==="de"?"Aktuelles Bild als Referenz":t==="fr"?"Utiliser l'image actuelle comme r√©f√©rence":"Use current image as reference"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:Qe?t==="de"?"Erh√§lt Komposition, kann aber Korrekturen bei vielen Referenzbildern einschr√§nken":t==="fr"?"Pr√©serve la composition mais peut limiter les corrections avec beaucoup d'images de r√©f√©rence":"Preserves composition but may limit corrections with many reference images":t==="de"?"Neue Generierung aus KI-korrigierter Szene":t==="fr"?"Nouvelle g√©n√©ration √† partir de la sc√®ne corrig√©e par l'IA":"Fresh generation from AI-corrected scene"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Mt(a,{useOriginalAsReference:Qe}),className:"flex-1 bg-purple-600 text-white px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-purple-700",children:t==="de"?"Iteration starten":t==="fr"?"D√©marrer l'it√©ration":"Start Iteration"}),e.jsx("button",{onClick:()=>Be(null),className:"px-3 py-1.5 rounded-lg text-sm text-gray-600 hover:bg-purple-100",children:"‚úï"})]})]})]}),q&&e.jsx("button",{onClick:()=>Tt(a),disabled:c||ue!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||ue!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:t==="de"?"Physik-Fehler automatisch erkennen und reparieren":t==="fr"?"D√©tecter et r√©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:ue===a?e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:14,className:"animate-spin"}),t==="de"?"Repariere...":t==="fr"?"R√©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(as,{size:14}),t==="de"?"Auto-Reparatur":t==="fr"?"Auto-R√©paration":"Auto-Repair"]})}),C&&e.jsxs("button",{onClick:()=>C(a),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(oe,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),(r==null?void 0:r.repairHistory)&&r.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(as,{size:14}),t==="de"?"Reparatur-Historie":t==="fr"?"Historique de r√©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",r.repairHistory.length," ",t==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:r.repairHistory.map((k,ge)=>e.jsxs("div",{className:`border rounded-lg p-3 ${k.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[t==="de"?`Reparatur ${k.attempt}`:`Repair ${k.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${k.success?"text-green-600":"text-red-600"}`,children:["(",k.success?"‚úì":"‚úó"," ",k.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:k.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:t==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:t==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",k.fixPrompt]}),k.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:t==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:k.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),k.beforeImage&&k.afterImage&&e.jsxs("div",{className:"flex gap-4 cursor-pointer p-2 -m-2 rounded-lg hover:bg-amber-100 transition-colors",onClick:()=>Vs({beforeImage:k.beforeImage,afterImage:k.afterImage,diffImage:k.diffImage,title:t==="de"?`Reparatur ${k.attempt}`:`Repair ${k.attempt}`}),title:t==="de"?"Klicken f√ºr Vergleichsansicht":"Click to compare",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:k.beforeImage,alt:"Before repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Nachher:":"After:"}),e.jsx("img",{src:k.afterImage,alt:"After repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),k.diffImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:"Diff:"}),e.jsx("img",{src:k.diffImage,alt:"Difference",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(k.timestamp).toLocaleTimeString()})]},ge))})]}),Gs(a)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:t==="de"?"Auszug aus Gliederung":t==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Gs(a)})]}),Zs(a)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:t==="de"?"Szenen-Prompt":t==="fr"?"Prompt de sc√®ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:Zs(a)})]}),Qs(a)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description",Ys(a)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",Ys(a),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Qs(a)})]}),(r==null?void 0:r.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",(r==null?void 0:r.modelId)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:r==null?void 0:r.prompt})]}),((((J=r==null?void 0:r.referencePhotos)==null?void 0:J.length)??0)>0||(((Y=r==null?void 0:r.landmarkPhotos)==null?void 0:Y.length)??0)>0||(r==null?void 0:r.visualBibleGrid)||(r==null?void 0:r.hasVisualBibleGrid))&&r&&e.jsx(ks,{referencePhotos:r.referencePhotos||[],landmarkPhotos:r.landmarkPhotos,visualBibleGrid:r.visualBibleGrid,hasVisualBibleGrid:r.hasVisualBibleGrid,language:t,storyId:B||void 0,pageNumber:a}),(r==null?void 0:r.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",(r==null?void 0:r.qualityModelId)&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${((r==null?void 0:r.qualityScore)??0)>=70?"text-green-600":((r==null?void 0:r.qualityScore)??0)>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round((r==null?void 0:r.qualityScore)??0),"%"]})]}),(r==null?void 0:r.qualityReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),(r==null?void 0:r.semanticResult)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 hover:text-purple-900 flex items-center justify-between",children:[e.jsx("span",{className:"flex items-center gap-2",children:t==="de"?"Semantische Treue":t==="fr"?"Fid√©lit√© s√©mantique":"Semantic Fidelity"}),e.jsx("span",{className:`text-lg font-bold ${(r.semanticScore??0)>=70?"text-green-600":(r.semanticScore??0)>=50?"text-yellow-600":"text-red-600"}`,children:r.semanticScore!==null&&r.semanticScore!==void 0?`${Math.round(r.semanticScore)}%`:"N/A"})]}),e.jsxs("div",{className:"mt-2 text-xs",children:[r.semanticResult.visible&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border border-purple-200",children:[e.jsx("div",{className:"font-medium text-purple-800 mb-1",children:"üëÅÔ∏è Visible:"}),(((ie=r.semanticResult.visible.characters)==null?void 0:ie.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Characters:"})," ",(ce=r.semanticResult.visible.characters)==null?void 0:ce.join(", ")]}),(((xe=r.semanticResult.visible.objects)==null?void 0:xe.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Objects:"})," ",(be=r.semanticResult.visible.objects)==null?void 0:be.join(", ")]}),r.semanticResult.visible.setting&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Setting:"})," ",r.semanticResult.visible.setting]}),r.semanticResult.visible.action&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Action:"})," ",r.semanticResult.visible.action]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-purple-200",children:[e.jsx("div",{className:"font-medium text-purple-800 mb-1",children:"üéØ Expected:"}),(((je=(fe=r.semanticResult.expected)==null?void 0:fe.characters)==null?void 0:je.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Characters:"})," ",(De=(ze=r.semanticResult.expected)==null?void 0:ze.characters)==null?void 0:De.join(", ")]}),(((bs=(us=r.semanticResult.expected)==null?void 0:us.objects)==null?void 0:bs.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Objects:"})," ",(js=(fs=r.semanticResult.expected)==null?void 0:fs.objects)==null?void 0:js.join(", ")]}),((ys=r.semanticResult.expected)==null?void 0:ys.setting)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Setting:"})," ",r.semanticResult.expected.setting]}),((Ns=r.semanticResult.expected)==null?void 0:Ns.action)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Action:"})," ",r.semanticResult.expected.action]})]})]}),((vs=r.semanticResult.semanticIssues)==null?void 0:vs.length)>0&&e.jsx("ul",{className:"list-disc list-inside text-purple-700 bg-white p-2 rounded border border-purple-200",children:r.semanticResult.semanticIssues.map((k,ge)=>e.jsxs("li",{children:[e.jsxs("span",{className:`font-medium ${k.severity==="CRITICAL"?"text-red-600":k.severity==="MAJOR"?"text-orange-600":"text-yellow-600"}`,children:["[",k.severity,"]"]})," ",k.problem]},ge))}),(!r.semanticResult.semanticIssues||r.semanticResult.semanticIssues.length===0)&&!r.semanticResult.visible&&e.jsx("span",{className:"text-green-600",children:"‚úì No semantic issues"})]})]}),e.jsx($s,{retryHistory:r==null?void 0:r.retryHistory,language:t,storyId:B,pageNumber:r==null?void 0:r.pageNumber}),(r==null?void 0:r.retryHistory)&&r.retryHistory.length>0&&e.jsx(ns,{retryHistory:r.retryHistory,totalAttempts:(r==null?void 0:r.totalAttempts)||r.retryHistory.length,language:t,onRevertRepair:A?(k,ge)=>A(r.pageNumber,ge):void 0,storyId:B,pageNumber:r.pageNumber}),(r==null?void 0:r.wasRegenerated)&&(!(r!=null&&r.retryHistory)||r.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["üîÑ ",t==="de"?"Bild regeneriert":t==="fr"?"Image r√©g√©n√©r√©e":"Image Regenerated"]}),(r==null?void 0:r.originalScore)!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(r.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:t==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige Qualit√§t hatte.":t==="fr"?"L'image a √©t√© automatiquement r√©g√©n√©r√©e car la premi√®re version avait une qualit√© faible.":"Image was automatically regenerated because the first version had low quality."}),(r==null?void 0:r.originalImage)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:t==="de"?"Originalbild:":t==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:r.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),(r==null?void 0:r.originalReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Original Feedback:":t==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`w-full flex flex-col items-center justify-center rounded-lg p-8 mb-4 ${c?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:_==="de"?"Bild wird noch erstellt...":_==="fr"?"Image en cours de cr√©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:_==="de"?"Kein Bild f√ºr diese Seite":_==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"w-full bg-indigo-50 rounded-lg p-6 border-2 border-indigo-200",children:Ke?e.jsx("textarea",{value:s.trim(),onChange:k=>Vt(i,k.target.value),className:"w-full min-h-[400px] p-3 text-gray-800 leading-snug font-serif text-xl text-center bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:t==="de"?"Text eingeben...":t==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl text-center",children:s.trim()})})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 items-stretch",children:[I?e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"aspect-[4/3] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-md flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-sm",children:_==="de"?"Bild wird geladen...":_==="fr"?"Chargement de l'image...":"Loading image..."})]})}):r&&r.imageData?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.imageData,alt:`Scene for page ${a}`,className:`w-full rounded-lg shadow-md object-cover ${ve.has(a)?"opacity-50":""}`}),ve.has(a)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(Me,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:t==="de"?"Neues Bild wird erstellt...":t==="fr"?"Nouvelle image en cours...":"Generating new image..."})]})]}),u&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>_t(a),disabled:c||ve.has(a)||!re,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||ve.has(a)||!re?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:re?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx($e,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Ie," ",t==="de"?"Credits":"credits",")"]})]}),zs&&e.jsxs("button",{onClick:()=>Ds(!0),disabled:c,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(oe,{size:14}),t==="de"?"Text bearbeiten":t==="fr"?"Modifier le texte":"Edit Text"]}),Xe(a).length>1&&e.jsxs("button",{onClick:()=>Bs({pageNumber:a,versions:Xe(a)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(ye,{size:14}),Xe(a).length]})]})}),Z&&e.jsxs("div",{className:"mt-3 space-y-2",children:[Q&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{Ts===a?Be(null):(Be(a),Ms(!1))},disabled:c||Ee!==null||ue!==null,className:`w-full bg-purple-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||Ee!==null||ue!==null?"opacity-50 cursor-not-allowed":"hover:bg-purple-600"}`,title:t==="de"?"Bild analysieren, 17 Checks durchf√ºhren, mit korrigierter Szene neu generieren":t==="fr"?"Analyser l'image, ex√©cuter 17 v√©rifications, r√©g√©n√©rer avec sc√®ne corrig√©e":"Analyze image, run 17 checks, regenerate with corrected scene",children:Ee===a?e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:14,className:"animate-spin"}),t==="de"?"Iteriere...":t==="fr"?"It√©ration...":"Iterating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ht,{size:14}),t==="de"?"N√§chste Iteration":t==="fr"?"Prochaine It√©ration":"Next Iteration"]})}),Ts===a&&e.jsxs("div",{className:"mt-2 bg-purple-50 border border-purple-200 rounded-lg p-3 space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Qe,onChange:k=>Ms(k.target.checked),className:"rounded border-purple-300 text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:t==="de"?"Aktuelles Bild als Referenz":t==="fr"?"Utiliser l'image actuelle comme r√©f√©rence":"Use current image as reference"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:Qe?t==="de"?"Erh√§lt Komposition, kann aber Korrekturen bei vielen Referenzbildern einschr√§nken":t==="fr"?"Pr√©serve la composition mais peut limiter les corrections avec beaucoup d'images de r√©f√©rence":"Preserves composition but may limit corrections with many reference images":t==="de"?"Neue Generierung aus KI-korrigierter Szene":t==="fr"?"Nouvelle g√©n√©ration √† partir de la sc√®ne corrig√©e par l'IA":"Fresh generation from AI-corrected scene"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Mt(a,{useOriginalAsReference:Qe}),className:"flex-1 bg-purple-600 text-white px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-purple-700",children:t==="de"?"Iteration starten":t==="fr"?"D√©marrer l'it√©ration":"Start Iteration"}),e.jsx("button",{onClick:()=>Be(null),className:"px-3 py-1.5 rounded-lg text-sm text-gray-600 hover:bg-purple-100",children:"‚úï"})]})]})]}),q&&e.jsx("button",{onClick:()=>Tt(a),disabled:c||ue!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||ue!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:t==="de"?"Physik-Fehler automatisch erkennen und reparieren":t==="fr"?"D√©tecter et r√©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:ue===a?e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:14,className:"animate-spin"}),t==="de"?"Repariere...":t==="fr"?"R√©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(as,{size:14}),t==="de"?"Auto-Reparatur":t==="fr"?"Auto-R√©paration":"Auto-Repair"]})}),C&&e.jsxs("button",{onClick:()=>C(a),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(oe,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),(r==null?void 0:r.repairHistory)&&r.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(as,{size:14}),t==="de"?"Reparatur-Historie":t==="fr"?"Historique de r√©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",r.repairHistory.length," ",t==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:r.repairHistory.map((k,ge)=>e.jsxs("div",{className:`border rounded-lg p-3 ${k.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[t==="de"?`Reparatur ${k.attempt}`:`Repair ${k.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${k.success?"text-green-600":"text-red-600"}`,children:["(",k.success?"‚úì":"‚úó"," ",k.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:k.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:t==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:t==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",k.fixPrompt]}),k.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:t==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:k.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),k.beforeImage&&k.afterImage&&e.jsxs("div",{className:"flex gap-4 cursor-pointer p-2 -m-2 rounded-lg hover:bg-amber-100 transition-colors",onClick:()=>Vs({beforeImage:k.beforeImage,afterImage:k.afterImage,diffImage:k.diffImage,title:t==="de"?`Reparatur ${k.attempt}`:`Repair ${k.attempt}`}),title:t==="de"?"Klicken f√ºr Vergleichsansicht":"Click to compare",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:k.beforeImage,alt:"Before repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Nachher:":"After:"}),e.jsx("img",{src:k.afterImage,alt:"After repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),k.diffImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:"Diff:"}),e.jsx("img",{src:k.diffImage,alt:"Difference",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(k.timestamp).toLocaleTimeString()})]},ge))})]}),Gs(a)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:t==="de"?"Auszug aus Gliederung":t==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Gs(a)})]}),Zs(a)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:t==="de"?"Szenen-Prompt":t==="fr"?"Prompt de sc√®ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:Zs(a)})]}),Qs(a)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description",Ys(a)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",Ys(a),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Qs(a)})]}),r.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",r.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:r.prompt})]}),((((ws=r.referencePhotos)==null?void 0:ws.length)??0)>0||(((Ss=r.landmarkPhotos)==null?void 0:Ss.length)??0)>0||r.visualBibleGrid||r.hasVisualBibleGrid)&&e.jsx(ks,{referencePhotos:r.referencePhotos||[],landmarkPhotos:r.landmarkPhotos,visualBibleGrid:r.visualBibleGrid,hasVisualBibleGrid:r.hasVisualBibleGrid,language:t,storyId:B||void 0,pageNumber:a}),r.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",r.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${r.qualityScore>=70?"text-green-600":r.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(r.qualityScore),"%"]})]}),r.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),e.jsx($s,{retryHistory:r.retryHistory,language:t,storyId:B,pageNumber:r.pageNumber}),r.retryHistory&&r.retryHistory.length>0&&e.jsx(ns,{retryHistory:r.retryHistory,totalAttempts:r.totalAttempts||r.retryHistory.length,language:t,onRevertRepair:A?(k,ge)=>A(r.pageNumber,ge):void 0,storyId:B,pageNumber:r.pageNumber}),r.wasRegenerated&&(!r.retryHistory||r.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["üîÑ ",t==="de"?"Bild regeneriert":t==="fr"?"Image r√©g√©n√©r√©e":"Image Regenerated"]}),r.originalScore!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(r.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:t==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige Qualit√§t hatte.":t==="fr"?"L'image a √©t√© automatiquement r√©g√©n√©r√©e car la premi√®re version avait une qualit√© faible.":"Image was automatically regenerated because the first version had low quality."}),r.originalImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:t==="de"?"Originalbild:":t==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:r.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),r.originalReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Original Feedback:":t==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`flex flex-col items-center justify-center rounded-lg p-8 ${c?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:_==="de"?"Bild wird noch erstellt...":_==="fr"?"Image en cours de cr√©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:_==="de"?"Kein Bild f√ºr diese Seite":_==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"flex flex-col w-full h-full",children:Ke?e.jsx("textarea",{value:s.trim(),onChange:k=>Vt(i,k.target.value),className:"w-full flex-1 min-h-[300px] p-4 text-gray-800 leading-snug font-serif text-xl bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:t==="de"?"Text eingeben...":t==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl",children:s.trim()})})})]})]},a)})]}),f&&ts(f.backCover)&&(()=>{var i,a;const s=f.backCover;return e.jsxs("div",{className:"mt-8 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:_==="de"?"R√ºckseite":_==="fr"?"Quatri√®me de couverture":"Back Cover"}),e.jsxs("div",{className:"relative",children:[e.jsx(et,{src:ts(f.backCover),alt:"Back Cover",className:"w-full rounded-lg shadow-lg",label:"Back Cover"}),z.has("backCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(me,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),H&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>pt("back"),disabled:c||!re||z.has("backCover"),className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||!re||z.has("backCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:re?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx($e,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Ie," ",t==="de"?"Credits":"credits",")"]})]}),Se("backCover").length>1&&e.jsxs("button",{onClick:()=>ds({coverType:"backCover",versions:Se("backCover")}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(ye,{size:14}),Se("backCover").length]})]}),Z&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[E&&e.jsxs("button",{onClick:()=>E("back"),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(oe,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:(()=>{const l=O=>{if(typeof O!="string")return O;try{const I=JSON.parse(O);return typeof I=="string"&&(I.startsWith("{")||I.startsWith("["))?l(I):I}catch{return O}},r=s.description,v=typeof r=="object"&&(r!=null&&r.text)?r.text:r,g=l(v);return typeof g=="object"&&g!==null?JSON.stringify(g,null,2):String(g)})()})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:s.prompt})]}),((((i=s.referencePhotos)==null?void 0:i.length)??0)>0||(((a=s.landmarkPhotos)==null?void 0:a.length)??0)>0||s.visualBibleGrid)&&e.jsx(ks,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,visualBibleGrid:s.visualBibleGrid,language:t}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),e.jsx($s,{retryHistory:s.retryHistory,bboxDetection:s.bboxDetection,bboxOverlayImage:s.bboxOverlayImage,language:t,storyId:B,coverType:"back"}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(ns,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:t}),s.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[t==="de"?"Vorherige Version":t==="fr"?"Version pr√©c√©dente":"Previous Version",s.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(s.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),s.originalImage&&s.originalImage!==s.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[t==="de"?"Originalbild":t==="fr"?"Image originale":"Original Image",s.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(s.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),ss&&x&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-4 mt-6",children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-3 text-center",children:t==="de"?"Was m√∂chten Sie als N√§chstes tun?":t==="fr"?"Que souhaitez-vous faire ensuite ?":"What would you like to do next?"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[B&&n&&e.jsxs("button",{onClick:n,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Sr,{size:16})," ",t==="de"?"Buch erstellen":t==="fr"?"Cr√©er le livre":"Create Book"]}),T&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>qs(!Ze),disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(is,{size:16}),t==="de"?"PDF herunterladen":t==="fr"?"T√©l√©charger PDF":"Download PDF",e.jsx(_e,{size:14,className:`transition-transform ${Ze?"rotate-180":""}`})]}),Ze&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:Ge==="square",onChange:()=>_s("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20√ó20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:Ge==="A4",onChange:()=>_s("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21√ó28cm)"})]})]}),e.jsx("button",{onClick:()=>{T(Ge),qs(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:t==="de"?"Herunterladen":t==="fr"?"T√©l√©charger":"Download"})]})]}),B&&!c&&e.jsx(Ar,{storyId:B,variant:"full"}),G&&e.jsxs("button",{onClick:G,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Cr,{size:16})," ",t==="de"?"Neue Geschichte":t==="fr"?"Nouvelle histoire":"New Story"]})]})]}),Ke&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 shadow-lg p-3 md:p-4 z-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(oe,{size:18,className:"flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-sm md:text-base",children:t==="de"?"Bearbeitungsmodus":t==="fr"?"Mode √©dition":"Edit Mode"}),As&&e.jsxs("span",{className:"text-xs text-gray-500 hidden sm:inline",children:["(",t==="de"?"Original gespeichert":t==="fr"?"Original sauvegard√©":"Original saved",")"]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-center md:justify-end",children:[e.jsxs("button",{onClick:Hr,disabled:os,className:"px-3 md:px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(ke,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:t==="de"?"Abbrechen":t==="fr"?"Annuler":"Cancel"})]}),As&&Os!==As&&e.jsxs("button",{onClick:()=>Rs(As),disabled:os,className:"px-3 md:px-4 py-2 border border-amber-400 text-amber-700 rounded-lg hover:bg-amber-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(ht,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:t==="de"?"Zur√ºcksetzen":t==="fr"?"Restaurer":"Restore"})]}),e.jsxs("button",{onClick:qr,disabled:os,className:`px-3 md:px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-semibold flex items-center gap-1.5 ${os?"opacity-50 cursor-not-allowed":"hover:bg-green-600"}`,children:[e.jsx(rs,{size:16}),os?t==="de"?"Speichern...":t==="fr"?"Sauvegarde...":"Saving...":t==="de"?"Speichern":t==="fr"?"Sauvegarder":"Save"]})]})]})}),pe&&e.jsx(fa,{pageNumber:pe.pageNumber,scene:pe.scene,onSceneChange:s=>cs({...pe,scene:s}),onClose:()=>cs(null),onRegenerate:Yr,isRegenerating:ve.has(pe.pageNumber),imageRegenerationCost:Ie,characters:y.map(s=>({id:s.id,name:s.name})),selectedCharacterIds:pe.selectedCharacterIds,onCharacterSelectionChange:s=>cs({...pe,selectedCharacterIds:s}),consistencyRegen:Z?(tr=N.find(s=>s.pageNumber===pe.pageNumber))==null?void 0:tr.consistencyRegen:void 0}),K&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx($e,{size:20}),t==="de"?"Cover bearbeiten":t==="fr"?"Modifier la couverture":"Edit Cover"," - ",K.coverType==="front"?t==="de"?"Titelseite":t==="fr"?"Couverture":"Front Cover":K.coverType==="initial"?t==="de"?"Einleitungsseite":t==="fr"?"Page de d√©dicace":"Dedication Page":t==="de"?"R√ºckseite":t==="fr"?"Dos":"Back Cover"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t==="de"?"Bearbeite die Szenenbeschreibung und w√§hle die Charaktere aus":t==="fr"?"Modifiez la description de la sc√®ne et s√©lectionnez les personnages":"Edit the scene description and select the characters"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[y.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(jt,{size:16}),t==="de"?"Charaktere auf dem Cover:":t==="fr"?"Personnages sur la couverture:":"Characters on the cover:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map(s=>{const i=K.selectedCharacterIds.includes(s.id);return e.jsxs("button",{type:"button",onClick:()=>{const a=i?K.selectedCharacterIds.filter(l=>l!==s.id):[...K.selectedCharacterIds,s.id];Le({...K,selectedCharacterIds:a})},className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${i?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{className:"font-medium",children:s.name}),i&&e.jsx("span",{className:"text-indigo-500",children:"‚úì"})]},s.id)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:t==="de"?"W√§hle die Charaktere aus, die auf dem Cover erscheinen sollen.":t==="fr"?"S√©lectionnez les personnages qui doivent appara√Ætre sur la couverture.":"Select the characters that should appear on the cover."})]}),K.coverType==="front"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t==="de"?"Titel:":t==="fr"?"Titre:":"Title:"}),e.jsx("input",{type:"text",value:K.title||"",onChange:s=>Le({...K,title:s.target.value}),placeholder:t==="de"?"Der Titel des Buches":t==="fr"?"Le titre du livre":"The book title",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),K.coverType==="initial"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t==="de"?"Widmung:":t==="fr"?"D√©dicace:":"Dedication:"}),e.jsx("input",{type:"text",value:K.dedication||"",onChange:s=>Le({...K,dedication:s.target.value}),placeholder:t==="de"?'z.B. "F√ºr meine liebste Tochter Emma"':t==="fr"?'par ex. "Pour ma ch√®re fille Emma"':'e.g. "For my dear daughter Emma"',className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t==="de"?"Leer lassen f√ºr keine Widmung":t==="fr"?"Laisser vide pour aucune d√©dicace":"Leave empty for no dedication"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t==="de"?"Szenenbeschreibung:":t==="fr"?"Description de la sc√®ne:":"Scene description:"}),e.jsx("textarea",{value:K.scene,onChange:s=>Le({...K,scene:s.target.value}),placeholder:t==="de"?'z.B. "Die Hauptfigur steht vor einem magischen Schloss bei Sonnenuntergang"':t==="fr"?'par ex. "Le personnage principal devant un ch√¢teau magique au coucher du soleil"':'e.g. "The main character standing in front of a magical castle at sunset"',className:"w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y"}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:t==="de"?"Tipp: Beschreibe die Aktionen und die Umgebung. Die ausgew√§hlten Charaktere werden automatisch hinzugef√ºgt.":t==="fr"?"Conseil: D√©crivez les actions et l'environnement. Les personnages s√©lectionn√©s seront ajout√©s automatiquement.":"Tip: Describe the actions and the environment. Selected characters will be added automatically."})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:K.selectedCharacterIds.length>0&&e.jsx("span",{children:t==="de"?`${K.selectedCharacterIds.length} Charakter(e) ausgew√§hlt`:t==="fr"?`${K.selectedCharacterIds.length} personnage(s) s√©lectionn√©(s)`:`${K.selectedCharacterIds.length} character(s) selected`})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>Le(null),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium order-2 sm:order-1",children:t==="de"?"Abbrechen":t==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{onClick:Xr,disabled:z.has(K.coverType==="front"?"frontCover":K.coverType==="initial"?"initialPage":"backCover")||K.selectedCharacterIds.length===0,className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 order-1 sm:order-2 ${z.has(K.coverType==="front"?"frontCover":K.coverType==="initial"?"initialPage":"backCover")||K.selectedCharacterIds.length===0?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:[e.jsx($e,{size:16}),t==="de"?"Neu generieren":t==="fr"?"R√©g√©n√©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Ie," ",t==="de"?"Credits":"credits",")"]})]})]})]})]})}),ot&&e.jsx(kr,{pageNumber:ot.pageNumber,versions:ot.versions,onClose:()=>Bs(null),onSelectVersion:(s,i)=>Jr(s,i),developerMode:Z}),dt&&e.jsx(kr,{coverType:dt.coverType,versions:dt.versions,onClose:()=>ds(null),onSelectVersion:(s,i)=>Qr(s,i),developerMode:Z}),xt&&e.jsx(ya,{src:xt.src,title:xt.title,onClose:()=>X(null)}),ms&&e.jsx(Na,{beforeImage:ms.beforeImage,afterImage:ms.afterImage,diffImage:ms.diffImage,title:ms.title,onClose:()=>Vs(null)})]})}export{ei as StoryDisplay,ei as default};
