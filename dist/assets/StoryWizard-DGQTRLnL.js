const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WizardStep2Characters-BZ_CM3Xz.js","assets/index-ZijftYCm.js","assets/vendor-react-CqfXSjHo.js","assets/vendor-firebase-DTVMaYMy.js","assets/index-CYn2YeWm.css","assets/Input-CG3rgBYp.js","assets/Textarea-Bvim1UuL.js","assets/sparkles-BTO0YGdj.js","assets/book-open-Ci2qfir8.js","assets/check-Dyk2fBj3.js","assets/pen-C54X6P8H.js","assets/trash-2-DBZZdWBw.js","assets/Modal-11xElXo0.js","assets/download-BPmN9f9n.js","assets/chevron-right-z8LuTiTJ.js","assets/arrow-right-BpdouphI.js","assets/camera-BVYfwpOd.js","assets/pencil-Wsn9uDW9.js","assets/circle-x-k0D6Htsr.js","assets/clock-B-NDSL-h.js","assets/palette-CVsFzYo5.js","assets/book-CA_xAzS-.js","assets/shopping-cart-Dy5FP3zF.js","assets/arrow-left-DlYLKC4b.js","assets/WizardStep4StoryType-O9qFiFUn.js","assets/WizardStep5ArtStyle-BrbJr2Vd.js","assets/artStyles-DJIZ4CgP.js","assets/WizardStep6Summary-D17L5noW.js"])))=>i.map(i=>d[i]);
import{c as Ye,b as Ge,d as cs,j as e,X as zt,u as Ot,a as ms,L as wt,T as ln,C as Bs,E as yi,e as bi,f as vi,s as He,g as Ms,_ as sa}from"./index-ZijftYCm.js";import{b as l,u as ji,e as Ni}from"./vendor-react-CqfXSjHo.js";import{U as dn,B as Aa,I as Ls}from"./Input-CG3rgBYp.js";import{S as wi,A as Gs,N as Si}from"./Textarea-Bvim1UuL.js";import{C as Ci}from"./circle-x-k0D6Htsr.js";import{C as ki}from"./clock-B-NDSL-h.js";import{M as cn,H as Ai,C as Hs,R as Ht,F as Er,P as Os,a as Pi,I as _s,b as Ti}from"./Modal-11xElXo0.js";import{D as $a,C as Jt}from"./download-BPmN9f9n.js";import{C as is}from"./chevron-right-z8LuTiTJ.js";import{P as mn}from"./palette-CVsFzYo5.js";import{B as $i}from"./book-CA_xAzS-.js";import{C as Ii}from"./check-Dyk2fBj3.js";import{S as Ws}from"./shopping-cart-Dy5FP3zF.js";import{B as Pa}from"./book-open-Ci2qfir8.js";import{S as Fr}from"./sparkles-BTO0YGdj.js";import{A as Vs}from"./arrow-left-DlYLKC4b.js";import{A as Di}from"./arrow-right-BpdouphI.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ei=Ye("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zi=Ye("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fi=Ye("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=Ye("Images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ri=Ye("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bi=Ye("Link2Off",[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mi=Ye("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=Ye("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Li=Ye("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gi=Ye("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=Ye("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=Ye("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hi=Ye("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=Ye("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oi=Ye("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _i=Ye("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=Ye("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=Ye("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),Wi={async login(t,o){const i=await Ge.post("/api/auth/login",{username:t,password:o},{skipAuth:!0}),N={id:i.user.id,username:i.user.username,email:i.user.email,role:i.user.role,credits:i.user.credits};return{token:i.token,user:N}},async register(t,o,i){return Ge.post("/api/auth/register",{username:t,password:o,email:i},{skipAuth:!0})},async loginWithFirebase(t){const o=await Ge.post("/api/auth/firebase",{idToken:t},{skipAuth:!0}),i={id:o.user.id,username:o.user.username,email:o.user.email,role:o.user.role,credits:o.user.credits};return{token:o.token,user:i}},async getQuota(){const t=await Ge.get("/api/user/quota");return{storyQuota:t.storyQuota,storiesGenerated:t.storiesGenerated,remaining:t.remaining}},async getCredits(){const t=await Ge.get("/api/user/quota");return{credits:t.credits,unlimited:t.unlimited}},async updateEmail(t){await Ge.put("/api/user/update-email",{email:t})},async getShippingAddress(){try{return await Ge.get("/api/user/shipping-address")}catch{return null}},async updateShippingAddress(t){await Ge.put("/api/user/shipping-address",t)}},ee=cs("CharacterService");function un(t){if(!t)return;const o=parseInt(t,10);if(!(isNaN(o)||o<0))return o<=1?"infant":o<=2?"toddler":o<=4?"preschooler":o<=6?"kindergartner":o<=8?"young-school-age":o<=10?"school-age":o<=12?"preteen":o<=14?"young-teen":o<=17?"teenager":o<=25?"young-adult":o<=39?"adult":o<=59?"middle-aged":o<=75?"senior":"elderly"}function ss(t){const o={height:t.height,build:t.build,face:t.other_features||t.otherFeatures,eyeColor:t.eye_color||t.eyeColor,hairColor:t.hair_color||t.hairColor,hairLength:t.hair_length||t.hairLength,hairStyle:t.hair_style||t.hairStyle,facialHair:t.facial_hair||t.facialHair,skinTone:t.skin_tone||t.skinTone,skinUndertone:t.skin_undertone||t.skinUndertone,skinToneHex:t.skin_tone_hex||t.skinToneHex,hair:t.hair_color||t.hairColor,other:t.other,detailedHairAnalysis:t.detailed_hair_analysis||t.detailedHairAnalysis,apparentAge:t.apparent_age||t.apparentAge},i=t.age_category||t.ageCategory||un(t.age);return{id:t.id,name:t.name,gender:t.gender,age:t.age,ageCategory:i,physical:o.height||o.build||o.face||o.eyeColor||o.hairColor||o.hairLength||o.hairStyle||o.facialHair||o.skinTone||o.hair||o.other||o.detailedHairAnalysis||o.apparentAge?o:void 0,physicalTraitsSource:t.physical_traits_source||t.physicalTraitsSource,traits:{strengths:t.strengths||[],flaws:t.flaws||t.weaknesses||[],challenges:t.challenges||t.fears||[],specialDetails:t.special_details||t.specialDetails},photos:{original:t.photo_url||t.photoUrl,face:t.thumbnail_url||t.thumbnailUrl,body:t.body_photo_url||t.bodyPhotoUrl,bodyNoBg:t.body_no_bg_url||t.bodyNoBgUrl,faceBox:t.face_box||t.faceBox,bodyBox:t.body_box||t.bodyBox},avatars:t.avatars||t.clothing_avatars||t.clothingAvatars,clothing:t.clothing||t.structured_clothing||t.structuredClothing?{current:t.clothing,structured:t.structured_clothing||t.structuredClothing}:void 0,generatedOutfits:t.generated_outfits||t.generatedOutfits,storyRole:t.storyRole}}function Us(t){var i,N,a,y,b,c,D,_,C,p,I,x,P,F,W,L,X,Q,ne,B,ie,te,K,$;const o=t.ageCategory||un(t.age);return{id:t.id,name:t.name,gender:t.gender,age:t.age,age_category:o,apparent_age:(i=t.physical)==null?void 0:i.apparentAge,height:(N=t.physical)==null?void 0:N.height,build:(a=t.physical)==null?void 0:a.build,eye_color:(y=t.physical)==null?void 0:y.eyeColor,hair_color:(b=t.physical)==null?void 0:b.hairColor,hair_length:(c=t.physical)==null?void 0:c.hairLength,hair_style:(D=t.physical)==null?void 0:D.hairStyle,facial_hair:(_=t.physical)==null?void 0:_.facialHair,skin_tone:(C=t.physical)==null?void 0:C.skinTone,skin_undertone:(p=t.physical)==null?void 0:p.skinUndertone,skin_tone_hex:(I=t.physical)==null?void 0:I.skinToneHex,other_features:(x=t.physical)==null?void 0:x.face,other:(P=t.physical)==null?void 0:P.other,detailed_hair_analysis:(F=t.physical)==null?void 0:F.detailedHairAnalysis,physical_traits_source:t.physicalTraitsSource,face_box:(W=t.photos)==null?void 0:W.faceBox,body_box:(L=t.photos)==null?void 0:L.bodyBox,strengths:(X=t.traits)==null?void 0:X.strengths,flaws:(Q=t.traits)==null?void 0:Q.flaws,challenges:(ne=t.traits)==null?void 0:ne.challenges,special_details:(B=t.traits)==null?void 0:B.specialDetails,weaknesses:(ie=t.traits)==null?void 0:ie.flaws,fears:(te=t.traits)==null?void 0:te.challenges,clothing:(K=t.clothing)==null?void 0:K.current,structured_clothing:($=t.clothing)==null?void 0:$.structured,generated_outfits:t.generatedOutfits,storyRole:t.storyRole}}function Vi(t){return!t||t.length===0?[]:typeof t[0]=="string"?t.map(o=>({forward:o,inverse:o})):t}const Ee={async getCharacters(t=!1){const o=t?"/api/characters?includeAllAvatars=true":"/api/characters";return((await Ge.get(o)).characters||[]).map(ss)},async getCharacterData(t=!1){const o=t?"/api/characters?includeAllAvatars=true":"/api/characters",i=await Ge.get(o);return{characters:(i.characters||[]).map(ss),relationships:i.relationships||{},relationshipTexts:i.relationshipTexts||{},customRelationships:Vi(i.customRelationships),customStrengths:i.customStrengths||[],customWeaknesses:i.customWeaknesses||[],customFears:i.customFears||[]}},async saveCharacters(t){await Ge.post("/api/characters",{characters:t.map(Us)})},async saveCharacterData(t,o){const i=a=>{var b,c,D,_;const y=Us(a);return o!=null&&o.includePhotos&&(y.photo_url=(b=a.photos)==null?void 0:b.original,y.thumbnail_url=(c=a.photos)==null?void 0:c.face,y.body_photo_url=(D=a.photos)==null?void 0:D.body,y.body_no_bg_url=(_=a.photos)==null?void 0:_.bodyNoBg),y},N={characters:t.characters.map(i),relationships:t.relationships,relationshipTexts:t.relationshipTexts,customRelationships:t.customRelationships,customStrengths:t.customStrengths,customWeaknesses:t.customWeaknesses,customFears:t.customFears};await Ge.post("/api/characters",N)},async deleteCharacter(t){try{const o=await Ge.delete(`/api/characters/${t}`);return ee.success(`Deleted character ${t}: ${o.message}`),{success:!0}}catch(o){return ee.error(`Failed to delete character ${t}:`,o),{success:!1,error:String(o)}}},async saveCharacterRoles(t){try{return await Ge.put("/api/characters/roles",{roles:t}),ee.success(`Saved character roles: ${Object.keys(t).length} characters`),{success:!0}}catch(o){return ee.error("Failed to save character roles:",o),{success:!1,error:String(o)}}},async loadCharacterAvatars(t){try{const o=await Ge.get(`/api/characters/${t}/avatars`);return ee.info(`Loaded full avatars for character ${t}`),o.avatars||null}catch(o){return ee.error(`Failed to load avatars for character ${t}:`,o),null}},async loadFullCharacter(t){try{const o=await Ge.get(`/api/characters/${t}/full`);return o.character?(ee.info(`Loaded full data for character ${t}`),ss(o.character)):null}catch(o){return ee.error(`Failed to load full data for character ${t}:`,o),null}},async generateAvatarOptions(t,o){try{return await Ge.post("/api/generate-avatar-options",{facePhoto:t,gender:o,category:"standard"})}catch(i){const N=i instanceof Error?i.message:"Unknown error";return{success:!1,options:[],error:N}}},async generateClothingAvatars(t,o){var i,N,a,y,b,c,D,_,C,p,I;try{const x=parseInt(t.age)||10,P=t.gender||"child";let F;P==="male"?F=x>=18?"man":"boy":P==="female"?F=x>=18?"woman":"girl":F=x>=18?"person":"child";let L=`${((i=t.name)==null?void 0:i.trim())||`This ${F}`} is a ${x}-year-old ${F}`;t.physical&&(t.physical.hair&&(L+=`, ${t.physical.hair}`),t.physical.face&&(L+=`, ${t.physical.face}`),t.physical.build&&(L+=`, ${t.physical.build}`),t.physical.other&&(L+=`, ${t.physical.other}`));const X=((N=t.photos)==null?void 0:N.bodyNoBg)||((a=t.photos)==null?void 0:a.body)||((y=t.photos)==null?void 0:y.face)||((b=t.photos)==null?void 0:b.original);ee.info(`ðŸŽ¨ Generating clothing avatars for ${t.name||"unnamed"} (id: ${t.id})`);const Q=await Ge.post("/api/generate-clothing-avatars?async=true",{characterId:t.id,facePhoto:X,physicalDescription:L,name:t.name,age:t.age,apparentAge:(c=t.physical)==null?void 0:c.apparentAge,gender:t.gender,build:(D=t.physical)==null?void 0:D.build,clothing:(_=t.clothing)==null?void 0:_.structured,avatarModel:o==null?void 0:o.avatarModel});if(Q.async&&Q.jobId){ee.info(`Avatar job started: ${Q.jobId}, polling for completion...`);const B=60,ie=2e3;for(let te=0;te<B;te++){await new Promise($=>setTimeout($,ie));const K=await Ge.get(`/api/avatar-jobs/${Q.jobId}`);if(K.status==="complete"&&K.clothingAvatars){ee.success(`Avatar job ${Q.jobId} completed after ${(te+1)*2}s`);const $=K.clothingAvatars.extractedTraits,Z=(C=K.clothingAvatars.structuredClothing)==null?void 0:C.standard;return ee.info(`ðŸ” [DEBUG] extractedTraits: ${(p=JSON.stringify($))==null?void 0:p.substring(0,100)}`),ee.info(`ðŸ” [DEBUG] extractedClothing: ${JSON.stringify(Z)}`),ee.info(`ðŸ” [DEBUG] structuredClothing keys: ${Object.keys(K.clothingAvatars.structuredClothing||{})}`),{success:!0,avatars:K.clothingAvatars,extractedTraits:$,extractedClothing:Z}}if(K.status==="failed")return ee.error(`Avatar job failed: ${K.error}`),{success:!1,error:K.error};te%5===0&&ee.info(`Avatar job ${Q.jobId}: ${K.message||K.status} (${K.progress||0}%)`)}return{success:!1,error:"Avatar generation timed out"}}const ne=Q;if(ne.success&&ne.clothingAvatars){ee.success(`Clothing avatars generated for ${t.name}`);const B=ne.clothingAvatars.extractedTraits,ie=(I=ne.clothingAvatars.structuredClothing)==null?void 0:I.standard;return B&&ee.info(`Extracted traits: ${JSON.stringify(B)}`),ie&&ee.info(`Extracted clothing: ${JSON.stringify(ie)}`),{success:!0,avatars:ne.clothingAvatars,extractedTraits:B,extractedClothing:ie}}else return ee.error(`Failed to generate avatars: ${ne.error}`),{success:!1,error:ne.error}}catch(x){return ee.error("Clothing avatar generation failed:",x),{success:!1,error:String(x)}}},async generateClothingAvatarsWithTraits(t){var o,i,N,a,y,b,c,D,_,C,p,I,x,P,F,W,L,X;try{const Q=parseInt(t.age)||10,ne=t.gender||"child";let B;ne==="male"?B=Q>=18?"man":"boy":ne==="female"?B=Q>=18?"woman":"girl":B=Q>=18?"person":"child";let te=`${((o=t.name)==null?void 0:o.trim())||`This ${B}`} is a ${Q}-year-old ${B}`;t.physical&&(t.physical.hair&&(te+=`, ${t.physical.hair}`),t.physical.face&&(te+=`, ${t.physical.face}`),t.physical.build&&(te+=`, ${t.physical.build}`),t.physical.other&&(te+=`, ${t.physical.other}`));const K=((i=t.photos)==null?void 0:i.bodyNoBg)||((N=t.photos)==null?void 0:N.body)||((a=t.photos)==null?void 0:a.face)||((y=t.photos)==null?void 0:y.original),$=(b=t.photos)!=null&&b.bodyNoBg?"bodyNoBg":(c=t.photos)!=null&&c.body?"body":(D=t.photos)!=null&&D.face?"face":"original",Z=K?Math.round(K.length/1024):0,xe=K==null?void 0:K.startsWith("data:image/png");ee.info(`ðŸŽ¨ Generating clothing avatars WITH TRAITS for ${t.name} (id: ${t.id})`),ee.info(`ðŸ“¸ Photo source: ${$}, size: ${Z}KB, format: ${xe?"PNG":"JPEG"}`),ee.info(`ðŸ“¸ Available photos: bodyNoBg=${!!((_=t.photos)!=null&&_.bodyNoBg)}, body=${!!((C=t.photos)!=null&&C.body)}, face=${!!((p=t.photos)!=null&&p.face)}, original=${!!((I=t.photos)!=null&&I.original)}`),ee.info(`Physical traits: ${JSON.stringify(t.physical)}`);const fe=t.physicalTraitsSource||{};ee.info(`Physical traits source: ${JSON.stringify(fe)}`),ee.info(`Physical skinTone value: '${(x=t.physical)==null?void 0:x.skinTone}', source: '${fe.skinTone}'`),ee.info(`Physical hairStyle value: '${(P=t.physical)==null?void 0:P.hairStyle}', source: '${fe.hairStyle}'`);const me={};t.physical&&(fe.eyeColor==="user"&&t.physical.eyeColor&&(me.eyeColor=t.physical.eyeColor),fe.hairColor==="user"&&t.physical.hairColor&&(me.hairColor=t.physical.hairColor),fe.hairLength==="user"&&t.physical.hairLength&&(me.hairLength=t.physical.hairLength),fe.hairStyle==="user"&&t.physical.hairStyle&&(me.hairStyle=t.physical.hairStyle),fe.build==="user"&&t.physical.build&&(me.build=t.physical.build),fe.skinTone==="user"&&t.physical.skinTone&&(me.skinTone=t.physical.skinTone,t.physical.skinToneHex&&(me.skinToneHex=t.physical.skinToneHex)),fe.face==="user"&&t.physical.face&&(me.face=t.physical.face),fe.facialHair==="user"&&t.physical.facialHair&&(me.facialHair=t.physical.facialHair),fe.other==="user"&&t.physical.other&&(me.other=t.physical.other));const ge=Object.keys(me).length>0;ee.info(`Physical traits to send (user-edited only): ${ge?JSON.stringify(me):"none"}`);const Ne=t.clothingSource||{},Se={};(F=t.clothing)!=null&&F.structured&&(Ne.upperBody==="user"&&t.clothing.structured.upperBody&&(Se.upperBody=t.clothing.structured.upperBody),Ne.lowerBody==="user"&&t.clothing.structured.lowerBody&&(Se.lowerBody=t.clothing.structured.lowerBody),Ne.shoes==="user"&&t.clothing.structured.shoes&&(Se.shoes=t.clothing.structured.shoes),Ne.fullBody==="user"&&t.clothing.structured.fullBody&&(Se.fullBody=t.clothing.structured.fullBody));const re=Object.keys(Se).length>0;ee.info(`Clothing to send (user-edited only): ${re?JSON.stringify(Se):"none"}`);const $e=await Ge.post("/api/generate-clothing-avatars?async=true",{characterId:t.id,facePhoto:K,physicalDescription:te,name:t.name,age:t.age,apparentAge:(W=t.physical)==null?void 0:W.apparentAge,gender:t.gender,build:me.build||"average",physicalTraits:ge?me:void 0,clothing:re?Se:void 0});if($e.async&&$e.jobId){ee.info(`Avatar job started: ${$e.jobId}, polling for completion...`);const it=60,Ae=2e3;for(let qe=0;qe<it;qe++){await new Promise(se=>setTimeout(se,Ae));const de=await Ge.get(`/api/avatar-jobs/${$e.jobId}`);if(de.status==="complete"&&de.clothingAvatars){ee.success(`Avatar job ${$e.jobId} completed after ${(qe+1)*2}s`);const se=de.clothingAvatars.extractedTraits,M=(L=de.clothingAvatars.structuredClothing)==null?void 0:L.standard;return{success:!0,avatars:de.clothingAvatars,extractedTraits:se,extractedClothing:M}}if(de.status==="failed")return ee.error(`Avatar job failed: ${de.error}`),{success:!1,error:de.error};qe%5===0&&ee.info(`Avatar job ${$e.jobId}: ${de.message||de.status} (${de.progress||0}%)`)}return{success:!1,error:"Avatar generation timed out"}}if($e.success&&$e.clothingAvatars){ee.success(`Clothing avatars WITH TRAITS generated for ${t.name}`);const it=$e.clothingAvatars.extractedTraits,Ae=(X=$e.clothingAvatars.structuredClothing)==null?void 0:X.standard;return{success:!0,avatars:$e.clothingAvatars,extractedTraits:it,extractedClothing:Ae}}else return ee.error(`Failed to generate avatars with traits: ${$e.error}`),{success:!1,error:$e.error}}catch(Q){return ee.error("Clothing avatar generation with traits failed:",Q),{success:!1,error:String(Q)}}},async analyzePhoto(t,o,i,N,a){var y,b,c,D,_,C,p,I,x,P,F,W,L,X,Q,ne,B,ie,te,K;try{const $=await Ge.post("/api/analyze-photo",{imageData:t,language:o,selectedFaceId:i,cachedFaces:N,existingCharacterId:a});if(!$.success)return{success:!1,error:$.error};if($.multipleFacesDetected&&$.faces)return ee.info(`Multiple faces detected (${$.faceCount}), showing selection UI`),{success:!0,multipleFacesDetected:!0,faceCount:$.faceCount,faces:$.faces};const Z={height:(y=$.attributes)==null?void 0:y.height,build:(b=$.attributes)==null?void 0:b.build,face:(c=$.attributes)==null?void 0:c.face,eyeColor:((D=$.attributes)==null?void 0:D.eye_color)||((_=$.attributes)==null?void 0:_.eyeColor),hairColor:((C=$.attributes)==null?void 0:C.hair_color)||((p=$.attributes)==null?void 0:p.hairColor),hairLength:((I=$.attributes)==null?void 0:I.hair_length)||((x=$.attributes)==null?void 0:x.hairLength),hairStyle:((P=$.attributes)==null?void 0:P.hair_style)||((F=$.attributes)==null?void 0:F.hairStyle),hair:((W=$.attributes)==null?void 0:W.hair_color)||((L=$.attributes)==null?void 0:L.hairColor),other:(X=$.attributes)==null?void 0:X.other_features};return{success:$.success,characterId:$.characterId,multipleFacesDetected:!1,faceCount:$.faceCount,photos:{face:$.faceThumbnail,body:$.bodyCrop,bodyNoBg:$.bodyNoBg,faceBox:$.faceBox,bodyBox:$.bodyBox},age:(Q=$.attributes)==null?void 0:Q.age,apparentAge:(ne=$.attributes)==null?void 0:ne.apparent_age,gender:(B=$.attributes)==null?void 0:B.gender,physical:Z.height||Z.build||Z.face||Z.eyeColor||Z.hairColor||Z.hairLength||Z.hairStyle||Z.hair||Z.other?Z:void 0,clothing:(ie=$.attributes)!=null&&ie.clothing||(te=$.attributes)!=null&&te.clothingStyle||(K=$.attributes)!=null&&K.clothingColors?{current:$.attributes.clothing,style:$.attributes.clothingStyle||$.attributes.clothingColors}:void 0,_debug:$._debug}}catch($){return ee.error("Photo analysis failed:",$),{success:!1,error:"unknown_error"}}},needsAvatars(t){var a,y,b,c;if(!!!((a=t.photos)!=null&&a.original||(y=t.photos)!=null&&y.face||(b=t.photos)!=null&&b.body||(c=t.photos)!=null&&c.bodyNoBg))return!1;const i=t.avatars;return i?i.status==="generating"||i.status==="pending"?!1:i.status==="failed"?!0:!!!(i.winter||i.standard||i.summer||i.formal||i.hasFullAvatars):!0},async generateAndSaveAvatarForCharacter(t,o,i){var a,y,b,c,D,_,C,p,I,x,P,F,W,L,X,Q,ne,B,ie,te;const N={characterId:t.id,characterName:t.name,success:!1};try{if(!!!((a=t.photos)!=null&&a.original||(y=t.photos)!=null&&y.face||(b=t.photos)!=null&&b.body||(c=t.photos)!=null&&c.bodyNoBg))return N.skipped=!0,N.skipReason="No photo available",N;o==null||o("generating",`Generating avatars for ${t.name}...`),ee.info(`ðŸŽ¨ Generating avatars for ${t.name} (id: ${t.id})${i!=null&&i.avatarModel?`, model: ${i.avatarModel}`:""}`);const $=await Ee.generateClothingAvatars(t,i);if(!$.success||!$.avatars)return N.error=$.error||"Avatar generation failed",o==null||o("error",N.error),N;N.avatars=$.avatars,N.extractedTraits=$.extractedTraits,N.extractedClothing=$.extractedClothing,o==null||o("saving",`Fetching updated data for ${t.name}...`);let Z=null;const xe=30;for(let fe=0;fe<xe;fe++){if(fe>0){const me=Math.min(500*Math.pow(1.2,fe),3e3);ee.info(`[AVATAR] Retry ${fe+1}/${xe}: waiting ${Math.round(me)}ms for avatar data...`),await new Promise(ge=>setTimeout(ge,me))}if(Z=await Ee.loadFullCharacter(t.id),(D=Z==null?void 0:Z.avatars)!=null&&D.standard||(_=Z==null?void 0:Z.avatars)!=null&&_.winter||(C=Z==null?void 0:Z.avatars)!=null&&C.summer){ee.info(`[AVATAR] Got fresh data with avatars on attempt ${fe+1}`);break}}return Z?(N.character=Z,(p=Z.avatars)!=null&&p.standard||(I=Z.avatars)!=null&&I.winter||(x=Z.avatars)!=null&&x.summer||ee.warn(`âš ï¸ Fresh DB data for ${t.name} missing avatars after ${xe} retries - server may not have saved them`),ee.info(`ðŸ“‹ Using server-saved data for ${t.name}`)):(ee.error(`âŒ Character ${t.name} (id: ${t.id}) not found in DB after avatar job - avatars lost!`),N.character={...t,avatars:{status:"failed"},physical:$.extractedTraits?{...t.physical,apparentAge:$.extractedTraits.apparentAge||((P=t.physical)==null?void 0:P.apparentAge),build:$.extractedTraits.build||((F=t.physical)==null?void 0:F.build),eyeColor:$.extractedTraits.eyeColor||((W=t.physical)==null?void 0:W.eyeColor),eyeColorHex:$.extractedTraits.eyeColorHex||((L=t.physical)==null?void 0:L.eyeColorHex),hairColor:$.extractedTraits.hairColor||((X=t.physical)==null?void 0:X.hairColor),hairColorHex:$.extractedTraits.hairColorHex||((Q=t.physical)==null?void 0:Q.hairColorHex),hairLength:$.extractedTraits.hairLength||((ne=t.physical)==null?void 0:ne.hairLength),hairStyle:$.extractedTraits.hairStyle||((B=t.physical)==null?void 0:B.hairStyle),skinTone:$.extractedTraits.skinTone||((ie=t.physical)==null?void 0:ie.skinTone),skinToneHex:$.extractedTraits.skinToneHex||((te=t.physical)==null?void 0:te.skinToneHex)}:t.physical,clothing:$.extractedClothing?{...t.clothing,structured:{upperBody:$.extractedClothing.upperBody||void 0,lowerBody:$.extractedClothing.lowerBody||void 0,shoes:$.extractedClothing.shoes||void 0,fullBody:$.extractedClothing.fullBody||void 0}}:t.clothing}),N.success=!0,o==null||o("complete",`Avatars saved for ${t.name}`),ee.success(`âœ… Avatars generated and saved for ${t.name}`),N}catch(K){return N.error=String(K),o==null||o("error",N.error),ee.error(`Failed to generate/save avatars for ${t.name}:`,K),N}},async generateAvatarsForCharacters(t,o){const{forceRegenerate:i=!1,maxConcurrent:N=2,onProgress:a}=o||{};ee.info("ðŸŽ¨ Starting batch avatar generation...");const y=await Ee.getCharacterData();let b;if(t&&t.length>0?b=y.characters.filter(I=>t.includes(I.id)):b=y.characters.filter(I=>{var x,P;return i?!!((x=I.photos)!=null&&x.original||(P=I.photos)!=null&&P.face):Ee.needsAvatars(I)}),b.length===0)return ee.info("No characters need avatar generation"),{results:[],successCount:0,failCount:0,skipCount:0};ee.info(`Processing ${b.length} characters for avatar generation`);const c=[],D=new Map;for(let I=0;I<b.length;I+=N){const P=b.slice(I,I+N).map(async W=>{var X,Q,ne,B,ie;const L={characterId:W.id,characterName:W.name,success:!1};try{if(!!!((X=W.photos)!=null&&X.original||(Q=W.photos)!=null&&Q.face||(ne=W.photos)!=null&&ne.body||(B=W.photos)!=null&&B.bodyNoBg))return L.skipped=!0,L.skipReason="No photo available",L;if(!i&&((ie=W.avatars)!=null&&ie.winter))return L.skipped=!0,L.skipReason="Avatars already exist",L;a==null||a(W.id,"generating",`Generating avatars for ${W.name}...`),ee.info(`ðŸŽ¨ Generating avatars for ${W.name}...`);const K=await Ee.generateClothingAvatars(W);return!K.success||!K.avatars?(L.error=K.error||"Avatar generation failed",a==null||a(W.id,"error",L.error),L):(L.avatars=K.avatars,L.success=!0,D.set(W.id,{...W,avatars:K.avatars}),a==null||a(W.id,"complete",`Avatars generated for ${W.name}`),ee.success(`âœ… Avatars generated for ${W.name}`),L)}catch(te){return L.error=String(te),a==null||a(W.id,"error",L.error),ee.error(`Failed to generate avatars for ${W.name}:`,te),L}}),F=await Promise.all(P);c.push(...F)}if(D.size>0){ee.info(`ðŸ’¾ Saving ${D.size} character avatar updates...`);const I=await Ee.getCharacterData(),x=I.characters.map(P=>D.get(P.id)||P);await Ee.saveCharacterData({...I,characters:x}),ee.success(`ðŸ’¾ Saved character data for ${D.size} characters`)}const _=c.filter(I=>I.success).length,C=c.filter(I=>!I.success&&!I.skipped).length,p=c.filter(I=>I.skipped).length;return ee.info(`Avatar generation complete: ${_} success, ${C} failed, ${p} skipped`),{results:c,successCount:_,failCount:C,skipCount:p}},async regenerateAvatarsForCharacter(t,o,i){ee.info(`ðŸ”„ Regenerating avatars for character ${t}...`);const a=(await Ee.getCharacterData()).characters.find(b=>b.id===t);if(!a)return{characterId:t,characterName:"Unknown",success:!1,error:"Character not found"};const y={...a,avatars:{status:"pending"}};return Ee.generateAndSaveAvatarForCharacter(y,o?(b,c)=>o(b,c):void 0,i)}},Ks={sm:"h-1",md:"h-2",lg:"h-3"},qi={default:"bg-indigo-600",success:"bg-green-500",warning:"bg-yellow-500",gradient:"bg-gradient-to-r from-indigo-500 to-indigo-600"};function Ui({value:t,max:o=100,label:i,showPercentage:N=!1,size:a="md",variant:y="gradient",className:b=""}){const c=Math.min(Math.max(t/o*100,0),100);return e.jsxs("div",{className:b,children:[(i||N)&&e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[i&&e.jsx("span",{className:"text-sm font-medium text-gray-700",children:i}),N&&e.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(c),"%"]})]}),e.jsx("div",{className:`w-full bg-gray-200 rounded-full overflow-hidden ${Ks[a]}`,children:e.jsx("div",{className:`${Ks[a]} ${qi[y]} rounded-full transition-all duration-500 ease-out`,style:{width:`${c}%`}})})]})}const lr=cs("ImageLoad");function Sa({src:t,alt:o,className:i,label:N}){const[a,y]=l.useState(!0),[b,c]=l.useState(null),D=l.useRef(0),_=l.useRef(null);l.useEffect(()=>{t&&t.length>100?(D.current=Date.now(),lr.info(`â³ Loading ${N||o}`,{isBase64:t==null?void 0:t.startsWith("data:"),sizeKB:Math.round(t.length*3/4/1024)})):D.current=0,y(!0),c(null)},[t,o,N]);const C=()=>{if(y(!1),D.current===0){lr.info(`âœ… Loaded ${N||o} (placeholder/empty)`);return}const I=Date.now()-D.current;c(I);const P=(t==null?void 0:t.startsWith("data:"))?Math.round(t.length*3/4/1024):null,F=_.current?`${_.current.naturalWidth}x${_.current.naturalHeight}`:"unknown";I<100?lr.success(`âœ… Loaded ${N||o} in ${I}ms`,{sizeKB:P,naturalSize:F}):I<500?lr.info(`âœ… Loaded ${N||o} in ${I}ms`,{sizeKB:P,naturalSize:F}):I<2e3?lr.warn(`âš ï¸ Slow load: ${N||o} took ${I}ms`,{sizeKB:P,naturalSize:F}):lr.error(`ðŸ¢ Very slow: ${N||o} took ${I}ms`,{sizeKB:P,naturalSize:F}),I>1e3&&Ki({type:"slow_image_load",label:N||o,loadTimeMs:I,sizeKB:P,naturalSize:F,userAgent:navigator.userAgent,timestamp:new Date().toISOString()})},p=()=>{if(y(!1),D.current===0){lr.error(`âŒ Failed to load ${N||o} (no data received)`);return}const I=Date.now()-D.current;lr.error(`âŒ Failed to load ${N||o} after ${I}ms`)};return e.jsx("img",{ref:_,src:t,alt:o,className:i,onLoad:C,onError:p,draggable:!1})}async function Ki(t){try{await fetch("/api/log-error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errorType:"Performance",message:`Slow image load: ${t.label} took ${t.loadTimeMs}ms`,userAgent:t.userAgent,timestamp:t.timestamp,url:window.location.href})})}catch{}}function Ji({step:t,text:o}){const i=`wizard_helper_dismissed_${t}`,[N,a]=l.useState(()=>localStorage.getItem(i)==="true");l.useEffect(()=>{const b=localStorage.getItem(i)==="true";a(b)},[t,i]);const y=()=>{localStorage.setItem(i,"true"),a(!0)};return N?null:e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg px-3 py-2 md:px-4 md:py-3 mb-4 flex items-start gap-2 md:gap-3",children:[e.jsx("p",{className:"text-sm text-indigo-700 flex-1",children:o}),e.jsx("button",{onClick:y,className:"text-indigo-400 hover:text-indigo-600 transition-colors flex-shrink-0 p-0.5","aria-label":"Dismiss",children:e.jsx(zt,{size:16})})]})}function Qi({current:t,total:o,message:i,isGenerating:N=!0,coverImages:a,jobId:y,onCancel:b,onMinimize:c,characters:D=[],isStalled:_=!1,onDismissStalled:C,isImpersonating:p=!1}){const{language:I}=Ot(),{user:x}=ms(),P=(x==null?void 0:x.role)==="admin"||p,[F,W]=l.useState(!1),[L,X]=l.useState(0),Q=[{en:"{name} is getting ready for their big adventure...",de:"{name} macht sich bereit fÃ¼r das grosse Abenteuer...",fr:"{name} se prÃ©pare pour sa grande aventure..."},{en:"{name} is practicing their hero pose...",de:"{name} Ã¼bt gerade die Heldenpose...",fr:"{name} s'entraÃ®ne Ã  prendre la pose du hÃ©ros..."},{en:"{name} can't wait to see what happens next!",de:"{name} kann es kaum erwarten zu sehen, was als NÃ¤chstes passiert!",fr:"{name} a hÃ¢te de voir ce qui va se passer !"},{en:"{name} is warming up for the adventure ahead...",de:"{name} wÃ¤rmt sich fÃ¼r das bevorstehende Abenteuer auf...",fr:"{name} s'Ã©chauffe pour l'aventure Ã  venir..."},{en:"{name} just found a magic feather! Adding it to the story...",de:"{name} hat gerade eine Zauberfeder gefunden! Wir fÃ¼gen sie der Geschichte hinzu...",fr:"{name} vient de trouver une plume magique ! On l'ajoute au rÃ©cit..."},{en:"{name} is whispering secrets to the story wizard...",de:"{name} flÃ¼stert dem Geschichtenzauberer Geheimnisse zu...",fr:"{name} chuchote des secrets au magicien des histoires..."},{en:"{name} is peeking around the corner to see what's coming...",de:"{name} schaut um die Ecke, um zu sehen, was kommt...",fr:"{name} jette un coup d'Å“il au coin pour voir ce qui arrive..."},{en:"{name} is doing a little happy dance!",de:"{name} macht einen kleinen Freudentanz!",fr:"{name} fait une petite danse de joie !"},{en:"{name} is collecting stars for the story...",de:"{name} sammelt Sterne fÃ¼r die Geschichte...",fr:"{name} collectionne des Ã©toiles pour le rÃ©cit..."},{en:"{name} just met a friendly dragon! Making friends...",de:"{name} hat gerade einen freundlichen Drachen getroffen! Sie werden Freunde...",fr:"{name} vient de rencontrer un dragon amical ! Ils deviennent amis..."}],ne=l.useRef({}),[B,ie]=l.useState(null),te=l.useMemo(()=>D.filter(de=>{var M;const se=de.avatars;return se&&(((M=se.faceThumbnails)==null?void 0:M.standard)||se.standard||se.summer||se.winter||se.formal||se.hasFullAvatars)}),[D]),K=de=>{var Fe;const se=de.avatars;if(!se)return"";if((Fe=se.faceThumbnails)!=null&&Fe.standard)return se.faceThumbnails.standard;const M=[];return se.standard&&M.push(se.standard),se.summer&&M.push(se.summer),se.winter&&M.push(se.winter),se.formal&&M.push(se.formal),M[Math.floor(Math.random()*M.length)]||""},$=l.useMemo(()=>{const de=[{type:"message",key:"timeInfo"},{type:"message",key:"tipCharacters"},{type:"message",key:"emailInfo"},{type:"message",key:"tipStoryPlot"},{type:"message",key:"canClose"},{type:"message",key:"tipLocations"},{type:"message",key:"tipArtStyle"}];if(te.length===0)return de;const se=[],M=Math.max(de.length,te.length);for(let Fe=0;Fe<M;Fe++)se.push(de[Fe%de.length]),se.push({type:"character",char:te[Fe%te.length]});return se},[te]);if(l.useEffect(()=>{if($.length<=1)return;const de=setInterval(()=>{X(se=>(se+1)%$.length)},8e3);return()=>clearInterval(de)},[$.length]),l.useEffect(()=>{if($.length===0)return;const de=$[L];if(de.type==="character"){const se=de.char,M=K(se),Ue=((ne.current[se.id]??-1)+1)%Q.length;ne.current[se.id]=Ue;const _e=Q[Ue],$t=(I==="de"?_e.de:I==="fr"?_e.fr:_e.en).replace("{name}",se.name);ie({avatarUrl:M,message:$t})}else ie(null)},[L,$,I]),!N||o===0)return null;const Z=o===100?t:Math.round(t/o*100),xe=de=>{if(de)return typeof de=="string"?de:de.imageData},fe=xe(a==null?void 0:a.frontCover),me=xe(a==null?void 0:a.initialPage),ge=xe(a==null?void 0:a.backCover),Ne=!!fe,Se=!!me,re=!!ge,$e=Ne||Se||re,it={en:{title:"Creating Your Story!",timeInfo:"Your story will start to display in about 1 minute. The full story can take up to 10 minutes.",emailInfo:"You will receive an email when your story is ready.",canClose:"You can wait here or close the browser - your story will keep generating.",tipCharacters:"The better you describe your characters, the more fun the story becomes!",tipStoryPlot:'"Story Plot / Story Details" lets you craft your own personal adventure.',tipLocations:'Add your hometown and favorite places to "Story Plot / Story Details" for a personal touch.',tipArtStyle:"What's your favorite art style? For picture books, watercolor works great!",coversPreview:"Cover Preview",frontCover:"Front",initialPage:"Inside",backCover:"Back",cancelJob:"Cancel Generation",cancelling:"Cancelling...",stalled:"Generation seems stuck",stalledDesc:"No progress for a while. This can happen due to high server load.",continueWaiting:"Keep Waiting",continueInBackground:"Continue in Background"},de:{title:"Geschichte wird erstellt!",timeInfo:"Deine Geschichte wird in etwa 1 Minute angezeigt. Die Erstellung der vollstÃ¤ndigen Geschichte kann bis zu 10 Minuten dauern.",emailInfo:"Du erhÃ¤ltst eine E-Mail, wenn deine Geschichte bereit ist.",canClose:"Du kannst hier warten oder den Browser schliessen - deine Geschichte wird weiter generiert.",tipCharacters:"Je besser du deine Charaktere beschreibst, desto lustiger wird die Geschichte!",tipStoryPlot:'Mit "Handlung / Angaben zur Geschichte" kannst du dein ganz persÃ¶nliches Abenteuer gestalten.',tipLocations:'FÃ¼ge deinen Heimatort und Lieblingsorte zu "Handlung / Angaben zur Geschichte" hinzu fÃ¼r eine persÃ¶nliche Note.',tipArtStyle:"Was ist dein Lieblings-Kunststil? FÃ¼r BilderbÃ¼cher funktioniert Aquarell besonders gut!",coversPreview:"Cover-Vorschau",frontCover:"Vorne",initialPage:"Innen",backCover:"Hinten",cancelJob:"Generierung abbrechen",cancelling:"Wird abgebrochen...",stalled:"Generierung scheint hÃ¤ngen zu bleiben",stalledDesc:"Seit einer Weile kein Fortschritt. Dies kann bei hoher Serverlast passieren.",continueWaiting:"Weiter warten",continueInBackground:"Im Hintergrund fortsetzen"},fr:{title:"CrÃ©ation de votre histoire!",timeInfo:"Votre rÃ©cit commencera Ã  s'afficher dans environ 1 minute. Le rÃ©cit complet peut prendre jusqu'Ã  10 minutes.",emailInfo:"Vous recevrez un email quand votre rÃ©cit sera prÃªt.",canClose:"Vous pouvez attendre ici ou fermer le navigateur - votre rÃ©cit continuera Ã  Ãªtre gÃ©nÃ©rÃ©.",tipCharacters:"Mieux vous dÃ©crivez vos personnages, plus le rÃ©cit sera amusant !",tipStoryPlot:'"Intrigue / Contexte du rÃ©cit" vous permet de crÃ©er votre propre aventure personnelle.',tipLocations:'Ajoutez votre ville et vos endroits prÃ©fÃ©rÃ©s Ã  "Intrigue / Contexte du rÃ©cit" pour une touche personnelle.',tipArtStyle:"Quel est votre style artistique prÃ©fÃ©rÃ© ? Pour les livres d'images, l'aquarelle fonctionne trÃ¨s bien !",coversPreview:"AperÃ§u des couvertures",frontCover:"Avant",initialPage:"IntÃ©rieur",backCover:"ArriÃ¨re",cancelJob:"Annuler la gÃ©nÃ©ration",cancelling:"Annulation...",stalled:"La gÃ©nÃ©ration semble bloquÃ©e",stalledDesc:"Aucun progrÃ¨s depuis un moment. Cela peut arriver en cas de forte charge serveur.",continueWaiting:"Continuer Ã  attendre",continueInBackground:"Continuer en arriÃ¨re-plan"}},Ae=it[I]||it.en,qe=({imageData:de,label:se,isReady:M})=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`w-16 h-16 md:w-20 md:h-20 rounded-lg overflow-hidden border-2 ${M?"border-green-400":"border-gray-200"} bg-gray-100 flex items-center justify-center`,children:M&&de?e.jsx("img",{src:de,alt:se,className:"w-full h-full object-cover"}):e.jsx(wt,{size:20,className:"animate-spin text-gray-400"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[M&&e.jsx(Bs,{size:12,className:"text-green-500"}),e.jsx("span",{className:`text-xs ${M?"text-green-600 font-medium":"text-gray-400"}`,children:se})]})]});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`bg-white rounded-2xl shadow-xl w-full p-6 md:p-8 ${$e?"max-w-lg":"max-w-md"}`,children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"relative inline-block mb-3",children:[e.jsx(wt,{size:48,className:"animate-spin text-indigo-600"}),e.jsx("span",{className:"absolute -top-1 -right-1 text-xl",children:"âœ¨"})]}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-800",children:Ae.title})]}),!$e&&$.length>0&&e.jsx("div",{className:"mb-6 min-h-[220px] flex items-center justify-center",children:(()=>{const de=$[L];if(de.type==="character"&&B)return e.jsxs("div",{className:"flex flex-col items-center gap-3 animate-fade-in",children:[e.jsx("div",{className:"w-32 h-44 md:w-40 md:h-52 rounded-xl overflow-hidden border-4 border-indigo-200 shadow-lg bg-gradient-to-b from-indigo-50 to-purple-50",children:e.jsx("img",{src:B.avatarUrl,alt:de.char.name,className:"w-full h-full object-contain"})}),e.jsx("p",{className:"text-sm text-center text-gray-600 max-w-xs italic",children:B.message})]},`char-${de.char.id}-${L}`);if(de.type==="message"){const se=de.key,M=Ae[se]||"",Fe=se==="timeInfo"?e.jsx(ki,{size:20,className:"text-indigo-500 shrink-0"}):se==="emailInfo"?e.jsx(cn,{size:20,className:"text-indigo-500 shrink-0"}):e.jsx(Bs,{size:20,className:"text-indigo-500 shrink-0"});return e.jsxs("div",{className:"flex items-start gap-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 max-w-sm animate-fade-in",children:[Fe,e.jsx("p",{className:"text-sm text-gray-700",children:M})]})}return null})()}),$e&&e.jsxs("div",{className:"mb-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-indigo-700 text-center mb-3",children:Ae.coversPreview}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(qe,{imageData:fe,label:Ae.frontCover,isReady:Ne}),e.jsx(qe,{imageData:me,label:Ae.initialPage,isReady:Se}),e.jsx(qe,{imageData:ge,label:Ae.backCover,isReady:re})]})]}),$e&&e.jsxs("div",{className:"mb-4 text-center",children:[e.jsxs("p",{className:"text-sm text-gray-600 flex items-center justify-center gap-2",children:[e.jsx(wt,{size:14,className:"animate-spin text-indigo-500"}),I==="de"?"Bilder fÃ¼r die Seiten werden jetzt erstellt...":I==="fr"?"CrÃ©ation des images pour les pages en cours...":"Now generating images for the pages..."]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:I==="de"?"Dies kann einige Minuten dauern. Du kannst den Browser schliessen.":I==="fr"?"Cela peut prendre quelques minutes. Vous pouvez fermer le navigateur.":"This may take a few minutes. You can close the browser."})]}),e.jsx("div",{className:"mb-4",children:e.jsx(Ui,{value:Z,max:100,showPercentage:!0,size:"lg"})}),c&&e.jsx("button",{onClick:c,className:"w-full mb-4 px-4 py-2.5 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded-lg font-medium transition-colors text-sm",children:Ae.continueInBackground}),_&&e.jsx("div",{className:"mb-4 bg-amber-50 border border-amber-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ln,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-amber-800 mb-1",children:Ae.stalled}),e.jsx("p",{className:"text-sm text-amber-700 mb-3",children:Ae.stalledDesc}),e.jsxs("div",{className:"flex gap-2",children:[C&&e.jsx("button",{onClick:C,className:"px-3 py-1.5 bg-amber-100 hover:bg-amber-200 text-amber-800 rounded-lg text-sm font-medium transition-colors",children:Ae.continueWaiting}),b&&e.jsx("button",{onClick:()=>{if(!F){W(!0);try{b()}finally{W(!1)}}},disabled:F,className:"px-3 py-1.5 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:F?Ae.cancelling:Ae.cancelJob})]})]})]})}),P&&y&&b&&e.jsxs("button",{onClick:async()=>{if(!F){W(!0);try{b()}finally{W(!1)}}},disabled:F,className:"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:[F?e.jsx(wt,{size:16,className:"animate-spin"}):e.jsx(Ci,{size:16}),F?Ae.cancelling:Ae.cancelJob]})]})})}function os(t,o){const i=new Blob([t],{type:"text/plain;charset=utf-8"}),N=URL.createObjectURL(i),a=document.createElement("a");a.href=N,a.download=o,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(N)}function ls(t,o=0){const i="  ".repeat(o);if(t==null)return`${i}null`;if(typeof t=="boolean")return`${i}${t?"YES":"NO"}`;if(typeof t=="number")return`${i}${t}`;if(typeof t=="string")return`${i}${t}`;if(Array.isArray(t))return t.length===0?`${i}[]`:t.map((N,a)=>`${i}[${a}]: ${ls(N,0)}`).join(`
`);if(typeof t=="object"){const N=Object.entries(t);return N.length===0?`${i}{}`:N.map(([a,y])=>{const b=ls(y,o+1);return typeof y=="object"&&y!==null?`${i}${a}:
${b}`:`${i}${a}: ${b.trim()}`}).join(`
`)}return`${i}${String(t)}`}function Js({data:t,language:o,title:i}){const[N,a]=l.useState(new Set);if(!t)return e.jsx("div",{className:"text-gray-400 italic text-sm",children:o==="de"?"Keine Daten":"No data"});let y=t;if(typeof t=="string")try{y=JSON.parse(t)}catch{return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-1",children:e.jsxs("button",{onClick:()=>os(t,`${i||"evaluation"}.txt`),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1",title:"Download as text file",children:[e.jsx($a,{size:12})," Download"]})}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap bg-gray-50 p-3 rounded max-h-80 overflow-auto font-mono",children:t})]})}const b=_=>{const C=new Set(N);C.has(_)?C.delete(_):C.add(_),a(C)},c=()=>{const _=ls(y);os(_,`${i||"evaluation"}.txt`)},D=(_,C,p=0)=>{const I=N.has(_);if(C==null)return e.jsx("span",{className:"text-gray-400",children:"null"});if(typeof C=="boolean")return e.jsx("span",{className:C?"text-green-600 font-medium":"text-red-600 font-medium",children:C?"âœ“":"âœ—"});if(typeof C=="number"){const x=C>=70?"text-green-600":C>=50?"text-yellow-600":"text-red-600";return e.jsx("span",{className:`font-bold ${x}`,children:C})}if(typeof C=="string")return C.length>100?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>b(_),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[I?e.jsx(Jt,{size:14}):e.jsx(is,{size:14}),I?"Collapse":`Show (${C.length} chars)`]}),I&&e.jsx("div",{className:"mt-1 p-2 bg-gray-100 rounded text-sm whitespace-pre-wrap font-mono",children:C})]}):e.jsx("span",{className:"text-gray-700",children:C});if(Array.isArray(C))return C.length===0?e.jsx("span",{className:"text-gray-400",children:"[]"}):e.jsx("div",{className:"ml-2 border-l-2 border-gray-200 pl-2",children:C.map((x,P)=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"text-gray-400 text-xs",children:["[",P,"]"]})," ",D(`${_}.${P}`,x,p+1)]},P))});if(typeof C=="object"){const x=Object.entries(C);return x.length===0?e.jsx("span",{className:"text-gray-400",children:"{}"}):p>0?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>b(_),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[I?e.jsx(Jt,{size:14}):e.jsx(is,{size:14}),I?"Collapse":`{${x.length} fields}`]}),I&&e.jsx("div",{className:"ml-2 mt-1 border-l-2 border-gray-200 pl-2",children:x.map(([P,F])=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-600",children:[P,":"]})," ",D(`${_}.${P}`,F,p+1)]},P))})]}):e.jsx("div",{className:"space-y-1",children:x.map(([P,F])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-600 min-w-[100px]",children:[P,":"]}),e.jsx("div",{className:"flex-1",children:D(`${_}.${P}`,F,p+1)})]},P))})}return e.jsx("span",{children:String(C)})};return e.jsxs("div",{className:"text-sm space-y-1 max-h-96 overflow-auto",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("button",{onClick:c,className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-1 bg-blue-50 rounded hover:bg-blue-100",title:"Download as text file",children:[e.jsx($a,{size:12})," Download"]})}),D("root",y)]})}function Zi({beforeImage:t,maskImage:o,onEnlarge:i}){return e.jsxs("div",{className:"relative w-40 h-40 cursor-pointer hover:ring-2 hover:ring-amber-400 rounded overflow-hidden border",onClick:()=>i(t,"Before with Mask"),children:[e.jsx("img",{src:t,alt:"Before",className:"w-full h-full object-contain"}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:{backgroundImage:`url(${o})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",mixBlendMode:"multiply",opacity:.5}}),e.jsx("img",{src:o,alt:"Mask overlay",className:"absolute inset-0 w-full h-full object-contain pointer-events-none",style:{mixBlendMode:"screen",opacity:.7,filter:"sepia(1) saturate(5) hue-rotate(-50deg)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent text-white text-[10px] text-center py-1 font-medium",children:"ðŸŽ¯ Edit Area"})]})}function zr({retryHistory:t,totalAttempts:o,language:i,onRevertRepair:N}){const[a,y]=l.useState(null);if(!t||t.length===0)return null;const b=t.filter(c=>c.type==="auto_repair").length;return e.jsxs(e.Fragment,{children:[a&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>y(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("div",{className:"absolute -top-8 left-0 text-white text-sm",children:a.title}),e.jsx("img",{src:a.src,alt:a.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute -top-8 right-0 text-white hover:text-gray-300",onClick:()=>y(null),children:"âœ• Close"})]})}),e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ai,{size:14}),i==="de"?"Generierungshistorie":i==="fr"?"Historique de gÃ©nÃ©ration":"Generation History",b>0&&e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded",children:["ðŸ”§ ",b," ",i==="de"?"Reparatur":"repair",b>1?i==="de"?"en":"s":""]})]}),e.jsxs("span",{className:"text-purple-600",children:[o," ",i==="de"?"Versuche":i==="fr"?"tentatives":"attempts"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:t.map((c,D)=>{var _,C;return e.jsxs("div",{className:`border rounded-lg p-3 ${c.type==="auto_repair"?"bg-amber-50 border-amber-300":D===t.length-1?"bg-green-50 border-green-300":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-sm",children:[c.type==="auto_repair"?e.jsx("span",{className:"text-amber-700",children:"ðŸ”§ Auto-Repair"}):e.jsx(e.Fragment,{children:i==="de"?`Versuch ${c.attempt}`:i==="fr"?`Tentative ${c.attempt}`:`Attempt ${c.attempt}`}),c.type==="text_edit"&&e.jsx("span",{className:"text-xs ml-2 text-blue-600",children:"(text edit)"}),c.type==="text_edit_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(text edit failed)"}),c.type==="auto_repair_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(auto-repair failed)"}),D===t.length-1&&c.type!=="auto_repair"&&e.jsx("span",{className:"text-xs ml-2 text-green-600 font-bold",children:"âœ“ USED"})]}),c.type==="auto_repair"&&c.preRepairScore!==void 0&&c.postRepairScore!==void 0?e.jsxs("span",{className:"font-bold text-sm",children:[e.jsxs("span",{className:c.preRepairScore>=70?"text-green-600":c.preRepairScore>=50?"text-yellow-600":"text-red-600",children:[c.preRepairScore,"%"]}),e.jsx("span",{className:"text-gray-400 mx-1",children:"â†’"}),e.jsxs("span",{className:c.postRepairScore>=70?"text-green-600":c.postRepairScore>=50?"text-yellow-600":"text-red-600",children:[c.postRepairScore,"%"]})]}):c.score!==void 0&&e.jsxs("span",{className:`font-bold ${c.score>=70?"text-green-600":c.score>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(c.score),"%"]})]}),c.error&&e.jsxs("div",{className:"text-xs text-red-600 mb-2",children:["Error: ",c.error]}),c.textIssue&&c.textIssue!=="NONE"&&e.jsxs("div",{className:"text-xs text-orange-600 mb-2",children:["Text issue: ",c.textIssue,c.expectedText&&e.jsxs("span",{className:"block",children:['Expected: "',c.expectedText,'"']}),c.actualText&&e.jsxs("span",{className:"block",children:['Actual: "',c.actualText,'"']})]}),c.type==="auto_repair"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[c.fixTargetsCount&&e.jsxs("div",{className:"text-xs text-amber-700",children:["Fixed ",c.fixTargetsCount," target",c.fixTargetsCount>1?"s":""]}),N&&((C=(_=c.repairDetails)==null?void 0:_[0])==null?void 0:C.beforeImage)&&c.postRepairScore!==void 0&&c.preRepairScore!==void 0&&c.postRepairScore<=c.preRepairScore&&e.jsxs("button",{onClick:()=>N(D,c.repairDetails[0].beforeImage),className:"text-xs px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded border border-red-300 transition-colors",children:["â†©ï¸ ",i==="de"?"ZurÃ¼cksetzen":"Revert to Original"]})]}),c.postRepairScore!==void 0&&c.preRepairScore!==void 0&&c.postRepairScore<c.preRepairScore&&e.jsxs("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded border border-red-200",children:["âš ï¸ ",i==="de"?`Bewertung verschlechtert: ${c.preRepairScore}% â†’ ${c.postRepairScore}%`:`Score decreased: ${c.preRepairScore}% â†’ ${c.postRepairScore}%`]}),c.bboxDetection&&c.bboxDetection.length>0&&e.jsxs("details",{className:"text-sm mb-2",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-700 font-medium hover:text-blue-900",children:["ðŸ“¦ ",i==="de"?"Bounding Box Erkennung":"Bounding Box Detection"," (",c.bboxDetection.length,")"]}),e.jsx("div",{className:"mt-3 space-y-2",children:c.bboxDetection.map((p,I)=>e.jsxs("div",{className:`p-3 rounded-lg border ${p.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:`font-medium text-sm ${p.success?"text-green-800":"text-red-800"}`,children:[p.success?"âœ“":"âœ—"," ",p.issue.substring(0,60),p.issue.length>60?"...":""]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${p.severity==="CRITICAL"?"bg-red-200 text-red-800":p.severity==="MAJOR"?"bg-orange-200 text-orange-800":p.severity==="MODERATE"?"bg-yellow-200 text-yellow-800":"bg-gray-200 text-gray-800"}`,children:[p.severity," â€¢ ",p.type]})]}),p.success&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${p.faceBox?"bg-purple-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-purple-800",children:"Face Box:"}),p.faceBox?e.jsxs("span",{className:"ml-1 font-mono text-purple-600",children:["[",p.faceBox.map(x=>(x*100).toFixed(0)+"%").join(", "),"]"]}):e.jsx("span",{className:"ml-1 text-gray-500 italic",children:"not detected"})]}),e.jsxs("div",{className:`p-2 rounded ${p.bodyBox?"bg-blue-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-blue-800",children:"Body Box:"}),p.bodyBox?e.jsxs("span",{className:"ml-1 font-mono text-blue-600",children:["[",p.bodyBox.map(x=>(x*100).toFixed(0)+"%").join(", "),"]"]}):e.jsx("span",{className:"ml-1 text-gray-500 italic",children:"not detected"})]})]}),p.label&&p.label!==p.issue&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Detected as:"})," ",p.label]}),p.usage&&e.jsxs("div",{className:"mt-1 text-xs text-gray-400",children:["Tokens: ",p.usage.input_tokens," in / ",p.usage.output_tokens," out"]})]},I))})]}),e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["ðŸ“Š ",i==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-red-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-red-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 px-2 py-0.5 rounded",children:"Before"}),e.jsxs("span",{className:"text-red-600",children:[c.preRepairScore,"%"]})]}),e.jsx(Js,{data:c.preRepairEval||c.reasoning,language:i,title:`evaluation-before-attempt-${D}`})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-green-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded",children:"After"}),e.jsxs("span",{className:"text-green-600",children:[c.postRepairScore,"%"]})]}),e.jsx(Js,{data:c.postRepairEval,language:i,title:`evaluation-after-attempt-${D}`})]})]})]}),c.repairDetails&&c.repairDetails.length>0&&e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["ðŸ–¼ï¸ ",i==="de"?"Reparatur-Details":"Repair Details"," (",c.repairDetails.length,")"]}),e.jsx("div",{className:"mt-3 space-y-3",children:c.repairDetails.map((p,I)=>{var x,P;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-medium text-amber-800 text-base",children:p.description}),p.modelId&&e.jsx("span",{className:"text-xs text-gray-400 bg-gray-100 px-2 py-0.5 rounded",children:p.modelId})]}),e.jsxs("details",{className:"mb-3",children:[e.jsxs("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700 text-sm flex items-center gap-2",children:["Show fix prompt",e.jsxs("button",{onClick:F=>{F.stopPropagation(),os(p.fullPrompt||p.fixPrompt||"",`fix-prompt-${I}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx($a,{size:10})," Download"]})]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded text-sm text-gray-600 whitespace-pre-wrap font-mono max-h-96 overflow-auto",children:p.fullPrompt||p.fixPrompt})]}),e.jsxs("div",{className:"flex gap-4 items-start",children:[p.beforeImage&&p.maskImage?e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before + Mask"}),e.jsx(Zi,{beforeImage:p.beforeImage,maskImage:p.maskImage,onEnlarge:(F,W)=>y({src:F,title:W})})]}):p.beforeImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before"}),e.jsx("img",{src:p.beforeImage,alt:"Before",className:"w-32 h-32 object-contain border rounded cursor-pointer hover:ring-2 hover:ring-amber-400",onClick:()=>y({src:p.beforeImage,title:"Before Repair"})})]}),e.jsx("div",{className:"flex items-center h-32 text-gray-400 text-2xl",children:"â†’"}),p.afterImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"After"}),e.jsx("img",{src:p.afterImage,alt:"After",className:"w-32 h-32 object-contain border-2 border-green-300 rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>y({src:p.afterImage,title:"After Repair"})})]})]}),p.verification&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded border text-sm",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"ðŸ” Verification:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[p.verification.lpips&&e.jsxs("div",{className:`p-2 rounded ${p.verification.lpips.changed?"bg-green-100":"bg-yellow-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LPIPS: "}),e.jsx("span",{className:p.verification.lpips.changed?"text-green-700":"text-yellow-700",children:(x=p.verification.lpips.lpipsScore)==null?void 0:x.toFixed(4)}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",p.verification.lpips.changed?"âœ“ changed":"âš  unchanged",")"]})]}),p.verification.llm&&e.jsxs("div",{className:`p-2 rounded ${p.verification.llm.fixed?"bg-green-100":"bg-red-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LLM: "}),e.jsx("span",{className:p.verification.llm.fixed?"text-green-700":"text-red-700",children:p.verification.llm.fixed?"âœ“ Fixed":"âœ— Not fixed"}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",Math.round(p.verification.llm.confidence*100),"%)"]})]})]}),((P=p.verification.llm)==null?void 0:P.explanation)&&e.jsx("div",{className:"mt-2 text-gray-600 text-sm italic",children:p.verification.llm.explanation})]})]},I)})})]})]}),c.type!=="auto_repair"&&c.reasoning?e.jsxs("details",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("summary",{className:"cursor-pointer",children:"Feedback"}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap bg-gray-50 p-3 rounded text-sm overflow-auto max-h-60 font-mono",children:c.reasoning})]}):c.type!=="auto_repair"&&c.score===0&&e.jsx("div",{className:"text-sm text-gray-500 italic mb-2",children:i==="de"?"QualitÃ¤tsbewertung fehlgeschlagen":i==="fr"?"Ã‰valuation de qualitÃ© Ã©chouÃ©e":"Quality evaluation failed"}),c.imageData&&c.type!=="auto_repair"&&e.jsxs("details",{children:[e.jsx("summary",{className:"cursor-pointer text-sm text-blue-600",children:i==="de"?"Bild anzeigen":i==="fr"?"Voir image":"View image"}),e.jsx("img",{src:c.imageData,alt:`Attempt ${c.attempt}`,className:`mt-2 w-full rounded border ${D===t.length-1?"border-green-300":"border-gray-200 opacity-75"}`})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(c.timestamp).toLocaleTimeString()})]},D)})})]})]})}function Yi({src:t,alt:o,onClose:i}){const N=l.useCallback(a=>{a.key==="Escape"&&i()},[i]);return l.useEffect(()=>(t&&(document.addEventListener("keydown",N),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",N),document.body.style.overflow="unset"}),[t,N]),t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm cursor-pointer",onClick:i,children:[e.jsx("button",{onClick:i,className:"absolute top-4 right-4 p-2 rounded-full bg-black/50 hover:bg-black/70 text-white transition-colors z-10","aria-label":"Close",children:e.jsx(zt,{size:24})}),e.jsx("img",{src:t,alt:o||"Enlarged image",className:"max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl",onClick:a=>a.stopPropagation()})]}):null}function ta({referencePhotos:t,landmarkPhotos:o,language:i}){var I;const[N,a]=l.useState(null),y=t&&t.length>0,b=o&&o.length>0;if(!y&&!b)return null;const c=((t==null?void 0:t.length)||0)+((o==null?void 0:o.length)||0),D=x=>{switch(x){case"bodyNoBg":case"body-no-bg":return i==="de"?"GanzkÃ¶rper (freigestellt)":i==="fr"?"Corps entier (dÃ©tourÃ©)":"Full body (no bg)";case"body":return i==="de"?"GanzkÃ¶rper":i==="fr"?"Corps entier":"Full body";case"face":return i==="de"?"Gesicht":i==="fr"?"Visage":"Face only";case"clothing-winter":return i==="de"?"Winter-Avatar":i==="fr"?"Avatar hiver":"Winter avatar";case"clothing-summer":return i==="de"?"Sommer-Avatar":i==="fr"?"Avatar Ã©tÃ©":"Summer avatar";case"clothing-formal":return i==="de"?"Formell-Avatar":i==="fr"?"Avatar formel":"Formal avatar";case"clothing-standard":return i==="de"?"Standard-Avatar":i==="fr"?"Avatar standard":"Standard avatar";case"none":return i==="de"?"Kein Foto":i==="fr"?"Pas de photo":"No photo";default:return x}},_=x=>{switch(x){case"bodyNoBg":case"body-no-bg":return"bg-green-100 text-green-700 border-green-300";case"body":return"bg-blue-100 text-blue-700 border-blue-300";case"face":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"clothing-winter":return"bg-cyan-100 text-cyan-700 border-cyan-300";case"clothing-summer":return"bg-orange-100 text-orange-700 border-orange-300";case"clothing-formal":return"bg-purple-100 text-purple-700 border-purple-300";case"clothing-standard":return"bg-teal-100 text-teal-700 border-teal-300";case"none":return"bg-red-100 text-red-700 border-red-300";default:return"bg-gray-100 text-gray-700 border-gray-300"}},C=(I=t.find(x=>x.clothingCategory))==null?void 0:I.clothingCategory,p=x=>{if(!x)return"";switch(x){case"winter":return i==="de"?"Winter":i==="fr"?"Hiver":"Winter";case"summer":return i==="de"?"Sommer":i==="fr"?"Ã‰tÃ©":"Summer";case"formal":return i==="de"?"Formell":i==="fr"?"Formel":"Formal";case"standard":return"Standard";default:return x}};return e.jsxs("details",{className:"bg-pink-50 border border-pink-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-900 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“¸"}),i==="de"?"Referenzfotos":i==="fr"?"Photos de rÃ©fÃ©rence":"Reference Photos",e.jsxs("span",{className:"text-xs text-pink-600",children:["(",c,")"]}),C&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-pink-200 text-pink-800 text-xs rounded",children:["ðŸ‘• ",p(C)]}),b&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-amber-200 text-amber-800 text-xs rounded",children:["ðŸ“ ",o.length," ",i==="de"?"Wahrzeichen":"Landmark"]})]}),y&&e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2",children:t.map((x,P)=>e.jsxs("div",{className:"bg-white rounded-lg p-2 border border-pink-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:x.name}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap ${_(x.photoType)}`,children:D(x.photoType)})]}),x.photoUrl&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:x.photoUrl,alt:`${x.name} - ${D(x.photoType)}`,className:`w-full max-h-32 object-contain rounded border bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity ${x.isStyled?"border-purple-400 ring-2 ring-purple-200":"border-gray-200"}`,onClick:()=>a(x.photoUrl),title:"Click to enlarge"}),x.isStyled&&e.jsx("span",{className:"absolute top-1 right-1 px-1 py-0.5 text-[9px] font-bold bg-purple-500 text-white rounded",children:"ðŸŽ¨ STYLED"})]}),x.photoHash&&e.jsxs("div",{className:"mt-1 text-[9px] font-mono text-gray-500 bg-gray-100 px-1 py-0.5 rounded text-center",children:["ðŸ” ",x.photoHash]})]})]},P))}),b&&e.jsxs("div",{className:y?"mt-4 pt-3 border-t border-pink-200":"mt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-amber-700 mb-2 flex items-center gap-1",children:["ðŸ“ ",i==="de"?"Wahrzeichen-Referenzfotos":i==="fr"?"Photos de monuments":"Landmark Reference Photos"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:o.map((x,P)=>e.jsxs("div",{className:"bg-amber-50 rounded-lg p-2 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:x.name}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap bg-amber-100 text-amber-700 border-amber-300",children:"ðŸ“ LANDMARK"})]}),x.photoData&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:x.photoData,alt:`${x.name} landmark`,className:"w-full max-h-32 object-contain rounded border border-amber-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>a(x.photoData),title:"Click to enlarge"})}),x.attribution&&e.jsxs("div",{className:"mt-1 text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 rounded truncate",title:x.attribution,children:["ðŸ“· ",x.attribution]}),x.source&&e.jsxs("div",{className:"mt-0.5 text-[9px] text-gray-400",children:["Source: ",x.source]})]})]},P))})]}),e.jsx(Yi,{src:N,onClose:()=>a(null)})]})}function Xi({pageNumber:t,scene:o,onSceneChange:i,onClose:N,onRegenerate:a,isRegenerating:y,imageRegenerationCost:b,characters:c=[],selectedCharacterIds:D=[],onCharacterSelectionChange:_,consistencyRegen:C}){const{language:p}=Ot(),[I,x]=l.useState(!1),[P,F]=l.useState(!1),W=L=>{_&&(D.includes(L)?_(D.filter(X=>X!==L)):_([...D,L]))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Xe,{size:20}),p==="de"?`Szene bearbeiten - Seite ${t}`:p==="fr"?`Modifier la scÃ¨ne - Page ${t}`:`Edit Scene - Page ${t}`]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:p==="de"?"Bearbeiten Sie die Szenenbeschreibung und wÃ¤hlen Sie die Charaktere aus.":p==="fr"?"Modifiez la description de la scÃ¨ne et sÃ©lectionnez les personnages.":"Edit the scene description and select the characters."})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[c.length>0&&_&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(dn,{size:16}),p==="de"?"Charaktere in dieser Szene:":p==="fr"?"Personnages dans cette scÃ¨ne:":"Characters in this scene:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(L=>{const X=D.includes(L.id);return e.jsxs("button",{type:"button",onClick:()=>W(L.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${X?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[L.photoUrl&&e.jsx("img",{src:L.photoUrl,alt:L.name,className:"w-8 h-8 rounded-full object-cover"}),e.jsx("span",{className:"font-medium",children:L.name}),X&&e.jsx("span",{className:"text-indigo-500",children:"âœ“"})]},L.id)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:p==="de"?"WÃ¤hlen Sie die Charaktere aus, die im Bild erscheinen sollen.":p==="fr"?"SÃ©lectionnez les personnages qui doivent apparaÃ®tre dans l'image.":"Select the characters that should appear in the image."})]}),C&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ln,{className:"text-amber-600",size:20}),e.jsx("h4",{className:"font-semibold text-amber-800",children:p==="de"?"Konsistenz-Korrektur angewendet":p==="fr"?"Correction de cohÃ©rence appliquÃ©e":"Consistency Fix Applied"}),e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded",children:["Score: ",C.score,"%"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-amber-700 mb-2",children:p==="de"?"Behobene Probleme:":p==="fr"?"ProblÃ¨mes corrigÃ©s:":"Issues Fixed:"}),e.jsx("ul",{className:"text-sm text-amber-900 space-y-1",children:C.issues.map((L,X)=>e.jsxs("li",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[L.type.toUpperCase(),L.characterInvolved&&` (${L.characterInvolved})`,":"]}),e.jsx("span",{className:"text-amber-700 ml-2",children:L.description}),e.jsxs("span",{className:"text-amber-600 ml-2 text-xs",children:["â†’ ",L.recommendation]})]},X))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1 text-center",children:"Original"}),e.jsx("img",{src:C.originalImage,alt:"Original",className:"w-full rounded-lg border border-gray-300",draggable:!1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-600 mb-1 text-center",children:p==="de"?"Korrigiert":p==="fr"?"CorrigÃ©":"Fixed"}),e.jsx("img",{src:C.fixedImage,alt:"Fixed",className:"w-full rounded-lg border-2 border-green-500",draggable:!1})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>x(!I),className:"flex items-center gap-1 text-xs text-gray-600 hover:text-gray-800",children:[I?e.jsx(Hs,{size:14}):e.jsx(Jt,{size:14}),p==="de"?"Original-Prompt":p==="fr"?"Prompt original":"Original Prompt"]}),I&&e.jsx("pre",{className:"text-xs bg-gray-100 p-2 rounded overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:C.originalPrompt}),e.jsxs("button",{onClick:()=>F(!P),className:"flex items-center gap-1 text-xs text-green-600 hover:text-green-800",children:[P?e.jsx(Hs,{size:14}):e.jsx(Jt,{size:14}),p==="de"?"Korrigierter Prompt (mit Korrekturen)":p==="fr"?"Prompt corrigÃ© (avec corrections)":"Fixed Prompt (with corrections)"]}),P&&e.jsx("pre",{className:"text-xs bg-green-50 p-2 rounded border border-green-200 overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:C.fixedPrompt})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xs text-gray-400",children:p==="de"?`Korrigiert am ${new Date(C.timestamp).toLocaleString()}`:p==="fr"?`CorrigÃ© le ${new Date(C.timestamp).toLocaleString()}`:`Fixed at ${new Date(C.timestamp).toLocaleString()}`}),C.clothing&&e.jsxs("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded",children:["ðŸŽ¨ ",C.clothing]})]}),C.avatarsUsed&&C.avatarsUsed.length>0&&e.jsxs("div",{className:"mt-3 p-2 bg-blue-50 rounded border border-blue-200",children:[e.jsx("p",{className:"text-xs font-medium text-blue-700 mb-1",children:p==="de"?"Verwendete Avatare:":p==="fr"?"Avatars utilisÃ©s:":"Avatars used:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.avatarsUsed.map((L,X)=>e.jsxs("span",{className:`text-xs px-2 py-1 rounded ${L.hasPhoto?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:[L.name,L.category&&L.category!=="standard"&&e.jsxs("span",{className:"ml-1 opacity-75",children:["(",L.category,")"]}),!L.hasPhoto&&" âš ï¸"]},X))})]}),C.retryHistory&&C.retryHistory.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(zr,{retryHistory:C.retryHistory,totalAttempts:C.totalAttempts||1,language:p})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:p==="de"?"Szenenbeschreibung:":p==="fr"?"Description de la scÃ¨ne:":"Scene description:"}),e.jsx("textarea",{value:o,onChange:L=>i(L.target.value),className:"w-full h-40 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y",placeholder:p==="de"?"Beschreiben Sie die Szene...":p==="fr"?"DÃ©crivez la scÃ¨ne...":"Describe the scene..."}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:p==="de"?"Tipp: Beschreiben Sie die Aktionen und die Umgebung. Die ausgewÃ¤hlten Charaktere werden automatisch hinzugefÃ¼gt.":p==="fr"?"Conseil: DÃ©crivez les actions et l'environnement. Les personnages sÃ©lectionnÃ©s seront ajoutÃ©s automatiquement.":"Tip: Describe the actions and the environment. Selected characters will be added automatically."})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:D.length>0&&e.jsx("span",{children:p==="de"?`${D.length} Charakter(e) ausgewÃ¤hlt`:p==="fr"?`${D.length} personnage(s) sÃ©lectionnÃ©(s)`:`${D.length} character(s) selected`})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:N,disabled:y,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700 font-medium disabled:opacity-50 order-2 sm:order-1",children:p==="de"?"Abbrechen":p==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:a,disabled:y||!o.trim(),className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 order-1 sm:order-2 ${y||!o.trim()?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:y?e.jsxs(e.Fragment,{children:[e.jsx(Ht,{size:16,className:"animate-spin"}),p==="de"?"Generiere...":p==="fr"?"GÃ©nÃ©ration...":"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ht,{size:16}),p==="de"?"Neu generieren":p==="fr"?"RÃ©gÃ©nÃ©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",b,")"]})]})})]})]})]})})}function eo({pageNumber:t,versions:o,onClose:i,onSelectVersion:N,developerMode:a=!1}){const{language:y}=Ot();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(aa,{size:20}),y==="de"?`Bildversionen - Seite ${t}`:y==="fr"?`Versions d'image - Page ${t}`:`Image Versions - Page ${t}`]}),e.jsx("button",{onClick:i,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(zt,{size:20})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:o.map((b,c)=>e.jsxs("div",{className:`relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${b.isActive?"border-green-500 ring-2 ring-green-200":"border-gray-200 hover:border-indigo-300"}`,onClick:()=>N(t,c),children:[e.jsx("img",{src:b.imageData,alt:`Version ${c+1}`,className:"w-full aspect-square object-cover"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:c===0?"Original":`V${c+1}`}),b.isActive&&e.jsx("span",{className:"bg-green-500 px-2 py-0.5 rounded text-[10px] font-bold",children:y==="de"?"Aktiv":y==="fr"?"Actif":"Active"})]}),e.jsx("div",{className:"text-[10px] text-gray-300 mt-1",children:new Date(b.createdAt).toLocaleDateString()})]})]},c))}),a&&o.length>1&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-700",children:y==="de"?"Szenen- und Prompt-Vergleich":y==="fr"?"Comparaison de scÃ¨nes et prompts":"Scene & Prompt Comparison"}),o.map((b,c)=>e.jsxs("details",{className:`rounded-lg p-3 ${b.isActive?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-medium text-gray-700",children:[c===0?"Original":`V${c+1}`,b.isActive&&e.jsx("span",{className:"ml-2 text-green-600 text-xs",children:"(Active)"})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[b.userInput&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-purple-700",children:y==="de"?"Benutzer-Eingabe:":y==="fr"?"EntrÃ©e utilisateur:":"User Input:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-purple-50 p-2 rounded border border-purple-200 max-h-24 overflow-y-auto",children:b.userInput})]}),b.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-amber-700",children:y==="de"?"Erweiterte Szene:":y==="fr"?"ScÃ¨ne Ã©tendue:":"Expanded Scene:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-24 overflow-y-auto",children:b.description})]}),b.prompt&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-blue-700",children:y==="de"?"API-Prompt:":y==="fr"?"Prompt API:":"API Prompt:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-32 overflow-y-auto",children:b.prompt})]}),b.modelId&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Model: ",b.modelId]})]})]},c))]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 text-sm text-gray-500",children:y==="de"?"Klicken Sie auf ein Bild, um es auszuwÃ¤hlen":y==="fr"?"Cliquez sur une image pour la sÃ©lectionner":"Click an image to select it"})]})})}function to({src:t,title:o,onClose:i}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:i,children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] bg-white rounded-lg overflow-hidden",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:o}),e.jsx("button",{onClick:i,className:"text-gray-500 hover:text-gray-700 p-1",children:e.jsx(zt,{size:20})})]}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsx("img",{src:t,alt:o,className:"max-w-full max-h-[80vh] object-contain mx-auto"})})]})})}const Qs={en:{adventure:"Adventure","life-challenge":"Life Challenge",educational:"Educational",historical:"Historical"},de:{adventure:"Abenteuer","life-challenge":"Lebensherausforderung",educational:"Bildung",historical:"Historisch"},fr:{adventure:"Aventure","life-challenge":"DÃ©fi de vie",educational:"Ã‰ducatif",historical:"Historique"}},Zs={en:{"1st-grade":"Picture Book (1st Grade)",standard:"Standard",advanced:"Advanced"},de:{"1st-grade":"Bilderbuch (1. Klasse)",standard:"Standard",advanced:"Fortgeschritten"},fr:{"1st-grade":"Livre illustrÃ© (1Ã¨re annÃ©e)",standard:"Standard",advanced:"AvancÃ©"}},ro={"de-CH":"Schweizerdeutsch","de-DE":"Deutsch (Deutschland)",en:"English",fr:"FranÃ§ais"};function ao({settings:t,language:o}){var x,P;const[i,N]=l.useState(!1),a=F=>{const W={en:{title:"Story Info",category:"Category",topic:"Topic",theme:"Theme",storyType:"Story Type",storyDetails:"Story Idea",artStyle:"Art Style",language:"Language",readingLevel:"Reading Level",pages:"Length",dedication:"Dedication",mainCharacters:"Main Characters",otherCharacters:"Other Characters",relationships:"Relationships",season:"Season",location:"Location",noData:"Not specified",spring:"Spring",summer:"Summer",autumn:"Autumn",winter:"Winter"},de:{title:"Story-Info",category:"Kategorie",topic:"Thema",theme:"Thema",storyType:"Story-Typ",storyDetails:"Story-Idee",artStyle:"Kunststil",language:"Sprache",readingLevel:"Lesestufe",pages:"LÃ¤nge",dedication:"Widmung",mainCharacters:"Hauptfiguren",otherCharacters:"Andere Figuren",relationships:"Beziehungen",season:"Jahreszeit",location:"Ort",noData:"Nicht angegeben",spring:"FrÃ¼hling",summer:"Sommer",autumn:"Herbst",winter:"Winter"},fr:{title:"Info histoire",category:"CatÃ©gorie",topic:"Sujet",theme:"ThÃ¨me",storyType:"Type d'histoire",storyDetails:"IdÃ©e d'histoire",artStyle:"Style artistique",language:"Langue",readingLevel:"Niveau de lecture",pages:"Longueur",dedication:"DÃ©dicace",mainCharacters:"Personnages principaux",otherCharacters:"Autres personnages",relationships:"Relations",season:"Saison",location:"Lieu",noData:"Non spÃ©cifiÃ©",spring:"Printemps",summer:"Ã‰tÃ©",autumn:"Automne",winter:"Hiver"}};return(W[o]||W.en)[F]||F},y=F=>(Qs[o]||Qs.en)[F]||F,b=F=>(Zs[o]||Zs.en)[F]||F,c=(F,W)=>F==null||F===""?e.jsx("span",{className:"text-gray-400 italic",children:a("noData")}):e.jsx("span",{className:"text-gray-800",children:F}),D=t.mainCharacters||[],_=((x=t.characters)==null?void 0:x.filter(F=>D.includes(F.id)))||[],C=((P=t.characters)==null?void 0:P.filter(F=>!D.includes(F.id)))||[],p=F=>a(F)||F,I=()=>{if(!t.userLocation)return null;const F=[t.userLocation.city,t.userLocation.region,t.userLocation.country].filter(Boolean);return F.length>0?F.join(", "):null};return e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>N(!i),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-amber-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(wi,{size:16,className:"text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-800",children:a("title")}),e.jsx("span",{className:"text-xs bg-amber-200 text-amber-700 px-2 py-0.5 rounded",children:"DEV"})]}),i?e.jsx(Jt,{size:18,className:"text-amber-600"}):e.jsx(is,{size:18,className:"text-amber-600"})]}),i&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[_.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(as,{size:12}),a("mainCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:_.map(F=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-indigo-100 text-indigo-800 border border-indigo-200",children:[e.jsx(as,{size:10}),e.jsx("span",{children:F.name})]},F.id))})]}),C.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(dn,{size:12}),a("otherCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(F=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700 border border-gray-200",children:[e.jsx(as,{size:10}),e.jsx("span",{children:F.name})]},F.id))})]}),t.relationships&&Object.keys(t.relationships).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-2",children:a("relationships")}),e.jsx("div",{className:"text-xs bg-white/50 p-2 rounded border border-amber-100 space-y-1",children:Object.entries(t.relationships).map(([F,W])=>{var B,ie;const[L,X]=F.split("-").map(te=>parseInt(te,10)),Q=(B=t.characters)==null?void 0:B.find(te=>te.id===L),ne=(ie=t.characters)==null?void 0:ie.find(te=>te.id===X);return!Q||!ne?null:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-amber-600 font-medium whitespace-nowrap",children:[Q.name," â†’ ",ne.name,":"]}),e.jsx("span",{className:"text-gray-700",children:W})]},F)})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(Fi,{size:12}),a("language")]}),e.jsx("div",{className:"text-sm",children:t.language?ro[t.language]||t.language:c(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:a("readingLevel")}),e.jsx("div",{className:"text-sm",children:t.languageLevel?b(t.languageLevel):c(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:a("pages")}),e.jsx("div",{className:"text-sm",children:t.pages?`${t.pages} ${o==="de"?"Seiten":"pages"}`:c(void 0)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:a("season")}),e.jsx("div",{className:"text-sm",children:t.season?p(t.season):c(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:a("location")}),e.jsx("div",{className:"text-sm",children:I()||c(void 0)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(mn,{size:12}),a("artStyle")]}),e.jsx("div",{className:"text-sm capitalize",children:c(t.artStyle)})]})]}),t.storyDetails&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(Er,{size:12}),a("storyDetails")]}),e.jsx("div",{className:"text-sm bg-white/50 p-2 rounded border border-amber-100 whitespace-pre-wrap",children:t.storyDetails})]}),(t.storyCategory||t.storyTheme||t.storyTopic)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-amber-100",children:[t.storyCategory&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx($i,{size:12}),a("category")]}),e.jsx("div",{className:"text-sm",children:y(t.storyCategory)})]}),(t.storyTheme||t.storyTopic)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:t.storyCategory==="adventure"?a("theme"):a("topic")}),e.jsx("div",{className:"text-sm",children:t.storyCategory==="adventure"?t.storyTheme:t.storyTopic})]})]})]})]})}function so({storyId:t,onShareStatusChange:o}){const{language:i}=Ot(),[N,a]=l.useState(!1),[y,b]=l.useState(null),[c,D]=l.useState(!1),[_,C]=l.useState(!1),[p,I]=l.useState(null),x={share:i==="de"?"Teilen":i==="fr"?"Partager":"Share",shareStory:i==="de"?"Geschichte teilen":i==="fr"?"Partager l'histoire":"Share Story",enableSharing:i==="de"?"Link aktivieren":i==="fr"?"Activer le lien":"Enable sharing",disableSharing:i==="de"?"Link deaktivieren":i==="fr"?"DÃ©sactiver le lien":"Disable sharing",copyLink:i==="de"?"Link kopieren":i==="fr"?"Copier le lien":"Copy link",copied:i==="de"?"Kopiert!":i==="fr"?"CopiÃ©!":"Copied!",shareWhatsApp:i==="de"?"Per WhatsApp teilen":i==="fr"?"Partager sur WhatsApp":"Share on WhatsApp",sharingEnabled:i==="de"?"Teilen aktiv":i==="fr"?"Partage actif":"Sharing enabled",sharingDisabled:i==="de"?"Teilen inaktiv":i==="fr"?"Partage inactif":"Sharing disabled",anyoneWithLink:i==="de"?"Jeder mit dem Link kann die Geschichte lesen":i==="fr"?"Toute personne avec le lien peut lire l'histoire":"Anyone with the link can read the story",errorLoading:i==="de"?"Fehler beim Laden":i==="fr"?"Erreur de chargement":"Error loading"};l.useEffect(()=>{N&&!y&&P()},[N]);const P=async()=>{D(!0),I(null);try{const X=await fetch(`/api/stories/${t}/share-status`,{credentials:"include"});if(!X.ok)throw new Error("Failed to fetch status");const Q=await X.json();b(Q)}catch{I(x.errorLoading)}finally{D(!1)}},F=async()=>{D(!0),I(null);try{const Q=(y==null?void 0:y.isShared)?"DELETE":"POST",ne=await fetch(`/api/stories/${t}/share`,{method:Q,credentials:"include"});if(!ne.ok)throw new Error("Failed to toggle sharing");const B=await ne.json();b({isShared:B.isShared,shareToken:B.shareToken,shareUrl:B.shareUrl}),o==null||o(B.isShared)}catch{I("Failed to update sharing")}finally{D(!1)}},W=async()=>{if(y!=null&&y.shareUrl)try{await navigator.clipboard.writeText(y.shareUrl),C(!0),setTimeout(()=>C(!1),2e3)}catch{const Q=document.createElement("textarea");Q.value=y.shareUrl,document.body.appendChild(Q),Q.select(),document.execCommand("copy"),document.body.removeChild(Q),C(!0),setTimeout(()=>C(!1),2e3)}},L=()=>{if(!(y!=null&&y.shareUrl))return;const X=encodeURIComponent(y.shareUrl);window.open(`https://wa.me/?text=${X}`,"_blank")};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>a(!N),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-lg hover:from-blue-600 hover:to-indigo-600 transition-all shadow-md hover:shadow-lg",title:x.share,children:[e.jsx(qs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:x.share}),(y==null?void 0:y.isShared)&&e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>a(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-xl border border-gray-200 z-50 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(qs,{className:"w-5 h-5 text-blue-600"}),x.shareStory]})}),e.jsx("div",{className:"p-4 space-y-4",children:c&&!y?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(wt,{className:"w-6 h-6 animate-spin text-blue-500"})}):p?e.jsx("div",{className:"text-red-500 text-sm py-2",children:p}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[y!=null&&y.isShared?e.jsx(Mi,{className:"w-5 h-5 text-green-500"}):e.jsx(Bi,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:y!=null&&y.isShared?"text-green-700":"text-gray-600",children:y!=null&&y.isShared?x.sharingEnabled:x.sharingDisabled})]}),e.jsx("button",{onClick:F,disabled:c,className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${y!=null&&y.isShared?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"} disabled:opacity-50`,children:c?e.jsx(wt,{className:"w-4 h-4 animate-spin"}):y!=null&&y.isShared?x.disableSharing:x.enableSharing})]}),(y==null?void 0:y.isShared)&&y.shareUrl&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500",children:x.anyoneWithLink}),e.jsx("button",{onClick:W,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:_?e.jsxs(e.Fragment,{children:[e.jsx(Ii,{className:"w-4 h-4 text-green-500"}),x.copied]}):e.jsxs(e.Fragment,{children:[e.jsx(Ei,{className:"w-4 h-4"}),x.copyLink]})}),e.jsxs("button",{onClick:L,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors",children:[e.jsx(Gi,{className:"w-4 h-4"}),x.shareWhatsApp]})]})]})})]})]})]})}function no({title:t,story:o,outline:i,outlinePrompt:N,outlineModelId:a,outlineUsage:y,storyTextPrompts:b=[],visualBible:c,sceneImages:D,sceneDescriptions:_=[],coverImages:C,regeneratingCovers:p=new Set,languageLevel:I="standard",storyLanguage:x,isGenerating:P=!1,onDownloadPdf:F,onAddToBook:W,onPrintBook:L,onCreateAnother:X,onDownloadTxt:Q,onRegenerateImage:ne,onRegenerateCover:B,characters:ie=[],onEditImage:te,onEditCover:K,onRepairImage:$,onRevertRepair:Z,onVisualBibleChange:xe,storyId:fe,developerMode:me=!1,styledAvatarGeneration:ge=[],costumedAvatarGeneration:Ne=[],generationLog:Se=[],finalChecksReport:re,clothingRequirements:$e,isPartial:it=!1,failureReason:Ae,generatedPages:qe,totalPages:de,progressiveMode:se=!1,progressiveData:M,completedPageImages:Fe={},originalStory:Ue,onSaveStoryText:_e,onSaveTitleChange:Tt,userCredits:$t=0,imageRegenerationCost:lt=5,isImpersonating:Nr=!1,onSelectImageVersion:na,generationSettings:Rr}){var gr,bt,hr,vt,Wr;const{t:Ia,language:s}=Ot(),Pe=x?x.startsWith("de")?"de":x:s,We=Nr||$t===-1||$t>=lt,[he,et]=l.useState(null),[xt,tt]=l.useState(""),[dt,be]=l.useState(!1),[Qt,Re]=l.useState(o),[_t,Be]=l.useState(!1),[dr,St]=l.useState(!1),[Zt,ot]=l.useState(t||""),[Wt,ue]=l.useState(!1),[we,wr]=l.useState(null),[rt,v]=l.useState(null),[,Ce]=l.useState(!1),[Ct,Sr]=l.useState(new Set),[pt,Yt]=l.useState(null),[Vt,at]=l.useState(null),[Br,Je]=l.useState(null),[qt,ct]=l.useState("square"),[Xt,cr]=l.useState(!1);l.useEffect(()=>{dt||Re(o)},[o,dt]),l.useEffect(()=>{dr||ot(t||"")},[t,dr]);const Da=async()=>{if(_e){Be(!0);try{await _e(Qt),be(!1)}catch(r){console.error("Failed to save story text:",r)}finally{Be(!1)}}},mr=async()=>{if(!(!Tt||!Zt.trim())){ue(!0);try{await Tt(Zt.trim()),St(!1)}catch(r){console.error("Failed to save title:",r)}finally{ue(!1)}}},Ea=()=>{Re(o),be(!1)},Mr=async r=>{if(!(!$||Vt!==null)){at(r);try{await $(r)}catch(S){console.error("Failed to repair image:",S)}finally{at(null)}}},ia=(r,S)=>{const f=Qt.split(/(?=---\s*(?:Page|Seite)\s+\d+\s*---|(?=##\s*(?:Page|Seite)\s+\d+))/i);let G=0;for(let Y=0;Y<f.length;Y++)if(/^(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i.test(f[Y].trim())){G=Y;break}const m=G+r;if(m<f.length){const Y=f[m].match(/^(---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i),pe=Y?Y[0]:"";f[m]=pe+`
`+S.trim()+`
`}Re(f.join(""))},Ut=r=>{const S=D.find(f=>f.pageNumber===r);return(S==null?void 0:S.imageVersions)||[]},za=async(r,S)=>{if(na)try{await na(r,S),wr(null)}catch(f){console.error("Failed to select image version:",f)}},Fa=r=>{if(!r)return"";let S;if(typeof r!="string"){const Y=r;if(Y.output)if(typeof Y.output=="string")S=Y.output;else if(typeof Y.output=="object"){const pe=Y.output.translatedSummary||Y.output.imageSummary||"";if(pe)return pe;S=JSON.stringify(r)}else S=JSON.stringify(r);else S=JSON.stringify(r)}else S=r;if(S.trim().startsWith("{"))try{const Y=JSON.parse(S);if(Y.output){if(typeof Y.output=="string")S=Y.output;else if(typeof Y.output=="object"){const pe=Y.output.translatedSummary||Y.output.imageSummary;if(pe)return pe}}}catch{}const f=S.match(/(?:#{1,3}\s*)?(?:\*\*)?6\.?\s*(?:\*\*)?\s*\*?\*?(Image Summary|Bildzusammenfassung|RÃ©sumÃ© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*\*?\*?\s*:?\s*\n?([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n---|\n```|$)/i);if(f&&f[2]&&f[2].trim())return f[2].trim();const G=S.match(/(?:#{1,3}\s*)?\*?\*?(Image Summary|Bildzusammenfassung|RÃ©sumÃ© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*:?\s*\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n\*\*|\n#{1,3}\s|$)/i);if(G&&G[2]&&G[2].trim())return G[2].trim();if(!S.includes("**")&&S.length<1e3)return S.trim();const m=S.match(/\*?\*?(Image Summary|Bildzusammenfassung|RÃ©sumÃ© de l['']Image)\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:\*\*)?\d+\.\s*\*\*|\n\s*\*\*\d+\.|$)/i);return m&&m[2]&&m[2].trim()?m[2].trim():S.substring(0,500).trim()+"..."},Lr=r=>{if(!r||!ie.length)return ie.map(G=>G.id);let S;if(typeof r!="string"){const G=r;S=G.output&&typeof G.output=="string"?G.output:JSON.stringify(r)}else S=r;if(S.trim().startsWith("{"))try{const G=JSON.parse(S);G.output&&typeof G.output=="string"&&(S=G.output)}catch{}const f=S.toLowerCase();return ie.filter(G=>f.includes(G.name.toLowerCase())).map(G=>G.id)},Gr=r=>{const S=D.find(pe=>pe.pageNumber===r),f=_.find(pe=>pe.pageNumber===r),G=(S==null?void 0:S.description)||(f==null?void 0:f.description)||"",m=(f==null?void 0:f.translatedSummary)||(f==null?void 0:f.imageSummary)||Fa(G),Y=Lr(G);v({pageNumber:r,scene:m,selectedCharacterIds:Y})},Hr=async()=>{if(!rt||!ne)return;const r=rt.pageNumber,S=rt.scene,f=rt.selectedCharacterIds;v(null),Sr(G=>new Set(G).add(r)),Ce(!0);try{await ne(r,S,f)}catch(G){console.error("Failed to regenerate image:",G)}finally{Sr(G=>{const m=new Set(G);return m.delete(r),m}),Sr(G=>(G.size===0&&Ce(!1),G))}},er=r=>{let S="";if(r==="front"&&(C!=null&&C.frontCover)){const f=C.frontCover;S=typeof f=="object"&&f.description||""}else if(r==="initial"&&(C!=null&&C.initialPage)){const f=C.initialPage;S=typeof f=="object"&&f.description||""}else if(r==="back"&&(C!=null&&C.backCover)){const f=C.backCover;S=typeof f=="object"&&f.description||""}Yt({coverType:r,scene:S})},Or=async()=>{if(!pt||!B)return;const{coverType:r,scene:S}=pt;Yt(null);try{await B(r,S)}catch(f){console.error("Failed to regenerate cover:",f)}},tr=(r,S,f,G)=>{et({type:r,id:S,field:f}),tt(G||"")},rr=()=>{if(!he||!c||!xe)return;const{type:r,id:S,field:f}=he,G={...c};if(r==="secondaryCharacter")G.secondaryCharacters=(G.secondaryCharacters||[]).map(m=>m.id===S?{...m,[f]:xt}:m);else if(r==="animal")G.animals=(G.animals||[]).map(m=>m.id===S?{...m,[f]:xt}:m);else if(r==="artifact")G.artifacts=(G.artifacts||[]).map(m=>m.id===S?{...m,[f]:xt}:m);else if(r==="location")G.locations=(G.locations||[]).map(m=>m.id===S?{...m,[f]:xt}:m);else if(r==="mainCharacter"){const m=parseInt(S);G.mainCharacters=(G.mainCharacters||[]).map(Y=>Y.id!==m?Y:f==="physical.face"?{...Y,physical:{...Y.physical,face:xt}}:f==="physical.hair"?{...Y,physical:{...Y.physical,hair:xt}}:f==="physical.build"?{...Y,physical:{...Y.physical,build:xt}}:Y)}xe(G),et(null),tt("")},Qe=()=>{et(null),tt("")},Rt=(r=>r?r.split(/(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i).slice(1).filter(f=>f.trim().length>0):[])(dt?Qt:o),ft=D.length>0,ur=I==="1st-grade",la=(()=>{if(!se)return Rt.length;if(Rt.length===0)return 0;let r=1;for(let S=2;S<=Rt.length;S++){const f=S-1;if(D.some(m=>m.pageNumber===f&&m.imageData)||!!Fe[f])r=S;else break}return r})(),ar=(M==null?void 0:M.totalPages)||Rt.length;M!=null&&M.totalScenes||D.length||Math.ceil(ar/(ur?1:2));const It=r=>r?typeof r=="string"?r:r.imageData||null:null,Cr=r=>r?typeof r=="string"?{imageData:r}:r:null,yt=r=>{var G;const S=(G=_.find(m=>m.pageNumber===r))==null?void 0:G.description;if(S)return S;const f=D.find(m=>m.pageNumber===r);return f==null?void 0:f.description},mt=r=>{var S;return(S=_.find(f=>f.pageNumber===r))==null?void 0:S.outlineExtract},Ze=r=>{var S;return(S=_.find(f=>f.pageNumber===r))==null?void 0:S.scenePrompt},Bt=r=>{var S;return(S=_.find(f=>f.pageNumber===r))==null?void 0:S.textModelId};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center gap-2",children:dr?e.jsxs("div",{className:"flex items-center gap-2 w-full max-w-2xl",children:[e.jsx("input",{type:"text",value:Zt,onChange:r=>ot(r.target.value),className:"flex-1 text-2xl md:text-3xl font-bold text-gray-800 text-center border-2 border-indigo-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-500",autoFocus:!0,onKeyDown:r=>{r.key==="Enter"&&mr(),r.key==="Escape"&&(ot(t||""),St(!1))}}),e.jsx("button",{onClick:mr,disabled:Wt||!Zt.trim(),className:"p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50",title:s==="de"?"Speichern":s==="fr"?"Sauvegarder":"Save",children:Wt?e.jsx(ea,{className:"animate-spin",size:20}):e.jsx(Dr,{size:20})}),e.jsx("button",{onClick:()=>{ot(t||""),St(!1)},disabled:Wt,className:"p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",title:s==="de"?"Abbrechen":s==="fr"?"Annuler":"Cancel",children:e.jsx(zt,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-800 text-center",children:t||Ia.yourStory}),Tt&&!P&&e.jsx("button",{onClick:()=>St(!0),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:s==="de"?"Titel bearbeiten":s==="fr"?"Modifier le titre":"Edit title",children:e.jsx(Xe,{size:18})})]})}),it&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-400 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-amber-500 text-2xl",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-amber-800",children:s==="de"?"UnvollstÃ¤ndige Geschichte":s==="fr"?"Histoire incomplÃ¨te":"Incomplete Story"}),e.jsx("p",{className:"text-amber-700 text-sm mt-1",children:s==="de"?`Diese Geschichte konnte nicht vollstÃ¤ndig generiert werden. ${qe||D.length} von ${de||"unbekannt"} Seiten wurden erstellt.`:s==="fr"?`Cette histoire n'a pas pu Ãªtre gÃ©nÃ©rÃ©e complÃ¨tement. ${qe||D.length} sur ${de||"inconnu"} pages ont Ã©tÃ© crÃ©Ã©es.`:`This story could not be fully generated. ${qe||D.length} of ${de||"unknown"} pages were created.`}),Ae&&me&&e.jsxs("details",{className:"mt-2 text-sm",children:[e.jsx("summary",{className:"cursor-pointer text-amber-600 hover:text-amber-700",children:s==="de"?"Fehlerdetails":s==="fr"?"DÃ©tails de l'erreur":"Error details"}),e.jsx("p",{className:"mt-1 bg-amber-100 p-2 rounded text-amber-800 font-mono text-xs",children:Ae})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[ft&&fe&&W&&e.jsxs("button",{onClick:W,disabled:P,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Ws,{size:16})," ",s==="de"?"Buch erstellen":s==="fr"?"CrÃ©er le livre":"Create Book"]}),ft&&F&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>cr(!Xt),disabled:P,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Er,{size:16}),s==="de"?"PDF herunterladen":s==="fr"?"TÃ©lÃ©charger PDF":"Download PDF",e.jsx(Jt,{size:14,className:`transition-transform ${Xt?"rotate-180":""}`})]}),Xt&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:qt==="square",onChange:()=>ct("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20Ã—20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:qt==="A4",onChange:()=>ct("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21Ã—28cm)"})]})]}),e.jsx("button",{onClick:()=>{F(qt),cr(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:s==="de"?"Herunterladen":s==="fr"?"TÃ©lÃ©charger":"Download"})]})]}),_e&&!dt&&e.jsxs("button",{onClick:()=>be(!0),disabled:P,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xe,{size:16})," ",s==="de"?"Text bearbeiten":s==="fr"?"Modifier le texte":"Edit Text"]}),X&&e.jsxs("button",{onClick:X,disabled:P,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Os,{size:16})," ",s==="de"?"Neue Geschichte":s==="fr"?"Nouvelle histoire":"New Story"]}),ft&&fe&&!P&&e.jsx(so,{storyId:fe})]}),me&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[Q&&e.jsxs("button",{onClick:Q,className:"bg-gray-500 text-white px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 hover:bg-gray-600",children:[e.jsx($a,{size:14})," TXT"]}),ft&&fe&&L&&e.jsxs("button",{onClick:L,disabled:P,className:`bg-yellow-500 text-black px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 ${P?"opacity-50 cursor-not-allowed":"hover:bg-yellow-600"}`,children:[e.jsx(Pa,{size:14})," Print (DEV)"]})]}),me&&Rr&&e.jsx("div",{className:"mt-4",children:e.jsx(ao,{settings:Rr,language:s})}),me&&e.jsxs("div",{className:"space-y-4 mt-6",children:[i&&e.jsxs("details",{className:"bg-purple-50 border-2 border-purple-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-purple-800 hover:text-purple-900 flex items-center gap-2",children:[e.jsx(Er,{size:20}),ur?s==="de"?"VollstÃ¤ndige API-Ausgabe (Kombiniert)":s==="fr"?"Sortie API complÃ¨te (CombinÃ©e)":"Full API Output (Combined)":s==="de"?"VollstÃ¤ndige API-Ausgabe (Outline)":s==="fr"?"Sortie API complÃ¨te (Plan)":"Full API Output (Outline)",a&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-purple-600",children:["(",a,")"]}),y&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-purple-500",children:["[",y.input_tokens.toLocaleString()," in / ",y.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[N&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:s==="de"?"ðŸ“¤ Prompt (Eingabe)":s==="fr"?"ðŸ“¤ Prompt (EntrÃ©e)":"ðŸ“¤ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:N})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:ur?s==="de"?"ðŸ“¥ API-Antwort (Kombiniert)":s==="fr"?"ðŸ“¥ RÃ©ponse API (CombinÃ©e)":"ðŸ“¥ API Response (Combined)":s==="de"?"ðŸ“¥ API-Antwort (Outline)":s==="fr"?"ðŸ“¥ RÃ©ponse API (Plan)":"ðŸ“¥ API Response (Outline)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:i})]})]})]}),o&&b.length>0&&e.jsxs("details",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(Pa,{size:20}),s==="de"?"VollstÃ¤ndige API-Ausgabe (Story-Text)":s==="fr"?"Sortie API complÃ¨te (Texte)":"Full API Output (Story Text)",((gr=b[0])==null?void 0:gr.modelId)&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-amber-600",children:["(",b[0].modelId,")"]}),((bt=b[0])==null?void 0:bt.usage)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-500",children:["[",b[0].usage.input_tokens.toLocaleString()," in / ",b[0].usage.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:s==="de"?"ðŸ“¤ Prompt (Eingabe)":s==="fr"?"ðŸ“¤ Prompt (EntrÃ©e)":"ðŸ“¤ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((hr=b[0])==null?void 0:hr.prompt)||"No prompt available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:s==="de"?"ðŸ“¥ Rohe API-Antwort (ungefiltert)":s==="fr"?"ðŸ“¥ RÃ©ponse API brute (non filtrÃ©e)":"ðŸ“¥ Raw API Response (unfiltered)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((vt=b[0])==null?void 0:vt.rawResponse)||o})]})]})]}),c&&e.jsxs("details",{className:"bg-rose-50 border-2 border-rose-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-rose-800 hover:text-rose-900 flex items-center gap-2",children:[e.jsx(Pa,{size:20}),s==="de"?"Visual Bible (Wiederkehrende Elemente)":s==="fr"?"Bible Visuelle (Ã‰lÃ©ments RÃ©currents)":"Visual Bible (Recurring Elements)",c.changeLog&&c.changeLog.length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-rose-200 text-rose-800 rounded-full text-xs font-medium",children:[c.changeLog.length," ",s==="de"?"Ã„nderungen":s==="fr"?"changements":"changes"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[c.mainCharacters&&c.mainCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-purple-300 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-purple-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ‘—"}),s==="de"?"Hauptcharaktere (Style Profile)":s==="fr"?"Personnages Principaux (Profil Style)":"Main Characters (Style Profile)"]}),e.jsx("div",{className:"space-y-3",children:c.mainCharacters.map(r=>{var S,f,G,m;return e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-sm",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-800 hover:text-purple-900",children:[r.name,Object.keys(r.generatedOutfits||{}).length>0&&e.jsxs("span",{className:"ml-2 px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:[Object.keys(r.generatedOutfits).length," ",s==="de"?"Outfits":s==="fr"?"tenues":"outfits"]})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Physical:"}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[((S=r.physical)==null?void 0:S.skinTone)||"N/A"," | ",((f=r.physical)==null?void 0:f.hair)||"N/A"," | ",((G=r.physical)==null?void 0:G.build)||"N/A",((m=r.physical)==null?void 0:m.other)&&` | ${r.physical.other}`]})]}),r.generatedOutfits&&Object.keys(r.generatedOutfits).length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-200",children:[e.jsx("span",{className:"font-medium text-gray-600 text-xs",children:"Generated Outfits:"}),e.jsx("div",{className:"mt-1 space-y-1",children:Object.entries(r.generatedOutfits).map(([Y,pe])=>{var st;return e.jsxs("div",{className:"bg-white p-1.5 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-purple-600",children:["Page ",Y,":"]}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[(st=pe.outfit)==null?void 0:st.substring(0,80),"..."]}),e.jsx("span",{className:`ml-1 px-1 py-0.5 rounded text-[10px] ${pe.setting==="outdoor-cold"?"bg-blue-100 text-blue-700":pe.setting==="outdoor-warm"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:pe.setting})]},Y)})})]})]})]},r.id)})})]}),c.secondaryCharacters&&c.secondaryCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:s==="de"?"Nebencharaktere":s==="fr"?"Personnages Secondaires":"Secondary Characters"}),e.jsx("div",{className:"space-y-2",children:c.secondaryCharacters.map(r=>{var S;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[r.name,r.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:r.id}),r.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:r.source==="outline"?"Outline":"Story"}),((S=r.appearsInPages)==null?void 0:S.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",r.appearsInPages.join(", "),")"]})]}),(he==null?void 0:he.type)==="secondaryCharacter"&&(he==null?void 0:he.id)===r.id&&(he==null?void 0:he.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:xt,onChange:f=>tt(f.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:rr,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Dr,{size:12})," Save"]}),e.jsxs("button",{onClick:Qe,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(zt,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:r.description}),me&&xe&&e.jsx("button",{onClick:()=>tr("secondaryCharacter",r.id,"description",r.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(Xe,{size:12})})]}),r.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",r.extractedDescription]})]},r.id)})})]}),c.animals.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:s==="de"?"Tiere & Wesen":s==="fr"?"Animaux & CrÃ©atures":"Animals & Creatures"}),e.jsx("div",{className:"space-y-2",children:c.animals.map(r=>{var S;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[r.name,r.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:r.id}),r.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:r.source==="outline"?"Outline":"Story"}),((S=r.appearsInPages)==null?void 0:S.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",r.appearsInPages.join(", "),")"]})]}),(he==null?void 0:he.type)==="animal"&&(he==null?void 0:he.id)===r.id&&(he==null?void 0:he.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:xt,onChange:f=>tt(f.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:rr,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Dr,{size:12})," Save"]}),e.jsxs("button",{onClick:Qe,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(zt,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:r.description}),me&&xe&&e.jsx("button",{onClick:()=>tr("animal",r.id,"description",r.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(Xe,{size:12})})]}),r.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",r.extractedDescription]})]},r.id)})})]}),c.artifacts.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:s==="de"?"Artefakte & Objekte":s==="fr"?"Artefacts & Objets":"Artifacts & Objects"}),e.jsx("div",{className:"space-y-2",children:c.artifacts.map(r=>{var S;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[r.name,r.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:r.id}),r.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:r.source==="outline"?"Outline":"Story"}),((S=r.appearsInPages)==null?void 0:S.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",r.appearsInPages.join(", "),")"]})]}),(he==null?void 0:he.type)==="artifact"&&(he==null?void 0:he.id)===r.id&&(he==null?void 0:he.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:xt,onChange:f=>tt(f.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:rr,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Dr,{size:12})," Save"]}),e.jsxs("button",{onClick:Qe,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(zt,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:r.description}),me&&xe&&e.jsx("button",{onClick:()=>tr("artifact",r.id,"description",r.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(Xe,{size:12})})]}),r.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",r.extractedDescription]})]},r.id)})})]}),c.locations.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:s==="de"?"Wiederkehrende Orte":s==="fr"?"Lieux RÃ©currents":"Recurring Locations"}),e.jsx("div",{className:"space-y-2",children:c.locations.map(r=>{var S;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[r.name,r.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:r.id}),r.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:r.source==="outline"?"Outline":"Story"}),r.isRealLandmark&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-amber-100 text-amber-700 font-semibold",children:"ðŸ“ LANDMARK"}),r.photoFetchStatus==="success"&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-green-100 text-green-700",children:"ðŸ“· Photo"}),((S=r.appearsInPages)==null?void 0:S.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",r.appearsInPages.join(", "),")"]})]}),r.isRealLandmark&&r.landmarkQuery&&e.jsxs("div",{className:"text-amber-700 text-xs mt-1",children:["Landmark: ",e.jsx("span",{className:"font-mono bg-amber-50 px-1 rounded",children:r.landmarkQuery})]}),(he==null?void 0:he.type)==="location"&&(he==null?void 0:he.id)===r.id&&(he==null?void 0:he.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:xt,onChange:f=>tt(f.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:rr,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Dr,{size:12})," Save"]}),e.jsxs("button",{onClick:Qe,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(zt,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:r.description}),me&&xe&&e.jsx("button",{onClick:()=>tr("location",r.id,"description",r.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(Xe,{size:12})})]}),r.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",r.extractedDescription]}),r.referencePhotoData&&e.jsxs("div",{className:"mt-2 border border-amber-200 rounded overflow-hidden",children:[e.jsx("img",{src:r.referencePhotoData,alt:`${r.name} reference`,className:"w-full max-h-32 object-contain bg-gray-50"}),r.photoAttribution&&e.jsxs("div",{className:"text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 truncate",children:["ðŸ“· ",r.photoAttribution]})]})]},r.id)})})]}),c.vehicles&&c.vehicles.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:s==="de"?"Fahrzeuge":s==="fr"?"VÃ©hicules":"Vehicles"}),e.jsx("div",{className:"space-y-2",children:c.vehicles.map(r=>{var S;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[r.name,r.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:r.id}),r.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:r.source==="outline"?"Outline":"Story"}),((S=r.appearsInPages)==null?void 0:S.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",r.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:r.description}),r.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",r.extractedDescription]})]},r.id)})})]}),c.clothing&&c.clothing.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:s==="de"?"Kleidung & KostÃ¼me":s==="fr"?"VÃªtements & Costumes":"Clothing & Costumes"}),e.jsx("div",{className:"space-y-2",children:c.clothing.map(r=>{var S;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[r.name,r.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:r.id}),r.wornBy&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:["worn by ",r.wornBy]}),r.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:r.source==="outline"?"Outline":"Story"}),((S=r.appearsInPages)==null?void 0:S.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",r.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:r.description}),r.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",r.extractedDescription]})]},r.id)})})]}),c.changeLog&&c.changeLog.length>0&&e.jsxs("details",{className:"bg-white border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-bold text-amber-700 hover:text-amber-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“"}),s==="de"?"Ã„nderungsprotokoll":s==="fr"?"Journal des Modifications":"Change Log",e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-amber-100 text-amber-700 rounded text-xs",children:c.changeLog.length})]}),e.jsx("div",{className:"mt-2 space-y-1 max-h-64 overflow-y-auto",children:c.changeLog.slice().reverse().map((r,S)=>{var f;return e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs border-l-2 border-amber-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${r.type==="mainCharacter"?"bg-purple-100 text-purple-700":r.type==="secondaryCharacter"?"bg-rose-100 text-rose-700":r.type==="generatedOutfit"?"bg-green-100 text-green-700":r.type==="animal"?"bg-orange-100 text-orange-700":r.type==="artifact"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:r.type}),e.jsx("span",{className:"font-semibold text-amber-800",children:r.element}),e.jsxs("span",{className:"text-gray-500",children:[Pe==="de"?"Seite":"Page"," ",r.page]})]}),e.jsxs("div",{className:"mt-1 text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:[r.change,":"]}),e.jsxs("span",{className:"ml-1 text-gray-700",children:[(f=r.after)==null?void 0:f.substring(0,100),r.after&&r.after.length>100?"...":""]})]}),r.before&&e.jsxs("div",{className:"text-gray-400 line-through text-[10px] mt-0.5",children:[s==="de"?"Vorher":s==="fr"?"Avant":"Before",": ",r.before.substring(0,50),"..."]}),e.jsx("div",{className:"text-gray-400 text-[10px] mt-0.5",children:new Date(r.timestamp).toLocaleTimeString()})]},S)})})]}),(!c.mainCharacters||c.mainCharacters.length===0)&&(!c.secondaryCharacters||c.secondaryCharacters.length===0)&&(!c.animals||c.animals.length===0)&&(!c.artifacts||c.artifacts.length===0)&&(!c.locations||c.locations.length===0)&&(!c.vehicles||c.vehicles.length===0)&&(!c.clothing||c.clothing.length===0)&&e.jsx("div",{className:"text-gray-500 text-sm italic",children:s==="de"?"Keine wiederkehrenden Elemente gefunden":s==="fr"?"Aucun Ã©lÃ©ment rÃ©current trouvÃ©":"No recurring elements found in this story"})]})]}),$e&&Object.keys($e).length>0&&e.jsxs("details",{className:"bg-teal-50 border-2 border-teal-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-teal-800 hover:text-teal-900 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ‘”"}),s==="de"?`Kleidungsanforderungen (${Object.keys($e).length} Charaktere)`:s==="fr"?`Exigences vestimentaires (${Object.keys($e).length} personnages)`:`Clothing Requirements (${Object.keys($e).length} characters)`]}),e.jsx("div",{className:"mt-4 space-y-3",children:Object.entries($e).map(([r,S])=>{var f,G,m,Y,pe,st,jt,ut,Mt,kt,le,gt,da,kr,xr;return e.jsxs("div",{className:"bg-white border border-teal-200 rounded-lg p-3",children:[e.jsx("h4",{className:"font-bold text-teal-700 mb-2",children:r}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${(f=S.standard)!=null&&f.used?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(G=S.standard)!=null&&G.used?"âœ…":"â¬œ"," Standard"]}),((m=S.standard)==null?void 0:m.used)&&((Y=S.standard)==null?void 0:Y.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:S.standard.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(pe=S.winter)!=null&&pe.used?"bg-blue-50 border border-blue-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(st=S.winter)!=null&&st.used?"â„ï¸":"â¬œ"," Winter"]}),((jt=S.winter)==null?void 0:jt.used)&&((ut=S.winter)==null?void 0:ut.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:S.winter.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(Mt=S.summer)!=null&&Mt.used?"bg-yellow-50 border border-yellow-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(kt=S.summer)!=null&&kt.used?"â˜€ï¸":"â¬œ"," Summer"]}),((le=S.summer)==null?void 0:le.used)&&((gt=S.summer)==null?void 0:gt.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:S.summer.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(da=S.costumed)!=null&&da.used?"bg-purple-50 border border-purple-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(kr=S.costumed)!=null&&kr.used?"ðŸŽ­":"â¬œ"," Costumed"]}),((xr=S.costumed)==null?void 0:xr.used)&&e.jsxs("div",{className:"text-gray-600 mt-1",children:[S.costumed.costume&&e.jsxs("span",{className:"font-medium",children:[S.costumed.costume,": "]}),S.costumed.description]})]})]})]},r)})})]}),ge&&ge.length>0&&e.jsxs("details",{className:"bg-pink-50 border-2 border-pink-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-pink-800 hover:text-pink-900 flex items-center gap-2",children:[e.jsx(aa,{size:20}),s==="de"?`Stilisierte Avatare (${ge.length})`:s==="fr"?`Avatars stylisÃ©s (${ge.length})`:`Styled Avatars (${ge.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:ge.map((r,S)=>{var f,G;return e.jsxs("details",{className:`border rounded-lg p-3 ${r.success?"bg-white border-pink-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${r.success?"bg-green-500":"bg-red-500"}`}),r.characterName," - ",r.artStyle," (",r.clothingCategory||"standard",")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(r.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Face Photo"}),(f=r.inputs.facePhoto)!=null&&f.imageData?e.jsx("img",{src:r.inputs.facePhoto.imageData,alt:"Face",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>Je({src:r.inputs.facePhoto.imageData,title:"Face Photo"}),title:`${r.inputs.facePhoto.sizeKB} KB - Click to enlarge`}):r.inputs.facePhoto?e.jsxs("span",{className:"text-blue-600 text-[10px]",children:[r.inputs.facePhoto.sizeKB," KB"]}):e.jsx("span",{className:"text-gray-400 italic text-[10px]",children:"N/A"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Original Avatar"}),(G=r.inputs.originalAvatar)!=null&&G.imageData?e.jsx("img",{src:r.inputs.originalAvatar.imageData,alt:"Avatar",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>Je({src:r.inputs.originalAvatar.imageData,title:"Original Avatar"}),title:`${r.inputs.originalAvatar.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-blue-600 text-[10px]",children:[r.inputs.originalAvatar.sizeKB," KB"]})]}),r.inputs.styleSample&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Style Sample"}),r.inputs.styleSample.imageData?e.jsx("img",{src:r.inputs.styleSample.imageData,alt:"Style",className:"w-16 h-16 object-cover rounded border border-purple-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>Je({src:r.inputs.styleSample.imageData,title:"Style Sample"}),title:`${r.inputs.styleSample.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-purple-600 text-[10px]",children:[r.inputs.styleSample.sizeKB," KB"]})]})]})]}),r.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",r.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-48 overflow-y-auto",children:r.prompt})]}),r.success&&r.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2 flex flex-col items-start",children:r.output.imageData?e.jsx("img",{src:r.output.imageData,alt:"Output",className:"w-24 h-24 object-cover rounded border border-green-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>Je({src:r.output.imageData,title:"Styled Avatar Output"}),title:`${r.output.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-green-600",children:[r.output.sizeKB," KB"]})})]}),!r.success&&r.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:r.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(r.timestamp).toLocaleString()]})]})]},S)})})]}),Ne&&Ne.length>0&&e.jsxs("details",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-orange-800 hover:text-orange-900 flex items-center gap-2",children:[e.jsx(aa,{size:20}),s==="de"?`KostÃ¼m-Avatare (${Ne.length})`:s==="fr"?`Avatars costumÃ©s (${Ne.length})`:`Costumed Avatars (${Ne.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:Ne.map((r,S)=>{var f,G,m;return e.jsxs("details",{className:`border rounded-lg p-3 ${r.success?"bg-white border-orange-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 hover:text-orange-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${r.success?"bg-green-500":"bg-red-500"}`}),r.characterName," - ",r.costumeType," (",r.artStyle,")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(r.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[r.costumeDescription&&e.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-yellow-700",children:"Costume:"}),e.jsx("p",{className:"mt-1 text-gray-700",children:r.costumeDescription})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Face Photo"}),(f=r.inputs.facePhoto)!=null&&f.imageData?e.jsx("img",{src:r.inputs.facePhoto.imageData,alt:"Face",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>Je({src:r.inputs.facePhoto.imageData,title:"Face Photo"}),title:`${r.inputs.facePhoto.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-blue-600 text-[10px]",children:[((G=r.inputs.facePhoto)==null?void 0:G.sizeKB)||0," KB"]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Standard Avatar"}),(m=r.inputs.standardAvatar)!=null&&m.imageData?e.jsx("img",{src:r.inputs.standardAvatar.imageData,alt:"Avatar",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>Je({src:r.inputs.standardAvatar.imageData,title:"Standard Avatar"}),title:`${r.inputs.standardAvatar.sizeKB} KB - Click to enlarge`}):e.jsx("span",{className:"text-gray-400 italic text-[10px]",children:"N/A"})]})]})]}),r.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",r.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-48 overflow-y-auto",children:r.prompt})]}),r.success&&r.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2 flex flex-col items-start",children:r.output.imageData?e.jsx("img",{src:r.output.imageData,alt:"Output",className:"w-24 h-24 object-cover rounded border border-green-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>Je({src:r.output.imageData,title:"Costumed Avatar Output"}),title:`${r.output.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-green-600",children:[r.output.sizeKB," KB"]})})]}),!r.success&&r.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:r.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(r.timestamp).toLocaleString()]})]})]},S)})})]}),Se&&Se.length>0&&e.jsxs("details",{className:"bg-slate-50 border-2 border-slate-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-slate-800 hover:text-slate-900 flex items-center gap-2",children:[e.jsx(Er,{size:20}),s==="de"?`Generierungslog (${Se.length})`:s==="fr"?`Journal de gÃ©nÃ©ration (${Se.length})`:`Generation Log (${Se.length})`,Se.filter(r=>r.level==="warn").length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-yellow-200 text-yellow-800 text-xs rounded-full",children:[Se.filter(r=>r.level==="warn").length," warnings"]}),Se.filter(r=>r.level==="error").length>0&&e.jsxs("span",{className:"ml-1 px-2 py-0.5 bg-red-200 text-red-800 text-xs rounded-full",children:[Se.filter(r=>r.level==="error").length," errors"]})]}),e.jsx("div",{className:"mt-4 space-y-1 max-h-96 overflow-y-auto",children:Se.map((r,S)=>e.jsxs("div",{className:`text-xs p-2 rounded flex items-start gap-2 ${r.level==="error"?"bg-red-50 text-red-800":r.level==="warn"?"bg-yellow-50 text-yellow-800":r.level==="debug"?"bg-gray-50 text-gray-600":"bg-white text-slate-700"}`,children:[e.jsx("span",{className:"text-gray-400 font-mono text-[10px] whitespace-nowrap",children:new Date(r.timestamp).toLocaleTimeString()}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium whitespace-nowrap ${r.stage==="outline"?"bg-blue-100 text-blue-700":r.stage==="avatars"?"bg-purple-100 text-purple-700":r.stage==="scenes"?"bg-green-100 text-green-700":r.stage==="images"?"bg-orange-100 text-orange-700":r.stage==="covers"?"bg-pink-100 text-pink-700":"bg-gray-100 text-gray-700"}`,children:r.stage}),r.character&&e.jsxs("span",{className:"font-medium text-slate-600",children:["[",r.character,"]"]}),e.jsx("span",{className:"flex-1",children:r.message}),e.jsx("span",{className:"text-gray-400 text-[10px]",children:r.event})]},S))})]}),re&&e.jsxs("details",{className:`border-2 rounded-xl p-4 ${re.overallConsistent?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("summary",{className:`cursor-pointer text-lg font-bold flex items-center gap-2 ${re.overallConsistent?"text-green-800 hover:text-green-900":"text-amber-800 hover:text-amber-900"}`,children:[re.overallConsistent?"âœ“":"âš ï¸",s==="de"?`KonsistenzprÃ¼fung (${re.totalIssues} Probleme)`:s==="fr"?`VÃ©rification de cohÃ©rence (${re.totalIssues} problÃ¨mes)`:`Final Checks (${re.totalIssues} issues)`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700",children:re.summary}),re.imageChecks&&re.imageChecks.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:s==="de"?"Bildkonsistenz":s==="fr"?"CohÃ©rence des images":"Image Consistency"}),re.imageChecks.map((r,S)=>{var f,G;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${r.consistent?"text-green-600":"text-amber-600"}`,children:r.consistent?"âœ“":"âš ï¸"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:r.type==="full"?"Full Check":r.type==="character"?`Character: ${r.characterName}`:r.type==="sequence"?"Sequence Check":r.type}),r.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",r.overallScore,"/10"]})]}),r.issues&&r.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:r.issues.map((m,Y)=>{var pe,st;return e.jsxs("div",{className:`text-xs p-2 rounded ${m.severity==="high"?"bg-red-50 border-l-4 border-red-400":m.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${m.severity==="high"?"bg-red-200 text-red-800":m.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:m.severity}),e.jsxs("span",{className:"text-gray-500",children:["Pages ",(pe=m.images)==null?void 0:pe.join(", ")]}),m.pagesToFix&&m.pagesToFix.length>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-orange-100 text-orange-700 rounded text-[10px]",children:["Fix: ",m.pagesToFix.join(", ")]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:(st=m.type)==null?void 0:st.replace(/_/g," ")}),m.characterInvolved&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded text-[10px]",children:m.characterInvolved})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:m.description}),m.details&&Object.keys(m.details).length>0&&e.jsx("div",{className:"mt-1 pl-2 border-l-2 border-gray-200",children:Object.entries(m.details).map(([jt,ut])=>e.jsxs("p",{className:"text-gray-500 text-[10px]",children:[e.jsxs("span",{className:"font-medium",children:[jt,":"]})," ",ut]},jt))}),m.canonicalVersion&&e.jsxs("p",{className:"text-blue-700 mt-1",children:["ðŸŽ¯ Target: ",m.canonicalVersion]}),m.recommendation&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:["ðŸ’¡ ",m.recommendation]})]},Y)})}),r.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:r.summary}),(r.evaluationPrompts||r.evaluationPrompt)&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:["ðŸ” View Evaluation Prompt",(((f=r.evaluationPrompts)==null?void 0:f.length)??0)>1?`s (${(G=r.evaluationPrompts)==null?void 0:G.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:(r.evaluationPrompts??(r.evaluationPrompt?[r.evaluationPrompt]:[])).map((m,Y)=>{var pe;return e.jsxs("div",{children:[(((pe=r.evaluationPrompts)==null?void 0:pe.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-blue-700 mb-1",children:["Batch ",Y+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto bg-white p-2 rounded border",children:m})]},Y)})})]}),e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"ðŸ”§ View Parsed Result (Full JSON)"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-96 overflow-y-auto bg-white p-2 rounded border",children:JSON.stringify({type:r.type,characterName:r.characterName,consistent:r.consistent,overallScore:r.overallScore,issues:r.issues,summary:r.summary},null,2)})]}),r.rawResponses&&r.rawResponses.length>0&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:["ðŸ“ View Raw Response",r.rawResponses.length>1?`s (${r.rawResponses.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:r.rawResponses.map((m,Y)=>{var pe;return e.jsxs("div",{children:[(((pe=r.rawResponses)==null?void 0:pe.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-purple-700 mb-1",children:["Batch ",Y+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto bg-white p-2 rounded border",children:m})]},Y)})})]})]},S)})]}),re.textCheck&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:s==="de"?"TextqualitÃ¤t":s==="fr"?"QualitÃ© du texte":"Text Quality"}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${re.textCheck.quality==="good"?"text-green-600":re.textCheck.quality==="needs_review"?"text-amber-600":"text-red-600"}`,children:re.textCheck.quality==="good"?"âœ“":"âš ï¸"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:re.textCheck.quality==="good"?"Good":re.textCheck.quality==="needs_review"?"Needs Review":"Has Issues"}),re.textCheck.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",re.textCheck.overallScore,"/10"]})]}),re.textCheck.issues&&re.textCheck.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:re.textCheck.issues.map((r,S)=>e.jsxs("div",{className:`text-xs p-2 rounded ${r.severity==="high"?"bg-red-50 border-l-4 border-red-400":r.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${r.severity==="high"?"bg-red-200 text-red-800":r.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:r.severity}),r.page&&e.jsxs("span",{className:"text-gray-500",children:["Page ",r.page]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:r.type})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:r.issue}),(r.originalText||r.text)&&e.jsxs("p",{className:"text-red-600 mt-1 line-through",children:['"',r.originalText||r.text,'"']}),r.correctedText&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:['âœ“ "',r.correctedText,'"']}),!r.correctedText&&r.suggestion&&e.jsxs("p",{className:"text-green-700 mt-1",children:["â†’ ",r.suggestion]})]},S))}),re.textCheck.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:re.textCheck.summary}),re.textCheck.fullOriginalText&&e.jsxs("details",{className:"mt-3 bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-gray-700",children:"ðŸ“„ View Original Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-600 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto",children:re.textCheck.fullOriginalText})]}),re.textCheck.fullCorrectedText&&e.jsxs("details",{className:"mt-3 bg-green-50 border border-green-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-green-800",children:"ðŸ“‹ View Full Corrected Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto",children:re.textCheck.fullCorrectedText})]}),re.textCheck.rawResponse&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:"ðŸ“ View Raw Response"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto",children:re.textCheck.rawResponse})]}),re.textCheck&&e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"ðŸ”§ View Parsed Result"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto",children:JSON.stringify({quality:re.textCheck.quality,overallScore:re.textCheck.overallScore,issues:re.textCheck.issues,summary:re.textCheck.summary,parseError:re.textCheck.parseError},null,2)})]}),re.textCheck.evaluationPrompt&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:"ðŸ” View Evaluation Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-64 overflow-y-auto",children:re.textCheck.evaluationPrompt})]})]})]}),re.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-2 text-xs text-red-700",children:["Error: ",re.error]})]})]}),_.length>0&&e.jsxs("details",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-green-800 hover:text-green-900 flex items-center gap-2",children:[e.jsx(Er,{size:20}),s==="de"?`Alle Szenenbeschreibungen (${_.length})`:s==="fr"?`Toutes les descriptions de scÃ¨nes (${_.length})`:`All Scene Descriptions (${_.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:_.map(r=>{var S;return e.jsxs("details",{className:"bg-white border border-green-200 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-700 hover:text-green-800",children:Pe==="de"?`Seite ${r.pageNumber}`:Pe==="fr"?`Page ${r.pageNumber}`:`Page ${r.pageNumber}`}),e.jsxs("div",{className:"mt-2 space-y-2",children:[r.outlineExtract&&e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-amber-700",children:"Outline Extract:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:r.outlineExtract})]}),r.scenePrompt&&e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-purple-700",children:"Scene Prompt:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:r.scenePrompt})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Scene Description:"}),r.textModelId&&e.jsxs("span",{className:"ml-2 text-green-600",children:["(",r.textModelId,")"]}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:typeof r.description=="string"?r.description:((S=r.description)==null?void 0:S.text)||JSON.stringify(r.description)})]})]})]},r.pageNumber)})})]})]}),C&&It(C.frontCover)&&(()=>{var S,f,G;const r=Cr(C.frontCover);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:Pe==="de"?"Titelseite":Pe==="fr"?"Couverture":"Front Cover"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sa,{src:It(C.frontCover),alt:"Front Cover",className:"w-full rounded-lg shadow-lg",label:"Front Cover"}),p.has("frontCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(wt,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),B&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>er("front"),disabled:P||!We||p.has("frontCover"),className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P||!We||p.has("frontCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:We?"":s==="de"?"Nicht genug Credits":s==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(Ht,{size:14}),s==="de"?"Bild neu generieren":s==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",lt," ",s==="de"?"Credits":"credits",")"]})]})}),me&&r&&e.jsxs("div",{className:"mt-3 space-y-2",children:[K&&e.jsxs("button",{onClick:()=>K("front"),disabled:P,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xe,{size:14})," ",s==="de"?"Bearbeiten":"Edit"]}),r.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:s==="de"?"Szenenbeschreibung":s==="fr"?"Description de scÃ¨ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:typeof r.description=="string"?r.description:((S=r.description)==null?void 0:S.text)||JSON.stringify(r.description)})]}),r.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[s==="de"?"API-Prompt":s==="fr"?"Prompt API":"API Prompt",r.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:r.prompt})]}),((((f=r.referencePhotos)==null?void 0:f.length)??0)>0||(((G=r.landmarkPhotos)==null?void 0:G.length)??0)>0)&&e.jsx(ta,{referencePhotos:r.referencePhotos||[],landmarkPhotos:r.landmarkPhotos,language:s}),r.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[s==="de"?"QualitÃ¤tsbewertung":s==="fr"?"Score de qualitÃ©":"Quality Score",r.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${r.qualityScore>=70?"text-green-600":r.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(r.qualityScore),"%"]})]}),r.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:s==="de"?"Feedback:":s==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),r.retryHistory&&r.retryHistory.length>0&&e.jsx(zr,{retryHistory:r.retryHistory,totalAttempts:r.totalAttempts||r.retryHistory.length,language:s})]})]})})(),C&&It(C.initialPage)&&(()=>{var S,f,G;const r=Cr(C.initialPage);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:Pe==="de"?"Widmungsseite":Pe==="fr"?"Page de dÃ©dicace":"Dedication Page"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sa,{src:It(C.initialPage),alt:"Dedication Page",className:"w-full rounded-lg shadow-lg",label:"Dedication Page"}),p.has("initialPage")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(wt,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),B&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>er("initial"),disabled:P||!We||p.has("initialPage"),className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P||!We||p.has("initialPage")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:We?"":s==="de"?"Nicht genug Credits":s==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(Ht,{size:14}),s==="de"?"Bild neu generieren":s==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",lt," ",s==="de"?"Credits":"credits",")"]})]})}),me&&r&&e.jsxs("div",{className:"mt-3 space-y-2",children:[K&&e.jsxs("button",{onClick:()=>K("initial"),disabled:P,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xe,{size:14})," ",s==="de"?"Bearbeiten":"Edit"]}),r.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:s==="de"?"Szenenbeschreibung":s==="fr"?"Description de scÃ¨ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:typeof r.description=="string"?r.description:((S=r.description)==null?void 0:S.text)||JSON.stringify(r.description)})]}),r.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[s==="de"?"API-Prompt":s==="fr"?"Prompt API":"API Prompt",r.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:r.prompt})]}),((((f=r.referencePhotos)==null?void 0:f.length)??0)>0||(((G=r.landmarkPhotos)==null?void 0:G.length)??0)>0)&&e.jsx(ta,{referencePhotos:r.referencePhotos||[],landmarkPhotos:r.landmarkPhotos,language:s}),r.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[s==="de"?"QualitÃ¤tsbewertung":s==="fr"?"Score de qualitÃ©":"Quality Score",r.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${r.qualityScore>=70?"text-green-600":r.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(r.qualityScore),"%"]})]}),r.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:s==="de"?"Feedback:":s==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),r.retryHistory&&r.retryHistory.length>0&&e.jsx(zr,{retryHistory:r.retryHistory,totalAttempts:r.totalAttempts||r.retryHistory.length,language:s})]})]})})(),se&&!o&&(C==null?void 0:C.frontCover)&&e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-8 mt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-indigo-700",children:Pe==="de"?"Geschichte wird erstellt...":Pe==="fr"?"CrÃ©ation de l'histoire...":"Creating your story..."}),e.jsx("p",{className:"text-indigo-500 mt-2",children:Pe==="de"?"Die Seiten werden gleich angezeigt":Pe==="fr"?"Les pages seront bientÃ´t affichÃ©es":"Pages will appear shortly"})]})}),ft&&o&&e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 text-center mb-6",children:t||(Pe==="de"?"Ihre Geschichte":Pe==="fr"?"Votre histoire":"Your Story")}),Rt.slice(0,se?la:Rt.length).map((r,S)=>{var jt,ut,Mt,kt;const f=S+1,G=f,m=D.find(le=>le.pageNumber===G),Y=se?Fe[G]:void 0,pe=!!(m!=null&&m.imageData||Y),st=se&&f===la&&!pe;return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-4 text-center",children:Pe==="de"?`Seite ${f}`:Pe==="fr"?`Page ${f}`:`Page ${f}`}),ur?e.jsxs("div",{className:"flex flex-col items-center max-w-2xl mx-auto",children:[st?e.jsxs("div",{className:"w-full mb-4 aspect-[4/3] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-md flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-600 font-medium",children:Pe==="de"?"Bild wird erstellt...":Pe==="fr"?"CrÃ©ation de l'image...":"Creating image..."}),e.jsx("p",{className:"text-indigo-400 text-sm mt-1",children:Pe==="de"?"Die nÃ¤chste Seite erscheint bald":Pe==="fr"?"La page suivante arrive bientÃ´t":"Next page coming soon"})]}):m!=null&&m.imageData||Y?e.jsxs("div",{className:"w-full mb-4 relative",children:[e.jsx(Sa,{src:((m==null?void 0:m.imageData)||Y)??"",alt:`Scene for page ${f}`,className:`w-full rounded-lg shadow-md object-cover ${Ct.has(f)?"opacity-50":""}`,label:`Page ${f}`}),Ct.has(f)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(ea,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:s==="de"?"Neues Bild wird erstellt...":s==="fr"?"Nouvelle image en cours...":"Generating new image..."})]}),ne&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>Gr(f),disabled:P||Ct.has(f)||!We,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P||Ct.has(f)||!We?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:We?"":s==="de"?"Nicht genug Credits":s==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(Ht,{size:14}),s==="de"?"Bild neu generieren":s==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",lt," ",s==="de"?"Credits":"credits",")"]})]}),_e&&e.jsxs("button",{onClick:()=>be(!0),disabled:P,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xe,{size:14}),s==="de"?"Text bearbeiten":s==="fr"?"Modifier le texte":"Edit Text"]}),Ut(f).length>1&&e.jsxs("button",{onClick:()=>wr({pageNumber:f,versions:Ut(f)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(aa,{size:14}),Ut(f).length]})]})}),me&&e.jsxs("div",{className:"mt-3 space-y-2",children:[te&&e.jsxs("button",{onClick:()=>te(f),disabled:P,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xe,{size:14})," ",s==="de"?"Bearbeiten":"Edit"]}),$&&e.jsx("button",{onClick:()=>Mr(f),disabled:P||Vt!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P||Vt!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:s==="de"?"Physik-Fehler automatisch erkennen und reparieren":s==="fr"?"DÃ©tecter et rÃ©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:Vt===f?e.jsxs(e.Fragment,{children:[e.jsx(ea,{size:14,className:"animate-spin"}),s==="de"?"Repariere...":s==="fr"?"RÃ©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(wa,{size:14}),s==="de"?"Auto-Reparatur":s==="fr"?"Auto-RÃ©paration":"Auto-Repair"]})}),(m==null?void 0:m.repairHistory)&&m.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(wa,{size:14}),s==="de"?"Reparatur-Historie":s==="fr"?"Historique de rÃ©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",m.repairHistory.length," ",s==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:m.repairHistory.map((le,gt)=>e.jsxs("div",{className:`border rounded-lg p-3 ${le.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[s==="de"?`Reparatur ${le.attempt}`:`Repair ${le.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${le.success?"text-green-600":"text-red-600"}`,children:["(",le.success?"âœ“":"âœ—"," ",le.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:le.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:s==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:s==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",le.fixPrompt]}),le.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:s==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:le.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),le.beforeImage&&le.afterImage&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:s==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:le.beforeImage,alt:"Before repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>Je({src:le.beforeImage,title:s==="de"?"Vorher":"Before"}),title:s==="de"?"Klicken zum VergrÃ¶ÃŸern":"Click to enlarge"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:s==="de"?"Nachher:":"After:"}),e.jsx("img",{src:le.afterImage,alt:"After repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>Je({src:le.afterImage,title:s==="de"?"Nachher":"After"}),title:s==="de"?"Klicken zum VergrÃ¶ÃŸern":"Click to enlarge"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(le.timestamp).toLocaleTimeString()})]},gt))})]}),mt(f)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:s==="de"?"Auszug aus Gliederung":s==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:mt(f)})]}),Ze(f)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:s==="de"?"Szenen-Prompt":s==="fr"?"Prompt de scÃ¨ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-64 overflow-y-auto",children:Ze(f)})]}),yt(f)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[s==="de"?"Szenenbeschreibung":s==="fr"?"Description de scÃ¨ne":"Scene Description",Bt(f)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",Bt(f),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:yt(f)})]}),(m==null?void 0:m.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[s==="de"?"API-Prompt":s==="fr"?"Prompt API":"API Prompt",(m==null?void 0:m.modelId)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",m.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:m==null?void 0:m.prompt})]}),((((jt=m==null?void 0:m.referencePhotos)==null?void 0:jt.length)??0)>0||(((ut=m==null?void 0:m.landmarkPhotos)==null?void 0:ut.length)??0)>0)&&m&&e.jsx(ta,{referencePhotos:m.referencePhotos||[],landmarkPhotos:m.landmarkPhotos,language:s}),(m==null?void 0:m.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[s==="de"?"QualitÃ¤tsbewertung":s==="fr"?"Score de qualitÃ©":"Quality Score",(m==null?void 0:m.qualityModelId)&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",m.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${((m==null?void 0:m.qualityScore)??0)>=70?"text-green-600":((m==null?void 0:m.qualityScore)??0)>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round((m==null?void 0:m.qualityScore)??0),"%"]})]}),(m==null?void 0:m.qualityReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:s==="de"?"Feedback:":s==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:m.qualityReasoning})]})]}),(m==null?void 0:m.retryHistory)&&m.retryHistory.length>0&&e.jsx(zr,{retryHistory:m.retryHistory,totalAttempts:(m==null?void 0:m.totalAttempts)||m.retryHistory.length,language:s,onRevertRepair:Z?(le,gt)=>Z(m.pageNumber,gt):void 0}),(m==null?void 0:m.wasRegenerated)&&(!(m!=null&&m.retryHistory)||m.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["ðŸ”„ ",s==="de"?"Bild regeneriert":s==="fr"?"Image rÃ©gÃ©nÃ©rÃ©e":"Image Regenerated"]}),(m==null?void 0:m.originalScore)!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(m.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:s==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige QualitÃ¤t hatte.":s==="fr"?"L'image a Ã©tÃ© automatiquement rÃ©gÃ©nÃ©rÃ©e car la premiÃ¨re version avait une qualitÃ© faible.":"Image was automatically regenerated because the first version had low quality."}),(m==null?void 0:m.originalImage)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:s==="de"?"Originalbild:":s==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:m.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),(m==null?void 0:m.originalReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:s==="de"?"Original Feedback:":s==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:m.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`w-full flex flex-col items-center justify-center rounded-lg p-8 mb-4 ${P?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:P?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:Pe==="de"?"Bild wird noch erstellt...":Pe==="fr"?"Image en cours de crÃ©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:Pe==="de"?"Kein Bild fÃ¼r diese Seite":Pe==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"w-full bg-indigo-50 rounded-lg p-6 border-2 border-indigo-200",children:dt?e.jsx("textarea",{value:r.trim(),onChange:le=>ia(S,le.target.value),className:"w-full min-h-[400px] p-3 text-gray-800 leading-snug font-serif text-xl text-center bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:s==="de"?"Text eingeben...":s==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl text-center",children:r.trim()})})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 items-stretch",children:[m&&m.imageData?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:m.imageData,alt:`Scene for page ${f}`,className:`w-full rounded-lg shadow-md object-cover ${Ct.has(f)?"opacity-50":""}`}),Ct.has(f)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(ea,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:s==="de"?"Neues Bild wird erstellt...":s==="fr"?"Nouvelle image en cours...":"Generating new image..."})]})]}),ne&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>Gr(f),disabled:P||Ct.has(f)||!We,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P||Ct.has(f)||!We?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:We?"":s==="de"?"Nicht genug Credits":s==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(Ht,{size:14}),s==="de"?"Bild neu generieren":s==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",lt," ",s==="de"?"Credits":"credits",")"]})]}),_e&&e.jsxs("button",{onClick:()=>be(!0),disabled:P,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xe,{size:14}),s==="de"?"Text bearbeiten":s==="fr"?"Modifier le texte":"Edit Text"]}),Ut(f).length>1&&e.jsxs("button",{onClick:()=>wr({pageNumber:f,versions:Ut(f)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(aa,{size:14}),Ut(f).length]})]})}),me&&e.jsxs("div",{className:"mt-3 space-y-2",children:[te&&e.jsxs("button",{onClick:()=>te(f),disabled:P,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xe,{size:14})," ",s==="de"?"Bearbeiten":"Edit"]}),$&&e.jsx("button",{onClick:()=>Mr(f),disabled:P||Vt!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P||Vt!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:s==="de"?"Physik-Fehler automatisch erkennen und reparieren":s==="fr"?"DÃ©tecter et rÃ©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:Vt===f?e.jsxs(e.Fragment,{children:[e.jsx(ea,{size:14,className:"animate-spin"}),s==="de"?"Repariere...":s==="fr"?"RÃ©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(wa,{size:14}),s==="de"?"Auto-Reparatur":s==="fr"?"Auto-RÃ©paration":"Auto-Repair"]})}),(m==null?void 0:m.repairHistory)&&m.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(wa,{size:14}),s==="de"?"Reparatur-Historie":s==="fr"?"Historique de rÃ©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",m.repairHistory.length," ",s==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:m.repairHistory.map((le,gt)=>e.jsxs("div",{className:`border rounded-lg p-3 ${le.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[s==="de"?`Reparatur ${le.attempt}`:`Repair ${le.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${le.success?"text-green-600":"text-red-600"}`,children:["(",le.success?"âœ“":"âœ—"," ",le.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:le.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:s==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:s==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",le.fixPrompt]}),le.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:s==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:le.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),le.beforeImage&&le.afterImage&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:s==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:le.beforeImage,alt:"Before repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>Je({src:le.beforeImage,title:s==="de"?"Vorher":"Before"}),title:s==="de"?"Klicken zum VergrÃ¶ÃŸern":"Click to enlarge"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:s==="de"?"Nachher:":"After:"}),e.jsx("img",{src:le.afterImage,alt:"After repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>Je({src:le.afterImage,title:s==="de"?"Nachher":"After"}),title:s==="de"?"Klicken zum VergrÃ¶ÃŸern":"Click to enlarge"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(le.timestamp).toLocaleTimeString()})]},gt))})]}),mt(f)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:s==="de"?"Auszug aus Gliederung":s==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:mt(f)})]}),Ze(f)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:s==="de"?"Szenen-Prompt":s==="fr"?"Prompt de scÃ¨ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-64 overflow-y-auto",children:Ze(f)})]}),yt(f)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[s==="de"?"Szenenbeschreibung":s==="fr"?"Description de scÃ¨ne":"Scene Description",Bt(f)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",Bt(f),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:yt(f)})]}),m.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[s==="de"?"API-Prompt":s==="fr"?"Prompt API":"API Prompt",m.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",m.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:m.prompt})]}),((((Mt=m.referencePhotos)==null?void 0:Mt.length)??0)>0||(((kt=m.landmarkPhotos)==null?void 0:kt.length)??0)>0)&&e.jsx(ta,{referencePhotos:m.referencePhotos||[],landmarkPhotos:m.landmarkPhotos,language:s}),m.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[s==="de"?"QualitÃ¤tsbewertung":s==="fr"?"Score de qualitÃ©":"Quality Score",m.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",m.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${m.qualityScore>=70?"text-green-600":m.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(m.qualityScore),"%"]})]}),m.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:s==="de"?"Feedback:":s==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:m.qualityReasoning})]})]}),m.retryHistory&&m.retryHistory.length>0&&e.jsx(zr,{retryHistory:m.retryHistory,totalAttempts:m.totalAttempts||m.retryHistory.length,language:s,onRevertRepair:Z?(le,gt)=>Z(m.pageNumber,gt):void 0}),m.wasRegenerated&&(!m.retryHistory||m.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["ðŸ”„ ",s==="de"?"Bild regeneriert":s==="fr"?"Image rÃ©gÃ©nÃ©rÃ©e":"Image Regenerated"]}),m.originalScore!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(m.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:s==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige QualitÃ¤t hatte.":s==="fr"?"L'image a Ã©tÃ© automatiquement rÃ©gÃ©nÃ©rÃ©e car la premiÃ¨re version avait une qualitÃ© faible.":"Image was automatically regenerated because the first version had low quality."}),m.originalImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:s==="de"?"Originalbild:":s==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:m.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),m.originalReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:s==="de"?"Original Feedback:":s==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:m.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`flex flex-col items-center justify-center rounded-lg p-8 ${P?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:P?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:Pe==="de"?"Bild wird noch erstellt...":Pe==="fr"?"Image en cours de crÃ©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:Pe==="de"?"Kein Bild fÃ¼r diese Seite":Pe==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"flex flex-col w-full h-full",children:dt?e.jsx("textarea",{value:r.trim(),onChange:le=>ia(S,le.target.value),className:"w-full flex-1 min-h-[300px] p-4 text-gray-800 leading-snug font-serif text-xl bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:s==="de"?"Text eingeben...":s==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl",children:r.trim()})})})]})]},f)})]}),C&&It(C.backCover)&&(()=>{var S,f,G;const r=Cr(C.backCover);return e.jsxs("div",{className:"mt-8 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:Pe==="de"?"RÃ¼ckseite":Pe==="fr"?"QuatriÃ¨me de couverture":"Back Cover"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sa,{src:It(C.backCover),alt:"Back Cover",className:"w-full rounded-lg shadow-lg",label:"Back Cover"}),p.has("backCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(wt,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),B&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>er("back"),disabled:P||!We||p.has("backCover"),className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P||!We||p.has("backCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:We?"":s==="de"?"Nicht genug Credits":s==="fr"?"Pas assez de crÃ©dits":"Not enough credits",children:[e.jsx(Ht,{size:14}),s==="de"?"Bild neu generieren":s==="fr"?"RÃ©gÃ©nÃ©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",lt," ",s==="de"?"Credits":"credits",")"]})]})}),me&&r&&e.jsxs("div",{className:"mt-3 space-y-2",children:[K&&e.jsxs("button",{onClick:()=>K("back"),disabled:P,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xe,{size:14})," ",s==="de"?"Bearbeiten":"Edit"]}),r.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:s==="de"?"Szenenbeschreibung":s==="fr"?"Description de scÃ¨ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:typeof r.description=="string"?r.description:((S=r.description)==null?void 0:S.text)||JSON.stringify(r.description)})]}),r.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[s==="de"?"API-Prompt":s==="fr"?"Prompt API":"API Prompt",r.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:r.prompt})]}),((((f=r.referencePhotos)==null?void 0:f.length)??0)>0||(((G=r.landmarkPhotos)==null?void 0:G.length)??0)>0)&&e.jsx(ta,{referencePhotos:r.referencePhotos||[],landmarkPhotos:r.landmarkPhotos,language:s}),r.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[s==="de"?"QualitÃ¤tsbewertung":s==="fr"?"Score de qualitÃ©":"Quality Score",r.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${r.qualityScore>=70?"text-green-600":r.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(r.qualityScore),"%"]})]}),r.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:s==="de"?"Feedback:":s==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),r.retryHistory&&r.retryHistory.length>0&&e.jsx(zr,{retryHistory:r.retryHistory,totalAttempts:r.totalAttempts||r.retryHistory.length,language:s})]})]})})(),ft&&o&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-4 mt-6",children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-3 text-center",children:s==="de"?"Was mÃ¶chten Sie als NÃ¤chstes tun?":s==="fr"?"Que souhaitez-vous faire ensuite ?":"What would you like to do next?"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[fe&&W&&e.jsxs("button",{onClick:W,disabled:P,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Ws,{size:16})," ",s==="de"?"Buch erstellen":s==="fr"?"CrÃ©er le livre":"Create Book"]}),F&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>cr(!Xt),disabled:P,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Er,{size:16}),s==="de"?"PDF herunterladen":s==="fr"?"TÃ©lÃ©charger PDF":"Download PDF",e.jsx(Jt,{size:14,className:`transition-transform ${Xt?"rotate-180":""}`})]}),Xt&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:qt==="square",onChange:()=>ct("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20Ã—20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:qt==="A4",onChange:()=>ct("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21Ã—28cm)"})]})]}),e.jsx("button",{onClick:()=>{F(qt),cr(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:s==="de"?"Herunterladen":s==="fr"?"TÃ©lÃ©charger":"Download"})]})]}),_e&&!dt&&e.jsxs("button",{onClick:()=>be(!0),disabled:P,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Xe,{size:16})," ",s==="de"?"Text bearbeiten":s==="fr"?"Modifier le texte":"Edit Text"]}),X&&e.jsxs("button",{onClick:X,disabled:P,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${P?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Os,{size:16})," ",s==="de"?"Neue Geschichte":s==="fr"?"Nouvelle histoire":"New Story"]})]})]}),dt&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 shadow-lg p-3 md:p-4 z-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(Xe,{size:18,className:"flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-sm md:text-base",children:s==="de"?"Bearbeitungsmodus":s==="fr"?"Mode Ã©dition":"Edit Mode"}),Ue&&e.jsxs("span",{className:"text-xs text-gray-500 hidden sm:inline",children:["(",s==="de"?"Original gespeichert":s==="fr"?"Original sauvegardÃ©":"Original saved",")"]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-center md:justify-end",children:[e.jsxs("button",{onClick:Ea,disabled:_t,className:"px-3 md:px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(zt,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:s==="de"?"Abbrechen":s==="fr"?"Annuler":"Cancel"})]}),Ue&&Qt!==Ue&&e.jsxs("button",{onClick:()=>Re(Ue),disabled:_t,className:"px-3 md:px-4 py-2 border border-amber-400 text-amber-700 rounded-lg hover:bg-amber-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(Pi,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:s==="de"?"ZurÃ¼cksetzen":s==="fr"?"Restaurer":"Restore"})]}),e.jsxs("button",{onClick:Da,disabled:_t,className:`px-3 md:px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-semibold flex items-center gap-1.5 ${_t?"opacity-50 cursor-not-allowed":"hover:bg-green-600"}`,children:[e.jsx(Dr,{size:16}),_t?s==="de"?"Speichern...":s==="fr"?"Sauvegarde...":"Saving...":s==="de"?"Speichern":s==="fr"?"Sauvegarder":"Save"]})]})]})}),rt&&e.jsx(Xi,{pageNumber:rt.pageNumber,scene:rt.scene,onSceneChange:r=>v({...rt,scene:r}),onClose:()=>v(null),onRegenerate:Hr,isRegenerating:Ct.has(rt.pageNumber),imageRegenerationCost:lt,characters:ie.map(r=>({id:r.id,name:r.name,photoUrl:r.photoData})),selectedCharacterIds:rt.selectedCharacterIds,onCharacterSelectionChange:r=>v({...rt,selectedCharacterIds:r}),consistencyRegen:me?(Wr=D.find(r=>r.pageNumber===rt.pageNumber))==null?void 0:Wr.consistencyRegen:void 0}),pt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-lg w-full shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Ht,{size:20}),s==="de"?"Cover bearbeiten":s==="fr"?"Modifier la couverture":"Edit Cover"," - ",pt.coverType==="front"?s==="de"?"Titelseite":s==="fr"?"Couverture":"Front Cover":pt.coverType==="initial"?s==="de"?"Einleitungsseite":s==="fr"?"Page de dÃ©dicace":"Dedication Page":s==="de"?"RÃ¼ckseite":s==="fr"?"Dos":"Back Cover"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s==="de"?"Beschreibe was auf dem Bild zu sehen sein soll":s==="fr"?"DÃ©crivez ce que l'image doit montrer":"Describe what should be shown in the image"})]}),e.jsx("div",{className:"p-4",children:e.jsx("textarea",{value:pt.scene,onChange:r=>Yt({...pt,scene:r.target.value}),placeholder:s==="de"?'z.B. "Die Hauptfigur steht vor einem magischen Schloss bei Sonnenuntergang"':s==="fr"?'par ex. "Le personnage principal devant un chÃ¢teau magique au coucher du soleil"':'e.g. "The main character standing in front of a magical castle at sunset"',className:"w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-none"})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>Yt(null),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium",children:s==="de"?"Abbrechen":s==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{onClick:Or,disabled:p.has(pt.coverType==="front"?"frontCover":pt.coverType==="initial"?"initialPage":"backCover"),className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center gap-2 ${p.has(pt.coverType==="front"?"frontCover":pt.coverType==="initial"?"initialPage":"backCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:[e.jsx(Ht,{size:16}),s==="de"?"Neu generieren":s==="fr"?"RÃ©gÃ©nÃ©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",lt," ",s==="de"?"Credits":"credits",")"]})]})]})]})}),we&&e.jsx(eo,{pageNumber:we.pageNumber,versions:we.versions,onClose:()=>wr(null),onSelectVersion:za,developerMode:me}),Br&&e.jsx(to,{src:Br.src,title:Br.title,onClose:()=>Je(null)})]})}const Ca={"claude-sonnet":{provider:"anthropic",description:"Claude Sonnet 4.5 - Best narrative quality",descriptionDe:"Claude Sonnet 4.5 - Beste ErzÃ¤hlqualitÃ¤t",descriptionFr:"Claude Sonnet 4.5 - Meilleure qualitÃ© narrative"},"claude-haiku":{provider:"anthropic",description:"Claude Haiku 3.5 - Fast and cheap",descriptionDe:"Claude Haiku 3.5 - Schnell und gÃ¼nstig",descriptionFr:"Claude Haiku 3.5 - Rapide et Ã©conomique"},"gemini-2.5-pro":{provider:"google",description:"Gemini 2.5 Pro - High quality, large output",descriptionDe:"Gemini 2.5 Pro - Hohe QualitÃ¤t, grosse Ausgabe",descriptionFr:"Gemini 2.5 Pro - Haute qualitÃ©, grande sortie"},"gemini-2.5-flash":{provider:"google",description:"Gemini 2.5 Flash - Fast with large output",descriptionDe:"Gemini 2.5 Flash - Schnell mit grosser Ausgabe",descriptionFr:"Gemini 2.5 Flash - Rapide avec grande sortie"},"gemini-2.0-flash":{provider:"google",description:"Gemini 2.0 Flash - Very fast",descriptionDe:"Gemini 2.0 Flash - Sehr schnell",descriptionFr:"Gemini 2.0 Flash - TrÃ¨s rapide"}},Ys={"gemini-2.5-flash-image":{description:"Gemini 2.5 Flash Image - Fast scene generation",descriptionDe:"Gemini 2.5 Flash Image - Schnelle Szenengenerierung",descriptionFr:"Gemini 2.5 Flash Image - GÃ©nÃ©ration rapide de scÃ¨nes"},"gemini-3-pro-image-preview":{description:"Gemini 3 Pro Image - Higher quality (preview)",descriptionDe:"Gemini 3 Pro Image - HÃ¶here QualitÃ¤t (Vorschau)",descriptionFr:"Gemini 3 Pro Image - QualitÃ© supÃ©rieure (aperÃ§u)"},"flux-schnell":{description:"FLUX Schnell (Runware) - Ultra cheap ($0.0006/image)",descriptionDe:"FLUX Schnell (Runware) - Ultra gÃ¼nstig ($0.0006/Bild)",descriptionFr:"FLUX Schnell (Runware) - Ultra Ã©conomique ($0.0006/image)"},"flux-dev":{description:"FLUX Dev (Runware) - Better quality ($0.004/image)",descriptionDe:"FLUX Dev (Runware) - Bessere QualitÃ¤t ($0.004/Bild)",descriptionFr:"FLUX Dev (Runware) - Meilleure qualitÃ© ($0.004/image)"}},io={"gemini-2.0-flash":{description:"Gemini 2.0 Flash - Fast evaluation",descriptionDe:"Gemini 2.0 Flash - Schnelle Bewertung",descriptionFr:"Gemini 2.0 Flash - Ã‰valuation rapide"},"gemini-2.5-flash":{description:"Gemini 2.5 Flash - More thorough",descriptionDe:"Gemini 2.5 Flash - GrÃ¼ndlicher",descriptionFr:"Gemini 2.5 Flash - Plus approfondi"}},oo={gemini:{description:"Google Gemini - Best quality (~$0.035/image)",descriptionDe:"Google Gemini - Beste QualitÃ¤t (~$0.035/Bild)",descriptionFr:"Google Gemini - Meilleure qualitÃ© (~$0.035/image)"},runware:{description:"FLUX Schnell - Ultra cheap for testing ($0.0006/image)",descriptionDe:"FLUX Schnell - Ultra gÃ¼nstig zum Testen ($0.0006/Bild)",descriptionFr:"FLUX Schnell - Ultra Ã©conomique pour tests ($0.0006/image)"}},lo={"gemini-2.5-flash-image":{description:"Gemini 2.5 Flash Image - Fast avatar generation",descriptionDe:"Gemini 2.5 Flash Image - Schnelle Avatar-Generierung",descriptionFr:"Gemini 2.5 Flash Image - GÃ©nÃ©ration rapide d'avatars"},"gemini-3-pro-image-preview":{description:"Gemini 3 Pro Image - Higher quality (preview)",descriptionDe:"Gemini 3 Pro Image - HÃ¶here QualitÃ¤t (Vorschau)",descriptionFr:"Gemini 3 Pro Image - QualitÃ© supÃ©rieure (aperÃ§u)"},"ace-plus-plus":{description:"ACE++ (Runware) - Cheap face-consistent avatars (~$0.005)",descriptionDe:"ACE++ (Runware) - GÃ¼nstige gesichtskonsistente Avatare (~$0.005)",descriptionFr:"ACE++ (Runware) - Avatars Ã©conomiques avec visage cohÃ©rent (~$0.005)"}};function Kt({label:t,icon:o,value:i,options:N,onChange:a,language:y}){const b=c=>y==="de"&&c.descriptionDe?c.descriptionDe:y==="fr"&&c.descriptionFr?c.descriptionFr:c.description;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("label",{className:"text-xs font-semibold text-gray-600 flex items-center gap-1",children:[o,t]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:i||"",onChange:c=>a(c.target.value||null),className:"w-full appearance-none bg-white border border-gray-300 rounded-lg px-3 py-2 pr-8 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:y==="de"?"Server-Standard":y==="fr"?"Par dÃ©faut serveur":"Server Default"}),Object.entries(N).map(([c,D])=>e.jsxs("option",{value:c,children:[c," ",D.provider?`(${D.provider})`:""]},c))]}),e.jsx(Jt,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),i&&N[i]&&e.jsx("p",{className:"text-[10px] text-gray-500 italic",children:b(N[i])})]})}function co({selections:t,onChange:o}){const{language:i}=Ot(),N=(a,y)=>{o({...t,[a]:y})};return e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-400 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-yellow-800 mb-3 flex items-center gap-2",children:[e.jsx(zi,{size:16}),i==="de"?"AI-Modell Auswahl (Dev)":i==="fr"?"SÃ©lection de modÃ¨le IA (Dev)":"AI Model Selection (Dev)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(Kt,{label:i==="de"?"Ideen-Modell":i==="fr"?"ModÃ¨le d'idÃ©es":"Idea Model",icon:e.jsx(Ri,{size:12}),value:t.ideaModel,options:Ca,onChange:a=>N("ideaModel",a),language:i}),e.jsx(Kt,{label:i==="de"?"Geschichte (Kombiniert)":i==="fr"?"Histoire (CombinÃ©)":"Story (Combined)",icon:e.jsx(Fr,{size:12}),value:t.outlineModel,options:Ca,onChange:a=>N("outlineModel",a),language:i}),e.jsx(Kt,{label:i==="de"?"Text-Modell":i==="fr"?"ModÃ¨le de texte":"Text Model",icon:e.jsx(Fr,{size:12}),value:t.textModel,options:Ca,onChange:a=>N("textModel",a),language:i}),e.jsx(Kt,{label:i==="de"?"Szenen-Modell":i==="fr"?"ModÃ¨le de scÃ¨ne":"Scene Description Model",icon:e.jsx(mn,{size:12}),value:t.sceneDescriptionModel,options:Ca,onChange:a=>N("sceneDescriptionModel",a),language:i}),e.jsx(Kt,{label:i==="de"?"Bild-Modell":i==="fr"?"ModÃ¨le d'image":"Image Model",icon:e.jsx(_s,{size:12}),value:t.imageModel,options:Ys,onChange:a=>N("imageModel",a),language:i}),e.jsx(Kt,{label:i==="de"?"Cover-Modell":i==="fr"?"ModÃ¨le de couverture":"Cover Image Model",icon:e.jsx(Oi,{size:12}),value:t.coverImageModel,options:Ys,onChange:a=>N("coverImageModel",a),language:i}),e.jsx(Kt,{label:i==="de"?"Bewertungs-Modell":i==="fr"?"ModÃ¨le d'Ã©valuation":"Quality Eval Model",icon:e.jsx(yi,{size:12}),value:t.qualityModel,options:io,onChange:a=>N("qualityModel",a),language:i}),e.jsx(Kt,{label:i==="de"?"Bild-Reparatur":i==="fr"?"RÃ©paration d'image":"Image Repair",icon:e.jsx(Hi,{size:12}),value:t.imageBackend,options:oo,onChange:a=>N("imageBackend",a),language:i}),e.jsx(Kt,{label:i==="de"?"Avatar-Modell":i==="fr"?"ModÃ¨le d'avatar":"Avatar Model",icon:e.jsx(_s,{size:12}),value:t.avatarModel,options:lo,onChange:a=>N("avatarModel",a),language:i})]}),e.jsx("p",{className:"text-[10px] text-yellow-700 mt-3 italic",children:i==="de"?'Hinweis: Nur sichtbar fÃ¼r Admin-Benutzer im Entwicklermodus. "Server-Standard" verwendet die Umgebungsvariablen-Konfiguration.':i==="fr"?`Note: Visible uniquement pour les utilisateurs admin en mode dÃ©veloppeur. "Par dÃ©faut serveur" utilise la configuration des variables d'environnement.`:'Note: Only visible to admin users in developer mode. "Server Default" uses the environment variable configuration.'})]})}const Xs=[{code:"de-ch",name:"Deutsch",family:"de"},{code:"fr-ch",name:"FranÃ§ais",family:"fr"},{code:"it-ch",name:"Italiano",family:"it"},{code:"en-gb",name:"English",family:"en"},{code:"gsw-zh",name:"Mundart",family:"gsw"}],ka={de:[{code:"de-ch",name:"Schweiz"},{code:"de-de",name:"Hochdeutsch"},{code:"de-de-north",name:"Norddeutsch"},{code:"de-de-south",name:"SÃ¼ddeutsch"},{code:"de-at",name:"Ã–sterreich"},{code:"de-it",name:"SÃ¼dtirol"}],fr:[{code:"fr-ch",name:"Suisse"},{code:"fr-fr",name:"France"},{code:"fr-be",name:"Belgique"},{code:"fr-ca",name:"QuÃ©bec"},{code:"fr-af",name:"Afrique"}],it:[{code:"it-ch",name:"Svizzera"},{code:"it-it",name:"Standard"},{code:"it-it-north",name:"Nord"},{code:"it-it-central",name:"Toscana"},{code:"it-it-south",name:"Sud"},{code:"it-sm",name:"San Marino"}],en:[{code:"en-gb",name:"British"},{code:"en-us",name:"American"},{code:"en-ca",name:"Canadian"},{code:"en-au",name:"Australian"},{code:"en-ie",name:"Irish"},{code:"en-za",name:"South African"}],gsw:[{code:"gsw-zh",name:"ZÃ¼ritÃ¼Ã¼tsch"},{code:"gsw-be",name:"BÃ¤rndÃ¼tsch"},{code:"gsw-bs",name:"Baseldytsch"},{code:"gsw-lu",name:"LuzÃ¤rndÃ¼tsch"},{code:"gsw-sg",name:"SanggallerdÃ¼tsch"},{code:"gsw-vs",name:"WalliserdÃ¼tsch"},{code:"gsw-gr",name:"BÃ¼ndnerdÃ¼tsch"}]};function ns(t){return t.startsWith("gsw")?"gsw":t.startsWith("de")?"de":t.startsWith("fr")?"fr":t.startsWith("it")?"it":"en"}const mo=["spring","summer","autumn","winter"];function gn(){const t=new Date().getMonth();return t>=2&&t<=4?"spring":t>=5&&t<=7?"summer":t>=8&&t<=10?"autumn":"winter"}function uo({languageLevel:t,onLanguageLevelChange:o,pages:i,onPagesChange:N,storyLanguage:a,onStoryLanguageChange:y,developerMode:b,userLocation:c,onLocationChange:D,season:_,onSeasonChange:C,userCredits:p}){const{t:I,language:x}=Ot(),[P,F]=l.useState(!1),[W,L]=l.useState((c==null?void 0:c.city)||""),[X,Q]=l.useState((c==null?void 0:c.country)||""),[ne,B]=l.useState(!1),ie=l.useRef(null);l.useEffect(()=>{const M=Fe=>{ie.current&&!ie.current.contains(Fe.target)&&B(!1)};return document.addEventListener("mousedown",M),()=>document.removeEventListener("mousedown",M)},[]);const te=l.useCallback(()=>{const M=ns(a),Fe=Xs.find(_e=>_e.family===M),Ue=ka[M].find(_e=>_e.code===a)||ka[M][0];return Fe&&Ue?`${Fe.name} (${Ue.name})`:(Fe==null?void 0:Fe.name)||a},[a]);l.useEffect(()=>{c&&(L(c.city||""),Q(c.country||""))},[c]);const K=()=>{D({city:W||null,region:null,country:X||null}),F(!1)},$={spring:{de:"FrÃ¼hling",fr:"Printemps",en:"Spring"},summer:{de:"Sommer",fr:"Ã‰tÃ©",en:"Summer"},autumn:{de:"Herbst",fr:"Automne",en:"Autumn"},winter:{de:"Winter",fr:"Hiver",en:"Winter"}},Z=b?4:10,xe=50,fe=2,me=10,ge=p===-1,Ne=ge?xe:Math.floor(p/me),Se=Math.floor(Ne/2)*2,re=Z*me,$e=!ge&&p<re,it=re-p,Ae=$e?Z:Math.min(xe,Math.max(Z,Se)),qe=!ge&&Se<xe;l.useEffect(()=>{let M=i;M%2!==0&&(M=Math.round(M/2)*2),M=Math.max(Z,Math.min(Ae,M)),M!==i&&N(M)},[i,Z,Ae,N]);const de=[{value:"1st-grade",label:I.firstGrade,desc:I.firstGradeDesc,image:"/images/text and image on each page.jpg"},{value:"standard",label:I.standard,desc:I.standardDesc,image:"/images/left page text, right page image.jpg"},{value:"advanced",label:I.advanced,desc:I.advancedDesc,image:"/images/dense text left.jpg"}],se=(M,Fe=!1)=>{const Ue=Fe?" (Test)":"",_e=M*10,Tt=x==="de"?"Credits":x==="fr"?"crÃ©dits":"credits";if(t==="1st-grade")return`${M} ${x==="de"?"Seiten":"pages"} = ${_e} ${Tt}${Ue}`;const $t=Math.floor(M/2),lt=Math.floor(M/2);return x==="de"?`${M} Seiten (${$t} Text + ${lt} Bilder) = ${_e} ${Tt}${Ue}`:x==="fr"?`${M} pages (${$t} texte + ${lt} images) = ${_e} ${Tt}${Ue}`:`${M} pages (${$t} text + ${lt} images) = ${_e} ${Tt}${Ue}`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Pa,{size:24}),x==="de"?"Buchformat":x==="fr"?"Format du livre":"Book Format"]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:x==="de"?"Sprache:":x==="fr"?"Langue:":"Language:"}),e.jsxs("div",{className:"relative",ref:ie,children:[e.jsxs("button",{type:"button",onClick:()=>B(!ne),className:"px-3 py-1.5 border border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-sm font-medium bg-white cursor-pointer pr-8 flex items-center gap-1 min-w-[160px]",children:[te(),e.jsx(Jt,{size:16,className:`absolute right-2 text-gray-400 transition-transform ${ne?"rotate-180":""}`})]}),ne&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 min-w-[180px] py-1",children:[Xs.map(M=>{const Fe=ns(a)===M.family;return e.jsx("button",{type:"button",onClick:()=>{const Ue=ka[M.family][0];y(Ue.code)},className:`w-full text-left px-3 py-1.5 text-sm hover:bg-indigo-50 ${Fe?"font-semibold text-indigo-600":"text-gray-700"}`,children:M.name},M.family)}),e.jsx("div",{className:"border-t border-gray-300 my-1"}),ka[ns(a)].map(M=>e.jsx("button",{type:"button",onClick:()=>{y(M.code),B(!1)},className:`w-full text-left px-3 py-1.5 text-sm hover:bg-indigo-50 ${a===M.code?"bg-indigo-100 text-indigo-700 font-medium":"text-gray-700"}`,children:M.name},M.code))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Li,{className:"text-gray-500",size:16}),e.jsx("span",{className:"text-sm text-gray-600",children:x==="de"?"Ort:":x==="fr"?"Lieu:":"Location:"}),P?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"text",value:W,onChange:M=>L(M.target.value),placeholder:x==="de"?"Stadt":x==="fr"?"Ville":"City",className:"px-2 py-1 border border-gray-300 rounded text-base w-24 focus:outline-none focus:border-indigo-500"}),e.jsx("input",{type:"text",value:X,onChange:M=>Q(M.target.value),placeholder:x==="de"?"Land":x==="fr"?"Pays":"Country",className:"px-2 py-1 border border-gray-300 rounded text-base w-24 focus:outline-none focus:border-indigo-500"}),e.jsx("button",{onClick:K,className:"px-2 py-1 bg-indigo-600 text-white text-xs rounded hover:bg-indigo-700",children:"OK"}),e.jsx("button",{onClick:()=>F(!1),className:"px-1 text-gray-500 text-xs hover:text-gray-700",children:"âœ•"})]}):e.jsx("button",{onClick:()=>F(!0),className:"text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline",children:c!=null&&c.city?`${c.city}${c.country?`, ${c.country}`:""}`:x==="de"?"Festlegen":x==="fr"?"DÃ©finir":"Set"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:x==="de"?"Jahreszeit:":x==="fr"?"Saison:":"Season:"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:_,onChange:M=>C(M.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-sm font-medium appearance-none bg-white cursor-pointer pr-8",children:mo.map(M=>e.jsx("option",{value:M,children:$[M][x]||$[M].en},M))}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:I.readingLevel}),e.jsx("div",{className:"flex overflow-x-auto gap-3 pb-2 md:grid md:grid-cols-3 md:gap-4 md:overflow-visible md:pb-0 -mx-4 px-4 md:mx-0 md:px-0",children:de.map(M=>e.jsxs("button",{onClick:()=>o(M.value),className:`flex-shrink-0 w-56 md:w-auto text-left rounded-lg border-2 transition-all overflow-hidden ${t===M.value?"border-indigo-600 ring-2 ring-indigo-200":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"w-full bg-gray-100 p-2 h-48 md:h-56",children:e.jsx("img",{src:M.image,alt:M.label,className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"p-2 md:p-2.5",children:[e.jsx("div",{className:"font-semibold text-sm mb-0.5",children:M.label}),e.jsx("div",{className:"text-xs text-gray-500 whitespace-pre-line",children:M.desc})]})]},M.value))})]}),t&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:I.numberOfPages}),$e?e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-red-700 font-semibold mb-2",children:x==="de"?"Nicht genÃ¼gend Credits":x==="fr"?"CrÃ©dits insuffisants":"Not enough credits"}),e.jsx("p",{className:"text-red-600 text-sm",children:x==="de"?`Du benÃ¶tigst mindestens ${re} Credits fÃ¼r eine Geschichte mit ${Z} Seiten. Dir fehlen noch ${it} Credits.`:x==="fr"?`Vous avez besoin d'au moins ${re} crÃ©dits pour une histoire de ${Z} pages. Il vous manque ${it} crÃ©dits.`:`You need at least ${re} credits for a ${Z}-page story. You need ${it} more credits.`}),e.jsx("p",{className:"text-gray-500 text-xs mt-2",children:x==="de"?`Aktuell: ${p} Credits`:x==="fr"?`Actuel: ${p} crÃ©dits`:`Current: ${p} credits`})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"range",min:Z,max:Ae,step:fe,value:Math.min(i,Ae),onChange:M=>N(parseInt(M.target.value)),className:`w-full h-3 bg-indigo-100 rounded-lg appearance-none cursor-pointer accent-indigo-600 touch-none
                           [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-6 [&::-webkit-slider-thumb]:h-6
                           [&::-webkit-slider-thumb]:bg-indigo-600 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer
                           [&::-webkit-slider-thumb]:shadow-md [&::-webkit-slider-thumb]:hover:bg-indigo-700
                           [&::-moz-range-thumb]:w-6 [&::-moz-range-thumb]:h-6 [&::-moz-range-thumb]:bg-indigo-600
                           [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:cursor-pointer [&::-moz-range-thumb]:border-0`}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:Z}),e.jsxs("span",{className:"text-xl font-bold text-indigo-600",children:[i," ",x==="de"?"Seiten":"pages"]}),e.jsxs("span",{className:`text-sm ${qe?"text-orange-500 font-medium":"text-gray-400"}`,children:[Ae,qe&&" âš ï¸"]})]}),qe&&e.jsx("div",{className:"text-center text-sm text-orange-600 bg-orange-50 rounded-lg py-2 px-3",children:x==="de"?`Max. ${Ae} Seiten mit ${p} Credits mÃ¶glich`:x==="fr"?`Max. ${Ae} pages possibles avec ${p} crÃ©dits`:`Max. ${Ae} pages possible with ${p} credits`}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-base font-medium text-gray-700",children:se(i,i===4)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t==="1st-grade"?x==="de"?"Jede Seite enthÃ¤lt ein Bild mit Text darunter":x==="fr"?"Chaque page contient une image avec du texte en dessous":"Each page contains an image with text below":x==="de"?"Abwechselnd Textseite und Bildseite":x==="fr"?"Alternance de pages de texte et d'images":"Alternating text page and image page"})]})]})]})]})}const go=Object.freeze(Object.defineProperty({__proto__:null,WizardStep3BookSettings:uo,getCurrentSeason:gn},Symbol.toStringTag,{value:"Module"})),en={en:{title:"Check Your Email",description:"We've sent you a verification link. Your story will start generating automatically once you verify your email!",currentEmail:"Verification sent to",sendVerification:"Send Verification Email",resendVerification:"Resend Verification Email",emailSent:"Verification email sent! Please check your inbox.",changeEmail:"Wrong email? Change it",newEmail:"New email address",currentPassword:"Current password",confirmChange:"Change & Verify",cancel:"Cancel",emailChanged:"Email changed! Please check your new inbox for verification.",checkSpam:"Don't see it? Check your spam folder.",fillAllFields:"Please fill in all fields"},de:{title:"E-Mail prÃ¼fen",description:"Wir haben Ihnen einen BestÃ¤tigungslink gesendet. Ihre Geschichte wird automatisch erstellt, sobald Sie Ihre E-Mail bestÃ¤tigen!",currentEmail:"BestÃ¤tigung gesendet an",sendVerification:"BestÃ¤tigungs-E-Mail senden",resendVerification:"BestÃ¤tigungs-E-Mail erneut senden",emailSent:"BestÃ¤tigungs-E-Mail gesendet! Bitte prÃ¼fen Sie Ihren Posteingang.",changeEmail:"Falsche E-Mail? Ã„ndern",newEmail:"Neue E-Mail-Adresse",currentPassword:"Aktuelles Passwort",confirmChange:"Ã„ndern & BestÃ¤tigen",cancel:"Abbrechen",emailChanged:"E-Mail geÃ¤ndert! Bitte prÃ¼fen Sie Ihren neuen Posteingang fÃ¼r die BestÃ¤tigung.",checkSpam:"Nicht gefunden? PrÃ¼fen Sie Ihren Spam-Ordner.",fillAllFields:"Bitte alle Felder ausfÃ¼llen"},fr:{title:"Verifiez votre e-mail",description:"Nous vous avons envoye un lien de verification. Votre histoire sera generee automatiquement une fois votre e-mail verifie!",currentEmail:"Verification envoyee a",sendVerification:"Envoyer l'e-mail de verification",resendVerification:"Renvoyer l'e-mail de verification",emailSent:"E-mail de verification envoye! Veuillez verifier votre boite de reception.",changeEmail:"Mauvais e-mail? Changer",newEmail:"Nouvelle adresse e-mail",currentPassword:"Mot de passe actuel",confirmChange:"Changer & Verifier",cancel:"Annuler",emailChanged:"E-mail change! Veuillez verifier votre nouvelle boite de reception pour la verification.",checkSpam:"Pas trouve? Verifiez votre dossier spam.",fillAllFields:"Veuillez remplir tous les champs"}};function ho({isOpen:t,onClose:o,onVerified:i}){const{language:N}=Ot(),{user:a,refreshUser:y}=ms(),b=en[N]||en.en,[c,D]=l.useState("verify"),[_,C]=l.useState(!1),[p,I]=l.useState(!1),[x,P]=l.useState(""),[F,W]=l.useState(""),[L,X]=l.useState(!1),[Q,ne]=l.useState(0),[B,ie]=l.useState(""),[te,K]=l.useState(""),$=l.useRef(null),Z=l.useRef(null),xe=l.useRef(!1);if(l.useEffect(()=>(Q>0&&(Z.current=setTimeout(()=>{ne(ge=>ge-1)},1e3)),()=>{Z.current&&clearTimeout(Z.current)}),[Q]),l.useEffect(()=>{if(t&&!xe.current&&!p){xe.current=!0;const ge=setTimeout(async()=>{C(!0);try{const Ne=await Ge.post("/api/auth/send-verification",{});I(!0),W(b.emailSent),Ne.cooldown&&ne(Ne.cooldown)}catch(Ne){const Se=Ne;Se.retryAfter?(ne(Se.retryAfter),I(!0)):P(Se.message||"Failed to send verification email")}finally{C(!1)}},300);return()=>clearTimeout(ge)}t||(xe.current=!1)},[t,p,b.emailSent]),l.useEffect(()=>{if(!t){$.current&&(clearInterval($.current),$.current=null);return}return X(!0),console.log("[EmailVerificationModal] Starting polling"),$.current=setInterval(async()=>{try{const ge=await Ge.get("/api/auth/verification-status");console.log("[EmailVerificationModal] Poll result:",ge.emailVerified),ge.emailVerified&&(console.log("[EmailVerificationModal] Email verified! Refreshing user..."),await y(),console.log("[EmailVerificationModal] User refreshed, clearing interval"),$.current&&(clearInterval($.current),$.current=null),X(!1),console.log("[EmailVerificationModal] Calling onVerified callback"),i==null||i(),console.log("[EmailVerificationModal] Calling onClose"),o())}catch(ge){console.debug("Verification status poll error:",ge)}},3e3),()=>{$.current&&(clearInterval($.current),$.current=null)}},[t,y,i,o]),!t)return null;const fe=async()=>{C(!0),P("");try{const ge=await Ge.post("/api/auth/send-verification",{});I(!0),W(b.emailSent),ge.cooldown&&ne(ge.cooldown)}catch(ge){const Ne=ge;Ne.retryAfter?(ne(Ne.retryAfter),P(N==="de"?`Bitte warten Sie ${Ne.retryAfter} Sekunden`:N==="fr"?`Veuillez patienter ${Ne.retryAfter} secondes`:`Please wait ${Ne.retryAfter} seconds`)):P(Ne.message||"Failed to send verification email")}finally{C(!1)}},me=async()=>{if(!B||!te){P(b.fillAllFields);return}C(!0),P("");try{await Ge.post("/api/auth/change-email",{newEmail:B,password:te}),W(b.emailChanged),D("verify"),ie(""),K("")}catch(ge){P(ge instanceof Error?ge.message:"Failed to change email")}finally{C(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-8 animate-fade-in relative",children:[e.jsx("button",{onClick:o,className:"absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:e.jsx(zt,{size:20})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(cn,{className:"w-8 h-8 text-indigo-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:b.title}),e.jsx("p",{className:"text-gray-500",children:b.description})]}),x&&e.jsx(Gs,{variant:"error",className:"mb-4",children:x}),F&&e.jsxs(Gs,{variant:"success",className:"mb-4",children:[F,e.jsx("p",{className:"text-sm mt-1 opacity-80",children:b.checkSpam})]}),L&&p&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-indigo-600 mb-4",children:[e.jsx(wt,{size:16,className:"animate-spin"}),e.jsx("span",{className:"text-sm",children:N==="de"?"Warte auf BestÃ¤tigung...":N==="fr"?"En attente de verification...":"Waiting for verification..."})]}),c==="verify"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:b.currentEmail}),e.jsx("p",{className:"font-medium text-gray-800",children:a==null?void 0:a.email})]}),e.jsxs(Aa,{onClick:fe,variant:"primary",loading:_,disabled:Q>0,className:"w-full",children:[e.jsx(Ht,{size:16,className:"mr-2"}),Q>0?`${N==="de"?"Warten":N==="fr"?"Patienter":"Wait"} ${Q}s`:p?b.resendVerification:b.sendVerification]}),e.jsxs("button",{onClick:()=>{D("change"),P(""),W("")},className:"w-full text-center text-indigo-600 font-semibold hover:text-indigo-800 flex items-center justify-center gap-2",children:[e.jsx(Xe,{size:16}),b.changeEmail]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ls,{type:"email",label:b.newEmail,value:B,onChange:ge=>ie(ge.target.value),placeholder:"your@newemail.com",disabled:_}),e.jsx(Ls,{type:"password",label:b.currentPassword,value:te,onChange:ge=>K(ge.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",disabled:_}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Aa,{onClick:()=>{D("verify"),P(""),ie(""),K("")},variant:"secondary",className:"flex-1",disabled:_,children:b.cancel}),e.jsx(Aa,{onClick:me,variant:"primary",loading:_,className:"flex-1",children:b.confirmChange})]})]})]})})}const us=[{value:{en:"Best Friends with",de:"Beste Freunde mit",fr:"Meilleurs amis avec"},inverse:{en:"Best Friends with",de:"Beste Freunde mit",fr:"Meilleurs amis avec"}},{value:{en:"Friends with",de:"Freunde mit",fr:"Amis avec"},inverse:{en:"Friends with",de:"Freunde mit",fr:"Amis avec"}},{value:{en:"Married to",de:"Verheiratet mit",fr:"MariÃ©(e) Ã "},inverse:{en:"Married to",de:"Verheiratet mit",fr:"MariÃ©(e) Ã "}},{value:{en:"In a relationship with",de:"In einer Beziehung mit",fr:"En relation avec"},inverse:{en:"In a relationship with",de:"In einer Beziehung mit",fr:"En relation avec"}},{value:{en:"Older Sibling of",de:"Ã„lteres Geschwister von",fr:"FrÃ¨re/SÅ“ur aÃ®nÃ©(e) de"},inverse:{en:"Younger Sibling of",de:"JÃ¼ngeres Geschwister von",fr:"FrÃ¨re/SÅ“ur cadet(te) de"}},{value:{en:"Younger Sibling of",de:"JÃ¼ngeres Geschwister von",fr:"FrÃ¨re/SÅ“ur cadet(te) de"},inverse:{en:"Older Sibling of",de:"Ã„lteres Geschwister von",fr:"FrÃ¨re/SÅ“ur aÃ®nÃ©(e) de"}},{value:{en:"Parent of",de:"Elternteil von",fr:"Parent de"},inverse:{en:"Child of",de:"Kind von",fr:"Enfant de"}},{value:{en:"Child of",de:"Kind von",fr:"Enfant de"},inverse:{en:"Parent of",de:"Elternteil von",fr:"Parent de"}},{value:{en:"Rivals with",de:"Rivalen mit",fr:"Rivaux avec"},inverse:{en:"Rivals with",de:"Rivalen mit",fr:"Rivaux avec"}},{value:{en:"Neighbors with",de:"Nachbarn mit",fr:"Voisins avec"},inverse:{en:"Neighbors with",de:"Nachbarn mit",fr:"Voisins avec"}},{value:{en:"Not Known to",de:"Nicht bekannt mit",fr:"Pas connu de"},inverse:{en:"Not Known to",de:"Nicht bekannt mit",fr:"Pas connu de"}}];function xo(t){const o=us.find(i=>i.value.en==="Not Known to");return o?o.value[t]:"Not Known to"}function tn(t){const o=us.find(i=>i.value.en==="Not Known to");return o?t===o.value.en||t===o.value.de||t===o.value.fr:!1}function po(t,o,i=[]){for(const N of us)if(N.value[o]===t)return N.inverse[o];for(const N of i){if(N.forward===t)return N.inverse;if(N.inverse===t)return N.forward}return t}const fo=1440*60*1e3;function Ta(t){const o=`avatar_regen_${t}`,i=localStorage.getItem(o),N=Date.now();if(!i)return{canRegenerate:!0,waitSeconds:0,attempts:0};try{const{attempts:a,lastAttempt:y}=JSON.parse(i);if(N-y>fo)return localStorage.removeItem(o),{canRegenerate:!0,waitSeconds:0,attempts:0};let b=0;a>=2&&a<4?b=30*1e3:a>=4&&a<6?b=60*1e3:a>=6&&a<8?b=120*1e3:a>=8&&a<10?b=300*1e3:a>=10&&(b=600*1e3);const c=N-y;return c>=b?{canRegenerate:!0,waitSeconds:0,attempts:a}:{canRegenerate:!1,waitSeconds:Math.ceil((b-c)/1e3),attempts:a}}catch{return{canRegenerate:!0,waitSeconds:0,attempts:0}}}function hn(t){const o=`avatar_regen_${t}`,i=localStorage.getItem(o),N=Date.now();let a=1;if(i)try{a=(JSON.parse(i).attempts||0)+1}catch{}localStorage.setItem(o,JSON.stringify({attempts:a,lastAttempt:N}))}function Ko(t){const[o,i]=l.useState(()=>Ta(t));l.useEffect(()=>{if(o.waitSeconds>0){const a=setInterval(()=>{i(Ta(t))},1e3);return()=>clearInterval(a)}},[o.waitSeconds,t]);const N=l.useCallback(()=>{hn(t),i(Ta(t))},[t]);return{...o,recordRegeneration:N}}const rn={en:{title:"Multiple Faces Detected",description:"We detected multiple people in your photo. Please select which face belongs to the character you want to create.",selectFace:"Select Face",uploadDifferent:"Upload Different Photo",confidence:"Confidence"},de:{title:"Mehrere Gesichter erkannt",description:"Wir haben mehrere Personen in Ihrem Foto erkannt. Bitte wÃ¤hlen Sie aus, welches Gesicht zu dem Charakter gehÃ¶rt, den Sie erstellen mÃ¶chten.",selectFace:"Gesicht auswÃ¤hlen",uploadDifferent:"Anderes Foto hochladen",confidence:"Konfidenz"},fr:{title:"Plusieurs visages dÃ©tectÃ©s",description:"Nous avons dÃ©tectÃ© plusieurs personnes sur votre photo. Veuillez sÃ©lectionner le visage du personnage que vous souhaitez crÃ©er.",selectFace:"SÃ©lectionner le visage",uploadDifferent:"TÃ©lÃ©charger une autre photo",confidence:"Confiance"}};function yo({isOpen:t,faces:o,onSelect:i,onUploadNew:N,developerMode:a=!1}){const{language:y}=Ot(),b=rn[y]||rn.en;return e.jsx(Ti,{isOpen:t,onClose:N,title:b.title,size:"lg",showCloseButton:!1,closeOnOverlayClick:!1,closeOnEscape:!1,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-gray-600 text-center",children:b.description}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:o.map((c,D)=>e.jsxs("button",{onClick:()=>i(c.id),className:`group relative bg-white border-2 border-gray-200 rounded-xl p-3
                hover:border-indigo-400 hover:shadow-lg transition-all duration-200
                focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2`,children:[e.jsx("div",{className:"aspect-square overflow-hidden rounded-lg mb-3",children:e.jsx("img",{draggable:!1,src:c.thumbnail,alt:`Face ${D+1}`,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"})}),e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"text-sm font-semibold text-indigo-600 group-hover:text-indigo-700",children:[b.selectFace," ",D+1]})}),a&&e.jsxs("div",{className:"absolute top-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded",children:[b.confidence,": ",Math.round(c.confidence*100),"%"]})]},c.id))}),e.jsx("div",{className:"pt-4 border-t border-gray-100",children:e.jsxs("button",{onClick:N,className:`w-full flex items-center justify-center gap-2 px-4 py-3
              bg-gray-100 text-gray-700 rounded-lg font-medium
              hover:bg-gray-200 transition-colors`,children:[e.jsx(_i,{size:20}),b.uploadDifferent]})})]})})}const Jo=[{id:"adventure",name:{en:"Adventure",de:"Abenteuer",fr:"Aventure"},description:{en:"Exciting journeys and heroic quests",de:"Spannende Reisen und heldenhafte Abenteuer",fr:"Voyages passionnants et quÃªtes hÃ©roÃ¯ques"},emoji:"ðŸ—¡ï¸"},{id:"life-challenge",name:{en:"Life Skills",de:"Lebensthemen",fr:"CompÃ©tences de vie"},description:{en:"Help overcome everyday challenges",de:"Hilfe bei alltÃ¤glichen Herausforderungen",fr:"Aide pour surmonter les dÃ©fis quotidiens"},emoji:"ðŸ’ª"},{id:"educational",name:{en:"Learning",de:"Lernen",fr:"Apprentissage"},description:{en:"Fun stories that teach something new",de:"Lustige Geschichten, die etwas Neues lehren",fr:"Histoires amusantes qui enseignent quelque chose de nouveau"},emoji:"ðŸ“š"},{id:"historical",name:{en:"History",de:"Geschichte",fr:"Histoire"},description:{en:"Experience real historical events",de:"Erlebe echte historische Ereignisse",fr:"Vivez de vrais Ã©vÃ©nements historiques"},emoji:"ðŸ›ï¸"},{id:"custom",name:{en:"Create Your Own",de:"Eigenes Thema",fr:"CrÃ©er le vÃ´tre"},description:{en:"Describe your own unique story idea",de:"Beschreibe deine eigene Geschichte",fr:"DÃ©cris ta propre idÃ©e d'histoire"},emoji:"âœ¨"}],bo=["pirate","knight","cowboy","ninja","wizard","dragon","superhero","detective","easter"],Qo=[{id:"popular",name:{en:"Popular",de:"Beliebt",fr:"Populaires"}},{id:"historical",name:{en:"Historical Times",de:"Historische Zeiten",fr:"Ã‰poques historiques"}},{id:"fantasy",name:{en:"Fantasy & Magic",de:"Fantasie & Magie",fr:"Fantaisie & Magie"}},{id:"locations",name:{en:"Exploration",de:"Entdeckung",fr:"Exploration"}},{id:"professions",name:{en:"Heroes & Helpers",de:"Helden & Helfer",fr:"HÃ©ros & Aides"}},{id:"seasonal",name:{en:"Seasonal",de:"Jahreszeiten",fr:"Saisonnier"}},{id:"custom",name:{en:"Custom",de:"Eigenes Thema",fr:"PersonnalisÃ©"}}],ds=[{id:"pirate",name:{en:"Pirate Adventure",de:"Piraten-Abenteuer",fr:"Aventure de Pirates"},emoji:"ðŸ´â€â˜ ï¸",group:"historical"},{id:"knight",name:{en:"Knights & Princess",de:"Ritter & Prinzessin",fr:"Chevaliers & Princesse"},emoji:"âš”ï¸",group:"historical"},{id:"cowboy",name:{en:"Cowboys & Indians",de:"Cowboys und Indianer",fr:"Cowboys et Indiens"},emoji:"ðŸ¤ ",group:"historical"},{id:"ninja",name:{en:"Secret Ninja",de:"Geheimer Ninja",fr:"Ninja Secret"},emoji:"ðŸ¥·",group:"historical"},{id:"viking",name:{en:"Viking Adventure",de:"Wikinger-Abenteuer",fr:"Aventure Viking"},emoji:"âš“",group:"historical"},{id:"roman",name:{en:"Ancient Rome",de:"Antikes Rom",fr:"Rome Antique"},emoji:"ðŸ›ï¸",group:"historical"},{id:"egyptian",name:{en:"Ancient Egypt",de:"Altes Ã„gypten",fr:"Ã‰gypte Ancienne"},emoji:"ðŸº",group:"historical"},{id:"greek",name:{en:"Ancient Greece",de:"Antikes Griechenland",fr:"GrÃ¨ce Antique"},emoji:"ðŸº",group:"historical"},{id:"caveman",name:{en:"Stone Age",de:"Steinzeit",fr:"Ã‚ge de Pierre"},emoji:"ðŸ¦´",group:"historical"},{id:"samurai",name:{en:"Samurai Adventure",de:"Samurai-Abenteuer",fr:"Aventure SamouraÃ¯"},emoji:"ðŸŽŒ",group:"historical"},{id:"wizard",name:{en:"Wizard & Witch",de:"Zauberer & Hexe",fr:"Sorcier & SorciÃ¨re"},emoji:"ðŸ§™",group:"fantasy"},{id:"dragon",name:{en:"Dragon Quest",de:"Drachen-Abenteuer",fr:"QuÃªte du Dragon"},emoji:"ðŸ‰",group:"fantasy"},{id:"unicorn",name:{en:"Magical Unicorn",de:"Magisches Einhorn",fr:"Licorne Magique"},emoji:"ðŸ¦„",group:"fantasy"},{id:"mermaid",name:{en:"Mermaid Adventure",de:"Meerjungfrauen-Abenteuer",fr:"Aventure de SirÃ¨ne"},emoji:"ðŸ§œâ€â™€ï¸",group:"fantasy"},{id:"dinosaur",name:{en:"Dinosaur World",de:"Dinosaurier-Welt",fr:"Monde des Dinosaures"},emoji:"ðŸ¦–",group:"fantasy"},{id:"superhero",name:{en:"Superhero",de:"Superheld",fr:"Super-hÃ©ros"},emoji:"ðŸ¦¸",group:"fantasy"},{id:"space",name:{en:"Space Explorer",de:"Weltraum-Entdecker",fr:"Explorateur Spatial"},emoji:"ðŸš€",group:"locations"},{id:"ocean",name:{en:"Ocean Explorer",de:"Ozean-Entdecker",fr:"Explorateur des OcÃ©ans"},emoji:"ðŸŒŠ",group:"locations"},{id:"jungle",name:{en:"Jungle Safari",de:"Dschungel-Safari",fr:"Safari dans la Jungle"},emoji:"ðŸŒ´",group:"locations"},{id:"farm",name:{en:"Farm Life",de:"Bauernhof-Leben",fr:"Vie Ã  la Ferme"},emoji:"ðŸ„",group:"locations"},{id:"forest",name:{en:"Forest Friends",de:"Waldfreunde",fr:"Amis de la ForÃªt"},emoji:"ðŸ¦Š",group:"locations"},{id:"fireman",name:{en:"Brave Firefighter",de:"Tapferer Feuerwehrmann",fr:"Pompier Courageux"},emoji:"ðŸš’",group:"professions"},{id:"doctor",name:{en:"Helpful Doctor",de:"Hilfreicher Arzt",fr:"Docteur Serviable"},emoji:"ðŸ‘¨â€âš•ï¸",group:"professions"},{id:"police",name:{en:"Police Officer",de:"Polizist",fr:"Policier"},emoji:"ðŸ‘®",group:"professions"},{id:"detective",name:{en:"Detective Mystery",de:"Detektiv-Geheimnis",fr:"MystÃ¨re DÃ©tective"},emoji:"ðŸ”",group:"professions"},{id:"christmas",name:{en:"Christmas Story",de:"Weihnachts-Geschichte",fr:"Histoire de NoÃ«l"},emoji:"ðŸŽ„",group:"seasonal"},{id:"newyear",name:{en:"New Year Story",de:"Neujahrs-Geschichte",fr:"Histoire du Nouvel An"},emoji:"ðŸŽ†",group:"seasonal"},{id:"easter",name:{en:"Easter Story",de:"Oster-Geschichte",fr:"Histoire de PÃ¢ques"},emoji:"ðŸ°",group:"seasonal"},{id:"halloween",name:{en:"Halloween Story",de:"Halloween-Geschichte",fr:"Histoire d'Halloween"},emoji:"ðŸŽƒ",group:"seasonal"},{id:"custom",name:{en:"Create Your Own",de:"Eigenes Thema",fr:"CrÃ©er le vÃ´tre"},emoji:"âœ¨",group:"custom"}],Zo={name:{en:"Everyday Life",de:"Alltag",fr:"Vie Quotidienne"},emoji:"ðŸ "},an=[{id:"potty-training",name:{en:"Potty Training",de:"TÃ¶pfchen-Training",fr:"Apprentissage du pot"},emoji:"ðŸš½",ageGroup:"toddler"},{id:"washing-hands",name:{en:"Washing Hands",de:"HÃ¤nde waschen",fr:"Se laver les mains"},emoji:"ðŸ§¼",ageGroup:"toddler"},{id:"brushing-teeth",name:{en:"Brushing Teeth",de:"ZÃ¤hne putzen",fr:"Se brosser les dents"},emoji:"ðŸª¥",ageGroup:"toddler"},{id:"eating-vegetables",name:{en:"Eating Vegetables",de:"GemÃ¼se essen",fr:"Manger des lÃ©gumes"},emoji:"ðŸ¥¦",ageGroup:"toddler"},{id:"going-to-bed",name:{en:"Going to Bed",de:"Ins Bett gehen",fr:"Aller au lit"},emoji:"ðŸ›ï¸",ageGroup:"toddler"},{id:"saying-goodbye",name:{en:"Saying Goodbye",de:"Abschied nehmen",fr:"Dire au revoir"},emoji:"ðŸ‘‹",ageGroup:"toddler"},{id:"no-pacifier",name:{en:"No More Pacifier",de:"Ohne Schnuller",fr:"Plus de tÃ©tine"},emoji:"ðŸ¼",ageGroup:"toddler"},{id:"cleaning-up",name:{en:"Cleaning Up Toys",de:"AufrÃ¤umen",fr:"Ranger les jouets"},emoji:"ðŸ§¹",ageGroup:"preschool"},{id:"sitting-still",name:{en:"Sitting Still",de:"Still sitzen",fr:"Rester tranquille"},emoji:"ðŸª‘",ageGroup:"preschool"},{id:"sharing",name:{en:"Learning to Share",de:"Teilen lernen",fr:"Apprendre Ã  partager"},emoji:"ðŸ¤",ageGroup:"preschool"},{id:"waiting-turn",name:{en:"Waiting Your Turn",de:"Warten kÃ¶nnen",fr:"Attendre son tour"},emoji:"â³",ageGroup:"preschool"},{id:"first-kindergarten",name:{en:"First Day of Kindergarten",de:"Erster Kindergartentag",fr:"Premier jour de maternelle"},emoji:"ðŸŽ’",ageGroup:"preschool"},{id:"making-friends",name:{en:"Making Friends",de:"Freunde finden",fr:"Se faire des amis"},emoji:"ðŸ‘«",ageGroup:"preschool"},{id:"being-brave",name:{en:"Being Brave",de:"Mutig sein",fr:"ÃŠtre courageux"},emoji:"ðŸ’ª",ageGroup:"preschool"},{id:"new-sibling",name:{en:"New Baby Sibling",de:"Neues Geschwisterchen",fr:"Nouveau bÃ©bÃ© dans la famille"},emoji:"ðŸ‘¶",ageGroup:"preschool"},{id:"first-school",name:{en:"First Day of School",de:"Erster Schultag",fr:"Premier jour d'Ã©cole"},emoji:"ðŸ«",ageGroup:"early-school"},{id:"homework",name:{en:"Doing Homework",de:"Hausaufgaben machen",fr:"Faire ses devoirs"},emoji:"ðŸ“",ageGroup:"early-school"},{id:"reading-alone",name:{en:"Learning to Read",de:"Lesen lernen",fr:"Apprendre Ã  lire"},emoji:"ðŸ“–",ageGroup:"early-school"},{id:"losing-game",name:{en:"Losing a Game",de:"Verlieren kÃ¶nnen",fr:"Savoir perdre"},emoji:"ðŸŽ¯",ageGroup:"early-school"},{id:"being-different",name:{en:"Being Different is OK",de:"Anders sein ist OK",fr:"ÃŠtre diffÃ©rent c'est bien"},emoji:"ðŸŒˆ",ageGroup:"early-school"},{id:"dealing-bully",name:{en:"Dealing with Bullies",de:"Mit HÃ¤nseleien umgehen",fr:"Faire face aux moqueries"},emoji:"ðŸ›¡ï¸",ageGroup:"early-school"},{id:"telling-truth",name:{en:"Telling the Truth",de:"Die Wahrheit sagen",fr:"Dire la vÃ©ritÃ©"},emoji:"âœ…",ageGroup:"early-school"},{id:"trying-new-things",name:{en:"Trying New Things",de:"Neues ausprobieren",fr:"Essayer de nouvelles choses"},emoji:"ðŸŒŸ",ageGroup:"early-school"},{id:"moving-house",name:{en:"Moving to a New Home",de:"Umzug",fr:"DÃ©mÃ©nagement"},emoji:"ðŸ ",ageGroup:"family"},{id:"going-vacation",name:{en:"Going on Vacation",de:"In den Urlaub fahren",fr:"Partir en vacances"},emoji:"âœˆï¸",ageGroup:"family"},{id:"parents-splitting",name:{en:"Parents Living Apart",de:"Eltern leben getrennt",fr:"Parents sÃ©parÃ©s"},emoji:"ðŸ’”",ageGroup:"family"},{id:"visiting-doctor",name:{en:"Going to the Doctor",de:"Arztbesuch",fr:"Visite chez le mÃ©decin"},emoji:"ðŸ¥",ageGroup:"family"},{id:"staying-hospital",name:{en:"Staying in Hospital",de:"Im Krankenhaus",fr:"SÃ©jour Ã  l'hÃ´pital"},emoji:"ðŸ©º",ageGroup:"family"},{id:"death-pet",name:{en:"Losing a Pet",de:"Haustier verlieren",fr:"Perte d'un animal"},emoji:"ðŸŒˆ",ageGroup:"family"},{id:"grandparent-sick",name:{en:"Grandparent is Sick",de:"Grosseltern sind krank",fr:"Grand-parent malade"},emoji:"â¤ï¸",ageGroup:"family"},{id:"money-saving",name:{en:"Saving Money",de:"Geld sparen",fr:"Ã‰conomiser de l'argent"},emoji:"ðŸ’°",ageGroup:"preteen"},{id:"spending-wisely",name:{en:"Spending Wisely",de:"Klug ausgeben",fr:"DÃ©penser intelligemment"},emoji:"ðŸ›’",ageGroup:"preteen"},{id:"screen-time",name:{en:"Screen Time Balance",de:"Bildschirmzeit-Balance",fr:"Ã‰quilibre du temps d'Ã©cran"},emoji:"ðŸ“±",ageGroup:"preteen"},{id:"peer-pressure",name:{en:"Peer Pressure",de:"Gruppenzwang",fr:"Pression des pairs"},emoji:"ðŸ‘¥",ageGroup:"preteen"},{id:"body-changes",name:{en:"Body Changes",de:"KÃ¶rperliche VerÃ¤nderungen",fr:"Changements corporels"},emoji:"ðŸŒ±",ageGroup:"preteen"},{id:"responsibility",name:{en:"Taking Responsibility",de:"Verantwortung Ã¼bernehmen",fr:"Prendre ses responsabilitÃ©s"},emoji:"ðŸŽ¯",ageGroup:"preteen"},{id:"managing-time",name:{en:"Managing Time",de:"Zeitmanagement",fr:"Gestion du temps"},emoji:"â°",ageGroup:"preteen"},{id:"online-safety",name:{en:"Online Safety",de:"Sicherheit im Internet",fr:"SÃ©curitÃ© en ligne"},emoji:"ðŸ”’",ageGroup:"preteen"}],vo=["going-to-bed","cleaning-up","first-kindergarten","first-school","losing-game","dealing-bully","telling-truth","spending-wisely","moving-house","screen-time"],Yo=[{id:"popular",name:{en:"Popular",de:"Beliebt",fr:"Populaires"},ageRange:"all"},{id:"family",name:{en:"Family Changes",de:"Familien-VerÃ¤nderungen",fr:"Changements familiaux"},ageRange:"all"},{id:"toddler",name:{en:"Toddler (2-4)",de:"Kleinkind (2-4)",fr:"Tout-petit (2-4)"},ageRange:"2-4"},{id:"preschool",name:{en:"Preschool (4-6)",de:"Vorschule (4-6)",fr:"PrÃ©scolaire (4-6)"},ageRange:"4-6"},{id:"early-school",name:{en:"Early School (6-9)",de:"Grundschule (6-9)",fr:"Ã‰cole primaire (6-9)"},ageRange:"6-9"},{id:"preteen",name:{en:"Pre-Teen (9-12)",de:"VorpubertÃ¤t (9-12)",fr:"PrÃ©adolescent (9-12)"},ageRange:"9-12"}],sn=[{id:"alphabet",name:{en:"The Alphabet (ABC)",de:"Das Alphabet (ABC)",fr:"L'Alphabet (ABC)"},emoji:"ðŸ”¤",group:"letters"},{id:"vowels",name:{en:"Vowels (A, E, I, O, U)",de:"Vokale (A, E, I, O, U)",fr:"Voyelles (A, E, I, O, U)"},emoji:"ðŸ…°ï¸",group:"letters"},{id:"rhyming",name:{en:"Rhyming Words",de:"ReimwÃ¶rter",fr:"Mots qui riment"},emoji:"ðŸŽµ",group:"letters"},{id:"numbers-1-10",name:{en:"Numbers 1-10",de:"Zahlen 1-10",fr:"Nombres 1-10"},emoji:"ðŸ”¢",group:"numbers"},{id:"numbers-1-20",name:{en:"Numbers 1-20",de:"Zahlen 1-20",fr:"Nombres 1-20"},emoji:"ðŸ”¢",group:"numbers"},{id:"counting",name:{en:"Learning to Count",de:"ZÃ¤hlen lernen",fr:"Apprendre Ã  compter"},emoji:"âœ‹",group:"numbers"},{id:"shapes",name:{en:"Shapes",de:"Formen",fr:"Formes"},emoji:"ðŸ”·",group:"numbers"},{id:"addition",name:{en:"Simple Addition",de:"Einfaches Addieren",fr:"Addition simple"},emoji:"âž•",group:"numbers"},{id:"colors-basic",name:{en:"Basic Colors",de:"Grundfarben",fr:"Couleurs de base"},emoji:"ðŸŒˆ",group:"colors"},{id:"colors-mixing",name:{en:"Mixing Colors",de:"Farben mischen",fr:"MÃ©langer les couleurs"},emoji:"ðŸŽ¨",group:"colors"},{id:"planets",name:{en:"Planets & Space",de:"Planeten & Weltraum",fr:"PlanÃ¨tes & Espace"},emoji:"ðŸª",group:"science"},{id:"seasons",name:{en:"The Four Seasons",de:"Die vier Jahreszeiten",fr:"Les quatre saisons"},emoji:"ðŸ‚",group:"science"},{id:"weather",name:{en:"Weather",de:"Wetter",fr:"MÃ©tÃ©o"},emoji:"â›…",group:"science"},{id:"water-cycle",name:{en:"Water Cycle",de:"Wasserkreislauf",fr:"Cycle de l'eau"},emoji:"ðŸ’§",group:"science"},{id:"plants-grow",name:{en:"How Plants Grow",de:"Wie Pflanzen wachsen",fr:"Comment poussent les plantes"},emoji:"ðŸŒ±",group:"science"},{id:"day-night",name:{en:"Day and Night",de:"Tag und Nacht",fr:"Jour et nuit"},emoji:"ðŸŒ™",group:"science"},{id:"farm-animals",name:{en:"Farm Animals",de:"Bauernhoftiere",fr:"Animaux de la ferme"},emoji:"ðŸ·",group:"animals"},{id:"wild-animals",name:{en:"Wild Animals",de:"Wilde Tiere",fr:"Animaux sauvages"},emoji:"ðŸ¦",group:"animals"},{id:"ocean-animals",name:{en:"Ocean Animals",de:"Meerestiere",fr:"Animaux marins"},emoji:"ðŸ‹",group:"animals"},{id:"insects",name:{en:"Insects & Bugs",de:"Insekten & KÃ¤fer",fr:"Insectes"},emoji:"ðŸ›",group:"animals"},{id:"dinosaurs",name:{en:"Dinosaurs",de:"Dinosaurier",fr:"Dinosaures"},emoji:"ðŸ¦•",group:"animals"},{id:"body-parts",name:{en:"Body Parts",de:"KÃ¶rperteile",fr:"Parties du corps"},emoji:"ðŸ«€",group:"body"},{id:"five-senses",name:{en:"The Five Senses",de:"Die fÃ¼nf Sinne",fr:"Les cinq sens"},emoji:"ðŸ‘ï¸",group:"body"},{id:"healthy-eating",name:{en:"Healthy Eating",de:"Gesund essen",fr:"Manger sainement"},emoji:"ðŸ¥—",group:"body"},{id:"days-week",name:{en:"Days of the Week",de:"Wochentage",fr:"Jours de la semaine"},emoji:"ðŸ“…",group:"time"},{id:"months-year",name:{en:"Months of the Year",de:"Monate des Jahres",fr:"Mois de l'annÃ©e"},emoji:"ðŸ—“ï¸",group:"time"},{id:"telling-time",name:{en:"Telling Time",de:"Uhr lesen",fr:"Lire l'heure"},emoji:"ðŸ•",group:"time"},{id:"continents",name:{en:"Continents",de:"Kontinente",fr:"Continents"},emoji:"ðŸŒ",group:"geography"},{id:"countries-flags",name:{en:"Countries & Flags",de:"LÃ¤nder & Flaggen",fr:"Pays & Drapeaux"},emoji:"ðŸ³ï¸",group:"geography"},{id:"instruments",name:{en:"Musical Instruments",de:"Musikinstrumente",fr:"Instruments de musique"},emoji:"ðŸŽ¸",group:"arts"},{id:"famous-artists",name:{en:"Famous Artists",de:"BerÃ¼hmte KÃ¼nstler",fr:"Artistes cÃ©lÃ¨bres"},emoji:"ðŸ–¼ï¸",group:"arts"}],jo=["alphabet","numbers-1-10","rhyming","seasons","weather","water-cycle","farm-animals","five-senses","days-week","months-year"],Xo=[{id:"popular",name:{en:"Popular",de:"Beliebt",fr:"Populaires"}},{id:"letters",name:{en:"Letters & Reading",de:"Buchstaben & Lesen",fr:"Lettres & Lecture"}},{id:"numbers",name:{en:"Numbers & Math",de:"Zahlen & Mathe",fr:"Nombres & Maths"}},{id:"colors",name:{en:"Colors",de:"Farben",fr:"Couleurs"}},{id:"science",name:{en:"Nature & Science",de:"Natur & Wissenschaft",fr:"Nature & Science"}},{id:"animals",name:{en:"Animals",de:"Tiere",fr:"Animaux"}},{id:"body",name:{en:"Body & Health",de:"KÃ¶rper & Gesundheit",fr:"Corps & SantÃ©"}},{id:"time",name:{en:"Time & Calendar",de:"Zeit & Kalender",fr:"Temps & Calendrier"}},{id:"geography",name:{en:"World & Geography",de:"Welt & Geografie",fr:"Monde & GÃ©ographie"}},{id:"arts",name:{en:"Music & Art",de:"Musik & Kunst",fr:"Musique & Art"}}],No=["wilhelm-tell","gotthard-tunnel","moon-landing","columbus-voyage","wright-brothers","lindbergh-flight","galapagos-darwin","berlin-wall-fall","golden-gate"],el=[{id:"popular",name:{en:"Popular",de:"Beliebt",fr:"Populaires"},icon:"â­"},{id:"swiss",name:{en:"Swiss History",de:"Schweizer Geschichte",fr:"Histoire Suisse"},icon:"ðŸ‡¨ðŸ‡­"},{id:"exploration",name:{en:"Exploration & Discovery",de:"Entdeckungen",fr:"Exploration & DÃ©couverte"},icon:"ðŸ§­"},{id:"science",name:{en:"Science & Medicine",de:"Wissenschaft & Medizin",fr:"Science & MÃ©decine"},icon:"ðŸ”¬"},{id:"invention",name:{en:"Inventions",de:"Erfindungen",fr:"Inventions"},icon:"ðŸ’¡"},{id:"rights",name:{en:"Human Rights & Freedom",de:"Menschenrechte & Freiheit",fr:"Droits humains & LibertÃ©"},icon:"âœŠ"},{id:"construction",name:{en:"Great Constructions",de:"Grosse Bauwerke",fr:"Grandes Constructions"},icon:"ðŸ—ï¸"},{id:"culture",name:{en:"Culture & Arts",de:"Kultur & Kunst",fr:"Culture & Arts"},icon:"ðŸŽ­"},{id:"archaeology",name:{en:"Archaeological Discoveries",de:"ArchÃ¤ologische Entdeckungen",fr:"DÃ©couvertes ArchÃ©ologiques"},icon:"ðŸº"}],nn=[{id:"swiss-founding",name:{en:"Founding of Switzerland (RÃ¼tlischwur)",de:"GrÃ¼ndung der Schweiz (RÃ¼tlischwur)",fr:"Fondation de la Suisse (Serment du GrÃ¼tli)"},shortName:{en:"RÃ¼tlischwur",de:"RÃ¼tlischwur",fr:"Serment du GrÃ¼tli"},emoji:"ðŸ¤",year:1291,category:"swiss"},{id:"wilhelm-tell",name:{en:"Wilhelm Tell and the Apple",de:"Wilhelm Tell und der Apfel",fr:"Guillaume Tell et la pomme"},shortName:{en:"Wilhelm Tell",de:"Wilhelm Tell",fr:"Guillaume Tell"},emoji:"ðŸ¹",year:1307,category:"swiss",mainPerson:"Wilhelm Tell"},{id:"battle-morgarten",name:{en:"Battle of Morgarten",de:"Schlacht am Morgarten",fr:"Bataille de Morgarten"},shortName:{en:"Morgarten",de:"Morgarten",fr:"Morgarten"},emoji:"âš”ï¸",year:1315,category:"swiss"},{id:"battle-sempach",name:{en:"Battle of Sempach (Winkelried)",de:"Schlacht bei Sempach (Winkelried)",fr:"Bataille de Sempach (Winkelried)"},shortName:{en:"Sempach",de:"Sempach",fr:"Sempach"},emoji:"ðŸ›¡ï¸",year:1386,category:"swiss",mainPerson:"Arnold von Winkelried"},{id:"swiss-reformation",name:{en:"Swiss Reformation (Zwingli)",de:"Schweizer Reformation (Zwingli)",fr:"RÃ©forme Suisse (Zwingli)"},shortName:{en:"Reformation",de:"Reformation",fr:"RÃ©forme"},emoji:"ðŸ“œ",year:1523,category:"swiss",mainPerson:"Huldrych Zwingli"},{id:"red-cross-founding",name:{en:"Henry Dunant Founds the Red Cross",de:"Henry Dunant grÃ¼ndet das Rote Kreuz",fr:"Henry Dunant fonde la Croix-Rouge"},shortName:{en:"Red Cross",de:"Rotes Kreuz",fr:"Croix-Rouge"},emoji:"â¤ï¸",year:1863,category:"swiss",mainPerson:"Henry Dunant"},{id:"general-dufour",name:{en:"General Dufour and Swiss Unity",de:"General Dufour und die Schweizer Einheit",fr:"GÃ©nÃ©ral Dufour et l'unitÃ© suisse"},shortName:{en:"General Dufour",de:"General Dufour",fr:"GÃ©nÃ©ral Dufour"},emoji:"ðŸŽ–ï¸",year:1847,category:"swiss",mainPerson:"Guillaume-Henri Dufour"},{id:"sonderbund-war",name:{en:"The Sonderbund War",de:"Der Sonderbundskrieg",fr:"La Guerre du Sonderbund"},shortName:{en:"Sonderbund",de:"Sonderbund",fr:"Sonderbund"},emoji:"ðŸ”ï¸",year:1847,category:"swiss"},{id:"swiss-constitution",name:{en:"Swiss Federal Constitution",de:"Schweizerische Bundesverfassung",fr:"Constitution fÃ©dÃ©rale suisse"},shortName:{en:"Constitution",de:"Bundesverfassung",fr:"Constitution"},emoji:"ðŸ“‹",year:1848,category:"swiss"},{id:"gotthard-tunnel",name:{en:"Building the Gotthard Tunnel",de:"Bau des Gotthardtunnels",fr:"Construction du tunnel du Gothard"},shortName:{en:"Gotthard Tunnel",de:"Gotthardtunnel Bau",fr:"Tunnel du Gothard"},emoji:"ðŸš‚",year:1882,category:"swiss"},{id:"swiss-ww1-neutrality",name:{en:"Swiss Neutrality in WWI",de:"Schweizer NeutralitÃ¤t im 1. Weltkrieg",fr:"NeutralitÃ© suisse pendant la PremiÃ¨re Guerre"},shortName:{en:"WWI Neutrality",de:"NeutralitÃ¤t 1. WK",fr:"NeutralitÃ© 1GM"},emoji:"ðŸ•Šï¸",year:1914,category:"swiss"},{id:"general-guisan",name:{en:"General Guisan and the RÃ¼tli Report",de:"General Guisan und der RÃ¼tlirapport",fr:"GÃ©nÃ©ral Guisan et le Rapport du GrÃ¼tli"},shortName:{en:"General Guisan",de:"General Guisan",fr:"GÃ©nÃ©ral Guisan"},emoji:"ðŸŽ–ï¸",year:1940,category:"swiss",mainPerson:"Henri Guisan"},{id:"swiss-ww2-neutrality",name:{en:"Switzerland in World War II",de:"Die Schweiz im 2. Weltkrieg",fr:"La Suisse pendant la Seconde Guerre"},shortName:{en:"WWII",de:"2. Weltkrieg",fr:"2Ã¨me GM"},emoji:"ðŸ”ï¸",year:1939,category:"swiss"},{id:"swiss-womens-vote",name:{en:"Swiss Women Win the Vote",de:"Schweizer Frauenstimmrecht",fr:"Droit de vote des femmes suisses"},shortName:{en:"Women's Vote",de:"Frauenstimmrecht",fr:"Vote des femmes"},emoji:"ðŸ—³ï¸",year:1971,category:"swiss"},{id:"moon-landing",name:{en:"First Moon Landing",de:"Erste Mondlandung",fr:"Premier pas sur la Lune"},shortName:{en:"Moon Landing",de:"Mondlandung",fr:"Alunissage"},emoji:"ðŸŒ™",year:1969,category:"exploration",mainPerson:"Neil Armstrong"},{id:"columbus-voyage",name:{en:"Columbus Reaches the Americas",de:"Kolumbus erreicht Amerika",fr:"Colomb atteint les AmÃ©riques"},shortName:{en:"Discovery of America",de:"Entdeckung Amerikas",fr:"DÃ©couverte de l'AmÃ©rique"},emoji:"â›µ",year:1492,category:"exploration",mainPerson:"Christopher Columbus"},{id:"wright-brothers",name:{en:"First Powered Flight",de:"Erster Motorflug",fr:"Premier vol motorisÃ©"},shortName:{en:"First Flight",de:"Erster Flug",fr:"Premier vol"},emoji:"âœˆï¸",year:1903,category:"exploration",mainPerson:"Wright Brothers"},{id:"lindbergh-flight",name:{en:"First Solo Atlantic Crossing",de:"Erster Atlantik-Soloflug",fr:"PremiÃ¨re traversÃ©e solitaire"},shortName:{en:"Atlantic Flight",de:"Atlantikflug",fr:"Vol Atlantique"},emoji:"ðŸ›©ï¸",year:1927,category:"exploration",mainPerson:"Charles Lindbergh"},{id:"everest-summit",name:{en:"First Everest Summit",de:"Erste Everest-Besteigung",fr:"Premier sommet de l'Everest"},shortName:{en:"Climbing Everest",de:"Everest-Besteigung",fr:"Ascension Everest"},emoji:"ðŸ”ï¸",year:1953,category:"exploration",mainPerson:"Edmund Hillary & Tenzing Norgay"},{id:"south-pole",name:{en:"First to the South Pole",de:"Erster am SÃ¼dpol",fr:"Premier au PÃ´le Sud"},shortName:{en:"South Pole",de:"SÃ¼dpol",fr:"PÃ´le Sud"},emoji:"â„ï¸",year:1911,category:"exploration",mainPerson:"Roald Amundsen"},{id:"magellan-circumnavigation",name:{en:"First Circumnavigation",de:"Erste Weltumsegelung",fr:"Premier tour du monde"},shortName:{en:"Around the World",de:"Weltumsegelung",fr:"Tour du monde"},emoji:"ðŸŒ",year:1522,category:"exploration",mainPerson:"Ferdinand Magellan"},{id:"mariana-trench",name:{en:"Deepest Ocean Dive",de:"Tiefster Meerstauchgang",fr:"PlongÃ©e la plus profonde"},shortName:{en:"Deep Sea Dive",de:"Tiefseetauchen",fr:"PlongÃ©e profonde"},emoji:"ðŸŒŠ",year:1960,category:"exploration",mainPerson:"Jacques Piccard"},{id:"electricity-discovery",name:{en:"Franklin's Kite Experiment",de:"Franklins Drachenexperiment",fr:"ExpÃ©rience du cerf-volant"},shortName:{en:"Electricity Discovery",de:"ElektrizitÃ¤t entdeckt",fr:"DÃ©couverte Ã©lectricitÃ©"},emoji:"âš¡",year:1752,category:"science",mainPerson:"Benjamin Franklin"},{id:"penicillin",name:{en:"Discovery of Penicillin",de:"Entdeckung des Penicillins",fr:"DÃ©couverte de la pÃ©nicilline"},shortName:{en:"Penicillin",de:"Penicillin",fr:"PÃ©nicilline"},emoji:"ðŸ’Š",year:1928,category:"science",mainPerson:"Alexander Fleming"},{id:"vaccine-discovery",name:{en:"First Vaccine",de:"Erste Impfung",fr:"Premier vaccin"},shortName:{en:"First Vaccine",de:"Erste Impfung",fr:"Premier vaccin"},emoji:"ðŸ’‰",year:1796,category:"science",mainPerson:"Edward Jenner"},{id:"dna-discovery",name:{en:"DNA Structure Discovered",de:"DNA-Struktur entdeckt",fr:"Structure ADN dÃ©couverte"},shortName:{en:"DNA Discovery",de:"DNA-Entdeckung",fr:"DÃ©couverte ADN"},emoji:"ðŸ§¬",year:1953,category:"science",mainPerson:"Watson & Crick"},{id:"dinosaur-discovery",name:{en:"First Dinosaur Named",de:"Erster Dinosaurier benannt",fr:"Premier dinosaure nommÃ©"},shortName:{en:"Dinosaur Discovery",de:"Dinosaurier-Entdeckung",fr:"DÃ©couverte dinosaure"},emoji:"ðŸ¦•",year:1824,category:"science",mainPerson:"William Buckland"},{id:"einstein-relativity",name:{en:"Einstein's Relativity",de:"Einsteins RelativitÃ¤tstheorie",fr:"RelativitÃ© d'Einstein"},shortName:{en:"Einstein's Theory",de:"Einsteins Theorie",fr:"ThÃ©orie d'Einstein"},emoji:"ðŸ§ ",year:1905,category:"science",mainPerson:"Albert Einstein"},{id:"galapagos-darwin",name:{en:"Darwin Visits GalÃ¡pagos",de:"Darwin auf GalÃ¡pagos",fr:"Darwin aux GalÃ¡pagos"},shortName:{en:"Darwin's Voyage",de:"Darwins Reise",fr:"Voyage de Darwin"},emoji:"ðŸ¢",year:1835,category:"science",mainPerson:"Charles Darwin"},{id:"first-heart-transplant",name:{en:"First Heart Transplant",de:"Erste Herztransplantation",fr:"PremiÃ¨re greffe cardiaque"},shortName:{en:"Heart Transplant",de:"Herztransplantation",fr:"Greffe cardiaque"},emoji:"â¤ï¸",year:1967,category:"science",mainPerson:"Christiaan Barnard"},{id:"human-genome",name:{en:"Human Genome Decoded",de:"Menschliches Genom entschlÃ¼sselt",fr:"GÃ©nome humain dÃ©codÃ©"},shortName:{en:"Genome Project",de:"Genom-Projekt",fr:"Projet GÃ©nome"},emoji:"ðŸ§ª",year:2003,category:"science"},{id:"hubble-launch",name:{en:"Hubble Telescope Launch",de:"Hubble-Teleskop Start",fr:"Lancement tÃ©lescope Hubble"},shortName:{en:"Hubble Telescope",de:"Hubble-Teleskop",fr:"TÃ©lescope Hubble"},emoji:"ðŸ”­",year:1990,category:"science"},{id:"telephone-invention",name:{en:"First Telephone Call",de:"Erster Telefonanruf",fr:"Premier appel tÃ©lÃ©phonique"},shortName:{en:"Telephone",de:"Telefon",fr:"TÃ©lÃ©phone"},emoji:"ðŸ“ž",year:1876,category:"invention",mainPerson:"Alexander Graham Bell"},{id:"light-bulb",name:{en:"Edison's Light Bulb",de:"Edisons GlÃ¼hbirne",fr:"Ampoule d'Edison"},shortName:{en:"Light Bulb",de:"GlÃ¼hbirne",fr:"Ampoule"},emoji:"ðŸ’¡",year:1879,category:"invention",mainPerson:"Thomas Edison"},{id:"printing-press",name:{en:"Gutenberg's Printing Press",de:"Gutenbergs Buchdruck",fr:"Presse de Gutenberg"},shortName:{en:"Printing Press",de:"Buchdruck",fr:"Imprimerie"},emoji:"ðŸ“–",year:1440,category:"invention",mainPerson:"Johannes Gutenberg"},{id:"internet-creation",name:{en:"Birth of the World Wide Web",de:"Geburt des World Wide Web",fr:"Naissance du Web"},shortName:{en:"The Web",de:"Das Internet",fr:"Le Web"},emoji:"ðŸŒ",year:1991,category:"invention",mainPerson:"Tim Berners-Lee"},{id:"emancipation",name:{en:"Abolition of Slavery",de:"Abschaffung der Sklaverei",fr:"Abolition de l'esclavage"},shortName:{en:"End of Slavery",de:"Ende der Sklaverei",fr:"Fin de l'esclavage"},emoji:"â›“ï¸",year:1865,category:"rights",mainPerson:"Abraham Lincoln"},{id:"womens-suffrage",name:{en:"Women Win the Vote",de:"Frauenwahlrecht",fr:"Droit de vote des femmes"},shortName:{en:"Women's Vote",de:"Frauenwahlrecht",fr:"Vote des femmes"},emoji:"ðŸ—³ï¸",year:1920,category:"rights"},{id:"rosa-parks",name:{en:"Rosa Parks & Bus Boycott",de:"Rosa Parks & Busboykott",fr:"Rosa Parks & Boycott des bus"},shortName:{en:"Rosa Parks",de:"Rosa Parks",fr:"Rosa Parks"},emoji:"ðŸšŒ",year:1955,category:"rights",mainPerson:"Rosa Parks"},{id:"berlin-wall-fall",name:{en:"Fall of the Berlin Wall",de:"Fall der Berliner Mauer",fr:"Chute du mur de Berlin"},shortName:{en:"Berlin Wall Fall",de:"Fall der Berliner Mauer",fr:"Chute du Mur de Berlin"},emoji:"ðŸ§±",year:1989,category:"rights"},{id:"mandela-freedom",name:{en:"Mandela Released",de:"Mandela befreit",fr:"Mandela libÃ©rÃ©"},shortName:{en:"Mandela Free",de:"Mandela frei",fr:"Mandela libre"},emoji:"âœŠ",year:1990,category:"rights",mainPerson:"Nelson Mandela"},{id:"pyramids",name:{en:"Building the Great Pyramids",de:"Bau der Pyramiden",fr:"Construction des Pyramides"},shortName:{en:"The Pyramids",de:"Die Pyramiden",fr:"Les Pyramides"},emoji:"ðŸ”º",year:"-2560",category:"construction"},{id:"eiffel-tower",name:{en:"Eiffel Tower Opens",de:"Eiffelturm erÃ¶ffnet",fr:"Tour Eiffel inaugurÃ©e"},shortName:{en:"Eiffel Tower",de:"Eiffelturm",fr:"Tour Eiffel"},emoji:"ðŸ—¼",year:1889,category:"construction",mainPerson:"Gustave Eiffel"},{id:"panama-canal",name:{en:"Panama Canal Opens",de:"Panamakanal erÃ¶ffnet",fr:"Canal de Panama inaugurÃ©"},shortName:{en:"Panama Canal",de:"Panamakanal",fr:"Canal de Panama"},emoji:"ðŸš¢",year:1914,category:"construction"},{id:"golden-gate",name:{en:"Building the Golden Gate Bridge",de:"Bau der Golden Gate Bridge",fr:"Construction du pont Golden Gate"},shortName:{en:"Golden Gate Bridge",de:"Bau der Golden Gate Bridge",fr:"Pont Golden Gate"},emoji:"ðŸŒ‰",year:1937,category:"construction"},{id:"channel-tunnel",name:{en:"Channel Tunnel Opens",de:"Eurotunnel erÃ¶ffnet",fr:"Tunnel sous la Manche"},shortName:{en:"Chunnel",de:"Eurotunnel",fr:"Eurotunnel"},emoji:"ðŸš‡",year:1994,category:"construction"},{id:"first-olympics",name:{en:"First Modern Olympics",de:"Erste moderne Olympiade",fr:"Premiers Jeux Olympiques modernes"},shortName:{en:"Modern Olympics",de:"Moderne Olympiade",fr:"Jeux modernes"},emoji:"ðŸ…",year:1896,category:"culture"},{id:"disneyland-opening",name:{en:"Disneyland Opens",de:"Disneyland erÃ¶ffnet",fr:"Disneyland ouvre"},shortName:{en:"Disneyland",de:"Disneyland",fr:"Disneyland"},emoji:"ðŸ°",year:1955,category:"culture",mainPerson:"Walt Disney"},{id:"first-movie",name:{en:"Birth of Cinema",de:"Geburt des Kinos",fr:"Naissance du cinÃ©ma"},shortName:{en:"First Movies",de:"Erste Filme",fr:"Premiers films"},emoji:"ðŸŽ¬",year:1895,category:"culture",mainPerson:"LumiÃ¨re Brothers"},{id:"first-zoo",name:{en:"First Modern Zoo Opens",de:"Erster moderner Zoo",fr:"Premier zoo moderne"},shortName:{en:"London Zoo",de:"London Zoo",fr:"Zoo de Londres"},emoji:"ðŸ¦",year:1828,category:"culture"},{id:"natural-history-museum",name:{en:"Natural History Museum Opens",de:"Naturhistorisches Museum",fr:"MusÃ©e d'Histoire Naturelle"},shortName:{en:"Natural History Museum",de:"Naturkundemuseum",fr:"MusÃ©e Histoire Naturelle"},emoji:"ðŸ›ï¸",year:1881,category:"culture"},{id:"king-tut",name:{en:"King Tut's Tomb Discovered",de:"Tutanchamuns Grab entdeckt",fr:"Tombeau de ToutÃ¢nkhamon"},shortName:{en:"King Tut",de:"Tutanchamun",fr:"ToutÃ¢nkhamon"},emoji:"ðŸ‘‘",year:1922,category:"archaeology",mainPerson:"Howard Carter"},{id:"pompeii-discovery",name:{en:"Rediscovery of Pompeii",de:"Wiederentdeckung von Pompeji",fr:"RedÃ©couverte de PompÃ©i"},shortName:{en:"Pompeii",de:"Pompeji",fr:"PompÃ©i"},emoji:"ðŸŒ‹",year:1748,category:"archaeology"},{id:"terracotta-army",name:{en:"Terracotta Army Discovered",de:"Terrakotta-Armee entdeckt",fr:"ArmÃ©e de terre cuite"},shortName:{en:"Terracotta Army",de:"Terrakotta-Armee",fr:"ArmÃ©e terre cuite"},emoji:"ðŸ—¿",year:1974,category:"archaeology"}];function tl(t){return t==="popular"?ds.filter(o=>bo.includes(o.id)):ds.filter(o=>o.group===t)}function rl(t){return t==="popular"?an.filter(o=>vo.includes(o.id)):an.filter(o=>o.ageGroup===t)}function al(t){return t==="popular"?sn.filter(o=>jo.includes(o.id)):sn.filter(o=>o.group===t)}function sl(t){return t==="popular"?nn.filter(o=>No.includes(o.id)):nn.filter(o=>o.category===t)}const wo={ideaModel:null,outlineModel:null,textModel:null,sceneDescriptionModel:null,imageModel:null,coverImageModel:null,qualityModel:null,imageBackend:null,avatarModel:null},ra={enableAutoRepair:!1,enableFinalChecks:!0,incrementalConsistency:!1,incrementalConsistencyDryRun:!0,checkOnlyMode:!1};function So(){const t=localStorage.getItem("developer_mode")==="true",[o,i]=l.useState(t),[N,a]=l.useState(null),[y,b]=l.useState("auto"),[c,D]=l.useState(!1),[_,C]=l.useState(!1),[p,I]=l.useState(!1),[x,P]=l.useState(!1),[F,W]=l.useState(t),[L,X]=l.useState(ra.enableAutoRepair),[Q,ne]=l.useState(ra.enableFinalChecks),[B,ie]=l.useState(ra.incrementalConsistency),[te,K]=l.useState(ra.incrementalConsistencyDryRun),[$,Z]=l.useState(ra.checkOnlyMode),[xe,fe]=l.useState(!1),[me,ge]=l.useState({...wo}),Ne=Se=>{i(Se),W(!!Se)};return l.useEffect(()=>{o?localStorage.setItem("developer_mode","true"):localStorage.removeItem("developer_mode")},[o]),{developerMode:o,setDeveloperMode:Ne,imageGenMode:N,setImageGenMode:a,generationMode:y,setGenerationMode:b,devSkipOutline:c,setDevSkipOutline:D,devSkipText:_,setDevSkipText:C,devSkipSceneDescriptions:p,setDevSkipSceneDescriptions:I,devSkipImages:x,setDevSkipImages:P,devSkipCovers:F,setDevSkipCovers:W,enableAutoRepair:L,setEnableAutoRepair:X,enableFinalChecks:Q,setEnableFinalChecks:ne,incrementalConsistency:B,setIncrementalConsistency:ie,incrementalConsistencyDryRun:te,setIncrementalConsistencyDryRun:K,checkOnlyMode:$,setCheckOnlyMode:Z,loadAllAvatars:xe,setLoadAllAvatars:fe,modelSelections:me,setModelSelections:ge}}const Co=l.lazy(()=>sa(()=>import("./WizardStep2Characters-BZ_CM3Xz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(t=>({default:t.WizardStep2Characters}))),ko=l.lazy(()=>sa(()=>Promise.resolve().then(()=>go),void 0).then(t=>({default:t.WizardStep3BookSettings}))),Ao=l.lazy(()=>sa(()=>import("./WizardStep4StoryType-O9qFiFUn.js"),__vite__mapDeps([24,1,2,3,4,7,12,13,5,6,8,18,19,14,20,21,9,22,23,15])).then(t=>({default:t.WizardStep4StoryType}))),Po=l.lazy(()=>sa(()=>import("./WizardStep5ArtStyle-BrbJr2Vd.js"),__vite__mapDeps([25,1,2,3,4,26,20])).then(t=>({default:t.WizardStep5ArtStyle}))),To=l.lazy(()=>sa(()=>import("./WizardStep6Summary-D17L5noW.js"),__vite__mapDeps([27,1,2,3,4,26,17,9,7,5,6,8,18,19,12,13,14,20,21,22,23,15])).then(t=>({default:t.WizardStep6Summary}))),u=cs("StoryWizard"),on={en:{1:"Add photos of your characters - they'll appear consistently throughout your story!",2:"Set the book length and reading level for your audience",3:"Choose a story type and theme",4:"Pick an illustration style for your book",5:"Review your choices, add plot details, then generate your story!"},de:{1:"FÃ¼ge Fotos deiner Charaktere hinzu - sie erscheinen einheitlich in der gesamten Geschichte!",2:"Lege die BuchlÃ¤nge und das Leseniveau fÃ¼r dein Publikum fest",3:"WÃ¤hle einen Geschichtstyp und ein Thema",4:"WÃ¤hle einen Illustrationsstil fÃ¼r dein Buch",5:"ÃœberprÃ¼fe deine Auswahl, fÃ¼ge Handlungsdetails hinzu und generiere deine Geschichte!"},fr:{1:"Ajoutez des photos de vos personnages - ils apparaÃ®tront de maniÃ¨re cohÃ©rente dans toute votre histoire!",2:"DÃ©finissez la longueur du livre et le niveau de lecture pour votre public",3:"Choisissez un type d'histoire et un thÃ¨me",4:"Choisissez un style d'illustration pour votre livre",5:"VÃ©rifiez vos choix, ajoutez des dÃ©tails de l'intrigue, puis gÃ©nÃ©rez votre histoire!"}};function $o(){const t=ji(),[o,i]=Ni(),{t:N,language:a}=Ot(),{isAuthenticated:y,user:b,updateCredits:c,refreshUser:D,isLoading:_,isImpersonating:C}=ms(),{showSuccess:p,showInfo:I,showError:x}=bi(),{startTracking:P,stopTracking:F,activeJob:W,isComplete:L,completedStoryId:X,markCompletionViewed:Q,hasUnviewedCompletion:ne}=vi(),[B,ie]=l.useState(()=>{const n=new URLSearchParams(window.location.search);if(n.get("storyId"))return 6;if(n.get("new")==="true")return 1;const g=localStorage.getItem("wizard_step");return g?parseInt(g,10):1}),[te,K]=l.useState(()=>!!new URLSearchParams(window.location.search).get("storyId")),[$,Z]=l.useState(null),{developerMode:xe,setDeveloperMode:fe,imageGenMode:me,setImageGenMode:ge,generationMode:Ne,setGenerationMode:Se,devSkipOutline:re,setDevSkipOutline:$e,devSkipText:it,setDevSkipText:Ae,devSkipSceneDescriptions:qe,setDevSkipSceneDescriptions:de,devSkipImages:se,setDevSkipImages:M,devSkipCovers:Fe,setDevSkipCovers:Ue,enableAutoRepair:_e,setEnableAutoRepair:Tt,enableFinalChecks:$t,setEnableFinalChecks:lt,incrementalConsistency:Nr,setIncrementalConsistency:na,incrementalConsistencyDryRun:Rr,setIncrementalConsistencyDryRun:Ia,checkOnlyMode:s,setCheckOnlyMode:Pe,loadAllAvatars:We,setLoadAllAvatars:he,modelSelections:et,setModelSelections:xt}=So(),[tt,dt]=l.useState(()=>localStorage.getItem("story_type")||""),[be,Qt]=l.useState(()=>localStorage.getItem("story_category")||""),[Re,_t]=l.useState(()=>localStorage.getItem("story_topic")||""),[Be,dr]=l.useState(()=>localStorage.getItem("story_theme")||""),[St,Zt]=l.useState(()=>localStorage.getItem("story_custom_theme_text")||""),[ot,Wt]=l.useState(()=>localStorage.getItem("story_art_style")||"watercolor"),[ue,we]=l.useState([]),[wr,rt]=l.useState(null),[v,Ce]=l.useState(null),Ct=l.useRef([]),Sr=l.useRef(null),[pt,Yt]=l.useState(!1),[Vt,at]=l.useState("photo"),[Br,Je]=l.useState(!1),[qt,ct]=l.useState(null),[Xt,cr]=l.useState(!1),[Da,mr]=l.useState(!1),[Ea,Mr]=l.useState(void 0),[ia,Ut]=l.useState(void 0),za=l.useRef(null),[Fa,Lr]=l.useState(!1),[Gr,Hr]=l.useState([]),[er,Or]=l.useState(null),[tr,rr]=l.useState(null),[Qe,_r]=l.useState({}),[Ft,Rt]=l.useState({}),[ft,ur]=l.useState([]),oa=l.useRef(null),la=l.useRef(!1),ar=l.useRef(!1),[It,Cr]=l.useState(!1),[yt,mt]=l.useState([]),[Ze,Bt]=l.useState([]),gr=l.useRef(!1),[bt,hr]=l.useState(()=>{try{return localStorage.getItem("story_language_level")||"standard"}catch{return"standard"}}),[vt,Wr]=l.useState(()=>{try{const n=localStorage.getItem("story_language");if(n){if(n==="de")return"de-ch";if(n==="fr")return"fr-ch";if(n==="it")return"it-ch";if(n==="en")return"en-gb";if(n.startsWith("de")||n.startsWith("fr")||n.startsWith("it")||n.startsWith("en")||n.startsWith("gsw"))return n}return"de-ch"}catch{return"de-ch"}}),[r,S]=l.useState(()=>{try{const n=localStorage.getItem("story_pages");return n?parseInt(n):30}catch{return 30}}),[f,G]=l.useState(()=>localStorage.getItem("story_dedication")||""),[m,Y]=l.useState(()=>localStorage.getItem("story_details")||""),[pe,st]=l.useState(!1),[jt,ut]=l.useState(!1),[Mt,kt]=l.useState(!1),[le,gt]=l.useState(0),[da,kr]=l.useState(0),[xr,Ra]=l.useState(null),[xn,Ba]=l.useState(""),[sr,Ar]=l.useState([]),[pn,gs]=l.useState(null),[hs,fn]=l.useState(null),pr=l.useRef(null),[fr,xs]=l.useState(null),[yr,yn]=l.useState(()=>gn()),[nr,Pr]=l.useState(!1),[bn,ps]=l.useState(new Set),[vn,fs]=l.useState(!1),[jn,ca]=l.useState(!1),[Nn,Ma]=l.useState(!1),[wn,La]=l.useState(!1),[Sn,ys]=l.useState(!1),[Cn,ma]=l.useState(!1),[Ga,br]=l.useState({current:0,total:0,message:""}),[Lt,Vr]=l.useState(null),[kn,Tr]=l.useState(!1),[Ha,ir]=l.useState(""),[$r,qr]=l.useState(""),[An,bs]=l.useState(""),[Pn,vs]=l.useState(""),[Tn,js]=l.useState(""),[$n,Ns]=l.useState(),[In,ws]=l.useState(),[Dn,Ss]=l.useState([]),[En,Ur]=l.useState(null),[zn,ua]=l.useState(null),[Fn,Oa]=l.useState([]),[Rn,_a]=l.useState([]),[Bn,Wa]=l.useState([]),[Mn,Cs]=l.useState(null),[Ln,ga]=l.useState([]),[Va,Dt]=l.useState([]),[Kr,Gt]=l.useState({frontCover:null,initialPage:null,backCover:null}),[ke,qa]=l.useState(null),[Ua,ha]=l.useState(null),[Gn,ks]=l.useState(!1),[Hn,As]=l.useState(),[On,Ps]=l.useState(),[_n,Ts]=l.useState(),[Wn,Ka]=l.useState(null),Ja=l.useRef(!1),[Nt,xa]=l.useState(null),[Qa,pa]=l.useState({}),[Vn,fa]=l.useState(!1),[Ve,ya]=l.useState(null),[Jr,Qr]=l.useState("");l.useEffect(()=>{Ct.current=ue},[ue]),l.useEffect(()=>{Sr.current=v},[v]),l.useEffect(()=>{if(!_&&!y){if(!!localStorage.getItem("auth_token")){u.debug("Token found but not authenticated yet, waiting for state sync...");return}const g=window.location.pathname+window.location.search,d=encodeURIComponent(g);t(`/?login=true&redirect=${d}`)}},[y,_,t]),l.useEffect(()=>{He.getUserLocation().then(n=>{xs(n),n!=null&&n.city&&He.triggerLandmarkDiscovery(n.city,n.country)})},[]),l.useEffect(()=>{y&&He.getStories({limit:1}).then(({pagination:n})=>{ys(n.total>0)}).catch(()=>ys(!1))},[y]);const Za=l.useRef(null);l.useEffect(()=>{const n=o.get("storyId");o.get("new")!=="true"&&(n&&(Za.current=null),W&&!n&&Za.current!==W.jobId&&(u.info("Returning during active generation, restoring progress for job:",W.jobId),Za.current=W.jobId,ie(6),Pr(!0),ir(W.storyTitle),ha(W.jobId),He.getJobStatus(W.jobId).then(d=>{var k,h;if(u.info("Restored job status:",{progress:d.progress,hasStoryText:!!d.storyText,storyTextKeys:d.storyText?Object.keys(d.storyText):[],pageTextsCount:(k=d.storyText)!=null&&k.pageTexts?Object.keys(d.storyText.pageTexts).length:0,partialPages:((h=d.partialPages)==null?void 0:h.length)||0}),d.progress&&br(j=>d.progress.current>=j.current?d.progress:{...j,message:d.progress.message}),d.storyText){const j=d.storyText.pageTexts||{};u.info("Setting progressiveStoryData with",Object.keys(j).length,"pages"),xa({title:d.storyText.title||W.storyTitle,dedication:d.storyText.dedication,pageTexts:j,sceneDescriptions:d.storyText.sceneDescriptions||[],totalPages:d.storyText.totalPages||r})}else u.warn("No storyText in job status response");if(d.partialPages&&d.partialPages.length>0){const j={};d.partialPages.forEach(T=>{T.pageNumber&&T.imageData&&(j[T.pageNumber]=T.imageData)}),u.info("Restored",Object.keys(j).length,"page images"),pa(j)}d.partialCovers&&Gt(j=>{var T,w,A;return{frontCover:((T=d.partialCovers)==null?void 0:T.frontCover)||j.frontCover,initialPage:((w=d.partialCovers)==null?void 0:w.initialPage)||j.initialPage,backCover:((A=d.partialCovers)==null?void 0:A.backCover)||j.backCover}})}).catch(d=>{u.error("Failed to restore job status:",d)})),u.debug("Auto-nav check:",{generationComplete:L,completedStoryId:X,urlStoryId:n,hasActiveJob:!!W}),L&&X&&!n&&(u.info("Generation completed, navigating to story:",X),i({storyId:X},{replace:!0})))},[W,L,X,o,i,r]),l.useEffect(()=>{if(o.get("new")==="true"){u.info("New story requested - resetting all story settings"),dt(""),Qt(""),_t(""),dr(""),Zt(""),Wt("watercolor"),hr("standard"),S(30),G(""),Y(""),rt(null),localStorage.removeItem("story_type"),localStorage.removeItem("story_category"),localStorage.removeItem("story_topic"),localStorage.removeItem("story_theme"),localStorage.removeItem("story_custom_theme_text"),localStorage.removeItem("story_art_style"),localStorage.removeItem("story_language_level"),localStorage.removeItem("story_pages"),localStorage.removeItem("story_dedication"),localStorage.removeItem("story_details"),localStorage.removeItem("wizard_step");const g=new URLSearchParams(o);g.delete("new"),i(g,{replace:!0}),Ce(null),at("photo"),ie(1)}},[o,i]),l.useEffect(()=>{const n=o.get("storyId");n&&B!==6&&ie(6),(async()=>{if(!(!n||!y)){if(Ja.current){Ja.current=!1,u.info("Skipping story reload - just finished generating");return}u.info("Loading saved story progressively:",n),K(!0),Z(null),Vr(null);try{await He.getStoryProgressively(n,(d,k)=>{var h,j,T;u.info("Metadata loaded:",d.title,`(${k} images to load)`),qa(d.id),ir(d.title||""),dt(d.storyType||""),Wt(d.artStyle||"pixar"),vs(d.outline||""),js(d.outlinePrompt||""),Ns(d.outlineModelId),ws(d.outlineUsage),Ss(d.storyTextPrompts||[]),Oa(d.styledAvatarGeneration||[]),_a(d.costumedAvatarGeneration||[]),(h=d.generationLog)!=null&&h.length&&(console.log("[StoryWizard] Loading story metadata, generationLog:",d.generationLog.length,"entries"),Wa(d.generationLog)),d.visualBible?Ur({mainCharacters:d.visualBible.mainCharacters||[],secondaryCharacters:d.visualBible.secondaryCharacters||[],animals:d.visualBible.animals||[],artifacts:d.visualBible.artifacts||[],locations:d.visualBible.locations||[],vehicles:d.visualBible.vehicles||[],clothing:d.visualBible.clothing||[],changeLog:d.visualBible.changeLog||[]}):Ur(null),d.clothingRequirements?ua(d.clothingRequirements):ua(null),Dt(d.sceneImages||[]),ga(d.sceneDescriptions||[]),Gt(d.coverImages||{frontCover:null,initialPage:null,backCover:null}),hr(d.languageLevel||"standard"),d.language&&Wr(d.language),Pr(!1),ks(d.isPartial||!1),As(d.failureReason),Ps(d.generatedPages),Ts(d.totalPages),qr(d.story||""),bs(d.originalStory||d.story||""),Ka({storyCategory:d.storyCategory,storyTopic:d.storyTopic,storyTheme:d.storyTheme,storyTypeName:d.storyTypeName,storyDetails:d.storyDetails,artStyle:d.artStyle,language:d.language,languageLevel:d.languageLevel,pages:d.pages,dedication:d.dedication,characters:(j=d.characters)==null?void 0:j.map(w=>{var A;return{id:w.id,name:w.name,isMain:(A=d.mainCharacters)==null?void 0:A.includes(w.id)}}),mainCharacters:d.mainCharacters,relationships:d.relationships,relationshipTexts:d.relationshipTexts,season:d.season,userLocation:d.userLocation}),(T=d.characters)!=null&&T.length&&rt(d.characters.map(w=>{var A,U;return{id:w.id,name:w.name,photoData:w.photoData||((A=w.photos)==null?void 0:A.face)||((U=w.photos)==null?void 0:U.original)}})),ie(6),K(!1),Z(null),k>0&&Vr({loaded:0,total:k}),(xe||C)&&He.getStoryDevMetadata(n).then(w=>{var A,U,ce,ae,ye;w&&((A=w.sceneImages)!=null&&A.length&&Dt(Me=>Me.map(ve=>{const je=w.sceneImages.find(q=>q.pageNumber===ve.pageNumber);return je?{...ve,prompt:je.prompt??ve.prompt,qualityReasoning:je.qualityReasoning??ve.qualityReasoning,retryHistory:je.retryHistory??ve.retryHistory,repairHistory:je.repairHistory??ve.repairHistory,wasRegenerated:je.wasRegenerated??ve.wasRegenerated,originalScore:je.originalScore??ve.originalScore,originalReasoning:je.originalReasoning??ve.originalReasoning,totalAttempts:je.totalAttempts??ve.totalAttempts,faceEvaluation:je.faceEvaluation??ve.faceEvaluation,referencePhotos:je.referencePhotos??ve.referencePhotos,landmarkPhotos:je.landmarkPhotos??ve.landmarkPhotos,consistencyRegen:je.consistencyRegen??ve.consistencyRegen}:ve})),w.coverImages&&Gt(Me=>{var q;const ve={...Me},je=["frontCover","initialPage","backCover"];for(const Oe of je){const V=(q=w.coverImages)==null?void 0:q[Oe],E=Me[Oe];V&&typeof E=="object"&&E!==null&&(ve[Oe]={...E,prompt:V.prompt??E.prompt,qualityReasoning:V.qualityReasoning??E.qualityReasoning,retryHistory:V.retryHistory??E.retryHistory,referencePhotos:V.referencePhotos??E.referencePhotos,landmarkPhotos:V.landmarkPhotos??E.landmarkPhotos})}return ve}),console.log("[StoryWizard] Dev metadata generationLog:",((U=w.generationLog)==null?void 0:U.length)||0,"entries"),(ce=w.generationLog)!=null&&ce.length&&Wa(w.generationLog),(ae=w.styledAvatarGeneration)!=null&&ae.length&&(console.log("[StoryWizard] Dev metadata styledAvatarGeneration:",w.styledAvatarGeneration.length,"entries"),Oa(w.styledAvatarGeneration)),(ye=w.costumedAvatarGeneration)!=null&&ye.length&&(console.log("[StoryWizard] Dev metadata costumedAvatarGeneration:",w.costumedAvatarGeneration.length,"entries"),_a(w.costumedAvatarGeneration)),w.finalChecksReport&&(console.log("[StoryWizard] Dev metadata finalChecksReport:",w.finalChecksReport.totalIssues,"issues"),Cs(w.finalChecksReport)),u.debug("Dev metadata merged into story"))}).catch(w=>{u.warn("Failed to load dev metadata:",w)})},(d,k,h,j)=>{if(typeof d=="number")Dt(T=>T.map(w=>w.pageNumber===d?{...w,imageData:k,imageVersions:h}:w));else{const T=d;Gt(w=>{const A=w[T];return typeof A=="object"&&A!==null?{...w,[T]:{...A,imageData:k}}:{...w,[T]:k}})}j!==void 0&&Vr(T=>T?{...T,loaded:j}:null)},()=>{u.info("All images loaded"),Vr(null)})}catch(d){u.error("Failed to load story:",d),K(!1),Z(null),Vr(null)}}})()},[o,y]),l.useEffect(()=>{B===6&&ne&&(u.info("Clearing unviewed completion - user is viewing story"),Q())},[B,ne,Q]),l.useEffect(()=>{(async()=>{const g=o.get("payment"),d=o.get("session_id");if(g==="success"&&d){u.info("Payment successful! Checking order status..."),u.info("Session ID:",d);try{const j=await He.getOrderStatus(d);if(u.info("Order Status:",j),j.order){const T=`CHF ${(j.order.amount_total/100).toFixed(2)}`,w={en:"Payment Successful!",de:"Zahlung erfolgreich!",fr:"Paiement rÃ©ussi!"},A={en:"Your book order has been received and will be printed soon.",de:"Ihre Buchbestellung wurde entgegengenommen und wird bald gedruckt.",fr:"Votre commande de livre a Ã©tÃ© reÃ§ue et sera bientÃ´t imprimÃ©e."},U=[`${a==="de"?"Kunde":a==="fr"?"Client":"Customer"}: ${j.order.customer_name}`,`Email: ${j.order.customer_email}`,`${a==="de"?"Betrag":a==="fr"?"Montant":"Amount"}: ${T}`,`${a==="de"?"Versand an":a==="fr"?"ExpÃ©diÃ© Ã ":"Shipping to"}: ${j.order.shipping_name}`,`${j.order.shipping_address_line1}`,`${j.order.shipping_postal_code} ${j.order.shipping_city}`,`${j.order.shipping_country}`];p(A[a]||A.en,w[a]||w.en,U)}}catch(j){u.error("Error checking order status:",j)}const h=new URLSearchParams(o);h.delete("payment"),h.delete("session_id"),i(h,{replace:!0})}else if(g==="cancelled"){u.info("Payment cancelled by user");const h={en:"Payment was cancelled. You can try again when ready.",de:"Zahlung wurde abgebrochen. Sie kÃ¶nnen es erneut versuchen.",fr:"Paiement annulÃ©. Vous pouvez rÃ©essayer quand vous Ãªtes prÃªt."};I(h[a]||h.en,a==="de"?"Abgebrochen":a==="fr"?"AnnulÃ©":"Cancelled");const j=new URLSearchParams(o);j.delete("payment"),i(j,{replace:!0})}const k=o.get("credits_payment");if(k==="success"){u.info("Credits payment successful!"),await D();const h={en:"Credits Added!",de:"Credits hinzugefuegt!",fr:"Credits ajoutes!"},j={en:"100 credits have been added to your account.",de:"100 Credits wurden Ihrem Konto gutgeschrieben.",fr:"100 credits ont ete ajoutes a votre compte."};p(j[a]||j.en,h[a]||h.en);const T=new URLSearchParams(o);T.delete("credits_payment"),T.delete("session_id"),i(T,{replace:!0})}else if(k==="cancelled"){u.info("Credits payment cancelled by user");const h={en:"Credits purchase was cancelled.",de:"Kreditkauf wurde abgebrochen.",fr:"L'achat de credits a ete annule."};I(h[a]||h.en,a==="de"?"Abgebrochen":a==="fr"?"Annule":"Cancelled");const j=new URLSearchParams(o);j.delete("credits_payment"),i(j,{replace:!0})}})()},[o,i,a,p,I,D]);const ba=l.useRef(!1);l.useEffect(()=>{if(o.get("autoGenerate")==="true"&&!ba.current){ba.current=!0;const g=localStorage.getItem("pending_story_type"),d=localStorage.getItem("pending_art_style");g&&(dt(g),localStorage.removeItem("pending_story_type")),d&&(Wt(d),localStorage.removeItem("pending_art_style")),ie(6);const k=new URLSearchParams(o);k.delete("autoGenerate"),i(k,{replace:!0})}},[o,i]);const Ya=n=>{if(n.length===0)return;const g=n.filter(d=>{const k=parseInt(d.age);return k>=1&&k<=10});if(g.length>0){const d=g.map(k=>k.id);mt(d),u.info(`Auto-selected ${g.length} main character(s) aged 1-10`)}else{const d=n.reduce((k,h)=>{const j=parseInt(h.age)||999,T=parseInt(k.age)||999;return j<T?h:k});mt([d.id]),u.info(`Auto-selected youngest character as main: ${d.name} (age ${d.age})`)}};l.useEffect(()=>{y?(async()=>{try{K(!0);const g=await Ee.getCharacterData(We);if(u.info("Loaded character data from API:",{characters:g.characters.length,relationships:Object.keys(g.relationships).length}),we(g.characters),Object.keys(g.relationships).length>0&&(_r(g.relationships),la.current=!0),Object.keys(g.relationshipTexts).length>0&&Rt(g.relationshipTexts),g.customRelationships.length>0&&ur(g.customRelationships),g.characters.some(k=>k.storyRole)){const k=[],h=[];for(const j of g.characters)j.storyRole==="main"?k.push(j.id):j.storyRole==="out"&&h.push(j.id);mt(k),Bt(h),u.info(`Loaded character roles from database: ${k.length} main, ${h.length} excluded`)}else g.characters.length>0&&Ya(g.characters)}catch(g){u.error("Failed to load character data:",g)}finally{K(!1),Cr(!0)}})():_||Cr(!0)},[y,_]),l.useEffect(()=>{We&&y&&It&&(async()=>{try{u.info("Reloading characters with full avatars (dev mode)");const g=await Ee.getCharacterData(!0);we(g.characters),u.info(`Loaded ${g.characters.length} characters with full avatars`)}catch(g){u.error("Failed to reload with full avatars:",g)}})()},[We,y,It]),l.useEffect(()=>{B===1&&ue.length===0&&!v&&!te&&It&&es()},[B,ue.length,v,te,It]);const Xa=l.useRef(Ze);l.useEffect(()=>{Xa.current!==Ze&&JSON.stringify(Xa.current)!==JSON.stringify(Ze)&&(Ar([]),Y(""),Xa.current=Ze)},[Ze]),l.useEffect(()=>{localStorage.setItem("story_language_level",bt)},[bt]),l.useEffect(()=>{localStorage.setItem("story_language",vt)},[vt]),l.useEffect(()=>{localStorage.setItem("story_pages",r.toString())},[r]),l.useEffect(()=>{localStorage.setItem("story_dedication",f)},[f]),l.useEffect(()=>{localStorage.setItem("story_details",m)},[m]),l.useEffect(()=>{localStorage.setItem("story_type",tt)},[tt]),l.useEffect(()=>{be?localStorage.setItem("story_category",be):localStorage.removeItem("story_category")},[be]),l.useEffect(()=>{Re?localStorage.setItem("story_topic",Re):localStorage.removeItem("story_topic")},[Re]),l.useEffect(()=>{Be?localStorage.setItem("story_theme",Be):localStorage.removeItem("story_theme")},[Be]),l.useEffect(()=>{St?localStorage.setItem("story_custom_theme_text",St):localStorage.removeItem("story_custom_theme_text")},[St]);const $s=l.useRef(be),Is=l.useRef(Re),Ds=l.useRef(Be),Es=l.useRef(!0);l.useEffect(()=>{if(Es.current){Es.current=!1;return}const n=$s.current!==be,g=Is.current!==Re,d=Ds.current!==Be;(n||g||d)&&(Y(""),localStorage.removeItem("story_details"),Ar([])),$s.current=be,Is.current=Re,Ds.current=Be},[be,Re,Be]),l.useEffect(()=>{localStorage.setItem("story_art_style",ot)},[ot]);const Zr=l.useRef(!1);l.useEffect(()=>{if(B===4&&!Zr.current&&!pe&&sr.length===0){const n=!!be,g=!!Be||!!Re,d=ue.length>0;n&&g&&d&&(Zr.current=!0,u.info("[StoryWizard] Pre-generating story ideas while user selects art style"),Rs())}Zr.current&&sr.length===0&&(Zr.current=!1)},[B,be,Be,Re,ue.length,pe,sr.length]);const zs=l.useRef({storyCategory:be,storyTheme:Be,storyTopic:Re});l.useEffect(()=>{const n=zs.current,g=n.storyCategory!==be||n.storyTheme!==Be||n.storyTopic!==Re;zs.current={storyCategory:be,storyTheme:Be,storyTopic:Re},g&&(pe||sr.length>0)&&(u.info("[StoryWizard] Story inputs changed - aborting idea generation and clearing results"),pr.current&&(pr.current.abort(),pr.current=null),st(!1),ut(!1),kt(!1),Ar([]),Ra(null),Ba(""),Zr.current=!1)},[be,Be,Re,pe,sr.length]),l.useEffect(()=>{if(!pe)return;const g=setTimeout(()=>{u.warn("[StoryWizard] Safety timeout - resetting isGeneratingIdeas after 2.5 minutes"),st(!1),ut(!1),kt(!1),x(a==="de"?"ZeitÃ¼berschreitung bei der Ideengenerierung. Bitte versuchen Sie es erneut.":a==="fr"?"DÃ©lai d'attente de gÃ©nÃ©ration d'idÃ©es. Veuillez rÃ©essayer.":"Idea generation timed out. Please try again.")},15e4);return()=>clearTimeout(g)},[pe,a]),l.useEffect(()=>{if(!jt&&!Mt){gt(0),kr(0);return}const n=35e3,g=80,d=100,k=Date.now(),h=setInterval(()=>{const j=Date.now()-k,T=Math.min(j/n,1),w=1-Math.pow(1-T,3),A=Math.round(w*g);jt&&gt(A),Mt&&kr(A),T>=1&&clearInterval(h)},d);return()=>clearInterval(h)},[jt,Mt]),l.useEffect(()=>{B>=1&&B<=5&&localStorage.setItem("wizard_step",B.toString())},[B]);const qn=n=>{Qt(n)},Un=n=>{dr(n),(be==="adventure"&&n!==""||(be==="life-challenge"||be==="educational")&&Re!==""&&n!==""&&n!=="realistic")&&or(4)},Kn=n=>{_t(n)},Jn=n=>{Wt(n),or(5)};l.useEffect(()=>{if(B===2&&ue.length>=2&&!te){const n=ue.map(g=>g.id).sort().join("-");if(!oa.current||oa.current!==n){const d=xo(a);u.debug("Initializing relationships for step 2",{charKey:n,existingCount:Object.keys(Qe).length}),_r(k=>{const h={...k};let j=!1;return ue.forEach((T,w)=>{ue.forEach((A,U)=>{if(w!==U){const ce=`${T.id}-${A.id}`;h[ce]||(h[ce]=d,j=!0,u.debug("Initializing missing relationship:",ce))}})}),j?h:k}),oa.current=n}}},[B,ue,a,te]);const Qn=()=>{if(ue.length<2)return!0;for(let n=0;n<ue.length;n++)for(let g=0;g<ue.length;g++)if(n!==g){const d=`${ue[n].id}-${ue[g].id}`,k=Qe[d];if(!k||tn(k))return!1}return!0},Zn=()=>{if(ue.length<2)return null;let n=0,g=null;for(const d of ue){let k=0;for(const h of ue)if(d.id!==h.id){const j=`${d.id}-${h.id}`,T=Qe[j];(!T||tn(T))&&k++}k>n&&(n=k,g=d)}return g},es=()=>{Ce({id:Date.now(),name:"",gender:void 0,age:"",traits:{strengths:[],flaws:[],challenges:[]}}),at("photo"),Yt(!1)},Yn=(n,g=1500)=>new Promise(d=>{const k=new Image;k.onload=()=>{const h=document.createElement("canvas");let{width:j,height:T}=k;(j>g||T>g)&&(j>T?(T=Math.round(T*g/j),j=g):(j=Math.round(j*g/T),T=g)),h.width=j,h.height=T;const w=h.getContext("2d");w==null||w.drawImage(k,0,0,j,T),d(h.toDataURL("image/jpeg",.85))},k.onerror=()=>d(n),k.src=n}),Xn=async(n,g)=>{var h,j,T,w,A;if(u.info(`ðŸ“¸ handlePhotoSelect called: file=${n==null?void 0:n.name}, character=${v==null?void 0:v.name}, developerMode=${xe}`),v&&!xe){const U=!!((h=v.avatars)!=null&&h.winter||(j=v.avatars)!=null&&j.standard||(T=v.avatars)!=null&&T.summer||(w=v.avatars)!=null&&w.hasFullAvatars);if(u.info(`ðŸ“¸ hasAvatars=${U}`),U){const ce=Ta(v.id);if(u.info(`ðŸ“¸ cooldown check: canRegenerate=${ce.canRegenerate}, waitSeconds=${ce.waitSeconds}`),!ce.canRegenerate){const ae=a==="de"?`Bitte warten Sie ${ce.waitSeconds} Sekunden, bevor Sie ein neues Foto hochladen.`:`Please wait ${ce.waitSeconds} seconds before uploading a new photo.`;x(ae);return}hn(v.id)}}const d=g&&((A=v==null?void 0:v.clothing)!=null&&A.structured)?{...v.clothing.structured}:null,k=new FileReader;k.onload=async U=>{var ae,ye,Me,ve,je,q,Oe,V,E,z,H,R;const ce=(ae=U.target)==null?void 0:ae.result;v&&(za.current={physical:v.physical,gender:v.gender,age:v.age}),Mr(void 0),Je(!0),!(v!=null&&v.name)||v.name.trim().length<2?at("name"):(at("traits"),u.info("ðŸ“¸ Character has name, going to traits step to show avatar regeneration"));try{const J=await Yn(ce),Ie=Math.round(ce.length/1024),O=Math.round(J.length/1024);u.info(`Starting photo analysis... (${Ie}KB -> ${O}KB)`);const Te=v!=null&&v.id&&v.id>0?v.id:void 0,oe=await Ee.analyzePhoto(J,a,void 0,void 0,Te);if(oe.success){if(oe.multipleFacesDetected&&oe.faces&&oe.faces.length>1){u.info(`Multiple faces detected (${oe.faces.length}), showing selection modal`),Or(J),rr(d?{structured:d}:null),Hr(oe.faces),Lr(!0),Je(!1);return}u.info("Photo analysis complete:",{hasPhotos:!!oe.photos,hasPhysical:!!oe.physical,hasClothing:!!oe.clothing,age:oe.age,gender:oe.gender}),oe._debug&&(Ut(oe._debug),oe._debug.rawResponse,oe._debug.error&&console.warn("ðŸ“¸ [DEBUG] Gemini error:",oe._debug.error));const Le={original:((ye=oe.photos)==null?void 0:ye.face)||ce,face:(Me=oe.photos)==null?void 0:Me.face,body:((ve=oe.photos)==null?void 0:ve.body)||ce,bodyNoBg:(je=oe.photos)==null?void 0:je.bodyNoBg,faceBox:(q=oe.photos)==null?void 0:q.faceBox,bodyBox:(Oe=oe.photos)==null?void 0:Oe.bodyBox},Ke=(V=oe.photos)!=null&&V.bodyNoBg?Math.round(oe.photos.bodyNoBg.length/1024):0,nt=(E=oe.photos)!=null&&E.body?Math.round(oe.photos.body.length/1024):0,va=(z=oe.photos)!=null&&z.face?Math.round(oe.photos.face.length/1024):0;if(u.info(`ðŸ“¸ [PHOTO CHANGE] Analysis returned: bodyNoBg=${Ke}KB, body=${nt}KB, face=${va}KB`),(H=oe.photos)!=null&&H.bodyNoBg){const De=oe.photos.bodyNoBg.substring(oe.photos.bodyNoBg.indexOf("base64,")+7,oe.photos.bodyNoBg.indexOf("base64,")+27);u.info(`ðŸ“¸ [PHOTO CHANGE] bodyNoBg fingerprint: ${De}...`)}let Et,ja;d?(Et={structured:d},ja={upperBody:d.upperBody?"user":void 0,lowerBody:d.lowerBody?"user":void 0,shoes:d.shoes?"user":void 0,fullBody:d.fullBody?"user":void 0},u.info(`ðŸ‘• Keeping old clothing (marked as user-edited): ${JSON.stringify(d)}`)):u.info("ðŸ‘• Using new photo's clothing (cleared existing)");const Na=oe.characterId,rs=(v==null?void 0:v.id)&&v.id>0,Ir=rs?v.id:Na;rs?u.info(`ðŸ“¸ [PHOTO] Keeping existing character ID: ${v.id} (server created new ID ${Na} but ignoring)`):Na&&u.info(`ðŸ“¸ [PHOTO] Using server-created character ID: ${Na}`);const At=v?{...v,id:Ir||v.id,photos:Le,avatars:{status:"generating"},clothing:Et,clothingSource:ja}:null;if(At){const De=(R=At.photos)==null?void 0:R.bodyNoBg,ht=De?Math.round(De.length/1024):0;if(u.info(`ðŸ“¸ [CHAR FOR GEN] bodyNoBg=${ht}KB, has photos: ${!!At.photos}`),De){const ze=De.substring(De.indexOf("base64,")+7,De.indexOf("base64,")+27);u.info(`ðŸ“¸ [CHAR FOR GEN] fingerprint: ${ze}...`)}}if(Ce(De=>{var ze;if(!De)return null;const ht=(ze=De.avatars)!=null&&ze.standard?{...De.avatars,status:"generating",stale:!0}:{status:"generating"};return{...De,id:Ir||De.id,photos:Le,avatars:ht,clothing:Et,clothingSource:ja}}),Ir&&!rs&&we(De=>{if(!De.some(ze=>ze.id===Ir)){const ze={...v,id:Ir,photos:Le,avatars:{status:"generating"},clothing:Et,clothingSource:ja};return u.info(`ðŸ“¸ Adding new character ${Ir} to array to prevent data loss`),[...De,ze]}return De}),u.info("ðŸŽ¨ Auto-starting avatar generation in background..."),u.info(`ðŸ“¸ Photo for avatar: bodyNoBg=${!!Le.bodyNoBg}, body=${!!Le.body}, face=${!!Le.face}`),At&&At.id&&At.name&&At.name.trim()){const De=At.id;ct(De),Ee.generateAndSaveAvatarForCharacter(At,void 0,{avatarModel:et.avatarModel||void 0}).then(ht=>{ht.success&&ht.character?(Ce(ze=>!ze||ze.id!==De?ze:{...ze,avatars:ht.character.avatars,physical:ht.character.physical,clothing:ht.character.clothing}),we(ze=>ze.map(Pt=>Pt.id===De?{...Pt,...ht.character,id:Pt.id}:Pt)),u.success(`âœ… Avatar generated and traits extracted for ${At.name}`)):(u.error(`âŒ Avatar generation failed: ${ht.error}`),Ce(ze=>ze&&ze.id===De?{...ze,avatars:{status:"failed"}}:ze),we(ze=>ze.map(Pt=>Pt.id===De?{...Pt,avatars:{status:"failed"}}:Pt)))}).catch(ht=>{u.error("âŒ Avatar generation error:",ht),Ce(ze=>ze&&ze.id===De?{...ze,avatars:{status:"failed"}}:ze),we(ze=>ze.map(Pt=>Pt.id===De?{...Pt,avatars:{status:"failed"}}:Pt))}).finally(()=>{ct(null)})}else At&&At.id?(u.info("â­ï¸ Skipping auto-generation: character has no name yet"),ct(null),Ce(De=>De&&{...De,avatars:{status:"pending"}})):(u.warn("â­ï¸ Skipping auto-generation: no character data available"),ct(null))}else oe.error==="no_face_detected"?(u.warn("No face detected in photo"),x(N.noFaceDetected)):(u.warn("Photo analysis returned no data, using original photo"),Ce(Le=>Le?{...Le,photos:{original:ce},avatars:void 0}:null))}catch(J){u.error("Photo analysis error:",J),Ce(Ie=>Ie?{...Ie,photos:{original:ce},avatars:void 0}:null)}finally{Je(!1)}},k.readAsDataURL(n)},ei=async n=>{var g,d,k,h,j,T,w,A;if(!er){u.error("No pending photo data for face selection");return}Lr(!1),Je(!0);try{u.info(`Re-analyzing photo with selected face ID: ${n}`);const U=Gr.map(ye=>({id:ye.id,x:ye.faceBox.x,y:ye.faceBox.y,width:ye.faceBox.width,height:ye.faceBox.height,confidence:ye.confidence})),ce=v!=null&&v.id&&v.id>0?v.id:void 0,ae=await Ee.analyzePhoto(er,a,n,U,ce);if(ae.success){u.info("Photo analysis complete with selected face:",{hasPhotos:!!ae.photos,hasPhysical:!!ae.physical,hasClothing:!!ae.clothing,age:ae.age,gender:ae.gender}),ae._debug&&Ut(ae._debug);const ye=tr==null?void 0:tr.structured,Me={original:((g=ae.photos)==null?void 0:g.face)||er,face:(d=ae.photos)==null?void 0:d.face,body:((k=ae.photos)==null?void 0:k.body)||er,bodyNoBg:(h=ae.photos)==null?void 0:h.bodyNoBg,faceBox:(j=ae.photos)==null?void 0:j.faceBox,bodyBox:(T=ae.photos)==null?void 0:T.bodyBox},ve=(w=ae.photos)!=null&&w.bodyNoBg?Math.round(ae.photos.bodyNoBg.length/1024):0;if(u.info(`ðŸ“¸ [FACE SELECT] Analysis returned: bodyNoBg=${ve}KB`),(A=ae.photos)!=null&&A.bodyNoBg){const H=ae.photos.bodyNoBg.substring(ae.photos.bodyNoBg.indexOf("base64,")+7,ae.photos.bodyNoBg.indexOf("base64,")+27);u.info(`ðŸ“¸ [FACE SELECT] bodyNoBg fingerprint: ${H}...`)}let je,q;ye&&(je={structured:ye},q={upperBody:ye.upperBody?"user":void 0,lowerBody:ye.lowerBody?"user":void 0,shoes:ye.shoes?"user":void 0,fullBody:ye.fullBody?"user":void 0});const Oe=ae.characterId,V=(v==null?void 0:v.id)&&v.id>0,E=V?v.id:Oe;V?u.info(`ðŸ“¸ [FACE SELECT] Keeping existing character ID: ${v.id} (server created new ID ${Oe} but ignoring)`):Oe&&u.info(`ðŸ“¸ [FACE SELECT] Using server-created character ID: ${Oe}`);const z=v?{...v,id:E||v.id,photos:Me,avatars:{status:"generating"},clothing:je,clothingSource:q}:null;if(Ce(H=>{var J;if(!H)return null;const R=(J=H.avatars)!=null&&J.standard?{...H.avatars,status:"generating",stale:!0}:{status:"generating"};return{...H,id:E||H.id,photos:Me,avatars:R,clothing:je,clothingSource:q}}),E&&!V&&we(H=>{if(!H.some(J=>J.id===E)){const J={...v,id:E,photos:Me,avatars:{status:"generating"},clothing:je,clothingSource:q};return u.info(`ðŸ“¸ [FACE SELECT] Adding new character ${E} to array to prevent data loss`),[...H,J]}return H}),v!=null&&v.name&&v.name.trim().length>=2?(at("traits"),u.info("ðŸ“¸ Face selected, character has name, going to traits step")):at("name"),u.info("ðŸŽ¨ Auto-starting avatar generation in background after face selection..."),u.info(`ðŸ“¸ Photo for avatar: bodyNoBg=${!!Me.bodyNoBg}, body=${!!Me.body}, face=${!!Me.face}`),z&&z.name&&z.name.trim()){const H=z.id;ct(H),Ee.generateAndSaveAvatarForCharacter(z,void 0,{avatarModel:et.avatarModel||void 0}).then(R=>{R.success&&R.character?(Ce(J=>!J||J.id!==H?J:{...J,avatars:R.character.avatars,physical:R.character.physical,clothing:R.character.clothing}),we(J=>J.map(Ie=>Ie.id===H?{...Ie,...R.character,id:Ie.id}:Ie)),u.success(`âœ… Avatar generated for ${z.name} (face selection)`)):(u.error(`âŒ Avatar generation failed: ${R.error}`),Ce(J=>J&&J.id===H?{...J,avatars:{status:"failed"}}:J),we(J=>J.map(Ie=>Ie.id===H?{...Ie,avatars:{status:"failed"}}:Ie)))}).catch(R=>{u.error("âŒ Avatar generation error:",R),Ce(J=>J&&J.id===H?{...J,avatars:{status:"failed"}}:J),we(J=>J.map(Ie=>Ie.id===H?{...Ie,avatars:{status:"failed"}}:Ie))}).finally(()=>{ct(null)})}else u.info("â­ï¸ Skipping auto-generation: character has no name yet"),ct(null),Ce(H=>H&&{...H,avatars:{status:"pending"}})}else u.warn("Photo analysis failed after face selection"),x(N.noFaceDetected)}catch(U){u.error("Photo analysis error after face selection:",U),x("Failed to analyze photo. Please try again.")}finally{Je(!1),Or(null),rr(null),Hr([])}},ti=()=>{Lr(!1),Or(null),rr(null),Hr([]),at("photo")},ri=async()=>{if(v){Ce(n=>n&&{...n,avatars:void 0}),cr(!0);try{u.info(`ðŸ”„ Regenerating avatars for ${v.name}...`);const n=await Ee.regenerateAvatarsForCharacter(v.id,(g,d)=>u.info(`[${g}] ${d}`),{avatarModel:et.avatarModel||void 0});if(n.success&&n.character){const g={...n.character.avatars,stale:!1};Ce(d=>d&&{...d,avatars:g,physical:n.character.physical,clothing:n.character.clothing}),we(d=>d.map(k=>k.id===v.id?{...k,avatars:g,physical:n.character.physical,clothing:n.character.clothing}:k)),u.success(`âœ… Avatars and traits regenerated for ${v.name}`)}else u.error(`âŒ Failed to regenerate avatars: ${n.error}`),x(`Failed to regenerate avatars: ${n.error||"Unknown error"}`)}catch(n){u.error(`âŒ Failed to regenerate avatars for ${v.name}:`,n),x(`Failed to regenerate avatars: ${n instanceof Error?n.message:"Unknown error"}`)}finally{cr(!1)}}},ai=async()=>{var n,g,d,k,h,j,T,w,A,U,ce,ae,ye,Me,ve,je;if(v){Ce(q=>q&&{...q,avatars:void 0}),mr(!0);try{u.info(`ðŸ”„ Regenerating avatars WITH TRAITS for ${v.name}...`),u.info(`Physical traits: ${JSON.stringify(v.physical)}`);const q=await Ee.generateClothingAvatarsWithTraits(v);if(q.success&&q.avatars){const Oe={...q.avatars,stale:!1,generatedAt:new Date().toISOString()},V=v.physicalTraitsSource||{},E=q.extractedTraits?{height:(n=v.physical)==null?void 0:n.height,eyeColor:V.eyeColor==="user"?(g=v.physical)==null?void 0:g.eyeColor:q.extractedTraits.eyeColor,eyeColorHex:V.eyeColor==="user"?(d=v.physical)==null?void 0:d.eyeColorHex:q.extractedTraits.eyeColorHex,hairColor:V.hairColor==="user"?(k=v.physical)==null?void 0:k.hairColor:q.extractedTraits.hairColor,hairColorHex:V.hairColor==="user"?(h=v.physical)==null?void 0:h.hairColorHex:q.extractedTraits.hairColorHex,hairLength:V.hairLength==="user"?(j=v.physical)==null?void 0:j.hairLength:q.extractedTraits.hairLength,hairStyle:V.hairStyle==="user"?(T=v.physical)==null?void 0:T.hairStyle:q.extractedTraits.hairStyle,build:V.build==="user"?(w=v.physical)==null?void 0:w.build:q.extractedTraits.build,face:V.face==="user"?(A=v.physical)==null?void 0:A.face:q.extractedTraits.face,facialHair:V.facialHair==="user"?(U=v.physical)==null?void 0:U.facialHair:q.extractedTraits.facialHair,other:V.other==="user"?(ce=v.physical)==null?void 0:ce.other:q.extractedTraits.other,skinTone:V.skinTone==="user"?(ae=v.physical)==null?void 0:ae.skinTone:q.extractedTraits.skinTone,skinToneHex:V.skinTone==="user"?(ye=v.physical)==null?void 0:ye.skinToneHex:q.extractedTraits.skinToneHex,detailedHairAnalysis:q.extractedTraits.detailedHairAnalysis||((Me=v.physical)==null?void 0:Me.detailedHairAnalysis),apparentAge:V.apparentAge==="user"?(ve=v.physical)==null?void 0:ve.apparentAge:q.extractedTraits.apparentAge||((je=v.physical)==null?void 0:je.apparentAge)}:v.physical,z=q.extractedTraits?{eyeColor:V.eyeColor==="user"?"user":q.extractedTraits.eyeColor?"extracted":void 0,hairColor:V.hairColor==="user"?"user":q.extractedTraits.hairColor?"extracted":void 0,hairLength:V.hairLength==="user"?"user":q.extractedTraits.hairLength?"extracted":void 0,hairStyle:V.hairStyle==="user"?"user":q.extractedTraits.hairStyle?"extracted":void 0,build:V.build==="user"?"user":q.extractedTraits.build?"extracted":void 0,face:V.face==="user"?"user":q.extractedTraits.face?"extracted":void 0,facialHair:V.facialHair==="user"?"user":q.extractedTraits.facialHair?"extracted":void 0,other:V.other==="user"?"user":q.extractedTraits.other?"extracted":void 0,skinTone:V.skinTone==="user"?"user":q.extractedTraits.skinTone?"extracted":void 0,apparentAge:V.apparentAge==="user"?"user":q.extractedTraits.apparentAge?"extracted":void 0}:v.physicalTraitsSource,H=q.extractedClothing?{...v.clothing,structured:{upperBody:q.extractedClothing.upperBody||void 0,lowerBody:q.extractedClothing.lowerBody||void 0,shoes:q.extractedClothing.shoes||void 0,fullBody:q.extractedClothing.fullBody||void 0}}:v.clothing;Ce(R=>R&&{...R,avatars:Oe,physical:E,physicalTraitsSource:z,clothing:H}),we(R=>R.map(J=>J.id===v.id?{...J,avatars:Oe,physical:E,physicalTraitsSource:z,clothing:H}:J)),u.success(`âœ… Avatars WITH TRAITS regenerated for ${v.name}`),q.extractedTraits&&u.info(`ðŸ“‹ Extracted traits saved: ${JSON.stringify(q.extractedTraits)}`),q.extractedClothing&&u.info(`ðŸ‘• Extracted clothing saved: ${JSON.stringify(q.extractedClothing)}`)}else u.error(`âŒ Failed to regenerate avatars with traits: ${q.error}`),x(`Failed to regenerate avatars: ${q.error||"Unknown error"}`)}catch(q){u.error(`âŒ Failed to regenerate avatars with traits for ${v.name}:`,q),x(`Failed to regenerate avatars: ${q instanceof Error?q.message:"Unknown error"}`)}finally{mr(!1)}}},si=async()=>{var d,k,h,j,T,w,A,U,ce,ae,ye,Me,ve,je,q,Oe;if(!v)return;const n={...v},g=v.id;mr(!0);try{u.info(`ðŸ’¾ Saving character and regenerating avatars for ${n.name}...`),await ts(),u.info(`ðŸ”„ Regenerating avatars WITH TRAITS for ${n.name}...`);const E=(await new Promise(H=>{we(R=>(H(R),R))})).find(H=>H.id===g);if(!E){u.warn("Character not found in characters array after save");return}const z=await Ee.generateClothingAvatarsWithTraits(E);if(z.success&&z.avatars){const H={...z.avatars,stale:!1,generatedAt:new Date().toISOString()},R=E.physicalTraitsSource||{},J=z.extractedTraits?{height:(d=E.physical)==null?void 0:d.height,eyeColor:R.eyeColor==="user"?(k=E.physical)==null?void 0:k.eyeColor:z.extractedTraits.eyeColor,eyeColorHex:R.eyeColor==="user"?(h=E.physical)==null?void 0:h.eyeColorHex:z.extractedTraits.eyeColorHex,hairColor:R.hairColor==="user"?(j=E.physical)==null?void 0:j.hairColor:z.extractedTraits.hairColor,hairColorHex:R.hairColor==="user"?(T=E.physical)==null?void 0:T.hairColorHex:z.extractedTraits.hairColorHex,hairLength:R.hairLength==="user"?(w=E.physical)==null?void 0:w.hairLength:z.extractedTraits.hairLength,hairStyle:R.hairStyle==="user"?(A=E.physical)==null?void 0:A.hairStyle:z.extractedTraits.hairStyle,build:R.build==="user"?(U=E.physical)==null?void 0:U.build:z.extractedTraits.build,face:R.face==="user"?(ce=E.physical)==null?void 0:ce.face:z.extractedTraits.face,facialHair:R.facialHair==="user"?(ae=E.physical)==null?void 0:ae.facialHair:z.extractedTraits.facialHair,other:R.other==="user"?(ye=E.physical)==null?void 0:ye.other:z.extractedTraits.other,skinTone:R.skinTone==="user"?(Me=E.physical)==null?void 0:Me.skinTone:z.extractedTraits.skinTone,skinToneHex:R.skinTone==="user"?(ve=E.physical)==null?void 0:ve.skinToneHex:z.extractedTraits.skinToneHex,detailedHairAnalysis:z.extractedTraits.detailedHairAnalysis||((je=E.physical)==null?void 0:je.detailedHairAnalysis),apparentAge:R.apparentAge==="user"?(q=E.physical)==null?void 0:q.apparentAge:z.extractedTraits.apparentAge||((Oe=E.physical)==null?void 0:Oe.apparentAge)}:E.physical,Ie=z.extractedTraits?{eyeColor:R.eyeColor==="user"?"user":z.extractedTraits.eyeColor?"extracted":void 0,hairColor:R.hairColor==="user"?"user":z.extractedTraits.hairColor?"extracted":void 0,hairLength:R.hairLength==="user"?"user":z.extractedTraits.hairLength?"extracted":void 0,hairStyle:R.hairStyle==="user"?"user":z.extractedTraits.hairStyle?"extracted":void 0,build:R.build==="user"?"user":z.extractedTraits.build?"extracted":void 0,face:R.face==="user"?"user":z.extractedTraits.face?"extracted":void 0,facialHair:R.facialHair==="user"?"user":z.extractedTraits.facialHair?"extracted":void 0,other:R.other==="user"?"user":z.extractedTraits.other?"extracted":void 0,skinTone:R.skinTone==="user"?"user":z.extractedTraits.skinTone?"extracted":void 0,apparentAge:R.apparentAge==="user"?"user":z.extractedTraits.apparentAge?"extracted":void 0}:E.physicalTraitsSource,O=z.extractedClothing?{...E.clothing,structured:{upperBody:z.extractedClothing.upperBody||void 0,lowerBody:z.extractedClothing.lowerBody||void 0,shoes:z.extractedClothing.shoes||void 0,fullBody:z.extractedClothing.fullBody||void 0}}:E.clothing;Ce(Ke=>Ke&&Ke.id===g?{...Ke,avatars:H,physical:J,physicalTraitsSource:Ie,clothing:O}:Ke),we(Ke=>Ke.map(nt=>nt.id===g?{...nt,avatars:H,physical:J,physicalTraitsSource:Ie,clothing:O}:nt)),u.success(`âœ… Avatars regenerated for ${E.name}`);const Te={...E,avatars:H,physical:J,physicalTraitsSource:Ie,clothing:O},Le=(await new Promise(Ke=>{we(nt=>(Ke(nt),nt))})).map(Ke=>Ke.id===g?Te:Ke);await Ee.saveCharacterData({characters:Le,relationships:Qe,relationshipTexts:Ft,customRelationships:ft,customStrengths:[],customWeaknesses:[],customFears:[]}),u.success("ðŸ’¾ Character saved with new avatars, traits, and clothing"),p(a==="de"?"Charakter gespeichert und Avatar regeneriert":"Character saved and avatar regenerated")}else u.error(`âŒ Failed to regenerate avatars: ${z.error}`),x(`Failed to regenerate avatars: ${z.error||"Unknown error"}`)}catch(V){u.error("âŒ Failed to save and regenerate:",V),x(`Failed: ${V instanceof Error?V.message:"Unknown error"}`)}finally{mr(!1)}},ni=async()=>{var k,h,j,T,w,A,U,ce,ae,ye,Me,ve,je,q,Oe,V,E,z;if(!v)return;const n=v.id;Mr(void 0),at("traits");const g=(k=v.avatars)==null?void 0:k.status,d=!!((h=v.avatars)!=null&&h.standard||(j=v.avatars)!=null&&j.winter||(T=v.avatars)!=null&&T.summer||(w=v.avatars)!=null&&w.hasFullAvatars);if(g==="generating"||g==="complete"&&d){u.info(`â­ï¸ Skipping avatar generation - already ${g}${d?" with avatars":""}`);return}ct(n),Ce(H=>H&&H.id===n?{...H,avatars:{status:"generating"}}:H),u.info(`ðŸŽ¨ Starting avatar generation for ${v.name||"unnamed"} (id: ${n})...`);try{const H=await Ee.generateClothingAvatarsWithTraits(v);if(H.success&&H.avatars){const R={...H.avatars,stale:!1,generatedAt:new Date().toISOString()},J=H.extractedTraits?{...v.physical,build:H.extractedTraits.build||((A=v.physical)==null?void 0:A.build),eyeColor:H.extractedTraits.eyeColor||((U=v.physical)==null?void 0:U.eyeColor),eyeColorHex:H.extractedTraits.eyeColorHex||((ce=v.physical)==null?void 0:ce.eyeColorHex),hairColor:H.extractedTraits.hairColor||((ae=v.physical)==null?void 0:ae.hairColor),hairColorHex:H.extractedTraits.hairColorHex||((ye=v.physical)==null?void 0:ye.hairColorHex),hairLength:H.extractedTraits.hairLength||((Me=v.physical)==null?void 0:Me.hairLength),hairStyle:H.extractedTraits.hairStyle||((ve=v.physical)==null?void 0:ve.hairStyle),facialHair:H.extractedTraits.facialHair||((je=v.physical)==null?void 0:je.facialHair),skinTone:H.extractedTraits.skinTone||((q=v.physical)==null?void 0:q.skinTone),skinToneHex:H.extractedTraits.skinToneHex||((Oe=v.physical)==null?void 0:Oe.skinToneHex),face:H.extractedTraits.face||((V=v.physical)==null?void 0:V.face),other:H.extractedTraits.other||((E=v.physical)==null?void 0:E.other),detailedHairAnalysis:H.extractedTraits.detailedHairAnalysis||((z=v.physical)==null?void 0:z.detailedHairAnalysis)}:v.physical,Ie=H.extractedClothing?{...v.clothing,structured:{upperBody:H.extractedClothing.upperBody||void 0,lowerBody:H.extractedClothing.lowerBody||void 0,shoes:H.extractedClothing.shoes||void 0,fullBody:H.extractedClothing.fullBody||void 0}}:v.clothing;we(O=>O.map(Te=>Te.id===n?{...Te,avatars:R,physical:J,clothing:Ie}:Te)),Ce(O=>O&&O.id===n?{...O,avatars:R,physical:J,clothing:Ie}:O),u.success(`âœ… Avatar generated for ${v.name} (id: ${n})`)}else u.error(`âŒ Failed to generate avatar: ${H.error}`),x(`Failed to generate avatar: ${H.error||"Unknown error"}`),we(R=>R.map(J=>J.id===n?{...J,avatars:{status:"failed"}}:J)),Ce(R=>R&&R.id===n?{...R,avatars:{status:"failed"}}:R)}catch(H){u.error("âŒ Avatar generation failed:",H),x(`Avatar generation failed: ${H instanceof Error?H.message:"Unknown error"}`),we(R=>R.map(J=>J.id===n?{...J,avatars:{status:"failed"}}:J)),Ce(R=>R&&R.id===n?{...R,avatars:{status:"failed"}}:R)}finally{ct(null)}},ts=async()=>{var n;if(v){K(!0);try{const g=Sr.current,d=Ct.current;if(!g){u.warn("No current character to save");return}const k=g.id&&d.find(w=>w.id===g.id),h=k?d.map(w=>w.id===g.id?g:w):[...d,g];u.info("Saving characters with relationships:",h.length);const j=!k&&!!((n=g.photos)!=null&&n.original);await Ee.saveCharacterData({characters:h,relationships:Qe,relationshipTexts:Ft,customRelationships:ft,customStrengths:[],customWeaknesses:[],customFears:[]},{includePhotos:j}),ar.current=!1,u.success("Character data saved successfully"),we(h),Ya(h);const T=h.find(w=>w.id===v.id);T&&Ee.needsAvatars(T)&&qt!==T.id&&(u.info(`ðŸŽ¨ Starting background avatar generation for ${T.name}...`),Ee.generateAndSaveAvatarForCharacter(T,void 0,{avatarModel:et.avatarModel||void 0}).then(w=>{w.success&&w.character?(we(A=>A.map(U=>U.id===T.id?{...U,avatars:w.character.avatars,physical:w.character.physical,clothing:w.character.clothing}:U)),u.success(`âœ… Avatars and traits saved for ${T.name}`)):w.skipped||(u.warn(`Avatar generation failed for ${T.name}: ${w.error}`),we(A=>A.map(U=>U.id===T.id?{...U,avatars:{status:"failed"}}:U)))}).catch(w=>{u.error(`âŒ Background avatar generation error for ${T.name}:`,w),we(A=>A.map(U=>U.id===T.id?{...U,avatars:{status:"failed"}}:U))})),Ce(null),Yt(!0)}catch(g){u.error("Failed to save character:",g),x(a==="de"?"Charakter konnte nicht gespeichert werden. Bitte versuche es erneut.":a==="fr"?"Ã‰chec de l'enregistrement du personnage. Veuillez rÃ©essayer.":"Failed to save character. Please try again.")}finally{K(!1)}}},ii=async n=>{Ce({...n}),at("traits"),Yt(!1);const g=await Ee.loadFullCharacter(n.id);g&&(Ce(d=>d&&d.id===n.id?{...d,...g}:d),we(d=>d.map(k=>k.id===n.id?{...k,...g}:k)))},oi=async n=>{try{const g=await Ee.deleteCharacter(n);g.success?(we(d=>d.filter(k=>k.id!==n)),_r(d=>{const k={...d};return Object.keys(k).forEach(h=>{(h.includes(`${n}-`)||h.includes(`-${n}`))&&delete k[h]}),k}),Rt(d=>{const k={...d};return Object.keys(k).forEach(h=>{(h.includes(`${n}-`)||h.includes(`-${n}`))&&delete k[h]}),k}),mt(d=>d.filter(k=>k!==n)),gr.current=!0,u.success(`Character ${n} deleted`)):(u.error("Failed to delete character:",g.error),x(a==="de"?"Charakter konnte nicht gelÃ¶scht werden":"Failed to delete character"))}catch(g){u.error("Failed to delete character:",g),x(a==="de"?"Charakter konnte nicht gelÃ¶scht werden":"Failed to delete character")}},li=(n,g,d)=>{const h=po(d,a),j=`${n}-${g}`,T=`${g}-${n}`;u.debug("Updating relationship:",j,"=",d,", inverse:",T,"=",h),ar.current=!0,_r(w=>({...w,[j]:d,[T]:h}))},di=(n,g)=>{ar.current=!0;const[d,k]=n.split("-").map(Number),h=`${k}-${d}`;Rt(j=>({...j,[n]:g,[h]:g}))},ci=(n,g)=>{ar.current=!0,ur(d=>[...d,{forward:n,inverse:g}])},mi=(n,g)=>{g==="out"?(Bt(d=>d.includes(n)?d:[...d,n]),mt(d=>d.filter(k=>k!==n))):g==="in"?(Bt(d=>d.filter(k=>k!==n)),mt(d=>d.filter(k=>k!==n))):g==="main"&&(Bt(d=>d.filter(k=>k!==n)),mt(d=>d.includes(n)?d:[...d,n])),gr.current=!0,we(d=>d.map(k=>k.id===n?{...k,storyRole:g}:k))},ui=async()=>{const[n,g,d]=await Promise.all([new Promise(h=>{we(j=>(h(j),j))}),new Promise(h=>{mt(j=>(h(j),j))}),new Promise(h=>{Bt(j=>(h(j),j))})]);if(n.length===0)return;if(!gr.current){u.debug("Roles not modified, skipping save");return}const k={};for(const h of n)g.includes(h.id)?k[h.id]="main":d.includes(h.id)?k[h.id]="out":k[h.id]="in";try{await Ee.saveCharacterRoles(k),gr.current=!1}catch(h){u.error("Failed to save character roles:",h)}},Yr=l.useRef(null),or=async n=>{n>=0&&n<=7&&(B===1&&v&&n!==1&&await ts(),B===1&&n!==1&&(Yr.current=(async()=>{await hi(),await ui()})(),Yr.current.catch(g=>u.error("Background save failed:",g))),n===1&&B!==1&&Ce(null),ie(n),window.scrollTo(0,0))},gi=n=>n===1?!0:n===2||n===3?ue.length>0:n===4?ue.length>0&&be!=="":n===5?ue.length>0&&be!==""&&ot!=="":n===6?$r!=="":!1,vr=()=>B===1?ue.length>0&&yt.length>0:B===2?!0:B===3?!(!be||be==="adventure"&&!Be||(be==="life-challenge"||be==="educational")&&!Re):B===4?ot!=="":B===5?ue.filter(g=>!Ze.includes(g.id)).length>0&&yt.length>0&&m.trim().length>0:!1,hi=async()=>{const n=await new Promise(g=>{we(d=>(g(d),d))});if(n.length!==0){if(!ar.current){u.debug("Relationships not modified, skipping save");return}try{u.debug("Auto-saving character data with latest state..."),await Ee.saveCharacterData({characters:n,relationships:Qe,relationshipTexts:Ft,customRelationships:ft,customStrengths:[],customWeaknesses:[],customFears:[]}),ar.current=!1,u.debug("Character data auto-saved")}catch(g){u.error("Failed to auto-save character data:",g)}}},xi=async()=>{if(B<5&&vr()){if(B===1&&ue.length===1){La(!0);return}await or(B+1)}},Fs=async()=>{B>0&&await or(B-1)},pi=(n,g)=>{Y(n),gs(g??null)},Rs=async()=>{pr.current&&pr.current.abort(),st(!0),ut(!0),kt(!0),Ar([]),Ra(null),Ba(""),gs(null);const n=ue.filter(g=>!Ze.includes(g.id));fn({storyType:tt,storyCategory:be||"",storyTopic:Re||"",storyTheme:Be||"",characters:n.map(g=>({id:g.id,name:g.name})),language:vt,languageLevel:bt,pages:r,userLocation:fr||void 0,season:yr||void 0}),pr.current=He.generateStoryIdeasStream({storyType:tt,storyTypeName:Xr(),storyCategory:be||void 0,storyTopic:Re||void 0,storyTheme:Be||void 0,customThemeText:Be==="custom"?St:void 0,language:vt,languageLevel:bt,pages:r,characters:n.map(g=>({name:g.name,age:g.age,gender:g.gender,traits:g.traits,isMain:yt.includes(g.id)})),relationships:Object.entries(Qe).map(([g,d])=>{const[k,h]=g.split("-").map(Number),j=n.find(w=>w.id===k),T=n.find(w=>w.id===h);return{character1:(j==null?void 0:j.name)||"",character2:(T==null?void 0:T.name)||"",relationship:d}}).filter(g=>g.character1&&g.character2),ideaModel:(b==null?void 0:b.role)==="admin"||C?et.ideaModel:void 0,userLocation:fr||void 0,season:yr},{onStatus:(g,d,k)=>{d&&k&&Ra({prompt:d,model:k})},onStory1:g=>{Ar(d=>{const k=[...d];return k[0]=g,k}),gt(100),ut(!1)},onStory2:g=>{Ar(d=>{const k=[...d];return k[1]=g,k}),kr(100),kt(!1)},onError:g=>{u.error("Failed to generate story ideas:",g),x(a==="de"?"Fehler beim Generieren von Ideen. Bitte versuchen Sie es erneut.":a==="fr"?"Erreur lors de la gÃ©nÃ©ration d'idÃ©es. Veuillez rÃ©essayer.":"Failed to generate ideas. Please try again."),st(!1),ut(!1),kt(!1)},onDone:g=>{st(!1),ut(!1),kt(!1),g&&Ba(g),pr.current=null,u.info("[IDEAS] onDone complete")}})},Xr=()=>{const n=ds.find(g=>g.id===tt);return n?n.name[a]:tt},jr=async n=>{var d,k,h,j,T,w,A,U,ce,ae,ye,Me,ve,je,q,Oe;if(console.log("[generateStory] Called with overrides:",n),console.log("[generateStory] user:",b==null?void 0:b.email,"emailVerified:",b==null?void 0:b.emailVerified,"isImpersonating:",C),Yr.current&&(await Yr.current,Yr.current=null),!(n!=null&&n.skipEmailCheck)&&!C&&b&&b.emailVerified!==!0){await D();const V=localStorage.getItem("currentUser");let E=b.emailVerified;if(V)try{E=JSON.parse(V).emailVerified}catch{}if(E===!0)console.log("[generateStory] Email verified (confirmed after refresh), proceeding");else{console.log("[generateStory] Email not verified, showing modal"),localStorage.setItem("pendingStoryGeneration","true"),localStorage.setItem("pending_story_type",tt),localStorage.setItem("pending_art_style",ot),ma(!0);return}}console.log("[generateStory] Starting generation, setting step to 6"),Pr(!0),ca(!1),ie(6),Ka({storyCategory:be||void 0,storyTopic:Re||void 0,storyTheme:Be||void 0,storyTypeName:Xr(),storyDetails:m||void 0,artStyle:ot||void 0,language:vt||void 0,languageLevel:bt||void 0,pages:r||void 0,dedication:f||void 0,characters:ue.filter(V=>!Ze.includes(V.id)).map(V=>({id:V.id,name:V.name})),mainCharacters:yt,relationships:Qe,relationshipTexts:Ft,season:yr||void 0,userLocation:fr||void 0}),qr(""),ir(""),Dt([]),ga([]),xa(null),pa({}),Gt({frontCover:null,initialPage:null,backCover:null});const g=ue.filter(V=>!Ze.includes(V.id)).filter(V=>!V.avatars||V.avatars.stale||V.avatars.status!=="complete");if(g.length>0){console.log("[generateStory] Characters needing avatar regeneration:",g.map(V=>V.name)),br({current:1,total:100,message:a==="de"?`Aktualisiere Avatare fÃ¼r ${g.length} Charakter(e)...`:a==="fr"?`Mise Ã  jour des avatars pour ${g.length} personnage(s)...`:`Updating avatars for ${g.length} character(s)...`});for(let V=0;V<g.length;V++){const E=g[V];try{console.log(`[generateStory] Regenerating avatars for ${E.name} (${V+1}/${g.length})`),br({current:2,total:100,message:a==="de"?`Generiere Avatare fÃ¼r ${E.name}...`:a==="fr"?`GÃ©nÃ©ration des avatars pour ${E.name}...`:`Generating avatars for ${E.name}...`});const z=await Ee.generateClothingAvatarsWithTraits(E);if(z.success&&z.avatars){const H={...z.avatars,stale:!1,generatedAt:new Date().toISOString()},R=E.physicalTraitsSource||{},J=z.extractedTraits?{...E.physical,height:(d=E.physical)==null?void 0:d.height,build:R.build==="user"?(k=E.physical)==null?void 0:k.build:z.extractedTraits.build,eyeColor:R.eyeColor==="user"?(h=E.physical)==null?void 0:h.eyeColor:z.extractedTraits.eyeColor,eyeColorHex:R.eyeColor==="user"?(j=E.physical)==null?void 0:j.eyeColorHex:z.extractedTraits.eyeColorHex,hairColor:R.hairColor==="user"?(T=E.physical)==null?void 0:T.hairColor:z.extractedTraits.hairColor,hairColorHex:R.hairColor==="user"?(w=E.physical)==null?void 0:w.hairColorHex:z.extractedTraits.hairColorHex,hairLength:R.hairLength==="user"?(A=E.physical)==null?void 0:A.hairLength:z.extractedTraits.hairLength,hairStyle:R.hairStyle==="user"?(U=E.physical)==null?void 0:U.hairStyle:z.extractedTraits.hairStyle,facialHair:R.facialHair==="user"?(ce=E.physical)==null?void 0:ce.facialHair:z.extractedTraits.facialHair,skinTone:R.skinTone==="user"?(ae=E.physical)==null?void 0:ae.skinTone:z.extractedTraits.skinTone,skinToneHex:R.skinTone==="user"?(ye=E.physical)==null?void 0:ye.skinToneHex:z.extractedTraits.skinToneHex,face:R.face==="user"?(Me=E.physical)==null?void 0:Me.face:z.extractedTraits.face,other:R.other==="user"?(ve=E.physical)==null?void 0:ve.other:z.extractedTraits.other,detailedHairAnalysis:z.extractedTraits.detailedHairAnalysis||((je=E.physical)==null?void 0:je.detailedHairAnalysis),apparentAge:R.apparentAge==="user"?(q=E.physical)==null?void 0:q.apparentAge:z.extractedTraits.apparentAge||((Oe=E.physical)==null?void 0:Oe.apparentAge)}:E.physical,Ie=z.extractedTraits?{...R,build:R.build==="user"?"user":z.extractedTraits.build?"extracted":void 0,eyeColor:R.eyeColor==="user"?"user":z.extractedTraits.eyeColor?"extracted":void 0,hairColor:R.hairColor==="user"?"user":z.extractedTraits.hairColor?"extracted":void 0,hairLength:R.hairLength==="user"?"user":z.extractedTraits.hairLength?"extracted":void 0,hairStyle:R.hairStyle==="user"?"user":z.extractedTraits.hairStyle?"extracted":void 0,face:R.face==="user"?"user":z.extractedTraits.face?"extracted":void 0,facialHair:R.facialHair==="user"?"user":z.extractedTraits.facialHair?"extracted":void 0,other:R.other==="user"?"user":z.extractedTraits.other?"extracted":void 0,skinTone:R.skinTone==="user"?"user":z.extractedTraits.skinTone?"extracted":void 0,apparentAge:R.apparentAge==="user"?"user":z.extractedTraits.apparentAge?"extracted":void 0}:E.physicalTraitsSource,O=z.extractedClothing?{...E.clothing,structured:{upperBody:z.extractedClothing.upperBody||void 0,lowerBody:z.extractedClothing.lowerBody||void 0,shoes:z.extractedClothing.shoes||void 0,fullBody:z.extractedClothing.fullBody||void 0}}:E.clothing;we(Te=>Te.map(oe=>oe.id===E.id?{...oe,avatars:H,physical:J,physicalTraitsSource:Ie,clothing:O}:oe)),Ce(Te=>Te&&Te.id===E.id?{...Te,avatars:H,physical:J,physicalTraitsSource:Ie,clothing:O}:Te),we(Te=>{const oe=Te.map(Le=>Le.id===E.id?{...Le,avatars:H,physical:J,physicalTraitsSource:Ie,clothing:O}:Le);return Ee.saveCharacterData({characters:oe,relationships:Qe,relationshipTexts:Ft,customRelationships:ft,customStrengths:[],customWeaknesses:[],customFears:[]}).catch(Le=>console.error("Failed to save avatar update:",Le)),oe}),console.log(`[generateStory] âœ… Avatars regenerated for ${E.name}`)}else console.warn(`[generateStory] âš ï¸ Failed to regenerate avatars for ${E.name}: ${z.error}`)}catch(z){console.error(`[generateStory] âŒ Error regenerating avatars for ${E.name}:`,z)}}}br({current:5,total:100,message:a==="de"?"Starte Generierung...":a==="fr"?"DÃ©marrage de la gÃ©nÃ©ration...":"Starting generation..."});try{const V=ue.filter(O=>!Ze.includes(O.id)),{jobId:E,creditsRemaining:z}=await He.createStoryJob({storyType:tt,storyTypeName:Xr(),storyCategory:be||void 0,storyTopic:Re||void 0,storyTheme:Be||void 0,customThemeText:Be==="custom"?St:void 0,artStyle:ot,language:vt,languageLevel:bt,pages:r,dedication:f,storyDetails:m,characters:V,mainCharacters:yt,relationships:Qe,relationshipTexts:Ft,skipImages:(n==null?void 0:n.skipImages)??se,imageGenMode:me,generationMode:Ne!=="auto"?Ne:void 0,skipOutline:re,skipText:it,skipSceneDescriptions:qe,skipCovers:Fe,enableAutoRepair:_e,enableFinalChecks:$t,checkOnlyMode:s,incrementalConsistency:Nr?{enabled:!0,dryRun:Rr,lookbackCount:3}:void 0,modelOverrides:(b==null?void 0:b.role)==="admin"||C?{outlineModel:et.outlineModel,textModel:et.textModel,sceneDescriptionModel:et.sceneDescriptionModel,imageModel:et.imageModel,coverImageModel:et.coverImageModel,qualityModel:et.qualityModel}:void 0,userLocation:fr||void 0,season:yr||void 0,ideaGeneration:hs&&xr&&sr.length>0?{input:hs,output:sr,prompt:xr.prompt,model:xr.model,selectedIndex:pn}:void 0});ha(E),u.info("Story job created:",E),P(E,Xr()||"New Story"),z!=null&&c(z);let H=!1,R=0,J=Date.now();const Ie=180*1e3;for(Tr(!1);!H;){await new Promise(Te=>setTimeout(Te,2e3));const O=await He.getJobStatus(E);if(O.progress&&(O.progress.current!==R?(u.debug(`Progress: ${O.progress.current}% - ${O.progress.message||""}`),R=O.progress.current,J=Date.now(),Tr(!1)):Date.now()-J>=Ie&&Tr(!0),br(Te=>O.progress.current>=Te.current?O.progress:O.progress.message?{...Te,message:O.progress.message}:Te)),O.partialCovers){let Te=!1;Gt(oe=>{var Ke,nt,va;const Le={...oe};if((Ke=O.partialCovers)!=null&&Ke.frontCover&&!oe.frontCover){Le.frontCover=O.partialCovers.frontCover,u.debug("Front cover received during streaming");const Et=O.partialCovers.frontCover;typeof Et=="object"&&(Et!=null&&Et.storyTitle)&&(ir(Et.storyTitle),u.debug(`Story title from front cover: ${Et.storyTitle}`)),Te=!0}return(nt=O.partialCovers)!=null&&nt.initialPage&&!oe.initialPage&&(Le.initialPage=O.partialCovers.initialPage,u.debug("Initial page cover received during streaming")),(va=O.partialCovers)!=null&&va.backCover&&!oe.backCover&&(Le.backCover=O.partialCovers.backCover,u.debug("Back cover received during streaming")),Le}),Te&&(u.debug("Transitioning to StoryDisplay - front cover ready"),ie(6))}if(O.storyText&&!Nt&&(xa(O.storyText),ir(O.storyText.title),u.debug(`Story text received: ${O.storyText.totalPages} pages ready for display`)),O.partialPages&&O.partialPages.length>0&&pa(Te=>{var Ke;const oe={...Te};let Le=0;return(Ke=O.partialPages)==null||Ke.forEach(nt=>{nt.imageData&&!Te[nt.pageNumber]&&(oe[nt.pageNumber]=nt.imageData,Le++)}),Le>0&&u.debug(`${Le} new page images received (total: ${Object.keys(oe).length})`),oe}),console.log("[StoryWizard] Job status check:",{status:O.status,hasResult:!!O.result,resultKeys:O.result?Object.keys(O.result):[],progress:O.progress}),O.status==="completed"&&O.result)qa(O.result.storyId),ir(O.result.title),vs(O.result.outline),js(O.result.outlinePrompt||""),Ns(O.result.outlineModelId),ws(O.result.outlineUsage),Ss(O.result.storyTextPrompts||[]),Oa(O.result.styledAvatarGeneration||[]),_a(O.result.costumedAvatarGeneration||[]),Wa(O.result.generationLog||[]),Cs(O.result.finalChecksReport||null),O.result.visualBible?Ur({mainCharacters:O.result.visualBible.mainCharacters||[],secondaryCharacters:O.result.visualBible.secondaryCharacters||[],animals:O.result.visualBible.animals||[],artifacts:O.result.visualBible.artifacts||[],locations:O.result.visualBible.locations||[],vehicles:O.result.visualBible.vehicles||[],clothing:O.result.visualBible.clothing||[],changeLog:O.result.visualBible.changeLog||[]}):Ur(null),O.result.clothingRequirements?ua(O.result.clothingRequirements):ua(null),qr(O.result.story),bs(O.result.story),ga(O.result.sceneDescriptions||[]),Dt(O.result.sceneImages||[]),Gt(O.result.coverImages||{frontCover:null,initialPage:null,backCover:null}),xa(null),pa({}),H=!0,O.currentCredits!==null&&O.currentCredits!==void 0&&c(O.currentCredits),ie(6),u.success("Story generation completed!"),Ka({storyCategory:be||void 0,storyTopic:Re||void 0,storyTheme:Be||void 0,storyTypeName:Xr(),storyDetails:m||void 0,artStyle:ot||void 0,language:vt||void 0,languageLevel:bt||void 0,pages:r||void 0,dedication:f||void 0,characters:ue.map(Te=>({id:Te.id,name:Te.name})),mainCharacters:yt,relationships:Qe,relationshipTexts:Ft,season:yr||void 0,userLocation:fr||void 0}),Ja.current=!0,F();else if(O.status==="failed")throw new Error(O.error||"Story generation failed")}br({current:100,total:100,message:a==="de"?"Fertig!":a==="fr"?"TerminÃ©!":"Complete!"})}catch(V){u.error("Generation failed:",V);const E=V instanceof Error?V.message:String(V);if(E.includes("already in progress")){const z=E.match(/\|ACTIVE_JOB:(job_[a-z0-9_]+)/i),H=z?z[1]:null,R=a==="de"?"Eine Geschichte wird bereits erstellt. MÃ¶chtest du diese abbrechen und eine neue starten?":a==="fr"?"Une histoire est dÃ©jÃ  en cours de crÃ©ation. Voulez-vous l'annuler et en commencer une nouvelle?":"A story is already being generated. Would you like to cancel it and start a new one?";if(H&&window.confirm(R))try{await He.cancelJob(H),u.info("Cancelled existing job:",H),await jr(n);return}catch(J){u.error("Failed to cancel existing job:",J),x(a==="de"?"Abbrechen fehlgeschlagen. Bitte versuche es spÃ¤ter erneut.":a==="fr"?"Ã‰chec de l'annulation. Veuillez rÃ©essayer plus tard.":"Failed to cancel. Please try again later.")}Pr(!1);return}else x(a==="de"?`Generierung fehlgeschlagen: ${E}`:a==="fr"?`Ã‰chec de la gÃ©nÃ©ration: ${E}`:`Generation failed: ${E}`)}finally{Tr(!1),F(),setTimeout(()=>Pr(!1),500)}};l.useEffect(()=>{if(ba.current&&y&&ue.length>0&&B===5&&!nr){ba.current=!1;const n=localStorage.getItem("verificationGenerationStarted");if(n){const d=parseInt(n,10),k=Date.now()-120*1e3;if(d>k){console.log("Another window already started generation, skipping auto-generate");return}localStorage.removeItem("verificationGenerationStarted")}localStorage.setItem("verificationGenerationStarted",Date.now().toString()),(async()=>{await D(),setTimeout(()=>{jr({skipEmailCheck:!0})},500)})()}},[y,ue,B,nr,D]);const fi=()=>{switch(B){case 1:return e.jsx(Co,{characters:ue,currentCharacter:v,characterStep:Vt,showCharacterCreated:pt,isLoading:te,isAnalyzingPhoto:Br,isGeneratingAvatar:qt===(v==null?void 0:v.id),isRegeneratingAvatars:Xt,isRegeneratingAvatarsWithTraits:Da,developerMode:xe,isImpersonating:C,changedTraits:Ea,photoAnalysisDebug:ia,mainCharacters:yt,excludedCharacters:Ze,onCharacterRoleChange:mi,onCharacterChange:Ce,onCharacterStepChange:at,onContinueToAvatar:()=>at("avatar"),onPhotoSelect:Xn,onSaveAndGenerateAvatar:ni,onSaveCharacter:ts,onEditCharacter:ii,onDeleteCharacter:oi,onStartNewCharacter:es,onRegenerateAvatars:ri,onRegenerateAvatarsWithTraits:ai,onSaveAndRegenerateWithTraits:si,onSaveAndTryNewPhoto:async()=>{var d;if(u.info(`ðŸ“¸ onSaveAndTryNewPhoto called, currentCharacter: ${v==null?void 0:v.name}`),!v){u.warn("ðŸ“¸ No currentCharacter, returning early");return}K(!0);try{const k=v.id&&ue.find(T=>T.id===v.id),h=k?ue.map(T=>T.id===v.id?v:T):[...ue,v],j=!k&&!!((d=v.photos)!=null&&d.original);await Ee.saveCharacterData({characters:h,relationships:Qe,relationshipTexts:Ft,customRelationships:ft,customStrengths:[],customWeaknesses:[],customFears:[]},{includePhotos:j}),we(h),Ya(h),u.info(`ðŸ“¸ Setting characterStep to 'photo', currentCharacter still: ${v==null?void 0:v.name}`),at("photo")}catch(k){u.error("ðŸ“¸ Error saving character:",k)}finally{K(!1),u.info("ðŸ“¸ onSaveAndTryNewPhoto complete, characterStep should now be 'photo'")}},relationships:Qe,relationshipTexts:Ft,onRelationshipChange:li,onRelationshipTextChange:di,customRelationships:ft,onAddCustomRelationship:ci});case 2:return e.jsx(ko,{languageLevel:bt,onLanguageLevelChange:hr,pages:r,onPagesChange:S,storyLanguage:vt,onStoryLanguageChange:Wr,developerMode:xe,userLocation:fr,onLocationChange:xs,season:yr,onSeasonChange:yn,userCredits:C?-1:(b==null?void 0:b.credits)??0});case 3:return e.jsx(Ao,{storyCategory:be,storyTopic:Re,storyTheme:Be,customThemeText:St,onCategoryChange:qn,onTopicChange:Kn,onThemeChange:Un,onCustomThemeTextChange:Zt,onLegacyStoryTypeChange:dt});case 4:return e.jsx(Po,{artStyle:ot,onArtStyleChange:Jn});case 5:return e.jsx(To,{characters:ue,mainCharacters:yt,excludedCharacters:Ze,storyCategory:be,storyTopic:Re,storyTheme:Be,customThemeText:St,onCustomThemeTextChange:Zt,artStyle:ot,storyLanguage:vt,languageLevel:bt,pages:r,userLocation:fr,season:yr,storyDetails:m,onStoryDetailsChange:Y,dedication:f,onDedicationChange:G,onGenerateIdeas:Rs,isGeneratingIdeas:pe,isGeneratingIdea1:jt,isGeneratingIdea2:Mt,ideaProgress1:le,ideaProgress2:da,ideaPrompt:xr,ideaFullResponse:xn,generatedIdeas:sr,onSelectIdea:pi,onUseDirectly:()=>jr(),onEditStep:or,developerMode:xe,imageGenMode:me,onImageGenModeChange:ge,generationMode:Ne,onGenerationModeChange:Se});case 6:const n=Kr.frontCover||Kr.initialPage||Object.keys(Qa).length>0||Va.some(d=>d.imageData);if($r&&n||Nt&&n||nr&&n){const d=$r?Va:Object.entries(Qa).map(([h,j])=>{var T;return{pageNumber:parseInt(h),imageData:j,description:((T=Nt==null?void 0:Nt.sceneDescriptions.find(w=>w.pageNumber===parseInt(h)))==null?void 0:T.description)||""}}),k=$r||Object.entries((Nt==null?void 0:Nt.pageTexts)||{}).sort(([h],[j])=>parseInt(h)-parseInt(j)).map(([h,j])=>`--- Page ${h} ---
${j}`).join(`

`);return e.jsxs(e.Fragment,{children:[Lt&&Lt.total>0&&e.jsxs("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 bg-white/95 backdrop-blur-sm rounded-full shadow-lg px-4 py-2 flex items-center gap-3 border border-indigo-100",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300 ease-out",style:{width:`${Lt.loaded/Lt.total*100}%`}})}),e.jsx("span",{className:"text-sm text-gray-600 whitespace-nowrap",children:a==="de"?`Bilder: ${Lt.loaded}/${Lt.total}`:a==="fr"?`Images: ${Lt.loaded}/${Lt.total}`:`Images: ${Lt.loaded}/${Lt.total}`})]}),e.jsx(no,{title:Ha,story:k,originalStory:An,outline:Pn,outlinePrompt:Tn,outlineModelId:$n,outlineUsage:In,storyTextPrompts:Dn,visualBible:En||void 0,sceneImages:d,sceneDescriptions:(Nt==null?void 0:Nt.sceneDescriptions)||Ln,characters:wr||ue.filter(h=>!Ze.includes(h.id)),progressiveMode:nr,progressiveData:Nt||void 0,completedPageImages:Qa,coverImages:Kr,regeneratingCovers:bn,languageLevel:bt,storyLanguage:vt,isGenerating:nr,developerMode:xe,styledAvatarGeneration:Fn,costumedAvatarGeneration:Rn,generationLog:Bn,finalChecksReport:Mn,clothingRequirements:zn||void 0,storyId:ke,onVisualBibleChange:ke?async h=>{try{u.info("Updating Visual Bible for story:",ke),await He.updateVisualBible(ke,h),Ur(h),u.success("Visual Bible updated successfully")}catch(j){u.error("Failed to update Visual Bible:",j),x(a==="de"?"Visual Bible konnte nicht aktualisiert werden":a==="fr"?"Ã‰chec de la mise Ã  jour de la Bible Visuelle":"Failed to update Visual Bible")}}:void 0,onRegenerateImage:ke?async(h,j,T)=>{var w;try{u.info("Regenerating image for page:",h,j?"(scene edited)":"",T?`(${T.length} characters)`:"");const A=await He.regenerateImage(ke,h,j,T);if(u.info("Regenerate result:",{hasImageData:!!(A!=null&&A.imageData),length:(w=A==null?void 0:A.imageData)==null?void 0:w.length,versionCount:A==null?void 0:A.versionCount,creditsRemaining:A==null?void 0:A.creditsRemaining}),!(A!=null&&A.imageData))throw u.error("No imageData in response!",A),new Error("No image data returned from server");Dt(U=>U.map(ce=>ce.pageNumber===h?{...ce,imageData:A.imageData,description:A.newDescription||ce.description,prompt:A.newPrompt,qualityScore:A.qualityScore,qualityReasoning:A.qualityReasoning,totalAttempts:A.totalAttempts,retryHistory:A.retryHistory,wasRegenerated:!0,originalImage:A.originalImage,originalScore:A.originalScore,originalReasoning:A.originalReasoning,imageVersions:A.imageVersions}:ce)),A.creditsRemaining!==void 0&&c&&c(A.creditsRemaining),u.info("Image regenerated successfully, updated state")}catch(A){u.error("Image regeneration failed:",A);const U=A instanceof Error?A.message:String(A);x(a==="de"?`Bildgenerierung fehlgeschlagen: ${U}`:a==="fr"?`Ã‰chec de la rÃ©gÃ©nÃ©ration: ${U}`:`Image regeneration failed: ${U}`)}}:void 0,onDownloadTxt:()=>{const h=new Blob([$r],{type:"text/plain"}),j=URL.createObjectURL(h),T=document.createElement("a");T.href=j,T.download=`${Ha}.txt`,T.click(),URL.revokeObjectURL(j)},onDownloadPdf:ke?async h=>{try{const j=await He.generatePdf(ke,h),T=URL.createObjectURL(j),w=document.createElement("a");w.href=T,w.download=`${Ha}.pdf`,w.click(),URL.revokeObjectURL(T)}catch(j){u.error("PDF download failed:",j),x(a==="de"?"PDF-Download fehlgeschlagen":a==="fr"?"Ã‰chec du tÃ©lÃ©chargement PDF":"PDF download failed")}}:void 0,onAddToBook:ke?()=>{try{const h=sessionStorage.getItem("mystories_selected"),j=h?JSON.parse(h):[];j.includes(ke)||(j.push(ke),sessionStorage.setItem("mystories_selected",JSON.stringify(j))),u.info("Added story to book selection:",ke),p(a==="de"?"Geschichte zum Buch hinzugefÃ¼gt. Du kannst weitere hinzufÃ¼gen oder das Buch bestellen.":a==="fr"?"Histoire ajoutÃ©e au livre. Vous pouvez en ajouter d'autres ou commander le livre.":"Story added to book. You can add more or order the book.",a==="de"?"Zum Buch hinzugefÃ¼gt":a==="fr"?"AjoutÃ© au livre":"Added to Book"),t("/stories")}catch(h){u.error("Failed to add story to selection:",h)}}:void 0,onPrintBook:ke?async()=>{let h=await Wi.getShippingAddress();if(!h){const w=prompt(a==="de"?"Keine Adresse gespeichert. Bitte eingeben (Format: Vorname, Nachname, Strasse, PLZ, Ort, Land, Email):":a==="fr"?"Aucune adresse enregistrÃ©e. Veuillez entrer (Format: PrÃ©nom, Nom, Rue, CP, Ville, Pays, Email):":"No saved address. Please enter (Format: FirstName, LastName, Street, PostCode, City, Country, Email):");if(!w)return;const A=w.split(",").map(U=>U.trim());if(A.length<7){x(a==="de"?"UngÃ¼ltiges Adressformat":a==="fr"?"Format d'adresse invalide":"Invalid address format");return}h={firstName:A[0],lastName:A[1],addressLine1:A[2],postCode:A[3],city:A[4],country:A[5],email:A[6]}}const j=`${h.firstName} ${h.lastName}
${h.addressLine1}
${h.postCode} ${h.city}
${h.country}`,T=a==="de"?`Druckauftrag an folgende Adresse senden?

${j}`:a==="fr"?`Envoyer la commande Ã  cette adresse?

${j}`:`Send print order to this address?

${j}`;if(confirm(T))try{u.info("Creating print order for story:",ke);const w=await He.createPrintOrder(ke,{firstName:h.firstName,lastName:h.lastName,addressLine1:h.addressLine1,city:h.city,postCode:h.postCode,country:h.country,email:h.email||""}),A=a==="de"?`âœ… Druckauftrag erfolgreich erstellt!

Order ID: ${w.orderId}
${w.isDraft?"(Entwurf - muss in Gelato bestÃ¤tigt werden)":""}

MÃ¶chten Sie das Gelato Dashboard Ã¶ffnen, um den Auftrag zu verfolgen?`:a==="fr"?`âœ… Commande d'impression crÃ©Ã©e avec succÃ¨s!

ID de commande: ${w.orderId}
${w.isDraft?"(Brouillon - doit Ãªtre confirmÃ© dans Gelato)":""}

Voulez-vous ouvrir le tableau de bord Gelato pour suivre la commande?`:`âœ… Print order created successfully!

Order ID: ${w.orderId}
${w.isDraft?"(Draft - must be confirmed in Gelato)":""}

Would you like to open the Gelato dashboard to track your order?`;w.dashboardUrl&&confirm(A)?window.open(w.dashboardUrl,"_blank"):w.dashboardUrl||p(a==="de"?`Druckauftrag erstellt! Order ID: ${w.orderId}`:a==="fr"?`Commande crÃ©Ã©e! ID: ${w.orderId}`:`Print order created! Order ID: ${w.orderId}`)}catch(w){u.error("Print order failed:",w);const A=w instanceof Error?w.message:String(w);x(a==="de"?`Druckauftrag fehlgeschlagen: ${A}`:a==="fr"?`Ã‰chec de la commande d'impression: ${A}`:`Print order failed: ${A}`)}}:void 0,onCreateAnother:()=>{u.info("Creating new story - resetting settings"),qa(null),ha(null),rt(null);const h=new URLSearchParams(o);h.delete("storyId"),i(h,{replace:!0}),qr(""),ir(""),ga([]),Dt([]),Gt({frontCover:null,initialPage:null,backCover:null}),ks(!1),As(void 0),Ps(void 0),Ts(void 0),dt(""),Qt(""),_t(""),dr(""),Wt("watercolor"),hr("standard"),S(30),G(""),Y(""),mt([]),localStorage.removeItem("story_type"),localStorage.removeItem("story_category"),localStorage.removeItem("story_topic"),localStorage.removeItem("story_theme"),localStorage.removeItem("story_art_style"),localStorage.removeItem("story_language_level"),localStorage.removeItem("story_pages"),localStorage.removeItem("story_dedication"),localStorage.removeItem("story_details"),localStorage.removeItem("story_main_characters"),localStorage.removeItem("wizard_step"),localStorage.removeItem("verificationGenerationStarted"),Ce(null),at("photo"),ie(1)},onRegenerateCover:ke?async(h,j)=>{const T=h==="front"?"frontCover":h==="back"?"backCover":"initialPage";try{u.info("Regenerating cover:",h,j?`with scene: "${j.substring(0,50)}..."`:""),ps(A=>new Set(A).add(T));const w=await He.regenerateCover(ke,h,j);Gt(A=>A&&{...A,[h==="front"?"frontCover":h==="back"?"backCover":"initialPage"]:{imageData:w.imageData,description:w.description,prompt:w.prompt,qualityScore:w.qualityScore,qualityReasoning:w.qualityReasoning,totalAttempts:w.totalAttempts,retryHistory:w.retryHistory}}),w.creditsRemaining!==void 0&&c&&c(w.creditsRemaining),u.info("Cover regenerated successfully")}catch(w){u.error("Cover regeneration failed:",w);const A=w instanceof Error?w.message:String(w);x(a==="de"?`Cover-Generierung fehlgeschlagen: ${A}`:a==="fr"?`Ã‰chec de la rÃ©gÃ©nÃ©ration: ${A}`:`Cover regeneration failed: ${A}`)}finally{ps(w=>{const A=new Set(w);return A.delete(T),A})}}:void 0,onEditImage:h=>{ya({type:"image",pageNumber:h}),Qr(""),fa(!0)},onEditCover:h=>{ya({type:"cover",coverType:h}),Qr(""),fa(!0)},onRepairImage:ke&&((b==null?void 0:b.role)==="admin"||C)?async h=>{var j,T,w;try{u.info("Starting auto-repair for page:",h);const A=Va.find(ae=>ae.pageNumber===h);let U=A==null?void 0:A.fixTargets;if(!U||U.length===0){const ae=(T=(j=A==null?void 0:A.retryHistory)==null?void 0:j.filter(ye=>ye.type==="auto_repair"))==null?void 0:T.slice(-1)[0];(w=ae==null?void 0:ae.preRepairEval)!=null&&w.fixTargets&&ae.preRepairEval.fixTargets.length>0&&(U=ae.preRepairEval.fixTargets,u.info(`Using ${U.length} fix targets from retryHistory.preRepairEval`))}U&&U.length>0?u.info(`Using ${U.length} existing fix targets`):u.info("No stored fix targets found, will re-evaluate");const ce=await He.repairImage(ke,h,U);ce.repaired?(Dt(ae=>ae.map(ye=>ye.pageNumber===h?{...ye,imageData:ce.imageData,wasAutoRepaired:!0,repairHistory:ce.repairHistory,repairedAt:new Date().toISOString()}:ye)),u.info("Auto-repair completed successfully:",{repaired:ce.repaired,repairs:ce.repairHistory.length})):ce.noErrorsFound&&u.info("No physics errors detected in the image")}catch(A){throw u.error("Auto-repair failed:",A),A}}:void 0,onRevertRepair:ke&&((b==null?void 0:b.role)==="admin"||C)?async(h,j)=>{try{u.info("Reverting repair for page:",h),Dt(T=>T.map(w=>w.pageNumber===h?{...w,imageData:j,wasAutoRepaired:!1}:w)),await He.updateSceneImage(ke,h,j),u.info("Repair reverted successfully")}catch(T){throw u.error("Failed to revert repair:",T),T}}:void 0,onSaveStoryText:ke?async h=>{try{u.info("Saving story text for story:",ke),await He.saveStoryText(ke,h),qr(h),u.info("Story text saved successfully")}catch(j){throw u.error("Failed to save story text:",j),j}}:void 0,onSaveTitleChange:ke?async h=>{try{u.info("Saving title for story:",ke,h),await He.saveStoryTitle(ke,h),ir(h),u.info("Title saved successfully")}catch(j){throw u.error("Failed to save title:",j),j}}:void 0,userCredits:C?-1:(b==null?void 0:b.credits)||0,imageRegenerationCost:5,isImpersonating:C,onSelectImageVersion:ke?async(h,j)=>{try{u.info("Selecting image version:",{pageNumber:h,versionIndex:j});const T=await He.setActiveImage(ke,h,j);Dt(w=>w.map(A=>{if(A.pageNumber===h&&A.imageVersions){const U=A.imageVersions[j];return{...A,imageData:(U==null?void 0:U.imageData)||A.imageData,imageVersions:A.imageVersions.map((ce,ae)=>({...ce,isActive:ae===j}))}}return A})),u.info("Image version selected:",T)}catch(T){throw u.error("Failed to select image version:",T),T}}:void 0,isPartial:Gn,failureReason:Hn,generatedPages:On,totalPages:_n,generationSettings:Wn||void 0})]})}return o.get("storyId")?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center",children:[e.jsx(wt,{className:"w-12 h-12 text-indigo-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:a==="de"?"Geschichte wird geladen...":a==="fr"?"Chargement de l'histoire...":"Loading story..."})]}):nr?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-indigo-700",children:a==="de"?"Geschichte wird erstellt...":a==="fr"?"CrÃ©ation de l'histoire...":"Creating your story..."}),e.jsx("p",{className:"text-indigo-500 mt-2",children:a==="de"?"Einen Moment Geduld bitte":a==="fr"?"Veuillez patienter":"Please wait a moment"})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Fr,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:N.generateStory}),e.jsx("p",{className:"text-gray-600 mb-6",children:a==="de"?"Bereit, deine Geschichte zu erstellen!":a==="fr"?"PrÃªt Ã  crÃ©er votre histoire!":"Ready to create your story!"}),e.jsxs(Aa,{onClick:()=>jr(),size:"lg",icon:Fr,children:[N.generateStory," (",r*10," Credits)"]})]});default:return null}};return y?e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(Si,{currentStep:B,onStepClick:or,canAccessStep:gi,developerMode:xe,onDeveloperModeChange:fe,hideSteps:B===6&&!!ke,onShowGenerationProgress:()=>{ca(!1),ie(6)}}),e.jsx("div",{className:"px-3 md:px-8 mt-2 md:mt-8 flex-1",children:e.jsxs("div",{className:"md:bg-white md:rounded-2xl md:shadow-xl md:p-8",children:[te&&!nr?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center",children:[e.jsx(wt,{className:"w-12 h-12 text-indigo-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium mb-2",children:$?a==="de"?"Geschichte wird geladen...":a==="fr"?"Chargement de l'histoire...":"Loading story...":a==="de"?"Wird geladen...":a==="fr"?"Chargement...":"Loading..."}),$&&e.jsxs("div",{className:"w-64 mt-2",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all duration-300 ease-out",style:{width:$.total?`${Math.min(100,$.loaded/$.total*100)}%`:"100%"}})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2 text-center",children:[($.loaded/(1024*1024)).toFixed(1)," MB",$.total&&e.jsxs("span",{children:[" (",Math.round($.loaded/$.total*100),"%)"]})]})]})]}):e.jsxs(e.Fragment,{children:[B>=1&&B<=5&&!v&&e.jsx(Ji,{step:B,text:(on[a]||on.en)[B]}),e.jsx(l.Suspense,{fallback:e.jsx(Ms,{}),children:fi()})]}),B<6&&!v&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[B===1&&ue.length>=2&&!Qn()&&(()=>{const n=Zn();if(!n)return null;const g=a==="de"?`${n.name} hat Beziehungen, die nicht definiert sind ("nicht bekannt")`:a==="fr"?`${n.name} a des relations non dÃ©finies ("ne connaÃ®t pas")`:`${n.name} has undefined relationships ("not known to")`;return e.jsxs("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-600 text-lg",children:"âš ï¸"}),e.jsx("p",{className:"text-amber-700 text-sm",children:g})]})})(),B!==5&&e.jsxs("div",{className:`flex ${B===1?"justify-end":"justify-between"}`,children:[B>1&&e.jsxs("button",{onClick:Fs,className:"bg-transparent text-gray-800 hover:bg-gray-100 px-6 py-3 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(Vs,{size:20})," ",N.back]}),e.jsxs("button",{onClick:xi,disabled:!vr(),className:`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${vr()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[N.next," ",e.jsx(Di,{size:20})]})]}),B===5&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>jr(),disabled:!vr(),className:`w-full py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 ${vr()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-400 text-white cursor-not-allowed"}`,children:[e.jsx(Fr,{size:20})," ",N.generateStory," (",r*10," Credits)"]}),xe&&e.jsxs("button",{onClick:()=>jr({skipImages:!0}),disabled:!vr(),className:`w-full py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 ${vr()?"bg-yellow-500 text-white hover:bg-yellow-600":"bg-gray-400 text-white cursor-not-allowed"}`,children:[e.jsx(Fr,{size:20}),a==="de"?"Nur Text generieren (ohne Bilder)":a==="fr"?"GÃ©nÃ©rer le texte uniquement (sans images)":"Generate Text Only (no images)"]}),xe&&e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg text-left",children:[e.jsxs("h3",{className:"text-sm font-semibold text-orange-700 mb-3",children:["ðŸ› ï¸ ",a==="de"?"Entwickler-Optionen - Schritte Ã¼berspringen":a==="fr"?"Options dÃ©veloppeur - Sauter des Ã©tapes":"Developer Options - Skip Steps"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:re,onChange:n=>$e(n.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:a==="de"?"Gliederung Ã¼berspringen":a==="fr"?"Sauter le plan":"Skip outline generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:it,onChange:n=>Ae(n.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:a==="de"?"Text Ã¼berspringen":a==="fr"?"Sauter le texte":"Skip text generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:qe,onChange:n=>de(n.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:a==="de"?"Szenenbeschreibungen Ã¼berspringen":a==="fr"?"Sauter les descriptions de scÃ¨nes":"Skip scene descriptions"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se,onChange:n=>M(n.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:a==="de"?"Bilder Ã¼berspringen":a==="fr"?"Sauter les images":"Skip image generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Fe,onChange:n=>Ue(n.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:a==="de"?"Cover Ã¼berspringen":a==="fr"?"Sauter les couvertures":"Skip cover images"})]})]}),e.jsx("p",{className:"text-xs text-orange-600 mt-2",children:a==="de"?"Hinweis: Ãœbersprungene Schritte verwenden Platzhalter/leere Daten":a==="fr"?"Note: Les Ã©tapes sautÃ©es utiliseront des donnÃ©es vides/provisoires":"Note: Skipped steps will use placeholder/empty data"}),e.jsxs("h3",{className:"text-sm font-semibold text-orange-700 mt-4 mb-2",children:["ðŸ”§ ",a==="de"?"Feature-Optionen":a==="fr"?"Options de fonctionnalitÃ©s":"Feature Options"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:_e,onChange:n=>Tt(n.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:a==="de"?"Auto-Reparatur aktivieren":a==="fr"?"Activer la rÃ©paration auto":"Enable auto-repair"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:a==="de"?"Versucht erkannte Bildfehler automatisch zu korrigieren (z.B. fehlende Finger)":a==="fr"?"Essaie de corriger automatiquement les erreurs d'image dÃ©tectÃ©es":"Attempts to automatically fix detected image issues (e.g., missing fingers)"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2",children:[e.jsx("input",{type:"checkbox",checked:$t,onChange:n=>lt(n.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:a==="de"?"KonsistenzprÃ¼fung aktivieren":a==="fr"?"Activer la vÃ©rification de cohÃ©rence":"Enable final checks"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:a==="de"?"PrÃ¼ft Bilder und Text auf Konsistenz am Ende der Generierung":a==="fr"?"VÃ©rifie la cohÃ©rence des images et du texte Ã  la fin de la gÃ©nÃ©ration":"Checks images and text for consistency at end of generation"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2",children:[e.jsx("input",{type:"checkbox",checked:Nr,onChange:n=>na(n.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:a==="de"?"Inkrementelle Konsistenz":a==="fr"?"CohÃ©rence incrÃ©mentielle":"Incremental consistency"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:a==="de"?"PrÃ¼ft jedes Bild gegen vorherige Bilder wÃ¤hrend der Generierung":a==="fr"?"VÃ©rifie chaque image par rapport aux images prÃ©cÃ©dentes pendant la gÃ©nÃ©ration":"Checks each image against previous images during generation"}),Nr&&e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2 ml-6",children:[e.jsx("input",{type:"checkbox",checked:Rr,onChange:n=>Ia(n.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:a==="de"?"Nur Protokoll (Dry Run)":a==="fr"?"Journaliser seulement (Dry Run)":"Dry run (log only)"})]}),Nr&&e.jsx("p",{className:"text-xs text-gray-500 ml-12",children:a==="de"?"Zeigt nur an, was repariert wÃ¼rde, ohne tatsÃ¤chlich zu reparieren":a==="fr"?"Affiche uniquement ce qui serait rÃ©parÃ© sans effectuer de rÃ©parations":"Shows what would be fixed without actually fixing"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-4",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:n=>Pe(n.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:a==="de"?"Nur PrÃ¼fung (keine Regenerierung)":a==="fr"?"VÃ©rification seule (pas de rÃ©gÃ©nÃ©ration)":"Check only (no regeneration)"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:a==="de"?"FÃ¼hrt alle QualitÃ¤tsprÃ¼fungen durch, Ã¼berspringt aber Regenerierung/Reparatur":a==="fr"?"ExÃ©cute toutes les vÃ©rifications de qualitÃ© mais ignore la rÃ©gÃ©nÃ©ration/rÃ©paration":"Runs all quality checks but skips regeneration/repair"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2",children:[e.jsx("input",{type:"checkbox",checked:We,onChange:n=>he(n.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:a==="de"?"Alle Avatare laden":a==="fr"?"Charger tous les avatars":"Load all avatars"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:a==="de"?"LÃ¤dt alle Avatar-Varianten (30MB+). NÃ¼tzlich zum Debuggen.":a==="fr"?"Charge toutes les variantes d'avatar (30MB+). Utile pour le dÃ©bogage.":"Loads all avatar variants (30MB+). Useful for debugging."})]}),xe&&((b==null?void 0:b.role)==="admin"||C)&&e.jsx(co,{selections:et,onChange:xt}),e.jsxs("button",{onClick:Fs,className:"bg-transparent text-gray-800 hover:bg-gray-100 px-6 py-3 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(Vs,{size:20})," ",N.back]})]})]})]})}),nr&&!$r&&!Nt&&!Kr.frontCover&&!jn&&e.jsx(Qi,{current:Ga.current,total:Ga.total,message:Ga.message,coverImages:Kr,characters:ue,jobId:Ua||void 0,isStalled:kn,onDismissStalled:()=>Tr(!1),isImpersonating:C,onMinimize:()=>Ma(!0),onCancel:Ua?async()=>{try{await He.cancelJob(Ua),u.info("Job cancelled by user"),Pr(!1),ha(null),Tr(!1),br({current:0,total:0,message:""}),I(a==="de"?"Generierung abgebrochen":a==="fr"?"GÃ©nÃ©ration annulÃ©e":"Generation cancelled")}catch(n){u.error("Failed to cancel job:",n),x(a==="de"?"Abbruch fehlgeschlagen":a==="fr"?"Ã‰chec de l'annulation":"Failed to cancel")}}:void 0}),Nn&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-sm mx-4 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:a==="de"?"Geschichte wird im Hintergrund generiert":a==="fr"?"Histoire en cours de gÃ©nÃ©ration":"Story generating in background"}),e.jsx("p",{className:"text-gray-600 mb-6",children:a==="de"?"Was mÃ¶chtest du tun?":a==="fr"?"Que voulez-vous faire?":"What would you like to do?"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{ca(!0),Ma(!1),t("/create?new=true")},className:"w-full py-3 px-4 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors font-medium",children:a==="de"?"Neue Geschichte erstellen":a==="fr"?"CrÃ©er une autre histoire":"Create another story"}),Sn&&e.jsx("button",{onClick:()=>{ca(!0),Ma(!1),t("/stories")},className:"w-full py-3 px-4 bg-gray-100 text-gray-800 rounded-xl hover:bg-gray-200 transition-colors font-medium",children:a==="de"?"Meine Geschichten lesen":a==="fr"?"Lire mes histoires":"Read my stories"})]})]})}),wn&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-sm mx-4 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:a==="de"?"Nur ein Charakter":a==="fr"?"Un seul personnage":"Only One Character"}),e.jsx("p",{className:"text-gray-600 mb-6",children:a==="de"?"Geschichten werden interessanter mit mehreren Charakteren. Du hast nur einen Charakter erstellt.":a==="fr"?"Les histoires sont plus intÃ©ressantes avec plusieurs personnages. Vous n'avez crÃ©Ã© qu'un seul personnage.":"Stories are more interesting with multiple characters. You have only created one character."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{La(!1),es()},className:"w-full py-3 px-4 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors font-medium",children:a==="de"?"Weiteren Charakter erstellen":a==="fr"?"CrÃ©er un autre personnage":"Create another character"}),e.jsx("button",{onClick:async()=>{La(!1),await or(B+1)},className:"w-full py-3 px-4 bg-gray-100 text-gray-800 rounded-xl hover:bg-gray-200 transition-colors font-medium",children:a==="de"?"Trotzdem weiter":a==="fr"?"Continuer quand mÃªme":"Continue anyway"})]})]})}),vn&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-sm w-full p-6 text-center",children:[e.jsx("div",{className:"relative inline-block mb-4",children:e.jsx(wt,{size:40,className:"animate-spin text-indigo-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:a==="de"?"Bild wird erstellt...":a==="fr"?"CrÃ©ation de l'image...":"Generating image..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:a==="de"?"Dies dauert etwa 30 Sekunden":a==="fr"?"Cela prend environ 30 secondes":"This takes about 30 seconds"})]})}),Vn&&Ve&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:a==="de"?"Bild bearbeiten":a==="fr"?"Modifier l'image":"Edit Image"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:Ve.type==="image"?a==="de"?`Seite ${Ve.pageNumber}`:a==="fr"?`Page ${Ve.pageNumber}`:`Page ${Ve.pageNumber}`:a==="de"?Ve.coverType==="front"?"Titelseite":Ve.coverType==="back"?"RÃ¼ckseite":"Einleitungsseite":a==="fr"?Ve.coverType==="front"?"Couverture":Ve.coverType==="back"?"Dos":"Page de dÃ©dicace":Ve.coverType==="front"?"Front Cover":Ve.coverType==="back"?"Back Cover":"Dedication Page"}),e.jsx("textarea",{value:Jr,onChange:n=>Qr(n.target.value),placeholder:a==="de"?`Beschreibe die gewÃ¼nschte Ã„nderung...
z.B. "Mach den Himmel blauer" oder "FÃ¼ge einen Schmetterling hinzu"`:a==="fr"?`DÃ©crivez le changement souhaitÃ©...
par ex. "Rendre le ciel plus bleu" ou "Ajouter un papillon"`:`Describe what you want to change...
e.g. "Make the sky bluer" or "Add a butterfly"`,className:"w-full h-32 p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 resize-none"}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{fa(!1),ya(null),Qr("")},className:"flex-1 px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:a==="de"?"Abbrechen":a==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:async()=>{if(!(!Jr.trim()||!ke)){fa(!1),fs(!0);try{if(Ve.type==="image"&&Ve.pageNumber){const n=await He.editImage(ke,Ve.pageNumber,Jr);if(u.info("Edit result:",{hasImageData:!!(n!=null&&n.imageData),score:n==null?void 0:n.qualityScore}),!(n!=null&&n.imageData))throw u.error("No imageData in edit response!",n),new Error("No image data returned from server");Dt(g=>g.map(d=>d.pageNumber===Ve.pageNumber?{...d,imageData:n.imageData,qualityScore:n.qualityScore,qualityReasoning:n.qualityReasoning,wasEdited:!0,originalImage:n.originalImage,originalScore:n.originalScore,originalReasoning:n.originalReasoning}:d)),u.info("Image edited successfully, updated state with quality info")}else if(Ve.type==="cover"&&Ve.coverType){const n=await He.editCover(ke,Ve.coverType,Jr);Gt(g=>{if(!g)return g;const d=Ve.coverType==="front"?"frontCover":Ve.coverType==="back"?"backCover":"initialPage",k=g[d],h={...typeof k=="object"?k:{},imageData:n.imageData,qualityScore:n.qualityScore,qualityReasoning:n.qualityReasoning,wasEdited:!0,originalImage:n.originalImage,originalScore:n.originalScore,originalReasoning:n.originalReasoning};return{...g,[d]:h}}),u.info("Cover edited successfully with quality info")}}catch(n){u.error("Edit failed:",n),x(a==="de"?"Bearbeitung fehlgeschlagen. Bitte versuche es erneut.":a==="fr"?"Ã‰chec de la modification. Veuillez rÃ©essayer.":"Edit failed. Please try again.")}finally{fs(!1),ya(null),Qr("")}}},disabled:!Jr.trim(),className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:a==="de"?"Bearbeiten":a==="fr"?"Modifier":"Edit"})]})]})}),e.jsx(yo,{isOpen:Fa,faces:Gr,onSelect:ei,onUploadNew:ti,developerMode:xe}),e.jsx(ho,{isOpen:Cn,onClose:()=>ma(!1),onVerified:()=>{console.log("[EmailVerification] onVerified callback triggered");const n=localStorage.getItem("verificationGenerationStarted");if(n){const g=parseInt(n,10),d=Date.now()-120*1e3;if(g>d){console.log("[EmailVerification] Another window started recently, skipping"),ma(!1);return}console.log("[EmailVerification] Clearing stale flag"),localStorage.removeItem("verificationGenerationStarted")}localStorage.setItem("verificationGenerationStarted",Date.now().toString()),localStorage.removeItem("pendingStoryGeneration"),localStorage.removeItem("pending_story_type"),localStorage.removeItem("pending_art_style"),console.log("[EmailVerification] Calling generateStory with skipEmailCheck: true"),jr({skipEmailCheck:!0}),ma(!1)}})]}):e.jsx(Ms,{fullScreen:!0})}const nl=Object.freeze(Object.defineProperty({__proto__:null,default:$o},Symbol.toStringTag,{value:"Module"}));export{Yi as I,Oi as S,_i as U,Dr as a,un as b,Ee as c,Qo as d,tl as e,po as f,xo as g,rl as h,tn as i,Xo as j,al as k,Yo as l,el as m,sl as n,Zo as o,an as p,sn as q,us as r,Jo as s,nn as t,Ko as u,ds as v,nl as w};
