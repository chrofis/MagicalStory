import{c as L,u as H,a as V,b as O,j as e,e as E,T as G,E as U}from"./index-Diw7dd0G.js";import{u as _,b as l}from"./vendor-react-k5uhsfqB.js";import{s as F}from"./storyService-Y9WabKRl.js";import{N as q}from"./Textarea-B70KUsvL.js";import{B as I}from"./Input-Dr2JObSG.js";import{B as D,M as K}from"./Pricing-DK5jfrgT.js";import{P as W}from"./plus-4P8OQNp7.js";import{T as X}from"./trash-2-C4rWuEsm.js";import"./vendor-firebase-Ksn6Afo7.js";import"./api-CL93LcKs.js";import"./arrow-left-rs2gh2q8.js";import"./check-BjUgERxW.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=L("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=L("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=L("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),p=O("MyStories");let S={data:null,timestamp:0};const Y=300*1e3;function ee({story:s,language:r,onView:x,onDelete:f,onPrintPdf:h,formatDate:d,isSelected:m,onToggleSelect:k,isAdmin:b,t:c}){const[v,N]=l.useState(!1),[o,z]=l.useState(!1),[P,C]=l.useState(!1),y=l.useRef(null);return l.useEffect(()=>{const n=new IntersectionObserver(([j])=>{j.isIntersecting&&(C(!0),n.disconnect())},{rootMargin:"100px"});return y.current&&n.observe(y.current),()=>n.disconnect()},[]),e.jsxs("div",{ref:y,className:`bg-white rounded-xl shadow-md overflow-hidden transition-all flex flex-col hover:shadow-lg ${s.isPartial?"ring-2 ring-amber-400":""} ${m?"ring-3 ring-green-500 bg-green-50":""}`,children:[e.jsxs("div",{className:"relative",children:[P&&s.thumbnail&&!o?e.jsxs("div",{className:"relative w-full h-48 bg-gray-100",children:[!v&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 spinner"})}),e.jsx("img",{src:s.thumbnail,alt:s.title,className:`w-full h-48 object-cover transition-opacity duration-300 ${v?"opacity-100":"opacity-0"}`,onLoad:()=>N(!0),onError:()=>z(!0)})]}):P?e.jsx("div",{className:"relative w-full h-48 bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center",children:e.jsx(D,{className:"w-12 h-12 text-indigo-300"})}):e.jsx("div",{className:"relative w-full h-48 bg-gray-100 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 spinner"})}),s.isPartial&&e.jsxs("div",{className:"absolute top-2 right-2 bg-amber-500 text-white px-2 py-1 rounded-md text-xs font-medium flex items-center gap-1",children:[e.jsx(G,{size:12}),r==="de"?"Teilweise":r==="fr"?"Partiel":"Partial"]}),m&&e.jsx("div",{className:"absolute top-2 left-2 bg-green-500 text-white px-2 py-1 rounded-md text-xs font-bold",children:"✓"})]}),e.jsxs("div",{className:"p-4 flex flex-col flex-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-2",children:s.title}),s.isPartial?e.jsxs("p",{className:"text-sm text-amber-600 mb-3",children:[s.generatedPages||0,"/",s.totalPages||s.pages," ",r==="de"?"Seiten generiert":r==="fr"?"pages générées":"pages generated"," • ",d(s.created_at||s.createdAt)]}):e.jsxs("p",{className:"text-sm text-gray-500 mb-3",children:[s.pages," ",r==="de"?"Seiten":"pages"," • ",d(s.created_at||s.createdAt)]})]}),e.jsxs("div",{className:"flex gap-2 mt-auto",children:[e.jsxs("button",{onClick:n=>{n.stopPropagation(),x()},className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[e.jsx(U,{size:18}),r==="de"?"Ansehen":r==="fr"?"Voir":"View"]}),!s.isPartial&&e.jsxs("button",{onClick:n=>{n.stopPropagation(),k()},className:`flex items-center justify-center gap-1 px-3 py-2 rounded-lg font-medium transition-colors ${m?"bg-red-100 text-red-600 hover:bg-red-200":"bg-green-100 text-green-600 hover:bg-green-200"}`,children:[m?e.jsx(Z,{size:18}):e.jsx(W,{size:18}),m?c.remove:c.add]}),b&&h&&!s.isPartial&&e.jsx("button",{onClick:n=>{n.stopPropagation(),h()},className:"p-2 text-purple-600 hover:bg-purple-50 rounded-lg",title:r==="de"?"Druck-PDF":r==="fr"?"PDF impression":"Print PDF",children:e.jsx(J,{size:18})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),f()},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(X,{size:18})})]})]})]})}function pe(){const s=_(),{language:r}=H(),{isAuthenticated:x,user:f}=V(),h=(f==null?void 0:f.role)==="admin",[d,m]=l.useState([]),[k,b]=l.useState(!0),[c,v]=l.useState(new Set),N={en:{myStories:"My Stories",createStory:"Create Story",noStories:"No stories created yet",seePricing:"See Pricing",selectHint:"Select stories to create a book",selected:"selected",pages:"pages",createBook:"Create Book",tooManyPages:"Too many pages (max 100)",add:"Add",remove:"Remove"},de:{myStories:"Meine Geschichten",createStory:"Geschichte erstellen",noStories:"Noch keine Geschichten erstellt",seePricing:"Preise ansehen",selectHint:"Wähle Geschichten, um ein Buch zu erstellen",selected:"ausgewählt",pages:"Seiten",createBook:"Buch erstellen",tooManyPages:"Zu viele Seiten (max. 100)",add:"Hinzufügen",remove:"Entfernen"},fr:{myStories:"Mes histoires",createStory:"Créer une histoire",noStories:"Aucune histoire créée",seePricing:"Voir les tarifs",selectHint:"Sélectionnez des histoires pour créer un livre",selected:"sélectionné(s)",pages:"pages",createBook:"Créer le livre",tooManyPages:"Trop de pages (max 100)",add:"Ajouter",remove:"Retirer"}},o=N[r]||N.en;l.useEffect(()=>{if(!x){s("/");return}z()},[x,s]);const z=async()=>{p.debug("Loading stories...");try{const t=Date.now();if(S.data&&t-S.timestamp<Y){p.debug("Using cached stories"),m(S.data),b(!1);return}b(!0);const i=await F.getStories();p.info("Loaded stories:",i.length);const a=i;m(a),S={data:a,timestamp:t}}catch(t){p.error("Failed to load stories:",t)}finally{b(!1)}},P=async t=>{if(confirm(r==="de"?"Diese Geschichte wirklich löschen?":r==="fr"?"Voulez-vous vraiment supprimer cette histoire?":"Are you sure you want to delete this story?"))try{await F.deleteStory(t);const a=d.filter(g=>g.id!==t);m(a),S={data:a,timestamp:Date.now()},v(g=>{const u=new Set(g);return u.delete(t),u})}catch(a){p.error("Failed to delete story:",a),alert(r==="de"?"Geschichte konnte nicht gelöscht werden. Bitte versuche es erneut.":r==="fr"?"Impossible de supprimer l'histoire. Veuillez réessayer.":"Failed to delete story. Please try again.")}},C=async t=>{var i,a;if(h)try{p.debug("Downloading print PDF for story:",t);const g=localStorage.getItem("token"),u=await fetch(`/api/stories/${t}/print-pdf`,{headers:{Authorization:`Bearer ${g}`}});if(!u.ok)throw new Error(`HTTP ${u.status}`);const $=await u.blob(),B=window.URL.createObjectURL($),w=document.createElement("a");w.href=B,w.download=((a=(i=u.headers.get("Content-Disposition"))==null?void 0:i.split("filename=")[1])==null?void 0:a.replace(/"/g,""))||"story-print.pdf",document.body.appendChild(w),w.click(),document.body.removeChild(w),window.URL.revokeObjectURL(B)}catch(g){p.error("Failed to download print PDF:",g),alert(r==="de"?"PDF konnte nicht heruntergeladen werden.":r==="fr"?"Impossible de télécharger le PDF.":"Failed to download PDF.")}},y=l.useCallback(t=>{if(!t)return"";try{return new Date(t).toLocaleDateString(r==="de"?"de-DE":r==="fr"?"fr-FR":"en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return""}},[r]),n=t=>{v(i=>{const a=new Set(i);return a.has(t)?a.delete(t):a.add(t),a})},j=l.useMemo(()=>d.filter(t=>c.has(t.id)),[d,c]),A=l.useMemo(()=>j.reduce((t,i)=>t+i.pages,0),[j]),M=A>K,T=()=>{const t=j.map(i=>({id:i.id,title:i.title,pages:i.pages,thumbnail:i.thumbnail}));s("/book-builder",{state:{selectedStories:t}})};if(!x)return e.jsx(E,{fullScreen:!0});const R=d.filter(t=>!t.isPartial).length>=1;return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsx(q,{currentStep:0}),e.jsxs("div",{className:"px-4 md:px-8 py-8 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(D,{size:28}),o.myStories]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("button",{onClick:()=>s("/pricing"),className:"flex items-center gap-2 px-4 py-2 border-2 border-gray-300 text-gray-600 rounded-lg hover:border-indigo-400 hover:text-indigo-600 hover:bg-indigo-50 font-medium transition-colors",children:[e.jsx(Q,{size:18}),o.seePricing]}),R&&e.jsxs("button",{onClick:T,disabled:c.size===0||M,className:"flex items-center gap-2 px-4 py-2 border-2 border-purple-600 text-purple-600 rounded-lg hover:bg-purple-50 font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(I,{size:18}),o.createBook,c.size>0&&e.jsx("span",{className:"bg-purple-600 text-white text-xs px-2 py-0.5 rounded-full",children:c.size})]}),e.jsx("button",{onClick:()=>s("/create"),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold transition-colors",children:o.createStory})]})]}),d.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6 flex items-center gap-3",children:[e.jsx(I,{size:20,className:"text-blue-600 flex-shrink-0"}),e.jsx("p",{className:"text-blue-800 text-sm",children:o.selectHint}),c.size>0&&e.jsxs("span",{className:`ml-auto text-sm font-medium ${M?"text-red-600":"text-blue-600"}`,children:[c.size," ",o.selected," • ",A," ",o.pages,M&&` (${o.tooManyPages})`]})]}),k?e.jsx(E,{message:r==="de"?"Laden...":r==="fr"?"Chargement...":"Loading..."}):d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:o.noStories}),e.jsx("button",{onClick:()=>s("/create"),className:"mt-4 px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700",children:o.createStory})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:d.map(t=>e.jsx(ee,{story:t,language:r,onView:()=>s(`/create?storyId=${t.id}`),onDelete:()=>P(t.id),onPrintPdf:h?()=>C(t.id):void 0,formatDate:y,isSelected:c.has(t.id),onToggleSelect:()=>n(t.id),isAdmin:h,t:{add:o.add,remove:o.remove}},t.id))})]})]})}export{pe as default};
