import{c as Ce,d as Yr,j as e,L as de,s as Xs,u as Gs,T as Xr,X as Se}from"./index-B34Bllq6.js";import{b as A}from"./vendor-react-CqfXSjHo.js";import{U as ut}from"./Input-BJ4rUPru.js";import{S as Gr}from"./Textarea-CPRQ1TTh.js";import{H as ea,F as ss}from"./history-BQGpL7Y0.js";import{D as Ee}from"./download-CY1vp7ZQ.js";import{C as Te}from"./chevron-down-CQ5nkEaN.js";import{C as gt}from"./chevron-right-buGvcpst.js";import{I as sa,S as Ge}from"./ImageLightbox-B0aFCaQ8.js";import{P as ie}from"./StoryWizard-DrTdX6OA.js";import{C as jr}from"./chevron-up-CfY3LTPR.js";import{R as we}from"./Modal-_Ur8_g1o.js";import{P as ta}from"./palette-BAngsgWL.js";import{B as ra}from"./book-DmcROYqz.js";import{C as aa}from"./check-B-_uv18F.js";import{S as yr}from"./shopping-cart-bKo8g5mQ.js";import{P as Nr}from"./plus-FPqFjPVE.js";import{B as xt}from"./book-open-DUvV4EqF.js";import{W as es}from"./wrench-CAD5_Yji.js";import{R as mt}from"./rotate-ccw-B-z0xZMt.js";import"./vendor-firebase-DTVMaYMy.js";import"./sparkles-cPB_70jt.js";import"./circle-x-Ch0Gcs77.js";import"./clock-BQUeL7r-.js";import"./arrow-left-BC6PoY3W.js";import"./arrow-right-CiQKC7uo.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=Ce("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=Ce("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=Ce("Images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=Ce("Link2Off",[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=Ce("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=Ce("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=Ce("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=Ce("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=Ce("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),ze=Yr("ImageLoad");function Zs({src:o,alt:k,className:x,label:d}){const[$,E]=A.useState(!0),[w,O]=A.useState(null),f=A.useRef(0),C=A.useRef(null);A.useEffect(()=>{o&&o.length>100?(f.current=Date.now(),ze.info(`‚è≥ Loading ${d||k}`,{isBase64:o==null?void 0:o.startsWith("data:"),sizeKB:Math.round(o.length*3/4/1024)})):f.current=0,E(!0),O(null)},[o,k,d]);const N=()=>{if(E(!1),f.current===0){ze.info(`‚úÖ Loaded ${d||k} (placeholder/empty)`);return}const D=Date.now()-f.current;O(D);const p=(o==null?void 0:o.startsWith("data:"))?Math.round(o.length*3/4/1024):null,c=C.current?`${C.current.naturalWidth}x${C.current.naturalHeight}`:"unknown";D<100?ze.success(`‚úÖ Loaded ${d||k} in ${D}ms`,{sizeKB:p,naturalSize:c}):D<500?ze.info(`‚úÖ Loaded ${d||k} in ${D}ms`,{sizeKB:p,naturalSize:c}):D<2e3?ze.warn(`‚ö†Ô∏è Slow load: ${d||k} took ${D}ms`,{sizeKB:p,naturalSize:c}):ze.error(`üê¢ Very slow: ${d||k} took ${D}ms`,{sizeKB:p,naturalSize:c}),D>1e3&&ca({type:"slow_image_load",label:d||k,loadTimeMs:D,sizeKB:p,naturalSize:c,userAgent:navigator.userAgent,timestamp:new Date().toISOString()})},b=()=>{if(E(!1),f.current===0){ze.error(`‚ùå Failed to load ${d||k} (no data received)`);return}const D=Date.now()-f.current;ze.error(`‚ùå Failed to load ${d||k} after ${D}ms`)};return e.jsx("img",{ref:C,src:o,alt:k,className:x,onLoad:N,onError:b,draggable:!1})}async function ca(o){try{await fetch("/api/log-error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errorType:"Performance",message:`Slow image load: ${o.label} took ${o.loadTimeMs}ms`,userAgent:o.userAgent,timestamp:o.timestamp,url:window.location.href})})}catch{}}function $s(o,k){const x=new Blob([o],{type:"text/plain;charset=utf-8"}),d=URL.createObjectURL(x),$=document.createElement("a");$.href=d,$.download=k,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(d)}function ht(o,k=0){const x="  ".repeat(k);if(o==null)return`${x}null`;if(typeof o=="boolean")return`${x}${o?"YES":"NO"}`;if(typeof o=="number")return`${x}${o}`;if(typeof o=="string")return`${x}${o}`;if(Array.isArray(o))return o.length===0?`${x}[]`:o.map((d,$)=>`${x}[${$}]: ${ht(d,0)}`).join(`
`);if(typeof o=="object"){const d=Object.entries(o);return d.length===0?`${x}{}`:d.map(([$,E])=>{const w=ht(E,k+1);return typeof E=="object"&&E!==null?`${x}${$}:
${w}`:`${x}${$}: ${w.trim()}`}).join(`
`)}return`${x}${String(o)}`}function Ys({data:o,language:k,title:x}){const[d,$]=A.useState(new Set);if(!o)return e.jsx("div",{className:"text-gray-400 italic text-sm",children:k==="de"?"Keine Daten":"No data"});let E=o;if(typeof o=="string")try{E=JSON.parse(o)}catch{return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-1",children:e.jsxs("button",{onClick:()=>$s(o,`${x||"evaluation"}.txt`),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1",title:"Download as text file",children:[e.jsx(Ee,{size:12})," Download"]})}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap bg-gray-50 p-3 rounded max-h-80 overflow-auto font-mono",children:o})]})}const w=C=>{const N=new Set(d);N.has(C)?N.delete(C):N.add(C),$(N)},O=()=>{const C=ht(E);$s(C,`${x||"evaluation"}.txt`)},f=(C,N,b=0)=>{const D=d.has(C);if(N==null)return e.jsx("span",{className:"text-gray-400",children:"null"});if(typeof N=="boolean")return e.jsx("span",{className:N?"text-green-600 font-medium":"text-red-600 font-medium",children:N?"‚úì":"‚úó"});if(typeof N=="number"){const H=N>=70?"text-green-600":N>=50?"text-yellow-600":"text-red-600";return e.jsx("span",{className:`font-bold ${H}`,children:N})}if(typeof N=="string")return N.length>100?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>w(C),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[D?e.jsx(Te,{size:14}):e.jsx(gt,{size:14}),D?"Collapse":`Show (${N.length} chars)`]}),D&&e.jsx("div",{className:"mt-1 p-2 bg-gray-100 rounded text-sm whitespace-pre-wrap font-mono",children:N})]}):e.jsx("span",{className:"text-gray-700",children:N});if(Array.isArray(N))return N.length===0?e.jsx("span",{className:"text-gray-400",children:"[]"}):e.jsx("div",{className:"ml-2 border-l-2 border-gray-200 pl-2",children:N.map((H,p)=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"text-gray-400 text-xs",children:["[",p,"]"]})," ",f(`${C}.${p}`,H,b+1)]},p))});if(typeof N=="object"){const H=Object.entries(N);return H.length===0?e.jsx("span",{className:"text-gray-400",children:"{}"}):b>0?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>w(C),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[D?e.jsx(Te,{size:14}):e.jsx(gt,{size:14}),D?"Collapse":`{${H.length} fields}`]}),D&&e.jsx("div",{className:"ml-2 mt-1 border-l-2 border-gray-200 pl-2",children:H.map(([p,c])=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-600",children:[p,":"]})," ",f(`${C}.${p}`,c,b+1)]},p))})]}):e.jsx("div",{className:"space-y-1",children:H.map(([p,c])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-600 min-w-[100px]",children:[p,":"]}),e.jsx("div",{className:"flex-1",children:f(`${C}.${p}`,c,b+1)})]},p))})}return e.jsx("span",{children:String(N)})};return e.jsxs("div",{className:"text-sm space-y-1 max-h-[500px] overflow-auto",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("button",{onClick:O,className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-1 bg-blue-50 rounded hover:bg-blue-100",title:"Download as text file",children:[e.jsx(Ee,{size:12})," Download"]})}),f("root",E)]})}function xa({beforeImage:o,maskImage:k,onEnlarge:x}){return e.jsxs("div",{className:"relative w-40 h-40 cursor-pointer hover:ring-2 hover:ring-amber-400 rounded overflow-hidden border",onClick:()=>x(o,"Before with Mask"),children:[e.jsx("img",{src:o,alt:"Before",className:"w-full h-full object-contain"}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:{backgroundImage:`url(${k})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",mixBlendMode:"multiply",opacity:.5}}),e.jsx("img",{src:k,alt:"Mask overlay",className:"absolute inset-0 w-full h-full object-contain pointer-events-none",style:{mixBlendMode:"screen",opacity:.7,filter:"sepia(1) saturate(5) hue-rotate(-50deg)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent text-white text-[10px] text-center py-1 font-medium",children:"üéØ Edit Area"})]})}function ts({retryHistory:o,totalAttempts:k,language:x,onRevertRepair:d,storyId:$,pageNumber:E}){const[w,O]=A.useState(null),[f,C]=A.useState({}),[N,b]=A.useState(new Set),D=async n=>{if(!(!$||E===void 0||N.has(n))){b(S=>new Set(S).add(n));try{const S=localStorage.getItem("auth_token"),U=new URLSearchParams({page:String(E),type:"retry",index:String(n)}),Q=await fetch(`/api/stories/${$}/dev-image?${U}`,{headers:S?{Authorization:`Bearer ${S}`}:{}});if(Q.ok){const g=await Q.json();C(T=>({...T,[n]:{imageData:g.imageData,annotatedOriginal:g.annotatedOriginal,grids:g.grids,bboxOverlayImage:g.bboxOverlayImage}}))}}catch(S){console.error(`Failed to load retry images for retry ${n}:`,S)}finally{b(S=>{const U=new Set(S);return U.delete(n),U})}}};if(!o||o.length===0)return null;const H=o.filter(n=>n.type==="auto_repair"||n.type==="grid_repair"||n.type==="grid_repair_failed").length,p=o.filter(n=>n.type==="grid_repair"||n.type==="grid_repair_failed").length,c=o.filter(n=>n.type==="grid_repair_failed").length;return e.jsxs(e.Fragment,{children:[w&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>O(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("div",{className:"absolute -top-8 left-0 text-white text-sm",children:w.title}),e.jsx("img",{src:w.src,alt:w.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute -top-8 right-0 text-white hover:text-gray-300",onClick:()=>O(null),children:"‚úï Close"})]})}),e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ea,{size:14}),x==="de"?"Generierungshistorie":x==="fr"?"Historique de g√©n√©ration":"Generation History",H>0&&e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded",children:["üîß ",H," ",x==="de"?"Reparatur":"repair",H>1?x==="de"?"en":"s":"",p>0&&e.jsxs("span",{className:"ml-1",children:["(",p," grid",c>0?`, ${c} failed`:"",")"]})]})]}),e.jsxs("span",{className:"text-purple-600",children:[k," ",x==="de"?"Versuche":x==="fr"?"tentatives":"attempts"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:o.map((n,S)=>{var U,Q;return e.jsxs("div",{className:`border rounded-lg p-3 ${n.type==="grid_repair_failed"?"bg-red-50 border-red-300":n.type==="grid_repair"?"bg-violet-50 border-violet-300":n.type==="auto_repair"?"bg-amber-50 border-amber-300":S===o.length-1?"bg-green-50 border-green-300":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-sm",children:[n.type==="grid_repair_failed"?e.jsx("span",{className:"text-red-700",children:"üî≤ Grid Repair Failed"}):n.type==="grid_repair"?e.jsx("span",{className:"text-violet-700",children:"üî≤ Grid Repair"}):n.type==="auto_repair"?e.jsx("span",{className:"text-amber-700",children:"üîß Auto-Repair"}):e.jsx(e.Fragment,{children:x==="de"?`Versuch ${n.attempt}`:x==="fr"?`Tentative ${n.attempt}`:`Attempt ${n.attempt}`}),n.type==="text_edit"&&e.jsx("span",{className:"text-xs ml-2 text-blue-600",children:"(text edit)"}),n.type==="text_edit_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(text edit failed)"}),n.type==="auto_repair_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(auto-repair failed)"}),S===o.length-1&&n.type!=="auto_repair"&&e.jsx("span",{className:"text-xs ml-2 text-green-600 font-bold",children:"‚úì USED"})]}),n.type==="auto_repair"&&n.preRepairScore!==void 0&&n.postRepairScore!==void 0?e.jsxs("span",{className:"font-bold text-sm",children:[e.jsxs("span",{className:n.preRepairScore>=70?"text-green-600":n.preRepairScore>=50?"text-yellow-600":"text-red-600",children:[n.preRepairScore,"%"]}),e.jsx("span",{className:"text-gray-400 mx-1",children:"‚Üí"}),e.jsxs("span",{className:n.postRepairScore>=70?"text-green-600":n.postRepairScore>=50?"text-yellow-600":"text-red-600",children:[n.postRepairScore,"%"]})]}):n.score!==void 0&&e.jsxs("span",{className:`font-bold ${n.score>=70?"text-green-600":n.score>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(n.score),"%"]})]}),n.error&&e.jsxs("div",{className:"text-xs text-red-600 mb-2",children:["Error: ",n.error]}),n.textIssue&&n.textIssue!=="NONE"&&e.jsxs("div",{className:"text-xs text-orange-600 mb-2",children:["Text issue: ",n.textIssue,n.expectedText&&e.jsxs("span",{className:"block",children:['Expected: "',n.expectedText,'"']}),n.actualText&&e.jsxs("span",{className:"block",children:['Actual: "',n.actualText,'"']})]}),n.type==="auto_repair"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[n.fixTargetsCount&&e.jsxs("div",{className:"text-xs text-amber-700",children:["Fixed ",n.fixTargetsCount," target",n.fixTargetsCount>1?"s":""]}),d&&((Q=(U=n.repairDetails)==null?void 0:U[0])==null?void 0:Q.beforeImage)&&n.postRepairScore!==void 0&&n.preRepairScore!==void 0&&n.postRepairScore<=n.preRepairScore&&e.jsxs("button",{onClick:()=>d(S,n.repairDetails[0].beforeImage),className:"text-xs px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded border border-red-300 transition-colors",children:["‚Ü©Ô∏è ",x==="de"?"Zur√ºcksetzen":"Revert to Original"]})]}),n.postRepairScore!==void 0&&n.preRepairScore!==void 0&&n.postRepairScore<n.preRepairScore&&e.jsxs("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded border border-red-200",children:["‚ö†Ô∏è ",x==="de"?`Bewertung verschlechtert: ${n.preRepairScore}% ‚Üí ${n.postRepairScore}%`:`Score decreased: ${n.preRepairScore}% ‚Üí ${n.postRepairScore}%`]}),n.bboxDetection&&Array.isArray(n.bboxDetection)&&n.bboxDetection.length>0&&e.jsxs("details",{className:"text-sm mb-2",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-700 font-medium hover:text-blue-900",children:["üì¶ ",x==="de"?"Bounding Box Erkennung":"Bounding Box Detection"," (",n.bboxDetection.length,")"]}),e.jsx("div",{className:"mt-3 space-y-2",children:n.bboxDetection.map((g,T)=>e.jsxs("div",{className:`p-3 rounded-lg border ${g.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:`font-medium text-sm ${g.success?"text-green-800":"text-red-800"}`,children:[g.success?"‚úì":"‚úó"," ",g.issue.substring(0,60),g.issue.length>60?"...":""]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${g.severity==="CRITICAL"?"bg-red-200 text-red-800":g.severity==="MAJOR"?"bg-orange-200 text-orange-800":g.severity==="MODERATE"?"bg-yellow-200 text-yellow-800":"bg-gray-200 text-gray-800"}`,children:[g.severity," ‚Ä¢ ",g.type]})]}),g.success&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${g.faceBox?"bg-purple-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-purple-800",children:"Face Box:"}),g.faceBox?e.jsxs("span",{className:"ml-1 font-mono text-purple-600",children:["[",g.faceBox.map(q=>(q*100).toFixed(0)+"%").join(", "),"]"]}):e.jsx("span",{className:"ml-1 text-gray-500 italic",children:"not detected"})]}),e.jsxs("div",{className:`p-2 rounded ${g.bodyBox?"bg-blue-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-blue-800",children:"Body Box:"}),g.bodyBox?e.jsxs("span",{className:"ml-1 font-mono text-blue-600",children:["[",g.bodyBox.map(q=>(q*100).toFixed(0)+"%").join(", "),"]"]}):e.jsx("span",{className:"ml-1 text-gray-500 italic",children:"not detected"})]})]}),g.label&&g.label!==g.issue&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Detected as:"})," ",g.label]}),g.usage&&e.jsxs("div",{className:"mt-1 text-xs text-gray-400",children:["Tokens: ",g.usage.input_tokens," in / ",g.usage.output_tokens," out"]})]},T))})]}),e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["üìä ",x==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-red-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-red-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 px-2 py-0.5 rounded",children:"Before"}),e.jsxs("span",{className:"text-red-600",children:[n.preRepairScore,"%"]})]}),e.jsx(Ys,{data:n.preRepairEval||n.reasoning,language:x,title:`evaluation-before-attempt-${S}`})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-green-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded",children:"After"}),e.jsxs("span",{className:"text-green-600",children:[n.postRepairScore,"%"]})]}),e.jsx(Ys,{data:n.postRepairEval,language:x,title:`evaluation-after-attempt-${S}`})]})]})]}),n.repairDetails&&n.repairDetails.length>0&&e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium hover:text-amber-900",children:["üñºÔ∏è ",x==="de"?"Reparatur-Details":"Repair Details"," (",n.repairDetails.length,")"]}),e.jsx("div",{className:"mt-3 space-y-3",children:n.repairDetails.map((g,T)=>{var q,m;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-medium text-amber-800 text-base",children:g.description}),g.modelId&&e.jsx("span",{className:"text-xs text-gray-400 bg-gray-100 px-2 py-0.5 rounded",children:g.modelId})]}),e.jsxs("details",{className:"mb-3",children:[e.jsxs("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700 text-sm flex items-center gap-2",children:["Show fix prompt",e.jsxs("button",{onClick:F=>{F.stopPropagation(),$s(g.fullPrompt||g.fixPrompt||"",`fix-prompt-${T}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(Ee,{size:10})," Download"]})]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded text-sm text-gray-600 whitespace-pre-wrap font-mono max-h-[500px] overflow-auto",children:g.fullPrompt||g.fixPrompt})]}),e.jsxs("div",{className:"flex gap-4 items-start",children:[g.beforeImage&&g.maskImage?e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before + Mask"}),e.jsx(xa,{beforeImage:g.beforeImage,maskImage:g.maskImage,onEnlarge:(F,V)=>O({src:F,title:V})})]}):g.beforeImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"Before"}),e.jsx("img",{src:g.beforeImage,alt:"Before",className:"w-32 h-32 object-contain border rounded cursor-pointer hover:ring-2 hover:ring-amber-400",onClick:()=>O({src:g.beforeImage,title:"Before Repair"})})]}),e.jsx("div",{className:"flex items-center h-32 text-gray-400 text-2xl",children:"‚Üí"}),g.afterImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:"After"}),e.jsx("img",{src:g.afterImage,alt:"After",className:"w-32 h-32 object-contain border-2 border-green-300 rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>O({src:g.afterImage,title:"After Repair"})})]})]}),g.verification&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded border text-sm",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"üîç Verification:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[g.verification.lpips&&e.jsxs("div",{className:`p-2 rounded ${g.verification.lpips.changed?"bg-green-100":"bg-yellow-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LPIPS: "}),e.jsx("span",{className:g.verification.lpips.changed?"text-green-700":"text-yellow-700",children:(q=g.verification.lpips.lpipsScore)==null?void 0:q.toFixed(4)}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",g.verification.lpips.changed?"‚úì changed":"‚ö† unchanged",")"]})]}),g.verification.llm&&e.jsxs("div",{className:`p-2 rounded ${g.verification.llm.fixed?"bg-green-100":"bg-red-100"}`,children:[e.jsx("span",{className:"font-medium",children:"LLM: "}),e.jsx("span",{className:g.verification.llm.fixed?"text-green-700":"text-red-700",children:g.verification.llm.fixed?"‚úì Fixed":"‚úó Not fixed"}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",Math.round(g.verification.llm.confidence*100),"%)"]})]})]}),((m=g.verification.llm)==null?void 0:m.explanation)&&e.jsx("div",{className:"mt-2 text-gray-600 text-sm italic",children:g.verification.llm.explanation})]})]},T)})})]})]}),(n.type==="grid_repair"||n.type==="grid_repair_failed")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[n.gridTotalIssues!==void 0&&e.jsxs("span",{className:"text-violet-700",children:[x==="de"?"Probleme:":"Issues:"," ",n.gridTotalIssues]}),n.gridFixedCount!==void 0&&e.jsxs("span",{className:"text-green-600",children:["‚úì ",x==="de"?"Behoben:":"Fixed:"," ",n.gridFixedCount]}),n.gridFailedCount!==void 0&&n.gridFailedCount>0&&e.jsxs("span",{className:"text-red-600",children:["‚úó ",x==="de"?"Fehlgeschlagen:":"Failed:"," ",n.gridFailedCount]})]}),n.type==="grid_repair_failed"&&n.failReason&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-100 p-2 rounded border border-red-200",children:["‚ö†Ô∏è ",x==="de"?"Fehlergrund:":"Failure reason:"," ",n.failReason==="no_repairs_made"?x==="de"?"Keine Reparaturen durchgef√ºhrt":"No repairs were made":n.failReason==="no_image_data"?x==="de"?"Keine Bilddaten zur√ºckgegeben":"No image data returned":n.failReason==="image_too_small"?x==="de"?"Zur√ºckgegebenes Bild zu klein/ung√ºltig":"Returned image too small/invalid":n.failReason==="image_unchanged"?x==="de"?"Bild wurde nicht ver√§ndert":"Image was not changed":n.failReason]}),(()=>{var T;const g=n.annotatedOriginal||((T=f[S])==null?void 0:T.annotatedOriginal);return g?e.jsxs("details",{className:"text-sm",open:!0,children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["üìç ",x==="de"?"Schritt 1: Erkannte Probleme":"Step 1: Detected Issues"]}),e.jsxs("div",{className:"mt-3 bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:[x==="de"?"Originalbild mit markierten Problembereichen":"Original image with marked issue regions",e.jsxs("span",{className:"ml-2 text-gray-400",children:["(üî¥ ",x==="de"?"kritisch":"critical",", üü† ",x==="de"?"wichtig":"major",", üü° ",x==="de"?"gering":"minor",")"]})]}),e.jsx("img",{src:`data:image/jpeg;base64,${g}`,alt:"Annotated original",className:"max-w-md border rounded cursor-pointer hover:ring-2 hover:ring-violet-400",onClick:()=>O({src:`data:image/jpeg;base64,${g}`,title:x==="de"?"Erkannte Probleme":"Detected Issues"})})]})]}):n.hasAnnotatedOriginal&&$&&E!==void 0?e.jsx("button",{onClick:()=>D(S),disabled:N.has(S),className:"text-sm px-3 py-2 bg-violet-100 hover:bg-violet-200 text-violet-700 rounded border border-violet-300 flex items-center gap-2 disabled:opacity-50",children:N.has(S)?e.jsxs(e.Fragment,{children:[e.jsx(de,{size:14,className:"animate-spin"})," Loading..."]}):e.jsx(e.Fragment,{children:"üìç Load Detected Issues"})}):null})(),e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["üìä ",x==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-red-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-red-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 px-2 py-0.5 rounded",children:"Before"}),e.jsxs("span",{className:"text-red-600",children:[n.preRepairScore,"%"]})]}),e.jsx(Ys,{data:n.preRepairEval||n.reasoning,language:x,title:`evaluation-before-grid-${S}`})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-green-700 mb-2 text-base flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded",children:"After"}),e.jsxs("span",{className:"text-green-600",children:[n.postRepairScore,"%"]})]}),e.jsx(Ys,{data:n.postRepairEval,language:x,title:`evaluation-after-grid-${S}`})]})]})]}),(()=>{var T,q;const g=n.grids||((T=f[S])==null?void 0:T.grids);return g&&g.length>0?e.jsxs("details",{className:"text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-violet-700 font-medium hover:text-violet-900",children:["üî≤ ",x==="de"?"Grid-Details":"Grid Details"," (",g.length," ",g.length===1?"grid":"grids",")"]}),e.jsx("div",{className:"mt-3 space-y-4",children:g.map((m,F)=>{var V,W;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("span",{className:"font-medium text-violet-800",children:["Grid"," ",m.batchNum||F+1]}),((V=m.manifest)==null?void 0:V.issues)&&e.jsxs("span",{className:"text-xs text-gray-500",children:[m.manifest.issues.length," ",x==="de"?"Regionen":"regions"]})]}),((W=m.manifest)==null?void 0:W.issues)&&m.manifest.issues.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-violet-50 rounded text-sm",children:[e.jsx("div",{className:"font-medium text-violet-800 mb-1",children:x==="de"?"Zu reparierende Probleme:":"Issues to repair:"}),e.jsx("div",{className:"space-y-1",children:m.manifest.issues.map((z,G)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-mono font-bold text-violet-600 min-w-[20px]",children:[z.letter,":"]}),e.jsx("span",{className:"text-gray-700",children:z.fixInstruction||z.description||"Unknown issue"})]},G))})]}),m.prompt&&e.jsxs("details",{className:"mb-3",children:[e.jsxs("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700 text-sm flex items-center gap-2",children:[x==="de"?"Reparatur-Prompt anzeigen":"Show repair prompt",e.jsxs("button",{onClick:z=>{z.stopPropagation(),$s(m.prompt||"",`grid-repair-prompt-${F}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(Ee,{size:10})," Download"]})]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded text-sm text-gray-600 whitespace-pre-wrap font-mono max-h-[500px] overflow-auto",children:m.prompt})]}),e.jsxs("div",{className:"flex gap-4 items-start flex-wrap",children:[m.original&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:x==="de"?"Original-Grid":"Input Grid"}),e.jsx("img",{src:m.original.startsWith("data:")?m.original:`data:image/png;base64,${m.original}`,alt:"Input grid",className:"max-w-xs border rounded cursor-pointer hover:ring-2 hover:ring-violet-400",onClick:()=>O({src:m.original.startsWith("data:")?m.original:`data:image/png;base64,${m.original}`,title:x==="de"?"Original-Grid":"Input Grid"})})]}),m.original&&m.repaired&&e.jsx("div",{className:"flex items-center self-center text-gray-400 text-2xl",children:"‚Üí"}),m.repaired&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:x==="de"?"Repariertes Grid":"Repaired Grid"}),e.jsx("img",{src:m.repaired.startsWith("data:")?m.repaired:`data:image/png;base64,${m.repaired}`,alt:"Repaired grid",className:"max-w-xs border-2 border-green-300 rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>O({src:m.repaired.startsWith("data:")?m.repaired:`data:image/png;base64,${m.repaired}`,title:x==="de"?"Repariertes Grid":"Repaired Grid"})})]})]}),m.repairs&&m.repairs.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"font-medium text-violet-800 mb-2",children:["‚úÖ ",x==="de"?"Verifizierungsergebnisse":"Verification Results"]}),e.jsx("div",{className:"space-y-2",children:m.repairs.map((z,G)=>{var ae,j,Z,ce,xe,ne,v,je,ks,rs,Be,Me;return e.jsxs("div",{className:`mb-3 p-3 rounded-lg border ${(ae=z.verification)!=null&&ae.accepted?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"font-mono font-bold text-xl text-violet-600 w-8",children:z.letter}),e.jsxs("div",{className:"flex items-center gap-2",children:[z.originalThumbnail&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:x==="de"?"Vorher":"Before"}),e.jsx("img",{src:`data:image/jpeg;base64,${z.originalThumbnail}`,alt:"Before",className:"w-16 h-16 object-contain cursor-pointer hover:ring-2 hover:ring-violet-400 rounded border",onClick:()=>O({src:`data:image/jpeg;base64,${z.originalThumbnail}`,title:`${z.letter}: Before`})})]}),z.repairedThumbnail&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:x==="de"?"Nachher":"After"}),e.jsx("img",{src:`data:image/jpeg;base64,${z.repairedThumbnail}`,alt:"After",className:`w-16 h-16 object-contain cursor-pointer hover:ring-2 rounded border ${(j=z.verification)!=null&&j.accepted?"border-green-300":"border-red-300"}`,onClick:()=>O({src:`data:image/jpeg;base64,${z.repairedThumbnail}`,title:`${z.letter}: After`})})]}),z.diffImage&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Diff"}),e.jsx("img",{src:`data:image/jpeg;base64,${z.diffImage}`,alt:"Diff",className:"w-16 h-16 object-contain cursor-pointer hover:ring-2 hover:ring-purple-400 rounded border",onClick:()=>O({src:`data:image/jpeg;base64,${z.diffImage}`,title:`${z.letter}: Diff`})})]})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsx("span",{className:`text-2xl ${(Z=z.verification)!=null&&Z.accepted?"text-green-600":"text-red-600"}`,children:(ce=z.verification)!=null&&ce.accepted?"‚úì":"‚úó"}),e.jsxs("span",{className:`text-lg font-medium ${(((xe=z.verification)==null?void 0:xe.confidence)??0)>=.7?"text-green-600":(((ne=z.verification)==null?void 0:ne.confidence)??0)>=.5?"text-yellow-600":"text-red-600"}`,children:[Math.round((((v=z.verification)==null?void 0:v.confidence)??0)*100),"%"]})]})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-xs mr-2 ${z.severity==="critical"?"bg-red-200 text-red-800":z.severity==="major"?"bg-orange-200 text-orange-800":"bg-yellow-200 text-yellow-800"}`,children:z.type||"unknown"}),e.jsx("span",{className:"text-gray-700",children:z.description})]}),z.fixInstruction&&e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Fix:"})," ",z.fixInstruction]}),(((je=z.verification)==null?void 0:je.explanation)||((ks=z.verification)==null?void 0:ks.reason))&&e.jsxs("div",{className:`mt-2 text-sm p-2 rounded ${(rs=z.verification)!=null&&rs.accepted?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:"font-medium",children:x==="de"?"Ergebnis:":"Result:"})," ",((Be=z.verification)==null?void 0:Be.explanation)||((Me=z.verification)==null?void 0:Me.reason)]})]},G)})})]})]},F)})})]}):n.hasGrids&&$&&E!==void 0&&!((q=f[S])!=null&&q.grids)?e.jsx("button",{onClick:()=>D(S),disabled:N.has(S),className:"text-sm px-3 py-2 bg-violet-100 hover:bg-violet-200 text-violet-700 rounded border border-violet-300 flex items-center gap-2 disabled:opacity-50",children:N.has(S)?e.jsxs(e.Fragment,{children:[e.jsx(de,{size:14,className:"animate-spin"})," Loading..."]}):e.jsxs(e.Fragment,{children:["üî≤ Load Grid Details (",n.gridsCount||"?"," grids)"]})}):null})()]}),n.type!=="auto_repair"&&n.type!=="grid_repair"&&n.type!=="grid_repair_failed"&&n.prompt&&e.jsxs("details",{className:"text-sm mb-2",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-700 font-medium hover:text-blue-900 flex items-center gap-2",children:["üì§ ",x==="de"?"Eingabe-Prompt":"Input Prompt",e.jsxs("button",{onClick:g=>{g.stopPropagation(),$s(n.prompt||"",`prompt-attempt-${n.attempt}.txt`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-0.5 bg-blue-50 rounded",children:[e.jsx(Ee,{size:10})," Download"]})]}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap bg-blue-50 p-3 rounded text-sm overflow-auto max-h-[500px] font-mono border border-blue-200",children:n.prompt})]}),n.type!=="auto_repair"&&n.type!=="grid_repair"&&n.type!=="grid_repair_failed"&&n.reasoning?e.jsxs("details",{className:"text-sm text-gray-600 mb-2",children:[e.jsxs("summary",{className:"cursor-pointer font-medium",children:["üì• ",x==="de"?"Bewertungs-Feedback":"Evaluation Feedback"]}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap bg-gray-50 p-3 rounded text-sm overflow-auto max-h-[500px] font-mono",children:n.reasoning})]}):n.type!=="auto_repair"&&n.type!=="grid_repair"&&n.type!=="grid_repair_failed"&&n.score===0&&e.jsx("div",{className:"text-sm text-gray-500 italic mb-2",children:x==="de"?"Qualit√§tsbewertung fehlgeschlagen":x==="fr"?"√âvaluation de qualit√© √©chou√©e":"Quality evaluation failed"}),(()=>{var T;if(n.type==="auto_repair"||n.type==="grid_repair"||n.type==="grid_repair_failed"||n.type==="bbox_detection_only")return null;const g=n.imageData||((T=f[S])==null?void 0:T.imageData);return g?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:x==="de"?"Generiertes Bild":"Generated Image"}),e.jsx("img",{src:g,alt:`Attempt ${n.attempt}`,className:`w-48 h-48 object-contain rounded border cursor-pointer hover:ring-2 ${S===o.length-1?"border-green-300 hover:ring-green-400":"border-gray-200 opacity-75 hover:ring-gray-400"}`,onClick:()=>O({src:g,title:`${x==="de"?"Versuch":"Attempt"} ${n.attempt}`})})]}):n.type==="generation"&&$&&E!==void 0&&!f[S]?e.jsx("button",{onClick:()=>D(S),disabled:N.has(S),className:"mt-2 text-sm px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded border border-blue-300 flex items-center gap-2 disabled:opacity-50",children:N.has(S)?e.jsxs(e.Fragment,{children:[e.jsx(de,{size:14,className:"animate-spin"})," Loading..."]}):e.jsxs(e.Fragment,{children:["üñºÔ∏è ",x==="de"?"Bild laden":"Load Image"]})}):null})(),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(n.timestamp).toLocaleTimeString()})]},S)})})]})]})}function ma(o){if(!o||o.length===0)return{bboxDetection:null,bboxOverlayImage:null,hasBboxOverlay:!1};const k=o.find(d=>d.type==="bbox_detection_only"&&d.bboxDetection)||o.find(d=>d.bboxDetection);if(!k)return{bboxDetection:null,bboxOverlayImage:null,hasBboxOverlay:!1};const x=k.bboxDetection;return x&&typeof x=="object"&&"figures"in x?{bboxDetection:x,bboxOverlayImage:k.bboxOverlayImage||null,hasBboxOverlay:!!k.hasBboxOverlay||!!k.bboxOverlayImage}:{bboxDetection:null,bboxOverlayImage:null,hasBboxOverlay:!1}}function pa(o,k){const x=new Blob([o],{type:"text/plain;charset=utf-8"}),d=URL.createObjectURL(x),$=document.createElement("a");$.href=d,$.download=k,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(d)}function Ss({retryHistory:o,bboxDetection:k,bboxOverlayImage:x,language:d,storyId:$,pageNumber:E,coverType:w}){var T,q;const[O,f]=A.useState(null),[C,N]=A.useState(null),[b,D]=A.useState(!1),H=ma(o),p=k||H.bboxDetection,c=x||H.bboxOverlayImage,n=!!x||H.hasBboxOverlay;if(!p)return null;const S=((T=p.figures)==null?void 0:T.length)||0,U=((q=p.objects)==null?void 0:q.length)||0,Q=async()=>{if(!(!$||b)&&!(!w&&E===void 0)){D(!0);try{const m=localStorage.getItem("auth_token"),F=new URLSearchParams({field:"bboxOverlay"});if(w)F.set("cover",w);else{F.set("page",String(E)),F.set("type","retry");const W=(o==null?void 0:o.findIndex(z=>z.type==="bbox_detection_only"&&z.bboxDetection||z.bboxDetection))??0;F.set("index",String(W))}const V=await fetch(`/api/stories/${$}/dev-image?${F}`,{headers:m?{Authorization:`Bearer ${m}`}:{}});if(V.ok){const W=await V.json();W.bboxOverlayImage&&N(W.bboxOverlayImage)}}catch(m){console.error("Failed to load bbox overlay:",m)}finally{D(!1)}}},g=c||C;return e.jsxs(e.Fragment,{children:[O&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>f(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("div",{className:"absolute -top-8 left-0 text-white text-sm",children:O.title}),e.jsx("img",{src:O.src,alt:O.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute -top-8 right-0 text-white hover:text-gray-300",onClick:()=>f(null),children:"‚úï Close"})]})}),e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-blue-700 flex items-center justify-between",children:e.jsxs("span",{className:"flex items-center gap-2",children:["üì¶ ",d==="de"?"Objekterkennung":"Object Detection",e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded",children:[S," ",d==="de"?"Figuren":"figures",","," ",U," ",d==="de"?"Objekte":"objects"]}),p.positionMismatches&&p.positionMismatches.length>0&&e.jsxs("span",{className:"text-xs bg-yellow-200 text-yellow-800 px-1.5 py-0.5 rounded",children:["‚ö†Ô∏è ",p.positionMismatches.length," ",d==="de"?"Abweichungen":"mismatches"]}),p.missingCharacters&&p.missingCharacters.length>0&&e.jsxs("span",{className:"text-xs bg-red-200 text-red-800 px-1.5 py-0.5 rounded",children:["‚ùå ",p.missingCharacters.length," ",d==="de"?"Char fehlt":"char missing"]}),p.missingObjects&&p.missingObjects.length>0&&e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded",children:["‚ö†Ô∏è ",p.missingObjects.length," ",d==="de"?"Obj fehlt":"obj missing"]}),p.matchedObjects&&p.matchedObjects.length>0&&e.jsxs("span",{className:"text-xs bg-green-200 text-green-800 px-1.5 py-0.5 rounded",children:["‚úì ",p.matchedObjects.length," ",d==="de"?"Obj gefunden":"obj matched"]})]})}),e.jsxs("div",{className:"mt-3 space-y-3",children:[g?e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1 font-medium",children:[d==="de"?"Erkannte Regionen":"Detected Regions",e.jsx("span",{className:"ml-2 text-gray-400",children:"(üü¢ Body, üîµ Face, üü† Object, üü£ Matched)"})]}),e.jsx("img",{src:g,alt:"Bbox overlay",className:"max-w-md border rounded cursor-pointer hover:ring-2 hover:ring-blue-400",onClick:()=>f({src:g,title:d==="de"?"Erkannte Regionen":"Detected Regions"})})]}):n&&$&&E!==void 0?e.jsx("button",{onClick:Q,disabled:b,className:"text-sm px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded border border-blue-300 flex items-center gap-2 disabled:opacity-50",children:b?e.jsxs(e.Fragment,{children:[e.jsx(de,{size:14,className:"animate-spin"})," ",d==="de"?"L√§dt...":"Loading..."]}):e.jsxs(e.Fragment,{children:["üì¶ ",d==="de"?"Erkannte Regionen laden":"Load Detected Regions"]})}):null,p.expectedCharacters&&p.expectedCharacters.length>0&&e.jsxs("details",{className:"bg-violet-50 p-3 rounded border border-violet-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-violet-800",children:["üë• ",d==="de"?"Erwartete Charaktere":"Expected Characters"," (",p.expectedCharacters.length,")"]}),e.jsx("div",{className:"mt-2 grid grid-cols-1 gap-2 text-sm",children:p.expectedCharacters.map((m,F)=>e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-medium text-violet-700",children:m.name}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[m.description,m.position&&e.jsxs("span",{className:"ml-2 text-violet-500",children:["@ ",m.position]})]})]},F))})]}),p.expectedPositions&&Object.keys(p.expectedPositions).length>0&&e.jsxs("div",{className:"bg-purple-50 p-3 rounded border border-purple-200",children:[e.jsxs("div",{className:"font-medium text-purple-800 mb-2",children:["üìç ",d==="de"?"Erwartete Positionen":"Expected Positions"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:Object.entries(p.expectedPositions).map(([m,F])=>e.jsxs("div",{className:"bg-white p-2 rounded border flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-purple-700",children:m}),e.jsx("span",{className:"text-gray-600 text-xs",children:F})]},m))})]}),p.positionMismatches&&p.positionMismatches.length>0&&e.jsxs("div",{className:"bg-yellow-50 p-3 rounded border border-yellow-300",children:[e.jsxs("div",{className:"font-medium text-yellow-800 mb-2",children:["‚ö†Ô∏è ",d==="de"?"Positionsabweichungen":"Position Mismatches"," (",p.positionMismatches.length,")"]}),e.jsx("div",{className:"space-y-2",children:p.positionMismatches.map((m,F)=>e.jsxs("div",{className:"text-sm bg-white p-2 rounded border border-yellow-200",children:[e.jsx("div",{className:"font-medium text-yellow-700",children:m.character}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1 flex gap-3",children:[e.jsxs("span",{children:[d==="de"?"Erwartet":"Expected",": ",e.jsx("span",{className:"font-medium text-purple-600",children:m.expected}),e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",m.expectedLCR,")"]})]}),e.jsx("span",{className:"text-gray-400",children:"‚Üí"}),e.jsxs("span",{children:[d==="de"?"Erkannt":"Actual",": ",e.jsx("span",{className:"font-medium text-orange-600",children:m.actual})]})]})]},F))})]}),p.missingCharacters&&p.missingCharacters.length>0&&e.jsxs("div",{className:"bg-red-50 p-3 rounded border border-red-300",children:[e.jsxs("div",{className:"font-medium text-red-800 mb-2",children:["‚ùå ",d==="de"?"Fehlende Charaktere":"Missing Characters"," (",p.missingCharacters.length,")"]}),e.jsx("div",{className:"text-sm text-red-700",children:d==="de"?"Diese Charaktere wurden in der Szene erwartet, aber nicht im Bild gefunden:":"These characters were expected in the scene but not detected in the image:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:p.missingCharacters.map((m,F)=>e.jsx("span",{className:"bg-white px-2 py-1 rounded border border-red-200 text-sm font-medium text-red-700",children:m},F))})]}),p.expectedObjects&&p.expectedObjects.length>0&&e.jsxs("div",{className:"bg-indigo-50 p-3 rounded border border-indigo-200",children:[e.jsxs("div",{className:"font-medium text-indigo-800 mb-2",children:["üéØ ",d==="de"?"Erwartete Objekte":"Expected Objects"," (",p.expectedObjects.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:p.expectedObjects.map((m,F)=>{var z,G;const V=(z=p.matchedObjects)==null?void 0:z.find(ae=>ae.expected===m),W=(G=p.missingObjects)==null?void 0:G.includes(m);return e.jsxs("div",{className:`bg-white p-2 rounded border flex justify-between items-center ${W?"border-red-300":V?"border-green-300":""}`,children:[e.jsxs("span",{className:`font-medium ${W?"text-red-600":V?"text-green-600":"text-indigo-700"}`,children:[W?"‚ùå":V?"‚úì":"‚Ä¢"," ",m]}),V&&e.jsxs("span",{className:"text-xs text-gray-500 truncate ml-2",children:["‚Üí ",V.matched]})]},F)})})]}),p.missingObjects&&p.missingObjects.length>0&&!p.expectedObjects&&e.jsxs("div",{className:"bg-amber-50 p-3 rounded border border-amber-300",children:[e.jsxs("div",{className:"font-medium text-amber-800 mb-2",children:["‚ö†Ô∏è ",d==="de"?"Fehlende Objekte":"Missing Objects"," (",p.missingObjects.length,")"]}),e.jsx("div",{className:"text-sm text-amber-700",children:d==="de"?"Diese Objekte wurden in der Szene erwartet, aber nicht im Bild gefunden:":"These objects were expected in the scene but not detected in the image:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:p.missingObjects.map((m,F)=>e.jsx("span",{className:"bg-white px-2 py-1 rounded border border-amber-200 text-sm font-medium text-amber-700",children:m},F))})]}),p.figures&&p.figures.length>0&&e.jsxs("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[e.jsxs("div",{className:"font-medium text-green-800 mb-2",children:[d==="de"?"Figuren":"Figures"," (",p.figures.length,")",p.unknownFigures!==void 0&&p.unknownFigures>0&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 text-gray-700 px-1.5 py-0.5 rounded",children:[p.unknownFigures," ",d==="de"?"unbekannt":"unknown"]})]}),e.jsx("div",{className:"space-y-2",children:p.figures.map((m,F)=>{const V=m.name&&m.name!=="UNKNOWN",W=m.confidence==="high"?"text-green-600":m.confidence==="medium"?"text-yellow-600":"text-orange-600",z=m.confidence==="high"?"‚òÖ":m.confidence==="medium"?"‚óÜ":"‚óã";return e.jsxs("div",{className:`text-sm bg-white p-2 rounded border ${V?"border-green-300":"border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`font-medium ${V?"text-green-700":"text-gray-600"}`,children:V?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:W,children:z})," ",m.name]}):e.jsxs(e.Fragment,{children:["? ",m.label||`Figure ${F+1}`]})}),V&&m.confidence&&e.jsx("span",{className:`text-xs ${W}`,children:m.confidence})]}),V&&m.label&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:m.label}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1 grid grid-cols-2 gap-2",children:[m.bodyBox&&e.jsxs("span",{children:["Body: [",m.bodyBox.map(G=>(G*100).toFixed(0)+"%").join(", "),"]"]}),m.faceBox&&e.jsxs("span",{children:["Face: [",m.faceBox.map(G=>(G*100).toFixed(0)+"%").join(", "),"]"]}),m.position&&e.jsxs("span",{children:["Pos: ",m.position]})]})]},F)})})]}),p.objects&&p.objects.length>0&&e.jsxs("div",{className:"bg-orange-50 p-3 rounded border border-orange-200",children:[e.jsxs("div",{className:"font-medium text-orange-800 mb-2",children:[d==="de"?"Objekte":"Objects"," (",p.objects.length,")"]}),e.jsx("div",{className:"space-y-2",children:p.objects.map((m,F)=>{const V=!!m.name,W=m.found!==!1;return e.jsxs("div",{className:`text-sm bg-white p-2 rounded border ${V&&W?"border-green-300":V&&!W?"border-red-300":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`font-medium ${V&&W?"text-green-700":V&&!W?"text-red-600":"text-orange-700"}`,children:V?e.jsxs(e.Fragment,{children:[W?"‚úì":"‚úó"," ",m.name]}):m.label||`Object ${F+1}`}),V&&e.jsx("span",{className:`text-xs ${W?"text-green-600":"text-red-600"}`,children:W?d==="de"?"gefunden":"found":d==="de"?"fehlt":"missing"})]}),V&&m.label&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:m.label}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[m.bodyBox&&e.jsxs("span",{children:["Box: [",m.bodyBox.map(z=>(z*100).toFixed(0)+"%").join(", "),"]"]}),m.position&&e.jsxs("span",{className:"ml-2",children:["Pos: ",m.position]})]})]},F)})})]}),p.characterDescriptions&&Object.keys(p.characterDescriptions).length>0&&e.jsxs("details",{className:"bg-cyan-50 p-3 rounded border border-cyan-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-cyan-800",children:["üë§ ",d==="de"?"Charakter-Beschreibungen":"Character Descriptions"," (",Object.keys(p.characterDescriptions).length,")"]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:Object.entries(p.characterDescriptions).map(([m,F])=>e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("span",{className:"font-medium text-cyan-700",children:m}),e.jsxs("span",{className:"text-gray-600 ml-2",children:[F.genderTerm||F.gender||"?",", ",F.age?`${F.age}y`:"?",F.isChild?" (child)":F.isChild===!1?" (adult)":""]})]},m))})]}),p.rawPrompt&&e.jsxs("details",{className:"bg-gray-50 p-3 rounded border border-gray-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-gray-700",children:["üìù ",d==="de"?"Bbox-Prompt":"Bbox Prompt"]}),e.jsx("pre",{className:"mt-2 text-xs bg-white p-2 rounded border overflow-x-auto whitespace-pre-wrap max-h-48 overflow-y-auto",children:p.rawPrompt})]}),p.rawResponse&&e.jsxs("details",{className:"bg-gray-50 p-3 rounded border border-gray-200",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-gray-700",children:["üì§ ",d==="de"?"Bbox-Antwort":"Bbox Response"]}),e.jsx("pre",{className:"mt-2 text-xs bg-white p-2 rounded border overflow-x-auto whitespace-pre-wrap max-h-64 overflow-y-auto",children:p.rawResponse})]}),e.jsxs("button",{onClick:()=>pa(JSON.stringify(p,null,2),`object-detection-page-${E}.json`),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1 px-2 py-1 bg-blue-50 rounded hover:bg-blue-100",children:[e.jsx(Ee,{size:12})," ",d==="de"?"JSON herunterladen":"Download JSON"]})]})]})]})}function Cs({referencePhotos:o,landmarkPhotos:k,visualBibleGrid:x,language:d,storyId:$,pageNumber:E}){var ae;const[w,O]=A.useState(null),[f,C]=A.useState(null),[N,b]=A.useState(null),[D,H]=A.useState(!1),[p,c]=A.useState(null),n=o==null?void 0:o.some(j=>j.hasPhoto&&!j.photoUrl),S=k==null?void 0:k.some(j=>j.hasPhoto&&!j.photoData),U=A.useCallback(async()=>{if(!(!$||!E||D)&&!(!n&&!S)){H(!0),c(null);try{if(n){const j=await Xs.getDevImage($,E,"reference");j!=null&&j.referencePhotos&&C(j.referencePhotos)}if(S){const j=await Xs.getDevImage($,E,"landmark");j!=null&&j.landmarkPhotos&&b(j.landmarkPhotos)}}catch(j){c(j instanceof Error?j.message:"Failed to load images")}finally{H(!1)}}},[$,E,D,n,S]),Q=f||o,g=N||k,T=Q&&Q.length>0,q=g&&g.length>0,m=!!x;if(!T&&!q&&!m)return null;const F=((o==null?void 0:o.length)||0)+((k==null?void 0:k.length)||0)+(m?1:0),V=j=>{switch(j){case"bodyNoBg":case"body-no-bg":return d==="de"?"Ganzk√∂rper (freigestellt)":d==="fr"?"Corps entier (d√©tour√©)":"Full body (no bg)";case"body":return d==="de"?"Ganzk√∂rper":d==="fr"?"Corps entier":"Full body";case"face":return d==="de"?"Gesicht":d==="fr"?"Visage":"Face only";case"clothing-winter":return d==="de"?"Winter-Avatar":d==="fr"?"Avatar hiver":"Winter avatar";case"clothing-summer":return d==="de"?"Sommer-Avatar":d==="fr"?"Avatar √©t√©":"Summer avatar";case"clothing-formal":return d==="de"?"Formell-Avatar":d==="fr"?"Avatar formel":"Formal avatar";case"clothing-standard":return d==="de"?"Standard-Avatar":d==="fr"?"Avatar standard":"Standard avatar";case"none":return d==="de"?"Kein Foto":d==="fr"?"Pas de photo":"No photo";default:return j}},W=j=>{switch(j){case"bodyNoBg":case"body-no-bg":return"bg-green-100 text-green-700 border-green-300";case"body":return"bg-blue-100 text-blue-700 border-blue-300";case"face":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"clothing-winter":return"bg-cyan-100 text-cyan-700 border-cyan-300";case"clothing-summer":return"bg-orange-100 text-orange-700 border-orange-300";case"clothing-formal":return"bg-purple-100 text-purple-700 border-purple-300";case"clothing-standard":return"bg-teal-100 text-teal-700 border-teal-300";case"none":return"bg-red-100 text-red-700 border-red-300";default:return"bg-gray-100 text-gray-700 border-gray-300"}},z=(ae=Q==null?void 0:Q.find(j=>j.clothingCategory))==null?void 0:ae.clothingCategory,G=j=>{if(!j)return"";switch(j){case"winter":return d==="de"?"Winter":d==="fr"?"Hiver":"Winter";case"summer":return d==="de"?"Sommer":d==="fr"?"√ât√©":"Summer";case"formal":return d==="de"?"Formell":d==="fr"?"Formel":"Formal";case"standard":return"Standard";default:return j}};return e.jsxs("details",{className:"bg-pink-50 border border-pink-300 rounded-lg p-3",onToggle:j=>{j.target.open&&(n||S)&&U()},children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-900 flex items-center gap-2",children:[e.jsx("span",{children:"üì∏"}),d==="de"?"Referenzfotos":d==="fr"?"Photos de r√©f√©rence":"Reference Photos",e.jsxs("span",{className:"text-xs text-pink-600",children:["(",F,")"]}),z&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-pink-200 text-pink-800 text-xs rounded",children:["üëï ",G(z)]}),q&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-amber-200 text-amber-800 text-xs rounded",children:["üìç ",g.length," ",d==="de"?"Wahrzeichen":"Landmark"]}),m&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-indigo-200 text-indigo-800 text-xs rounded",children:"üî≤ VB Grid"}),D&&e.jsx("span",{className:"ml-2 text-xs text-gray-500 animate-pulse",children:"Loading..."})]}),p&&e.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-50 p-2 rounded",children:p}),T&&e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2",children:Q.map((j,Z)=>e.jsxs("div",{className:"bg-white rounded-lg p-2 border border-pink-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:j.name}),j.photoType&&e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap ${W(j.photoType)}`,children:V(j.photoType)})]}),j.photoUrl?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:j.photoUrl,alt:`${j.name} - ${V(j.photoType||"unknown")}`,className:`w-full max-h-32 object-contain rounded border bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity ${j.isStyled?"border-purple-400 ring-2 ring-purple-200":"border-gray-200"}`,onClick:()=>O(j.photoUrl),title:"Click to enlarge"}),j.isStyled&&e.jsx("span",{className:"absolute top-1 right-1 px-1 py-0.5 text-[9px] font-bold bg-purple-500 text-white rounded",children:"üé® STYLED"})]}),j.photoHash&&e.jsxs("div",{className:"mt-1 text-[9px] font-mono text-gray-500 bg-gray-100 px-1 py-0.5 rounded text-center",children:["üîê ",j.photoHash]})]}):e.jsx("div",{className:"text-xs text-gray-500 italic py-2 text-center bg-gray-100 rounded",children:d==="de"?"Foto nicht geladen":"Photo not loaded"})]},Z))}),q&&e.jsxs("div",{className:T?"mt-4 pt-3 border-t border-pink-200":"mt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-amber-700 mb-2 flex items-center gap-1",children:["üìç ",d==="de"?"Wahrzeichen-Referenzfotos":d==="fr"?"Photos de monuments":"Landmark Reference Photos"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:g.map((j,Z)=>e.jsxs("div",{className:"bg-amber-50 rounded-lg p-2 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:j.name}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap bg-amber-100 text-amber-700 border-amber-300",children:"üìç LANDMARK"})]}),j.photoData?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:j.photoData,alt:`${j.name} landmark`,className:"w-full max-h-32 object-contain rounded border border-amber-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>O(j.photoData),title:"Click to enlarge"})}),j.attribution&&e.jsxs("div",{className:"mt-1 text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 rounded truncate",title:j.attribution,children:["üì∑ ",j.attribution]}),j.source&&e.jsxs("div",{className:"mt-0.5 text-[9px] text-gray-400",children:["Source: ",j.source]})]}):e.jsx("div",{className:"text-xs text-gray-500 italic py-2 text-center bg-gray-100 rounded",children:d==="de"?"Foto nicht geladen":"Photo not loaded"})]},Z))})]}),m&&e.jsxs("div",{className:T||q?"mt-4 pt-3 border-t border-pink-200":"mt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-indigo-700 mb-2 flex items-center gap-1",children:["üî≤ ",d==="de"?"Visual Bible Referenzgitter":d==="fr"?"Grille Visual Bible":"Visual Bible Reference Grid"]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-2 border border-indigo-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800",children:d==="de"?"Kombinierte Referenzen":d==="fr"?"R√©f√©rences combin√©es":"Combined References"}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap bg-indigo-100 text-indigo-700 border-indigo-300",children:"üî≤ VB GRID"})]}),e.jsx("div",{className:"text-[10px] text-gray-500 mb-2",children:d==="de"?"Sekund√§re Charaktere, Tiere, Artefakte, Fahrzeuge und zus√§tzliche Wahrzeichen":d==="fr"?"Personnages secondaires, animaux, artefacts, v√©hicules et monuments suppl√©mentaires":"Secondary characters, animals, artifacts, vehicles, and additional landmarks"}),e.jsx("img",{src:x,alt:"Visual Bible Reference Grid",className:"w-full max-h-64 object-contain rounded border border-indigo-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>O(x),title:"Click to enlarge"})]})]}),e.jsx(sa,{src:w,onClose:()=>O(null)})]})}function ga({pageNumber:o,scene:k,onSceneChange:x,onClose:d,onRegenerate:$,isRegenerating:E,imageRegenerationCost:w,characters:O=[],selectedCharacterIds:f=[],onCharacterSelectionChange:C,consistencyRegen:N}){const{language:b}=Gs(),[D,H]=A.useState(!1),[p,c]=A.useState(!1),n=S=>{C&&(f.includes(S)?C(f.filter(U=>U!==S)):C([...f,S]))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ie,{size:20}),b==="de"?`Szene bearbeiten - Seite ${o}`:b==="fr"?`Modifier la sc√®ne - Page ${o}`:`Edit Scene - Page ${o}`]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:b==="de"?"Bearbeiten Sie die Szenenbeschreibung und w√§hlen Sie die Charaktere aus.":b==="fr"?"Modifiez la description de la sc√®ne et s√©lectionnez les personnages.":"Edit the scene description and select the characters."})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[O.length>0&&C&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ut,{size:16}),b==="de"?"Charaktere in dieser Szene:":b==="fr"?"Personnages dans cette sc√®ne:":"Characters in this scene:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:O.map(S=>{const U=f.includes(S.id);return e.jsxs("button",{type:"button",onClick:()=>n(S.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${U?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{className:"font-medium",children:S.name}),U&&e.jsx("span",{className:"text-indigo-500",children:"‚úì"})]},S.id)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:b==="de"?"W√§hlen Sie die Charaktere aus, die im Bild erscheinen sollen.":b==="fr"?"S√©lectionnez les personnages qui doivent appara√Ætre dans l'image.":"Select the characters that should appear in the image."})]}),N&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Xr,{className:"text-amber-600",size:20}),e.jsx("h4",{className:"font-semibold text-amber-800",children:b==="de"?"Konsistenz-Korrektur angewendet":b==="fr"?"Correction de coh√©rence appliqu√©e":"Consistency Fix Applied"}),e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded",children:["Score: ",N.score,"%"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-amber-700 mb-2",children:b==="de"?"Behobene Probleme:":b==="fr"?"Probl√®mes corrig√©s:":"Issues Fixed:"}),e.jsx("ul",{className:"text-sm text-amber-900 space-y-1",children:N.issues.map((S,U)=>e.jsxs("li",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[S.type.toUpperCase(),S.characterInvolved&&` (${S.characterInvolved})`,":"]}),e.jsx("span",{className:"text-amber-700 ml-2",children:S.description}),e.jsxs("span",{className:"text-amber-600 ml-2 text-xs",children:["‚Üí ",S.recommendation]})]},U))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1 text-center",children:"Original"}),e.jsx("img",{src:N.originalImage,alt:"Original",className:"w-full rounded-lg border border-gray-300",draggable:!1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-600 mb-1 text-center",children:b==="de"?"Korrigiert":b==="fr"?"Corrig√©":"Fixed"}),e.jsx("img",{src:N.fixedImage,alt:"Fixed",className:"w-full rounded-lg border-2 border-green-500",draggable:!1})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>H(!D),className:"flex items-center gap-1 text-xs text-gray-600 hover:text-gray-800",children:[D?e.jsx(jr,{size:14}):e.jsx(Te,{size:14}),b==="de"?"Original-Prompt":b==="fr"?"Prompt original":"Original Prompt"]}),D&&e.jsx("pre",{className:"text-xs bg-gray-100 p-2 rounded overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:N.originalPrompt}),e.jsxs("button",{onClick:()=>c(!p),className:"flex items-center gap-1 text-xs text-green-600 hover:text-green-800",children:[p?e.jsx(jr,{size:14}):e.jsx(Te,{size:14}),b==="de"?"Korrigierter Prompt (mit Korrekturen)":b==="fr"?"Prompt corrig√© (avec corrections)":"Fixed Prompt (with corrections)"]}),p&&e.jsx("pre",{className:"text-xs bg-green-50 p-2 rounded border border-green-200 overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:N.fixedPrompt})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xs text-gray-400",children:b==="de"?`Korrigiert am ${new Date(N.timestamp).toLocaleString()}`:b==="fr"?`Corrig√© le ${new Date(N.timestamp).toLocaleString()}`:`Fixed at ${new Date(N.timestamp).toLocaleString()}`}),N.clothing&&e.jsxs("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded",children:["üé® ",N.clothing]})]}),N.avatarsUsed&&N.avatarsUsed.length>0&&e.jsxs("div",{className:"mt-3 p-2 bg-blue-50 rounded border border-blue-200",children:[e.jsx("p",{className:"text-xs font-medium text-blue-700 mb-1",children:b==="de"?"Verwendete Avatare:":b==="fr"?"Avatars utilis√©s:":"Avatars used:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.avatarsUsed.map((S,U)=>e.jsxs("span",{className:`text-xs px-2 py-1 rounded ${S.hasPhoto?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:[S.name,S.category&&S.category!=="standard"&&e.jsxs("span",{className:"ml-1 opacity-75",children:["(",S.category,")"]}),!S.hasPhoto&&" ‚ö†Ô∏è"]},U))})]}),N.retryHistory&&N.retryHistory.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(ts,{retryHistory:N.retryHistory,totalAttempts:N.totalAttempts||1,language:b})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:b==="de"?"Szenenbeschreibung:":b==="fr"?"Description de la sc√®ne:":"Scene description:"}),e.jsx("textarea",{value:k,onChange:S=>x(S.target.value),className:"w-full h-40 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y",placeholder:b==="de"?"Beschreiben Sie die Szene...":b==="fr"?"D√©crivez la sc√®ne...":"Describe the scene..."}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:b==="de"?"Tipp: Beschreiben Sie die Aktionen und die Umgebung. Die ausgew√§hlten Charaktere werden automatisch hinzugef√ºgt.":b==="fr"?"Conseil: D√©crivez les actions et l'environnement. Les personnages s√©lectionn√©s seront ajout√©s automatiquement.":"Tip: Describe the actions and the environment. Selected characters will be added automatically."})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:f.length>0&&e.jsx("span",{children:b==="de"?`${f.length} Charakter(e) ausgew√§hlt`:b==="fr"?`${f.length} personnage(s) s√©lectionn√©(s)`:`${f.length} character(s) selected`})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:d,disabled:E,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700 font-medium disabled:opacity-50 order-2 sm:order-1",children:b==="de"?"Abbrechen":b==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:$,disabled:E||!k.trim(),className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 order-1 sm:order-2 ${E||!k.trim()?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:E?e.jsxs(e.Fragment,{children:[e.jsx(we,{size:16,className:"animate-spin"}),b==="de"?"Generiere...":b==="fr"?"G√©n√©ration...":"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{size:16}),b==="de"?"Neu generieren":b==="fr"?"R√©g√©n√©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",w,")"]})]})})]})]})]})})}const ha={frontCover:{en:"Front Cover",de:"Titelseite",fr:"Couverture"},initialPage:{en:"Dedication Page",de:"Widmungsseite",fr:"Page de d√©dicace"},backCover:{en:"Back Cover",de:"R√ºckseite",fr:"Quatri√®me de couverture"}};function wr({pageNumber:o,coverType:k,versions:x,onClose:d,onSelectVersion:$,developerMode:E=!1}){const{language:w}=Gs(),O=()=>{if(k){const C=ha[k],N=w==="de"?C.de:w==="fr"?C.fr:C.en;return w==="de"?`Bildversionen - ${N}`:w==="fr"?`Versions d'image - ${N}`:`Image Versions - ${N}`}return w==="de"?`Bildversionen - Seite ${o}`:w==="fr"?`Versions d'image - Page ${o}`:`Image Versions - Page ${o}`},f=C=>{k?$(k,C):o!==void 0&&$(o,C)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(fe,{size:20}),O()]}),e.jsx("button",{onClick:d,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Se,{size:20})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:x.map((C,N)=>e.jsxs("div",{className:`relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${C.isActive?"border-green-500 ring-2 ring-green-200":"border-gray-200 hover:border-indigo-300"}`,onClick:()=>f(N),children:[e.jsx("img",{src:C.imageData,alt:`Version ${N+1}`,className:"w-full aspect-square object-cover"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:N===0?"Original":`V${N+1}`}),C.isActive&&e.jsx("span",{className:"bg-green-500 px-2 py-0.5 rounded text-[10px] font-bold",children:w==="de"?"Aktiv":w==="fr"?"Actif":"Active"})]}),e.jsx("div",{className:"text-[10px] text-gray-300 mt-1",children:new Date(C.createdAt).toLocaleDateString()})]})]},N))}),E&&x.length>1&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-700",children:w==="de"?"Szenen- und Prompt-Vergleich":w==="fr"?"Comparaison de sc√®nes et prompts":"Scene & Prompt Comparison"}),x.map((C,N)=>e.jsxs("details",{className:`rounded-lg p-3 ${C.isActive?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-medium text-gray-700",children:[N===0?"Original":`V${N+1}`,C.isActive&&e.jsx("span",{className:"ml-2 text-green-600 text-xs",children:"(Active)"})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[C.userInput&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-purple-700",children:w==="de"?"Benutzer-Eingabe:":w==="fr"?"Entr√©e utilisateur:":"User Input:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-purple-50 p-2 rounded border border-purple-200 max-h-24 overflow-y-auto",children:C.userInput})]}),C.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-amber-700",children:w==="de"?"Erweiterte Szene:":w==="fr"?"Sc√®ne √©tendue:":"Expanded Scene:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-24 overflow-y-auto",children:C.description})]}),C.prompt&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-blue-700",children:w==="de"?"API-Prompt:":w==="fr"?"Prompt API:":"API Prompt:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-32 overflow-y-auto",children:C.prompt})]}),C.modelId&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Model: ",C.modelId]})]})]},N))]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 text-sm text-gray-500",children:w==="de"?"Klicken Sie auf ein Bild, um es auszuw√§hlen":w==="fr"?"Cliquez sur une image pour la s√©lectionner":"Click an image to select it"})]})})}function ua({src:o,title:k,onClose:x}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:x,children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] bg-white rounded-lg overflow-hidden",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:k}),e.jsx("button",{onClick:x,className:"text-gray-500 hover:text-gray-700 p-1",children:e.jsx(Se,{size:20})})]}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsx("img",{src:o,alt:k,className:"max-w-full max-h-[80vh] object-contain mx-auto"})})]})})}function ba({beforeImage:o,afterImage:k,diffImage:x,title:d,onClose:$}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:$,children:e.jsxs("div",{className:"relative bg-white rounded-lg overflow-hidden max-w-[95vw] max-h-[95vh]",onClick:E=>E.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-3 flex items-center justify-between border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:d}),e.jsx("button",{onClick:$,className:"text-gray-500 hover:text-gray-700 p-1",children:e.jsx(Se,{size:20})})]}),e.jsx("div",{className:"p-4 bg-gray-50 overflow-auto max-h-[calc(95vh-60px)]",children:e.jsxs("div",{className:`grid gap-4 ${x?"grid-cols-1 lg:grid-cols-3":"grid-cols-1 lg:grid-cols-2"}`,children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 mb-2 bg-red-100 px-3 py-1 rounded-full",children:"Before"}),e.jsx("img",{src:o,alt:"Before repair",className:"max-w-full max-h-[70vh] object-contain border rounded shadow-sm"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 mb-2 bg-green-100 px-3 py-1 rounded-full",children:"After"}),e.jsx("img",{src:k,alt:"After repair",className:"max-w-full max-h-[70vh] object-contain border rounded shadow-sm"})]}),x&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 mb-2 bg-purple-100 px-3 py-1 rounded-full",children:"Diff (changes in magenta)"}),e.jsx("img",{src:x,alt:"Difference",className:"max-w-full max-h-[70vh] object-contain border rounded shadow-sm"})]})]})})]})})}const Sr={en:{adventure:"Adventure","life-challenge":"Life Challenge",educational:"Educational",historical:"Historical"},de:{adventure:"Abenteuer","life-challenge":"Lebensherausforderung",educational:"Bildung",historical:"Historisch"},fr:{adventure:"Aventure","life-challenge":"D√©fi de vie",educational:"√âducatif",historical:"Historique"}},Cr={en:{"1st-grade":"Picture Book (1st Grade)",standard:"Standard",advanced:"Advanced"},de:{"1st-grade":"Bilderbuch (1. Klasse)",standard:"Standard",advanced:"Fortgeschritten"},fr:{"1st-grade":"Livre illustr√© (1√®re ann√©e)",standard:"Standard",advanced:"Avanc√©"}},fa={"de-CH":"Schweizerdeutsch","de-DE":"Deutsch (Deutschland)",en:"English",fr:"Fran√ßais"};function ja({settings:o,language:k}){var H,p;const[x,d]=A.useState(!1),$=c=>{const n={en:{title:"Story Info",category:"Category",topic:"Topic",theme:"Theme",storyType:"Story Type",storyDetails:"Story Idea",artStyle:"Art Style",language:"Language",readingLevel:"Reading Level",pages:"Length",dedication:"Dedication",mainCharacters:"Main Characters",otherCharacters:"Other Characters",relationships:"Relationships",season:"Season",location:"Location",noData:"Not specified",spring:"Spring",summer:"Summer",autumn:"Autumn",winter:"Winter"},de:{title:"Story-Info",category:"Kategorie",topic:"Thema",theme:"Thema",storyType:"Story-Typ",storyDetails:"Story-Idee",artStyle:"Kunststil",language:"Sprache",readingLevel:"Lesestufe",pages:"L√§nge",dedication:"Widmung",mainCharacters:"Hauptfiguren",otherCharacters:"Andere Figuren",relationships:"Beziehungen",season:"Jahreszeit",location:"Ort",noData:"Nicht angegeben",spring:"Fr√ºhling",summer:"Sommer",autumn:"Herbst",winter:"Winter"},fr:{title:"Info histoire",category:"Cat√©gorie",topic:"Sujet",theme:"Th√®me",storyType:"Type d'histoire",storyDetails:"Id√©e d'histoire",artStyle:"Style artistique",language:"Langue",readingLevel:"Niveau de lecture",pages:"Longueur",dedication:"D√©dicace",mainCharacters:"Personnages principaux",otherCharacters:"Autres personnages",relationships:"Relations",season:"Saison",location:"Lieu",noData:"Non sp√©cifi√©",spring:"Printemps",summer:"√ât√©",autumn:"Automne",winter:"Hiver"}};return(n[k]||n.en)[c]||c},E=c=>(Sr[k]||Sr.en)[c]||c,w=c=>(Cr[k]||Cr.en)[c]||c,O=(c,n)=>c==null||c===""?e.jsx("span",{className:"text-gray-400 italic",children:$("noData")}):e.jsx("span",{className:"text-gray-800",children:c}),f=o.mainCharacters||[],C=((H=o.characters)==null?void 0:H.filter(c=>f.includes(c.id)))||[],N=((p=o.characters)==null?void 0:p.filter(c=>!f.includes(c.id)))||[],b=c=>$(c)||c,D=()=>{if(!o.userLocation)return null;const c=[o.userLocation.city,o.userLocation.region,o.userLocation.country].filter(Boolean);return c.length>0?c.join(", "):null};return e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>d(!x),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-amber-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Gr,{size:16,className:"text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-800",children:$("title")}),e.jsx("span",{className:"text-xs bg-amber-200 text-amber-700 px-2 py-0.5 rounded",children:"DEV"})]}),x?e.jsx(Te,{size:18,className:"text-amber-600"}):e.jsx(gt,{size:18,className:"text-amber-600"})]}),x&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[C.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(pt,{size:12}),$("mainCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(c=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-indigo-100 text-indigo-800 border border-indigo-200",children:[e.jsx(pt,{size:10}),e.jsx("span",{children:c.name})]},c.id))})]}),N.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-2",children:[e.jsx(ut,{size:12}),$("otherCharacters")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(c=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700 border border-gray-200",children:[e.jsx(pt,{size:10}),e.jsx("span",{children:c.name})]},c.id))})]}),o.relationships&&Object.keys(o.relationships).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-2",children:$("relationships")}),e.jsx("div",{className:"text-xs bg-white/50 p-2 rounded border border-amber-100 space-y-1",children:Object.entries(o.relationships).map(([c,n])=>{var T,q;const[S,U]=c.split("-").map(m=>parseInt(m,10)),Q=(T=o.characters)==null?void 0:T.find(m=>m.id===S),g=(q=o.characters)==null?void 0:q.find(m=>m.id===U);return!Q||!g?null:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-amber-600 font-medium whitespace-nowrap",children:[Q.name," ‚Üí ",g.name,":"]}),e.jsx("span",{className:"text-gray-700",children:n})]},c)})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(na,{size:12}),$("language")]}),e.jsx("div",{className:"text-sm",children:o.language?fa[o.language]||o.language:O(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:$("readingLevel")}),e.jsx("div",{className:"text-sm",children:o.languageLevel?w(o.languageLevel):O(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:$("pages")}),e.jsx("div",{className:"text-sm",children:o.pages?`${o.pages} ${k==="de"?"Seiten":"pages"}`:O(void 0)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:$("season")}),e.jsx("div",{className:"text-sm",children:o.season?b(o.season):O(void 0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:$("location")}),e.jsx("div",{className:"text-sm",children:D()||O(void 0)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(ta,{size:12}),$("artStyle")]}),e.jsx("div",{className:"text-sm capitalize",children:O(o.artStyle)})]})]}),o.storyDetails&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(ss,{size:12}),$("storyDetails")]}),e.jsx("div",{className:"text-sm bg-white/50 p-2 rounded border border-amber-100 whitespace-pre-wrap",children:o.storyDetails})]}),(o.storyCategory||o.storyTheme||o.storyTopic)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-amber-100",children:[o.storyCategory&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-amber-700 mb-1",children:[e.jsx(ra,{size:12}),$("category")]}),e.jsx("div",{className:"text-sm",children:E(o.storyCategory)})]}),(o.storyTheme||o.storyTopic)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-amber-700 mb-1",children:o.storyCategory==="adventure"?$("theme"):$("topic")}),e.jsx("div",{className:"text-sm",children:o.storyCategory==="adventure"?o.storyTheme:o.storyTopic})]})]})]})]})}function $r({storyId:o,onShareStatusChange:k,variant:x="compact"}){const{language:d}=Gs(),[$,E]=A.useState(!1),[w,O]=A.useState(null),[f,C]=A.useState(!1),[N,b]=A.useState(!1),[D,H]=A.useState(null),p=x==="full",c={share:d==="de"?"Teilen":d==="fr"?"Partager":"Share",shareStory:d==="de"?"Geschichte teilen":d==="fr"?"Partager l'histoire":"Share Story",enableSharing:d==="de"?"Link aktivieren":d==="fr"?"Activer le lien":"Enable sharing",disableSharing:d==="de"?"Link deaktivieren":d==="fr"?"D√©sactiver le lien":"Disable sharing",copyLink:d==="de"?"Link kopieren":d==="fr"?"Copier le lien":"Copy link",copied:d==="de"?"Kopiert!":d==="fr"?"Copi√©!":"Copied!",shareWhatsApp:d==="de"?"Per WhatsApp teilen":d==="fr"?"Partager sur WhatsApp":"Share on WhatsApp",sharingEnabled:d==="de"?"Teilen aktiv":d==="fr"?"Partage actif":"Sharing enabled",sharingDisabled:d==="de"?"Teilen inaktiv":d==="fr"?"Partage inactif":"Sharing disabled",anyoneWithLink:d==="de"?"Jeder mit dem Link kann die Geschichte lesen":d==="fr"?"Toute personne avec le lien peut lire l'histoire":"Anyone with the link can read the story",errorLoading:d==="de"?"Fehler beim Laden":d==="fr"?"Erreur de chargement":"Error loading"};A.useEffect(()=>{$&&!w&&n()},[$]);const n=async()=>{C(!0),H(null);try{const g=localStorage.getItem("auth_token"),T=await fetch(`/api/stories/${o}/share-status`,{headers:g?{Authorization:`Bearer ${g}`}:{}});if(!T.ok)throw new Error("Failed to fetch status");const q=await T.json();O(q)}catch{H(c.errorLoading)}finally{C(!1)}},S=async()=>{C(!0),H(null);try{const T=(w==null?void 0:w.isShared)?"DELETE":"POST",q=localStorage.getItem("auth_token"),m=await fetch(`/api/stories/${o}/share`,{method:T,headers:q?{Authorization:`Bearer ${q}`}:{}});if(!m.ok)throw new Error("Failed to toggle sharing");const F=await m.json();O({isShared:F.isShared,shareToken:F.shareToken,shareUrl:F.shareUrl}),k==null||k(F.isShared)}catch{H("Failed to update sharing")}finally{C(!1)}},U=async()=>{if(w!=null&&w.shareUrl)try{await navigator.clipboard.writeText(w.shareUrl),b(!0),setTimeout(()=>b(!1),2e3)}catch{const T=document.createElement("textarea");T.value=w.shareUrl,document.body.appendChild(T),T.select(),document.execCommand("copy"),document.body.removeChild(T),b(!0),setTimeout(()=>b(!1),2e3)}},Q=()=>{if(!(w!=null&&w.shareUrl))return;const g=encodeURIComponent(w.shareUrl);window.open(`https://wa.me/?text=${g}`,"_blank")};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>E(!$),className:p?"bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full hover:bg-indigo-600":"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-lg hover:from-blue-600 hover:to-indigo-600 transition-all shadow-md hover:shadow-lg",title:c.share,children:[e.jsx(vr,{className:"w-4 h-4"}),e.jsx("span",{className:p?"":"hidden sm:inline",children:c.share}),(w==null?void 0:w.isShared)&&e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]}),$&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>E(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-xl border border-gray-200 z-50 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(vr,{className:"w-5 h-5 text-blue-600"}),c.shareStory]})}),e.jsx("div",{className:"p-4 space-y-4",children:f&&!w?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(de,{className:"w-6 h-6 animate-spin text-blue-500"})}):D?e.jsx("div",{className:"text-red-500 text-sm py-2",children:D}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[w!=null&&w.isShared?e.jsx(oa,{className:"w-5 h-5 text-green-500"}):e.jsx(la,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:w!=null&&w.isShared?"text-green-700":"text-gray-600",children:w!=null&&w.isShared?c.sharingEnabled:c.sharingDisabled})]}),e.jsx("button",{onClick:S,disabled:f,className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${w!=null&&w.isShared?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"} disabled:opacity-50`,children:f?e.jsx(de,{className:"w-4 h-4 animate-spin"}):w!=null&&w.isShared?c.disableSharing:c.enableSharing})]}),(w==null?void 0:w.isShared)&&w.shareUrl&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500",children:c.anyoneWithLink}),e.jsx("button",{onClick:U,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:N?e.jsxs(e.Fragment,{children:[e.jsx(aa,{className:"w-4 h-4 text-green-500"}),c.copied]}):e.jsxs(e.Fragment,{children:[e.jsx(ia,{className:"w-4 h-4"}),c.copyLink]})}),e.jsxs("button",{onClick:Q,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors",children:[e.jsx(da,{className:"w-4 h-4"}),c.shareWhatsApp]})]})]})})]})]})]})}function Qa({title:o,dedication:k,story:x,outline:d,outlinePrompt:$,outlineModelId:E,outlineUsage:w,storyTextPrompts:O=[],visualBible:f,sceneImages:C,sceneDescriptions:N=[],coverImages:b,regeneratingCovers:D=new Set,languageLevel:H="standard",storyLanguage:p,isGenerating:c=!1,onDownloadPdf:n,onAddToBook:S,onPrintBook:U,onCreateAnother:Q,onDownloadTxt:g,onRegenerateImage:T,onRegenerateCover:q,characters:m=[],onEditImage:F,onEditCover:V,onRepairImage:W,onIteratePage:z,onRevertRepair:G,onVisualBibleChange:ae,storyId:j,developerMode:Z=!1,styledAvatarGeneration:ce=[],costumedAvatarGeneration:xe=[],generationLog:ne=[],finalChecksReport:v,clothingRequirements:je,isPartial:ks=!1,failureReason:rs,generatedPages:Be,totalPages:Me,progressiveMode:Ve=!1,progressiveData:_e,completedPageImages:bt={},originalStory:Ps,onSaveStoryText:Is,onSaveTitleChange:et,userCredits:ft=0,imageRegenerationCost:$e=5,isImpersonating:kr=!1,onSelectImageVersion:jt,onSelectCoverVersion:yt,generationSettings:Nt,onRefreshStory:He}){var Vt,_t,Ht,qt,Wt,Ut,Kt,Jt,Qt,Zt,Yt,Xt;const{t:Pr,language:t}=Gs(),_=p?p.startsWith("de")?"de":p:t,se=kr||ft===-1||ft>=$e,[M,st]=A.useState(null),[ge,De]=A.useState(""),[qe,As]=A.useState(!1),[zs,Ds]=A.useState(x),[as,vt]=A.useState(!1),[tt,Os]=A.useState(!1),[Fs,Rs]=A.useState(o||""),[rt,wt]=A.useState(!1),[at,Ls]=A.useState(null),[it,is]=A.useState(null),[me,ns]=A.useState(null),[,St]=A.useState(!1),[ye,nt]=A.useState(new Set),[K,Oe]=A.useState(null),[he,Ct]=A.useState(null),[We,$t]=A.useState(null),[ls,kt]=A.useState(null),[te,Pt]=A.useState(null),[Fe,It]=A.useState(null),[lt,X]=A.useState(null),[os,Es]=A.useState(null),[Ue,Ts]=A.useState("square"),[Ke,Bs]=A.useState(!1),[Ms,Ir]=A.useState({}),[Je,At]=A.useState(new Set),zt=async s=>{if(!(!j||Ms[s]||Je.has(s))){At(i=>new Set(i).add(s));try{const i=localStorage.getItem("auth_token"),a=await fetch(`/api/stories/${j}/visual-bible-image/${s}`,{headers:i?{Authorization:`Bearer ${i}`}:{}});if(a.ok){const l=await a.json();Ir(r=>({...r,[s]:l.imageData}))}}catch(i){console.error(`Failed to load reference image for ${s}:`,i)}finally{At(i=>{const a=new Set(i);return a.delete(s),a})}}},ds=(s,i)=>{if(!i||!Z)return null;const a=Ms[s],l=Je.has(s);return a?e.jsx("img",{src:a,alt:"Reference",className:"w-16 h-16 object-cover rounded border border-rose-300 cursor-pointer hover:opacity-80",onClick:()=>X({src:a,title:"Reference Image"})}):e.jsx("button",{onClick:()=>zt(s),disabled:l,className:"w-16 h-16 flex items-center justify-center bg-rose-100 border border-rose-300 rounded text-rose-500 hover:bg-rose-200 disabled:opacity-50",title:"Load reference image",children:l?e.jsx(de,{size:16,className:"animate-spin"}):e.jsx(fe,{size:16})})},[Re,Ar]=A.useState({}),[ke,Dt]=A.useState(new Set),ot=async(s,i)=>{const a=`${s}-${i}`;if(!(!j||Re[a]||ke.has(a))){Dt(l=>new Set(l).add(a));try{const l=await Xs.getAvatarGenerationImage(j,s,i);l&&Ar(r=>({...r,[a]:l}))}catch(l){console.error(`Failed to load avatar generation images for ${a}:`,l)}finally{Dt(l=>{const r=new Set(l);return r.delete(a),r})}}},zr=async()=>{if(!j||!ce)return;const s=ce.map((i,a)=>a).filter(i=>!Re[`styled-${i}`]&&!ke.has(`styled-${i}`));await Promise.all(s.map(i=>ot("styled",i)))},Dr=async()=>{if(!j||!xe)return;const s=xe.map((i,a)=>a).filter(i=>!Re[`costumed-${i}`]&&!ke.has(`costumed-${i}`));await Promise.all(s.map(i=>ot("costumed",i)))},Or=async()=>{if(!j||!f)return;const i=[...f.secondaryCharacters||[],...f.animals||[],...f.artifacts||[],...f.locations||[],...f.vehicles||[]].filter(a=>a.hasReferenceImage&&!Ms[a.id]&&!Je.has(a.id)).map(a=>a.id);await Promise.all(i.map(a=>zt(a)))},[cs,Fr]=A.useState({}),[xs,Ot]=A.useState(new Set),Ft=async s=>{if(!(!j||cs[s]!==void 0||xs.has(s))){Ot(i=>new Set(i).add(s));try{const i=await Xs.getEntityGridImageByIndex(j,s);i!=null&&i.gridImage&&Fr(a=>({...a,[s]:i.gridImage}))}catch(i){console.error(`Failed to load entity grid image for index ${s}:`,i)}finally{Ot(i=>{const a=new Set(i);return a.delete(s),a})}}},Rr=async()=>{var a;if(!j)return;const i=(((a=v==null?void 0:v.entity)==null?void 0:a.grids)||[]).map((l,r)=>({grid:l,idx:r})).filter(({grid:l,idx:r})=>!l.gridImage&&cs[r]===void 0).map(({idx:l})=>l);await Promise.all(i.map(l=>Ft(l)))},Lr=async(s,i,a)=>new Promise((l,r)=>{const y=new Image;y.onload=()=>{const h=document.createElement("canvas"),R=h.getContext("2d");if(!R){r(new Error("Could not get canvas context"));return}const{cellSize:I,cols:J}=a,Y=Math.floor(i/J),le=i%J*I,oe=Y*I;h.width=I,h.height=I,R.drawImage(y,le,oe,I,I,0,0,I,I),l(h.toDataURL("image/png"))},y.onerror=()=>r(new Error("Failed to load grid image")),y.src=s}),Er=async(s,i)=>{try{const a=s.manifest.cells[i],l=await Lr(s.gridImage,i,s.manifest),r=a.isReference?"Reference":`Page ${a.pageNumber}`,y=a.clothing&&a.clothing!=="standard"?` (${a.clothing})`:"";X({src:l,title:`${s.entityName} - ${r}${y}`})}catch(a){console.error("Failed to crop cell:",a)}},Tr=(s,i,a,l)=>{var h,R,I,J,Y,re;const r=`${s}-${i}`,y=Re[r];return y&&y[l]?y[l]:l==="output"&&((h=a.output)!=null&&h.imageData)?a.output.imageData:l==="facePhoto"&&((R=a.inputs.facePhoto)!=null&&R.imageData)?a.inputs.facePhoto.imageData:l==="originalAvatar"&&"originalAvatar"in a.inputs&&((I=a.inputs.originalAvatar)!=null&&I.imageData)?a.inputs.originalAvatar.imageData:l==="styleSample"&&"styleSample"in a.inputs&&((J=a.inputs.styleSample)!=null&&J.imageData)?a.inputs.styleSample.imageData:l==="standardAvatar"&&"standardAvatar"in a.inputs&&((Y=a.inputs.standardAvatar)!=null&&Y.imageData)?a.inputs.standardAvatar.imageData||null:l==="referenceAvatar"&&"referenceAvatar"in a.inputs&&((re=a.inputs.referenceAvatar)!=null&&re.imageData)&&a.inputs.referenceAvatar.imageData||null},Pe=(s,i,a,l,r,y)=>{const h=Tr(s,i,a,l),R=`${s}-${i}`,I=ke.has(R),J=!!Re[R];return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:r}),h?e.jsx("img",{src:h,alt:r,className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>X({src:h,title:r}),title:y?`${y} KB - Click to enlarge`:"Click to enlarge"}):y?e.jsx("button",{onClick:()=>ot(s,i),disabled:I||J,className:"w-16 h-16 flex flex-col items-center justify-center bg-blue-50 border border-blue-300 rounded text-blue-500 hover:bg-blue-100 disabled:opacity-50 text-[10px]",title:"Click to load images",children:I?e.jsx(de,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{size:14}),e.jsxs("span",{className:"mt-0.5",children:[y," KB"]})]})}):e.jsx("span",{className:"text-gray-400 italic text-[10px]",children:"N/A"})]})};A.useEffect(()=>{qe||Ds(x)},[x,qe]),A.useEffect(()=>{tt||Rs(o||"")},[o,tt]);const Br=async()=>{if(Is){vt(!0);try{await Is(zs),As(!1)}catch(s){console.error("Failed to save story text:",s)}finally{vt(!1)}}},Rt=async()=>{if(!(!et||!Fs.trim())){wt(!0);try{await et(Fs.trim()),Os(!1)}catch(s){console.error("Failed to save title:",s)}finally{wt(!1)}}},Mr=()=>{Ds(x),As(!1)},Lt=async s=>{if(!(!W||he!==null)){Ct(s);try{await W(s)}catch(i){console.error("Failed to repair image:",i)}finally{Ct(null)}}},Et=async s=>{if(!(!z||Fe!==null)){It(s);try{await z(s)}catch(i){console.error("Failed to iterate page:",i)}finally{It(null)}}},Vr=async s=>{if(!(!j||We!==null)){$t(s);try{const i=await fetch(`/api/stories/${j}/repair-entity-consistency`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({entityName:s,entityType:"character"})});if(!i.ok){const l=await i.json();throw new Error(l.error||"Repair failed")}const a=await i.json();console.log("Entity repair result:",a),a.success&&!a.noChanges&&(He?await He():window.location.reload())}catch(i){console.error("Failed to repair entity consistency:",i),alert(`Failed to repair: ${i instanceof Error?i.message:"Unknown error"}`)}finally{$t(null)}}},_r=async(s,i)=>{if(!(!j||te!==null)){Pt({entity:s,page:i});try{const a=await fetch(`/api/stories/${j}/repair-entity-consistency`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({entityName:s,entityType:"character",pageNumber:i})});if(!a.ok){const r=await a.json();throw new Error(r.error||"Repair failed")}const l=await a.json();if(console.log("Single-page entity repair result:",l),l.rejected&&l.comparison){Es({beforeImage:l.comparison.before,afterImage:l.comparison.after,title:`Repair rejected for ${s} on page ${i}: ${l.reason||"Did not improve consistency"}`});return}l.success?He?await He():window.location.reload():l.rejected||alert(`Repair failed: ${l.error||"Unknown error"}`)}catch(a){console.error("Failed to repair single page:",a),alert(`Failed to repair page ${i}: ${a instanceof Error?a.message:"Unknown error"}`)}finally{Pt(null)}}},Hr=async(s,i)=>{if(!(!j||ls!==null)){kt(s);try{const a=await fetch(`/api/stories/${j}/repair/image/${s}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({correctionNotes:`${i.type||""}: ${i.description||""}
Target: ${i.canonicalVersion||""}
Fix: ${i.recommendation||""}`})});if(!a.ok){const r=await a.json();throw new Error(r.error||"Repair failed")}const l=await a.json();console.log("Image issue repair result:",l),l.success&&(He?await He():window.location.reload())}catch(a){console.error("Failed to repair image issue:",a),alert(`Failed to repair: ${a instanceof Error?a.message:"Unknown error"}`)}finally{kt(null)}}},Tt=(s,i)=>{const a=zs.split(/(?=---\s*(?:Page|Seite)\s+\d+\s*---|(?=##\s*(?:Page|Seite)\s+\d+))/i);let l=0;for(let y=0;y<a.length;y++)if(/^(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i.test(a[y].trim())){l=y;break}const r=l+s;if(r<a.length){const y=a[r].match(/^(---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i),h=y?y[0]:"";a[r]=h+`
`+i.trim()+`
`}Ds(a.join(""))},Qe=s=>{const i=C.find(a=>a.pageNumber===s);return(i==null?void 0:i.imageVersions)||[]},qr=async(s,i)=>{if(jt)try{await jt(s,i),Ls(null)}catch(a){console.error("Failed to select image version:",a)}},Wr=async(s,i)=>{if(yt)try{await yt(s,i),is(null)}catch(a){console.error("Failed to select cover image version:",a)}},Ne=s=>{const i=b==null?void 0:b[s];return!i||typeof i=="string"?[]:i.imageVersions||[]},Ur=s=>{if(!s)return"";let i;if(typeof s!="string"){const y=s;if(y.output)if(typeof y.output=="string")i=y.output;else if(typeof y.output=="object"){const h=y.output.translatedSummary||y.output.imageSummary||"";if(h)return h;i=JSON.stringify(s)}else i=JSON.stringify(s);else i=JSON.stringify(s)}else i=s;if(i.trim().startsWith("{"))try{const y=JSON.parse(i);if(y.output){if(typeof y.output=="string")i=y.output;else if(typeof y.output=="object"){const h=y.output.translatedSummary||y.output.imageSummary;if(h)return h}}}catch{}const a=i.match(/(?:#{1,3}\s*)?(?:\*\*)?6\.?\s*(?:\*\*)?\s*\*?\*?(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*\*?\*?\s*:?\s*\n?([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n---|\n```|$)/i);if(a&&a[2]&&a[2].trim())return a[2].trim();const l=i.match(/(?:#{1,3}\s*)?\*?\*?(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\s*\((?:[^()]+|\([^()]*\))+\)\s*:?\s*\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:#{1,3}\s*)?(?:\*\*)?\d+\.|\n\*\*|\n#{1,3}\s|$)/i);if(l&&l[2]&&l[2].trim())return l[2].trim();if(!i.includes("**")&&i.length<1e3)return i.trim();const r=i.match(/\*?\*?(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\*?\*?\s*\n([\s\S]*?)(?=\n\s*(?:\*\*)?\d+\.\s*\*\*|\n\s*\*\*\d+\.|$)/i);return r&&r[2]&&r[2].trim()?r[2].trim():i.substring(0,500).trim()+"..."},Kr=s=>{if(!s||!m.length)return m.map(l=>l.id);let i;if(typeof s!="string"){const l=s;i=l.output&&typeof l.output=="string"?l.output:JSON.stringify(s)}else i=s;if(i.trim().startsWith("{"))try{const l=JSON.parse(i);l.output&&typeof l.output=="string"&&(i=l.output)}catch{}const a=i.toLowerCase();return m.filter(l=>a.includes(l.name.toLowerCase())).map(l=>l.id)},Bt=s=>{const i=C.find(h=>h.pageNumber===s),a=N.find(h=>h.pageNumber===s),l=(i==null?void 0:i.description)||(a==null?void 0:a.description)||"",r=(a==null?void 0:a.translatedSummary)||Ur(l)||(a==null?void 0:a.imageSummary)||"",y=Kr(l);ns({pageNumber:s,scene:r,selectedCharacterIds:y})},Jr=async()=>{if(!me||!T)return;const s=me.pageNumber,i=me.scene,a=me.selectedCharacterIds;ns(null),nt(l=>new Set(l).add(s)),St(!0);try{await T(s,i,a)}catch(l){console.error("Failed to regenerate image:",l)}finally{nt(l=>{const r=new Set(l);return r.delete(s),r}),nt(l=>(l.size===0&&St(!1),l))}},dt=s=>{let i="",a=[];if(s==="front"&&(b!=null&&b.frontCover)){const h=b.frontCover;typeof h=="object"&&(i=h.translatedDescription||h.description||"",a=h.referencePhotos||[])}else if(s==="initial"&&(b!=null&&b.initialPage)){const h=b.initialPage;typeof h=="object"&&(i=h.translatedDescription||h.description||"",a=h.referencePhotos||[])}else if(s==="back"&&(b!=null&&b.backCover)){const h=b.backCover;typeof h=="object"&&(i=h.translatedDescription||h.description||"",a=h.referencePhotos||[])}let l=[];a.length>0&&m.length>0&&(l=m.filter(h=>a.some(R=>R.name===h.name)).map(h=>h.id)),l.length===0&&(l=m.map(h=>h.id)),Oe({coverType:s,scene:i,selectedCharacterIds:l,title:s==="front"?o:void 0,dedication:s==="initial"?k:void 0})},Qr=async()=>{if(!K||!q)return;const{coverType:s,scene:i,selectedCharacterIds:a,title:l,dedication:r}=K;Oe(null);try{await q(s,i,a,l,r)}catch(y){console.error("Failed to regenerate cover:",y)}},Vs=(s,i,a,l)=>{st({type:s,id:i,field:a}),De(l||"")},_s=()=>{if(!M||!f||!ae)return;const{type:s,id:i,field:a}=M,l={...f};if(s==="secondaryCharacter")l.secondaryCharacters=(l.secondaryCharacters||[]).map(r=>r.id===i?{...r,[a]:ge}:r);else if(s==="animal")l.animals=(l.animals||[]).map(r=>r.id===i?{...r,[a]:ge}:r);else if(s==="artifact")l.artifacts=(l.artifacts||[]).map(r=>r.id===i?{...r,[a]:ge}:r);else if(s==="location")l.locations=(l.locations||[]).map(r=>r.id===i?{...r,[a]:ge}:r);else if(s==="mainCharacter"){const r=parseInt(i);l.mainCharacters=(l.mainCharacters||[]).map(y=>y.id!==r?y:a==="physical.face"?{...y,physical:{...y.physical,face:ge}}:a==="physical.hair"?{...y,physical:{...y.physical,hair:ge}}:a==="physical.build"?{...y,physical:{...y.physical,build:ge}}:y)}ae(l),st(null),De("")},Hs=()=>{st(null),De("")},Ze=(s=>s?s.split(/(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i).slice(1).filter(a=>a.trim().length>0):[])(qe?zs:x),Ye=C.length>0,qs=H==="1st-grade",Mt=(()=>{if(!Ve)return Ze.length;if(Ze.length===0)return 0;let s=1;for(let i=2;i<=Ze.length;i++){const a=i-1;if(C.some(r=>r.pageNumber===a&&r.imageData)||!!bt[a])s=i;else break}return s})(),Zr=(_e==null?void 0:_e.totalPages)||Ze.length;_e!=null&&_e.totalScenes||C.length||Math.ceil(Zr/(qs?1:2));const Xe=s=>s?typeof s=="string"?s:s.imageData||null:null,ct=s=>s?typeof s=="string"?{imageData:s}:s:null,Ws=s=>{var y,h;const a=((y=N.find(R=>R.pageNumber===s))==null?void 0:y.description)||((h=C.find(R=>R.pageNumber===s))==null?void 0:h.description);if(!a)return;const l=R=>{if(typeof R!="string")return R;try{const I=JSON.parse(R);return typeof I=="string"&&(I.startsWith("{")||I.startsWith("["))?l(I):I}catch{return R}},r=l(a);return typeof r=="object"&&r!==null?JSON.stringify(r,null,2):String(r)},Us=s=>{const i=N.find(a=>a.pageNumber===s);return s===1&&i&&(console.log("[StoryDisplay] Page 1 scene keys:",Object.keys(i)),console.log("[StoryDisplay] Page 1 has outlineExtract:",!!i.outlineExtract),console.log("[StoryDisplay] Page 1 has scenePrompt:",!!i.scenePrompt)),i==null?void 0:i.outlineExtract},Ks=s=>{var i;return(i=N.find(a=>a.pageNumber===s))==null?void 0:i.scenePrompt},Js=s=>{var i;return(i=N.find(a=>a.pageNumber===s))==null?void 0:i.textModelId};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center gap-2",children:tt?e.jsxs("div",{className:"flex items-center gap-2 w-full max-w-2xl",children:[e.jsx("input",{type:"text",value:Fs,onChange:s=>Rs(s.target.value),className:"flex-1 text-2xl md:text-3xl font-bold text-gray-800 text-center border-2 border-indigo-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-500",autoFocus:!0,onKeyDown:s=>{s.key==="Enter"&&Rt(),s.key==="Escape"&&(Rs(o||""),Os(!1))}}),e.jsx("button",{onClick:Rt,disabled:rt||!Fs.trim(),className:"p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50",title:t==="de"?"Speichern":t==="fr"?"Sauvegarder":"Save",children:rt?e.jsx(Le,{className:"animate-spin",size:20}):e.jsx(Ge,{size:20})}),e.jsx("button",{onClick:()=>{Rs(o||""),Os(!1)},disabled:rt,className:"p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",title:t==="de"?"Abbrechen":t==="fr"?"Annuler":"Cancel",children:e.jsx(Se,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-800 text-center",children:o||Pr.yourStory}),et&&!c&&e.jsx("button",{onClick:()=>Os(!0),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:t==="de"?"Titel bearbeiten":t==="fr"?"Modifier le titre":"Edit title",children:e.jsx(ie,{size:18})})]})}),ks&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-400 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-amber-500 text-2xl",children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-amber-800",children:t==="de"?"Unvollst√§ndige Geschichte":t==="fr"?"Histoire incompl√®te":"Incomplete Story"}),e.jsx("p",{className:"text-amber-700 text-sm mt-1",children:t==="de"?`Diese Geschichte konnte nicht vollst√§ndig generiert werden. ${Be||C.length} von ${Me||"unbekannt"} Seiten wurden erstellt.`:t==="fr"?`Cette histoire n'a pas pu √™tre g√©n√©r√©e compl√®tement. ${Be||C.length} sur ${Me||"inconnu"} pages ont √©t√© cr√©√©es.`:`This story could not be fully generated. ${Be||C.length} of ${Me||"unknown"} pages were created.`}),rs&&Z&&e.jsxs("details",{className:"mt-2 text-sm",children:[e.jsx("summary",{className:"cursor-pointer text-amber-600 hover:text-amber-700",children:t==="de"?"Fehlerdetails":t==="fr"?"D√©tails de l'erreur":"Error details"}),e.jsx("p",{className:"mt-1 bg-amber-100 p-2 rounded text-amber-800 font-mono text-xs",children:rs})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[Ye&&j&&S&&e.jsxs("button",{onClick:S,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(yr,{size:16})," ",t==="de"?"Buch erstellen":t==="fr"?"Cr√©er le livre":"Create Book"]}),Ye&&n&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>Bs(!Ke),disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ss,{size:16}),t==="de"?"PDF herunterladen":t==="fr"?"T√©l√©charger PDF":"Download PDF",e.jsx(Te,{size:14,className:`transition-transform ${Ke?"rotate-180":""}`})]}),Ke&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:Ue==="square",onChange:()=>Ts("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20√ó20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat",checked:Ue==="A4",onChange:()=>Ts("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21√ó28cm)"})]})]}),e.jsx("button",{onClick:()=>{n(Ue),Bs(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:t==="de"?"Herunterladen":t==="fr"?"T√©l√©charger":"Download"})]})]}),Ye&&j&&!c&&e.jsx($r,{storyId:j,variant:"full"}),Q&&e.jsxs("button",{onClick:Q,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Nr,{size:16})," ",t==="de"?"Neue Geschichte":t==="fr"?"Nouvelle histoire":"New Story"]})]}),Z&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[g&&e.jsxs("button",{onClick:g,className:"bg-gray-500 text-white px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 hover:bg-gray-600",children:[e.jsx(Ee,{size:14})," TXT"]}),Ye&&j&&U&&e.jsxs("button",{onClick:U,disabled:c,className:`bg-yellow-500 text-black px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 ${c?"opacity-50 cursor-not-allowed":"hover:bg-yellow-600"}`,children:[e.jsx(xt,{size:14})," Print (DEV)"]})]}),Z&&Nt&&e.jsx("div",{className:"mt-4",children:e.jsx(ja,{settings:Nt,language:t})}),Z&&e.jsxs("div",{className:"space-y-4 mt-6",children:[d&&e.jsxs("details",{className:"bg-purple-50 border-2 border-purple-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-purple-800 hover:text-purple-900 flex items-center gap-2",children:[e.jsx(ss,{size:20}),qs?t==="de"?"Vollst√§ndige API-Ausgabe (Kombiniert)":t==="fr"?"Sortie API compl√®te (Combin√©e)":"Full API Output (Combined)":t==="de"?"Vollst√§ndige API-Ausgabe (Outline)":t==="fr"?"Sortie API compl√®te (Plan)":"Full API Output (Outline)",E&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-purple-600",children:["(",E,")"]}),w&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-purple-500",children:["[",w.input_tokens.toLocaleString()," in / ",w.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[$&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:t==="de"?"üì§ Prompt (Eingabe)":t==="fr"?"üì§ Prompt (Entr√©e)":"üì§ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:$})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:qs?t==="de"?"üì• API-Antwort (Kombiniert)":t==="fr"?"üì• R√©ponse API (Combin√©e)":"üì• API Response (Combined)":t==="de"?"üì• API-Antwort (Outline)":t==="fr"?"üì• R√©ponse API (Plan)":"üì• API Response (Outline)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:d})]})]})]}),x&&O.length>0&&e.jsxs("details",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(xt,{size:20}),t==="de"?"Vollst√§ndige API-Ausgabe (Story-Text)":t==="fr"?"Sortie API compl√®te (Texte)":"Full API Output (Story Text)",((Vt=O[0])==null?void 0:Vt.modelId)&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-amber-600",children:["(",O[0].modelId,")"]}),((_t=O[0])==null?void 0:_t.usage)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-500",children:["[",O[0].usage.input_tokens.toLocaleString()," in / ",O[0].usage.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:t==="de"?"üì§ Prompt (Eingabe)":t==="fr"?"üì§ Prompt (Entr√©e)":"üì§ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((Ht=O[0])==null?void 0:Ht.prompt)||"No prompt available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:t==="de"?"üì• Rohe API-Antwort (ungefiltert)":t==="fr"?"üì• R√©ponse API brute (non filtr√©e)":"üì• Raw API Response (unfiltered)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((qt=O[0])==null?void 0:qt.rawResponse)||x})]})]})]}),f&&e.jsxs("details",{className:"bg-rose-50 border-2 border-rose-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-rose-800 hover:text-rose-900 flex items-center gap-2",children:[e.jsx(xt,{size:20}),t==="de"?"Visual Bible (Wiederkehrende Elemente)":t==="fr"?"Bible Visuelle (√âl√©ments R√©currents)":"Visual Bible (Recurring Elements)",f.changeLog&&f.changeLog.length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-rose-200 text-rose-800 rounded-full text-xs font-medium",children:[f.changeLog.length," ",t==="de"?"√Ñnderungen":t==="fr"?"changements":"changes"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[(()=>{const i=[...f.secondaryCharacters||[],...f.animals||[],...f.artifacts||[],...f.locations||[],...f.vehicles||[]].filter(a=>a.hasReferenceImage&&!Ms[a.id]).length;return i===0?null:e.jsx("button",{onClick:Or,disabled:Je.size>0,className:"text-xs px-3 py-1.5 bg-rose-500 text-white rounded hover:bg-rose-600 disabled:bg-rose-300",children:Je.size>0?`Loading ${Je.size} images...`:`Load All Reference Images (${i})`})})(),f.mainCharacters&&f.mainCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-purple-300 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-purple-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üëó"}),t==="de"?"Hauptcharaktere (Style Profile)":t==="fr"?"Personnages Principaux (Profil Style)":"Main Characters (Style Profile)"]}),e.jsx("div",{className:"space-y-3",children:f.mainCharacters.map(s=>{var i,a,l,r;return e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-sm",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-800 hover:text-purple-900",children:[s.name,Object.keys(s.generatedOutfits||{}).length>0&&e.jsxs("span",{className:"ml-2 px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:[Object.keys(s.generatedOutfits).length," ",t==="de"?"Outfits":t==="fr"?"tenues":"outfits"]})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Physical:"}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[((i=s.physical)==null?void 0:i.skinTone)||"N/A"," | ",((a=s.physical)==null?void 0:a.hair)||"N/A"," | ",((l=s.physical)==null?void 0:l.build)||"N/A",((r=s.physical)==null?void 0:r.other)&&` | ${s.physical.other}`]})]}),s.generatedOutfits&&Object.keys(s.generatedOutfits).length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-200",children:[e.jsx("span",{className:"font-medium text-gray-600 text-xs",children:"Generated Outfits:"}),e.jsx("div",{className:"mt-1 space-y-1",children:Object.entries(s.generatedOutfits).map(([y,h])=>{var R;return e.jsxs("div",{className:"bg-white p-1.5 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-purple-600",children:["Page ",y,":"]}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[(R=h.outfit)==null?void 0:R.substring(0,80),"..."]}),e.jsx("span",{className:`ml-1 px-1 py-0.5 rounded text-[10px] ${h.setting==="outdoor-cold"?"bg-blue-100 text-blue-700":h.setting==="outdoor-warm"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:h.setting})]},y)})})]})]})]},s.id)})})]}),f.secondaryCharacters&&f.secondaryCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Nebencharaktere":t==="fr"?"Personnages Secondaires":"Secondary Characters"}),e.jsx("div",{className:"space-y-2",children:f.secondaryCharacters.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[ds(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(M==null?void 0:M.type)==="secondaryCharacter"&&(M==null?void 0:M.id)===s.id&&(M==null?void 0:M.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:ge,onChange:a=>De(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:_s,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Ge,{size:12})," Save"]}),e.jsxs("button",{onClick:Hs,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Se,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&ae&&e.jsx("button",{onClick:()=>Vs("secondaryCharacter",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(ie,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),((Wt=f.animals)==null?void 0:Wt.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Tiere & Wesen":t==="fr"?"Animaux & Cr√©atures":"Animals & Creatures"}),e.jsx("div",{className:"space-y-2",children:f.animals.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[ds(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(M==null?void 0:M.type)==="animal"&&(M==null?void 0:M.id)===s.id&&(M==null?void 0:M.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:ge,onChange:a=>De(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:_s,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Ge,{size:12})," Save"]}),e.jsxs("button",{onClick:Hs,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Se,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&ae&&e.jsx("button",{onClick:()=>Vs("animal",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(ie,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),((Ut=f.artifacts)==null?void 0:Ut.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Artefakte & Objekte":t==="fr"?"Artefacts & Objets":"Artifacts & Objects"}),e.jsx("div",{className:"space-y-2",children:f.artifacts.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[ds(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),(M==null?void 0:M.type)==="artifact"&&(M==null?void 0:M.id)===s.id&&(M==null?void 0:M.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:ge,onChange:a=>De(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:_s,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Ge,{size:12})," Save"]}),e.jsxs("button",{onClick:Hs,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Se,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&ae&&e.jsx("button",{onClick:()=>Vs("artifact",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(ie,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),((Kt=f.locations)==null?void 0:Kt.length)>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Wiederkehrende Orte":t==="fr"?"Lieux R√©currents":"Recurring Locations"}),e.jsx("div",{className:"space-y-2",children:f.locations.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[!s.isRealLandmark&&ds(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.isRealLandmark&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-amber-100 text-amber-700 font-semibold",children:"üìç LANDMARK"}),s.photoFetchStatus==="success"&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-green-100 text-green-700",children:"üì∑ Photo"}),!s.isRealLandmark&&s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),s.isRealLandmark&&s.landmarkQuery&&e.jsxs("div",{className:"text-amber-700 text-xs mt-1",children:["Landmark: ",e.jsx("span",{className:"font-mono bg-amber-50 px-1 rounded",children:s.landmarkQuery})]}),(M==null?void 0:M.type)==="location"&&(M==null?void 0:M.id)===s.id&&(M==null?void 0:M.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:ge,onChange:a=>De(a.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:_s,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(Ge,{size:12})," Save"]}),e.jsxs("button",{onClick:Hs,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(Se,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:s.description}),Z&&ae&&e.jsx("button",{onClick:()=>Vs("location",s.id,"description",s.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(ie,{size:12})})]}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]}),s.referencePhotoData&&e.jsxs("div",{className:"mt-2 border border-amber-200 rounded overflow-hidden",children:[e.jsx("img",{src:s.referencePhotoData,alt:`${s.name} reference`,className:"w-full max-h-32 object-contain bg-gray-50"}),s.photoAttribution&&e.jsxs("div",{className:"text-[9px] text-gray-500 bg-gray-100 px-1 py-0.5 truncate",children:["üì∑ ",s.photoAttribution]})]})]})]},s.id)})})]}),f.vehicles&&f.vehicles.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Fahrzeuge":t==="fr"?"V√©hicules":"Vehicles"}),e.jsx("div",{className:"space-y-2",children:f.vehicles.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm flex gap-3",children:[ds(s.id,s.hasReferenceImage),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2 flex-wrap",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),s.hasReferenceImage&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:"has ref"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:s.description}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]})]},s.id)})})]}),f.clothing&&f.clothing.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:t==="de"?"Kleidung & Kost√ºme":t==="fr"?"V√™tements & Costumes":"Clothing & Costumes"}),e.jsx("div",{className:"space-y-2",children:f.clothing.map(s=>{var i;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[s.name,s.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:s.id}),s.wornBy&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:["worn by ",s.wornBy]}),s.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.source==="outline"?"Outline":"Story"}),((i=s.appearsInPages)==null?void 0:i.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",s.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:s.description}),s.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",s.extractedDescription]})]},s.id)})})]}),f.changeLog&&f.changeLog.length>0&&e.jsxs("details",{className:"bg-white border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-bold text-amber-700 hover:text-amber-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üìù"}),t==="de"?"√Ñnderungsprotokoll":t==="fr"?"Journal des Modifications":"Change Log",e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-amber-100 text-amber-700 rounded text-xs",children:f.changeLog.length})]}),e.jsx("div",{className:"mt-2 space-y-1 max-h-[500px] overflow-y-auto",children:f.changeLog.slice().reverse().map((s,i)=>{var a;return e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs border-l-2 border-amber-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${s.type==="mainCharacter"?"bg-purple-100 text-purple-700":s.type==="secondaryCharacter"?"bg-rose-100 text-rose-700":s.type==="generatedOutfit"?"bg-green-100 text-green-700":s.type==="animal"?"bg-orange-100 text-orange-700":s.type==="artifact"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:s.type}),e.jsx("span",{className:"font-semibold text-amber-800",children:s.element}),e.jsxs("span",{className:"text-gray-500",children:[_==="de"?"Seite":"Page"," ",s.page]})]}),e.jsxs("div",{className:"mt-1 text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:[s.change,":"]}),e.jsxs("span",{className:"ml-1 text-gray-700",children:[(a=s.after)==null?void 0:a.substring(0,100),s.after&&s.after.length>100?"...":""]})]}),s.before&&e.jsxs("div",{className:"text-gray-400 line-through text-[10px] mt-0.5",children:[t==="de"?"Vorher":t==="fr"?"Avant":"Before",": ",s.before.substring(0,50),"..."]}),e.jsx("div",{className:"text-gray-400 text-[10px] mt-0.5",children:new Date(s.timestamp).toLocaleTimeString()})]},i)})})]}),(!f.mainCharacters||f.mainCharacters.length===0)&&(!f.secondaryCharacters||f.secondaryCharacters.length===0)&&(!f.animals||f.animals.length===0)&&(!f.artifacts||f.artifacts.length===0)&&(!f.locations||f.locations.length===0)&&(!f.vehicles||f.vehicles.length===0)&&(!f.clothing||f.clothing.length===0)&&e.jsx("div",{className:"text-gray-500 text-sm italic",children:t==="de"?"Keine wiederkehrenden Elemente gefunden":t==="fr"?"Aucun √©l√©ment r√©current trouv√©":"No recurring elements found in this story"})]})]}),je&&Object.keys(je).length>0&&e.jsxs("details",{className:"bg-teal-50 border-2 border-teal-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-teal-800 hover:text-teal-900 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"üëî"}),t==="de"?`Kleidungsanforderungen (${Object.keys(je).length} Charaktere)`:t==="fr"?`Exigences vestimentaires (${Object.keys(je).length} personnages)`:`Clothing Requirements (${Object.keys(je).length} characters)`]}),e.jsx("div",{className:"mt-4 space-y-3",children:Object.entries(je).map(([s,i])=>{var a,l,r,y,h,R,I,J,Y,re,le,oe,ue,be,Ie;return e.jsxs("div",{className:"bg-white border border-teal-200 rounded-lg p-3",children:[e.jsx("h4",{className:"font-bold text-teal-700 mb-2",children:s}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:`p-2 rounded ${(a=i.standard)!=null&&a.used?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(l=i.standard)!=null&&l.used?"‚úÖ":"‚¨ú"," Standard"]}),((r=i.standard)==null?void 0:r.used)&&((y=i.standard)==null?void 0:y.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:i.standard.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(h=i.winter)!=null&&h.used?"bg-blue-50 border border-blue-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(R=i.winter)!=null&&R.used?"‚ùÑÔ∏è":"‚¨ú"," Winter"]}),((I=i.winter)==null?void 0:I.used)&&((J=i.winter)==null?void 0:J.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:i.winter.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(Y=i.summer)!=null&&Y.used?"bg-yellow-50 border border-yellow-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(re=i.summer)!=null&&re.used?"‚òÄÔ∏è":"‚¨ú"," Summer"]}),((le=i.summer)==null?void 0:le.used)&&((oe=i.summer)==null?void 0:oe.signature)&&e.jsx("div",{className:"text-gray-600 mt-1",children:i.summer.signature})]}),e.jsxs("div",{className:`p-2 rounded ${(ue=i.costumed)!=null&&ue.used?"bg-purple-50 border border-purple-200":"bg-gray-50 border border-gray-200 opacity-50"}`,children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-1",children:[(be=i.costumed)!=null&&be.used?"üé≠":"‚¨ú"," Costumed"]}),((Ie=i.costumed)==null?void 0:Ie.used)&&e.jsxs("div",{className:"text-gray-600 mt-1",children:[i.costumed.costume&&e.jsxs("span",{className:"font-medium",children:[i.costumed.costume,": "]}),i.costumed.description]})]})]})]},s)})})]}),ce&&ce.length>0&&e.jsxs("details",{className:"bg-pink-50 border-2 border-pink-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-pink-800 hover:text-pink-900 flex items-center gap-2",children:[e.jsx(fe,{size:20}),t==="de"?`Stilisierte Avatare (${ce.length})`:t==="fr"?`Avatars stylis√©s (${ce.length})`:`Styled Avatars (${ce.length})`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[(()=>{const s=ce.filter((i,a)=>!Re[`styled-${a}`]).length;return s===0?null:e.jsx("button",{onClick:zr,disabled:ke.size>0,className:"text-xs px-3 py-1.5 bg-pink-500 text-white rounded hover:bg-pink-600 disabled:bg-pink-300",children:ke.size>0?"Loading...":`Load All Images (${s})`})})(),ce.map((s,i)=>{var a,l;return e.jsxs("details",{className:`border rounded-lg p-3 ${s.success?"bg-white border-pink-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.success?"bg-green-500":"bg-red-500"}`}),s.characterName," - ",s.artStyle," (",s.clothingCategory||"standard",")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(s.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[Pe("styled",i,s,"facePhoto","Face Photo",(a=s.inputs.facePhoto)==null?void 0:a.sizeKB),Pe("styled",i,s,"originalAvatar","Original Avatar",(l=s.inputs.originalAvatar)==null?void 0:l.sizeKB),s.inputs.styleSample&&Pe("styled",i,s,"styleSample","Style Sample",s.inputs.styleSample.sizeKB)]})]}),s.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",s.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-[500px] overflow-y-auto",children:s.prompt})]}),s.success&&s.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2",children:Pe("styled",i,s,"output","Styled Avatar Output",s.output.sizeKB)})]}),!s.success&&s.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:s.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(s.timestamp).toLocaleString()]})]})]},i)})]})]}),xe&&xe.length>0&&e.jsxs("details",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-orange-800 hover:text-orange-900 flex items-center gap-2",children:[e.jsx(fe,{size:20}),t==="de"?`Kost√ºm-Avatare (${xe.length})`:t==="fr"?`Avatars costum√©s (${xe.length})`:`Costumed Avatars (${xe.length})`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[(()=>{const s=xe.filter((i,a)=>!Re[`costumed-${a}`]).length;return s===0?null:e.jsx("button",{onClick:Dr,disabled:ke.size>0,className:"text-xs px-3 py-1.5 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:bg-orange-300",children:ke.size>0?"Loading...":`Load All Images (${s})`})})(),xe.map((s,i)=>{var a,l,r,y,h,R,I,J,Y,re,le,oe,ue,be;return e.jsxs("details",{className:`border rounded-lg p-3 ${s.success?"bg-white border-orange-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 hover:text-orange-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.success?"bg-green-500":"bg-red-500"}`}),s.characterName," - ",s.costumeType," (",s.artStyle,")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(s.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[s.costumeDescription&&e.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-yellow-700",children:"Costume:"}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.costumeDescription})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[((a=s.inputs)==null?void 0:a.facePhoto)&&Pe("costumed",i,s,"facePhoto","Face Photo",(l=s.inputs.facePhoto)==null?void 0:l.sizeKB),((r=s.inputs)==null?void 0:r.standardAvatar)&&Pe("costumed",i,s,"standardAvatar","Standard Avatar",(y=s.inputs.standardAvatar)==null?void 0:y.sizeKB),((h=s.inputs)==null?void 0:h.referenceAvatar)&&Pe("costumed",i,s,"referenceAvatar","Reference Avatar",(R=s.inputs.referenceAvatar)==null?void 0:R.sizeKB)]})]}),s.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",s.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-[500px] overflow-y-auto",children:s.prompt})]}),s.success&&s.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2",children:Pe("costumed",i,s,"output","Costumed Avatar Output",s.output.sizeKB)})]}),s.costumeEvaluation&&e.jsxs("div",{className:`p-2 rounded text-xs ${s.costumeEvaluation.pass?"bg-emerald-50 border border-emerald-200":"bg-amber-50 border border-amber-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-semibold ${s.costumeEvaluation.pass?"text-emerald-700":"text-amber-700"}`,children:"Costume Check:"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${s.costumeEvaluation.pass?"bg-emerald-200 text-emerald-800":"bg-amber-200 text-amber-800"}`,children:s.costumeEvaluation.pass?"PASS":"FAIL"}),e.jsxs("span",{className:"text-gray-500",children:["(",s.costumeEvaluation.confidence," confidence)"]})]}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.costumeEvaluation.reason}),s.costumeEvaluation.details&&e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-[10px]",children:[e.jsxs("div",{className:`p-1 rounded ${((I=s.costumeEvaluation.details.bottomLeft)==null?void 0:I.costumeMatch)==="full"?"bg-emerald-100":((J=s.costumeEvaluation.details.bottomLeft)==null?void 0:J.costumeMatch)==="none"?"bg-red-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-semibold",children:"Bottom-Left:"})," ",((Y=s.costumeEvaluation.details.bottomLeft)==null?void 0:Y.costumeMatch)||"N/A",((re=s.costumeEvaluation.details.bottomLeft)==null?void 0:re.description)&&e.jsx("div",{className:"text-gray-600 truncate",children:s.costumeEvaluation.details.bottomLeft.description})]}),e.jsxs("div",{className:`p-1 rounded ${((le=s.costumeEvaluation.details.bottomRight)==null?void 0:le.costumeMatch)==="full"?"bg-emerald-100":((oe=s.costumeEvaluation.details.bottomRight)==null?void 0:oe.costumeMatch)==="none"?"bg-red-100":"bg-gray-100"}`,children:[e.jsx("span",{className:"font-semibold",children:"Bottom-Right:"})," ",((ue=s.costumeEvaluation.details.bottomRight)==null?void 0:ue.costumeMatch)||"N/A",((be=s.costumeEvaluation.details.bottomRight)==null?void 0:be.description)&&e.jsx("div",{className:"text-gray-600 truncate",children:s.costumeEvaluation.details.bottomRight.description})]})]})]}),!s.success&&s.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:s.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(s.timestamp).toLocaleString()]})]})]},i)})]})]}),ne&&ne.length>0&&e.jsxs("details",{className:"bg-slate-50 border-2 border-slate-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-slate-800 hover:text-slate-900 flex items-center gap-2",children:[e.jsx(ss,{size:20}),t==="de"?`Generierungslog (${ne.length})`:t==="fr"?`Journal de g√©n√©ration (${ne.length})`:`Generation Log (${ne.length})`,ne.filter(s=>s.level==="warn").length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-yellow-200 text-yellow-800 text-xs rounded-full",children:[ne.filter(s=>s.level==="warn").length," warnings"]}),ne.filter(s=>s.level==="error").length>0&&e.jsxs("span",{className:"ml-1 px-2 py-0.5 bg-red-200 text-red-800 text-xs rounded-full",children:[ne.filter(s=>s.level==="error").length," errors"]})]}),e.jsx("div",{className:"mt-4 space-y-1 max-h-96 overflow-y-auto",children:ne.map((s,i)=>e.jsxs("div",{className:`text-xs p-2 rounded flex items-start gap-2 ${s.level==="error"?"bg-red-50 text-red-800":s.level==="warn"?"bg-yellow-50 text-yellow-800":s.level==="debug"?"bg-gray-50 text-gray-600":"bg-white text-slate-700"}`,children:[e.jsx("span",{className:"text-gray-400 font-mono text-[10px] whitespace-nowrap",children:new Date(s.timestamp).toLocaleTimeString()}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium whitespace-nowrap ${s.stage==="outline"?"bg-blue-100 text-blue-700":s.stage==="avatars"?"bg-purple-100 text-purple-700":s.stage==="scenes"?"bg-green-100 text-green-700":s.stage==="images"?"bg-orange-100 text-orange-700":s.stage==="covers"?"bg-pink-100 text-pink-700":"bg-gray-100 text-gray-700"}`,children:s.stage}),s.character&&e.jsxs("span",{className:"font-medium text-slate-600",children:["[",s.character,"]"]}),e.jsx("span",{className:"flex-1",children:s.message}),e.jsx("span",{className:"text-gray-400 text-[10px]",children:s.event})]},i))})]}),((Jt=v==null?void 0:v.entity)==null?void 0:Jt.grids)&&v.entity.grids.length>0&&e.jsxs("details",{className:`border-2 rounded-xl p-4 ${v.entity.overallConsistent!==!1?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("summary",{className:`cursor-pointer text-lg font-bold flex items-center gap-2 ${v.entity.overallConsistent!==!1?"text-green-800 hover:text-green-900":"text-amber-800 hover:text-amber-900"}`,children:[v.entity.overallConsistent!==!1?"‚úì":"‚ö†Ô∏è",t==="de"?`Charakterkonsistenz (${v.entity.totalIssues||0} Probleme)`:t==="fr"?`Coh√©rence des personnages (${v.entity.totalIssues||0} probl√®mes)`:`Character Consistency (${v.entity.totalIssues||0} issues)`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700",children:v.entity.summary}),(()=>{var a;const i=(((a=v.entity)==null?void 0:a.grids)||[]).filter((l,r)=>!l.gridImage&&cs[r]===void 0).length;return i===0?null:e.jsx("button",{onClick:Rr,disabled:xs.size>0,className:"text-xs px-3 py-1.5 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-blue-300",children:xs.size>0?`Loading ${xs.size} grids...`:`Load All Grids (${i})`})})(),e.jsx("div",{className:"space-y-2",children:v.entity.grids.map((s,i)=>{var R,I,J,Y,re,le,oe,ue,be,Ie,ms,ps,gs,hs,us,bs,fs,js,ys,Ns,vs,P,pe,Gt,er,sr,tr,rr,ar,ir,nr,lr,or,dr,cr,xr,mr,pr,gr,hr,ur,br;const a=(I=(R=v.entity)==null?void 0:R.characters)==null?void 0:I[s.entityName],l=(a==null?void 0:a.overallConsistent)??(a==null?void 0:a.consistent)??!0,r=(a==null?void 0:a.overallScore)??(a==null?void 0:a.score)??0,y=(a==null?void 0:a.issues)??[],h=s.clothingCategory;return e.jsxs("details",{className:`bg-white border rounded-lg overflow-hidden ${l?"border-green-200":"border-amber-200"}`,children:[e.jsxs("summary",{className:"cursor-pointer p-3 flex items-center gap-2 hover:bg-gray-50",children:[e.jsx("span",{className:`text-sm ${l?"text-green-600":"text-amber-600"}`,children:l?"‚úì":"‚ö†Ô∏è"}),e.jsxs("span",{className:"font-medium text-sm text-gray-800",children:[s.entityName,h&&e.jsx("span",{className:`ml-1.5 text-xs font-normal px-1.5 py-0.5 rounded ${h.startsWith("costumed:")?"bg-purple-100 text-purple-700":h==="winter"?"bg-blue-100 text-blue-700":h==="summer"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:h})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.cellCount," appearance",s.cellCount!==1?"s":"",")"]}),e.jsxs("span",{className:`ml-auto text-xs px-2 py-0.5 rounded ${r>=8?"bg-green-100 text-green-700":r>=5?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:["Score: ",r,"/10"]})]}),e.jsxs("div",{className:"p-3 border-t border-gray-100 space-y-3",children:[(()=>{const u=s.gridImage||cs[i],B=xs.has(i),L=s.gridImageSizeKB;return u?e.jsx("div",{className:"flex justify-center bg-gray-50 rounded p-2",children:e.jsx("img",{src:u,alt:`${s.entityName} consistency grid`,className:"max-w-full h-auto rounded shadow-sm cursor-pointer hover:opacity-90 transition-opacity",style:{maxHeight:"400px"},onClick:()=>X({src:u,title:`${s.entityName}${h?` (${h})`:""} - Entity Consistency Grid`}),title:"Click to enlarge"})}):B?e.jsx("div",{className:"flex justify-center items-center bg-gray-100 rounded p-4 h-32",children:e.jsx("span",{className:"text-sm text-gray-500",children:"Loading grid image..."})}):e.jsxs("div",{className:"flex flex-col items-center bg-gray-100 rounded p-4",children:[e.jsxs("span",{className:"text-xs text-gray-500 mb-2",children:["Grid image not loaded ",L?`(${L} KB)`:""]}),e.jsx("button",{onClick:()=>Ft(i),className:"text-xs px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Load Grid"})]})})(),((J=s.manifest)==null?void 0:J.cells)&&e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Cells: "}),s.manifest.cells.map((u,B)=>{const L=s.gridImage||cs[i];return e.jsxs("span",{className:"inline-flex items-center bg-gray-100 rounded px-1.5 py-0.5 mr-1 mb-1 gap-1",children:[e.jsxs("button",{onClick:()=>L&&Er({...s,gridImage:L},B),className:`${L?"hover:text-blue-600 hover:underline cursor-pointer":"text-gray-400 cursor-not-allowed"}`,title:L?"Click to enlarge this cell":"Load grid image first",disabled:!L,children:[u.letter,": ",u.isReference?"Ref":`P${u.pageNumber}`,u.clothing&&u.clothing!=="standard"&&` (${u.clothing})`]}),!u.isReference&&j&&typeof u.pageNumber=="number"&&e.jsx("button",{onClick:ve=>{ve.stopPropagation(),_r(s.entityName,u.pageNumber)},disabled:c||te!==null||We!==null,className:`ml-0.5 px-1 py-0 text-[9px] rounded transition-colors ${(te==null?void 0:te.entity)===s.entityName&&(te==null?void 0:te.page)===u.pageNumber?"bg-amber-300 text-amber-800":c||te!==null||We!==null?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"}`,title:`Repair page ${u.pageNumber} for ${s.entityName}`,children:(te==null?void 0:te.entity)===s.entityName&&(te==null?void 0:te.page)===u.pageNumber?"...":"‚ö°"})]},B)})]}),y.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700",children:"Issues:"}),y.map((u,B)=>{var L;return e.jsxs("div",{className:`text-xs p-2 rounded ${u.severity==="critical"?"bg-red-50 border-l-4 border-red-400":u.severity==="major"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${u.severity==="critical"?"bg-red-200 text-red-800":u.severity==="major"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:u.severity}),u.cells&&e.jsxs("span",{className:"text-gray-500",children:["Cells: ",u.cells.map((ve,Ae)=>{var ws;const Qs=(((ws=s.manifest)==null?void 0:ws.cells)||[]).some(fr=>fr.letter===ve&&!fr.isReference);return e.jsxs("span",{className:Qs?"font-semibold text-gray-800":"text-gray-400",children:[Ae>0?", ":"",ve]},Ae)})]}),u.pagesToFix&&u.pagesToFix.length>0&&(()=>{var Ae;const ve=new Set((((Ae=s.manifest)==null?void 0:Ae.cells)||[]).filter(ee=>!ee.isReference&&ee.pageNumber!=null).map(ee=>ee.pageNumber));return e.jsxs("span",{className:"text-[10px]",children:["Fix: Page"," ",u.pagesToFix.map((ee,Qs)=>{const ws=ve.has(ee);return e.jsxs("span",{className:`px-1 py-0.5 rounded ${ws?"bg-orange-200 text-orange-800 font-semibold":"bg-gray-200 text-gray-500"}`,title:ws?"Visible in grid above":"Not in this grid",children:[Qs>0?" ":"",ee]},Qs)})]})})(),u.clothingCategory&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded text-[10px]",children:u.clothingCategory}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:u.subType||((L=u.type)==null?void 0:L.replace(/_/g," "))})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:u.description}),u.fixInstruction&&e.jsxs("p",{className:"text-green-700 mt-1 text-[10px]",children:["‚Üí ",u.fixInstruction]})]},B)})]}),j&&(!l||r<8)&&s.entityType==="character"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>Vr(s.entityName),disabled:c||We!==null,className:`flex items-center gap-2 px-3 py-1.5 text-xs font-medium rounded transition-colors ${c||We!==null?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"}`,children:We===s.entityName?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{children:"Repairing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"w-3 h-3"}),e.jsx("span",{children:"Repair All"})]})}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Regenerate all appearances to match reference"})]}),((Y=v.entityRepairs)==null?void 0:Y[s.entityName])&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-green-700",children:"‚úì Repaired"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(le=(re=v.entityRepairs)==null?void 0:re[s.entityName])!=null&&le.cellsRepaired?`${(oe=v.entityRepairs[s.entityName])==null?void 0:oe.cellsRepaired} pages updated`:(be=(ue=v.entityRepairs)==null?void 0:ue[s.entityName])!=null&&be.pages?`${Object.keys(((Ie=v.entityRepairs[s.entityName])==null?void 0:Ie.pages)||{}).length} page(s) repaired individually`:"",(((ps=(ms=v.entityRepairs)==null?void 0:ms[s.entityName])==null?void 0:ps.clothingGroupCount)??0)>1&&` (${(hs=(gs=v.entityRepairs)==null?void 0:gs[s.entityName])==null?void 0:hs.clothingGroupCount} clothing groups)`]})]}),(fs=(bs=(us=v.entityRepairs)==null?void 0:us[s.entityName])==null?void 0:bs.gridsByClothing)!=null&&fs.length?e.jsx("div",{className:"space-y-3",children:(Ns=(ys=(js=v.entityRepairs)==null?void 0:js[s.entityName])==null?void 0:ys.gridsByClothing)==null?void 0:Ns.map(u=>{var B;return e.jsxs("div",{className:"border border-gray-200 rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700",children:u.clothingCategory}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:["(",u.cropCount," crops, ref: ",u.referenceUsed,")"]})]}),(B=u.cellComparisons)!=null&&B.length?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[9px] font-medium text-gray-500 px-1",children:[e.jsx("span",{children:"Cell"}),e.jsx("span",{children:"Before"}),e.jsx("span",{children:"After"}),e.jsx("span",{children:"Diff"})]}),u.cellComparisons.map(L=>e.jsxs("div",{className:"grid grid-cols-4 gap-1 items-center bg-gray-50 rounded p-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700",children:L.letter}),e.jsxs("div",{className:"text-[9px] text-gray-400",children:["P",L.pageNumber]})]}),e.jsx("img",{src:L.before,alt:`${L.letter} before`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>L.before&&X({src:L.before,title:`${s.entityName} - Cell ${L.letter} Page ${L.pageNumber} Before (${u.clothingCategory})`})}),e.jsx("img",{src:L.after,alt:`${L.letter} after`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>L.after&&X({src:L.after,title:`${s.entityName} - Cell ${L.letter} Page ${L.pageNumber} After (${u.clothingCategory})`})}),e.jsx("div",{className:"bg-gray-900 rounded",children:e.jsx("img",{src:L.diff,alt:`${L.letter} diff`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>L.diff&&X({src:L.diff,title:`${s.entityName} - Cell ${L.letter} Page ${L.pageNumber} Diff (${u.clothingCategory})`})})})]},`${u.clothingCategory}-${L.letter}`))]}):e.jsxs("div",{className:`grid gap-2 ${u.gridDiff?"grid-cols-3":"grid-cols-2"}`,children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] font-medium text-gray-500",children:"Before"}),e.jsx("div",{className:"bg-gray-50 rounded p-0.5",children:e.jsx("img",{src:u.gridBefore,alt:"Before repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>u.gridBefore&&X({src:u.gridBefore,title:`${s.entityName} - ${u.clothingCategory} Grid Before`})})})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] font-medium text-gray-500",children:"After"}),e.jsx("div",{className:"bg-gray-50 rounded p-0.5",children:e.jsx("img",{src:u.gridAfter,alt:"After repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>u.gridAfter&&X({src:u.gridAfter,title:`${s.entityName} - ${u.clothingCategory} Grid After`})})})]}),u.gridDiff&&e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] font-medium text-gray-500",children:"Diff"}),e.jsx("div",{className:"bg-gray-900 rounded p-0.5",children:e.jsx("img",{src:u.gridDiff,alt:"Difference",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>X({src:u.gridDiff,title:`${s.entityName} - ${u.clothingCategory} Grid Diff`})})})]})]})]},u.clothingCategory)})}):(pe=(P=(vs=v.entityRepairs)==null?void 0:vs[s.entityName])==null?void 0:P.cellComparisons)!=null&&pe.length?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[10px] font-medium text-gray-500 px-1",children:[e.jsx("span",{children:"Cell"}),e.jsx("span",{children:"Before"}),e.jsx("span",{children:"After"}),e.jsx("span",{children:"Diff"})]}),(sr=(er=(Gt=v.entityRepairs)==null?void 0:Gt[s.entityName])==null?void 0:er.cellComparisons)==null?void 0:sr.map(u=>e.jsxs("div",{className:"grid grid-cols-4 gap-1 items-center bg-gray-50 rounded p-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700",children:u.letter}),e.jsxs("div",{className:"text-[9px] text-gray-400",children:["P",u.pageNumber]})]}),e.jsx("img",{src:u.before,alt:`${u.letter} before`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>u.before&&X({src:u.before,title:`${s.entityName} - Cell ${u.letter} Page ${u.pageNumber} Before`})}),e.jsx("img",{src:u.after,alt:`${u.letter} after`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>u.after&&X({src:u.after,title:`${s.entityName} - Cell ${u.letter} Page ${u.pageNumber} After`})}),e.jsx("div",{className:"bg-gray-900 rounded",children:e.jsx("img",{src:u.diff,alt:`${u.letter} diff`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>u.diff&&X({src:u.diff,title:`${s.entityName} - Cell ${u.letter} Page ${u.pageNumber} Diff`})})})]},u.letter))]}):(rr=(tr=v.entityRepairs)==null?void 0:tr[s.entityName])!=null&&rr.pages&&Object.keys(((ar=v.entityRepairs[s.entityName])==null?void 0:ar.pages)||{}).length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[10px] font-medium text-gray-500 px-1",children:[e.jsx("span",{children:"Page"}),e.jsx("span",{children:"Before"}),e.jsx("span",{children:"After"}),e.jsx("span",{children:"Diff"})]}),Object.entries(((ir=v.entityRepairs[s.entityName])==null?void 0:ir.pages)||{}).map(([u,B])=>{var L,ve,Ae;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-1 items-center bg-gray-50 rounded p-1",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-700",children:["P",u]}),B.clothingCategory&&B.clothingCategory!=="standard"&&e.jsx("div",{className:"text-[8px] text-gray-400",children:B.clothingCategory})]}),e.jsx("img",{src:(L=B.comparison)==null?void 0:L.before,alt:`P${u} before`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var ee;return((ee=B.comparison)==null?void 0:ee.before)&&X({src:B.comparison.before,title:`${s.entityName} - Page ${u} Before${B.clothingCategory?` (${B.clothingCategory})`:""}`})}}),e.jsx("img",{src:(ve=B.comparison)==null?void 0:ve.after,alt:`P${u} after`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var ee;return((ee=B.comparison)==null?void 0:ee.after)&&X({src:B.comparison.after,title:`${s.entityName} - Page ${u} After${B.clothingCategory?` (${B.clothingCategory})`:""}`})}}),e.jsx("div",{className:"bg-gray-900 rounded",children:e.jsx("img",{src:(Ae=B.comparison)==null?void 0:Ae.diff,alt:`P${u} diff`,className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var ee;return((ee=B.comparison)==null?void 0:ee.diff)&&X({src:B.comparison.diff,title:`${s.entityName} - Page ${u} Diff${B.clothingCategory?` (${B.clothingCategory})`:""}`})}})})]}),B.promptUsed&&e.jsxs("details",{className:"text-[10px]",children:[e.jsx("summary",{className:"cursor-pointer text-blue-600 hover:text-blue-800",children:"Show Prompt"}),e.jsx("pre",{className:"mt-1 p-2 bg-gray-100 rounded text-gray-700 whitespace-pre-wrap overflow-x-auto max-h-48 text-[9px]",children:B.promptUsed})]})]},u)})]}):(lr=(nr=v.entityRepairs)==null?void 0:nr[s.entityName])!=null&&lr.gridBeforeRepair?e.jsxs("div",{className:`grid gap-3 ${(dr=(or=v.entityRepairs)==null?void 0:or[s.entityName])!=null&&dr.gridDiff?"grid-cols-3":"grid-cols-2"}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"Before Repair"}),e.jsx("div",{className:"bg-gray-50 rounded p-1",children:e.jsx("img",{src:(xr=(cr=v.entityRepairs)==null?void 0:cr[s.entityName])==null?void 0:xr.gridBeforeRepair,alt:"Before repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var B,L;const u=(L=(B=v.entityRepairs)==null?void 0:B[s.entityName])==null?void 0:L.gridBeforeRepair;u&&X({src:u,title:`${s.entityName} - Grid Before Repair`})}})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"After Repair"}),e.jsx("div",{className:"bg-gray-50 rounded p-1",children:e.jsx("img",{src:(pr=(mr=v.entityRepairs)==null?void 0:mr[s.entityName])==null?void 0:pr.gridAfterRepair,alt:"After repair",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var B,L;const u=(L=(B=v.entityRepairs)==null?void 0:B[s.entityName])==null?void 0:L.gridAfterRepair;u&&X({src:u,title:`${s.entityName} - Grid After Repair`})}})})]}),((hr=(gr=v.entityRepairs)==null?void 0:gr[s.entityName])==null?void 0:hr.gridDiff)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"Difference"}),e.jsx("div",{className:"bg-gray-900 rounded p-1",children:e.jsx("img",{src:((br=(ur=v.entityRepairs)==null?void 0:ur[s.entityName])==null?void 0:br.gridDiff)??void 0,alt:"Difference",className:"w-full h-auto rounded cursor-pointer hover:opacity-80",onClick:()=>{var B,L;const u=(L=(B=v.entityRepairs)==null?void 0:B[s.entityName])==null?void 0:L.gridDiff;u&&X({src:u,title:`${s.entityName} - Grid Diff`})}})})]})]}):null]})]})]},i)})})]})]}),v&&e.jsxs("details",{className:`border-2 rounded-xl p-4 ${v.overallConsistent?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("summary",{className:`cursor-pointer text-lg font-bold flex items-center gap-2 ${v.overallConsistent?"text-green-800 hover:text-green-900":"text-amber-800 hover:text-amber-900"}`,children:[v.overallConsistent?"‚úì":"‚ö†Ô∏è",t==="de"?`Konsistenzpr√ºfung (${(v.totalIssues||0)-(((Qt=v.entity)==null?void 0:Qt.totalIssues)||0)} Probleme)`:t==="fr"?`V√©rification de coh√©rence (${(v.totalIssues||0)-(((Zt=v.entity)==null?void 0:Zt.totalIssues)||0)} probl√®mes)`:`Final Checks (${(v.totalIssues||0)-(((Yt=v.entity)==null?void 0:Yt.totalIssues)||0)} issues)`]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700",children:v.summary}),v.imageChecks&&v.imageChecks.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:t==="de"?"Bildkonsistenz":t==="fr"?"Coh√©rence des images":"Image Consistency"}),v.imageChecks.map((s,i)=>{var a,l;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${s.consistent?"text-green-600":"text-amber-600"}`,children:s.consistent?"‚úì":"‚ö†Ô∏è"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:s.type==="full"?"Full Check":s.type==="character"?`Character: ${s.characterName}`:s.type==="sequence"?"Sequence Check":s.type}),s.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",s.overallScore,"/10"]})]}),s.issues&&s.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:s.issues.map((r,y)=>{var h,R;return e.jsxs("div",{className:`text-xs p-2 rounded ${r.severity==="high"?"bg-red-50 border-l-4 border-red-400":r.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${r.severity==="high"?"bg-red-200 text-red-800":r.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:r.severity}),e.jsxs("span",{className:"text-gray-500",children:["Pages ",(h=r.images)==null?void 0:h.join(", ")]}),r.pagesToFix&&r.pagesToFix.length>0&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-orange-100 text-orange-700 rounded text-[10px]",children:["Fix: ",r.pagesToFix.join(", ")]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:(R=r.type)==null?void 0:R.replace(/_/g," ")}),r.characterInvolved&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded text-[10px]",children:r.characterInvolved})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:r.description}),r.details&&Object.keys(r.details).length>0&&e.jsx("div",{className:"mt-1 pl-2 border-l-2 border-gray-200",children:Object.entries(r.details).map(([I,J])=>e.jsxs("p",{className:"text-gray-500 text-[10px]",children:[e.jsxs("span",{className:"font-medium",children:[I,":"]})," ",J]},I))}),r.canonicalVersion&&e.jsxs("p",{className:"text-blue-700 mt-1",children:["üéØ Target: ",r.canonicalVersion]}),r.recommendation&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:["üí° ",r.recommendation]}),j&&r.pagesToFix&&r.pagesToFix.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:r.pagesToFix.map(I=>e.jsx("button",{onClick:()=>Hr(I,r),disabled:c||ls!==null,className:`flex items-center gap-1 px-2 py-1 text-[10px] font-medium rounded transition-colors ${ls===I?"bg-amber-300 text-amber-800":c||ls!==null?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"}`,children:ls===I?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-3 h-3 animate-spin"}),e.jsxs("span",{children:["Repairing P",I,"..."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"w-3 h-3"}),e.jsxs("span",{children:["Repair P",I]})]})},I))})]},y)})}),s.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:s.summary}),(s.evaluationPrompts||s.evaluationPrompt)&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:["üîç View Evaluation Prompt",(((a=s.evaluationPrompts)==null?void 0:a.length)??0)>1?`s (${(l=s.evaluationPrompts)==null?void 0:l.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:(s.evaluationPrompts??(s.evaluationPrompt?[s.evaluationPrompt]:[])).map((r,y)=>{var h;return e.jsxs("div",{children:[(((h=s.evaluationPrompts)==null?void 0:h.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-blue-700 mb-1",children:["Batch ",y+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto bg-white p-2 rounded border",children:r})]},y)})})]}),e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"üîß View Parsed Result (Full JSON)"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-96 overflow-y-auto bg-white p-2 rounded border",children:JSON.stringify({type:s.type,characterName:s.characterName,consistent:s.consistent,overallScore:s.overallScore,issues:s.issues,summary:s.summary},null,2)})]}),s.rawResponses&&s.rawResponses.length>0&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:["üìù View Raw Response",s.rawResponses.length>1?`s (${s.rawResponses.length} batches)`:""]}),e.jsx("div",{className:"mt-2 space-y-3",children:s.rawResponses.map((r,y)=>{var h;return e.jsxs("div",{children:[(((h=s.rawResponses)==null?void 0:h.length)??0)>1&&e.jsxs("div",{className:"text-xs font-semibold text-purple-700 mb-1",children:["Batch ",y+1,":"]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto bg-white p-2 rounded border",children:r})]},y)})})]})]},i)})]}),v.textCheck&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:t==="de"?"Textqualit√§t":t==="fr"?"Qualit√© du texte":"Text Quality"}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${v.textCheck.quality==="good"?"text-green-600":v.textCheck.quality==="needs_review"?"text-amber-600":"text-red-600"}`,children:v.textCheck.quality==="good"?"‚úì":"‚ö†Ô∏è"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:v.textCheck.quality==="good"?"Good":v.textCheck.quality==="needs_review"?"Needs Review":"Has Issues"}),v.textCheck.overallScore!==void 0&&e.jsxs("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded",children:["Score: ",v.textCheck.overallScore,"/10"]})]}),v.textCheck.issues&&v.textCheck.issues.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:v.textCheck.issues.map((s,i)=>e.jsxs("div",{className:`text-xs p-2 rounded ${s.severity==="high"?"bg-red-50 border-l-4 border-red-400":s.severity==="medium"?"bg-amber-50 border-l-4 border-amber-400":"bg-gray-50 border-l-4 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${s.severity==="high"?"bg-red-200 text-red-800":s.severity==="medium"?"bg-amber-200 text-amber-800":"bg-gray-200 text-gray-700"}`,children:s.severity}),s.page&&e.jsxs("span",{className:"text-gray-500",children:["Page ",s.page]}),e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px]",children:s.type})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:s.issue}),(s.originalText||s.text)&&e.jsxs("p",{className:"text-red-600 mt-1 line-through",children:['"',s.originalText||s.text,'"']}),s.correctedText&&e.jsxs("p",{className:"text-green-700 mt-1 font-medium",children:['‚úì "',s.correctedText,'"']}),!s.correctedText&&s.suggestion&&e.jsxs("p",{className:"text-green-700 mt-1",children:["‚Üí ",s.suggestion]})]},i))}),v.textCheck.summary&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:v.textCheck.summary}),v.textCheck.fullOriginalText&&e.jsxs("details",{className:"mt-3 bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-gray-700",children:"üìÑ View Original Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-600 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:v.textCheck.fullOriginalText})]}),v.textCheck.fullCorrectedText&&e.jsxs("details",{className:"mt-3 bg-green-50 border border-green-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-green-800",children:"üìã View Full Corrected Text"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:v.textCheck.fullCorrectedText})]}),v.textCheck.rawResponse&&e.jsxs("details",{className:"mt-3 bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-purple-800",children:"üìù View Raw Response"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:v.textCheck.rawResponse})]}),v.textCheck&&e.jsxs("details",{className:"mt-3 bg-indigo-50 border border-indigo-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-indigo-800",children:"üîß View Parsed Result"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:JSON.stringify({quality:v.textCheck.quality,overallScore:v.textCheck.overallScore,issues:v.textCheck.issues,summary:v.textCheck.summary,parseError:v.textCheck.parseError},null,2)})]}),v.textCheck.evaluationPrompt&&e.jsxs("details",{className:"mt-3 bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:"üîç View Evaluation Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-sans max-h-[500px] overflow-y-auto",children:v.textCheck.evaluationPrompt})]})]})]}),v.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-2 text-xs text-red-700",children:["Error: ",v.error]})]})]}),N.length>0&&e.jsxs("details",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-green-800 hover:text-green-900 flex items-center gap-2",children:[e.jsx(ss,{size:20}),t==="de"?`Alle Szenenbeschreibungen (${N.length})`:t==="fr"?`Toutes les descriptions de sc√®nes (${N.length})`:`All Scene Descriptions (${N.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:N.map(s=>e.jsxs("details",{className:"bg-white border border-green-200 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-700 hover:text-green-800",children:_==="de"?`Seite ${s.pageNumber}`:_==="fr"?`Page ${s.pageNumber}`:`Page ${s.pageNumber}`}),e.jsxs("div",{className:"mt-2 space-y-2",children:[s.outlineExtract&&e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-amber-700",children:"Outline Extract:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:s.outlineExtract})]}),s.scenePrompt&&e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-purple-700",children:"Scene Prompt:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:s.scenePrompt})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Scene Description:"}),s.textModelId&&e.jsxs("span",{className:"ml-2 text-green-600",children:["(",s.textModelId,")"]}),e.jsx("pre",{className:"text-gray-700 mt-1 whitespace-pre-wrap font-mono text-xs overflow-x-auto",children:(()=>{var r;const i=y=>{if(typeof y!="string")return y;try{const h=JSON.parse(y);return typeof h=="string"&&(h.startsWith("{")||h.startsWith("["))?i(h):h}catch{return y}},a=typeof s.description=="object"&&((r=s.description)!=null&&r.text)?s.description.text:s.description,l=i(a);return typeof l=="object"&&l!==null?JSON.stringify(l,null,2):String(l)})()})]})]})]},s.pageNumber))})]})]}),b&&(Xe(b.frontCover)||b.frontCover&&typeof b.frontCover=="object"&&b.frontCover.hasImage)&&(()=>{var l,r;const s=ct(b.frontCover),i=Xe(b.frontCover),a=!i&&(s==null?void 0:s.hasImage);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:_==="de"?"Titelseite":_==="fr"?"Couverture":"Front Cover"}),e.jsxs("div",{className:"relative",children:[a?e.jsxs("div",{className:"aspect-[3/4] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-lg flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-600 font-medium",children:_==="de"?"Cover wird geladen...":_==="fr"?"Chargement de la couverture...":"Loading cover..."})]}):e.jsx(Zs,{src:i,alt:"Front Cover",className:"w-full rounded-lg shadow-lg",label:"Front Cover"}),D.has("frontCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(de,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),q&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>dt("front"),disabled:c||!se||D.has("frontCover"),className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||!se||D.has("frontCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:se?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(we,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",$e," ",t==="de"?"Credits":"credits",")"]})]}),Ne("frontCover").length>1&&e.jsxs("button",{onClick:()=>is({coverType:"frontCover",versions:Ne("frontCover")}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(fe,{size:14}),Ne("frontCover").length]})]}),Z&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[V&&e.jsxs("button",{onClick:()=>V("front"),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:(()=>{const y=J=>{if(typeof J!="string")return J;try{const Y=JSON.parse(J);return typeof Y=="string"&&(Y.startsWith("{")||Y.startsWith("["))?y(Y):Y}catch{return J}},h=s.description,R=typeof h=="object"&&(h!=null&&h.text)?h.text:h,I=y(R);return typeof I=="object"&&I!==null?JSON.stringify(I,null,2):String(I)})()})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:s.prompt})]}),((((l=s.referencePhotos)==null?void 0:l.length)??0)>0||(((r=s.landmarkPhotos)==null?void 0:r.length)??0)>0||s.visualBibleGrid)&&e.jsx(Cs,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,visualBibleGrid:s.visualBibleGrid,language:t}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),e.jsx(Ss,{retryHistory:s.retryHistory,bboxDetection:s.bboxDetection,bboxOverlayImage:s.bboxOverlayImage,language:t,storyId:j,coverType:"front"}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(ts,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:t}),s.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[t==="de"?"Vorherige Version":t==="fr"?"Version pr√©c√©dente":"Previous Version",s.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(s.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),s.originalImage&&s.originalImage!==s.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[t==="de"?"Originalbild":t==="fr"?"Image originale":"Original Image",s.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(s.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),b&&Xe(b.initialPage)&&(()=>{var i,a;const s=ct(b.initialPage);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:_==="de"?"Widmungsseite":_==="fr"?"Page de d√©dicace":"Dedication Page"}),e.jsxs("div",{className:"relative",children:[e.jsx(Zs,{src:Xe(b.initialPage),alt:"Dedication Page",className:"w-full rounded-lg shadow-lg",label:"Dedication Page"}),D.has("initialPage")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(de,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),q&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>dt("initial"),disabled:c||!se||D.has("initialPage"),className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||!se||D.has("initialPage")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:se?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(we,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",$e," ",t==="de"?"Credits":"credits",")"]})]}),Ne("initialPage").length>1&&e.jsxs("button",{onClick:()=>is({coverType:"initialPage",versions:Ne("initialPage")}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(fe,{size:14}),Ne("initialPage").length]})]}),Z&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[V&&e.jsxs("button",{onClick:()=>V("initial"),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:(()=>{const l=R=>{if(typeof R!="string")return R;try{const I=JSON.parse(R);return typeof I=="string"&&(I.startsWith("{")||I.startsWith("["))?l(I):I}catch{return R}},r=s.description,y=typeof r=="object"&&(r!=null&&r.text)?r.text:r,h=l(y);return typeof h=="object"&&h!==null?JSON.stringify(h,null,2):String(h)})()})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:s.prompt})]}),((((i=s.referencePhotos)==null?void 0:i.length)??0)>0||(((a=s.landmarkPhotos)==null?void 0:a.length)??0)>0||s.visualBibleGrid)&&e.jsx(Cs,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,visualBibleGrid:s.visualBibleGrid,language:t}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),e.jsx(Ss,{retryHistory:s.retryHistory,bboxDetection:s.bboxDetection,bboxOverlayImage:s.bboxOverlayImage,language:t,storyId:j,coverType:"initial"}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(ts,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:t}),s.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[t==="de"?"Vorherige Version":t==="fr"?"Version pr√©c√©dente":"Previous Version",s.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(s.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),s.originalImage&&s.originalImage!==s.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[t==="de"?"Originalbild":t==="fr"?"Image originale":"Original Image",s.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(s.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),Ve&&!x&&(b==null?void 0:b.frontCover)&&e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-8 mt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-indigo-700",children:_==="de"?"Geschichte wird erstellt...":_==="fr"?"Cr√©ation de l'histoire...":"Creating your story..."}),e.jsx("p",{className:"text-indigo-500 mt-2",children:_==="de"?"Die Seiten werden gleich angezeigt":_==="fr"?"Les pages seront bient√¥t affich√©es":"Pages will appear shortly"})]})}),Ye&&x&&e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 text-center mb-6",children:o||(_==="de"?"Ihre Geschichte":_==="fr"?"Votre histoire":"Your Story")}),Ze.slice(0,Ve?Mt:Ze.length).map((s,i)=>{var J,Y,re,le,oe,ue,be,Ie,ms,ps,gs,hs,us,bs,fs,js,ys,Ns,vs;const a=i+1,l=a,r=C.find(P=>P.pageNumber===l),y=Ve?bt[l]:void 0,h=!!(r!=null&&r.imageData||y),R=Ve&&a===Mt&&!h,I=!Ve&&(r==null?void 0:r.hasImage)&&!(r!=null&&r.imageData);return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-4 text-center",children:_==="de"?`Seite ${a}`:_==="fr"?`Page ${a}`:`Page ${a}`}),qs?e.jsxs("div",{className:"flex flex-col items-center max-w-2xl mx-auto",children:[R||I?e.jsxs("div",{className:"w-full mb-4 aspect-[4/3] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-md flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-600 font-medium",children:I?_==="de"?"Bild wird geladen...":_==="fr"?"Chargement de l'image...":"Loading image...":_==="de"?"Bild wird erstellt...":_==="fr"?"Cr√©ation de l'image...":"Creating image..."}),R&&e.jsx("p",{className:"text-indigo-400 text-sm mt-1",children:_==="de"?"Die n√§chste Seite erscheint bald":_==="fr"?"La page suivante arrive bient√¥t":"Next page coming soon"})]}):r!=null&&r.imageData||y?e.jsxs("div",{className:"w-full mb-4 relative",children:[e.jsx(Zs,{src:((r==null?void 0:r.imageData)||y)??"",alt:`Scene for page ${a}`,className:`w-full rounded-lg shadow-md object-cover ${ye.has(a)?"opacity-50":""}`,label:`Page ${a}`}),ye.has(a)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(Le,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:t==="de"?"Neues Bild wird erstellt...":t==="fr"?"Nouvelle image en cours...":"Generating new image..."})]}),T&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>Bt(a),disabled:c||ye.has(a)||!se,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||ye.has(a)||!se?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:se?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(we,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",$e," ",t==="de"?"Credits":"credits",")"]})]}),Is&&e.jsxs("button",{onClick:()=>As(!0),disabled:c,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14}),t==="de"?"Text bearbeiten":t==="fr"?"Modifier le texte":"Edit Text"]}),Qe(a).length>1&&e.jsxs("button",{onClick:()=>Ls({pageNumber:a,versions:Qe(a)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(fe,{size:14}),Qe(a).length]})]})}),Z&&e.jsxs("div",{className:"mt-3 space-y-2",children:[F&&e.jsxs("button",{onClick:()=>F(a),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),W&&e.jsx("button",{onClick:()=>Lt(a),disabled:c||he!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||he!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:t==="de"?"Physik-Fehler automatisch erkennen und reparieren":t==="fr"?"D√©tecter et r√©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:he===a?e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:14,className:"animate-spin"}),t==="de"?"Repariere...":t==="fr"?"R√©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(es,{size:14}),t==="de"?"Auto-Reparatur":t==="fr"?"Auto-R√©paration":"Auto-Repair"]})}),z&&e.jsx("button",{onClick:()=>Et(a),disabled:c||Fe!==null||he!==null,className:`w-full bg-purple-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||Fe!==null||he!==null?"opacity-50 cursor-not-allowed":"hover:bg-purple-600"}`,title:t==="de"?"Bild analysieren, 17 Checks durchf√ºhren, mit korrigierter Szene neu generieren":t==="fr"?"Analyser l'image, ex√©cuter 17 v√©rifications, r√©g√©n√©rer avec sc√®ne corrig√©e":"Analyze image, run 17 checks, regenerate with corrected scene",children:Fe===a?e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:14,className:"animate-spin"}),t==="de"?"Iteriere...":t==="fr"?"It√©ration...":"Iterating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(mt,{size:14}),t==="de"?"N√§chste Iteration":t==="fr"?"Prochaine It√©ration":"Next Iteration"]})}),(r==null?void 0:r.repairHistory)&&r.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(es,{size:14}),t==="de"?"Reparatur-Historie":t==="fr"?"Historique de r√©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",r.repairHistory.length," ",t==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:r.repairHistory.map((P,pe)=>e.jsxs("div",{className:`border rounded-lg p-3 ${P.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[t==="de"?`Reparatur ${P.attempt}`:`Repair ${P.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${P.success?"text-green-600":"text-red-600"}`,children:["(",P.success?"‚úì":"‚úó"," ",P.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:P.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:t==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:t==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",P.fixPrompt]}),P.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:t==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:P.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),P.beforeImage&&P.afterImage&&e.jsxs("div",{className:"flex gap-4 cursor-pointer p-2 -m-2 rounded-lg hover:bg-amber-100 transition-colors",onClick:()=>Es({beforeImage:P.beforeImage,afterImage:P.afterImage,diffImage:P.diffImage,title:t==="de"?`Reparatur ${P.attempt}`:`Repair ${P.attempt}`}),title:t==="de"?"Klicken f√ºr Vergleichsansicht":"Click to compare",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:P.beforeImage,alt:"Before repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Nachher:":"After:"}),e.jsx("img",{src:P.afterImage,alt:"After repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),P.diffImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:"Diff:"}),e.jsx("img",{src:P.diffImage,alt:"Difference",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(P.timestamp).toLocaleTimeString()})]},pe))})]}),Us(a)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:t==="de"?"Auszug aus Gliederung":t==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Us(a)})]}),Ks(a)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:t==="de"?"Szenen-Prompt":t==="fr"?"Prompt de sc√®ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:Ks(a)})]}),Ws(a)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description",Js(a)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",Js(a),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Ws(a)})]}),(r==null?void 0:r.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",(r==null?void 0:r.modelId)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:r==null?void 0:r.prompt})]}),((((J=r==null?void 0:r.referencePhotos)==null?void 0:J.length)??0)>0||(((Y=r==null?void 0:r.landmarkPhotos)==null?void 0:Y.length)??0)>0||(r==null?void 0:r.visualBibleGrid))&&r&&e.jsx(Cs,{referencePhotos:r.referencePhotos||[],landmarkPhotos:r.landmarkPhotos,visualBibleGrid:r.visualBibleGrid,language:t,storyId:j||void 0,pageNumber:a}),(r==null?void 0:r.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",(r==null?void 0:r.qualityModelId)&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${((r==null?void 0:r.qualityScore)??0)>=70?"text-green-600":((r==null?void 0:r.qualityScore)??0)>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round((r==null?void 0:r.qualityScore)??0),"%"]})]}),(r==null?void 0:r.qualityReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),(r==null?void 0:r.semanticResult)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 hover:text-purple-900 flex items-center justify-between",children:[e.jsx("span",{className:"flex items-center gap-2",children:t==="de"?"Semantische Treue":t==="fr"?"Fid√©lit√© s√©mantique":"Semantic Fidelity"}),e.jsx("span",{className:`text-lg font-bold ${(r.semanticScore??0)>=70?"text-green-600":(r.semanticScore??0)>=50?"text-yellow-600":"text-red-600"}`,children:r.semanticScore!==null&&r.semanticScore!==void 0?`${Math.round(r.semanticScore)}%`:"N/A"})]}),e.jsxs("div",{className:"mt-2 text-xs",children:[r.semanticResult.visible&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border border-purple-200",children:[e.jsx("div",{className:"font-medium text-purple-800 mb-1",children:"üëÅÔ∏è Visible:"}),(((re=r.semanticResult.visible.characters)==null?void 0:re.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Characters:"})," ",(le=r.semanticResult.visible.characters)==null?void 0:le.join(", ")]}),(((oe=r.semanticResult.visible.objects)==null?void 0:oe.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Objects:"})," ",(ue=r.semanticResult.visible.objects)==null?void 0:ue.join(", ")]}),r.semanticResult.visible.setting&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Setting:"})," ",r.semanticResult.visible.setting]}),r.semanticResult.visible.action&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Action:"})," ",r.semanticResult.visible.action]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-purple-200",children:[e.jsx("div",{className:"font-medium text-purple-800 mb-1",children:"üéØ Expected:"}),(((Ie=(be=r.semanticResult.expected)==null?void 0:be.characters)==null?void 0:Ie.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Characters:"})," ",(ps=(ms=r.semanticResult.expected)==null?void 0:ms.characters)==null?void 0:ps.join(", ")]}),(((hs=(gs=r.semanticResult.expected)==null?void 0:gs.objects)==null?void 0:hs.length)??0)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Objects:"})," ",(bs=(us=r.semanticResult.expected)==null?void 0:us.objects)==null?void 0:bs.join(", ")]}),((fs=r.semanticResult.expected)==null?void 0:fs.setting)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Setting:"})," ",r.semanticResult.expected.setting]}),((js=r.semanticResult.expected)==null?void 0:js.action)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Action:"})," ",r.semanticResult.expected.action]})]})]}),((ys=r.semanticResult.semanticIssues)==null?void 0:ys.length)>0&&e.jsx("ul",{className:"list-disc list-inside text-purple-700 bg-white p-2 rounded border border-purple-200",children:r.semanticResult.semanticIssues.map((P,pe)=>e.jsxs("li",{children:[e.jsxs("span",{className:`font-medium ${P.severity==="CRITICAL"?"text-red-600":P.severity==="MAJOR"?"text-orange-600":"text-yellow-600"}`,children:["[",P.severity,"]"]})," ",P.problem]},pe))}),(!r.semanticResult.semanticIssues||r.semanticResult.semanticIssues.length===0)&&!r.semanticResult.visible&&e.jsx("span",{className:"text-green-600",children:"‚úì No semantic issues"})]})]}),e.jsx(Ss,{retryHistory:r==null?void 0:r.retryHistory,language:t,storyId:j,pageNumber:r==null?void 0:r.pageNumber}),(r==null?void 0:r.retryHistory)&&r.retryHistory.length>0&&e.jsx(ts,{retryHistory:r.retryHistory,totalAttempts:(r==null?void 0:r.totalAttempts)||r.retryHistory.length,language:t,onRevertRepair:G?(P,pe)=>G(r.pageNumber,pe):void 0,storyId:j,pageNumber:r.pageNumber}),(r==null?void 0:r.wasRegenerated)&&(!(r!=null&&r.retryHistory)||r.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["üîÑ ",t==="de"?"Bild regeneriert":t==="fr"?"Image r√©g√©n√©r√©e":"Image Regenerated"]}),(r==null?void 0:r.originalScore)!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(r.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:t==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige Qualit√§t hatte.":t==="fr"?"L'image a √©t√© automatiquement r√©g√©n√©r√©e car la premi√®re version avait une qualit√© faible.":"Image was automatically regenerated because the first version had low quality."}),(r==null?void 0:r.originalImage)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:t==="de"?"Originalbild:":t==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:r.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),(r==null?void 0:r.originalReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Original Feedback:":t==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`w-full flex flex-col items-center justify-center rounded-lg p-8 mb-4 ${c?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:_==="de"?"Bild wird noch erstellt...":_==="fr"?"Image en cours de cr√©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:_==="de"?"Kein Bild f√ºr diese Seite":_==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"w-full bg-indigo-50 rounded-lg p-6 border-2 border-indigo-200",children:qe?e.jsx("textarea",{value:s.trim(),onChange:P=>Tt(i,P.target.value),className:"w-full min-h-[400px] p-3 text-gray-800 leading-snug font-serif text-xl text-center bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:t==="de"?"Text eingeben...":t==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl text-center",children:s.trim()})})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 items-stretch",children:[I?e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"aspect-[4/3] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-md flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-sm",children:_==="de"?"Bild wird geladen...":_==="fr"?"Chargement de l'image...":"Loading image..."})]})}):r&&r.imageData?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.imageData,alt:`Scene for page ${a}`,className:`w-full rounded-lg shadow-md object-cover ${ye.has(a)?"opacity-50":""}`}),ye.has(a)&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 rounded-lg",children:[e.jsx(Le,{size:40,className:"animate-spin text-indigo-600 mb-2"}),e.jsx("p",{className:"text-indigo-700 font-medium text-sm",children:t==="de"?"Neues Bild wird erstellt...":t==="fr"?"Nouvelle image en cours...":"Generating new image..."})]})]}),T&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>Bt(a),disabled:c||ye.has(a)||!se,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||ye.has(a)||!se?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:se?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(we,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",$e," ",t==="de"?"Credits":"credits",")"]})]}),Is&&e.jsxs("button",{onClick:()=>As(!0),disabled:c,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14}),t==="de"?"Text bearbeiten":t==="fr"?"Modifier le texte":"Edit Text"]}),Qe(a).length>1&&e.jsxs("button",{onClick:()=>Ls({pageNumber:a,versions:Qe(a)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(fe,{size:14}),Qe(a).length]})]})}),Z&&e.jsxs("div",{className:"mt-3 space-y-2",children:[F&&e.jsxs("button",{onClick:()=>F(a),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),W&&e.jsx("button",{onClick:()=>Lt(a),disabled:c||he!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||he!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:t==="de"?"Physik-Fehler automatisch erkennen und reparieren":t==="fr"?"D√©tecter et r√©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:he===a?e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:14,className:"animate-spin"}),t==="de"?"Repariere...":t==="fr"?"R√©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(es,{size:14}),t==="de"?"Auto-Reparatur":t==="fr"?"Auto-R√©paration":"Auto-Repair"]})}),z&&e.jsx("button",{onClick:()=>Et(a),disabled:c||Fe!==null||he!==null,className:`w-full bg-purple-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||Fe!==null||he!==null?"opacity-50 cursor-not-allowed":"hover:bg-purple-600"}`,title:t==="de"?"Bild analysieren, 17 Checks durchf√ºhren, mit korrigierter Szene neu generieren":t==="fr"?"Analyser l'image, ex√©cuter 17 v√©rifications, r√©g√©n√©rer avec sc√®ne corrig√©e":"Analyze image, run 17 checks, regenerate with corrected scene",children:Fe===a?e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:14,className:"animate-spin"}),t==="de"?"Iteriere...":t==="fr"?"It√©ration...":"Iterating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(mt,{size:14}),t==="de"?"N√§chste Iteration":t==="fr"?"Prochaine It√©ration":"Next Iteration"]})}),(r==null?void 0:r.repairHistory)&&r.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(es,{size:14}),t==="de"?"Reparatur-Historie":t==="fr"?"Historique de r√©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",r.repairHistory.length," ",t==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:r.repairHistory.map((P,pe)=>e.jsxs("div",{className:`border rounded-lg p-3 ${P.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[t==="de"?`Reparatur ${P.attempt}`:`Repair ${P.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${P.success?"text-green-600":"text-red-600"}`,children:["(",P.success?"‚úì":"‚úó"," ",P.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:P.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:t==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:t==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",P.fixPrompt]}),P.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:t==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:P.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),P.beforeImage&&P.afterImage&&e.jsxs("div",{className:"flex gap-4 cursor-pointer p-2 -m-2 rounded-lg hover:bg-amber-100 transition-colors",onClick:()=>Es({beforeImage:P.beforeImage,afterImage:P.afterImage,diffImage:P.diffImage,title:t==="de"?`Reparatur ${P.attempt}`:`Repair ${P.attempt}`}),title:t==="de"?"Klicken f√ºr Vergleichsansicht":"Click to compare",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:P.beforeImage,alt:"Before repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:t==="de"?"Nachher:":"After:"}),e.jsx("img",{src:P.afterImage,alt:"After repair",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]}),P.diffImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:"Diff:"}),e.jsx("img",{src:P.diffImage,alt:"Difference",className:"w-32 h-32 object-contain border rounded bg-gray-100"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(P.timestamp).toLocaleTimeString()})]},pe))})]}),Us(a)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:t==="de"?"Auszug aus Gliederung":t==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Us(a)})]}),Ks(a)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:t==="de"?"Szenen-Prompt":t==="fr"?"Prompt de sc√®ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:Ks(a)})]}),Ws(a)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description",Js(a)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",Js(a),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:Ws(a)})]}),r.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",r.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:r.prompt})]}),((((Ns=r.referencePhotos)==null?void 0:Ns.length)??0)>0||(((vs=r.landmarkPhotos)==null?void 0:vs.length)??0)>0||r.visualBibleGrid)&&e.jsx(Cs,{referencePhotos:r.referencePhotos||[],landmarkPhotos:r.landmarkPhotos,visualBibleGrid:r.visualBibleGrid,language:t,storyId:j||void 0,pageNumber:a}),r.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",r.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${r.qualityScore>=70?"text-green-600":r.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(r.qualityScore),"%"]})]}),r.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),e.jsx(Ss,{retryHistory:r.retryHistory,language:t,storyId:j,pageNumber:r.pageNumber}),r.retryHistory&&r.retryHistory.length>0&&e.jsx(ts,{retryHistory:r.retryHistory,totalAttempts:r.totalAttempts||r.retryHistory.length,language:t,onRevertRepair:G?(P,pe)=>G(r.pageNumber,pe):void 0,storyId:j,pageNumber:r.pageNumber}),r.wasRegenerated&&(!r.retryHistory||r.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["üîÑ ",t==="de"?"Bild regeneriert":t==="fr"?"Image r√©g√©n√©r√©e":"Image Regenerated"]}),r.originalScore!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(r.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:t==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige Qualit√§t hatte.":t==="fr"?"L'image a √©t√© automatiquement r√©g√©n√©r√©e car la premi√®re version avait une qualit√© faible.":"Image was automatically regenerated because the first version had low quality."}),r.originalImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:t==="de"?"Originalbild:":t==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:r.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),r.originalReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Original Feedback:":t==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`flex flex-col items-center justify-center rounded-lg p-8 ${c?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:_==="de"?"Bild wird noch erstellt...":_==="fr"?"Image en cours de cr√©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:_==="de"?"Kein Bild f√ºr diese Seite":_==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"flex flex-col w-full h-full",children:qe?e.jsx("textarea",{value:s.trim(),onChange:P=>Tt(i,P.target.value),className:"w-full flex-1 min-h-[300px] p-4 text-gray-800 leading-snug font-serif text-xl bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:t==="de"?"Text eingeben...":t==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl",children:s.trim()})})})]})]},a)})]}),b&&Xe(b.backCover)&&(()=>{var i,a;const s=ct(b.backCover);return e.jsxs("div",{className:"mt-8 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:_==="de"?"R√ºckseite":_==="fr"?"Quatri√®me de couverture":"Back Cover"}),e.jsxs("div",{className:"relative",children:[e.jsx(Zs,{src:Xe(b.backCover),alt:"Back Cover",className:"w-full rounded-lg shadow-lg",label:"Back Cover"}),D.has("backCover")&&e.jsx("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg",children:e.jsx(de,{className:"w-10 h-10 animate-spin text-indigo-600"})})]}),q&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>dt("back"),disabled:c||!se||D.has("backCover"),className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c||!se||D.has("backCover")?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:se?"":t==="de"?"Nicht genug Credits":t==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(we,{size:14}),t==="de"?"Bild neu generieren":t==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",$e," ",t==="de"?"Credits":"credits",")"]})]}),Ne("backCover").length>1&&e.jsxs("button",{onClick:()=>is({coverType:"backCover",versions:Ne("backCover")}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(fe,{size:14}),Ne("backCover").length]})]}),Z&&s&&e.jsxs("div",{className:"mt-3 space-y-2",children:[V&&e.jsxs("button",{onClick:()=>V("back"),disabled:c,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ie,{size:14})," ",t==="de"?"Bearbeiten":"Edit"]}),s.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:t==="de"?"Szenenbeschreibung":t==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:(()=>{const l=R=>{if(typeof R!="string")return R;try{const I=JSON.parse(R);return typeof I=="string"&&(I.startsWith("{")||I.startsWith("["))?l(I):I}catch{return R}},r=s.description,y=typeof r=="object"&&(r!=null&&r.text)?r.text:r,h=l(y);return typeof h=="object"&&h!==null?JSON.stringify(h,null,2):String(h)})()})]}),s.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[t==="de"?"API-Prompt":t==="fr"?"Prompt API":"API Prompt",s.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",s.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-[500px] overflow-y-auto",children:s.prompt})]}),((((i=s.referencePhotos)==null?void 0:i.length)??0)>0||(((a=s.landmarkPhotos)==null?void 0:a.length)??0)>0||s.visualBibleGrid)&&e.jsx(Cs,{referencePhotos:s.referencePhotos||[],landmarkPhotos:s.landmarkPhotos,visualBibleGrid:s.visualBibleGrid,language:t}),s.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[t==="de"?"Qualit√§tsbewertung":t==="fr"?"Score de qualit√©":"Quality Score",s.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",s.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${s.qualityScore>=70?"text-green-600":s.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(s.qualityScore),"%"]})]}),s.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:t==="de"?"Feedback:":t==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.qualityReasoning})]})]}),e.jsx(Ss,{retryHistory:s.retryHistory,bboxDetection:s.bboxDetection,bboxOverlayImage:s.bboxOverlayImage,language:t,storyId:j,coverType:"back"}),s.retryHistory&&s.retryHistory.length>0&&e.jsx(ts,{retryHistory:s.retryHistory,totalAttempts:s.totalAttempts||s.retryHistory.length,language:t}),s.previousImage&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-800 hover:text-orange-900",children:[t==="de"?"Vorherige Version":t==="fr"?"Version pr√©c√©dente":"Previous Version",s.previousScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-orange-600",children:["(",Math.round(s.previousScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.previousImage,alt:"Previous version",className:"w-full rounded border-2 border-orange-200 opacity-75"})})]}),s.originalImage&&s.originalImage!==s.previousImage&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:[t==="de"?"Originalbild":t==="fr"?"Image originale":"Original Image",s.originalScore!==void 0&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-600",children:["(",Math.round(s.originalScore),"%)"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.originalImage,alt:"Original version",className:"w-full rounded border-2 border-amber-200 opacity-75"})})]})]})]})})(),Ye&&x&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-4 mt-6",children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-3 text-center",children:t==="de"?"Was m√∂chten Sie als N√§chstes tun?":t==="fr"?"Que souhaitez-vous faire ensuite ?":"What would you like to do next?"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[j&&S&&e.jsxs("button",{onClick:S,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(yr,{size:16})," ",t==="de"?"Buch erstellen":t==="fr"?"Cr√©er le livre":"Create Book"]}),n&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>Bs(!Ke),disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 w-full ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(ss,{size:16}),t==="de"?"PDF herunterladen":t==="fr"?"T√©l√©charger PDF":"Download PDF",e.jsx(Te,{size:14,className:`transition-transform ${Ke?"rotate-180":""}`})]}),Ke&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:Ue==="square",onChange:()=>Ts("square"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Square (20√ó20cm)"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pdfFormat2",checked:Ue==="A4",onChange:()=>Ts("A4"),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A4 (21√ó28cm)"})]})]}),e.jsx("button",{onClick:()=>{n(Ue),Bs(!1)},className:"w-full py-2 bg-indigo-500 text-white text-sm font-semibold hover:bg-indigo-600",children:t==="de"?"Herunterladen":t==="fr"?"T√©l√©charger":"Download"})]})]}),j&&!c&&e.jsx($r,{storyId:j,variant:"full"}),Q&&e.jsxs("button",{onClick:Q,disabled:c,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${c?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Nr,{size:16})," ",t==="de"?"Neue Geschichte":t==="fr"?"Nouvelle histoire":"New Story"]})]})]}),qe&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 shadow-lg p-3 md:p-4 z-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(ie,{size:18,className:"flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-sm md:text-base",children:t==="de"?"Bearbeitungsmodus":t==="fr"?"Mode √©dition":"Edit Mode"}),Ps&&e.jsxs("span",{className:"text-xs text-gray-500 hidden sm:inline",children:["(",t==="de"?"Original gespeichert":t==="fr"?"Original sauvegard√©":"Original saved",")"]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-center md:justify-end",children:[e.jsxs("button",{onClick:Mr,disabled:as,className:"px-3 md:px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(Se,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:t==="de"?"Abbrechen":t==="fr"?"Annuler":"Cancel"})]}),Ps&&zs!==Ps&&e.jsxs("button",{onClick:()=>Ds(Ps),disabled:as,className:"px-3 md:px-4 py-2 border border-amber-400 text-amber-700 rounded-lg hover:bg-amber-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(mt,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:t==="de"?"Zur√ºcksetzen":t==="fr"?"Restaurer":"Restore"})]}),e.jsxs("button",{onClick:Br,disabled:as,className:`px-3 md:px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-semibold flex items-center gap-1.5 ${as?"opacity-50 cursor-not-allowed":"hover:bg-green-600"}`,children:[e.jsx(Ge,{size:16}),as?t==="de"?"Speichern...":t==="fr"?"Sauvegarde...":"Saving...":t==="de"?"Speichern":t==="fr"?"Sauvegarder":"Save"]})]})]})}),me&&e.jsx(ga,{pageNumber:me.pageNumber,scene:me.scene,onSceneChange:s=>ns({...me,scene:s}),onClose:()=>ns(null),onRegenerate:Jr,isRegenerating:ye.has(me.pageNumber),imageRegenerationCost:$e,characters:m.map(s=>({id:s.id,name:s.name})),selectedCharacterIds:me.selectedCharacterIds,onCharacterSelectionChange:s=>ns({...me,selectedCharacterIds:s}),consistencyRegen:Z?(Xt=C.find(s=>s.pageNumber===me.pageNumber))==null?void 0:Xt.consistencyRegen:void 0}),K&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(we,{size:20}),t==="de"?"Cover bearbeiten":t==="fr"?"Modifier la couverture":"Edit Cover"," - ",K.coverType==="front"?t==="de"?"Titelseite":t==="fr"?"Couverture":"Front Cover":K.coverType==="initial"?t==="de"?"Einleitungsseite":t==="fr"?"Page de d√©dicace":"Dedication Page":t==="de"?"R√ºckseite":t==="fr"?"Dos":"Back Cover"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t==="de"?"Bearbeite die Szenenbeschreibung und w√§hle die Charaktere aus":t==="fr"?"Modifiez la description de la sc√®ne et s√©lectionnez les personnages":"Edit the scene description and select the characters"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[m.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ut,{size:16}),t==="de"?"Charaktere auf dem Cover:":t==="fr"?"Personnages sur la couverture:":"Characters on the cover:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(s=>{const i=K.selectedCharacterIds.includes(s.id);return e.jsxs("button",{type:"button",onClick:()=>{const a=i?K.selectedCharacterIds.filter(l=>l!==s.id):[...K.selectedCharacterIds,s.id];Oe({...K,selectedCharacterIds:a})},className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${i?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[e.jsx("span",{className:"font-medium",children:s.name}),i&&e.jsx("span",{className:"text-indigo-500",children:"‚úì"})]},s.id)})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:t==="de"?"W√§hle die Charaktere aus, die auf dem Cover erscheinen sollen.":t==="fr"?"S√©lectionnez les personnages qui doivent appara√Ætre sur la couverture.":"Select the characters that should appear on the cover."})]}),K.coverType==="front"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t==="de"?"Titel:":t==="fr"?"Titre:":"Title:"}),e.jsx("input",{type:"text",value:K.title||"",onChange:s=>Oe({...K,title:s.target.value}),placeholder:t==="de"?"Der Titel des Buches":t==="fr"?"Le titre du livre":"The book title",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),K.coverType==="initial"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t==="de"?"Widmung:":t==="fr"?"D√©dicace:":"Dedication:"}),e.jsx("input",{type:"text",value:K.dedication||"",onChange:s=>Oe({...K,dedication:s.target.value}),placeholder:t==="de"?'z.B. "F√ºr meine liebste Tochter Emma"':t==="fr"?'par ex. "Pour ma ch√®re fille Emma"':'e.g. "For my dear daughter Emma"',className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t==="de"?"Leer lassen f√ºr keine Widmung":t==="fr"?"Laisser vide pour aucune d√©dicace":"Leave empty for no dedication"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t==="de"?"Szenenbeschreibung:":t==="fr"?"Description de la sc√®ne:":"Scene description:"}),e.jsx("textarea",{value:K.scene,onChange:s=>Oe({...K,scene:s.target.value}),placeholder:t==="de"?'z.B. "Die Hauptfigur steht vor einem magischen Schloss bei Sonnenuntergang"':t==="fr"?'par ex. "Le personnage principal devant un ch√¢teau magique au coucher du soleil"':'e.g. "The main character standing in front of a magical castle at sunset"',className:"w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y"}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:t==="de"?"Tipp: Beschreibe die Aktionen und die Umgebung. Die ausgew√§hlten Charaktere werden automatisch hinzugef√ºgt.":t==="fr"?"Conseil: D√©crivez les actions et l'environnement. Les personnages s√©lectionn√©s seront ajout√©s automatiquement.":"Tip: Describe the actions and the environment. Selected characters will be added automatically."})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:K.selectedCharacterIds.length>0&&e.jsx("span",{children:t==="de"?`${K.selectedCharacterIds.length} Charakter(e) ausgew√§hlt`:t==="fr"?`${K.selectedCharacterIds.length} personnage(s) s√©lectionn√©(s)`:`${K.selectedCharacterIds.length} character(s) selected`})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>Oe(null),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium order-2 sm:order-1",children:t==="de"?"Abbrechen":t==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{onClick:Qr,disabled:D.has(K.coverType==="front"?"frontCover":K.coverType==="initial"?"initialPage":"backCover")||K.selectedCharacterIds.length===0,className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 order-1 sm:order-2 ${D.has(K.coverType==="front"?"frontCover":K.coverType==="initial"?"initialPage":"backCover")||K.selectedCharacterIds.length===0?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:[e.jsx(we,{size:16}),t==="de"?"Neu generieren":t==="fr"?"R√©g√©n√©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",$e," ",t==="de"?"Credits":"credits",")"]})]})]})]})]})}),at&&e.jsx(wr,{pageNumber:at.pageNumber,versions:at.versions,onClose:()=>Ls(null),onSelectVersion:(s,i)=>qr(s,i),developerMode:Z}),it&&e.jsx(wr,{coverType:it.coverType,versions:it.versions,onClose:()=>is(null),onSelectVersion:(s,i)=>Wr(s,i),developerMode:Z}),lt&&e.jsx(ua,{src:lt.src,title:lt.title,onClose:()=>X(null)}),os&&e.jsx(ba,{beforeImage:os.beforeImage,afterImage:os.afterImage,diffImage:os.diffImage,title:os.title,onClose:()=>Es(null)})]})}export{Qa as StoryDisplay,Qa as default};
