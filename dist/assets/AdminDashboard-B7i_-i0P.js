import{c as f,j as e,X as be,b as fe,u as Ne,T as ae,L as M,E as ve}from"./index-jI-ghNPC.js";import{b as c,u as we}from"./vendor-react-BhxjzHy9.js";import{a as p}from"./api-CL93LcKs.js";import{B as g}from"./Button-DNOT3NLf.js";import{U as P,B as O,I as Ce,C as re}from"./Input-D0DE5_IX.js";import{A as Se,R as ie,D as ke,F as De,P as Ae,H as ne}from"./refresh-cw-BzAHkkwN.js";import{T as le}from"./trash-2-Biz1y8cA.js";import{C as ze}from"./clock-BTz4w8M3.js";import"./vendor-firebase-Ksn6Afo7.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=f("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=f("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=f("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=f("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=f("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=f("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=f("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),Ee={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-[95vw] max-h-[95vh]"};function q({isOpen:n,onClose:r,title:o,children:w,size:U="md",showCloseButton:l=!0,closeOnOverlayClick:E=!0,closeOnEscape:b=!0}){const j=c.useCallback(C=>{C.key==="Escape"&&b&&r()},[r,b]);return c.useEffect(()=>(n&&(document.addEventListener("keydown",j),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",j),document.body.style.overflow="unset"}),[n,j]),n?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:E?r:void 0}),e.jsxs("div",{className:`
          relative bg-white rounded-2xl shadow-2xl w-full mx-4
          transform transition-all duration-300 ease-out
          animate-in fade-in zoom-in-95
          ${Ee[U]}
        `,children:[(o||l)&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[o&&e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:o}),l&&e.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:e.jsx(be,{size:20})})]}),e.jsx("div",{className:"p-4 max-h-[80vh] overflow-y-auto",children:w})]})]}):null}const y={async getStats(){return p.get("/api/admin/stats")},async getUsers(){return p.get("/api/admin/users")},async updateUserCredits(n,r){return p.post(`/api/admin/users/${n}/quota`,{credits:r})},async getCreditHistory(n,r=50){return p.get(`/api/admin/users/${n}/credits?limit=${r}`)},async getUserDetails(n){return p.get(`/api/admin/users/${n}/details`)},async updateUserRole(n,r){return p.post(`/api/admin/users/${n}/role`,{role:r})},async deleteUser(n){return p.delete(`/api/admin/users/${n}`)},async cleanOrphanedFiles(){return p.post("/api/admin/cleanup-orphaned")},async clearCache(){return p.post("/api/admin/clear-cache")},async getSystemLogs(){return p.get("/api/admin/logs")},async exportUserData(){return(await fetch("/api/admin/export",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).blob()}};function _e(){const n=we(),{user:r,isAuthenticated:o,impersonate:w}=fe(),{language:U}=Ne(),[l,E]=c.useState(null),[b,j]=c.useState([]),[C,K]=c.useState(!0),[Z,J]=c.useState(null),[k,X]=c.useState("stats"),[x,D]=c.useState(null),[B,A]=c.useState(""),[S,d]=c.useState(!1),[F,m]=c.useState(null),[h,z]=c.useState(null),[Y,$]=c.useState([]),[de,Q]=c.useState(!1),[L,H]=c.useState(null),[i,I]=c.useState(null),[oe,W]=c.useState(!1),[N,ee]=c.useState({stories:!1,purchases:!1,credits:!1}),te={en:{title:"Admin Dashboard",stats:"Statistics",users:"User Management",totalUsers:"Total Users",totalStories:"Total Stories",totalCharacters:"Total Characters",totalImages:"Total Images",orphanedFiles:"Orphaned Files",databaseSize:"Database Size",adminActions:"Admin Actions",cleanOrphaned:"Clean Orphaned Files",exportData:"Export User Data",viewLogs:"View System Logs",clearCache:"Clear Cache",accessDenied:"Access Denied",accessDeniedDesc:"You need admin privileges to access this page.",goHome:"Go Home",username:"Username",email:"Email",role:"Role",credits:"Credits",actions:"Actions",editCredits:"Edit Credits",newCredits:"New Credits",save:"Save",cancel:"Cancel",makeAdmin:"Make Admin",removeAdmin:"Remove Admin",deleteUser:"Delete User",confirmDelete:"Are you sure you want to delete this user?",unlimited:"Unlimited",cleaned:"Cleaned {count} orphaned files",cacheCleared:"Cache cleared successfully",refreshStats:"Refresh Stats",creditHistory:"Credit History",viewHistory:"View History",amount:"Amount",balance:"Balance",type:"Type",description:"Description",date:"Date",noTransactions:"No transactions found",currentBalance:"Current Balance",impersonate:"View as User",impersonating:"Now viewing as {username}",userDetails:"User Details",memberSince:"Member Since",lastLogin:"Last Login",never:"Never",stories:"Stories",characters:"Characters",images:"Images",purchases:"Purchases",totalSpent:"Total Spent",storyTitle:"Title",pages:"Pages",purchaseHistory:"Purchase History",status:"Status",product:"Product",noStories:"No stories yet",noPurchases:"No purchases yet",close:"Close"},de:{title:"Admin-Dashboard",stats:"Statistiken",users:"Benutzerverwaltung",totalUsers:"Benutzer gesamt",totalStories:"Geschichten gesamt",totalCharacters:"Charaktere gesamt",totalImages:"Bilder gesamt",orphanedFiles:"Verwaiste Dateien",databaseSize:"Datenbankgroesse",adminActions:"Admin-Aktionen",cleanOrphaned:"Verwaiste Dateien bereinigen",exportData:"Benutzerdaten exportieren",viewLogs:"Systemprotokolle anzeigen",clearCache:"Cache leeren",accessDenied:"Zugriff verweigert",accessDeniedDesc:"Sie benoetigen Admin-Rechte um auf diese Seite zuzugreifen.",goHome:"Zur Startseite",username:"Benutzername",email:"E-Mail",role:"Rolle",credits:"Credits",actions:"Aktionen",editCredits:"Credits bearbeiten",newCredits:"Neue Credits",save:"Speichern",cancel:"Abbrechen",makeAdmin:"Zum Admin machen",removeAdmin:"Admin-Rechte entfernen",deleteUser:"Benutzer loeschen",confirmDelete:"Sind Sie sicher, dass Sie diesen Benutzer loeschen moechten?",unlimited:"Unbegrenzt",cleaned:"{count} verwaiste Dateien bereinigt",cacheCleared:"Cache erfolgreich geleert",refreshStats:"Statistiken aktualisieren",impersonate:"Als Benutzer ansehen",impersonating:"Ansicht als {username}",creditHistory:"Credit-Verlauf",viewHistory:"Verlauf anzeigen",amount:"Betrag",balance:"Guthaben",type:"Typ",description:"Beschreibung",date:"Datum",noTransactions:"Keine Transaktionen gefunden",currentBalance:"Aktuelles Guthaben",userDetails:"Benutzerdetails",memberSince:"Mitglied seit",lastLogin:"Letzter Login",never:"Nie",stories:"Geschichten",characters:"Charaktere",images:"Bilder",purchases:"Kaeufe",totalSpent:"Gesamtausgaben",storyTitle:"Titel",pages:"Seiten",purchaseHistory:"Kaufhistorie",status:"Status",product:"Produkt",noStories:"Noch keine Geschichten",noPurchases:"Noch keine Kaeufe",close:"Schliessen"},fr:{title:"Tableau de bord Admin",stats:"Statistiques",users:"Gestion des utilisateurs",totalUsers:"Utilisateurs totaux",totalStories:"Histoires totales",totalCharacters:"Personnages totaux",totalImages:"Images totales",orphanedFiles:"Fichiers orphelins",databaseSize:"Taille de la base",adminActions:"Actions Admin",cleanOrphaned:"Nettoyer fichiers orphelins",exportData:"Exporter les donnees",viewLogs:"Voir les logs systeme",clearCache:"Vider le cache",accessDenied:"Acces refuse",accessDeniedDesc:"Vous avez besoin des privileges admin pour acceder a cette page.",goHome:"Accueil",username:"Nom d'utilisateur",email:"E-mail",role:"Role",credits:"Credits",actions:"Actions",editCredits:"Modifier les credits",newCredits:"Nouveaux credits",save:"Enregistrer",cancel:"Annuler",makeAdmin:"Rendre admin",removeAdmin:"Retirer admin",deleteUser:"Supprimer l'utilisateur",confirmDelete:"Etes-vous sur de vouloir supprimer cet utilisateur?",unlimited:"Illimite",cleaned:"{count} fichiers orphelins nettoyes",cacheCleared:"Cache vide avec succes",refreshStats:"Actualiser les stats",impersonate:"Voir comme utilisateur",impersonating:"Vue en tant que {username}",creditHistory:"Historique des credits",viewHistory:"Voir l'historique",amount:"Montant",balance:"Solde",type:"Type",description:"Description",date:"Date",noTransactions:"Aucune transaction trouvee",currentBalance:"Solde actuel",userDetails:"Details utilisateur",memberSince:"Membre depuis",lastLogin:"Derniere connexion",never:"Jamais",stories:"Histoires",characters:"Personnages",images:"Images",purchases:"Achats",totalSpent:"Total depense",storyTitle:"Titre",pages:"Pages",purchaseHistory:"Historique des achats",status:"Statut",product:"Produit",noStories:"Pas encore d'histoires",noPurchases:"Pas encore d'achats",close:"Fermer"}},s=te[U]||te.en,R=async()=>{K(!0),J(null);try{const[t,a]=await Promise.all([y.getStats(),y.getUsers().catch(()=>[])]);E(t),j(a)}catch(t){J(t instanceof Error?t.message:"Unknown error")}finally{K(!1)}};c.useEffect(()=>{o&&(r==null?void 0:r.role)==="admin"&&R()},[o,r]);const me=async()=>{d(!0);try{const t=await y.cleanOrphanedFiles();m({type:"success",text:s.cleaned.replace("{count}",String(t.cleaned))}),R()}catch(t){m({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{d(!1)}},xe=async()=>{d(!0);try{const t=await y.exportUserData(),a=URL.createObjectURL(t),u=document.createElement("a");u.href=a,u.download="users-export.json",u.click(),URL.revokeObjectURL(a)}catch(t){m({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{d(!1)}},he=async()=>{d(!0);try{await y.clearCache(),m({type:"success",text:s.cacheCleared})}catch(t){m({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{d(!1)}},ue=async()=>{if(x){d(!0);try{const t=B==="-1"?-1:parseInt(B,10);await y.updateUserCredits(x.id,t),j(b.map(a=>a.id===x.id?{...a,credits:t}:a)),D(null),A("")}catch(t){m({type:"error",text:t instanceof Error?t.message:"Failed"})}finally{d(!1)}}},pe=async t=>{const a=t.role==="admin"?"user":"admin";d(!0);try{await y.updateUserRole(t.id,a),j(b.map(u=>u.id===t.id?{...u,role:a}:u))}catch(u){m({type:"error",text:u instanceof Error?u.message:"Failed"})}finally{d(!1)}},ge=async t=>{if(confirm(s.confirmDelete)){d(!0);try{await y.deleteUser(t.id),j(b.filter(a=>a.id!==t.id))}catch(a){m({type:"error",text:a instanceof Error?a.message:"Failed"})}finally{d(!1)}}},ye=async t=>{d(!0);try{await w(t.id),n("/")}catch(a){m({type:"error",text:a instanceof Error?a.message:"Impersonation failed"})}finally{d(!1)}},je=async t=>{z(t),Q(!0),$([]);try{const a=await y.getCreditHistory(t.id);$(a.transactions)}catch(a){m({type:"error",text:a instanceof Error?a.message:"Failed to load credit history"}),z(null)}finally{Q(!1)}},T=async t=>{H(t),W(!0),I(null),ee({stories:!1,purchases:!1,credits:!1});try{const a=await y.getUserDetails(t.id);I(a)}catch(a){m({type:"error",text:a instanceof Error?a.message:"Failed to load user details"}),H(null)}finally{W(!1)}},V=t=>{ee(a=>({...a,[t]:!a[t]}))},se=t=>t?new Date(t).toLocaleDateString()+" "+new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.never;return!o||(r==null?void 0:r.role)!=="admin"?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center max-w-md",children:[e.jsx(ae,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s.accessDenied}),e.jsx("p",{className:"text-gray-600 mb-6",children:s.accessDeniedDesc}),e.jsx(g,{onClick:()=>n("/"),children:s.goHome})]})}):C?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:e.jsx(M,{className:"w-12 h-12 animate-spin text-indigo-600"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 py-8 px-4",children:[e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>n("/"),className:"p-2 rounded-lg hover:bg-white/50 transition-colors",children:e.jsx(Se,{size:24})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:s.title})]}),e.jsxs(g,{variant:"outline",onClick:R,disabled:C,children:[e.jsx(ie,{size:16,className:C?"animate-spin":""}),s.refreshStats]})]}),Z&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:Z}),F&&e.jsxs("div",{className:`px-4 py-3 rounded-lg mb-6 ${F.type==="success"?"bg-green-100 border border-green-400 text-green-700":"bg-red-100 border border-red-400 text-red-700"}`,children:[F.text,e.jsx("button",{onClick:()=>m(null),className:"float-right font-bold",children:"Ã—"})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:()=>X("stats"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${k==="stats"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:s.stats}),e.jsx("button",{onClick:()=>X("users"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${k==="users"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:s.users})]}),k==="stats"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(v,{icon:e.jsx(P,{className:"w-8 h-8 text-purple-600"}),title:s.totalUsers,value:(l==null?void 0:l.totalUsers)??0}),e.jsx(v,{icon:e.jsx(O,{className:"w-8 h-8 text-pink-600"}),title:s.totalStories,value:(l==null?void 0:l.totalStories)??0}),e.jsx(v,{icon:e.jsx(P,{className:"w-8 h-8 text-blue-600"}),title:s.totalCharacters,value:(l==null?void 0:l.totalCharacters)??0}),e.jsx(v,{icon:e.jsx(ce,{className:"w-8 h-8 text-green-600"}),title:s.totalImages,value:(l==null?void 0:l.totalImages)??0}),e.jsx(v,{icon:e.jsx(ae,{className:"w-8 h-8 text-yellow-600"}),title:s.orphanedFiles,value:(l==null?void 0:l.orphanedFiles)??0}),e.jsx(v,{icon:e.jsx(He,{className:"w-8 h-8 text-indigo-600"}),title:s.databaseSize,value:(l==null?void 0:l.databaseSize)??"N/A",isString:!0})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:s.adminActions}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(g,{variant:"secondary",onClick:me,disabled:S,children:[e.jsx(le,{size:16}),s.cleanOrphaned]}),e.jsxs(g,{variant:"secondary",onClick:xe,disabled:S,children:[e.jsx(ke,{size:16}),s.exportData]}),e.jsxs(g,{variant:"secondary",onClick:()=>n("/admin/logs"),disabled:S,children:[e.jsx(De,{size:16}),s.viewLogs]}),e.jsxs(g,{variant:"danger",onClick:he,disabled:S,children:[e.jsx(ie,{size:16}),s.clearCache]})]})]})]}),k==="users"&&e.jsx("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.username}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.email}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.role}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.credits}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:s.actions})]})}),e.jsx("tbody",{className:"divide-y",children:b.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm cursor-pointer hover:text-indigo-600 hover:underline",onClick:()=>T(t),children:t.username}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 cursor-pointer hover:text-indigo-600",onClick:()=>T(t),children:t.email}),e.jsx("td",{className:"px-4 py-3 cursor-pointer",onClick:()=>T(t),children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.role==="admin"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:t.role})}),e.jsx("td",{className:"px-4 py-3 text-sm cursor-pointer hover:text-indigo-600",onClick:()=>T(t),children:t.credits===-1?s.unlimited:t.credits}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{D(t),A(String(t.credits))},className:"p-1 rounded hover:bg-gray-100 text-blue-600",title:s.editCredits,children:e.jsx(Ae,{size:16})}),e.jsx("button",{onClick:()=>pe(t),className:`p-1 rounded hover:bg-gray-100 ${t.role==="admin"?"text-yellow-600":"text-purple-600"}`,title:t.role==="admin"?s.removeAdmin:s.makeAdmin,disabled:t.id===(r==null?void 0:r.id),children:t.role==="admin"?e.jsx(Te,{size:16}):e.jsx(Ue,{size:16})}),e.jsx("button",{onClick:()=>je(t),className:"p-1 rounded hover:bg-gray-100 text-green-600",title:s.viewHistory||"View History",children:e.jsx(ne,{size:16})}),e.jsx("button",{onClick:()=>ye(t),className:"p-1 rounded hover:bg-gray-100 text-cyan-600",title:s.impersonate,disabled:t.id===(r==null?void 0:r.id),children:e.jsx(ve,{size:16})}),e.jsx("button",{onClick:()=>ge(t),className:"p-1 rounded hover:bg-gray-100 text-red-600",title:s.deleteUser,disabled:t.id===(r==null?void 0:r.id),children:e.jsx(le,{size:16})})]})})]},t.id))})]})})})]}),e.jsx(q,{isOpen:!!x,onClose:()=>{D(null),A("")},title:s.editCredits,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:[x==null?void 0:x.username," (",x==null?void 0:x.email,")"]}),e.jsx(Ce,{label:s.newCredits,type:"number",value:B,onChange:t=>A(t.target.value),placeholder:"-1 for unlimited"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(g,{variant:"secondary",onClick:()=>D(null),children:s.cancel}),e.jsx(g,{onClick:ue,disabled:S,children:s.save})]})]})}),e.jsx(q,{isOpen:!!h,onClose:()=>{z(null),$([])},title:`${s.creditHistory||"Credit History"}: ${(h==null?void 0:h.username)||""}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:s.currentBalance||"Current Balance"}),e.jsx("p",{className:"text-2xl font-bold text-indigo-800",children:(h==null?void 0:h.credits)===-1?s.unlimited||"Unlimited":h==null?void 0:h.credits})]}),de?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-indigo-600"})}):Y.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:s.noTransactions||"No transactions found"}):e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:s.date||"Date"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:s.type||"Type"}),e.jsx("th",{className:"px-3 py-2 text-right font-semibold text-gray-700",children:s.amount||"Amount"}),e.jsx("th",{className:"px-3 py-2 text-right font-semibold text-gray-700",children:s.balance||"Balance"})]})}),e.jsx("tbody",{className:"divide-y",children:Y.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-3 py-2 text-gray-600",children:[new Date(t.createdAt).toLocaleDateString()," ",new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${t.type==="story_reserve"?"bg-yellow-100 text-yellow-700":t.type==="story_complete"?"bg-green-100 text-green-700":t.type==="story_refund"?"bg-blue-100 text-blue-700":t.type==="admin_add"?"bg-purple-100 text-purple-700":t.type==="admin_deduct"?"bg-red-100 text-red-700":(t.type==="initial","bg-gray-100 text-gray-700")}`,children:t.type.replace(/_/g," ")})}),e.jsxs("td",{className:`px-3 py-2 text-right font-medium ${t.amount>0?"text-green-600":t.amount<0?"text-red-600":"text-gray-600"}`,children:[t.amount>0?"+":"",t.amount]}),e.jsx("td",{className:"px-3 py-2 text-right font-medium text-gray-800",children:t.balanceAfter})]},t.id))})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{variant:"secondary",onClick:()=>z(null),children:s.cancel||"Close"})})]})}),e.jsx(q,{isOpen:!!L,onClose:()=>{H(null),I(null)},title:`${s.userDetails}: ${(L==null?void 0:L.username)||""}`,children:e.jsxs("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto",children:[oe?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-indigo-600"})}):i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.email}),e.jsx("p",{className:"font-medium text-gray-800",children:i.user.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.role}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${i.user.role==="admin"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:i.user.role})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.memberSince}),e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:se(i.user.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{size:14,className:"text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.lastLogin}),e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:se(i.user.lastLogin)})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-pink-50 rounded-lg p-3 text-center",children:[e.jsx(O,{size:20,className:"mx-auto text-pink-600 mb-1"}),e.jsx("p",{className:"text-2xl font-bold text-pink-700",children:i.stats.totalStories}),e.jsx("p",{className:"text-xs text-pink-600",children:s.stories})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx(P,{size:20,className:"mx-auto text-blue-600 mb-1"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:i.stats.totalCharacters}),e.jsx("p",{className:"text-xs text-blue-600",children:s.characters})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[e.jsx(ce,{size:20,className:"mx-auto text-green-600 mb-1"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:i.stats.totalImages}),e.jsx("p",{className:"text-xs text-green-600",children:s.images})]}),e.jsxs("div",{className:"bg-amber-50 rounded-lg p-3 text-center",children:[e.jsx(re,{size:20,className:"mx-auto text-amber-600 mb-1"}),e.jsx("p",{className:"text-2xl font-bold text-amber-700",children:i.stats.totalPurchases}),e.jsx("p",{className:"text-xs text-amber-600",children:s.purchases})]})]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:s.currentBalance}),e.jsx("p",{className:"text-xl font-bold text-indigo-800",children:i.user.credits===-1?s.unlimited:i.user.credits})]}),i.stats.totalSpent>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:s.totalSpent}),e.jsxs("p",{className:"text-xl font-bold text-indigo-800",children:["$",i.stats.totalSpent.toFixed(2)]})]})]}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("button",{onClick:()=>V("stories"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(O,{size:16}),s.stories," (",i.stories.length,")"]}),N.stories?e.jsx(G,{size:16}):e.jsx(_,{size:16})]}),N.stories&&e.jsx("div",{className:"border-t px-4 py-3 max-h-48 overflow-y-auto",children:i.stories.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-2",children:s.noStories}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"pb-2",children:s.storyTitle}),e.jsx("th",{className:"pb-2",children:s.pages}),e.jsx("th",{className:"pb-2",children:s.images}),e.jsx("th",{className:"pb-2",children:s.date})]})}),e.jsx("tbody",{children:i.stories.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 font-medium",children:t.title}),e.jsx("td",{className:"py-2",children:t.pageCount}),e.jsx("td",{className:"py-2",children:t.imageCount}),e.jsx("td",{className:"py-2 text-gray-500",children:new Date(t.createdAt).toLocaleDateString()})]},t.id))})]})})]}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("button",{onClick:()=>V("purchases"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(re,{size:16}),s.purchaseHistory," (",i.purchases.length,")"]}),N.purchases?e.jsx(G,{size:16}):e.jsx(_,{size:16})]}),N.purchases&&e.jsx("div",{className:"border-t px-4 py-3 max-h-48 overflow-y-auto",children:i.purchases.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-2",children:s.noPurchases}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"pb-2",children:s.date}),e.jsx("th",{className:"pb-2",children:s.amount}),e.jsx("th",{className:"pb-2",children:s.status}),e.jsx("th",{className:"pb-2",children:s.product})]})}),e.jsx("tbody",{children:i.purchases.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 text-gray-500",children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"py-2 font-medium",children:[t.currency," ",t.amount]}),e.jsx("td",{className:"py-2",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${t.status==="paid"?"bg-green-100 text-green-700":t.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"py-2 text-gray-600 text-xs",children:t.productVariant||"-"})]},t.id))})]})})]}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("button",{onClick:()=>V("credits"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(ne,{size:16}),s.creditHistory," (",i.creditHistory.length,")"]}),N.credits?e.jsx(G,{size:16}):e.jsx(_,{size:16})]}),N.credits&&e.jsx("div",{className:"border-t px-4 py-3 max-h-48 overflow-y-auto",children:i.creditHistory.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-2",children:s.noTransactions}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"pb-2",children:s.date}),e.jsx("th",{className:"pb-2",children:s.type}),e.jsx("th",{className:"pb-2 text-right",children:s.amount}),e.jsx("th",{className:"pb-2 text-right",children:s.balance})]})}),e.jsx("tbody",{children:i.creditHistory.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 text-gray-500",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"py-2",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${t.type==="admin_add"?"bg-purple-100 text-purple-700":t.type==="story_complete"?"bg-green-100 text-green-700":t.type==="story_refund"?"bg-blue-100 text-blue-700":t.type==="story_reserve"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:t.type.replace(/_/g," ")})}),e.jsxs("td",{className:`py-2 text-right font-medium ${t.amount>0?"text-green-600":"text-red-600"}`,children:[t.amount>0?"+":"",t.amount]}),e.jsx("td",{className:"py-2 text-right font-medium",children:t.balanceAfter})]},t.id))})]})})]})]}):e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Failed to load user details"}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(g,{variant:"secondary",onClick:()=>H(null),children:s.close})})]})})]})}function v({icon:n,title:r,value:o,isString:w=!1}){return e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gray-100 rounded-lg",children:n}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:r}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:w?o:typeof o=="number"?o.toLocaleString():o})]})]})}export{_e as default};
