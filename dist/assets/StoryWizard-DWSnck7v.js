import{c as Le,b as Vr,j as e,u as ze,a as Fr,L as $t,T as Ms,C as ms,X as ot,E as Na,d as wa,e as Sa}from"./index-C14yjsyM.js";import{b as g,L as us,u as ka,d as Ca}from"./vendor-react-CHhk3aw2.js";import{b as Ie,a as Ar,B as ft,U as Zt,I as gs}from"./api-JsyJYKFZ.js";import{S as Qe,A as xs,N as Aa,s as De}from"./Textarea-Cdk3x3Ta.js";import{C as Pa}from"./circle-x-BE3aO-6V.js";import{C as Da}from"./clock-GXPD1QDc.js";import{M as Es,H as Ia,R as It,F as dr,P as Dr,I as $a,C as _r,a as Fa}from"./refresh-cw-1rCYW4G4.js";import{S as hs}from"./shopping-cart-CcgwlTNJ.js";import{D as za,C as xr}from"./download-C3aMhttY.js";import{P as Bs,A as Pr}from"./palette-n0cFqQ3r.js";import{C as Ma}from"./check-Dsfm4k4C.js";import{T as Ea}from"./trash-2-DrOGUuHY.js";import{A as ps}from"./arrow-left-D_k1yOOq.js";import"./vendor-firebase-DTVMaYMy.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=Le("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=Le("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=Le("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ur=Le("Images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=Le("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=Le("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=Le("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=Le("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=Le("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=Le("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=Le("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=Le("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=Le("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gr=Le("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=Le("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=Le("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),Oa={async login(t,a){const i=await Ie.post("/api/auth/login",{username:t,password:a},{skipAuth:!0}),h={id:i.user.id,username:i.user.username,email:i.user.email,role:i.user.role,credits:i.user.credits};return{token:i.token,user:h}},async register(t,a,i){return Ie.post("/api/auth/register",{username:t,password:a,email:i},{skipAuth:!0})},async loginWithFirebase(t){const a=await Ie.post("/api/auth/firebase",{idToken:t},{skipAuth:!0}),i={id:a.user.id,username:a.user.username,email:a.user.email,role:a.user.role,credits:a.user.credits};return{token:a.token,user:i}},async getQuota(){const t=await Ie.get("/api/user/quota");return{storyQuota:t.storyQuota,storiesGenerated:t.storiesGenerated,remaining:t.remaining}},async getCredits(){const t=await Ie.get("/api/user/quota");return{credits:t.credits,unlimited:t.unlimited}},async updateEmail(t){await Ie.put("/api/user/update-email",{email:t})},async getShippingAddress(){try{return await Ie.get("/api/user/shipping-address")}catch{return null}},async updateShippingAddress(t){await Ie.put("/api/user/shipping-address",t)}},be=Vr("CharacterService");function zr(t){if(!t)return;const a=parseInt(t,10);if(!(isNaN(a)||a<0))return a<=1?"infant":a<=2?"toddler":a<=4?"preschooler":a<=6?"kindergartner":a<=8?"young-school-age":a<=10?"school-age":a<=12?"preteen":a<=14?"young-teen":a<=17?"teenager":a<=25?"young-adult":a<=39?"adult":a<=59?"middle-aged":a<=75?"senior":"elderly"}function ys(t){const a={height:t.height,build:t.build,face:t.other_features||t.otherFeatures,eyeColor:t.eye_color||t.eyeColor,hairColor:t.hair_color||t.hairColor,hairStyle:t.hair_style||t.hairStyle,hair:t.hair_color||t.hairColor,other:t.other},i=t.age_category||t.ageCategory||zr(t.age),h=t.apparent_age||t.apparentAge;return{id:t.id,name:t.name,gender:t.gender,age:t.age,ageCategory:i,apparentAge:h,physical:a.height||a.build||a.face||a.eyeColor||a.hairColor||a.hairStyle||a.hair||a.other?a:void 0,traits:{strengths:t.strengths||[],flaws:t.flaws||t.weaknesses||[],challenges:t.challenges||t.fears||[],specialDetails:t.special_details||t.specialDetails},photos:{original:t.photo_url||t.photoUrl,face:t.thumbnail_url||t.thumbnailUrl,body:t.body_photo_url||t.bodyPhotoUrl,bodyNoBg:t.body_no_bg_url||t.bodyNoBgUrl,faceBox:t.face_box||t.faceBox,bodyBox:t.body_box||t.bodyBox},avatars:t.avatars||t.clothing_avatars||t.clothingAvatars,clothing:t.clothing?{current:t.clothing}:void 0,generatedOutfits:t.generated_outfits||t.generatedOutfits}}function vs(t){var i,h,s,w,l,c,f,v,$,O,S,y,D,T,B,x,A,H,z,J;const a=t.ageCategory||zr(t.age);return{id:t.id,name:t.name,gender:t.gender,age:t.age,age_category:a,apparent_age:t.apparentAge,height:(i=t.physical)==null?void 0:i.height,build:(h=t.physical)==null?void 0:h.build,eye_color:(s=t.physical)==null?void 0:s.eyeColor,hair_color:(w=t.physical)==null?void 0:w.hairColor,hair_style:(l=t.physical)==null?void 0:l.hairStyle,other_features:(c=t.physical)==null?void 0:c.face,other:(f=t.physical)==null?void 0:f.other,photo_url:(v=t.photos)==null?void 0:v.original,thumbnail_url:($=t.photos)==null?void 0:$.face,body_photo_url:(O=t.photos)==null?void 0:O.body,body_no_bg_url:(S=t.photos)==null?void 0:S.bodyNoBg,face_box:(y=t.photos)==null?void 0:y.faceBox,body_box:(D=t.photos)==null?void 0:D.bodyBox,strengths:(T=t.traits)==null?void 0:T.strengths,flaws:(B=t.traits)==null?void 0:B.flaws,challenges:(x=t.traits)==null?void 0:x.challenges,special_details:(A=t.traits)==null?void 0:A.specialDetails,weaknesses:(H=t.traits)==null?void 0:H.flaws,fears:(z=t.traits)==null?void 0:z.challenges,clothing:(J=t.clothing)==null?void 0:J.current,clothing_avatars:t.avatars,avatars:t.avatars,generated_outfits:t.generatedOutfits}}function qa(t){return!t||t.length===0?[]:typeof t[0]=="string"?t.map(a=>({forward:a,inverse:a})):t}const ve={async getCharacters(){return((await Ie.get("/api/characters")).characters||[]).map(ys)},async getCharacterData(){const t=await Ie.get("/api/characters");return{characters:(t.characters||[]).map(ys),relationships:t.relationships||{},relationshipTexts:t.relationshipTexts||{},customRelationships:qa(t.customRelationships),customStrengths:t.customStrengths||[],customWeaknesses:t.customWeaknesses||[],customFears:t.customFears||[]}},async saveCharacters(t){await Ie.post("/api/characters",{characters:t.map(vs)})},async saveCharacterData(t){const a={characters:t.characters.map(vs),relationships:t.relationships,relationshipTexts:t.relationshipTexts,customRelationships:t.customRelationships,customStrengths:t.customStrengths,customWeaknesses:t.customWeaknesses,customFears:t.customFears};await Ie.post("/api/characters",a)},async generateClothingAvatars(t){var a,i,h,s,w,l,c,f,v;try{const $=parseInt(t.age)||10,O=t.gender||"child";let S;O==="male"?S=$>=18?"man":"boy":O==="female"?S=$>=18?"woman":"girl":S=$>=18?"person":"child";let y=`${t.name} is a ${$}-year-old ${S}`;t.physical&&(t.physical.hair&&(y+=`, ${t.physical.hair}`),t.physical.face&&(y+=`, ${t.physical.face}`),t.physical.build&&(y+=`, ${t.physical.build}`),t.physical.other&&(y+=`, ${t.physical.other}`));const D=((a=t.photos)==null?void 0:a.bodyNoBg)||((i=t.photos)==null?void 0:i.body)||((h=t.photos)==null?void 0:h.face)||((s=t.photos)==null?void 0:s.original);be.info(`Generating clothing avatars for ${t.name} (id: ${t.id}), using: ${(w=t.photos)!=null&&w.bodyNoBg?"bodyNoBg":(l=t.photos)!=null&&l.body?"body":(c=t.photos)!=null&&c.face?"face":"original"}`);const T=await Ie.post("/api/generate-clothing-avatars",{characterId:t.id,facePhoto:D,physicalDescription:y,name:t.name,age:t.age,apparentAge:t.apparentAge,gender:t.gender,build:(f=t.physical)==null?void 0:f.build});if(T.success&&T.clothingAvatars){be.success(`Clothing avatars generated for ${t.name}`);const B=T.clothingAvatars.extractedTraits,x=(v=T.clothingAvatars.structuredClothing)==null?void 0:v.standard;return B&&be.info(`Extracted traits: ${JSON.stringify(B)}`),x&&be.info(`Extracted clothing: ${JSON.stringify(x)}`),{success:!0,avatars:T.clothingAvatars,extractedTraits:B,extractedClothing:x}}else return be.error(`Failed to generate avatars: ${T.error}`),{success:!1,error:T.error}}catch($){return be.error("Clothing avatar generation failed:",$),{success:!1,error:String($)}}},async generateClothingAvatarsWithTraits(t){var a,i,h,s,w,l,c,f;try{const v=parseInt(t.age)||10,$=t.gender||"child";let O;$==="male"?O=v>=18?"man":"boy":$==="female"?O=v>=18?"woman":"girl":O=v>=18?"person":"child";let S=`${t.name} is a ${v}-year-old ${O}`;t.physical&&(t.physical.hair&&(S+=`, ${t.physical.hair}`),t.physical.face&&(S+=`, ${t.physical.face}`),t.physical.build&&(S+=`, ${t.physical.build}`),t.physical.other&&(S+=`, ${t.physical.other}`));const y=((a=t.photos)==null?void 0:a.bodyNoBg)||((i=t.photos)==null?void 0:i.body)||((h=t.photos)==null?void 0:h.face)||((s=t.photos)==null?void 0:s.original);be.info(`Generating clothing avatars WITH TRAITS for ${t.name} (id: ${t.id}), using: ${(w=t.photos)!=null&&w.bodyNoBg?"bodyNoBg":(l=t.photos)!=null&&l.body?"body":(c=t.photos)!=null&&c.face?"face":"original"}`),be.info(`Physical traits: ${JSON.stringify(t.physical)}`);const D=await Ie.post("/api/generate-clothing-avatars",{characterId:t.id,facePhoto:y,physicalDescription:S,name:t.name,age:t.age,apparentAge:t.apparentAge,gender:t.gender,build:((f=t.physical)==null?void 0:f.build)||"average",physicalTraits:t.physical});return D.success&&D.clothingAvatars?(be.success(`Clothing avatars WITH TRAITS generated for ${t.name}`),{success:!0,avatars:D.clothingAvatars}):(be.error(`Failed to generate avatars with traits: ${D.error}`),{success:!1,error:D.error})}catch(v){return be.error("Clothing avatar generation with traits failed:",v),{success:!1,error:String(v)}}},async analyzePhoto(t,a){var i,h,s,w,l,c,f,v,$,O,S,y,D,T,B,x,A,H,z,J;try{const _=await Ie.post("/api/analyze-photo",{imageData:t,language:a}),F={height:(i=_.attributes)==null?void 0:i.height,build:(h=_.attributes)==null?void 0:h.build,face:(s=_.attributes)==null?void 0:s.face,eyeColor:((w=_.attributes)==null?void 0:w.eye_color)||((l=_.attributes)==null?void 0:l.eyeColor),hairColor:((c=_.attributes)==null?void 0:c.hair_color)||((f=_.attributes)==null?void 0:f.hairColor),hairLength:((v=_.attributes)==null?void 0:v.hair_length)||(($=_.attributes)==null?void 0:$.hairLength),hairStyle:((O=_.attributes)==null?void 0:O.hair_style)||((S=_.attributes)==null?void 0:S.hairStyle),hair:((y=_.attributes)==null?void 0:y.hair_color)||((D=_.attributes)==null?void 0:D.hairColor),other:(T=_.attributes)==null?void 0:T.other_features};return _.success?{success:_.success,photos:{face:_.faceThumbnail,body:_.bodyCrop,bodyNoBg:_.bodyNoBg,faceBox:_.faceBox,bodyBox:_.bodyBox},age:(B=_.attributes)==null?void 0:B.age,apparentAge:(x=_.attributes)==null?void 0:x.apparent_age,gender:(A=_.attributes)==null?void 0:A.gender,physical:F.height||F.build||F.face||F.eyeColor||F.hairColor||F.hairLength||F.hairStyle||F.hair||F.other?F:void 0,clothing:(H=_.attributes)!=null&&H.clothing||(z=_.attributes)!=null&&z.clothingStyle||(J=_.attributes)!=null&&J.clothingColors?{current:_.attributes.clothing,style:_.attributes.clothingStyle||_.attributes.clothingColors}:void 0,_debug:_._debug}:{success:!1,error:_.error}}catch(_){return be.error("Photo analysis failed:",_),{success:!1,error:"unknown_error"}}},needsAvatars(t){var s,w,l,c;if(!!!((s=t.photos)!=null&&s.original||(w=t.photos)!=null&&w.face||(l=t.photos)!=null&&l.body||(c=t.photos)!=null&&c.bodyNoBg))return!1;const i=t.avatars;return i?i.status==="generating"||i.status==="pending"?!1:i.status==="failed"?!0:!!!(i.winter||i.standard||i.summer||i.formal):!0},async generateAndSaveAvatarForCharacter(t,a){var h,s,w,l,c,f,v,$,O,S,y,D;const i={characterId:t.id,characterName:t.name,success:!1};try{if(!!!((h=t.photos)!=null&&h.original||(s=t.photos)!=null&&s.face||(w=t.photos)!=null&&w.body||(l=t.photos)!=null&&l.bodyNoBg))return i.skipped=!0,i.skipReason="No photo available",i;a==null||a("generating",`Generating avatars for ${t.name}...`),be.info(`üé® Generating avatars for ${t.name} (id: ${t.id})`);const B=await ve.generateClothingAvatars(t);if(!B.success||!B.avatars)return i.error=B.error||"Avatar generation failed",a==null||a("error",i.error),i;i.avatars=B.avatars,i.extractedTraits=B.extractedTraits,i.extractedClothing=B.extractedClothing,a==null||a("saving",`Saving avatars for ${t.name}...`);const x=await ve.getCharacterData();let A={...t,avatars:B.avatars};if(B.extractedTraits){const z=B.extractedTraits;A={...A,physical:{...A.physical,build:z.build||((c=A.physical)==null?void 0:c.build),eyeColor:z.eyeColor||((f=A.physical)==null?void 0:f.eyeColor),hairColor:z.hairColor||((v=A.physical)==null?void 0:v.hairColor),hairLength:z.hairLength||(($=A.physical)==null?void 0:$.hairLength),hairStyle:z.hairStyle||((O=A.physical)==null?void 0:O.hairStyle),facialHair:z.facialHair||((S=A.physical)==null?void 0:S.facialHair),face:z.face||((y=A.physical)==null?void 0:y.face),other:z.other||((D=A.physical)==null?void 0:D.other)}},be.info(`üìã Populated physical traits from extraction for ${t.name}`)}if(B.extractedClothing){const z=B.extractedClothing;A={...A,clothing:{...A.clothing,structured:{upperBody:z.upperBody||void 0,lowerBody:z.lowerBody||void 0,shoes:z.shoes||void 0,fullBody:z.fullBody||void 0}}},be.info(`üëï Populated structured clothing from extraction for ${t.name}`)}const H=x.characters.map(z=>z.id===t.id?A:z);return await ve.saveCharacterData({...x,characters:H}),i.success=!0,i.character=A,a==null||a("complete",`Avatars saved for ${t.name}`),be.success(`‚úÖ Avatars generated and saved for ${t.name}`),i}catch(T){return i.error=String(T),a==null||a("error",i.error),be.error(`Failed to generate/save avatars for ${t.name}:`,T),i}},async generateAvatarsForCharacters(t,a){const{forceRegenerate:i=!1,maxConcurrent:h=2,onProgress:s}=a||{};be.info("üé® Starting batch avatar generation...");const w=await ve.getCharacterData();let l;if(t&&t.length>0?l=w.characters.filter(S=>t.includes(S.id)):l=w.characters.filter(S=>{var y,D;return i?!!((y=S.photos)!=null&&y.original||(D=S.photos)!=null&&D.face):ve.needsAvatars(S)}),l.length===0)return be.info("No characters need avatar generation"),{results:[],successCount:0,failCount:0,skipCount:0};be.info(`Processing ${l.length} characters for avatar generation`);const c=[],f=new Map;for(let S=0;S<l.length;S+=h){const D=l.slice(S,S+h).map(async B=>{var A,H,z,J,_;const x={characterId:B.id,characterName:B.name,success:!1};try{if(!!!((A=B.photos)!=null&&A.original||(H=B.photos)!=null&&H.face||(z=B.photos)!=null&&z.body||(J=B.photos)!=null&&J.bodyNoBg))return x.skipped=!0,x.skipReason="No photo available",x;if(!i&&((_=B.avatars)!=null&&_.winter))return x.skipped=!0,x.skipReason="Avatars already exist",x;s==null||s(B.id,"generating",`Generating avatars for ${B.name}...`),be.info(`üé® Generating avatars for ${B.name}...`);const ae=await ve.generateClothingAvatars(B);return!ae.success||!ae.avatars?(x.error=ae.error||"Avatar generation failed",s==null||s(B.id,"error",x.error),x):(x.avatars=ae.avatars,x.success=!0,f.set(B.id,{...B,avatars:ae.avatars}),s==null||s(B.id,"complete",`Avatars generated for ${B.name}`),be.success(`‚úÖ Avatars generated for ${B.name}`),x)}catch(F){return x.error=String(F),s==null||s(B.id,"error",x.error),be.error(`Failed to generate avatars for ${B.name}:`,F),x}}),T=await Promise.all(D);c.push(...T)}if(f.size>0){be.info(`üíæ Saving ${f.size} character avatar updates...`);const S=await ve.getCharacterData(),y=S.characters.map(D=>f.get(D.id)||D);await ve.saveCharacterData({...S,characters:y}),be.success(`üíæ Saved avatar updates for ${f.size} characters`)}const v=c.filter(S=>S.success).length,$=c.filter(S=>!S.success&&!S.skipped).length,O=c.filter(S=>S.skipped).length;return be.info(`Avatar generation complete: ${v} success, ${$} failed, ${O} skipped`),{results:c,successCount:v,failCount:$,skipCount:O}},async regenerateAvatarsForCharacter(t,a){be.info(`üîÑ Regenerating avatars for character ${t}...`);const h=(await ve.getCharacterData()).characters.find(w=>w.id===t);if(!h)return{characterId:t,characterName:"Unknown",success:!1,error:"Character not found"};const s={...h,avatars:{status:"pending"}};return ve.generateAndSaveAvatarForCharacter(s,a?(w,l)=>a(w,l):void 0)}},js={sm:"h-1",md:"h-2",lg:"h-3"},Ha={default:"bg-indigo-600",success:"bg-green-500",warning:"bg-yellow-500",gradient:"bg-gradient-to-r from-indigo-500 to-indigo-600"};function Va({value:t,max:a=100,label:i,showPercentage:h=!1,size:s="md",variant:w="gradient",className:l=""}){const c=Math.min(Math.max(t/a*100,0),100);return e.jsxs("div",{className:l,children:[(i||h)&&e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[i&&e.jsx("span",{className:"text-sm font-medium text-gray-700",children:i}),h&&e.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(c),"%"]})]}),e.jsx("div",{className:`w-full bg-gray-200 rounded-full overflow-hidden ${js[s]}`,children:e.jsx("div",{className:`${js[s]} ${Ha[w]} rounded-full transition-all duration-500 ease-out`,style:{width:`${c}%`}})})]})}const Gt=Vr("ImageLoad");function Sr({src:t,alt:a,className:i,label:h}){const[s,w]=g.useState(!0),[l,c]=g.useState(null),f=g.useRef(0),v=g.useRef(null);g.useEffect(()=>{t&&t.length>100?(f.current=Date.now(),Gt.info(`‚è≥ Loading ${h||a}`,{isBase64:t==null?void 0:t.startsWith("data:"),sizeKB:Math.round(t.length*3/4/1024)})):f.current=0,w(!0),c(null)},[t,a,h]);const $=()=>{if(w(!1),f.current===0){Gt.info(`‚úÖ Loaded ${h||a} (placeholder/empty)`);return}const S=Date.now()-f.current;c(S);const D=(t==null?void 0:t.startsWith("data:"))?Math.round(t.length*3/4/1024):null,T=v.current?`${v.current.naturalWidth}x${v.current.naturalHeight}`:"unknown";S<100?Gt.success(`‚úÖ Loaded ${h||a} in ${S}ms`,{sizeKB:D,naturalSize:T}):S<500?Gt.info(`‚úÖ Loaded ${h||a} in ${S}ms`,{sizeKB:D,naturalSize:T}):S<2e3?Gt.warn(`‚ö†Ô∏è Slow load: ${h||a} took ${S}ms`,{sizeKB:D,naturalSize:T}):Gt.error(`üê¢ Very slow: ${h||a} took ${S}ms`,{sizeKB:D,naturalSize:T}),S>1e3&&Ka({type:"slow_image_load",label:h||a,loadTimeMs:S,sizeKB:D,naturalSize:T,userAgent:navigator.userAgent,timestamp:new Date().toISOString()})},O=()=>{if(w(!1),f.current===0){Gt.error(`‚ùå Failed to load ${h||a} (no data received)`);return}const S=Date.now()-f.current;Gt.error(`‚ùå Failed to load ${h||a} after ${S}ms`)};return e.jsx("img",{ref:v,src:t,alt:a,className:i,onLoad:$,onError:O})}async function Ka(t){try{await fetch("/api/log-error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errorType:"Performance",message:`Slow image load: ${t.label} took ${t.loadTimeMs}ms`,userAgent:t.userAgent,timestamp:t.timestamp,url:window.location.href})})}catch{}}function Wa(t,a){var c;if(!t)return"";const i=t.match(/^Image (\d+)\/(\d+)\.\.\.$/);if(i){const[,f,v]=i;return a==="de"?`Bild ${f}/${v}...`:a==="fr"?`Image ${f}/${v}...`:t}const h=t.match(/^Generating illustration (\d+)\/(\d+)\.\.\.$/);if(h){const[,f,v]=h;return a==="de"?`Illustration ${f}/${v} wird erstellt...`:a==="fr"?`Cr√©ation de l'illustration ${f}/${v}...`:t}const s=t.match(/^Generating (\w+) avatar for (.+)\.\.\.$/);if(s){const[,f,v]=s;return a==="de"?`${v}: ${f}-Avatar wird erstellt...`:a==="fr"?`Cr√©ation de l'avatar ${f} pour ${v}...`:t}const w=t.match(/^(\d+) cover images? ready\. Generating remaining covers\.\.\.$/);if(w){const[,f]=w;return a==="de"?`${f} Cover fertig. Weitere Cover werden erstellt...`:a==="fr"?`${f} couverture(s) pr√™te(s). Cr√©ation des couvertures restantes...`:t}const l={"Writing story...":{de:"Geschichte wird geschrieben...",fr:"√âcriture de l'histoire..."},"Creating covers...":{de:"Cover werden erstellt...",fr:"Cr√©ation des couvertures..."},"Generating cover images...":{de:"Cover werden erstellt...",fr:"Cr√©ation des couvertures..."},"Generating page illustrations...":{de:"Seitenbilder werden erstellt...",fr:"Cr√©ation des illustrations..."},"Generating picture book story and scenes...":{de:"Geschichte und Szenen werden erstellt...",fr:"Cr√©ation de l'histoire et des sc√®nes..."},"Picture book complete!":{de:"Bilderbuch fertig!",fr:"Livre d'images termin√©!"},"Complete!":{de:"Fertig!",fr:"Termin√©!"}};return a==="en"?t:(c=l[t])!=null&&c[a]?l[t][a]:t}function Ua({current:t,total:a,message:i,isGenerating:h=!0,coverImages:s,jobId:w,onCancel:l,characters:c=[],isStalled:f=!1,onDismissStalled:v}){const{language:$}=ze(),{user:O}=Fr(),S=(O==null?void 0:O.role)==="admin",[y,D]=g.useState(!1),[T,B]=g.useState(0),x=[{en:"{name} is getting ready for their big adventure...",de:"{name} macht sich bereit f√ºr das grosse Abenteuer...",fr:"{name} se pr√©pare pour sa grande aventure..."},{en:"{name} is practicing their hero pose...",de:"{name} √ºbt gerade die Heldenpose...",fr:"{name} s'entra√Æne √† prendre la pose du h√©ros..."},{en:"{name} can't wait to see what happens next!",de:"{name} kann es kaum erwarten zu sehen, was als N√§chstes passiert!",fr:"{name} a h√¢te de voir ce qui va se passer !"},{en:"{name} is warming up for the adventure ahead...",de:"{name} w√§rmt sich f√ºr das bevorstehende Abenteuer auf...",fr:"{name} s'√©chauffe pour l'aventure √† venir..."},{en:"{name} just found a magic feather! Adding it to the story...",de:"{name} hat gerade eine Zauberfeder gefunden! Wir f√ºgen sie der Geschichte hinzu...",fr:"{name} vient de trouver une plume magique ! On l'ajoute au r√©cit..."},{en:"{name} is whispering secrets to the story wizard...",de:"{name} fl√ºstert dem Geschichtenzauberer Geheimnisse zu...",fr:"{name} chuchote des secrets au magicien des histoires..."},{en:"{name} is peeking around the corner to see what's coming...",de:"{name} schaut um die Ecke, um zu sehen, was kommt...",fr:"{name} jette un coup d'≈ìil au coin pour voir ce qui arrive..."},{en:"{name} is doing a little happy dance!",de:"{name} macht einen kleinen Freudentanz!",fr:"{name} fait une petite danse de joie !"},{en:"{name} is collecting stars for the story...",de:"{name} sammelt Sterne f√ºr die Geschichte...",fr:"{name} collectionne des √©toiles pour le r√©cit..."},{en:"{name} just met a friendly dragon! Making friends...",de:"{name} hat gerade einen freundlichen Drachen getroffen! Sie werden Freunde...",fr:"{name} vient de rencontrer un dragon amical ! Ils deviennent amis..."}],A=g.useRef({}),[H,z]=g.useState(null),J=g.useMemo(()=>c.filter(N=>{const L=N.avatars;return L&&(L.standard||L.summer||L.winter||L.formal)}),[c]),_=N=>{const L=N.avatars;if(!L)return"";const U=[];return L.standard&&U.push(L.standard),L.summer&&U.push(L.summer),L.winter&&U.push(L.winter),L.formal&&U.push(L.formal),U[Math.floor(Math.random()*U.length)]||""},F=g.useMemo(()=>{const N=[{type:"message",key:"timeInfo"},{type:"message",key:"tipCharacters"},{type:"message",key:"emailInfo"},{type:"message",key:"tipStoryPlot"},{type:"message",key:"canClose"},{type:"message",key:"tipLocations"},{type:"message",key:"tipArtStyle"}];if(J.length===0)return N;const L=[],U=Math.max(N.length,J.length);for(let K=0;K<U;K++)L.push(N[K%N.length]),L.push({type:"character",char:J[K%J.length]});return L},[J]);if(g.useEffect(()=>{if(F.length<=1)return;const N=setInterval(()=>{B(L=>(L+1)%F.length)},8e3);return()=>clearInterval(N)},[F.length]),g.useEffect(()=>{if(F.length===0)return;const N=F[T];if(N.type==="character"){const L=N.char,U=_(L),Pe=((A.current[L.id]??-1)+1)%x.length;A.current[L.id]=Pe;const je=x[Pe],Ce=($==="de"?je.de:$==="fr"?je.fr:je.en).replace("{name}",L.name);z({avatarUrl:U,message:Ce})}else z(null)},[T,F,$]),!h||a===0)return null;const ae=a===100?t:Math.round(t/a*100),le=Wa(i||"",$),re=N=>{if(N)return typeof N=="string"?N:N.imageData},me=re(s==null?void 0:s.frontCover),ue=re(s==null?void 0:s.initialPage),W=re(s==null?void 0:s.backCover),p=!!me,pe=!!ue,X=!!W,Y=p||pe||X,oe={en:{title:"Creating Your Story!",timeInfo:"Your story will start to display in about 1 minute. The full story can take up to 10 minutes.",emailInfo:"You will receive an email when your story is ready.",canClose:"You can wait here or close the browser - your story will keep generating.",tipCharacters:"The better you describe your characters, the more fun the story becomes!",tipStoryPlot:'"Story Plot / Story Details" lets you craft your own personal adventure.',tipLocations:'Add your hometown and favorite places to "Story Plot / Story Details" for a personal touch.',tipArtStyle:"What's your favorite art style? For picture books, watercolor works great!",coversPreview:"Cover Preview",frontCover:"Front",initialPage:"Inside",backCover:"Back",cancelJob:"Cancel Generation",cancelling:"Cancelling...",stalled:"Generation seems stuck",stalledDesc:"No progress for a while. This can happen due to high server load.",continueWaiting:"Keep Waiting"},de:{title:"Geschichte wird erstellt!",timeInfo:"Deine Geschichte wird in etwa 1 Minute angezeigt. Die Erstellung der vollst√§ndigen Geschichte kann bis zu 10 Minuten dauern.",emailInfo:"Du erh√§ltst eine E-Mail, wenn deine Geschichte bereit ist.",canClose:"Du kannst hier warten oder den Browser schliessen - deine Geschichte wird weiter generiert.",tipCharacters:"Je besser du deine Charaktere beschreibst, desto lustiger wird die Geschichte!",tipStoryPlot:'Mit "Handlung / Angaben zur Geschichte" kannst du dein ganz pers√∂nliches Abenteuer gestalten.',tipLocations:'F√ºge deinen Heimatort und Lieblingsorte zu "Handlung / Angaben zur Geschichte" hinzu f√ºr eine pers√∂nliche Note.',tipArtStyle:"Was ist dein Lieblings-Kunststil? F√ºr Bilderb√ºcher funktioniert Aquarell besonders gut!",coversPreview:"Cover-Vorschau",frontCover:"Vorne",initialPage:"Innen",backCover:"Hinten",cancelJob:"Generierung abbrechen",cancelling:"Wird abgebrochen...",stalled:"Generierung scheint h√§ngen zu bleiben",stalledDesc:"Seit einer Weile kein Fortschritt. Dies kann bei hoher Serverlast passieren.",continueWaiting:"Weiter warten"},fr:{title:"Cr√©ation de votre histoire!",timeInfo:"Votre r√©cit commencera √† s'afficher dans environ 1 minute. Le r√©cit complet peut prendre jusqu'√† 10 minutes.",emailInfo:"Vous recevrez un email quand votre r√©cit sera pr√™t.",canClose:"Vous pouvez attendre ici ou fermer le navigateur - votre r√©cit continuera √† √™tre g√©n√©r√©.",tipCharacters:"Mieux vous d√©crivez vos personnages, plus le r√©cit sera amusant !",tipStoryPlot:'"Intrigue / Contexte du r√©cit" vous permet de cr√©er votre propre aventure personnelle.',tipLocations:'Ajoutez votre ville et vos endroits pr√©f√©r√©s √† "Intrigue / Contexte du r√©cit" pour une touche personnelle.',tipArtStyle:"Quel est votre style artistique pr√©f√©r√© ? Pour les livres d'images, l'aquarelle fonctionne tr√®s bien !",coversPreview:"Aper√ßu des couvertures",frontCover:"Avant",initialPage:"Int√©rieur",backCover:"Arri√®re",cancelJob:"Annuler la g√©n√©ration",cancelling:"Annulation...",stalled:"La g√©n√©ration semble bloqu√©e",stalledDesc:"Aucun progr√®s depuis un moment. Cela peut arriver en cas de forte charge serveur.",continueWaiting:"Continuer √† attendre"}},ge=oe[$]||oe.en,ye=({imageData:N,label:L,isReady:U})=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`w-16 h-16 md:w-20 md:h-20 rounded-lg overflow-hidden border-2 ${U?"border-green-400":"border-gray-200"} bg-gray-100 flex items-center justify-center`,children:U&&N?e.jsx("img",{src:N,alt:L,className:"w-full h-full object-cover"}):e.jsx($t,{size:20,className:"animate-spin text-gray-400"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[U&&e.jsx(ms,{size:12,className:"text-green-500"}),e.jsx("span",{className:`text-xs ${U?"text-green-600 font-medium":"text-gray-400"}`,children:L})]})]});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`bg-white rounded-2xl shadow-xl w-full p-6 md:p-8 ${Y?"max-w-lg":"max-w-md"}`,children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"relative inline-block mb-3",children:[e.jsx($t,{size:48,className:"animate-spin text-indigo-600"}),e.jsx("span",{className:"absolute -top-1 -right-1 text-xl",children:"‚ú®"})]}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-800",children:ge.title})]}),!Y&&F.length>0&&e.jsx("div",{className:"mb-6 min-h-[220px] flex items-center justify-center",children:(()=>{const N=F[T];if(N.type==="character"&&H)return e.jsxs("div",{className:"flex flex-col items-center gap-3 animate-fade-in",children:[e.jsx("div",{className:"w-32 h-44 md:w-40 md:h-52 rounded-xl overflow-hidden border-4 border-indigo-200 shadow-lg bg-gradient-to-b from-indigo-50 to-purple-50",children:e.jsx("img",{src:H.avatarUrl,alt:N.char.name,className:"w-full h-full object-contain"})}),e.jsx("p",{className:"text-sm text-center text-gray-600 max-w-xs italic",children:H.message})]},`char-${N.char.id}-${T}`);if(N.type==="message"){const L=N.key,U=ge[L]||"",K=L==="timeInfo"?e.jsx(Da,{size:20,className:"text-indigo-500 shrink-0"}):L==="emailInfo"?e.jsx(Es,{size:20,className:"text-indigo-500 shrink-0"}):e.jsx(ms,{size:20,className:"text-indigo-500 shrink-0"});return e.jsxs("div",{className:"flex items-start gap-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 max-w-sm animate-fade-in",children:[K,e.jsx("p",{className:"text-sm text-gray-700",children:U})]})}return null})()}),Y&&e.jsxs("div",{className:"mb-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-indigo-700 text-center mb-3",children:ge.coversPreview}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(ye,{imageData:me,label:ge.frontCover,isReady:p}),e.jsx(ye,{imageData:ue,label:ge.initialPage,isReady:pe}),e.jsx(ye,{imageData:W,label:ge.backCover,isReady:X})]})]}),Y&&e.jsxs("div",{className:"mb-4 text-center",children:[e.jsxs("p",{className:"text-sm text-gray-600 flex items-center justify-center gap-2",children:[e.jsx($t,{size:14,className:"animate-spin text-indigo-500"}),$==="de"?"Bilder f√ºr die Seiten werden jetzt erstellt...":$==="fr"?"Cr√©ation des images pour les pages en cours...":"Now generating images for the pages..."]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:$==="de"?"Dies kann einige Minuten dauern. Du kannst den Browser schliessen.":$==="fr"?"Cela peut prendre quelques minutes. Vous pouvez fermer le navigateur.":"This may take a few minutes. You can close the browser."})]}),e.jsx("div",{className:"mb-4",children:e.jsx(Va,{value:ae,max:100,showPercentage:!0,size:"lg"})}),le&&e.jsx("p",{className:"text-indigo-600 text-sm text-center font-medium mb-4",children:le}),f&&e.jsx("div",{className:"mb-4 bg-amber-50 border border-amber-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ms,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-amber-800 mb-1",children:ge.stalled}),e.jsx("p",{className:"text-sm text-amber-700 mb-3",children:ge.stalledDesc}),e.jsxs("div",{className:"flex gap-2",children:[v&&e.jsx("button",{onClick:v,className:"px-3 py-1.5 bg-amber-100 hover:bg-amber-200 text-amber-800 rounded-lg text-sm font-medium transition-colors",children:ge.continueWaiting}),l&&e.jsx("button",{onClick:()=>{if(!y){D(!0);try{l()}finally{D(!1)}}},disabled:y,className:"px-3 py-1.5 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:y?ge.cancelling:ge.cancelJob})]})]})]})}),S&&w&&l&&e.jsxs("button",{onClick:async()=>{if(!y){D(!0);try{l()}finally{D(!1)}}},disabled:y,className:"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:[y?e.jsx($t,{size:16,className:"animate-spin"}):e.jsx(Pa,{size:16}),y?ge.cancelling:ge.cancelJob]})]})})}function cr({retryHistory:t,totalAttempts:a,language:i}){const[h,s]=g.useState(null);if(!t||t.length===0)return null;const w=t.filter(l=>l.type==="auto_repair").length;return e.jsxs(e.Fragment,{children:[h&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>s(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("div",{className:"absolute -top-8 left-0 text-white text-sm",children:h.title}),e.jsx("img",{src:h.src,alt:h.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute -top-8 right-0 text-white hover:text-gray-300",onClick:()=>s(null),children:"‚úï Close"})]})}),e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-purple-700 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ia,{size:14}),i==="de"?"Generierungshistorie":i==="fr"?"Historique de g√©n√©ration":"Generation History",w>0&&e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded",children:["üîß ",w," ",i==="de"?"Reparatur":"repair",w>1?i==="de"?"en":"s":""]})]}),e.jsxs("span",{className:"text-purple-600",children:[a," ",i==="de"?"Versuche":i==="fr"?"tentatives":"attempts"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:t.map((l,c)=>e.jsxs("div",{className:`border rounded-lg p-3 ${l.type==="auto_repair"?"bg-amber-50 border-amber-300":c===t.length-1?"bg-green-50 border-green-300":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-sm",children:[l.type==="auto_repair"?e.jsx("span",{className:"text-amber-700",children:"üîß Auto-Repair"}):e.jsx(e.Fragment,{children:i==="de"?`Versuch ${l.attempt}`:i==="fr"?`Tentative ${l.attempt}`:`Attempt ${l.attempt}`}),l.type==="text_edit"&&e.jsx("span",{className:"text-xs ml-2 text-blue-600",children:"(text edit)"}),l.type==="text_edit_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(text edit failed)"}),l.type==="auto_repair_failed"&&e.jsx("span",{className:"text-xs ml-2 text-red-600",children:"(auto-repair failed)"}),c===t.length-1&&l.type!=="auto_repair"&&e.jsx("span",{className:"text-xs ml-2 text-green-600 font-bold",children:"‚úì USED"})]}),l.type==="auto_repair"&&l.preRepairScore!==void 0&&l.postRepairScore!==void 0?e.jsxs("span",{className:"font-bold text-sm",children:[e.jsxs("span",{className:l.preRepairScore>=70?"text-green-600":l.preRepairScore>=50?"text-yellow-600":"text-red-600",children:[l.preRepairScore,"%"]}),e.jsx("span",{className:"text-gray-400 mx-1",children:"‚Üí"}),e.jsxs("span",{className:l.postRepairScore>=70?"text-green-600":l.postRepairScore>=50?"text-yellow-600":"text-red-600",children:[l.postRepairScore,"%"]})]}):l.score!==void 0&&e.jsxs("span",{className:`font-bold ${l.score>=70?"text-green-600":l.score>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(l.score),"%"]})]}),l.error&&e.jsxs("div",{className:"text-xs text-red-600 mb-2",children:["Error: ",l.error]}),l.textIssue&&l.textIssue!=="NONE"&&e.jsxs("div",{className:"text-xs text-orange-600 mb-2",children:["Text issue: ",l.textIssue,l.expectedText&&e.jsxs("span",{className:"block",children:['Expected: "',l.expectedText,'"']}),l.actualText&&e.jsxs("span",{className:"block",children:['Actual: "',l.actualText,'"']})]}),l.type==="auto_repair"&&e.jsxs("div",{className:"space-y-2",children:[l.fixTargetsCount&&e.jsxs("div",{className:"text-xs text-amber-700",children:["Fixed ",l.fixTargetsCount," target",l.fixTargetsCount>1?"s":""]}),e.jsxs("details",{className:"text-xs",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium",children:["üìä ",i==="de"?"Bewertungen anzeigen":"View Evaluations"]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border border-red-200",children:[e.jsxs("div",{className:"font-medium text-red-700 mb-1",children:["Before (",l.preRepairScore,"%)"]}),e.jsx("pre",{className:"text-[10px] whitespace-pre-wrap overflow-auto max-h-40 bg-gray-50 p-1 rounded",children:l.preRepairEval?JSON.stringify(l.preRepairEval,null,2):l.reasoning||"No data"})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-green-200",children:[e.jsxs("div",{className:"font-medium text-green-700 mb-1",children:["After (",l.postRepairScore,"%)"]}),e.jsx("pre",{className:"text-[10px] whitespace-pre-wrap overflow-auto max-h-40 bg-gray-50 p-1 rounded",children:l.postRepairEval?JSON.stringify(l.postRepairEval,null,2):"No data"})]})]})]}),l.repairDetails&&l.repairDetails.length>0&&e.jsxs("details",{className:"text-xs",children:[e.jsxs("summary",{className:"cursor-pointer text-amber-700 font-medium",children:["üñºÔ∏è ",i==="de"?"Reparatur-Details":"Repair Details"," (",l.repairDetails.length,")"]}),e.jsx("div",{className:"mt-2 space-y-2",children:l.repairDetails.map((f,v)=>e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-medium mb-1",children:f.description}),e.jsx("div",{className:"text-gray-600 mb-2",children:f.fixPrompt}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[f.beforeImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-500 mb-1",children:"Before"}),e.jsx("img",{src:f.beforeImage,alt:"Before",className:"w-32 h-32 object-contain border rounded cursor-pointer hover:ring-2 hover:ring-amber-400",onClick:()=>s({src:f.beforeImage,title:"Before Repair"})})]}),f.maskImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-500 mb-1",children:"Mask"}),e.jsx("img",{src:f.maskImage,alt:"Mask",className:"w-32 h-32 object-contain border rounded bg-black cursor-pointer hover:ring-2 hover:ring-gray-400",onClick:()=>s({src:f.maskImage,title:"Repair Mask"})})]}),f.afterImage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-500 mb-1",children:"After"}),e.jsx("img",{src:f.afterImage,alt:"After",className:"w-32 h-32 object-contain border rounded cursor-pointer hover:ring-2 hover:ring-green-400",onClick:()=>s({src:f.afterImage,title:"After Repair"})})]})]})]},v))})]})]}),l.type!=="auto_repair"&&l.reasoning?e.jsxs("details",{className:"text-xs text-gray-600 mb-2",children:[e.jsx("summary",{className:"cursor-pointer",children:"Feedback"}),e.jsx("pre",{className:"mt-1 whitespace-pre-wrap bg-gray-50 p-2 rounded text-[10px] overflow-auto max-h-40",children:l.reasoning})]}):l.type!=="auto_repair"&&l.score===0&&e.jsx("div",{className:"text-xs text-gray-500 italic mb-2",children:i==="de"?"Qualit√§tsbewertung fehlgeschlagen":i==="fr"?"√âvaluation de qualit√© √©chou√©e":"Quality evaluation failed"}),l.imageData&&l.type!=="auto_repair"&&e.jsxs("details",{children:[e.jsx("summary",{className:"cursor-pointer text-xs text-blue-600",children:i==="de"?"Bild anzeigen":i==="fr"?"Voir image":"View image"}),e.jsx("img",{src:l.imageData,alt:`Attempt ${l.attempt}`,className:`mt-2 w-full rounded border ${c===t.length-1?"border-green-300":"border-gray-200 opacity-75"}`})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(l.timestamp).toLocaleTimeString()})]},c))})]})]})}function Rs({src:t,alt:a,onClose:i}){const h=g.useCallback(s=>{s.key==="Escape"&&i()},[i]);return g.useEffect(()=>(t&&(document.addEventListener("keydown",h),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",h),document.body.style.overflow="unset"}),[t,h]),t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm cursor-pointer",onClick:i,children:[e.jsx("button",{onClick:i,className:"absolute top-4 right-4 p-2 rounded-full bg-black/50 hover:bg-black/70 text-white transition-colors z-10","aria-label":"Close",children:e.jsx(ot,{size:24})}),e.jsx("img",{src:t,alt:a||"Enlarged image",className:"max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl",onClick:s=>s.stopPropagation()})]}):null}function mr({referencePhotos:t,language:a}){var f;const[i,h]=g.useState(null);if(!t||t.length===0)return null;const s=v=>{switch(v){case"bodyNoBg":case"body-no-bg":return a==="de"?"Ganzk√∂rper (freigestellt)":a==="fr"?"Corps entier (d√©tour√©)":"Full body (no bg)";case"body":return a==="de"?"Ganzk√∂rper":a==="fr"?"Corps entier":"Full body";case"face":return a==="de"?"Gesicht":a==="fr"?"Visage":"Face only";case"clothing-winter":return a==="de"?"Winter-Avatar":a==="fr"?"Avatar hiver":"Winter avatar";case"clothing-summer":return a==="de"?"Sommer-Avatar":a==="fr"?"Avatar √©t√©":"Summer avatar";case"clothing-formal":return a==="de"?"Formell-Avatar":a==="fr"?"Avatar formel":"Formal avatar";case"clothing-standard":return a==="de"?"Standard-Avatar":a==="fr"?"Avatar standard":"Standard avatar";case"none":return a==="de"?"Kein Foto":a==="fr"?"Pas de photo":"No photo";default:return v}},w=v=>{switch(v){case"bodyNoBg":case"body-no-bg":return"bg-green-100 text-green-700 border-green-300";case"body":return"bg-blue-100 text-blue-700 border-blue-300";case"face":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"clothing-winter":return"bg-cyan-100 text-cyan-700 border-cyan-300";case"clothing-summer":return"bg-orange-100 text-orange-700 border-orange-300";case"clothing-formal":return"bg-purple-100 text-purple-700 border-purple-300";case"clothing-standard":return"bg-teal-100 text-teal-700 border-teal-300";case"none":return"bg-red-100 text-red-700 border-red-300";default:return"bg-gray-100 text-gray-700 border-gray-300"}},l=(f=t.find(v=>v.clothingCategory))==null?void 0:f.clothingCategory,c=v=>{if(!v)return"";switch(v){case"winter":return a==="de"?"Winter":a==="fr"?"Hiver":"Winter";case"summer":return a==="de"?"Sommer":a==="fr"?"√ât√©":"Summer";case"formal":return a==="de"?"Formell":a==="fr"?"Formel":"Formal";case"standard":return"Standard";default:return v}};return e.jsxs("details",{className:"bg-pink-50 border border-pink-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-900 flex items-center gap-2",children:[e.jsx("span",{children:"üì∏"}),a==="de"?"Referenzfotos":a==="fr"?"Photos de r√©f√©rence":"Reference Photos",e.jsxs("span",{className:"text-xs text-pink-600",children:["(",t.length,")"]}),l&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-pink-200 text-pink-800 text-xs rounded",children:["üëï ",c(l)]})]}),e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2",children:t.map((v,$)=>e.jsxs("div",{className:"bg-white rounded-lg p-2 border border-pink-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-800 truncate",children:v.name}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium border whitespace-nowrap ${w(v.photoType)}`,children:s(v.photoType)})]}),v.photoUrl&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:v.photoUrl,alt:`${v.name} - ${s(v.photoType)}`,className:`w-full max-h-32 object-contain rounded border bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity ${v.isStyled?"border-purple-400 ring-2 ring-purple-200":"border-gray-200"}`,onClick:()=>h(v.photoUrl),title:"Click to enlarge"}),v.isStyled&&e.jsx("span",{className:"absolute top-1 right-1 px-1 py-0.5 text-[9px] font-bold bg-purple-500 text-white rounded",children:"üé® STYLED"})]}),v.photoHash&&e.jsxs("div",{className:"mt-1 text-[9px] font-mono text-gray-500 bg-gray-100 px-1 py-0.5 rounded text-center",children:["üîê ",v.photoHash]})]})]},$))}),e.jsx(Rs,{src:i,onClose:()=>h(null)})]})}function Ja({pageNumber:t,scene:a,onSceneChange:i,onClose:h,onRegenerate:s,isRegenerating:w,imageRegenerationCost:l}){const{language:c}=ze();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Me,{size:20}),c==="de"?`Szene bearbeiten - Seite ${t}`:c==="fr"?`Modifier la sc√®ne - Page ${t}`:`Edit Scene - Page ${t}`]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:c==="de"?"Bearbeiten Sie die Szenenbeschreibung und generieren Sie das Bild neu.":c==="fr"?"Modifiez la description de la sc√®ne et r√©g√©n√©rez l'image.":"Edit the scene description and regenerate the image."})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c==="de"?"Szenenbeschreibung:":c==="fr"?"Description de la sc√®ne:":"Scene description:"}),e.jsx("textarea",{value:a,onChange:f=>i(f.target.value),className:"w-full h-40 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-y",placeholder:c==="de"?"Beschreiben Sie die Szene...":c==="fr"?"D√©crivez la sc√®ne...":"Describe the scene..."}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:c==="de"?"Tipp: Beschreiben Sie die Charaktere, ihre Aktionen und die Umgebung.":c==="fr"?"Conseil: D√©crivez les personnages, leurs actions et l'environnement.":"Tip: Describe the characters, their actions, and the environment."})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:h,disabled:w,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700 font-medium disabled:opacity-50",children:c==="de"?"Abbrechen":c==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:s,disabled:w||!a.trim(),className:`px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium flex items-center gap-2 ${w||!a.trim()?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700"}`,children:w?e.jsxs(e.Fragment,{children:[e.jsx(It,{size:16,className:"animate-spin"}),c==="de"?"Generiere...":c==="fr"?"G√©n√©ration...":"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(It,{size:16}),c==="de"?"Neu generieren":c==="fr"?"R√©g√©n√©rer":"Regenerate",e.jsxs("span",{className:"text-xs opacity-80",children:["(",l," credits)"]})]})})]})]})})}function Qa({pageNumber:t,versions:a,onClose:i,onSelectVersion:h,developerMode:s=!1}){const{language:w}=ze();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ur,{size:20}),w==="de"?`Bildversionen - Seite ${t}`:w==="fr"?`Versions d'image - Page ${t}`:`Image Versions - Page ${t}`]}),e.jsx("button",{onClick:i,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(ot,{size:20})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:a.map((l,c)=>e.jsxs("div",{className:`relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${l.isActive?"border-green-500 ring-2 ring-green-200":"border-gray-200 hover:border-indigo-300"}`,onClick:()=>h(t,c),children:[e.jsx("img",{src:l.imageData,alt:`Version ${c+1}`,className:"w-full aspect-square object-cover"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:c===0?"Original":`V${c+1}`}),l.isActive&&e.jsx("span",{className:"bg-green-500 px-2 py-0.5 rounded text-[10px] font-bold",children:w==="de"?"Aktiv":w==="fr"?"Actif":"Active"})]}),e.jsx("div",{className:"text-[10px] text-gray-300 mt-1",children:new Date(l.createdAt).toLocaleDateString()})]})]},c))}),s&&a.length>1&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-700",children:w==="de"?"Szenen- und Prompt-Vergleich":w==="fr"?"Comparaison de sc√®nes et prompts":"Scene & Prompt Comparison"}),a.map((l,c)=>e.jsxs("details",{className:`rounded-lg p-3 ${l.isActive?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-medium text-gray-700",children:[c===0?"Original":`V${c+1}`,l.isActive&&e.jsx("span",{className:"ml-2 text-green-600 text-xs",children:"(Active)"})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[l.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-amber-700",children:w==="de"?"Szene:":w==="fr"?"Sc√®ne:":"Scene:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-24 overflow-y-auto",children:l.description})]}),l.prompt&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-blue-700",children:w==="de"?"API-Prompt:":w==="fr"?"Prompt API:":"API Prompt:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-32 overflow-y-auto",children:l.prompt})]}),l.modelId&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Model: ",l.modelId]})]})]},c))]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 text-sm text-gray-500",children:w==="de"?"Klicken Sie auf ein Bild, um es auszuw√§hlen":w==="fr"?"Cliquez sur une image pour la s√©lectionner":"Click an image to select it"})]})})}function Ya({src:t,title:a,onClose:i}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:i,children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] bg-white rounded-lg overflow-hidden",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:a}),e.jsx("button",{onClick:i,className:"text-gray-500 hover:text-gray-700 p-1",children:e.jsx(ot,{size:20})})]}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsx("img",{src:t,alt:a,className:"max-w-full max-h-[80vh] object-contain mx-auto"})})]})})}function Za({title:t,story:a,outline:i,outlinePrompt:h,outlineModelId:s,outlineUsage:w,storyTextPrompts:l=[],visualBible:c,sceneImages:f,sceneDescriptions:v=[],coverImages:$,languageLevel:O="standard",storyLanguage:S,isGenerating:y=!1,onDownloadPdf:D,onAddToBook:T,onPrintBook:B,onCreateAnother:x,onDownloadTxt:A,onRegenerateImage:H,onRegenerateCover:z,onEditImage:J,onEditCover:_,onRepairImage:F,onVisualBibleChange:ae,storyId:le,developerMode:re=!1,styledAvatarGeneration:me=[],costumedAvatarGeneration:ue=[],generationLog:W=[],isPartial:p=!1,failureReason:pe,generatedPages:X,totalPages:Y,progressiveMode:oe=!1,progressiveData:ge,completedPageImages:ye={},originalStory:N,onSaveStoryText:L,onSaveTitleChange:U,userCredits:K=0,imageRegenerationCost:Pe=5,isImpersonating:je=!1,onSelectImageVersion:dt}){var Ue,Ht,gt,M;const{t:Ce,language:n}=ze(),Ge=O==="1st-grade",ne=S?S.startsWith("de")?"de":S:n,fe=je||K===-1||K>=Pe,[Z,ee]=g.useState(null),[xe,se]=g.useState(""),[ie,rt]=g.useState(!1),[st,bt]=g.useState(a),[Ee,Tt]=g.useState(!1),[yt,vt]=g.useState(!1),[Ye,jt]=g.useState(t||""),[Nt,_t]=g.useState(!1),[at,wt]=g.useState(null),[He,St]=g.useState(null),[ct,Ot]=g.useState(!1),[Se,mt]=g.useState(null),[qe,$e]=g.useState(null);g.useEffect(()=>{ie||bt(a)},[a,ie]),g.useEffect(()=>{yt||jt(t||"")},[t,yt]);const nt=async()=>{if(L){Tt(!0);try{await L(st),rt(!1)}catch(r){console.error("Failed to save story text:",r)}finally{Tt(!1)}}},Ft=async()=>{if(!(!U||!Ye.trim())){_t(!0);try{await U(Ye.trim()),vt(!1)}catch(r){console.error("Failed to save title:",r)}finally{_t(!1)}}},zt=()=>{bt(a),rt(!1)},qt=async r=>{if(!(!F||Se!==null)){mt(r);try{await F(r)}catch(E){console.error("Failed to repair image:",E)}finally{mt(null)}}},it=(r,E)=>{const k=st.split(/(?=---\s*(?:Page|Seite)\s+\d+\s*---|(?=##\s*(?:Page|Seite)\s+\d+))/i);let u=0;for(let de=0;de<k.length;de++)if(/^(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i.test(k[de].trim())){u=de;break}const Q=u+r;if(Q<k.length){const de=k[Q].match(/^(---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i),ke=de?de[0]:"";k[Q]=ke+`
`+E.trim()+`
`}bt(k.join(""))},Ze=r=>{const E=f.find(k=>k.pageNumber===r);return(E==null?void 0:E.imageVersions)||[]},Mt=async(r,E)=>{if(dt)try{await dt(r,E),wt(null)}catch(k){console.error("Failed to select image version:",k)}},Xe=r=>{if(!r)return"";const E=r.match(/(?:\*\*)?6\.?\s*(?:\*\*)?\s*Image Summary\s*\([^)]+\)\s*\*\*\s*([\s\S]*?)(?=\n\s*(?:\*\*)?\d+\.|\n---|\n```|$)/i);if(E&&E[1]&&E[1].trim())return E[1].trim();const k=r.match(/\*\*(Image Summary|Bildzusammenfassung|R√©sum√© de l['']Image)\*\*[\s\n]*([\s\S]*?)(?=\n\s*\d+\.\s*\*\*|$)/i);if(k&&k[2]&&k[2].trim())return k[2].trim();if(!r.includes("**")&&r.length<1e3)return r.trim();const u=r.split(/\n\n/)[0];return u&&u.length<1e3?u.replace(/^\d+\.\s*\*\*[^*]+\*\*\s*\n?/,"").trim()||u.trim():r.substring(0,500).trim()+"..."},Ve=r=>{const E=f.find(de=>de.pageNumber===r),k=v.find(de=>de.pageNumber===r),u=(E==null?void 0:E.description)||(k==null?void 0:k.description)||"",Q=Xe(u);St({pageNumber:r,scene:Q})},Ke=async()=>{if(!(!He||!H)){Ot(!0);try{await H(He.pageNumber,He.scene),St(null)}catch(r){console.error("Failed to regenerate image:",r)}finally{Ot(!1)}}},We=(r,E,k,u)=>{ee({type:r,id:E,field:k}),se(u||"")},Te=()=>{if(!Z||!c||!ae)return;const{type:r,id:E,field:k}=Z,u={...c};if(r==="secondaryCharacter")u.secondaryCharacters=(u.secondaryCharacters||[]).map(Q=>Q.id===E?{...Q,[k]:xe}:Q);else if(r==="animal")u.animals=(u.animals||[]).map(Q=>Q.id===E?{...Q,[k]:xe}:Q);else if(r==="artifact")u.artifacts=(u.artifacts||[]).map(Q=>Q.id===E?{...Q,[k]:xe}:Q);else if(r==="location")u.locations=(u.locations||[]).map(Q=>Q.id===E?{...Q,[k]:xe}:Q);else if(r==="mainCharacter"){const Q=parseInt(E);u.mainCharacters=(u.mainCharacters||[]).map(de=>de.id!==Q?de:k==="physical.face"?{...de,physical:{...de.physical,face:xe}}:k==="physical.hair"?{...de,physical:{...de.physical,hair:xe}}:k==="physical.build"?{...de,physical:{...de.physical,build:xe}}:de)}ae(u),ee(null),se("")},et=()=>{ee(null),se("")},Fe=(r=>r?r.split(/(?:---\s*(?:Page|Seite)\s+\d+\s*---|##\s*(?:Page|Seite)\s+\d+)/i).slice(1).filter(k=>k.trim().length>0):[])(ie?st:a),tt=f.length>0,_e=(()=>{if(!oe)return Fe.length;if(Fe.length===0)return 0;let r=1;for(let E=2;E<=Fe.length;E++){const k=E-1;if(f.some(Q=>Q.pageNumber===k&&Q.imageData)||!!ye[k])r=E;else break}return r})(),Be=(ge==null?void 0:ge.totalPages)||Fe.length;oe&&_e!==Be&&console.log(`[PROGRESSIVE] maxViewable=${_e}, total=${Be}, completedImages=${Object.keys(ye).length}, isGenerating=${y}`);const Oe=r=>r?typeof r=="string"?r:r.imageData||null:null,Bt=r=>r?typeof r=="string"?{imageData:r}:r:null,ut=r=>{var u;const E=(u=v.find(Q=>Q.pageNumber===r))==null?void 0:u.description;if(E)return E;const k=f.find(Q=>Q.pageNumber===r);return k==null?void 0:k.description},kt=r=>{var E;return(E=v.find(k=>k.pageNumber===r))==null?void 0:E.outlineExtract},Ct=r=>{var E;return(E=v.find(k=>k.pageNumber===r))==null?void 0:E.scenePrompt},Re=r=>{var E;return(E=v.find(k=>k.pageNumber===r))==null?void 0:E.textModelId};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center gap-2",children:yt?e.jsxs("div",{className:"flex items-center gap-2 w-full max-w-2xl",children:[e.jsx("input",{type:"text",value:Ye,onChange:r=>jt(r.target.value),className:"flex-1 text-2xl md:text-3xl font-bold text-gray-800 text-center border-2 border-indigo-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-500",autoFocus:!0,onKeyDown:r=>{r.key==="Enter"&&Ft(),r.key==="Escape"&&(jt(t||""),vt(!1))}}),e.jsx("button",{onClick:Ft,disabled:Nt||!Ye.trim(),className:"p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50",title:n==="de"?"Speichern":n==="fr"?"Sauvegarder":"Save",children:Nt?e.jsx(Or,{className:"animate-spin",size:20}):e.jsx(pt,{size:20})}),e.jsx("button",{onClick:()=>{jt(t||""),vt(!1)},disabled:Nt,className:"p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",title:n==="de"?"Abbrechen":n==="fr"?"Annuler":"Cancel",children:e.jsx(ot,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-800 text-center",children:t||Ce.yourStory}),U&&!y&&e.jsx("button",{onClick:()=>vt(!0),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:n==="de"?"Titel bearbeiten":n==="fr"?"Modifier le titre":"Edit title",children:e.jsx(Me,{size:18})})]})}),p&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-400 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-amber-500 text-2xl",children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-amber-800",children:n==="de"?"Unvollst√§ndige Geschichte":n==="fr"?"Histoire incompl√®te":"Incomplete Story"}),e.jsx("p",{className:"text-amber-700 text-sm mt-1",children:n==="de"?`Diese Geschichte konnte nicht vollst√§ndig generiert werden. ${X||f.length} von ${Y||"unbekannt"} Seiten wurden erstellt.`:n==="fr"?`Cette histoire n'a pas pu √™tre g√©n√©r√©e compl√®tement. ${X||f.length} sur ${Y||"inconnu"} pages ont √©t√© cr√©√©es.`:`This story could not be fully generated. ${X||f.length} of ${Y||"unknown"} pages were created.`}),pe&&re&&e.jsxs("details",{className:"mt-2 text-sm",children:[e.jsx("summary",{className:"cursor-pointer text-amber-600 hover:text-amber-700",children:n==="de"?"Fehlerdetails":n==="fr"?"D√©tails de l'erreur":"Error details"}),e.jsx("p",{className:"mt-1 bg-amber-100 p-2 rounded text-amber-800 font-mono text-xs",children:pe})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[tt&&le&&T&&e.jsxs("button",{onClick:T,disabled:y,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(hs,{size:16})," ",n==="de"?"Buch erstellen":n==="fr"?"Cr√©er le livre":"Create Book"]}),tt&&D&&e.jsxs("button",{onClick:D,disabled:y,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(dr,{size:16})," ",n==="de"?"PDF herunterladen":n==="fr"?"T√©l√©charger PDF":"Download PDF"]}),L&&!ie&&e.jsxs("button",{onClick:()=>rt(!0),disabled:y,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Me,{size:16})," ",n==="de"?"Text bearbeiten":n==="fr"?"Modifier le texte":"Edit Text"]}),x&&e.jsxs("button",{onClick:x,disabled:y,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Dr,{size:16})," ",n==="de"?"Neue Geschichte":n==="fr"?"Nouvelle histoire":"New Story"]})]}),re&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[A&&e.jsxs("button",{onClick:A,className:"bg-gray-500 text-white px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 hover:bg-gray-600",children:[e.jsx(za,{size:14})," TXT"]}),tt&&le&&B&&e.jsxs("button",{onClick:B,disabled:y,className:`bg-yellow-500 text-black px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 ${y?"opacity-50 cursor-not-allowed":"hover:bg-yellow-600"}`,children:[e.jsx(Ar,{size:14})," Print (DEV)"]})]}),re&&e.jsxs("div",{className:"space-y-4 mt-6",children:[i&&e.jsxs("details",{className:"bg-purple-50 border-2 border-purple-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-purple-800 hover:text-purple-900 flex items-center gap-2",children:[e.jsx(dr,{size:20}),Ge?n==="de"?"Vollst√§ndige API-Ausgabe (Kombiniert)":n==="fr"?"Sortie API compl√®te (Combin√©e)":"Full API Output (Combined)":n==="de"?"Vollst√§ndige API-Ausgabe (Outline)":n==="fr"?"Sortie API compl√®te (Plan)":"Full API Output (Outline)",s&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-purple-600",children:["(",s,")"]}),w&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-purple-500",children:["[",w.input_tokens.toLocaleString()," in / ",w.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[h&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:n==="de"?"üì§ Prompt (Eingabe)":n==="fr"?"üì§ Prompt (Entr√©e)":"üì§ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:h})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-purple-700 mb-2",children:Ge?n==="de"?"üì• API-Antwort (Kombiniert)":n==="fr"?"üì• R√©ponse API (Combin√©e)":"üì• API Response (Combined)":n==="de"?"üì• API-Antwort (Outline)":n==="fr"?"üì• R√©ponse API (Plan)":"üì• API Response (Outline)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-purple-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:i})]})]})]}),a&&l.length>0&&e.jsxs("details",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(Ar,{size:20}),n==="de"?"Vollst√§ndige API-Ausgabe (Story-Text)":n==="fr"?"Sortie API compl√®te (Texte)":"Full API Output (Story Text)",((Ue=l[0])==null?void 0:Ue.modelId)&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-amber-600",children:["(",l[0].modelId,")"]}),((Ht=l[0])==null?void 0:Ht.usage)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-amber-500",children:["[",l[0].usage.input_tokens.toLocaleString()," in / ",l[0].usage.output_tokens.toLocaleString()," out]"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:n==="de"?"üì§ Prompt (Eingabe)":n==="fr"?"üì§ Prompt (Entr√©e)":"üì§ Prompt (Input)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((gt=l[0])==null?void 0:gt.prompt)||"No prompt available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-700 mb-2",children:n==="de"?"üì• Rohe API-Antwort (ungefiltert)":n==="fr"?"üì• R√©ponse API brute (non filtr√©e)":"üì• Raw API Response (unfiltered)"}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-4 rounded-lg border border-amber-200 overflow-x-auto max-h-[400px] overflow-y-auto",children:((M=l[0])==null?void 0:M.rawResponse)||a})]})]})]}),c&&e.jsxs("details",{className:"bg-rose-50 border-2 border-rose-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-rose-800 hover:text-rose-900 flex items-center gap-2",children:[e.jsx(Ar,{size:20}),n==="de"?"Visual Bible (Wiederkehrende Elemente)":n==="fr"?"Bible Visuelle (√âl√©ments R√©currents)":"Visual Bible (Recurring Elements)",c.changeLog&&c.changeLog.length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-rose-200 text-rose-800 rounded-full text-xs font-medium",children:[c.changeLog.length," ",n==="de"?"√Ñnderungen":n==="fr"?"changements":"changes"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[c.mainCharacters&&c.mainCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-purple-300 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-purple-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üëó"}),n==="de"?"Hauptcharaktere (Style Profile)":n==="fr"?"Personnages Principaux (Profil Style)":"Main Characters (Style Profile)"]}),e.jsx("div",{className:"space-y-3",children:c.mainCharacters.map(r=>{var E,k,u,Q;return e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-sm",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-800 hover:text-purple-900",children:[r.name,Object.keys(r.generatedOutfits||{}).length>0&&e.jsxs("span",{className:"ml-2 px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:[Object.keys(r.generatedOutfits).length," ",n==="de"?"Outfits":n==="fr"?"tenues":"outfits"]})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Physical:"}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[((E=r.physical)==null?void 0:E.face)||"Not analyzed"," | ",((k=r.physical)==null?void 0:k.hair)||"N/A"," | ",((u=r.physical)==null?void 0:u.build)||"N/A",((Q=r.physical)==null?void 0:Q.other)&&` | ${r.physical.other}`]})]}),r.generatedOutfits&&Object.keys(r.generatedOutfits).length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-200",children:[e.jsx("span",{className:"font-medium text-gray-600 text-xs",children:"Generated Outfits:"}),e.jsx("div",{className:"mt-1 space-y-1",children:Object.entries(r.generatedOutfits).map(([de,ke])=>{var V;return e.jsxs("div",{className:"bg-white p-1.5 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-purple-600",children:["Page ",de,":"]}),e.jsxs("span",{className:"text-gray-700 ml-1",children:[(V=ke.outfit)==null?void 0:V.substring(0,80),"..."]}),e.jsx("span",{className:`ml-1 px-1 py-0.5 rounded text-[10px] ${ke.setting==="outdoor-cold"?"bg-blue-100 text-blue-700":ke.setting==="outdoor-warm"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:ke.setting})]},de)})})]})]})]},r.id)})})]}),c.secondaryCharacters&&c.secondaryCharacters.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:n==="de"?"Nebencharaktere":n==="fr"?"Personnages Secondaires":"Secondary Characters"}),e.jsx("div",{className:"space-y-2",children:c.secondaryCharacters.map(r=>{var E;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[r.name,r.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:r.id}),r.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:r.source==="outline"?"Outline":"Story"}),((E=r.appearsInPages)==null?void 0:E.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",r.appearsInPages.join(", "),")"]})]}),(Z==null?void 0:Z.type)==="secondaryCharacter"&&(Z==null?void 0:Z.id)===r.id&&(Z==null?void 0:Z.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:xe,onChange:k=>se(k.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Te,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(pt,{size:12})," Save"]}),e.jsxs("button",{onClick:et,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(ot,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:r.description}),re&&ae&&e.jsx("button",{onClick:()=>We("secondaryCharacter",r.id,"description",r.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(Me,{size:12})})]}),r.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",r.extractedDescription]})]},r.id)})})]}),c.animals.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:n==="de"?"Tiere & Wesen":n==="fr"?"Animaux & Cr√©atures":"Animals & Creatures"}),e.jsx("div",{className:"space-y-2",children:c.animals.map(r=>{var E;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[r.name,r.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:r.id}),r.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:r.source==="outline"?"Outline":"Story"}),((E=r.appearsInPages)==null?void 0:E.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",r.appearsInPages.join(", "),")"]})]}),(Z==null?void 0:Z.type)==="animal"&&(Z==null?void 0:Z.id)===r.id&&(Z==null?void 0:Z.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:xe,onChange:k=>se(k.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Te,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(pt,{size:12})," Save"]}),e.jsxs("button",{onClick:et,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(ot,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:r.description}),re&&ae&&e.jsx("button",{onClick:()=>We("animal",r.id,"description",r.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(Me,{size:12})})]}),r.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",r.extractedDescription]})]},r.id)})})]}),c.artifacts.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:n==="de"?"Artefakte & Objekte":n==="fr"?"Artefacts & Objets":"Artifacts & Objects"}),e.jsx("div",{className:"space-y-2",children:c.artifacts.map(r=>{var E;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[r.name,r.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:r.id}),r.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:r.source==="outline"?"Outline":"Story"}),((E=r.appearsInPages)==null?void 0:E.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",r.appearsInPages.join(", "),")"]})]}),(Z==null?void 0:Z.type)==="artifact"&&(Z==null?void 0:Z.id)===r.id&&(Z==null?void 0:Z.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:xe,onChange:k=>se(k.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Te,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(pt,{size:12})," Save"]}),e.jsxs("button",{onClick:et,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(ot,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:r.description}),re&&ae&&e.jsx("button",{onClick:()=>We("artifact",r.id,"description",r.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(Me,{size:12})})]}),r.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",r.extractedDescription]})]},r.id)})})]}),c.locations.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:n==="de"?"Wiederkehrende Orte":n==="fr"?"Lieux R√©currents":"Recurring Locations"}),e.jsx("div",{className:"space-y-2",children:c.locations.map(r=>{var E;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[r.name,r.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:r.id}),r.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:r.source==="outline"?"Outline":"Story"}),((E=r.appearsInPages)==null?void 0:E.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",r.appearsInPages.join(", "),")"]})]}),(Z==null?void 0:Z.type)==="location"&&(Z==null?void 0:Z.id)===r.id&&(Z==null?void 0:Z.field)==="description"?e.jsxs("div",{className:"mt-1",children:[e.jsx("textarea",{value:xe,onChange:k=>se(k.target.value),className:"w-full p-2 text-xs border border-rose-300 rounded resize-y min-h-[60px]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{onClick:Te,className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 flex items-center gap-1",children:[e.jsx(pt,{size:12})," Save"]}),e.jsxs("button",{onClick:et,className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500 flex items-center gap-1",children:[e.jsx(ot,{size:12})," Cancel"]})]})]}):e.jsxs("div",{className:"text-gray-700 text-xs mt-1 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:r.description}),re&&ae&&e.jsx("button",{onClick:()=>We("location",r.id,"description",r.description),className:"p-1 text-rose-500 hover:text-rose-700 hover:bg-rose-100 rounded",title:"Edit description",children:e.jsx(Me,{size:12})})]}),r.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",r.extractedDescription]})]},r.id)})})]}),c.vehicles&&c.vehicles.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:n==="de"?"Fahrzeuge":n==="fr"?"V√©hicules":"Vehicles"}),e.jsx("div",{className:"space-y-2",children:c.vehicles.map(r=>{var E;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[r.name,r.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:r.id}),r.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:r.source==="outline"?"Outline":"Story"}),((E=r.appearsInPages)==null?void 0:E.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",r.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:r.description}),r.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",r.extractedDescription]})]},r.id)})})]}),c.clothing&&c.clothing.length>0&&e.jsxs("div",{className:"bg-white border border-rose-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-rose-700 mb-2",children:n==="de"?"Kleidung & Kost√ºme":n==="fr"?"V√™tements & Costumes":"Clothing & Costumes"}),e.jsx("div",{className:"space-y-2",children:c.clothing.map(r=>{var E;return e.jsxs("div",{className:"bg-rose-50 p-2 rounded text-sm",children:[e.jsxs("div",{className:"font-semibold text-rose-800 flex items-center gap-2",children:[r.name,r.id&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 font-mono",children:r.id}),r.wornBy&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-100 text-purple-700",children:["worn by ",r.wornBy]}),r.source&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.source==="outline"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:r.source==="outline"?"Outline":"Story"}),((E=r.appearsInPages)==null?void 0:E.length)>0&&e.jsxs("span",{className:"text-xs text-rose-600",children:["(Pages: ",r.appearsInPages.join(", "),")"]})]}),e.jsx("div",{className:"text-gray-700 text-xs mt-1",children:r.description}),r.extractedDescription&&e.jsxs("div",{className:"text-green-700 text-xs mt-1 bg-green-50 p-1 rounded",children:[e.jsx("span",{className:"font-semibold",children:"Extracted:"})," ",r.extractedDescription]})]},r.id)})})]}),c.changeLog&&c.changeLog.length>0&&e.jsxs("details",{className:"bg-white border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-bold text-amber-700 hover:text-amber-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üìù"}),n==="de"?"√Ñnderungsprotokoll":n==="fr"?"Journal des Modifications":"Change Log",e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-amber-100 text-amber-700 rounded text-xs",children:c.changeLog.length})]}),e.jsx("div",{className:"mt-2 space-y-1 max-h-64 overflow-y-auto",children:c.changeLog.slice().reverse().map((r,E)=>{var k;return e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs border-l-2 border-amber-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium ${r.type==="mainCharacter"?"bg-purple-100 text-purple-700":r.type==="secondaryCharacter"?"bg-rose-100 text-rose-700":r.type==="generatedOutfit"?"bg-green-100 text-green-700":r.type==="animal"?"bg-orange-100 text-orange-700":r.type==="artifact"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:r.type}),e.jsx("span",{className:"font-semibold text-amber-800",children:r.element}),e.jsxs("span",{className:"text-gray-500",children:[ne==="de"?"Seite":"Page"," ",r.page]})]}),e.jsxs("div",{className:"mt-1 text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:[r.change,":"]}),e.jsxs("span",{className:"ml-1 text-gray-700",children:[(k=r.after)==null?void 0:k.substring(0,100),r.after&&r.after.length>100?"...":""]})]}),r.before&&e.jsxs("div",{className:"text-gray-400 line-through text-[10px] mt-0.5",children:[n==="de"?"Vorher":n==="fr"?"Avant":"Before",": ",r.before.substring(0,50),"..."]}),e.jsx("div",{className:"text-gray-400 text-[10px] mt-0.5",children:new Date(r.timestamp).toLocaleTimeString()})]},E)})})]}),(!c.mainCharacters||c.mainCharacters.length===0)&&(!c.secondaryCharacters||c.secondaryCharacters.length===0)&&(!c.animals||c.animals.length===0)&&(!c.artifacts||c.artifacts.length===0)&&(!c.locations||c.locations.length===0)&&(!c.vehicles||c.vehicles.length===0)&&(!c.clothing||c.clothing.length===0)&&e.jsx("div",{className:"text-gray-500 text-sm italic",children:n==="de"?"Keine wiederkehrenden Elemente gefunden":n==="fr"?"Aucun √©l√©ment r√©current trouv√©":"No recurring elements found in this story"})]})]}),me&&me.length>0&&e.jsxs("details",{className:"bg-pink-50 border-2 border-pink-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-pink-800 hover:text-pink-900 flex items-center gap-2",children:[e.jsx(ur,{size:20}),n==="de"?`Stilisierte Avatare (${me.length})`:n==="fr"?`Avatars stylis√©s (${me.length})`:`Styled Avatars (${me.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:me.map((r,E)=>{var k,u;return e.jsxs("details",{className:`border rounded-lg p-3 ${r.success?"bg-white border-pink-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-pink-700 hover:text-pink-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${r.success?"bg-green-500":"bg-red-500"}`}),r.characterName," - ",r.artStyle,e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(r.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Face Photo"}),(k=r.inputs.facePhoto)!=null&&k.imageData?e.jsx("img",{src:r.inputs.facePhoto.imageData,alt:"Face",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>$e({src:r.inputs.facePhoto.imageData,title:"Face Photo"}),title:`${r.inputs.facePhoto.sizeKB} KB - Click to enlarge`}):r.inputs.facePhoto?e.jsxs("span",{className:"text-blue-600 text-[10px]",children:[r.inputs.facePhoto.sizeKB," KB"]}):e.jsx("span",{className:"text-gray-400 italic text-[10px]",children:"N/A"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Original Avatar"}),(u=r.inputs.originalAvatar)!=null&&u.imageData?e.jsx("img",{src:r.inputs.originalAvatar.imageData,alt:"Avatar",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>$e({src:r.inputs.originalAvatar.imageData,title:"Original Avatar"}),title:`${r.inputs.originalAvatar.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-blue-600 text-[10px]",children:[r.inputs.originalAvatar.sizeKB," KB"]})]})]})]}),r.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",r.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-48 overflow-y-auto",children:r.prompt})]}),r.success&&r.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2 flex flex-col items-start",children:r.output.imageData?e.jsx("img",{src:r.output.imageData,alt:"Output",className:"w-24 h-24 object-cover rounded border border-green-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>$e({src:r.output.imageData,title:"Styled Avatar Output"}),title:`${r.output.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-green-600",children:[r.output.sizeKB," KB"]})})]}),!r.success&&r.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:r.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(r.timestamp).toLocaleString()]})]})]},E)})})]}),ue&&ue.length>0&&e.jsxs("details",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-orange-800 hover:text-orange-900 flex items-center gap-2",children:[e.jsx(ur,{size:20}),n==="de"?`Kost√ºm-Avatare (${ue.length})`:n==="fr"?`Avatars costum√©s (${ue.length})`:`Costumed Avatars (${ue.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:ue.map((r,E)=>{var k,u,Q;return e.jsxs("details",{className:`border rounded-lg p-3 ${r.success?"bg-white border-orange-200":"bg-red-50 border-red-300"}`,children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 hover:text-orange-800 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${r.success?"bg-green-500":"bg-red-500"}`}),r.characterName," - ",r.costumeType," (",r.artStyle,")",e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(r.durationMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[r.costumeDescription&&e.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-yellow-700",children:"Costume:"}),e.jsx("p",{className:"mt-1 text-gray-700",children:r.costumeDescription})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Inputs:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Face Photo"}),(k=r.inputs.facePhoto)!=null&&k.imageData?e.jsx("img",{src:r.inputs.facePhoto.imageData,alt:"Face",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>$e({src:r.inputs.facePhoto.imageData,title:"Face Photo"}),title:`${r.inputs.facePhoto.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-blue-600 text-[10px]",children:[((u=r.inputs.facePhoto)==null?void 0:u.sizeKB)||0," KB"]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mb-1",children:"Standard Avatar"}),(Q=r.inputs.standardAvatar)!=null&&Q.imageData?e.jsx("img",{src:r.inputs.standardAvatar.imageData,alt:"Avatar",className:"w-16 h-16 object-cover rounded border border-blue-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>$e({src:r.inputs.standardAvatar.imageData,title:"Standard Avatar"}),title:`${r.inputs.standardAvatar.sizeKB} KB - Click to enlarge`}):e.jsx("span",{className:"text-gray-400 italic text-[10px]",children:"N/A"})]})]})]}),r.prompt&&e.jsxs("details",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-purple-700 hover:text-purple-800",children:["Prompt (",r.prompt.length," chars)"]}),e.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap text-[10px] max-h-48 overflow-y-auto",children:r.prompt})]}),r.success&&r.output&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Output:"}),e.jsx("div",{className:"mt-2 flex flex-col items-start",children:r.output.imageData?e.jsx("img",{src:r.output.imageData,alt:"Output",className:"w-24 h-24 object-cover rounded border border-green-300 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>$e({src:r.output.imageData,title:"Costumed Avatar Output"}),title:`${r.output.sizeKB} KB - Click to enlarge`}):e.jsxs("span",{className:"text-green-600",children:[r.output.sizeKB," KB"]})})]}),!r.success&&r.error&&e.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Error:"}),e.jsx("p",{className:"mt-1 text-red-600",children:r.error})]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Generated: ",new Date(r.timestamp).toLocaleString()]})]})]},E)})})]}),W&&W.length>0&&e.jsxs("details",{className:"bg-slate-50 border-2 border-slate-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-slate-800 hover:text-slate-900 flex items-center gap-2",children:[e.jsx(dr,{size:20}),n==="de"?`Generierungslog (${W.length})`:n==="fr"?`Journal de g√©n√©ration (${W.length})`:`Generation Log (${W.length})`,W.filter(r=>r.level==="warn").length>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-yellow-200 text-yellow-800 text-xs rounded-full",children:[W.filter(r=>r.level==="warn").length," warnings"]}),W.filter(r=>r.level==="error").length>0&&e.jsxs("span",{className:"ml-1 px-2 py-0.5 bg-red-200 text-red-800 text-xs rounded-full",children:[W.filter(r=>r.level==="error").length," errors"]})]}),e.jsx("div",{className:"mt-4 space-y-1 max-h-96 overflow-y-auto",children:W.map((r,E)=>e.jsxs("div",{className:`text-xs p-2 rounded flex items-start gap-2 ${r.level==="error"?"bg-red-50 text-red-800":r.level==="warn"?"bg-yellow-50 text-yellow-800":r.level==="debug"?"bg-gray-50 text-gray-600":"bg-white text-slate-700"}`,children:[e.jsx("span",{className:"text-gray-400 font-mono text-[10px] whitespace-nowrap",children:new Date(r.timestamp).toLocaleTimeString()}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium whitespace-nowrap ${r.stage==="outline"?"bg-blue-100 text-blue-700":r.stage==="avatars"?"bg-purple-100 text-purple-700":r.stage==="scenes"?"bg-green-100 text-green-700":r.stage==="images"?"bg-orange-100 text-orange-700":r.stage==="covers"?"bg-pink-100 text-pink-700":"bg-gray-100 text-gray-700"}`,children:r.stage}),r.character&&e.jsxs("span",{className:"font-medium text-slate-600",children:["[",r.character,"]"]}),e.jsx("span",{className:"flex-1",children:r.message}),e.jsx("span",{className:"text-gray-400 text-[10px]",children:r.event})]},E))})]}),v.length>0&&e.jsxs("details",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-4",children:[e.jsxs("summary",{className:"cursor-pointer text-lg font-bold text-green-800 hover:text-green-900 flex items-center gap-2",children:[e.jsx(dr,{size:20}),n==="de"?`Alle Szenenbeschreibungen (${v.length})`:n==="fr"?`Toutes les descriptions de sc√®nes (${v.length})`:`All Scene Descriptions (${v.length})`]}),e.jsx("div",{className:"mt-4 space-y-4",children:v.map(r=>e.jsxs("details",{className:"bg-white border border-green-200 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-700 hover:text-green-800",children:ne==="de"?`Seite ${r.pageNumber}`:ne==="fr"?`Page ${r.pageNumber}`:`Page ${r.pageNumber}`}),e.jsxs("div",{className:"mt-2 space-y-2",children:[r.outlineExtract&&e.jsxs("div",{className:"bg-amber-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-amber-700",children:"Outline Extract:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:r.outlineExtract})]}),r.scenePrompt&&e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-purple-700",children:"Scene Prompt:"}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:r.scenePrompt})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"font-semibold text-green-700",children:"Scene Description:"}),r.textModelId&&e.jsxs("span",{className:"ml-2 text-green-600",children:["(",r.textModelId,")"]}),e.jsx("p",{className:"text-gray-700 mt-1 whitespace-pre-wrap",children:r.description})]})]})]},r.pageNumber))})]})]}),$&&Oe($.frontCover)&&(()=>{const r=Bt($.frontCover);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:ne==="de"?"Titelseite":ne==="fr"?"Couverture":"Front Cover"}),e.jsx(Sr,{src:Oe($.frontCover),alt:"Front Cover",className:"w-full rounded-lg shadow-lg",label:"Front Cover"}),z&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>z("front"),disabled:y||!fe,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y||!fe?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:fe?"":n==="de"?"Nicht genug Credits":n==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(It,{size:14}),n==="de"?"Bild neu generieren":n==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Pe," ",n==="de"?"Credits":"credits",")"]})]})}),re&&r&&e.jsxs("div",{className:"mt-3 space-y-2",children:[_&&e.jsxs("button",{onClick:()=>_("front"),disabled:y,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Me,{size:14})," ",n==="de"?"Bearbeiten":"Edit"]}),r.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:n==="de"?"Szenenbeschreibung":n==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:r.description})]}),r.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[n==="de"?"API-Prompt":n==="fr"?"Prompt API":"API Prompt",r.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:r.prompt})]}),r.referencePhotos&&r.referencePhotos.length>0&&e.jsx(mr,{referencePhotos:r.referencePhotos,language:n}),r.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[n==="de"?"Qualit√§tsbewertung":n==="fr"?"Score de qualit√©":"Quality Score",r.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${r.qualityScore>=70?"text-green-600":r.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(r.qualityScore),"%"]})]}),r.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:n==="de"?"Feedback:":n==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),r.retryHistory&&r.retryHistory.length>0&&e.jsx(cr,{retryHistory:r.retryHistory,totalAttempts:r.totalAttempts||r.retryHistory.length,language:n})]})]})})(),$&&Oe($.initialPage)&&(()=>{const r=Bt($.initialPage);return e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:ne==="de"?"Widmungsseite":ne==="fr"?"Page de d√©dicace":"Dedication Page"}),e.jsx(Sr,{src:Oe($.initialPage),alt:"Dedication Page",className:"w-full rounded-lg shadow-lg",label:"Dedication Page"}),z&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>z("initial"),disabled:y||!fe,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y||!fe?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:fe?"":n==="de"?"Nicht genug Credits":n==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(It,{size:14}),n==="de"?"Bild neu generieren":n==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Pe," ",n==="de"?"Credits":"credits",")"]})]})}),re&&r&&e.jsxs("div",{className:"mt-3 space-y-2",children:[_&&e.jsxs("button",{onClick:()=>_("initial"),disabled:y,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Me,{size:14})," ",n==="de"?"Bearbeiten":"Edit"]}),r.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:n==="de"?"Szenenbeschreibung":n==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:r.description})]}),r.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[n==="de"?"API-Prompt":n==="fr"?"Prompt API":"API Prompt",r.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:r.prompt})]}),r.referencePhotos&&r.referencePhotos.length>0&&e.jsx(mr,{referencePhotos:r.referencePhotos,language:n}),r.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[n==="de"?"Qualit√§tsbewertung":n==="fr"?"Score de qualit√©":"Quality Score",r.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${r.qualityScore>=70?"text-green-600":r.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(r.qualityScore),"%"]})]}),r.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:n==="de"?"Feedback:":n==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),r.retryHistory&&r.retryHistory.length>0&&e.jsx(cr,{retryHistory:r.retryHistory,totalAttempts:r.totalAttempts||r.retryHistory.length,language:n})]})]})})(),oe&&!a&&($==null?void 0:$.frontCover)&&e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-8 mt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-indigo-700",children:ne==="de"?"Geschichte wird erstellt...":ne==="fr"?"Cr√©ation de l'histoire...":"Creating your story..."}),e.jsx("p",{className:"text-indigo-500 mt-2",children:ne==="de"?"Die Seiten werden gleich angezeigt":ne==="fr"?"Les pages seront bient√¥t affich√©es":"Pages will appear shortly"})]})}),tt&&a&&e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 text-center mb-6",children:t||(ne==="de"?"Ihre Geschichte":ne==="fr"?"Votre histoire":"Your Story")}),Fe.slice(0,oe?_e:Fe.length).map((r,E)=>{const k=E+1,u=f.find(V=>V.pageNumber===k),Q=oe?ye[k]:void 0,de=!!(u!=null&&u.imageData||Q),ke=oe&&k===_e&&!de;return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-4 text-center",children:ne==="de"?`Seite ${k}`:ne==="fr"?`Page ${k}`:`Page ${k}`}),Ge?e.jsxs("div",{className:"flex flex-col items-center max-w-2xl mx-auto",children:[ke?e.jsxs("div",{className:"w-full mb-4 aspect-[4/3] bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg shadow-md flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-600 font-medium",children:ne==="de"?"Bild wird erstellt...":ne==="fr"?"Cr√©ation de l'image...":"Creating image..."}),e.jsx("p",{className:"text-indigo-400 text-sm mt-1",children:ne==="de"?"Die n√§chste Seite erscheint bald":ne==="fr"?"La page suivante arrive bient√¥t":"Next page coming soon"})]}):u!=null&&u.imageData||Q?e.jsxs("div",{className:"w-full mb-4",children:[e.jsx(Sr,{src:((u==null?void 0:u.imageData)||Q)??"",alt:`Scene for page ${k}`,className:"w-full rounded-lg shadow-md object-cover",label:`Page ${k}`}),H&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>Ve(k),disabled:y||ct||!fe,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y||ct||!fe?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:fe?"":n==="de"?"Nicht genug Credits":n==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(It,{size:14}),n==="de"?"Bild neu generieren":n==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Pe," ",n==="de"?"Credits":"credits",")"]})]}),L&&e.jsxs("button",{onClick:()=>rt(!0),disabled:y,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Me,{size:14}),n==="de"?"Text bearbeiten":n==="fr"?"Modifier le texte":"Edit Text"]}),Ze(k).length>1&&e.jsxs("button",{onClick:()=>wt({pageNumber:k,versions:Ze(k)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(ur,{size:14}),Ze(k).length]})]})}),re&&e.jsxs("div",{className:"mt-3 space-y-2",children:[J&&e.jsxs("button",{onClick:()=>J(k),disabled:y,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Me,{size:14})," ",n==="de"?"Bearbeiten":"Edit"]}),F&&e.jsx("button",{onClick:()=>qt(k),disabled:y||Se!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y||Se!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:n==="de"?"Physik-Fehler automatisch erkennen und reparieren":n==="fr"?"D√©tecter et r√©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:Se===k?e.jsxs(e.Fragment,{children:[e.jsx(Or,{size:14,className:"animate-spin"}),n==="de"?"Repariere...":n==="fr"?"R√©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(wr,{size:14}),n==="de"?"Auto-Reparatur":n==="fr"?"Auto-R√©paration":"Auto-Repair"]})}),(u==null?void 0:u.repairHistory)&&u.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(wr,{size:14}),n==="de"?"Reparatur-Historie":n==="fr"?"Historique de r√©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",u.repairHistory.length," ",n==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:u.repairHistory.map((V,Ne)=>e.jsxs("div",{className:`border rounded-lg p-3 ${V.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[n==="de"?`Reparatur ${V.attempt}`:`Repair ${V.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${V.success?"text-green-600":"text-red-600"}`,children:["(",V.success?"‚úì":"‚úó"," ",V.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:V.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:n==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:n==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",V.fixPrompt]}),V.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:n==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:V.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),V.beforeImage&&V.afterImage&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:n==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:V.beforeImage,alt:"Before repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>$e({src:V.beforeImage,title:n==="de"?"Vorher":"Before"}),title:n==="de"?"Klicken zum Vergr√∂√üern":"Click to enlarge"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:n==="de"?"Nachher:":"After:"}),e.jsx("img",{src:V.afterImage,alt:"After repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>$e({src:V.afterImage,title:n==="de"?"Nachher":"After"}),title:n==="de"?"Klicken zum Vergr√∂√üern":"Click to enlarge"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(V.timestamp).toLocaleTimeString()})]},Ne))})]}),kt(k)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:n==="de"?"Auszug aus Gliederung":n==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:kt(k)})]}),Ct(k)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:n==="de"?"Szenen-Prompt":n==="fr"?"Prompt de sc√®ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-64 overflow-y-auto",children:Ct(k)})]}),ut(k)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[n==="de"?"Szenenbeschreibung":n==="fr"?"Description de sc√®ne":"Scene Description",Re(k)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",Re(k),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:ut(k)})]}),(u==null?void 0:u.prompt)&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[n==="de"?"API-Prompt":n==="fr"?"Prompt API":"API Prompt",(u==null?void 0:u.modelId)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",u.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:u==null?void 0:u.prompt})]}),(u==null?void 0:u.referencePhotos)&&u.referencePhotos.length>0&&e.jsx(mr,{referencePhotos:u.referencePhotos,language:n}),(u==null?void 0:u.qualityScore)!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[n==="de"?"Qualit√§tsbewertung":n==="fr"?"Score de qualit√©":"Quality Score",(u==null?void 0:u.qualityModelId)&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",u.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${((u==null?void 0:u.qualityScore)??0)>=70?"text-green-600":((u==null?void 0:u.qualityScore)??0)>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round((u==null?void 0:u.qualityScore)??0),"%"]})]}),(u==null?void 0:u.qualityReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:n==="de"?"Feedback:":n==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:u.qualityReasoning})]})]}),(u==null?void 0:u.retryHistory)&&u.retryHistory.length>0&&e.jsx(cr,{retryHistory:u.retryHistory,totalAttempts:(u==null?void 0:u.totalAttempts)||u.retryHistory.length,language:n}),(u==null?void 0:u.wasRegenerated)&&(!(u!=null&&u.retryHistory)||u.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["üîÑ ",n==="de"?"Bild regeneriert":n==="fr"?"Image r√©g√©n√©r√©e":"Image Regenerated"]}),(u==null?void 0:u.originalScore)!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(u.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:n==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige Qualit√§t hatte.":n==="fr"?"L'image a √©t√© automatiquement r√©g√©n√©r√©e car la premi√®re version avait une qualit√© faible.":"Image was automatically regenerated because the first version had low quality."}),(u==null?void 0:u.originalImage)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:n==="de"?"Originalbild:":n==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:u.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),(u==null?void 0:u.originalReasoning)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:n==="de"?"Original Feedback:":n==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:u.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`w-full flex flex-col items-center justify-center rounded-lg p-8 mb-4 ${y?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:ne==="de"?"Bild wird noch erstellt...":ne==="fr"?"Image en cours de cr√©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:ne==="de"?"Kein Bild f√ºr diese Seite":ne==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"w-full bg-indigo-50 rounded-lg p-6 border-2 border-indigo-200",children:ie?e.jsx("textarea",{value:r.trim(),onChange:V=>it(E,V.target.value),className:"w-full min-h-[400px] p-3 text-gray-800 leading-snug font-serif text-xl text-center bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:n==="de"?"Text eingeben...":n==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl text-center",children:r.trim()})})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 items-stretch",children:[u&&u.imageData?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("img",{src:u.imageData,alt:`Scene for page ${k}`,className:"w-full rounded-lg shadow-md object-cover"}),H&&e.jsx("div",{className:"mt-3 space-y-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{onClick:()=>Ve(k),disabled:y||ct||!fe,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y||ct||!fe?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:fe?"":n==="de"?"Nicht genug Credits":n==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(It,{size:14}),n==="de"?"Bild neu generieren":n==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Pe," ",n==="de"?"Credits":"credits",")"]})]}),L&&e.jsxs("button",{onClick:()=>rt(!0),disabled:y,className:`flex-1 bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Me,{size:14}),n==="de"?"Text bearbeiten":n==="fr"?"Modifier le texte":"Edit Text"]}),Ze(k).length>1&&e.jsxs("button",{onClick:()=>wt({pageNumber:k,versions:Ze(k)}),className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(ur,{size:14}),Ze(k).length]})]})}),re&&e.jsxs("div",{className:"mt-3 space-y-2",children:[J&&e.jsxs("button",{onClick:()=>J(k),disabled:y,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Me,{size:14})," ",n==="de"?"Bearbeiten":"Edit"]}),F&&e.jsx("button",{onClick:()=>qt(k),disabled:y||Se!==null,className:`w-full bg-amber-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y||Se!==null?"opacity-50 cursor-not-allowed":"hover:bg-amber-600"}`,title:n==="de"?"Physik-Fehler automatisch erkennen und reparieren":n==="fr"?"D√©tecter et r√©parer automatiquement les erreurs physiques":"Automatically detect and fix physics errors",children:Se===k?e.jsxs(e.Fragment,{children:[e.jsx(Or,{size:14,className:"animate-spin"}),n==="de"?"Repariere...":n==="fr"?"R√©paration...":"Repairing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(wr,{size:14}),n==="de"?"Auto-Reparatur":n==="fr"?"Auto-R√©paration":"Auto-Repair"]})}),(u==null?void 0:u.repairHistory)&&u.repairHistory.length>0&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900 flex items-center gap-2",children:[e.jsx(wr,{size:14}),n==="de"?"Reparatur-Historie":n==="fr"?"Historique de r√©paration":"Repair History",e.jsxs("span",{className:"text-amber-600 font-normal",children:["(",u.repairHistory.length," ",n==="de"?"Reparaturen":"repairs",")"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:u.repairHistory.map((V,Ne)=>e.jsxs("div",{className:`border rounded-lg p-3 ${V.success?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"font-semibold text-sm",children:[n==="de"?`Reparatur ${V.attempt}`:`Repair ${V.attempt}`,e.jsxs("span",{className:`ml-2 text-xs ${V.success?"text-green-600":"text-red-600"}`,children:["(",V.success?"‚úì":"‚úó"," ",V.errorType,")"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:V.description}),e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-amber-700",children:n==="de"?"Details anzeigen":"Show details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"bg-white p-2 rounded border",children:[e.jsx("strong",{children:n==="de"?"Fix-Anweisung:":"Fix instruction:"})," ",V.fixPrompt]}),V.maskImage&&e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1",children:n==="de"?"Maske:":"Mask:"}),e.jsx("img",{src:V.maskImage,alt:"Repair mask",className:"w-32 h-32 object-contain border rounded"})]}),V.beforeImage&&V.afterImage&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:n==="de"?"Vorher:":"Before:"}),e.jsx("img",{src:V.beforeImage,alt:"Before repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>$e({src:V.beforeImage,title:n==="de"?"Vorher":"Before"}),title:n==="de"?"Klicken zum Vergr√∂√üern":"Click to enlarge"})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-xs",children:n==="de"?"Nachher:":"After:"}),e.jsx("img",{src:V.afterImage,alt:"After repair",className:"w-48 h-48 object-contain border rounded bg-gray-100 cursor-pointer hover:opacity-80 hover:ring-2 hover:ring-amber-400",onClick:()=>$e({src:V.afterImage,title:n==="de"?"Nachher":"After"}),title:n==="de"?"Klicken zum Vergr√∂√üern":"Click to enlarge"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(V.timestamp).toLocaleTimeString()})]},Ne))})]}),kt(k)&&e.jsxs("details",{className:"bg-amber-50 border border-amber-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-amber-800 hover:text-amber-900",children:n==="de"?"Auszug aus Gliederung":n==="fr"?"Extrait du plan":"Outline Extract"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:kt(k)})]}),Ct(k)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-purple-800 hover:text-purple-900",children:n==="de"?"Szenen-Prompt":n==="fr"?"Prompt de sc√®ne":"Scene Prompt"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-64 overflow-y-auto",children:Ct(k)})]}),ut(k)&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:[n==="de"?"Szenenbeschreibung":n==="fr"?"Description de sc√®ne":"Scene Description",Re(k)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-green-600",children:["(",Re(k),")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:ut(k)})]}),u.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[n==="de"?"API-Prompt":n==="fr"?"Prompt API":"API Prompt",u.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",u.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:u.prompt})]}),u.referencePhotos&&u.referencePhotos.length>0&&e.jsx(mr,{referencePhotos:u.referencePhotos,language:n}),u.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[n==="de"?"Qualit√§tsbewertung":n==="fr"?"Score de qualit√©":"Quality Score",u.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",u.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${u.qualityScore>=70?"text-green-600":u.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(u.qualityScore),"%"]})]}),u.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:n==="de"?"Feedback:":n==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:u.qualityReasoning})]})]}),u.retryHistory&&u.retryHistory.length>0&&e.jsx(cr,{retryHistory:u.retryHistory,totalAttempts:u.totalAttempts||u.retryHistory.length,language:n}),u.wasRegenerated&&(!u.retryHistory||u.retryHistory.length===0)&&e.jsxs("details",{className:"bg-orange-50 border border-orange-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-orange-700 flex items-center justify-between",children:[e.jsxs("span",{children:["üîÑ ",n==="de"?"Bild regeneriert":n==="fr"?"Image r√©g√©n√©r√©e":"Image Regenerated"]}),u.originalScore!==void 0&&e.jsxs("span",{className:"text-red-600",children:["Original: ",Math.round(u.originalScore),"%"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:n==="de"?"Das Bild wurde automatisch regeneriert, da die erste Version eine niedrige Qualit√§t hatte.":n==="fr"?"L'image a √©t√© automatiquement r√©g√©n√©r√©e car la premi√®re version avait une qualit√© faible.":"Image was automatically regenerated because the first version had low quality."}),u.originalImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:n==="de"?"Originalbild:":n==="fr"?"Image originale:":"Original Image:"}),e.jsx("img",{src:u.originalImage,alt:"Original (lower quality)",className:"w-full rounded border-2 border-orange-200 opacity-75"}),u.originalReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-semibold mb-1",children:n==="de"?"Original Feedback:":n==="fr"?"Retour original:":"Original Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:u.originalReasoning})]})]})]})]})]})]}):e.jsx("div",{className:`flex flex-col items-center justify-center rounded-lg p-8 ${y?"bg-gradient-to-br from-indigo-100 to-purple-100":"bg-gray-100"}`,children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-600 font-medium text-center",children:ne==="de"?"Bild wird noch erstellt...":ne==="fr"?"Image en cours de cr√©ation...":"Image is being created..."})]}):e.jsx("p",{className:"text-gray-500 text-center",children:ne==="de"?"Kein Bild f√ºr diese Seite":ne==="fr"?"Pas d'image pour cette page":"No image for this page"})}),e.jsx("div",{className:"flex flex-col w-full h-full",children:ie?e.jsx("textarea",{value:r.trim(),onChange:V=>it(E,V.target.value),className:"w-full flex-1 min-h-[300px] p-4 text-gray-800 leading-snug font-serif text-xl bg-white border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none resize-y",placeholder:n==="de"?"Text eingeben...":n==="fr"?"Entrez le texte...":"Enter text..."}):e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-gray-800 leading-snug whitespace-pre-wrap font-serif text-xl",children:r.trim()})})})]})]},k)}),oe&&_e<Be&&Object.keys(ye).length<Be&&e.jsx("div",{className:"p-6 text-center",children:e.jsxs("div",{className:"inline-flex flex-col items-center bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6 shadow-sm",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-3"}),e.jsx("p",{className:"text-indigo-700 font-semibold",children:ne==="de"?`Seite ${_e} von ${Be}`:ne==="fr"?`Page ${_e} sur ${Be}`:`Page ${_e} of ${Be}`}),e.jsx("p",{className:"text-indigo-500 text-sm mt-1",children:ne==="de"?"Weitere Seiten werden geladen...":ne==="fr"?"Chargement des pages suivantes...":"Loading more pages..."})]})})]}),y&&a&&f.filter(r=>r.imageData).length<Fe.length&&e.jsx("div",{className:"mt-8 max-w-2xl mx-auto",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 border-dashed rounded-xl p-8",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-300 border-t-indigo-600 mb-4"}),e.jsx("p",{className:"text-indigo-700 font-semibold",children:ne==="de"?"Weitere Seiten werden erstellt...":ne==="fr"?"Cr√©ation des pages suivantes...":"Creating more pages..."})]})})}),$&&Oe($.backCover)&&(()=>{const r=Bt($.backCover);return e.jsxs("div",{className:"mt-8 max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:ne==="de"?"R√ºckseite":ne==="fr"?"Quatri√®me de couverture":"Back Cover"}),e.jsx(Sr,{src:Oe($.backCover),alt:"Back Cover",className:"w-full rounded-lg shadow-lg",label:"Back Cover"}),z&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>z("back"),disabled:y||!fe,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y||!fe?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,title:fe?"":n==="de"?"Nicht genug Credits":n==="fr"?"Pas assez de cr√©dits":"Not enough credits",children:[e.jsx(It,{size:14}),n==="de"?"Bild neu generieren":n==="fr"?"R√©g√©n√©rer l'image":"Regenerate Image",e.jsxs("span",{className:"text-xs opacity-80",children:["(",Pe," ",n==="de"?"Credits":"credits",")"]})]})}),re&&r&&e.jsxs("div",{className:"mt-3 space-y-2",children:[_&&e.jsxs("button",{onClick:()=>_("back"),disabled:y,className:`w-full bg-indigo-500 text-white px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm font-semibold ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Me,{size:14})," ",n==="de"?"Bearbeiten":"Edit"]}),r.description&&e.jsxs("details",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-green-800 hover:text-green-900",children:n==="de"?"Szenenbeschreibung":n==="fr"?"Description de sc√®ne":"Scene Description"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto",children:r.description})]}),r.prompt&&e.jsxs("details",{className:"bg-blue-50 border border-blue-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-blue-800 hover:text-blue-900",children:[n==="de"?"API-Prompt":n==="fr"?"Prompt API":"API Prompt",r.modelId&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-blue-600",children:["(",r.modelId,")"]})]}),e.jsx("pre",{className:"mt-2 text-xs text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto max-h-48 overflow-y-auto",children:r.prompt})]}),r.referencePhotos&&r.referencePhotos.length>0&&e.jsx(mr,{referencePhotos:r.referencePhotos,language:n}),r.qualityScore!==void 0&&e.jsxs("details",{className:"bg-indigo-50 border border-indigo-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[n==="de"?"Qualit√§tsbewertung":n==="fr"?"Score de qualit√©":"Quality Score",r.qualityModelId&&e.jsxs("span",{className:"text-xs font-normal text-indigo-500",children:["(",r.qualityModelId,")"]})]}),e.jsxs("span",{className:`text-lg font-bold ${r.qualityScore>=70?"text-green-600":r.qualityScore>=50?"text-yellow-600":"text-red-600"}`,children:[Math.round(r.qualityScore),"%"]})]}),r.qualityReasoning&&e.jsxs("div",{className:"mt-2 text-xs text-gray-800 bg-white p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:n==="de"?"Feedback:":n==="fr"?"Retour:":"Feedback:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.qualityReasoning})]})]}),r.retryHistory&&r.retryHistory.length>0&&e.jsx(cr,{retryHistory:r.retryHistory,totalAttempts:r.totalAttempts||r.retryHistory.length,language:n})]})]})})(),tt&&a&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-4 mt-6",children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-3 text-center",children:n==="de"?"Was m√∂chten Sie als N√§chstes tun?":n==="fr"?"Que souhaitez-vous faire ensuite ?":"What would you like to do next?"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[le&&T&&e.jsxs("button",{onClick:T,disabled:y,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(hs,{size:16})," ",n==="de"?"Buch erstellen":n==="fr"?"Cr√©er le livre":"Create Book"]}),D&&e.jsxs("button",{onClick:D,disabled:y,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(dr,{size:16})," ",n==="de"?"PDF herunterladen":n==="fr"?"T√©l√©charger PDF":"Download PDF"]}),L&&!ie&&e.jsxs("button",{onClick:()=>rt(!0),disabled:y,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Me,{size:16})," ",n==="de"?"Text bearbeiten":n==="fr"?"Modifier le texte":"Edit Text"]}),x&&e.jsxs("button",{onClick:x,disabled:y,className:`bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5 ${y?"opacity-50 cursor-not-allowed":"hover:bg-indigo-600"}`,children:[e.jsx(Dr,{size:16})," ",n==="de"?"Neue Geschichte":n==="fr"?"Nouvelle histoire":"New Story"]})]})]}),ie&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 shadow-lg p-3 md:p-4 z-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(Me,{size:18,className:"flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-sm md:text-base",children:n==="de"?"Bearbeitungsmodus":n==="fr"?"Mode √©dition":"Edit Mode"}),N&&e.jsxs("span",{className:"text-xs text-gray-500 hidden sm:inline",children:["(",n==="de"?"Original gespeichert":n==="fr"?"Original sauvegard√©":"Original saved",")"]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-center md:justify-end",children:[e.jsxs("button",{onClick:zt,disabled:Ee,className:"px-3 md:px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(ot,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:n==="de"?"Abbrechen":n==="fr"?"Annuler":"Cancel"})]}),N&&st!==N&&e.jsxs("button",{onClick:()=>bt(N),disabled:Ee,className:"px-3 md:px-4 py-2 border border-amber-400 text-amber-700 rounded-lg hover:bg-amber-50 text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(Ta,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:n==="de"?"Zur√ºcksetzen":n==="fr"?"Restaurer":"Restore"})]}),e.jsxs("button",{onClick:nt,disabled:Ee,className:`px-3 md:px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-semibold flex items-center gap-1.5 ${Ee?"opacity-50 cursor-not-allowed":"hover:bg-green-600"}`,children:[e.jsx(pt,{size:16}),Ee?n==="de"?"Speichern...":n==="fr"?"Sauvegarde...":"Saving...":n==="de"?"Speichern":n==="fr"?"Sauvegarder":"Save"]})]})]})}),He&&e.jsx(Ja,{pageNumber:He.pageNumber,scene:He.scene,onSceneChange:r=>St({...He,scene:r}),onClose:()=>St(null),onRegenerate:Ke,isRegenerating:ct,imageRegenerationCost:Pe}),at&&e.jsx(Qa,{pageNumber:at.pageNumber,versions:at.versions,onClose:()=>wt(null),onSelectVersion:Mt,developerMode:re}),qe&&e.jsx(Ya,{src:qe.src,title:qe.title,onClose:()=>$e(null)})]})}const kr={"claude-sonnet":{provider:"anthropic",description:"Claude Sonnet 4.5 - Best narrative quality",descriptionDe:"Claude Sonnet 4.5 - Beste Erz√§hlqualit√§t",descriptionFr:"Claude Sonnet 4.5 - Meilleure qualit√© narrative"},"claude-haiku":{provider:"anthropic",description:"Claude Haiku 3.5 - Fast and cheap",descriptionDe:"Claude Haiku 3.5 - Schnell und g√ºnstig",descriptionFr:"Claude Haiku 3.5 - Rapide et √©conomique"},"gemini-2.5-pro":{provider:"google",description:"Gemini 2.5 Pro - High quality, large output",descriptionDe:"Gemini 2.5 Pro - Hohe Qualit√§t, grosse Ausgabe",descriptionFr:"Gemini 2.5 Pro - Haute qualit√©, grande sortie"},"gemini-2.5-flash":{provider:"google",description:"Gemini 2.5 Flash - Fast with large output",descriptionDe:"Gemini 2.5 Flash - Schnell mit grosser Ausgabe",descriptionFr:"Gemini 2.5 Flash - Rapide avec grande sortie"},"gemini-2.0-flash":{provider:"google",description:"Gemini 2.0 Flash - Very fast",descriptionDe:"Gemini 2.0 Flash - Sehr schnell",descriptionFr:"Gemini 2.0 Flash - Tr√®s rapide"}},Ns={"gemini-2.5-flash-image":{description:"Gemini 2.5 Flash Image - Fast scene generation",descriptionDe:"Gemini 2.5 Flash Image - Schnelle Szenengenerierung",descriptionFr:"Gemini 2.5 Flash Image - G√©n√©ration rapide de sc√®nes"},"gemini-3-pro-image-preview":{description:"Gemini 3 Pro Image - Higher quality (preview)",descriptionDe:"Gemini 3 Pro Image - H√∂here Qualit√§t (Vorschau)",descriptionFr:"Gemini 3 Pro Image - Qualit√© sup√©rieure (aper√ßu)"}},Xa={"gemini-2.0-flash":{description:"Gemini 2.0 Flash - Fast evaluation",descriptionDe:"Gemini 2.0 Flash - Schnelle Bewertung",descriptionFr:"Gemini 2.0 Flash - √âvaluation rapide"},"gemini-2.5-flash":{description:"Gemini 2.5 Flash - More thorough",descriptionDe:"Gemini 2.5 Flash - Gr√ºndlicher",descriptionFr:"Gemini 2.5 Flash - Plus approfondi"}};function Wt({label:t,icon:a,value:i,options:h,onChange:s,language:w}){const l=c=>w==="de"&&c.descriptionDe?c.descriptionDe:w==="fr"&&c.descriptionFr?c.descriptionFr:c.description;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("label",{className:"text-xs font-semibold text-gray-600 flex items-center gap-1",children:[a,t]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:i||"",onChange:c=>s(c.target.value||null),className:"w-full appearance-none bg-white border border-gray-300 rounded-lg px-3 py-2 pr-8 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:w==="de"?"Server-Standard":w==="fr"?"Par d√©faut serveur":"Server Default"}),Object.entries(h).map(([c,f])=>e.jsxs("option",{value:c,children:[c," ",f.provider?`(${f.provider})`:""]},c))]}),e.jsx(xr,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),i&&h[i]&&e.jsx("p",{className:"text-[10px] text-gray-500 italic",children:l(h[i])})]})}function en({selections:t,onChange:a}){const{language:i}=ze(),h=(s,w)=>{a({...t,[s]:w})};return e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-400 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-yellow-800 mb-3 flex items-center gap-2",children:[e.jsx(La,{size:16}),i==="de"?"AI-Modell Auswahl (Dev)":i==="fr"?"S√©lection de mod√®le IA (Dev)":"AI Model Selection (Dev)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(Wt,{label:i==="de"?"Ideen-Modell":i==="fr"?"Mod√®le d'id√©es":"Idea Model",icon:e.jsx(Ga,{size:12}),value:t.ideaModel,options:kr,onChange:s=>h("ideaModel",s),language:i}),e.jsx(Wt,{label:i==="de"?"Outline-Modell":i==="fr"?"Mod√®le de plan":"Outline Model",icon:e.jsx(Qe,{size:12}),value:t.outlineModel,options:kr,onChange:s=>h("outlineModel",s),language:i}),e.jsx(Wt,{label:i==="de"?"Text-Modell":i==="fr"?"Mod√®le de texte":"Text Model",icon:e.jsx(Qe,{size:12}),value:t.textModel,options:kr,onChange:s=>h("textModel",s),language:i}),e.jsx(Wt,{label:i==="de"?"Szenen-Modell":i==="fr"?"Mod√®le de sc√®ne":"Scene Description Model",icon:e.jsx(Bs,{size:12}),value:t.sceneDescriptionModel,options:kr,onChange:s=>h("sceneDescriptionModel",s),language:i}),e.jsx(Wt,{label:i==="de"?"Bild-Modell":i==="fr"?"Mod√®le d'image":"Image Model",icon:e.jsx($a,{size:12}),value:t.imageModel,options:Ns,onChange:s=>h("imageModel",s),language:i}),e.jsx(Wt,{label:i==="de"?"Cover-Modell":i==="fr"?"Mod√®le de couverture":"Cover Image Model",icon:e.jsx(Hr,{size:12}),value:t.coverImageModel,options:Ns,onChange:s=>h("coverImageModel",s),language:i}),e.jsx(Wt,{label:i==="de"?"Bewertungs-Modell":i==="fr"?"Mod√®le d'√©valuation":"Quality Eval Model",icon:e.jsx(Na,{size:12}),value:t.qualityModel,options:Xa,onChange:s=>h("qualityModel",s),language:i})]}),e.jsx("p",{className:"text-[10px] text-yellow-700 mt-3 italic",children:i==="de"?'Hinweis: Nur sichtbar f√ºr Admin-Benutzer im Entwicklermodus. "Server-Standard" verwendet die Umgebungsvariablen-Konfiguration.':i==="fr"?`Note: Visible uniquement pour les utilisateurs admin en mode d√©veloppeur. "Par d√©faut serveur" utilise la configuration des variables d'environnement.`:'Note: Only visible to admin users in developer mode. "Server Default" uses the environment variable configuration.'})]})}const Ut=[{id:"adventure",name:{en:"Adventure",de:"Abenteuer",fr:"Aventure"},description:{en:"Exciting journeys and heroic quests",de:"Spannende Reisen und heldenhafte Abenteuer",fr:"Voyages passionnants et qu√™tes h√©ro√Øques"},emoji:"üó°Ô∏è"},{id:"life-challenge",name:{en:"Life Skills",de:"Lebensthemen",fr:"Comp√©tences de vie"},description:{en:"Help overcome everyday challenges",de:"Hilfe bei allt√§glichen Herausforderungen",fr:"Aide pour surmonter les d√©fis quotidiens"},emoji:"üí™"},{id:"educational",name:{en:"Learning",de:"Lernen",fr:"Apprentissage"},description:{en:"Fun stories that teach something new",de:"Lustige Geschichten, die etwas Neues lehren",fr:"Histoires amusantes qui enseignent quelque chose de nouveau"},emoji:"üìö"}],ws=[{id:"historical",name:{en:"Historical Times",de:"Historische Zeiten",fr:"√âpoques historiques"}},{id:"fantasy",name:{en:"Fantasy & Magic",de:"Fantasie & Magie",fr:"Fantaisie & Magie"}},{id:"locations",name:{en:"Exploration",de:"Entdeckung",fr:"Exploration"}},{id:"professions",name:{en:"Heroes & Helpers",de:"Helden & Helfer",fr:"H√©ros & Aides"}},{id:"seasonal",name:{en:"Seasonal",de:"Jahreszeiten",fr:"Saisonnier"}},{id:"custom",name:{en:"Custom",de:"Eigenes Thema",fr:"Personnalis√©"}}],tr=[{id:"pirate",name:{en:"Pirate Adventure",de:"Piraten-Abenteuer",fr:"Aventure de Pirates"},emoji:"üè¥‚Äç‚ò†Ô∏è",group:"historical"},{id:"knight",name:{en:"Knights & Princess",de:"Ritter & Prinzessin",fr:"Chevaliers & Princesse"},emoji:"‚öîÔ∏è",group:"historical"},{id:"cowboy",name:{en:"Wild West",de:"Wilder Westen",fr:"Far West"},emoji:"ü§†",group:"historical"},{id:"ninja",name:{en:"Secret Ninja",de:"Geheimer Ninja",fr:"Ninja Secret"},emoji:"ü•∑",group:"historical"},{id:"wizard",name:{en:"Wizard & Witch",de:"Zauberer & Hexe",fr:"Sorcier & Sorci√®re"},emoji:"üßô",group:"fantasy"},{id:"dragon",name:{en:"Dragon Quest",de:"Drachen-Abenteuer",fr:"Qu√™te du Dragon"},emoji:"üêâ",group:"fantasy"},{id:"unicorn",name:{en:"Magical Unicorn",de:"Magisches Einhorn",fr:"Licorne Magique"},emoji:"ü¶Ñ",group:"fantasy"},{id:"mermaid",name:{en:"Mermaid Adventure",de:"Meerjungfrauen-Abenteuer",fr:"Aventure de Sir√®ne"},emoji:"üßú‚Äç‚ôÄÔ∏è",group:"fantasy"},{id:"dinosaur",name:{en:"Dinosaur World",de:"Dinosaurier-Welt",fr:"Monde des Dinosaures"},emoji:"ü¶ñ",group:"fantasy"},{id:"superhero",name:{en:"Superhero",de:"Superheld",fr:"Super-h√©ros"},emoji:"ü¶∏",group:"fantasy"},{id:"space",name:{en:"Space Explorer",de:"Weltraum-Entdecker",fr:"Explorateur Spatial"},emoji:"üöÄ",group:"locations"},{id:"ocean",name:{en:"Ocean Explorer",de:"Ozean-Entdecker",fr:"Explorateur des Oc√©ans"},emoji:"üåä",group:"locations"},{id:"jungle",name:{en:"Jungle Safari",de:"Dschungel-Safari",fr:"Safari dans la Jungle"},emoji:"üå¥",group:"locations"},{id:"farm",name:{en:"Farm Life",de:"Bauernhof-Leben",fr:"Vie √† la Ferme"},emoji:"üêÑ",group:"locations"},{id:"forest",name:{en:"Forest Friends",de:"Waldfreunde",fr:"Amis de la For√™t"},emoji:"ü¶ä",group:"locations"},{id:"fireman",name:{en:"Brave Firefighter",de:"Tapferer Feuerwehrmann",fr:"Pompier Courageux"},emoji:"üöí",group:"professions"},{id:"doctor",name:{en:"Helpful Doctor",de:"Hilfreicher Arzt",fr:"Docteur Serviable"},emoji:"üë®‚Äç‚öïÔ∏è",group:"professions"},{id:"police",name:{en:"Police Officer",de:"Polizist",fr:"Policier"},emoji:"üëÆ",group:"professions"},{id:"christmas",name:{en:"Christmas Story",de:"Weihnachts-Geschichte",fr:"Histoire de No√´l"},emoji:"üéÑ",group:"seasonal"},{id:"newyear",name:{en:"New Year Story",de:"Neujahrs-Geschichte",fr:"Histoire du Nouvel An"},emoji:"üéÜ",group:"seasonal"},{id:"easter",name:{en:"Easter Story",de:"Oster-Geschichte",fr:"Histoire de P√¢ques"},emoji:"üê∞",group:"seasonal"},{id:"halloween",name:{en:"Halloween Story",de:"Halloween-Geschichte",fr:"Histoire d'Halloween"},emoji:"üéÉ",group:"seasonal"},{id:"custom",name:{en:"Create Your Own",de:"Eigenes Thema",fr:"Cr√©er le v√¥tre"},emoji:"‚ú®",group:"custom"}],er={name:{en:"Everyday Life",de:"Alltag",fr:"Vie Quotidienne"},emoji:"üè†"},Ir=[{id:"potty-training",name:{en:"Potty Training",de:"T√∂pfchen-Training",fr:"Apprentissage du pot"},emoji:"üöΩ",ageGroup:"toddler"},{id:"washing-hands",name:{en:"Washing Hands",de:"H√§nde waschen",fr:"Se laver les mains"},emoji:"üßº",ageGroup:"toddler"},{id:"brushing-teeth",name:{en:"Brushing Teeth",de:"Z√§hne putzen",fr:"Se brosser les dents"},emoji:"ü™•",ageGroup:"toddler"},{id:"eating-vegetables",name:{en:"Eating Vegetables",de:"Gem√ºse essen",fr:"Manger des l√©gumes"},emoji:"ü•¶",ageGroup:"toddler"},{id:"going-to-bed",name:{en:"Going to Bed",de:"Ins Bett gehen",fr:"Aller au lit"},emoji:"üõèÔ∏è",ageGroup:"toddler"},{id:"saying-goodbye",name:{en:"Saying Goodbye",de:"Abschied nehmen",fr:"Dire au revoir"},emoji:"üëã",ageGroup:"toddler"},{id:"no-pacifier",name:{en:"No More Pacifier",de:"Ohne Schnuller",fr:"Plus de t√©tine"},emoji:"üçº",ageGroup:"toddler"},{id:"cleaning-up",name:{en:"Cleaning Up Toys",de:"Aufr√§umen",fr:"Ranger les jouets"},emoji:"üßπ",ageGroup:"preschool"},{id:"sitting-still",name:{en:"Sitting Still",de:"Still sitzen",fr:"Rester tranquille"},emoji:"ü™ë",ageGroup:"preschool"},{id:"sharing",name:{en:"Learning to Share",de:"Teilen lernen",fr:"Apprendre √† partager"},emoji:"ü§ù",ageGroup:"preschool"},{id:"waiting-turn",name:{en:"Waiting Your Turn",de:"Warten k√∂nnen",fr:"Attendre son tour"},emoji:"‚è≥",ageGroup:"preschool"},{id:"first-kindergarten",name:{en:"First Day of Kindergarten",de:"Erster Kindergartentag",fr:"Premier jour de maternelle"},emoji:"üéí",ageGroup:"preschool"},{id:"making-friends",name:{en:"Making Friends",de:"Freunde finden",fr:"Se faire des amis"},emoji:"üë´",ageGroup:"preschool"},{id:"being-brave",name:{en:"Being Brave",de:"Mutig sein",fr:"√ätre courageux"},emoji:"üí™",ageGroup:"preschool"},{id:"new-sibling",name:{en:"New Baby Sibling",de:"Neues Geschwisterchen",fr:"Nouveau b√©b√© dans la famille"},emoji:"üë∂",ageGroup:"preschool"},{id:"first-school",name:{en:"First Day of School",de:"Erster Schultag",fr:"Premier jour d'√©cole"},emoji:"üè´",ageGroup:"early-school"},{id:"homework",name:{en:"Doing Homework",de:"Hausaufgaben machen",fr:"Faire ses devoirs"},emoji:"üìù",ageGroup:"early-school"},{id:"reading-alone",name:{en:"Learning to Read",de:"Lesen lernen",fr:"Apprendre √† lire"},emoji:"üìñ",ageGroup:"early-school"},{id:"losing-game",name:{en:"Losing a Game",de:"Verlieren k√∂nnen",fr:"Savoir perdre"},emoji:"üéØ",ageGroup:"early-school"},{id:"being-different",name:{en:"Being Different is OK",de:"Anders sein ist OK",fr:"√ätre diff√©rent c'est bien"},emoji:"üåà",ageGroup:"early-school"},{id:"dealing-bully",name:{en:"Dealing with Bullies",de:"Mit H√§nseleien umgehen",fr:"Faire face aux moqueries"},emoji:"üõ°Ô∏è",ageGroup:"early-school"},{id:"telling-truth",name:{en:"Telling the Truth",de:"Die Wahrheit sagen",fr:"Dire la v√©rit√©"},emoji:"‚úÖ",ageGroup:"early-school"},{id:"trying-new-things",name:{en:"Trying New Things",de:"Neues ausprobieren",fr:"Essayer de nouvelles choses"},emoji:"üåü",ageGroup:"early-school"},{id:"moving-house",name:{en:"Moving to a New Home",de:"Umzug",fr:"D√©m√©nagement"},emoji:"üè†",ageGroup:"family"},{id:"going-vacation",name:{en:"Going on Vacation",de:"In den Urlaub fahren",fr:"Partir en vacances"},emoji:"‚úàÔ∏è",ageGroup:"family"},{id:"parents-splitting",name:{en:"Parents Living Apart",de:"Eltern leben getrennt",fr:"Parents s√©par√©s"},emoji:"üíî",ageGroup:"family"},{id:"visiting-doctor",name:{en:"Going to the Doctor",de:"Arztbesuch",fr:"Visite chez le m√©decin"},emoji:"üè•",ageGroup:"family"},{id:"staying-hospital",name:{en:"Staying in Hospital",de:"Im Krankenhaus",fr:"S√©jour √† l'h√¥pital"},emoji:"ü©∫",ageGroup:"family"},{id:"death-pet",name:{en:"Losing a Pet",de:"Haustier verlieren",fr:"Perte d'un animal"},emoji:"üåà",ageGroup:"family"},{id:"grandparent-sick",name:{en:"Grandparent is Sick",de:"Grosseltern sind krank",fr:"Grand-parent malade"},emoji:"‚ù§Ô∏è",ageGroup:"family"},{id:"money-saving",name:{en:"Saving Money",de:"Geld sparen",fr:"√âconomiser de l'argent"},emoji:"üí∞",ageGroup:"preteen"},{id:"spending-wisely",name:{en:"Spending Wisely",de:"Klug ausgeben",fr:"D√©penser intelligemment"},emoji:"üõí",ageGroup:"preteen"},{id:"screen-time",name:{en:"Screen Time Balance",de:"Bildschirmzeit-Balance",fr:"√âquilibre du temps d'√©cran"},emoji:"üì±",ageGroup:"preteen"},{id:"peer-pressure",name:{en:"Peer Pressure",de:"Gruppenzwang",fr:"Pression des pairs"},emoji:"üë•",ageGroup:"preteen"},{id:"body-changes",name:{en:"Body Changes",de:"K√∂rperliche Ver√§nderungen",fr:"Changements corporels"},emoji:"üå±",ageGroup:"preteen"},{id:"responsibility",name:{en:"Taking Responsibility",de:"Verantwortung √ºbernehmen",fr:"Prendre ses responsabilit√©s"},emoji:"üéØ",ageGroup:"preteen"},{id:"managing-time",name:{en:"Managing Time",de:"Zeitmanagement",fr:"Gestion du temps"},emoji:"‚è∞",ageGroup:"preteen"},{id:"online-safety",name:{en:"Online Safety",de:"Sicherheit im Internet",fr:"S√©curit√© en ligne"},emoji:"üîí",ageGroup:"preteen"}],Ss=[{id:"toddler",name:{en:"Toddler (2-4)",de:"Kleinkind (2-4)",fr:"Tout-petit (2-4)"},ageRange:"2-4"},{id:"preschool",name:{en:"Preschool (4-6)",de:"Vorschule (4-6)",fr:"Pr√©scolaire (4-6)"},ageRange:"4-6"},{id:"early-school",name:{en:"Early School (6-9)",de:"Grundschule (6-9)",fr:"√âcole primaire (6-9)"},ageRange:"6-9"},{id:"family",name:{en:"Family Changes",de:"Familien-Ver√§nderungen",fr:"Changements familiaux"},ageRange:"all"},{id:"preteen",name:{en:"Pre-Teen (9-12)",de:"Vorpubert√§t (9-12)",fr:"Pr√©adolescent (9-12)"},ageRange:"9-12"}],$r=[{id:"alphabet",name:{en:"The Alphabet (ABC)",de:"Das Alphabet (ABC)",fr:"L'Alphabet (ABC)"},emoji:"üî§",group:"letters"},{id:"vowels",name:{en:"Vowels (A, E, I, O, U)",de:"Vokale (A, E, I, O, U)",fr:"Voyelles (A, E, I, O, U)"},emoji:"üÖ∞Ô∏è",group:"letters"},{id:"rhyming",name:{en:"Rhyming Words",de:"Reimw√∂rter",fr:"Mots qui riment"},emoji:"üéµ",group:"letters"},{id:"numbers-1-10",name:{en:"Numbers 1-10",de:"Zahlen 1-10",fr:"Nombres 1-10"},emoji:"üî¢",group:"numbers"},{id:"numbers-1-20",name:{en:"Numbers 1-20",de:"Zahlen 1-20",fr:"Nombres 1-20"},emoji:"üî¢",group:"numbers"},{id:"counting",name:{en:"Learning to Count",de:"Z√§hlen lernen",fr:"Apprendre √† compter"},emoji:"‚úã",group:"numbers"},{id:"shapes",name:{en:"Shapes",de:"Formen",fr:"Formes"},emoji:"üî∑",group:"numbers"},{id:"addition",name:{en:"Simple Addition",de:"Einfaches Addieren",fr:"Addition simple"},emoji:"‚ûï",group:"numbers"},{id:"colors-basic",name:{en:"Basic Colors",de:"Grundfarben",fr:"Couleurs de base"},emoji:"üåà",group:"colors"},{id:"colors-mixing",name:{en:"Mixing Colors",de:"Farben mischen",fr:"M√©langer les couleurs"},emoji:"üé®",group:"colors"},{id:"planets",name:{en:"Planets & Space",de:"Planeten & Weltraum",fr:"Plan√®tes & Espace"},emoji:"ü™ê",group:"science"},{id:"seasons",name:{en:"The Four Seasons",de:"Die vier Jahreszeiten",fr:"Les quatre saisons"},emoji:"üçÇ",group:"science"},{id:"weather",name:{en:"Weather",de:"Wetter",fr:"M√©t√©o"},emoji:"‚õÖ",group:"science"},{id:"water-cycle",name:{en:"Water Cycle",de:"Wasserkreislauf",fr:"Cycle de l'eau"},emoji:"üíß",group:"science"},{id:"plants-grow",name:{en:"How Plants Grow",de:"Wie Pflanzen wachsen",fr:"Comment poussent les plantes"},emoji:"üå±",group:"science"},{id:"day-night",name:{en:"Day and Night",de:"Tag und Nacht",fr:"Jour et nuit"},emoji:"üåô",group:"science"},{id:"farm-animals",name:{en:"Farm Animals",de:"Bauernhoftiere",fr:"Animaux de la ferme"},emoji:"üê∑",group:"animals"},{id:"wild-animals",name:{en:"Wild Animals",de:"Wilde Tiere",fr:"Animaux sauvages"},emoji:"ü¶Å",group:"animals"},{id:"ocean-animals",name:{en:"Ocean Animals",de:"Meerestiere",fr:"Animaux marins"},emoji:"üêã",group:"animals"},{id:"insects",name:{en:"Insects & Bugs",de:"Insekten & K√§fer",fr:"Insectes"},emoji:"üêõ",group:"animals"},{id:"dinosaurs",name:{en:"Dinosaurs",de:"Dinosaurier",fr:"Dinosaures"},emoji:"ü¶ï",group:"animals"},{id:"body-parts",name:{en:"Body Parts",de:"K√∂rperteile",fr:"Parties du corps"},emoji:"ü´Ä",group:"body"},{id:"five-senses",name:{en:"The Five Senses",de:"Die f√ºnf Sinne",fr:"Les cinq sens"},emoji:"üëÅÔ∏è",group:"body"},{id:"healthy-eating",name:{en:"Healthy Eating",de:"Gesund essen",fr:"Manger sainement"},emoji:"ü•ó",group:"body"},{id:"days-week",name:{en:"Days of the Week",de:"Wochentage",fr:"Jours de la semaine"},emoji:"üìÖ",group:"time"},{id:"months-year",name:{en:"Months of the Year",de:"Monate des Jahres",fr:"Mois de l'ann√©e"},emoji:"üóìÔ∏è",group:"time"},{id:"telling-time",name:{en:"Telling Time",de:"Uhr lesen",fr:"Lire l'heure"},emoji:"üïê",group:"time"},{id:"continents",name:{en:"Continents",de:"Kontinente",fr:"Continents"},emoji:"üåç",group:"geography"},{id:"countries-flags",name:{en:"Countries & Flags",de:"L√§nder & Flaggen",fr:"Pays & Drapeaux"},emoji:"üè≥Ô∏è",group:"geography"},{id:"instruments",name:{en:"Musical Instruments",de:"Musikinstrumente",fr:"Instruments de musique"},emoji:"üé∏",group:"arts"},{id:"famous-artists",name:{en:"Famous Artists",de:"Ber√ºhmte K√ºnstler",fr:"Artistes c√©l√®bres"},emoji:"üñºÔ∏è",group:"arts"}],ks=[{id:"letters",name:{en:"Letters & Reading",de:"Buchstaben & Lesen",fr:"Lettres & Lecture"}},{id:"numbers",name:{en:"Numbers & Math",de:"Zahlen & Mathe",fr:"Nombres & Maths"}},{id:"colors",name:{en:"Colors",de:"Farben",fr:"Couleurs"}},{id:"science",name:{en:"Nature & Science",de:"Natur & Wissenschaft",fr:"Nature & Science"}},{id:"animals",name:{en:"Animals",de:"Tiere",fr:"Animaux"}},{id:"body",name:{en:"Body & Health",de:"K√∂rper & Gesundheit",fr:"Corps & Sant√©"}},{id:"time",name:{en:"Time & Calendar",de:"Zeit & Kalender",fr:"Temps & Calendrier"}},{id:"geography",name:{en:"World & Geography",de:"Welt & Geografie",fr:"Monde & G√©ographie"}},{id:"arts",name:{en:"Music & Art",de:"Musik & Kunst",fr:"Musique & Art"}}];function tn(t){return tr.filter(a=>a.group===t)}function rn(t){return Ir.filter(a=>a.ageGroup===t)}function sn(t){return $r.filter(a=>a.group===t)}function an({storyCategory:t,storyTopic:a,storyTheme:i,customThemeText:h="",onCategoryChange:s,onTopicChange:w,onThemeChange:l,onCustomThemeTextChange:c,onLegacyStoryTypeChange:f}){var p,pe,X,Y,oe,ge,ye;const{language:v}=ze(),$=v,[O,S]=g.useState([]),[y,D]=g.useState([]),[T,B]=g.useState([]),x={en:{storyType:"Story Type",theme:"Theme",topic:"Topic",setting:"Setting",optionalTheme:"Optional: Add an adventure theme",optionalThemeDesc:"Make it a pirate, wizard, or other adventure story",noTheme:"No theme (realistic)",selectedCategory:"Story type",selectedTopic:"Topic",selectedTheme:"Theme",change:"Change",customThemePlaceholder:"Describe your adventure theme...",customThemeLabel:"Your custom theme:"},de:{storyType:"Geschichte",theme:"Thema",topic:"Thema",setting:"Setting",optionalTheme:"Optional: Abenteuer-Thema hinzuf√ºgen",optionalThemeDesc:"Als Piraten-, Zauberer- oder andere Abenteuergeschichte",noTheme:"Kein Thema (realistisch)",selectedCategory:"Geschichtsart",selectedTopic:"Thema",selectedTheme:"Setting",change:"√Ñndern",customThemePlaceholder:"Beschreibe dein Abenteuer-Thema...",customThemeLabel:"Dein eigenes Thema:"},fr:{storyType:"Histoire",theme:"Th√®me",topic:"Sujet",setting:"Cadre",optionalTheme:"Optionnel: Ajouter un th√®me d'aventure",optionalThemeDesc:"En faire une histoire de pirate, sorcier, etc.",noTheme:"Pas de th√®me (r√©aliste)",selectedCategory:"Type d'histoire",selectedTopic:"Sujet",selectedTheme:"Th√®me",change:"Changer",customThemePlaceholder:"D√©cris ton th√®me d'aventure...",customThemeLabel:"Ton th√®me personnalis√©:"}},A=x[$]||x.en,H=N=>{S(L=>L.includes(N)?L.filter(U=>U!==N):[...L,N])},z=N=>{D(L=>L.includes(N)?L.filter(U=>U!==N):[...L,N])},J=N=>{B(L=>L.includes(N)?L.filter(U=>U!==N):[...L,N])};g.useEffect(()=>{t==="adventure"?S(ws.map(N=>N.id)):t==="life-challenge"?D(Ss.map(N=>N.id)):t==="educational"&&B(ks.map(N=>N.id))},[t]);const _=N=>{s(N),w(""),l(N==="adventure"?"":"realistic")},F=N=>{l(N),f(N)},ae=N=>{w(N),f(i==="realistic"?N:i)},le=N=>{l(N),f(N==="realistic"?a||"adventure":N)},re=N=>{const L=Ut.find(U=>U.id===N);return L?L.name[$]||L.name.en:N},me=N=>{if(N==="realistic")return er.name[$]||er.name.en;const L=tr.find(U=>U.id===N);return L?L.name[$]||L.name.en:N},ue=N=>{const L=Ir.find(K=>K.id===N);if(L)return L.name[$]||L.name.en;const U=$r.find(K=>K.id===N);return U?U.name[$]||U.name.en:N};if(!t)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Qe,{className:"text-indigo-600",size:24}),A.storyType]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Ut.map(N=>e.jsxs("button",{onClick:()=>_(N.id),className:"p-6 rounded-xl border-2 border-gray-200 hover:border-indigo-400 hover:bg-indigo-50 transition-all text-left",children:[e.jsx("div",{className:"text-4xl mb-3",children:N.emoji}),e.jsx("div",{className:"font-bold text-lg text-gray-800",children:N.name[$]||N.name.en}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:N.description[$]||N.description.en})]},N.id))})]});if(t==="adventure"&&!i)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 px-2 py-1 rounded",children:[(p=Ut.find(N=>N.id===t))==null?void 0:p.emoji," ",re(t)]}),e.jsx("button",{onClick:()=>s(""),className:"text-indigo-600 hover:underline",children:A.change})]}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Qe,{className:"text-indigo-600",size:24}),A.theme]}),e.jsx("div",{className:"space-y-3",children:ws.map(N=>{const L=tn(N.id),U=O.includes(N.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>H(N.id),className:"w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:N.name[$]||N.name.en}),U?e.jsx(_r,{size:20}):e.jsx(xr,{size:20})]}),U&&e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 p-3",children:L.map(K=>e.jsxs("button",{onClick:()=>F(K.id),className:"p-2 rounded-lg border border-gray-200 hover:border-indigo-400 hover:bg-indigo-50 transition-all text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:K.emoji}),e.jsx("div",{className:"font-semibold text-xs",children:K.name[$]||K.name.en})]},K.id))})]},N.id)})})]});if(t==="life-challenge"&&!a)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 px-2 py-1 rounded",children:[(pe=Ut.find(N=>N.id===t))==null?void 0:pe.emoji," ",re(t)]}),e.jsx("button",{onClick:()=>s(""),className:"text-indigo-600 hover:underline",children:A.change})]}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Qe,{className:"text-indigo-600",size:24}),A.topic]}),e.jsx("div",{className:"space-y-3",children:Ss.map(N=>{const L=rn(N.id),U=y.includes(N.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>z(N.id),className:"w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:N.name[$]||N.name.en}),U?e.jsx(_r,{size:20}):e.jsx(xr,{size:20})]}),U&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 p-3",children:L.map(K=>e.jsxs("button",{onClick:()=>ae(K.id),className:"p-2 rounded-lg border border-gray-200 hover:border-indigo-400 hover:bg-indigo-50 transition-all text-left",children:[e.jsx("span",{className:"text-xl mr-2",children:K.emoji}),e.jsx("span",{className:"text-sm font-medium",children:K.name[$]||K.name.en})]},K.id))})]},N.id)})})]});if(t==="educational"&&!a)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 px-2 py-1 rounded",children:[(X=Ut.find(N=>N.id===t))==null?void 0:X.emoji," ",re(t)]}),e.jsx("button",{onClick:()=>s(""),className:"text-indigo-600 hover:underline",children:A.change})]}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Qe,{className:"text-indigo-600",size:24}),A.topic]}),e.jsx("div",{className:"space-y-3",children:ks.map(N=>{const L=sn(N.id),U=T.includes(N.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>J(N.id),className:"w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:N.name[$]||N.name.en}),U?e.jsx(_r,{size:20}):e.jsx(xr,{size:20})]}),U&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 p-3",children:L.map(K=>e.jsxs("button",{onClick:()=>ae(K.id),className:"p-2 rounded-lg border border-gray-200 hover:border-indigo-400 hover:bg-indigo-50 transition-all text-left",children:[e.jsx("span",{className:"text-xl mr-2",children:K.emoji}),e.jsx("span",{className:"text-sm font-medium",children:K.name[$]||K.name.en})]},K.id))})]},N.id)})})]});if((t==="life-challenge"||t==="educational")&&a&&i==="realistic")return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 px-2 py-1 rounded",children:[(Y=Ut.find(N=>N.id===t))==null?void 0:Y.emoji," ",re(t)]}),e.jsx("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded",children:ue(a)}),e.jsx("button",{onClick:()=>w(""),className:"text-indigo-600 hover:underline",children:A.change})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-1",children:A.optionalTheme}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:A.optionalThemeDesc}),e.jsxs("div",{className:"grid grid-cols-3 md:grid-cols-5 lg:grid-cols-6 gap-2",children:[e.jsxs("button",{onClick:()=>le("realistic"),className:`p-2 rounded-lg border-2 transition-all ${i==="realistic"?"border-green-500 bg-green-50":"border-gray-200 hover:border-green-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:er.emoji}),e.jsx("div",{className:"font-semibold text-xs",children:A.noTheme})]}),tr.filter(N=>N.group!=="custom").map(N=>e.jsxs("button",{onClick:()=>le(N.id),className:`p-2 rounded-lg border-2 transition-all ${i===N.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:N.emoji}),e.jsx("div",{className:"font-semibold text-xs",children:N.name[$]||N.name.en})]},N.id))]})]})]});const W=Ut.find(N=>N.id===t);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Qe,{className:"text-indigo-600",size:24}),A.storyType]}),e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border border-indigo-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:W==null?void 0:W.emoji}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:A.selectedCategory}),e.jsx("div",{className:"font-semibold",children:re(t)})]})]}),e.jsx("button",{onClick:()=>s(""),className:"text-indigo-600 hover:underline text-sm",children:A.change})]}),a&&e.jsxs("div",{className:"flex items-center justify-between border-t border-indigo-100 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:((oe=Ir.find(N=>N.id===a))==null?void 0:oe.emoji)||((ge=$r.find(N=>N.id===a))==null?void 0:ge.emoji)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:A.selectedTopic}),e.jsx("div",{className:"font-semibold",children:ue(a)})]})]}),e.jsx("button",{onClick:()=>w(""),className:"text-indigo-600 hover:underline text-sm",children:A.change})]}),e.jsxs("div",{className:"flex items-center justify-between border-t border-indigo-100 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:i==="realistic"?er.emoji:(ye=tr.find(N=>N.id===i))==null?void 0:ye.emoji}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:A.selectedTheme}),e.jsx("div",{className:"font-semibold",children:me(i)})]})]}),e.jsx("button",{onClick:()=>{l(t==="adventure"?"":"realistic")},className:"text-indigo-600 hover:underline text-sm",children:A.change})]}),i==="custom"&&e.jsxs("div",{className:"border-t border-indigo-100 pt-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:A.customThemeLabel}),e.jsx("input",{type:"text",value:h,onChange:N=>c==null?void 0:c(N.target.value),placeholder:A.customThemePlaceholder,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})]})]})}const Ls=[{id:"watercolor",name:{en:"Watercolor",de:"Aquarell",fr:"Aquarelle"},emoji:"üé®",image:"/images/water color style.jpg",description:{en:"Soft watercolor painting with flowing colors",de:"Sanfte Aquarellmalerei mit fliessenden Farben",fr:"Peinture aquarelle douce aux couleurs fluides"},prompt:"Traditional watercolor painting, textured paper, delicate color washes (wet-on-wet technique), soft edges, visible artistic brushstrokes, transparent and flowing colors"},{id:"concept",name:{en:"Concept Art",de:"Konzeptkunst",fr:"Art conceptuel"},emoji:"‚ú®",image:"/images/concept art style.jpg",description:{en:"Professional digital concept art",de:"Professionelle digitale Konzeptkunst",fr:"Art conceptuel num√©rique professionnel"},prompt:"Highly detailed digital concept art, dramatic lighting, epic composition, smooth rendering, focus on mood and atmosphere, wide-angle lens, matte painting aesthetic"},{id:"anime",name:{en:"Anime",de:"Anime",fr:"Anime"},emoji:"‚≠ê",image:"/images/anime style.jpg",description:{en:"Japanese anime style with expressive features",de:"Japanischer Anime-Stil mit ausdrucksstarken Features",fr:"Style anime japonais aux traits expressifs"},prompt:"Modern digital anime art, high detail, expressive large eyes, dynamic composition, detailed cel-shading, vibrant palette, style of Makoto Shinkai"},{id:"pixar",name:{en:"Pixar 3D",de:"Pixar 3D",fr:"Pixar 3D"},emoji:"üé¨",image:"/images/pixar art style 2.jpg",description:{en:"Vibrant, warm Disney/Pixar style 3D animation",de:"Lebendige, warme Disney/Pixar 3D-Animation",fr:"Animation 3D Disney/Pixar vibrante et chaleureuse"},prompt:"3D render, Pixar cinematic style, natural eye proportion, subtle expression, highly detailed textures, octane render, volumetric lighting, vibrant colors, smooth shading, family-friendly"},{id:"cartoon",name:{en:"Cartoon",de:"Cartoon",fr:"Dessin anim√©"},emoji:"üé®",image:"/images/cartoon style.jpg",description:{en:"Classic 2D cartoon style with bold colors",de:"Klassischer 2D-Cartoon-Stil mit kr√§ftigen Farben",fr:"Style cartoon 2D classique aux couleurs vives"},prompt:"2D cartoon style, bold black outlines, vibrant flat colors (minimal shading/cel-shading), smooth vector quality, classic Saturday morning animation aesthetic"},{id:"comic",name:{en:"Comic Book",de:"Comic",fr:"Bande dessin√©e"},emoji:"üí•",image:"/images/comic book style.jpg",description:{en:"Comic book style with bold lines and halftone",de:"Comic-Stil mit kr√§ftigen Linien und Raster",fr:"Style bande dessin√©e avec lignes √©paisses et trames"},prompt:"Classic American comic book art, heavy black ink lines, dynamic composition, visible halftone/Ben-Day dots, vibrant CMYK colors, style of Jack Kirby/Jim Lee"},{id:"oil",name:{en:"Oil Painting",de:"√ñlgem√§lde",fr:"Peinture √† l'huile"},emoji:"üñºÔ∏è",image:"/images/oil painting style.jpg",description:{en:"Classic oil painting with rich textures",de:"Klassisches √ñlgem√§lde mit reichen Texturen",fr:"Peinture √† l'huile classique aux textures riches"},prompt:"Classic oil painting style, visible impasto brushstrokes, rich texture, heavy pigment, chiaroscuro lighting, canvas texture, museum quality art"},{id:"steampunk",name:{en:"Steampunk",de:"Steampunk",fr:"Steampunk"},emoji:"‚öôÔ∏è",image:"/images/steampunk style.jpg",description:{en:"Victorian-era inspired with gears and brass",de:"Von der viktorianischen √Ñra inspiriert mit Zahnr√§dern und Messing",fr:"Inspir√© de l'√®re victorienne avec engrenages et laiton"},prompt:"Steampunk graphic novel illustration, Victorian aesthetic, intricate gears, brass and copper mechanisms, leather textures, sepia/muted color palette, detailed linework"},{id:"cyber",name:{en:"Cyberpunk",de:"Cyberpunk",fr:"Cyberpunk"},emoji:"üåÉ",image:"/images/cyber punk style.jpg",description:{en:"Dark futuristic cyberpunk aesthetic",de:"Dunkle futuristische Cyberpunk-√Ñsthetik",fr:"Esth√©tique cyberpunk futuriste sombre"},prompt:"Cyberpunk aesthetic, neon reflections, rainy streets, chrome, dense complexity, high contrast, dark atmosphere, volumetric fog, graphic novel illustration"},{id:"chibi",name:{en:"Chibi",de:"Chibi",fr:"Chibi"},emoji:"üå∏",image:"/images/chibi style.jpg",description:{en:"Cute chibi style with big heads and small bodies",de:"Niedlicher Chibi-Stil mit grossen K√∂pfen und kleinen K√∂rpern",fr:"Style chibi mignon avec grandes t√™tes et petits corps"},prompt:"Chibi style, super deformed (SD) proportions, massive head, tiny body, kawaii aesthetic, adorable, smooth illustration, minimalist detail"},{id:"manga",name:{en:"Manga",de:"Manga",fr:"Manga"},emoji:"üìö",image:"/images/manga style.jpg",description:{en:"Japanese manga style, black and white with screentones",de:"Japanischer Manga-Stil, schwarz-weiss mit Rastern",fr:"Style manga japonais, noir et blanc avec trames"},prompt:"Traditional manga style, Japanese comic art, intricate detailed linework, black and white/monochrome, atmospheric screentones, dramatic lighting and composition"},{id:"pixel",name:{en:"Pixel Art",de:"Pixelkunst",fr:"Pixel art"},emoji:"üëæ",image:"/images/pixel style.jpg",description:{en:"Retro 16-bit pixel art style",de:"Retro 16-Bit Pixelkunst-Stil",fr:"Style pixel art r√©tro 16 bits"},prompt:"16-bit pixel art style, low resolution, limited color palette, detailed sprite work, retro video game aesthetic, style of Final Fantasy VI"},{id:"lowpoly",name:{en:"Low Poly",de:"Low Poly",fr:"Low Poly"},emoji:"üî∑",image:"/images/low poly 3-D style.jpg",description:{en:"Minimalist geometric 3D style",de:"Minimalistischer geometrischer 3D-Stil",fr:"Style 3D g√©om√©trique minimaliste"},prompt:"Low poly 3D model, isometric perspective, minimalist geometric shapes, vibrant solid colors, clear edges, retro video game aesthetic, style of Monument Valley"}];function nn({selectedStyle:t,onSelect:a}){const{language:i}=ze();return e.jsx("div",{id:"art-style-section",children:e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 lg:grid-cols-7 gap-2",children:Ls.map(h=>e.jsxs("button",{onClick:()=>a(h.id),className:`rounded-lg border-2 transition-all overflow-hidden flex flex-col bg-white ${t===h.id?"border-indigo-600 shadow-lg ring-2 ring-indigo-200":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"relative w-full h-32 overflow-hidden",children:e.jsx("img",{src:h.image,alt:h.name[i],className:"w-full h-full object-contain"})}),e.jsx("div",{className:"p-1.5 flex flex-col items-center text-center",children:e.jsx("div",{className:"font-bold text-xs text-gray-800",children:h.name[i]})})]},h.id))})})}const Mr=[{value:{en:"Best Friends with",de:"Beste Freunde mit",fr:"Meilleurs amis avec"},inverse:{en:"Best Friends with",de:"Beste Freunde mit",fr:"Meilleurs amis avec"}},{value:{en:"Friends with",de:"Freunde mit",fr:"Amis avec"},inverse:{en:"Friends with",de:"Freunde mit",fr:"Amis avec"}},{value:{en:"Married to",de:"Verheiratet mit",fr:"Mari√©(e) √†"},inverse:{en:"Married to",de:"Verheiratet mit",fr:"Mari√©(e) √†"}},{value:{en:"In a relationship with",de:"In einer Beziehung mit",fr:"En relation avec"},inverse:{en:"In a relationship with",de:"In einer Beziehung mit",fr:"En relation avec"}},{value:{en:"Older Sibling of",de:"√Ñlteres Geschwister von",fr:"Fr√®re/S≈ìur a√Æn√©(e) de"},inverse:{en:"Younger Sibling of",de:"J√ºngeres Geschwister von",fr:"Fr√®re/S≈ìur cadet(te) de"}},{value:{en:"Younger Sibling of",de:"J√ºngeres Geschwister von",fr:"Fr√®re/S≈ìur cadet(te) de"},inverse:{en:"Older Sibling of",de:"√Ñlteres Geschwister von",fr:"Fr√®re/S≈ìur a√Æn√©(e) de"}},{value:{en:"Parent of",de:"Elternteil von",fr:"Parent de"},inverse:{en:"Child of",de:"Kind von",fr:"Enfant de"}},{value:{en:"Child of",de:"Kind von",fr:"Enfant de"},inverse:{en:"Parent of",de:"Elternteil von",fr:"Parent de"}},{value:{en:"Rivals with",de:"Rivalen mit",fr:"Rivaux avec"},inverse:{en:"Rivals with",de:"Rivalen mit",fr:"Rivaux avec"}},{value:{en:"Neighbors with",de:"Nachbarn mit",fr:"Voisins avec"},inverse:{en:"Neighbors with",de:"Nachbarn mit",fr:"Voisins avec"}},{value:{en:"Not Known to",de:"Nicht bekannt mit",fr:"Pas connu de"},inverse:{en:"Not Known to",de:"Nicht bekannt mit",fr:"Pas connu de"}}];function Gs(t){const a=Mr.find(i=>i.value.en==="Not Known to");return a?a.value[t]:"Not Known to"}function Ts(t){const a=Mr.find(i=>i.value.en==="Not Known to");return a?t===a.value.en||t===a.value.de||t===a.value.fr:!1}function _s(t,a,i=[]){for(const h of Mr)if(h.value[a]===t)return h.inverse[a];for(const h of i){if(h.forward===t)return h.inverse;if(h.inverse===t)return h.forward}return t}function ln({characters:t,showSuccessMessage:a,mainCharacters:i=[],excludedCharacters:h=[],onCharacterRoleChange:s,onEdit:w,onDelete:l,onCreateAnother:c}){const{t:f,language:v}=ze(),[$,O]=g.useState(null),S=x=>h.includes(x)?"out":i.includes(x)?"main":"in",y={out:v==="de"?"Nicht dabei":v==="fr"?"Absent":"Out",in:v==="de"?"Dabei":v==="fr"?"Pr√©sent":"In",main:v==="de"?"Hauptrolle":v==="fr"?"Principal":"Main"},D=x=>{O({id:x.id,name:x.name})},T=()=>{$&&(l($.id),O(null))},B=()=>{O(null)};return t.length===0?null:e.jsxs("div",{className:"space-y-4",children:[a&&e.jsx("div",{className:"md:bg-green-50 md:border-2 md:border-green-400 md:rounded-xl p-4 animate-fade-in",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center",children:e.jsx(Ma,{size:20})}),e.jsx("h3",{className:"text-lg font-bold text-green-700",children:v==="de"?"Charakter erfolgreich erstellt!":v==="fr"?"Personnage cre avec succes!":"Character Created Successfully!"})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-2",children:[t.map(x=>{var ae,le,re,me;const A=S(x.id),H=A==="out",z=A==="in",J=A==="main",_=t.filter(ue=>!h.includes(ue.id)),F=!H&&_.length===1;return e.jsxs("div",{className:`border rounded p-2 transition-all ${H?"border-dashed border-gray-300 bg-gray-50 opacity-60":J?"border-2 border-indigo-600 bg-indigo-50":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(((ae=x.photos)==null?void 0:ae.face)||((le=x.photos)==null?void 0:le.original))&&e.jsx("img",{src:((re=x.photos)==null?void 0:re.face)||((me=x.photos)==null?void 0:me.original),alt:x.name,className:`w-10 h-10 md:w-12 md:h-12 rounded-full object-cover border-2 border-indigo-200 flex-shrink-0 ${H?"grayscale":""}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h4",{className:"font-bold text-sm md:text-base truncate flex items-center gap-1",children:[x.name,J&&e.jsx(Hr,{size:14,className:"text-indigo-600 fill-indigo-600 flex-shrink-0"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[x.gender==="male"?f.male:x.gender==="female"?f.female:f.other,","," ",x.age," ",v==="de"?"J":v==="fr"?"ans":"y"]})]})]}),e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>w(x),className:"bg-indigo-600 text-white p-1.5 rounded text-xs hover:bg-indigo-700",title:f.editCharacter,children:e.jsx(Fa,{size:14})}),e.jsx("button",{onClick:()=>D(x),className:"bg-red-500 text-white p-1.5 rounded text-xs hover:bg-red-600",title:f.deleteCharacter,children:e.jsx(Ea,{size:14})})]})]}),s&&e.jsxs("div",{className:"flex rounded-lg overflow-hidden border border-gray-300",children:[e.jsx("button",{onClick:()=>s(x.id,"out"),disabled:F,title:F?v==="de"?"Mindestens ein Charakter muss in der Geschichte sein":v==="fr"?"Au moins un personnage doit √™tre dans l'histoire":"At least one character must be in the story":void 0,className:`flex-1 px-2 py-1.5 text-xs font-medium transition-colors ${H?"bg-gray-500 text-white":F?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-600 hover:bg-gray-100"}`,children:y.out}),e.jsx("button",{onClick:()=>s(x.id,"in"),className:`flex-1 px-2 py-1.5 text-xs font-medium transition-colors border-l border-r border-gray-300 ${z?"bg-indigo-600 text-white":"bg-white text-gray-600 hover:bg-gray-100"}`,children:y.in}),e.jsxs("button",{onClick:()=>s(x.id,"main"),className:`flex-1 px-2 py-1.5 text-xs font-medium transition-colors flex items-center justify-center gap-1 ${J?"bg-indigo-600 text-white":"bg-white text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(Hr,{size:12,className:J?"fill-white":""}),y.main]})]})]},x.id)}),e.jsxs("button",{onClick:c,className:"border-2 border-dashed border-indigo-300 rounded p-4 flex flex-col items-center justify-center gap-2 hover:border-indigo-500 hover:bg-indigo-50 transition-colors min-h-[100px]",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx(Dr,{size:24,className:"text-indigo-600"})}),e.jsx("span",{className:"text-sm font-medium text-indigo-600",children:v==="de"?"Weiteren Charakter erstellen":v==="fr"?"Cr√©er un autre personnage":"Create Another Character"})]})]}),$&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"bg-red-100 text-red-600 rounded-full p-2",children:e.jsx(Ms,{size:24})}),e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:v==="de"?"Charakter l√∂schen?":v==="fr"?"Supprimer le personnage?":"Delete Character?"})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:v==="de"?`M√∂chtest du "${$.name}" wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.`:v==="fr"?`Voulez-vous vraiment supprimer "${$.name}"? Cette action est irr√©versible.`:`Are you sure you want to delete "${$.name}"? This action cannot be undone.`}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:B,className:"flex-1 px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:v==="de"?"Abbrechen":v==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:T,className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 font-medium",children:v==="de"?"L√∂schen":v==="fr"?"Supprimer":"Delete"})]})]})})]})}function Xt({label:t,traits:a,selectedTraits:i,onSelect:h,minRequired:s=0,allowCustom:w=!0,defaultExpanded:l=!1}){const{t:c,language:f}=ze(),[v,$]=g.useState(""),[O,S]=g.useState(l),[y,D]=g.useState([]),T=z=>{i.includes(z)?h(i.filter(J=>J!==z)):h([...i,z])},B=()=>{if(v.trim()&&!i.includes(v.trim())){const z=v.trim();D([...y,z]),h([...i,z]),$("")}},x=i.filter(z=>!a.includes(z)),A=[...new Set([...y,...x])],H=[...a,...A];return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>S(!O),className:"flex items-center gap-1 mb-2 group cursor-pointer text-left",children:[O?e.jsx(xr,{size:18,className:"text-indigo-500"}):e.jsx(Ra,{size:18,className:"text-gray-400 group-hover:text-indigo-500"}),e.jsx("span",{className:"text-lg font-semibold text-gray-800",children:t}),s>0&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-1",children:["(",c.selectAtLeast," ",s,")"]}),i.length>0&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-1",children:["- ",i.length," ",f==="de"?"gew√§hlt":f==="fr"?"s√©lectionn√©":"selected"]})]}),!O&&i.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 ml-5",children:i.map(z=>e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-indigo-100 text-indigo-700 border border-indigo-200",children:z},z))}),!O&&i.length===0&&e.jsx("div",{className:"ml-5 text-sm text-gray-400 italic",children:f==="de"?"Klicken zum Ausw√§hlen...":f==="fr"?"Cliquer pour s√©lectionner...":"Click to select..."}),O&&e.jsxs("div",{className:"ml-5",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:H.map(z=>e.jsx("button",{onClick:()=>T(z),className:`px-3 py-1 rounded-full text-sm transition-colors ${i.includes(z)?"bg-indigo-500 text-white":"bg-gray-200 text-gray-800 hover:bg-gray-300"}`,children:z},z))}),w&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:v,onChange:z=>$(z.target.value),onKeyDown:z=>z.key==="Enter"&&B(),placeholder:f==="de"?"Eigene hinzuf√ºgen...":f==="fr"?"Ajouter personnalis√©...":"Add custom...",className:"flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none"}),e.jsx("button",{onClick:B,disabled:!v.trim(),className:`flex-shrink-0 w-10 h-10 rounded-lg font-semibold flex items-center justify-center transition-colors ${v.trim()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:e.jsx(Dr,{size:18})})]})]})]})}function Cs({character:t,allCharacters:a,relationships:i,relationshipTexts:h,onRelationshipChange:s,onRelationshipTextChange:w,customRelationships:l=[],onAddCustomRelationship:c}){var B,x;const{language:f}=ze(),v=f,$=a.filter(A=>A.id!==t.id);if($.length===0)return null;const O=[...Mr,...l.map(A=>({value:{en:A.forward,de:A.forward,fr:A.forward},inverse:{en:A.inverse,de:A.inverse,fr:A.inverse}}))],S=(A,H,z)=>{if(z==="__CREATE_CUSTOM__"){const J=prompt(f==="de"?'Beziehung eingeben (z.B. "Onkel"):':f==="fr"?'Entrer la relation (ex. "oncle"):':'Enter relationship (e.g. "uncle"):');if(J&&J.trim()){const _=prompt(f==="de"?`Was ist die umgekehrte Beziehung? (z.B. wenn "${J.trim()}" dann vielleicht "Neffe/Nichte"):`:f==="fr"?`Quelle est la relation inverse? (ex. si "${J.trim()}" alors peut-√™tre "neveu/ni√®ce"):`:`What is the inverse relationship? (e.g. if "${J.trim()}" then maybe "nephew/niece"):`);_&&_.trim()&&(c==null||c(J.trim(),_.trim()),s(A,H,J.trim()))}}else s(A,H,z)},y=(A,H)=>A<H?`${A}-${H}`:`${H}-${A}`,D={relationships:f==="de"?"Beziehungen":f==="fr"?"Relations":"Relationships",detailsPlaceholder:f==="de"?"Details...":f==="fr"?"D√©tails...":"Details..."},T=((B=t.photos)==null?void 0:B.face)||((x=t.photos)==null?void 0:x.original);return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:D.relationships}),e.jsx("div",{className:"space-y-3",children:$.map(A=>{var me,ue;const H=`${t.id}-${A.id}`,z=`${A.id}-${t.id}`,J=i[H],_=J&&!Ts(J),F=J?_s(J,v,l):null,ae=y(t.id,A.id),le=h[ae]||"",re=((me=A.photos)==null?void 0:me.face)||((ue=A.photos)==null?void 0:ue.original);return e.jsx("div",{className:`rounded-lg p-3 md:p-4 w-full ${_?"bg-blue-50 border-2 border-blue-300":"bg-white border-[3px] border-red-500"}`,children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4 w-full",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[T&&e.jsx("img",{src:T,alt:t.name,className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold text-xs md:text-sm text-center max-w-[60px] sm:max-w-[80px] md:max-w-[100px] truncate",children:t.name})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsxs("select",{value:J||Gs(v),onChange:W=>S(t.id,A.id,W.target.value),className:`w-full px-3 py-2 md:px-4 md:py-2.5 border rounded text-sm md:text-base font-medium text-center ${_?"bg-blue-100 border-blue-400":"bg-white border-red-400 border-2"}`,children:[e.jsxs("option",{value:"__CREATE_CUSTOM__",children:["+ ",v==="de"?"Eigene":v==="fr"?"Personnalis√©":"Custom"]}),O.map((W,p)=>e.jsx("option",{value:W.value[v],children:W.value[v]},p))]}),_&&F&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Ba,{size:12,className:"text-blue-400"}),e.jsx("span",{children:A.name}),e.jsx("span",{className:"font-medium text-blue-600",children:F}),e.jsx("span",{children:t.name})]}),_&&e.jsx("input",{type:"text",value:le,onChange:W=>{w(H,W.target.value),w(z,W.target.value)},placeholder:D.detailsPlaceholder,className:"w-full px-3 py-1.5 md:px-4 md:py-2 border border-blue-300 rounded text-xs md:text-sm text-center bg-white"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[re&&e.jsx("img",{src:re,alt:A.name,className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold text-xs md:text-sm text-center max-w-[60px] sm:max-w-[80px] md:max-w-[100px] truncate",children:A.name})]})]})},A.id)})})]})}const on={en:["Cheerful","Kind","Caring","Funny","Forgiving","Protective","Loyal","Generous","Fair-minded","Honest","Confident","Brave","Trustworthy","Determined","Hardworking","Leader","Patient","Curious","Imaginative","Smart","Creative","Observant","Resourceful","Energetic","Fast","Strong","Adventurous"],de:["Fr√∂hlich","Freundlich","Hilfsbereit","Lustig","Nachsichtig","Besch√ºtzend","Treu","Grossz√ºgig","Gerecht","Ehrlich","Selbstbewusst","Mutig","Vertrauensw√ºrdig","Entschlossen","Fleissig","Leader","Geduldig","Neugierig","Fantasievoll","Klug","Kreativ","Aufmerksam","Einfallsreich","Energiegeladen","Schnell","Stark","Abenteuerlustig"],fr:["Joyeux","Gentil","Attentionn√©","Dr√¥le","Indulgent","Protecteur","Loyal","G√©n√©reux","√âquitable","Honn√™te","Confiant","Courageux","Digne de confiance","D√©termin√©","Travailleur","Leader","Patient","Curieux","Imaginatif","Intelligent","Cr√©atif","Observateur","D√©brouillard","√ânergique","Rapide","Fort","Aventureux"]},dn={en:["Impatient","Distracted","Talkative","Whiny","Messy","Forgetful","Tattletale","Sore Loser","Stubborn","Lying","Bossy","Gullible","Jealous","Easily scared","Clingy","Quick-tempered","Selfish","Sneaky","Reckless","Shy","Clumsy","Lazy","Boastful","Indecisive","Perfectionist"],de:["Ungeduldig","Zerstreut","Gespr√§chig","Weinerlich","Unordentlich","Vergesslich","Petze","Schlechter Verlierer","Stur","L√ºgnerisch","Rechthaberisch","Leichtgl√§ubig","Eifers√ºchtig","√Ñngstlich","Anh√§nglich","J√§hzornig","Egoistisch","Hinterlistig","Leichtsinnig","Sch√ºchtern","Tollpatschig","Faul","Prahlerisch","Unentschlossen","Perfektionist"],fr:["Impatient","Distrait","Bavard","Pleurnicheur","D√©sordonn√©","Oublieux","Rapporteur","Mauvais perdant","T√™tu","Menteur","Autoritaire","Cr√©dule","Jaloux","Facilement effray√©","Collant","Col√©rique","√âgo√Øste","Sournois","Imprudent","Timide","Maladroit","Paresseux","Vantard","Ind√©cis","Perfectionniste"]},cn={en:["Following rules","Controlling emotions","Sharing with others","Tests and grades","Making new friends","Speaking in public","Trying new things","Accepting and asking for help","Dealing with change","Standing up for oneself","Fear of the dark","Bad dreams and nightmares","Monsters, ghosts and things under the bed","Fear of being alone","Fear of getting lost","Doctors, dentists and shots","Fear of heights","Fear of spiders","Fear of loud noises"],de:["Regeln befolgen","Gef√ºhle kontrollieren","Mit anderen teilen","Pr√ºfungsangst","Neue Freunde finden","Vor anderen sprechen","Neues ausprobieren","Hilfe annehmen und darum bitten","Mit Ver√§nderungen umgehen","F√ºr sich einstehen","Angst vor der Dunkelheit","Albtr√§ume und schlechte Tr√§ume","Monster, Geister und Dinge unter dem Bett","Angst allein zu sein","Angst sich zu verlaufen","√Ñrzte, Zahn√§rzte und Spritzen","H√∂henangst","Angst vor Spinnen","Angst vor lauten Ger√§uschen"],fr:["Suivre les r√®gles","Contr√¥ler ses √©motions","Partager avec les autres","Examens et notes","Se faire de nouveaux amis","Parler en public","Essayer de nouvelles choses","Accepter et demander de l'aide","G√©rer le changement","Se d√©fendre","Peur du noir","Cauchemars et mauvais r√™ves","Monstres, fant√¥mes et choses sous le lit","Peur d'√™tre seul","Peur de se perdre","M√©decins, dentistes et piq√ªres","Peur du vide","Peur des araign√©es","Peur des bruits forts"]},As=on,Ps=dn,Ds=cn;function qr(t){const a=`avatar_regen_${t}`,i=localStorage.getItem(a),h=Date.now();if(!i)return{canRegenerate:!0,waitSeconds:0,attempts:0};try{const{attempts:s,lastAttempt:w}=JSON.parse(i);let l=0;s>=2&&s<4?l=30*1e3:s>=4&&s<6?l=60*1e3:s>=6&&s<8?l=120*1e3:s>=8&&s<10?l=300*1e3:s>=10&&(l=600*1e3);const c=h-w;return c>=l?{canRegenerate:!0,waitSeconds:0,attempts:s}:{canRegenerate:!1,waitSeconds:Math.ceil((l-c)/1e3),attempts:s}}catch{return{canRegenerate:!0,waitSeconds:0,attempts:0}}}function mn(t){const a=`avatar_regen_${t}`,i=localStorage.getItem(a),h=Date.now();let s=1;if(i)try{s=(JSON.parse(i).attempts||0)+1}catch{}localStorage.setItem(a,JSON.stringify({attempts:s,lastAttempt:h}))}function un(t){const[a,i]=g.useState(()=>qr(t));g.useEffect(()=>{if(a.waitSeconds>0){const s=setInterval(()=>{i(qr(t))},1e3);return()=>clearInterval(s)}},[a.waitSeconds,t]);const h=g.useCallback(()=>{mn(t),i(qr(t))},[t]);return{...a,recordRegeneration:h}}const gn=[{value:"infant",label:"Infant",labelDe:"S√§ugling",labelFr:"Nourrisson"},{value:"toddler",label:"Toddler",labelDe:"Kleinkind",labelFr:"Bambin"},{value:"preschooler",label:"Preschooler",labelDe:"Vorschulkind",labelFr:"Pr√©scolaire"},{value:"kindergartner",label:"Kindergartner",labelDe:"Kindergartenkind",labelFr:"Maternelle"},{value:"young-school-age",label:"Young School-Age",labelDe:"Junges Schulkind",labelFr:"Jeune √©colier"},{value:"school-age",label:"School-Age",labelDe:"Schulkind",labelFr:"√âcolier"},{value:"preteen",label:"Preteen",labelDe:"Vorpubert√§r",labelFr:"Pr√©adolescent"},{value:"young-teen",label:"Young Teen",labelDe:"Junger Teen",labelFr:"Jeune ado"},{value:"teenager",label:"Teenager",labelDe:"Teenager",labelFr:"Adolescent"},{value:"young-adult",label:"Young Adult",labelDe:"Junger Erwachsener",labelFr:"Jeune adulte"},{value:"adult",label:"Adult",labelDe:"Erwachsener",labelFr:"Adulte"},{value:"middle-aged",label:"Middle-Aged",labelDe:"Mittleres Alter",labelFr:"√Çge moyen"},{value:"senior",label:"Senior",labelDe:"Senior",labelFr:"Senior"},{value:"elderly",label:"Elderly",labelDe:"Hochbetagt",labelFr:"√Çg√©"}],xn=[{value:"slim",label:"Slim",labelDe:"Schlank",labelFr:"Mince"},{value:"average",label:"Average",labelDe:"Durchschnitt",labelFr:"Moyen"},{value:"athletic",label:"Athletic",labelDe:"Athletisch",labelFr:"Athl√©tique"},{value:"stocky",label:"Stocky",labelDe:"St√§mmig",labelFr:"Trapu"},{value:"petite",label:"Petite",labelDe:"Zierlich",labelFr:"Petit"},{value:"tall",label:"Tall",labelDe:"Gross",labelFr:"Grand"},{value:"heavy",label:"Heavy",labelDe:"Kr√§ftig",labelFr:"Corpulent"}],hn=[{value:"bald",label:"Bald",labelDe:"Glatze",labelFr:"Chauve"},{value:"balding",label:"Balding",labelDe:"Halbglatze",labelFr:"D√©garni"},{value:"thinning",label:"Thinning",labelDe:"D√ºnnes Haar",labelFr:"Clairsem√©"},{value:"buzz cut",label:"Buzz Cut",labelDe:"Sehr kurz",labelFr:"Tr√®s court"},{value:"cropped",label:"Cropped",labelDe:"Kurz",labelFr:"Court"},{value:"pixie",label:"Pixie",labelDe:"Pixie",labelFr:"Pixie"},{value:"ear-length",label:"Ear-Length",labelDe:"Ohrlang",labelFr:"Aux oreilles"},{value:"chin-length",label:"Chin-Length",labelDe:"Kinnlang",labelFr:"Au menton"},{value:"neck-length",label:"Neck-Length",labelDe:"Nackenlang",labelFr:"Au cou"},{value:"shoulder-length",label:"Shoulder-Length",labelDe:"Schulterlang",labelFr:"Aux √©paules"},{value:"armpit-length",label:"Armpit-Length",labelDe:"Achsellang",labelFr:"Aux aisselles"},{value:"mid-back",label:"Mid-Back",labelDe:"R√ºckenmitte",labelFr:"Mi-dos"},{value:"waist-length",label:"Waist-Length",labelDe:"H√ºftlang",labelFr:"Aux hanches"}],pn=[{value:"black",label:"Black",labelDe:"Schwarz",labelFr:"Noir"},{value:"dark brown",label:"Dark Brown",labelDe:"Dunkelbraun",labelFr:"Brun fonc√©"},{value:"brown",label:"Brown",labelDe:"Braun",labelFr:"Brun"},{value:"light brown",label:"Light Brown",labelDe:"Hellbraun",labelFr:"Ch√¢tain clair"},{value:"chestnut",label:"Chestnut",labelDe:"Kastanienbraun",labelFr:"Ch√¢tain"},{value:"auburn",label:"Auburn",labelDe:"Rotbraun",labelFr:"Auburn"},{value:"red",label:"Red",labelDe:"Rot",labelFr:"Roux"},{value:"strawberry blonde",label:"Strawberry Blonde",labelDe:"Erdbeerblond",labelFr:"Blond v√©nitien"},{value:"dark blonde",label:"Dark Blonde",labelDe:"Dunkelblond",labelFr:"Blond fonc√©"},{value:"blonde",label:"Blonde",labelDe:"Blond",labelFr:"Blond"},{value:"light blonde",label:"Light Blonde",labelDe:"Hellblond",labelFr:"Blond clair"},{value:"platinum blonde",label:"Platinum Blonde",labelDe:"Platinblond",labelFr:"Blond platine"},{value:"gray",label:"Gray",labelDe:"Grau",labelFr:"Gris"},{value:"silver",label:"Silver",labelDe:"Silber",labelFr:"Argent√©"},{value:"white",label:"White",labelDe:"Weiss",labelFr:"Blanc"},{value:"salt and pepper",label:"Salt and Pepper",labelDe:"Graumeliert",labelFr:"Poivre et sel"}],fn=[{value:"straight",label:"Straight",labelDe:"Glatt",labelFr:"Lisse"},{value:"wavy",label:"Wavy",labelDe:"Wellig",labelFr:"Ondul√©"},{value:"curly",label:"Curly",labelDe:"Lockig",labelFr:"Boucl√©"},{value:"coily",label:"Coily",labelDe:"Kraus",labelFr:"Cr√©pu"},{value:"messy",label:"Messy",labelDe:"Zerzaust",labelFr:"√âbouriff√©"},{value:"spiky",label:"Spiky",labelDe:"Stachelig",labelFr:"En pointes"},{value:"layered",label:"Layered",labelDe:"Gestuft",labelFr:"D√©grad√©"},{value:"slicked back",label:"Slicked Back",labelDe:"Zur√ºckgek√§mmt",labelFr:"Plaqu√©"},{value:"loose",label:"Loose",labelDe:"Offen",labelFr:"L√¢che"},{value:"ponytail",label:"Ponytail",labelDe:"Pferdeschwanz",labelFr:"Queue de cheval"},{value:"braids",label:"Braids",labelDe:"Z√∂pfe",labelFr:"Tresses"},{value:"bun",label:"Bun",labelDe:"Dutt",labelFr:"Chignon"},{value:"pigtails",label:"Pigtails",labelDe:"Z√∂pfchen",labelFr:"Couettes"},{value:"bob",label:"Bob",labelDe:"Bob",labelFr:"Carr√©"},{value:"afro",label:"Afro",labelDe:"Afro",labelFr:"Afro"},{value:"mohawk",label:"Mohawk",labelDe:"Irokese",labelFr:"Cr√™te"},{value:"mullet",label:"Mullet",labelDe:"Vokuhila",labelFr:"Mulet"},{value:"undercut",label:"Undercut",labelDe:"Undercut",labelFr:"Undercut"},{value:"bangs",label:"Bangs",labelDe:"Pony",labelFr:"Frange"},{value:"side bangs",label:"Side Bangs",labelDe:"Seitenpony",labelFr:"Frange de c√¥t√©"}],bn=[{value:"none",label:"None",labelDe:"Keiner",labelFr:"Aucune"},{value:"clean-shaven",label:"Clean Shaven",labelDe:"Glatt rasiert",labelFr:"Ras√© de pr√®s"},{value:"stubble",label:"Stubble",labelDe:"Stoppeln",labelFr:"Barbe de 3 jours"},{value:"mustache",label:"Mustache",labelDe:"Schnurrbart",labelFr:"Moustache"},{value:"goatee",label:"Goatee",labelDe:"Ziegenbart",labelFr:"Bouc"},{value:"short beard",label:"Short Beard",labelDe:"Kurzer Bart",labelFr:"Barbe courte"},{value:"full beard",label:"Full Beard",labelDe:"Vollbart",labelFr:"Barbe compl√®te"},{value:"long beard",label:"Long Beard",labelDe:"Langer Bart",labelFr:"Longue barbe"}];function Cr({label:t,value:a,placeholder:i,onChange:h,isChanged:s,isAiExtracted:w}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${w?"text-gray-400":"text-gray-600"}`,children:[t,":"]}),e.jsx("input",{type:"text",value:a,onChange:l=>h(l.target.value),className:`flex-1 min-w-0 px-2 py-1 text-sm border rounded focus:outline-none focus:border-indigo-400 hover:border-gray-300 ${s?"border-amber-400 bg-amber-50 text-amber-800":w?"border-gray-200 bg-gray-50 text-gray-500":"border-gray-200 bg-white"}`,placeholder:i}),s&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed from previous photo",children:"‚óè"})]})}function Is({character:t,language:a,updatePhysical:i,updateApparentAge:h,changedTraits:s,isAiExtracted:w}){var f,v,$,O,S,y,D,T,B;const l=w?"text-gray-400":"text-gray-600",c=x=>`flex-1 min-w-0 px-2 py-1 text-sm border rounded focus:outline-none focus:border-indigo-400 hover:border-gray-300 ${x?"border-amber-400 bg-amber-50":w?"border-gray-200 bg-gray-50 text-gray-500":"border-gray-200 bg-white"}`;return e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1.5 text-xs",children:[e.jsx(Cr,{label:a==="de"?"Augenfarbe":a==="fr"?"Couleur des yeux":"Eye Color",value:((f=t.physical)==null?void 0:f.eyeColor)||"",placeholder:a==="de"?"z.B. blau":"e.g. blue",onChange:x=>i("eyeColor",x),isAiExtracted:w,isChanged:s==null?void 0:s.eyeColor}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${l}`,children:[a==="de"?"Visuelles Alter":a==="fr"?"√Çge visuel":"Visual Age",":"]}),e.jsxs("select",{value:t.apparentAge||zr(t.age)||"",onChange:x=>h(x.target.value),className:c(s==null?void 0:s.apparentAge),children:[e.jsx("option",{value:"",children:"‚Äî Auto ‚Äî"}),gn.map(x=>e.jsx("option",{value:x.value,children:a==="de"?x.labelDe:a==="fr"?x.labelFr:x.label},x.value))]}),(s==null?void 0:s.apparentAge)&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"‚óè"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${l}`,children:[a==="de"?"Haarfarbe":a==="fr"?"Couleur":"Hair Color",":"]}),e.jsxs("select",{value:((v=t.physical)==null?void 0:v.hairColor)||"",onChange:x=>i("hairColor",x.target.value),className:c(s==null?void 0:s.hairColor),children:[e.jsx("option",{value:"",children:a==="de"?"‚Äî W√§hlen ‚Äî":a==="fr"?"‚Äî Choisir ‚Äî":"‚Äî Select ‚Äî"}),pn.map(x=>e.jsx("option",{value:x.value,children:a==="de"?x.labelDe:a==="fr"?x.labelFr:x.label},x.value))]}),(s==null?void 0:s.hairColor)&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"‚óè"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${l}`,children:[a==="de"?"Haarl√§nge":a==="fr"?"Longueur":"Hair Length",":"]}),e.jsxs("select",{value:(($=t.physical)==null?void 0:$.hairLength)||"",onChange:x=>i("hairLength",x.target.value),className:c(s==null?void 0:s.hairLength),children:[e.jsx("option",{value:"",children:a==="de"?"‚Äî W√§hlen ‚Äî":a==="fr"?"‚Äî Choisir ‚Äî":"‚Äî Select ‚Äî"}),hn.map(x=>e.jsx("option",{value:x.value,children:a==="de"?x.labelDe:a==="fr"?x.labelFr:x.label},x.value))]}),(s==null?void 0:s.hairLength)&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"‚óè"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${l}`,children:[a==="de"?"Frisur":a==="fr"?"Coiffure":"Hair Style",":"]}),e.jsxs("select",{value:((O=t.physical)==null?void 0:O.hairStyle)||"",onChange:x=>i("hairStyle",x.target.value),className:c(s==null?void 0:s.hairStyle),children:[e.jsx("option",{value:"",children:a==="de"?"‚Äî W√§hlen ‚Äî":a==="fr"?"‚Äî Choisir ‚Äî":"‚Äî Select ‚Äî"}),fn.map(x=>e.jsx("option",{value:x.value,children:a==="de"?x.labelDe:a==="fr"?x.labelFr:x.label},x.value))]}),(s==null?void 0:s.hairStyle)&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"‚óè"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${l}`,children:[a==="de"?"K√∂rperbau":a==="fr"?"Corpulence":"Build",":"]}),e.jsxs("select",{value:((S=t.physical)==null?void 0:S.build)||"",onChange:x=>i("build",x.target.value),className:c(s==null?void 0:s.build),children:[e.jsx("option",{value:"",children:a==="de"?"‚Äî W√§hlen ‚Äî":a==="fr"?"‚Äî Choisir ‚Äî":"‚Äî Select ‚Äî"}),xn.map(x=>e.jsx("option",{value:x.value,children:a==="de"?x.labelDe:a==="fr"?x.labelFr:x.label},x.value))]}),(s==null?void 0:s.build)&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"‚óè"})]}),e.jsx(Cr,{label:a==="de"?"Gesicht":a==="fr"?"Visage":"Face",value:((y=t.physical)==null?void 0:y.face)||"",placeholder:a==="de"?"z.B. rund":"e.g. round",onChange:x=>i("face",x),isAiExtracted:w,isChanged:s==null?void 0:s.face}),t.gender!=="female"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium text-xs whitespace-nowrap ${l}`,children:[a==="de"?"Bart":a==="fr"?"Barbe":"Facial Hair",":"]}),e.jsxs("select",{value:((D=t.physical)==null?void 0:D.facialHair)||"",onChange:x=>i("facialHair",x.target.value),className:c(s==null?void 0:s.facialHair),children:[e.jsx("option",{value:"",children:a==="de"?"‚Äî W√§hlen ‚Äî":a==="fr"?"‚Äî Choisir ‚Äî":"‚Äî Select ‚Äî"}),bn.map(x=>e.jsx("option",{value:x.value,children:a==="de"?x.labelDe:a==="fr"?x.labelFr:x.label},x.value))]}),(s==null?void 0:s.facialHair)&&e.jsx("span",{className:"text-amber-500 text-xs",title:"Changed",children:"‚óè"})]}):e.jsx(Cr,{label:a==="de"?"Sonstiges":a==="fr"?"Autre":"Other",value:((T=t.physical)==null?void 0:T.other)||"",placeholder:a==="de"?"z.B. Brille":"e.g. glasses",onChange:x=>i("other",x),isAiExtracted:w,isChanged:s==null?void 0:s.other}),t.gender!=="female"&&e.jsx("div",{className:"col-span-2",children:e.jsx(Cr,{label:a==="de"?"Sonstiges":a==="fr"?"Autre":"Other",value:((B=t.physical)==null?void 0:B.other)||"",placeholder:a==="de"?"z.B. Brille":"e.g. glasses",onChange:x=>i("other",x),isAiExtracted:w,isChanged:s==null?void 0:s.other})})]})}function $s({character:t,allCharacters:a=[],onChange:i,onSave:h,onCancel:s,onPhotoChange:w,onContinueToTraits:l,onContinueToCharacteristics:c,onContinueToRelationships:f,isNewCharacter:v=!1,onSaveAndGenerateAvatar:$,onSaveAndRegenerateWithTraits:O,onRegenerateAvatars:S,onRegenerateAvatarsWithTraits:y,isLoading:D,isAnalyzingPhoto:T,isGeneratingAvatar:B,isRegeneratingAvatars:x,isRegeneratingAvatarsWithTraits:A,step:H,developerMode:z,changedTraits:J,photoAnalysisDebug:_,relationships:F={},relationshipTexts:ae={},onRelationshipChange:le,onRelationshipTextChange:re,customRelationships:me=[],onAddCustomRelationship:ue}){var xe,se,ie,rt,st,bt,Ee,Tt,yt,vt,Ye,jt,Nt,_t,at,wt,He,St,ct,Ot,Se,mt,qe,$e,nt,Ft,zt,qt,it,Ze,Mt,Xe,Ve,Ke,We,Te,et,lt,Qt,Fe,tt,Et,_e,Be,Oe,Bt,ut,kt,Ct,Re,Ue,Ht,gt;const{t:W,language:p}=ze(),[pe,X]=g.useState(!1),[Y,oe]=g.useState(null),[ge,ye]=g.useState(!1),N=M=>{var E;const r=(E=M.target.files)==null?void 0:E[0];r&&w(r)},L=(M,r)=>{i(M==="age"&&typeof r=="string"?{...t,[M]:r,ageCategory:zr(r)}:{...t,[M]:r})},U=(M,r)=>{i({...t,physical:{...t.physical,[M]:r}})},K=(M,r)=>{i({...t,traits:{...t.traits,[M]:r}})},{canRegenerate:Pe,waitSeconds:je,recordRegeneration:dt}=un(t.id),Ce=()=>{Pe&&(dt(),y==null||y())},n=t.name&&t.name.trim().length>=2,Ge=t.name&&((xe=t.traits)==null?void 0:xe.strengths)&&t.traits.strengths.length>=3&&((se=t.traits)==null?void 0:se.flaws)&&t.traits.flaws.length>=2,ne=As[p]||As.en,fe=Ps[p]||Ps.en,Z=Ds[p]||Ds.en,ee=((ie=t.photos)==null?void 0:ie.face)||((rt=t.photos)==null?void 0:rt.original);return H==="name"?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"flex-1 min-w-0 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[T?e.jsx("div",{className:"w-24 h-24 rounded-full bg-indigo-100 border-4 border-indigo-400 shadow-lg flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] text-indigo-600 font-medium",children:p==="de"?"Analysiere...":p==="fr"?"Analyse...":"Analyzing..."})]})}):ee?e.jsx("img",{src:ee,alt:"Character",className:"w-24 h-24 rounded-full object-cover border-4 border-indigo-400 shadow-lg cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>oe(ee),title:p==="de"?"Klicken zum Vergr√∂ssern":"Click to enlarge"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-200 border-4 border-gray-300 flex items-center justify-center",children:e.jsx(gr,{size:24,className:"text-gray-400"})}),e.jsxs("label",{className:"cursor-pointer bg-gray-200 text-gray-700 px-3 py-1.5 rounded-lg text-xs hover:bg-gray-300 flex items-center gap-1.5 font-semibold transition-colors",children:[e.jsx(gr,{size:12}),p==="de"?"√Ñndern":p==="fr"?"Changer":"Change",e.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"hidden"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-semibold mb-1 text-gray-700",children:p==="de"?"Name":p==="fr"?"Nom":"Name"}),e.jsx("input",{type:"text",value:t.name,onChange:M=>L("name",M.target.value),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg text-lg focus:border-indigo-500 focus:outline-none",placeholder:W.characterName,autoFocus:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-600 mb-0.5",children:W.gender}),e.jsxs("select",{value:t.gender||"",onChange:M=>L("gender",M.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-base focus:border-indigo-500 focus:outline-none",children:[e.jsx("option",{value:"",children:p==="de"?"‚Äî Unbekannt ‚Äî":p==="fr"?"‚Äî Inconnu ‚Äî":"‚Äî Unknown ‚Äî"}),e.jsx("option",{value:"male",children:W.male}),e.jsx("option",{value:"female",children:W.female}),e.jsx("option",{value:"other",children:W.other})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-600 mb-0.5",children:W.age}),e.jsx("input",{type:"number",value:t.age,onChange:M=>L("age",M.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-base focus:border-indigo-500 focus:outline-none",min:"1",max:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-600 mb-0.5",children:p==="de"?"Gr√∂sse (cm)":p==="fr"?"Taille (cm)":"Height (cm)"}),e.jsx("input",{type:"number",value:((st=t.physical)==null?void 0:st.height)||"",onChange:M=>U("height",M.target.value),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-base focus:border-indigo-500 focus:outline-none",placeholder:"170",min:"50",max:"250"})]})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[s&&e.jsx("button",{onClick:s,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:W.cancel}),e.jsx(ft,{onClick:l,disabled:!n||D||T,loading:D,icon:Pr,className:s?"flex-1":"w-full",children:p==="de"?"Weiter":p==="fr"?"Suivant":"Next"})]})]}):v&&H==="traits"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-gray-200",children:[ee&&e.jsx("img",{src:ee,alt:t.name,className:"w-16 h-16 rounded-full object-cover border-2 border-indigo-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.gender==="male"?p==="de"?"M√§nnlich":"Male":t.gender==="female"?p==="de"?"Weiblich":"Female":p==="de"?"Andere":"Other",", ",t.age," ",p==="de"?"Jahre":"years"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Xt,{label:W.strengths,traits:ne,selectedTraits:((bt=t.traits)==null?void 0:bt.strengths)||[],onSelect:M=>K("strengths",M),minRequired:3,defaultExpanded:!0}),e.jsx(Xt,{label:p==="de"?"Schw√§chen":p==="fr"?"D√©fauts":"Flaws",traits:fe,selectedTraits:((Ee=t.traits)==null?void 0:Ee.flaws)||[],onSelect:M=>K("flaws",M),minRequired:2,defaultExpanded:!0}),e.jsx(Xt,{label:p==="de"?"Konflikte / Herausforderungen":p==="fr"?"Conflits / D√©fis":"Conflicts / Challenges",traits:Z,selectedTraits:((Tt=t.traits)==null?void 0:Tt.challenges)||[],onSelect:M=>K("challenges",M),defaultExpanded:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[s&&e.jsx("button",{onClick:s,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:W.cancel}),e.jsx(ft,{onClick:c,disabled:!Ge||D,loading:D,icon:Pr,className:s?"flex-1":"w-full",children:p==="de"?"Weiter":p==="fr"?"Suivant":"Next"})]}),!Ge&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:W.selectStrengthsFlaws})]}):v&&H==="characteristics"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-gray-200",children:[ee&&e.jsx("img",{src:ee,alt:t.name,className:"w-16 h-16 rounded-full object-cover border-2 border-indigo-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.gender==="male"?p==="de"?"M√§nnlich":"Male":t.gender==="female"?p==="de"?"Weiblich":"Female":p==="de"?"Andere":"Other",", ",t.age," ",p==="de"?"Jahre":"years"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold mb-2 text-gray-800",children:W.specialDetails}),e.jsx("textarea",{value:((yt=t.traits)==null?void 0:yt.specialDetails)||"",onChange:M=>K("specialDetails",M.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none",placeholder:W.specialDetailsPlaceholder,rows:5}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:p==="de"?"F√ºge hier besondere Details hinzu, die den Charakter einzigartig machen (optional).":p==="fr"?"Ajoutez ici des d√©tails sp√©ciaux qui rendent le personnage unique (facultatif).":"Add any special details that make this character unique (optional)."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[s&&e.jsx("button",{onClick:s,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:W.cancel}),e.jsx(ft,{onClick:a.length>0?f:h,disabled:D,loading:D,icon:a.length>0?Pr:pt,className:s?"flex-1":"w-full",children:a.length>0?p==="de"?"Weiter":p==="fr"?"Suivant":"Next":W.saveCharacter})]})]}):v&&H==="relationships"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-gray-200",children:[ee&&e.jsx("img",{src:ee,alt:t.name,className:"w-16 h-16 rounded-full object-cover border-2 border-indigo-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.gender==="male"?p==="de"?"M√§nnlich":"Male":t.gender==="female"?p==="de"?"Weiblich":"Female":p==="de"?"Andere":"Other",", ",t.age," ",p==="de"?"Jahre":"years"]})]})]}),a.length>0&&le&&re?e.jsx(Cs,{character:t,allCharacters:a,relationships:F,relationshipTexts:ae,onRelationshipChange:le,onRelationshipTextChange:re,customRelationships:me,onAddCustomRelationship:ue}):e.jsx("p",{className:"text-center text-gray-500 py-8",children:p==="de"?"Erstelle weitere Charaktere, um Beziehungen hinzuzuf√ºgen.":p==="fr"?"Cr√©ez d'autres personnages pour ajouter des relations.":"Create more characters to add relationships."}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[s&&e.jsx("button",{onClick:s,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:W.cancel}),e.jsx(ft,{onClick:h,disabled:D,loading:D,icon:pt,className:s?"flex-1":"w-full",children:W.saveCharacter})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 lg:gap-6",children:[e.jsx("div",{className:"lg:w-60 flex-shrink-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex-shrink-0",children:T?e.jsx("div",{className:"w-14 h-14 rounded-full bg-indigo-100 border-2 border-indigo-400 flex items-center justify-center",children:e.jsx("div",{className:"w-5 h-5 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"})}):ee?e.jsx("img",{src:ee,alt:t.name,className:"w-14 h-14 rounded-full object-cover border-2 border-indigo-400 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>oe(ee),title:p==="de"?"Klicken zum Vergr√∂ssern":"Click to enlarge"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-gray-200 border-2 border-gray-300 flex items-center justify-center",children:e.jsx(gr,{size:18,className:"text-gray-400"})})}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:t.name}),e.jsxs("label",{className:"cursor-pointer bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs hover:bg-gray-200 flex items-center gap-1 w-fit transition-colors border border-gray-200",children:[e.jsx(gr,{size:10}),p==="de"?"Foto √§ndern":p==="fr"?"Changer la photo":"Change Photo",e.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"hidden"})]})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-500 mb-0.5",children:W.gender}),e.jsxs("select",{value:t.gender||"",onChange:M=>L("gender",M.target.value),className:"w-full px-1.5 py-1 border border-gray-300 rounded text-xs bg-white focus:border-indigo-500 focus:outline-none",children:[e.jsx("option",{value:"",children:p==="de"?"‚Äî Unbekannt ‚Äî":p==="fr"?"‚Äî Inconnu ‚Äî":"‚Äî Unknown ‚Äî"}),e.jsx("option",{value:"male",children:W.male}),e.jsx("option",{value:"female",children:W.female}),e.jsx("option",{value:"other",children:W.other})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-500 mb-0.5",children:W.age}),e.jsx("input",{type:"number",value:t.age,onChange:M=>L("age",M.target.value),className:"w-full px-1.5 py-1 border border-gray-300 rounded text-xs focus:border-indigo-500 focus:outline-none",min:"1",max:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-500 mb-0.5",children:p==="de"?"Gr√∂sse":p==="fr"?"Taille":"Height"}),e.jsx("input",{type:"number",value:((vt=t.physical)==null?void 0:vt.height)||"",onChange:M=>U("height",M.target.value),className:"w-full px-1.5 py-1 border border-gray-300 rounded text-xs focus:border-indigo-500 focus:outline-none",placeholder:"cm",min:"50",max:"250"})]})]}),z&&e.jsxs("details",{className:"bg-gray-50 border border-gray-200 rounded-lg mt-2",children:[e.jsx("summary",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 rounded-lg text-xs font-medium text-gray-600",children:p==="de"?"Physische Merkmale":p==="fr"?"Caract√©ristiques physiques":"Physical Features"}),e.jsx("div",{className:"px-3 pb-3",children:e.jsx(Is,{character:t,language:p,updatePhysical:U,updateApparentAge:M=>L("apparentAge",M)})})]}),e.jsxs("div",{children:[(Ye=t.avatars)!=null&&Ye.standard?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.avatars.standard,alt:`${t.name} avatar`,className:`w-full object-contain rounded-lg bg-white cursor-pointer hover:opacity-90 transition-opacity ${(jt=t.avatars)!=null&&jt.stale?"opacity-80":""}`,onClick:()=>X(!0),title:p==="de"?"Klicken zum Vergr√∂ssern":"Click to enlarge"}),(B||x||A||((Nt=t.avatars)==null?void 0:Nt.status)==="generating")&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 rounded-lg",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}):e.jsx("div",{className:"w-full aspect-[3/4] rounded-lg border-2 border-dashed border-gray-300 bg-gray-100 flex flex-col items-center justify-center",children:B||x||A||((_t=t.avatars)==null?void 0:_t.status)==="generating"?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-indigo-600 font-medium px-2 text-center",children:p==="de"?"Avatar wird erstellt...":p==="fr"?"Cr√©ation...":"Creating..."})]}):e.jsx("span",{className:"text-[10px] text-gray-400 text-center px-2",children:p==="de"?"Kein Avatar":"No avatar"})}),pe&&((at=t.avatars)==null?void 0:at.standard)&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75",onClick:()=>X(!1),children:[e.jsx("img",{src:t.avatars.standard,alt:`${t.name} avatar`,className:"max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl",onClick:M=>M.stopPropagation()}),e.jsx("button",{className:"absolute top-4 right-4 text-white text-3xl hover:text-gray-300",onClick:()=>X(!1),children:"√ó"})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("button",{onClick:()=>ye(!0),className:"w-full px-2 py-1.5 text-xs font-medium bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 flex items-center justify-center gap-1 border border-indigo-200",children:[e.jsx(Jt,{size:10}),p==="de"?"Avatar anpassen":p==="fr"?"Modifier l'avatar":"Modify Avatar"]}),z&&e.jsxs("button",{onClick:Ce,disabled:!Pe||x||A||((wt=t.avatars)==null?void 0:wt.status)==="generating",className:"w-full px-2 py-1 text-[10px] font-medium bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1",title:Pe?void 0:`Wait ${je}s`,children:[e.jsx(It,{size:10}),Pe?x||A?p==="de"?"Generiere...":"Generating...":p==="de"?"Neu generieren":"Regenerate":`${je}s`]})]}),z&&((St=(He=t.avatars)==null?void 0:He.faceMatch)==null?void 0:St.standard)&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsxs("summary",{className:`text-[10px] font-medium cursor-pointer ${t.avatars.faceMatch.standard.score>=6?"text-green-600":"text-red-600"}`,children:["Face eval: ",t.avatars.faceMatch.standard.score,"/10"]}),e.jsx("pre",{className:"mt-1 p-2 rounded text-[9px] whitespace-pre-wrap overflow-auto max-h-48 border bg-gray-100 border-gray-200",children:t.avatars.faceMatch.standard.details})]}),z&&((ct=t.avatars)==null?void 0:ct.clothing)&&Object.keys(t.avatars.clothing).length>0&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsxs("summary",{className:"text-[10px] font-medium cursor-pointer text-blue-600",children:["Clothing (",Object.keys(t.avatars.clothing).length," avatars)"]}),e.jsx("div",{className:"mt-1 p-2 rounded text-[9px] border bg-gray-100 border-gray-200 space-y-1",children:Object.entries(t.avatars.clothing).map(([M,r])=>e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:[M,":"]})," ",r]},M))})]}),z&&((Ot=t.avatars)==null?void 0:Ot.rawEvaluation)&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsx("summary",{className:"text-[10px] font-medium cursor-pointer text-purple-600",children:"Full API Response"}),e.jsx("pre",{className:"mt-1 p-2 rounded text-[8px] whitespace-pre-wrap overflow-auto max-h-64 border bg-gray-100 border-gray-200",children:JSON.stringify(t.avatars.rawEvaluation,null,2)})]})]})]})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-4",children:[e.jsx(Xt,{label:W.strengths,traits:ne,selectedTraits:((Se=t.traits)==null?void 0:Se.strengths)||[],onSelect:M=>K("strengths",M),minRequired:3}),e.jsx(Xt,{label:p==="de"?"Schw√§chen":p==="fr"?"D√©fauts":"Flaws",traits:fe,selectedTraits:((mt=t.traits)==null?void 0:mt.flaws)||[],onSelect:M=>K("flaws",M),minRequired:2}),e.jsx(Xt,{label:p==="de"?"Konflikte / Herausforderungen":p==="fr"?"Conflits / D√©fis":"Conflicts / Challenges",traits:Z,selectedTraits:((qe=t.traits)==null?void 0:qe.challenges)||[],onSelect:M=>K("challenges",M)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold mb-2 text-gray-800",children:W.specialDetails}),e.jsx("textarea",{value:(($e=t.traits)==null?void 0:$e.specialDetails)||"",onChange:M=>K("specialDetails",M.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none",placeholder:W.specialDetailsPlaceholder,rows:3})]}),a.length>1&&le&&re&&e.jsx(Cs,{character:t,allCharacters:a,relationships:F,relationshipTexts:ae,onRelationshipChange:le,onRelationshipTextChange:re,customRelationships:me,onAddCustomRelationship:ue})]})]}),z&&((nt=t.photos)==null?void 0:nt.bodyNoBg)&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-300 rounded-lg p-3",children:[e.jsx("h4",{className:"text-xs font-semibold text-yellow-700 mb-2",children:"Body Crop (No Background)"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:t.photos.bodyNoBg,alt:`${t.name} body crop`,className:"max-h-48 object-contain rounded border border-gray-300",style:{background:"repeating-conic-gradient(#ccc 0% 25%, #fff 0% 50%) 50% / 20px 20px"}})})]}),z&&(_==null?void 0:_.rawResponse)&&e.jsxs("details",{className:"bg-purple-50 border border-purple-300 rounded-lg p-3",children:[e.jsxs("summary",{className:"text-xs font-semibold text-purple-700 cursor-pointer",children:["Raw Gemini Response (Photo Analysis)",_.error&&e.jsxs("span",{className:"text-red-500 ml-2",children:["‚ö†Ô∏è ",_.error]})]}),e.jsx("pre",{className:"mt-2 p-2 bg-white rounded text-[10px] whitespace-pre-wrap overflow-auto max-h-64 border border-purple-200 font-mono",children:_.rawResponse})]}),z&&e.jsxs("div",{className:"bg-teal-50 border border-teal-300 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-teal-700 mb-3 flex items-center gap-2",children:[p==="de"?"Kleidungs-Avatare":p==="fr"?"Avatars vestimentaires":"Clothing Avatars",((Ft=t.avatars)==null?void 0:Ft.status)==="generating"&&e.jsxs("span",{className:"text-xs font-normal text-teal-500 flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-teal-500 border-t-transparent rounded-full animate-spin"}),p==="de"?"Generierung l√§uft...":"Generating..."]}),((zt=t.avatars)==null?void 0:zt.status)==="complete"&&!((qt=t.avatars)!=null&&qt.stale)&&e.jsx("span",{className:"text-xs font-normal text-green-600",children:p==="de"?"Fertig":p==="fr"?"Termin√©":"Complete"}),((it=t.avatars)==null?void 0:it.stale)&&e.jsxs("span",{className:"text-xs font-normal text-amber-600",children:["‚ö†Ô∏è ",p==="de"?"Von altem Foto":p==="fr"?"De l'ancienne photo":"From previous photo"]}),((Ze=t.avatars)==null?void 0:Ze.status)==="failed"&&e.jsx("span",{className:"text-xs font-normal text-red-600",children:p==="de"?"Fehlgeschlagen":p==="fr"?"√âchou√©":"Failed"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:["winter","standard","summer","formal"].map(M=>{var r,E,k,u,Q,de,ke,V,Ne,At,Rt,hr,rr,pr,sr;return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-600 mb-1 capitalize",children:[M==="winter"?"‚ùÑÔ∏è":M==="summer"?"‚òÄÔ∏è":M==="formal"?"üëî":"üëï",e.jsx("span",{className:"ml-0.5",children:p==="de"?M==="winter"?"Winter":M==="summer"?"Sommer":M==="formal"?"Formal":"Standard":M})]}),(r=t.avatars)!=null&&r[M]?e.jsxs("div",{className:"relative cursor-pointer group",onClick:()=>{var fr;return oe(((fr=t.avatars)==null?void 0:fr[M])||null)},title:p==="de"?"Klicken zum Vergr√∂ssern":"Click to enlarge",children:[e.jsx("img",{src:t.avatars[M],alt:`${t.name} - ${M}`,className:`w-full h-40 object-contain rounded border bg-white transition-all group-hover:shadow-lg group-hover:scale-[1.02] ${(E=t.avatars)!=null&&E.stale?"border-amber-400 opacity-75":"border-teal-200"}`}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-all rounded flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 group-hover:opacity-100 text-lg",children:"üîç"})}),((k=t.avatars)==null?void 0:k.stale)&&e.jsx("div",{className:"absolute top-1 right-1 bg-amber-500 text-white text-[8px] px-1 py-0.5 rounded",children:p==="de"?"Alt":"Old"}),z&&((Q=(u=t.avatars)==null?void 0:u.faceMatch)==null?void 0:Q[M])&&e.jsxs("div",{className:`absolute bottom-1 left-1 text-white text-[8px] px-1 py-0.5 rounded font-medium ${t.avatars.faceMatch[M].score>=6?"bg-green-600":"bg-red-600"}`,children:[t.avatars.faceMatch[M].score,"/10"]})]}):e.jsx("div",{className:"w-full h-40 rounded border border-dashed border-teal-300 bg-teal-100/50 flex items-center justify-center text-teal-400 text-[10px]",children:((de=t.avatars)==null?void 0:de.status)==="generating"?"...":"‚Äî"}),z&&((V=(ke=t.avatars)==null?void 0:ke.clothing)==null?void 0:V[M])&&e.jsxs("div",{className:"mt-1 p-1.5 rounded text-[10px] text-left bg-blue-50 border border-blue-200 text-blue-700",children:[e.jsx("span",{className:"font-semibold",children:"üëï "}),t.avatars.clothing[M]]}),z&&((Ne=t.avatars)==null?void 0:Ne[M])&&!((Rt=(At=t.avatars)==null?void 0:At.clothing)!=null&&Rt[M])&&e.jsx("div",{className:"mt-1 p-1.5 rounded text-[10px] text-left bg-amber-50 border border-amber-200 text-amber-600",children:"‚ö†Ô∏è No clothing data - regenerate avatar"}),z&&e.jsxs(e.Fragment,{children:[((rr=(hr=t.avatars)==null?void 0:hr.prompts)==null?void 0:rr[M])&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsx("summary",{className:"text-[10px] text-gray-400 cursor-pointer hover:text-gray-600",children:"Show prompt"}),e.jsx("pre",{className:"mt-1 p-2 rounded text-[9px] whitespace-pre-wrap overflow-auto max-h-48 border bg-gray-100 border-gray-200",children:t.avatars.prompts[M]})]}),((sr=(pr=t.avatars)==null?void 0:pr.faceMatch)==null?void 0:sr[M])&&e.jsxs("details",{className:"mt-1 text-left",children:[e.jsxs("summary",{className:"text-[10px] text-gray-400 cursor-pointer hover:text-gray-600",children:["Face eval (",t.avatars.faceMatch[M].score,"/10)"]}),e.jsx("pre",{className:"mt-1 p-2 rounded text-[9px] whitespace-pre-wrap overflow-auto max-h-48 border bg-gray-100 border-gray-200",children:t.avatars.faceMatch[M].details})]})]})]},M)})}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[((Mt=t.avatars)==null?void 0:Mt.generatedAt)&&e.jsxs("div",{className:"text-xs text-teal-500",children:["Generated: ",new Date(t.avatars.generatedAt).toLocaleString()]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[y&&e.jsx("button",{onClick:y,disabled:x||A||((Xe=t.avatars)==null?void 0:Xe.status)==="generating",className:"px-3 py-1.5 text-xs font-medium bg-teal-600 text-white rounded hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",title:p==="de"?"Generiert Avatare mit allen physischen Merkmalen (Brille, Haarfarbe, etc.)":"Generates avatars with all physical traits (glasses, hair color, etc.)",children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),p==="de"?"Generiere...":"Generating..."]}):e.jsx(e.Fragment,{children:p==="de"?"Neu generieren":p==="fr"?"R√©g√©n√©rer":"Regenerate"})}),S&&e.jsx("button",{onClick:S,disabled:x||A||((Ve=t.avatars)==null?void 0:Ve.status)==="generating",className:"px-3 py-1.5 text-xs font-medium bg-gray-500 text-white rounded hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",title:p==="de"?"Alte Methode ohne physische Merkmale":"Old method without physical traits",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),p==="de"?"Generiere...":"Generating..."]}):e.jsx(e.Fragment,{children:p==="de"?"Ohne Merkmale (alt)":p==="fr"?"Sans traits (ancien)":"Without Traits (old)"})})]})]})]}),z&&((Ke=t.avatars)==null?void 0:Ke.costumed)&&Object.keys(t.avatars.costumed).length>0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-300 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-orange-700 mb-3 flex items-center gap-2",children:["üé≠ ",p==="de"?"Kost√ºmierte Avatare":p==="fr"?"Avatars costum√©s":"Costumed Avatars",e.jsxs("span",{className:"text-xs font-normal text-orange-500",children:["(",Object.keys(t.avatars.costumed).length," ",p==="de"?"Kost√ºme":"costumes",")"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Object.entries(t.avatars.costumed).map(([M,r])=>{const E=typeof r=="string"?r:r==null?void 0:r.imageData,k=typeof r=="object"?r==null?void 0:r.clothing:void 0;return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs font-medium text-orange-600 mb-1 truncate",title:M,children:["üé≠ ",M]}),E?e.jsxs("div",{className:"relative cursor-pointer group",onClick:()=>oe(E),title:p==="de"?"Klicken zum Vergr√∂ssern":"Click to enlarge",children:[e.jsx("img",{src:E,alt:`${t.name} - ${M}`,className:"w-full h-40 object-contain rounded border border-orange-200 bg-white transition-all group-hover:shadow-lg group-hover:scale-[1.02]"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-all rounded flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 group-hover:opacity-100 text-lg",children:"üîç"})})]}):e.jsx("div",{className:"w-full h-40 rounded border border-dashed border-orange-300 bg-orange-100/50 flex items-center justify-center text-orange-400 text-[10px]",children:"‚Äî"}),k&&e.jsxs("div",{className:"mt-1 p-1.5 rounded text-[10px] text-left bg-orange-100 border border-orange-200 text-orange-700",children:[e.jsx("span",{className:"font-semibold",children:"üëï "}),k]})]},M)})})]}),z&&((We=t.avatars)==null?void 0:We.styledAvatars)&&Object.keys(t.avatars.styledAvatars).length>0&&e.jsxs("div",{className:"bg-purple-50 border border-purple-300 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-purple-700 mb-3 flex items-center gap-2",children:["üé® ",p==="de"?"Stilisierte Avatare":p==="fr"?"Avatars stylis√©s":"Styled Avatars",e.jsxs("span",{className:"text-xs font-normal text-purple-500",children:["(",Object.keys(t.avatars.styledAvatars).length," ",p==="de"?"Stile":"styles",")"]})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(t.avatars.styledAvatars).map(([M,r])=>{const k={pixar:{en:"Pixar 3D",de:"Pixar 3D",emoji:"üé¨"},watercolor:{en:"Watercolor",de:"Aquarell",emoji:"üé®"},"comic-book":{en:"Comic Book",de:"Comic",emoji:"üí•"},anime:{en:"Anime",de:"Anime",emoji:"üå∏"},"oil-painting":{en:"Oil Painting",de:"√ñlmalerei",emoji:"üñºÔ∏è"},"colored-pencil":{en:"Colored Pencil",de:"Buntstift",emoji:"‚úèÔ∏è"},storybook:{en:"Storybook",de:"Bilderbuch",emoji:"üìñ"}}[M]||{en:M,de:M,emoji:"üé≠"},u=["standard","winter","summer","formal"],Q={standard:"üëï",winter:"‚ùÑÔ∏è",summer:"‚òÄÔ∏è",formal:"üëî"},de=r.costumed,ke=de?Object.keys(de):[];return e.jsxs("div",{className:"border border-purple-200 rounded-lg p-3 bg-white",children:[e.jsxs("h5",{className:"text-xs font-semibold text-purple-600 mb-2",children:[k.emoji," ",p==="de"?k.de:k.en]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:u.map(V=>{const Ne=r[V];return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-[10px] text-gray-500 mb-1",children:[Q[V]," ",V]}),Ne?e.jsx("img",{src:Ne,alt:`${t.name} - ${M} - ${V}`,className:"w-full h-32 object-contain rounded border border-purple-200 bg-gray-50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>oe(Ne),title:"Click to enlarge"}):e.jsx("div",{className:"w-full h-32 rounded border border-dashed border-purple-200 bg-purple-50/50 flex items-center justify-center text-purple-300 text-[10px]",children:"‚Äî"})]},V)})}),ke.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-purple-200",children:[e.jsxs("div",{className:"text-[10px] font-medium text-orange-600 mb-2",children:["üé≠ ",p==="de"?"Kost√ºmierte Avatare":"Costumed Avatars"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:ke.map(V=>{const Ne=de[V];return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-[10px] text-orange-500 mb-1 truncate",title:V,children:["üé≠ ",V]}),Ne?e.jsx("img",{src:Ne,alt:`${t.name} - ${M} - ${V}`,className:"w-full h-32 object-contain rounded border border-orange-200 bg-orange-50/50 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>oe(Ne),title:"Click to enlarge"}):e.jsx("div",{className:"w-full h-32 rounded border border-dashed border-orange-200 bg-orange-50/50 flex items-center justify-center text-orange-300 text-[10px]",children:"‚Äî"})]},V)})})]})]},M)})})]}),e.jsxs("div",{className:"flex gap-3 max-w-md",children:[s&&e.jsx("button",{onClick:s,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:W.cancel}),e.jsx(ft,{onClick:()=>{var r,E,k,u;!!!((r=t.avatars)!=null&&r.winter||(E=t.avatars)!=null&&E.standard||(k=t.avatars)!=null&&k.summer||(u=t.avatars)!=null&&u.formal)&&O?O():h()},disabled:!Ge||D||A,loading:D||A,icon:pt,className:s?"flex-1":"w-full",children:W.saveCharacter})]}),!Ge&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:W.selectStrengthsFlaws}),e.jsx(Rs,{src:Y,onClose:()=>oe(null)}),ge&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-white flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-gray-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:p==="de"?"Avatar anpassen":p==="fr"?"Modifier l'avatar":"Modify Avatar"}),e.jsx("button",{onClick:()=>ye(!1),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-full transition-colors",children:e.jsx(ot,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"flex-shrink-0 flex justify-center md:justify-start",children:(Te=t.avatars)!=null&&Te.standard?e.jsx("img",{src:t.avatars.standard,alt:`${t.name} avatar`,className:"w-48 h-64 object-contain rounded-lg border-2 border-indigo-300 bg-white shadow-lg"}):e.jsx("div",{className:"w-48 h-64 rounded-lg border-2 border-dashed border-gray-300 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400 text-sm",children:p==="de"?"Kein Avatar":"No avatar"})})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:p==="de"?"Physische Merkmale":p==="fr"?"Caract√©ristiques physiques":"Physical Features"}),e.jsx(Is,{character:t,language:p,updatePhysical:U,updateApparentAge:M=>L("apparentAge",M)})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:p==="de"?"Kleidung":p==="fr"?"V√™tements":"Clothing"}),e.jsxs("div",{className:"space-y-3",children:[t.gender==="female"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:p==="de"?"Kleid / Overall":p==="fr"?"Robe / Combinaison":"Dress / Jumpsuit"}),e.jsx("input",{type:"text",value:((lt=(et=t.clothing)==null?void 0:et.structured)==null?void 0:lt.fullBody)||"",onChange:M=>{var r;return i({...t,clothing:{...t.clothing,structured:{...(r=t.clothing)==null?void 0:r.structured,fullBody:M.target.value,...M.target.value?{upperBody:"",lowerBody:""}:{}}}})},placeholder:p==="de"?"z.B. rotes Sommerkleid":p==="fr"?"ex. robe d'√©t√© rouge":"e.g. red summer dress",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none"})]}),e.jsxs("div",{className:(Fe=(Qt=t.clothing)==null?void 0:Qt.structured)!=null&&Fe.fullBody?"opacity-50":"",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:p==="de"?"Oberteil":p==="fr"?"Haut":"Upper Body"}),e.jsx("input",{type:"text",value:((Et=(tt=t.clothing)==null?void 0:tt.structured)==null?void 0:Et.upperBody)||"",onChange:M=>{var r;return i({...t,clothing:{...t.clothing,structured:{...(r=t.clothing)==null?void 0:r.structured,upperBody:M.target.value}}})},disabled:!!((Be=(_e=t.clothing)==null?void 0:_e.structured)!=null&&Be.fullBody),placeholder:p==="de"?"z.B. blaues T-Shirt":p==="fr"?"ex. t-shirt bleu":"e.g. blue t-shirt",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{className:(Bt=(Oe=t.clothing)==null?void 0:Oe.structured)!=null&&Bt.fullBody?"opacity-50":"",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:p==="de"?"Unterteil":p==="fr"?"Bas":"Lower Body"}),e.jsx("input",{type:"text",value:((kt=(ut=t.clothing)==null?void 0:ut.structured)==null?void 0:kt.lowerBody)||"",onChange:M=>{var r;return i({...t,clothing:{...t.clothing,structured:{...(r=t.clothing)==null?void 0:r.structured,lowerBody:M.target.value}}})},disabled:!!((Re=(Ct=t.clothing)==null?void 0:Ct.structured)!=null&&Re.fullBody),placeholder:p==="de"?"z.B. dunkle Jeans":p==="fr"?"ex. jeans fonc√©":"e.g. dark jeans",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:p==="de"?"Schuhe":p==="fr"?"Chaussures":"Shoes"}),e.jsx("input",{type:"text",value:((Ht=(Ue=t.clothing)==null?void 0:Ue.structured)==null?void 0:Ht.shoes)||"",onChange:M=>{var r;return i({...t,clothing:{...t.clothing,structured:{...(r=t.clothing)==null?void 0:r.structured,shoes:M.target.value}}})},placeholder:p==="de"?"z.B. wei√üe Turnschuhe":p==="fr"?"ex. baskets blanches":"e.g. white sneakers",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base focus:border-indigo-500 focus:outline-none"})]})]})]})]})]})})}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex gap-3",children:[e.jsx("button",{onClick:()=>ye(!1),className:"flex-1 px-4 py-3 text-sm font-medium bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:p==="de"?"Abbrechen":p==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:()=>{ye(!1),y&&(dt(),y())},disabled:A||((gt=t.avatars)==null?void 0:gt.status)==="generating",className:"flex-1 px-4 py-3 text-sm font-medium bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-colors",children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),p==="de"?"Generiere...":"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{size:16}),p==="de"?"Speichern & Neu generieren":p==="fr"?"Enregistrer et r√©g√©n√©rer":"Save & Regenerate"]})})]})})]})]})}const Fs={en:{consent1:"I confirm I have the right to use the uploaded photos and, for photos of minors, I am the parent/guardian or have obtained their consent.",consent2:"I agree to the",termsLink:"Terms of Service",and:"and",privacyLink:"Privacy Policy",period:", including the processing of these photos by AI to create illustrated avatars.",pleaseAccept:"Please accept the terms above to upload a photo"},de:{consent1:"Ich best√§tige, dass ich das Recht habe, die hochgeladenen Fotos zu verwenden, und bei Fotos von Minderj√§hrigen bin ich der Elternteil/Vormund oder habe deren Zustimmung eingeholt.",consent2:"Ich stimme den",termsLink:"Nutzungsbedingungen",and:"und der",privacyLink:"Datenschutzrichtlinie",period:" zu, einschliesslich der Verarbeitung dieser Fotos durch KI zur Erstellung illustrierter Avatare.",pleaseAccept:"Bitte akzeptieren Sie die obigen Bedingungen, um ein Foto hochzuladen"},fr:{consent1:"Je confirme que j'ai le droit d'utiliser les photos t√©l√©charg√©es et, pour les photos de mineurs, je suis le parent/tuteur ou j'ai obtenu leur consentement.",consent2:"J'accepte les",termsLink:"Conditions d'Utilisation",and:"et la",privacyLink:"Politique de Confidentialit√©",period:", y compris le traitement de ces photos par l'IA pour cr√©er des avatars illustr√©s.",pleaseAccept:"Veuillez accepter les conditions ci-dessus pour t√©l√©charger une photo"}};function yn({onPhotoSelect:t,showExamples:a=!0}){const{t:i,language:h}=ze(),{user:s,recordPhotoConsent:w}=Fr(),[l,c]=g.useState(!1),[f,v]=g.useState(!1),[$,O]=g.useState(!1),S=Fs[h]||Fs.en,y=!!(s!=null&&s.photoConsentAt),D=y||l&&f,T=async x=>{var H;const A=(H=x.target.files)==null?void 0:H[0];if(A&&D){if(!y&&l&&f){O(!0);try{await w()}catch(z){console.error("Failed to record consent:",z)}finally{O(!1)}}t(A)}},B=h==="de"?"Deine Geschichte wird basierend auf den hochgeladenen Fotos erstellt. Verwende Fotos mit nur einer Person, idealerweise Ganzk√∂rperaufnahmen, da auch die Kleidung in die Geschichte √ºbernommen wird.":h==="fr"?"Votre histoire sera g√©n√©r√©e √† partir des photos t√©l√©charg√©es. Utilisez des photos d'une seule personne, id√©alement en pied, car les v√™tements seront √©galement int√©gr√©s dans l'histoire.":"Your story will be generated based on the photos you upload. Use photos of a single person, ideally full body shots, as clothing will also be copied into the story.";return e.jsxs("div",{className:"bg-indigo-50 border-2 border-indigo-300 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-4 text-center",children:B}),!y&&e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 space-y-3",children:[e.jsxs("div",{onClick:()=>c(!l),className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5 text-indigo-600 hover:text-indigo-800",children:l?e.jsx(fs,{size:20}):e.jsx(bs,{size:20})}),e.jsx("span",{className:"text-sm text-gray-700 group-hover:text-gray-900",children:S.consent1})]}),e.jsxs("div",{onClick:x=>{x.target.tagName!=="A"&&v(!f)},className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5 text-indigo-600 hover:text-indigo-800",children:f?e.jsx(fs,{size:20}):e.jsx(bs,{size:20})}),e.jsxs("span",{className:"text-sm text-gray-700 group-hover:text-gray-900",children:[S.consent2," ",e.jsx(us,{to:"/terms",className:"text-indigo-600 hover:underline",children:S.termsLink})," ",S.and," ",e.jsx(us,{to:"/privacy",className:"text-indigo-600 hover:underline",children:S.privacyLink}),S.period]})]})]}),e.jsxs("div",{className:"text-center mb-5",children:[e.jsxs("label",{className:`inline-flex items-center justify-center gap-3 px-10 py-4 rounded-xl text-xl font-bold shadow-lg transition-colors ${D&&!$?"cursor-pointer bg-indigo-600 text-white hover:bg-indigo-700":"cursor-not-allowed bg-gray-300 text-gray-500"}`,children:[e.jsx(gr,{size:28})," ",$?"...":i.uploadPhoto,e.jsx("input",{type:"file",accept:"image/*",onChange:T,className:"hidden",disabled:!D||$})]}),!D&&!y&&e.jsx("p",{className:"text-sm text-amber-600 mt-2",children:S.pleaseAccept})]}),a&&e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/Full body.jpg",alt:"Full body example",className:"w-full md:max-h-32 object-contain rounded border-2 border-green-400 mb-1"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:h==="de"?"Ganzk√∂rper":h==="fr"?"Corps entier":"Full body"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/Upper body.jpg",alt:"Upper body example",className:"w-full md:max-h-32 object-contain rounded border-2 border-green-400 mb-1"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:h==="de"?"Oberk√∂rper":h==="fr"?"Buste":"Upper body"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/No zoomed in close up.jpg",alt:"Too close example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:h==="de"?"Zu nah / Unscharf":h==="fr"?"Trop proche / Flou":"Too close / Blurry"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/No sunglasses, hat or helmets.jpg",alt:"No accessories example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:h==="de"?"Brille / Hut / Helm":h==="fr"?"Lunettes / Chapeau":"Glasses / Hat / Helmet"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:"/images/One person not many.jpg",alt:"One person only example",className:"w-full md:max-h-32 object-contain rounded border-2 border-red-400 mb-1"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:h==="de"?"Nur eine Person":h==="fr"?"Une seule personne":"Only one person"})]})]})})]})}function vn({characters:t,currentCharacter:a,characterStep:i,showCharacterCreated:h,isLoading:s,isAnalyzingPhoto:w,isGeneratingAvatar:l,isRegeneratingAvatars:c,isRegeneratingAvatarsWithTraits:f,developerMode:v,changedTraits:$,photoAnalysisDebug:O,mainCharacters:S,excludedCharacters:y,onCharacterRoleChange:D,onCharacterChange:T,onCharacterStepChange:B,onPhotoSelect:x,onSaveAndGenerateAvatar:A,onSaveCharacter:H,onEditCharacter:z,onDeleteCharacter:J,onStartNewCharacter:_,onRegenerateAvatars:F,onRegenerateAvatarsWithTraits:ae,onSaveAndRegenerateWithTraits:le,relationships:re,relationshipTexts:me,onRelationshipChange:ue,onRelationshipTextChange:W,customRelationships:p,onAddCustomRelationship:pe}){const{t:X,language:Y}=ze();if(a){if(i==="photo")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Zt,{size:24})," ",X.charactersStepTitle]}),e.jsx(yn,{onPhotoSelect:x}),e.jsx("button",{onClick:()=>T(null),className:"w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:X.cancel})]});if(i==="name")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Zt,{size:24})," ",X.charactersStepTitle]}),e.jsx($s,{character:a,onChange:T,onSave:H,onCancel:()=>T(null),onPhotoChange:x,onContinueToTraits:()=>B("traits"),onSaveAndGenerateAvatar:A,onRegenerateAvatars:F,onRegenerateAvatarsWithTraits:ae,isLoading:s,isAnalyzingPhoto:w,isGeneratingAvatar:l,isRegeneratingAvatars:c,isRegeneratingAvatarsWithTraits:f,step:"name",developerMode:v,changedTraits:$,photoAnalysisDebug:O,isNewCharacter:!0})]});const oe=!t.find(ge=>ge.id===a.id);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Zt,{size:24})," ",X.charactersStepTitle]}),e.jsx($s,{character:a,allCharacters:t,onChange:T,onSave:H,onCancel:()=>T(null),onPhotoChange:x,onContinueToCharacteristics:()=>B("characteristics"),onContinueToRelationships:()=>B("relationships"),onRegenerateAvatars:F,onRegenerateAvatarsWithTraits:ae,onSaveAndRegenerateWithTraits:le,isLoading:s,isAnalyzingPhoto:w,isGeneratingAvatar:l,isRegeneratingAvatars:c,isRegeneratingAvatarsWithTraits:f,step:i,developerMode:v,changedTraits:$,photoAnalysisDebug:O,relationships:re,relationshipTexts:me,onRelationshipChange:ue,onRelationshipTextChange:W,customRelationships:p,onAddCustomRelationship:pe,isNewCharacter:oe})]})}return t.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Zt,{size:24})," ",X.charactersStepTitle]}),e.jsx(ln,{characters:t,showSuccessMessage:h,mainCharacters:S,excludedCharacters:y,onCharacterRoleChange:D,onEdit:z,onDelete:J,onCreateAnother:_})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Zt,{size:24})," ",X.charactersStepTitle]}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Zt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-6",children:X.startCreating}),e.jsx(ft,{onClick:_,icon:Qe,children:Y==="de"?"Ersten Charakter erstellen":Y==="fr"?"Creer le premier personnage":"Create First Character"})]})]})}const jn=[{code:"de-ch",name:"Deutsch (Schweiz)",flag:"üá®üá≠"},{code:"de-de",name:"Deutsch (Deutschland)",flag:"üá©üá™"},{code:"fr",name:"Fran√ßais",flag:"üá´üá∑"},{code:"en",name:"English",flag:"üá¨üáß"}];function Nn({languageLevel:t,onLanguageLevelChange:a,pages:i,onPagesChange:h,storyLanguage:s,onStoryLanguageChange:w,developerMode:l}){const{t:c,language:f}=ze(),v=l?[4,10,14,20,24,30,34,40,44,50]:[10,14,20,24,30,34,40,44,50];g.useEffect(()=>{(l?[4,10,14,20,24,30,34,40,44,50]:[10,14,20,24,30,34,40,44,50]).includes(i)||h(10)},[i,l,h]);const $=[{value:"1st-grade",label:c.firstGrade,desc:c.firstGradeDesc,image:"/images/text and image on each page.jpg"},{value:"standard",label:c.standard,desc:c.standardDesc,image:"/images/left page text, right page image.jpg"},{value:"advanced",label:c.advanced,desc:c.advancedDesc,image:"/images/dense text left.jpg"}],O=(S,y=!1)=>{const D=y?" (Test)":"",T=S*10,B=f==="de"?"Credits":f==="fr"?"cr√©dits":"credits";if(t==="1st-grade")return`${S} ${f==="de"?"Seiten":"pages"} = ${T} ${B}${D}`;const x=Math.floor(S/2),A=Math.floor(S/2);return f==="de"?`${S} Seiten (${x} Text + ${A} Bilder) = ${T} ${B}${D}`:f==="fr"?`${S} pages (${x} texte + ${A} images) = ${T} ${B}${D}`:`${S} pages (${x} text + ${A} images) = ${T} ${B}${D}`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Ar,{size:24}),f==="de"?"Buchformat":f==="fr"?"Format du livre":"Book Format"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:f==="de"?"Sprachvariante:":f==="fr"?"Variante:":"Language:"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:s,onChange:S=>w(S.target.value),className:"px-4 py-2 border-2 border-indigo-200 rounded-lg focus:border-indigo-600 focus:outline-none text-base font-medium appearance-none bg-white cursor-pointer pr-10",children:jn.map(S=>e.jsx("option",{value:S.code,children:S.name},S.code))}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:c.readingLevel}),e.jsx("div",{className:"flex overflow-x-auto gap-3 pb-2 md:grid md:grid-cols-3 md:gap-4 md:overflow-visible md:pb-0 -mx-4 px-4 md:mx-0 md:px-0",children:$.map(S=>e.jsxs("button",{onClick:()=>a(S.value),className:`flex-shrink-0 w-40 md:w-auto text-left rounded-lg border-2 transition-all overflow-hidden ${t===S.value?"border-indigo-600 ring-2 ring-indigo-200":"border-gray-200 hover:border-indigo-300"}`,children:[e.jsx("div",{className:"w-full bg-gray-100 p-2 h-28 md:h-auto",children:e.jsx("img",{src:S.image,alt:S.label,className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"p-2 md:p-3",children:[e.jsx("div",{className:"font-semibold text-sm md:text-base mb-1",children:S.label}),e.jsx("div",{className:"text-xs md:text-sm text-gray-500 whitespace-pre-line",children:S.desc})]})]},S.value))})]}),t&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl font-semibold mb-3",children:c.numberOfPages}),e.jsx("select",{value:i,onChange:S=>h(parseInt(S.target.value)),className:"w-full px-4 py-3 border-2 border-indigo-200 rounded-lg focus:border-indigo-600 focus:outline-none text-base md:text-lg font-semibold",children:v.map(S=>e.jsx("option",{value:S,children:O(S,S===4)},S))}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:t==="1st-grade"?f==="de"?"Jede Seite enth√§lt ein Bild mit Text darunter":f==="fr"?"Chaque page contient une image avec du texte en dessous":"Each page contains an image with text below":f==="de"?"Abwechselnd Textseite und Bildseite":f==="fr"?"Alternance de pages de texte et d'images":"Alternating text page and image page"})]})]})}function wn({storyCategory:t,storyTopic:a,storyTheme:i,customThemeText:h,onCategoryChange:s,onTopicChange:w,onThemeChange:l,onCustomThemeTextChange:c,onLegacyStoryTypeChange:f}){return e.jsx("div",{className:"space-y-6",children:e.jsx(an,{storyCategory:t,storyTopic:a,storyTheme:i,customThemeText:h,onCategoryChange:s,onTopicChange:w,onThemeChange:l,onCustomThemeTextChange:c,onLegacyStoryTypeChange:f})})}function Sn({artStyle:t,onArtStyleChange:a}){const{language:i}=ze(),h=i==="de"?"Kunststil":i==="fr"?"Style artistique":"Art Style";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Bs,{size:24})," ",h]}),e.jsx(nn,{selectedStyle:t,onSelect:a})]})}const kn=[{code:"de-ch",name:"Deutsch (Schweiz)",flag:"üá®üá≠"},{code:"de-de",name:"Deutsch (Deutschland)",flag:"üá©üá™"},{code:"fr",name:"Fran√ßais",flag:"üá´üá∑"},{code:"en",name:"English",flag:"üá¨üáß"}];function Cn({characters:t,mainCharacters:a,excludedCharacters:i,storyCategory:h,storyTopic:s,storyTheme:w,artStyle:l,storyLanguage:c,languageLevel:f,pages:v,storyDetails:$,onStoryDetailsChange:O,dedication:S,onDedicationChange:y,onGenerateIdeas:D,isGeneratingIdeas:T,ideaPrompt:B,onEditStep:x,developerMode:A,imageGenMode:H,onImageGenModeChange:z,generationMode:J="auto",onGenerationModeChange:_}){const{language:F}=ze(),ae=F,le=()=>t.filter(Y=>a.includes(Y.id)).map(Y=>Y.name).join(", "),re=()=>t.filter(Y=>!a.includes(Y.id)&&!i.includes(Y.id)).map(Y=>Y.name).join(", "),me=()=>{const Y=Ir.find(ge=>ge.id===s);if(Y)return Y.name[ae]||Y.name.en;const oe=$r.find(ge=>ge.id===s);return oe?oe.name[ae]||oe.name.en:""},ue=()=>{if(w==="realistic")return er.name[ae]||er.name.en;const Y=tr.find(oe=>oe.id===w);return Y?Y.name[ae]||Y.name.en:""},W=()=>{const Y=Ls.find(oe=>oe.id===l);return Y?Y.name[ae]||Y.name.en:l},p=()=>{const Y=kn.find(oe=>oe.code===c);return Y?Y.name:c},pe=()=>f==="1st-grade"?F==="de"?"Bilderbuch":F==="fr"?"Album Illustr√©":"Picture Book":f==="standard"?F==="de"?"Kinderbuch":F==="fr"?"Livre Enfant":"Chapter Book":f==="advanced"?F==="de"?"Jugendbuch":F==="fr"?"Roman Jeunesse":"Young Adult":"",X={title:F==="de"?"Geschichte erstellen":F==="fr"?"Cr√©er l'histoire":"Create Your Story",storyDetails:F==="de"?"Geschichte / Handlung":F==="fr"?"Histoire / Intrigue":"Story / Plot",storyDetailsPlaceholder:F==="de"?"Beschreibe die Handlung deiner Geschichte...":F==="fr"?"D√©cris l'intrigue de ton histoire...":"Describe the plot of your story...",optional:F==="de"?"(optional)":F==="fr"?"(optionnel)":"(optional)",dedication:F==="de"?"Widmung":F==="fr"?"D√©dicace":"Dedication",dedicationPlaceholder:F==="de"?'z.B. "F√ºr meine liebe Tochter Emma zum 5. Geburtstag"':F==="fr"?'Par exemple "Pour ma ch√®re fille Emma pour son 5√®me anniversaire"':'e.g. "For my dear daughter Emma on her 5th birthday"',dedicationHelp:F==="de"?"Dieser Text wird auf der Einf√ºhrungsseite deines Buches gedruckt.":F==="fr"?"Ce texte sera imprim√© sur la page d'introduction de ton livre.":"This text will be printed on the initial page of your book.",generateIdeas:F==="de"?"Vorschlag generieren":F==="fr"?"G√©n√©rer une suggestion":"Generate Suggestion",generating:F==="de"?"Generiere...":F==="fr"?"G√©n√©ration...":"Generating...",storyType:F==="de"?"Geschichte":F==="fr"?"Histoire":"Story",artStyleLabel:F==="de"?"Kunststil":F==="fr"?"Style":"Art Style",languageLabel:F==="de"?"Sprachvariante":F==="fr"?"Variante de langue":"Language Variant",mainChars:F==="de"?"Hauptfiguren":F==="fr"?"Personnages principaux":"Main characters",supportingChars:F==="de"?"Nebenfiguren":F==="fr"?"Personnages secondaires":"Also in story",level:F==="de"?"Lesestufe":F==="fr"?"Niveau":"Level",pagesLabel:F==="de"?"Seiten":"Pages"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(_a,{size:24})," ",X.title]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-2 text-sm bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[X.mainChars,":"]}),e.jsx("span",{className:"font-medium text-indigo-700 truncate",children:le()||"-"}),e.jsx("button",{onClick:()=>x(1),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:F==="de"?"Bearbeiten":"Edit",children:e.jsx(Jt,{size:10})})]}),e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[X.supportingChars,":"]}),e.jsx("span",{className:"font-medium text-gray-700 truncate",children:re()||"-"}),e.jsx("button",{onClick:()=>x(1),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:F==="de"?"Bearbeiten":"Edit",children:e.jsx(Jt,{size:10})})]}),e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[X.languageLabel,":"]}),e.jsx("span",{className:"font-medium truncate",children:p()}),e.jsx("button",{onClick:()=>x(2),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:F==="de"?"Bearbeiten":"Edit",children:e.jsx(Jt,{size:10})})]}),e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[X.level,":"]}),e.jsxs("span",{className:"font-medium truncate",children:[pe()," / ",v," ",F==="de"?X.pagesLabel:X.pagesLabel.toLowerCase()]}),e.jsx("button",{onClick:()=>x(2),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:F==="de"?"Bearbeiten":"Edit",children:e.jsx(Jt,{size:10})})]}),e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[X.storyType,":"]}),e.jsx("span",{className:"font-medium truncate",children:h==="adventure"?ue():e.jsxs(e.Fragment,{children:[me(),w&&w!=="realistic"&&` + ${ue()}`]})}),e.jsx("button",{onClick:()=>x(3),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:F==="de"?"Bearbeiten":"Edit",children:e.jsx(Jt,{size:10})})]}),e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[X.artStyleLabel,":"]}),e.jsx("span",{className:"font-medium truncate",children:W()}),e.jsx("button",{onClick:()=>x(4),className:"p-0.5 text-gray-400 hover:text-indigo-600 flex-shrink-0 md:opacity-0 md:group-hover:opacity-100",title:F==="de"?"Bearbeiten":"Edit",children:e.jsx(Jt,{size:10})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"text-xl font-semibold",children:[X.storyDetails," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("button",{onClick:D,disabled:T,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:T?e.jsxs(e.Fragment,{children:[e.jsx($t,{size:18,className:"animate-spin"}),X.generating]}):e.jsxs(e.Fragment,{children:[e.jsx(Qe,{size:18}),X.generateIdeas]})})]}),A&&B&&e.jsxs("details",{className:"mt-2 text-left",children:[e.jsxs("summary",{className:"text-xs text-gray-500 cursor-pointer hover:text-gray-700",children:["Show idea generator prompt (",B.model,")"]}),e.jsx("pre",{className:"mt-1 p-2 rounded text-[9px] whitespace-pre-wrap overflow-auto max-h-64 border bg-gray-100 border-gray-200",children:B.prompt})]}),e.jsx("textarea",{value:$,onChange:Y=>O(Y.target.value),placeholder:X.storyDetailsPlaceholder,className:`w-full px-3 py-2 border-2 rounded-lg focus:border-indigo-600 focus:outline-none text-base ${$.trim()?"border-gray-300":"border-orange-300 bg-orange-50"}`,rows:6,disabled:T})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xl font-semibold mb-3",children:[X.dedication," ",e.jsx("span",{className:"text-sm font-normal text-gray-500",children:X.optional})]}),e.jsx("textarea",{value:S,onChange:Y=>y(Y.target.value),placeholder:X.dedicationPlaceholder,className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-base",rows:2,maxLength:200}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:X.dedicationHelp})]}),A&&e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4",children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-3 flex items-center gap-2",children:F==="de"?"Entwickler-Optionen":F==="fr"?"Options d√©veloppeur":"Developer Options"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:F==="de"?"Bildgenerierungsmodus":F==="fr"?"Mode de g√©n√©ration d'images":"Image Generation Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>z(null),className:`px-3 py-2 rounded-lg text-sm font-medium ${H===null?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:F==="de"?"Server-Standard":F==="fr"?"Par d√©faut serveur":"Server Default"}),e.jsx("button",{onClick:()=>z("parallel"),className:`px-3 py-2 rounded-lg text-sm font-medium ${H==="parallel"?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:F==="de"?"Parallel (schnell)":F==="fr"?"Parall√®le (rapide)":"Parallel (fast)"}),e.jsx("button",{onClick:()=>z("sequential"),className:`px-3 py-2 rounded-lg text-sm font-medium ${H==="sequential"?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:F==="de"?"Sequenziell (konsistent)":F==="fr"?"S√©quentiel (coh√©rent)":"Sequential (consistent)"})]})]}),_&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Generation Pipeline"}),e.jsxs("select",{value:J,onChange:Y=>_(Y.target.value),className:"w-full px-3 py-2 border-2 border-yellow-400 rounded-lg focus:border-yellow-600 focus:outline-none text-sm font-medium bg-white",children:[e.jsx("option",{value:"auto",children:"Auto (based on reading level)"}),e.jsx("option",{value:"pictureBook",children:"Single Prompt (Picture Book)"}),e.jsx("option",{value:"outlineAndText",children:"Outline + Text (Standard)"})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Auto: 1st-grade uses single prompt, standard/advanced use outline+text."})]})]})]})}const zs={en:{title:"Check Your Email",description:"We've sent you a verification link. Your story will start generating automatically once you verify your email!",currentEmail:"Verification sent to",sendVerification:"Send Verification Email",resendVerification:"Resend Verification Email",emailSent:"Verification email sent! Please check your inbox.",changeEmail:"Wrong email? Change it",newEmail:"New email address",currentPassword:"Current password",confirmChange:"Change & Verify",cancel:"Cancel",emailChanged:"Email changed! Please check your new inbox for verification.",checkSpam:"Don't see it? Check your spam folder.",fillAllFields:"Please fill in all fields"},de:{title:"E-Mail pr√ºfen",description:"Wir haben Ihnen einen Best√§tigungslink gesendet. Ihre Geschichte wird automatisch erstellt, sobald Sie Ihre E-Mail best√§tigen!",currentEmail:"Best√§tigung gesendet an",sendVerification:"Best√§tigungs-E-Mail senden",resendVerification:"Best√§tigungs-E-Mail erneut senden",emailSent:"Best√§tigungs-E-Mail gesendet! Bitte pr√ºfen Sie Ihren Posteingang.",changeEmail:"Falsche E-Mail? √Ñndern",newEmail:"Neue E-Mail-Adresse",currentPassword:"Aktuelles Passwort",confirmChange:"√Ñndern & Best√§tigen",cancel:"Abbrechen",emailChanged:"E-Mail ge√§ndert! Bitte pr√ºfen Sie Ihren neuen Posteingang f√ºr die Best√§tigung.",checkSpam:"Nicht gefunden? Pr√ºfen Sie Ihren Spam-Ordner.",fillAllFields:"Bitte alle Felder ausf√ºllen"},fr:{title:"Verifiez votre e-mail",description:"Nous vous avons envoye un lien de verification. Votre histoire sera generee automatiquement une fois votre e-mail verifie!",currentEmail:"Verification envoyee a",sendVerification:"Envoyer l'e-mail de verification",resendVerification:"Renvoyer l'e-mail de verification",emailSent:"E-mail de verification envoye! Veuillez verifier votre boite de reception.",changeEmail:"Mauvais e-mail? Changer",newEmail:"Nouvelle adresse e-mail",currentPassword:"Mot de passe actuel",confirmChange:"Changer & Verifier",cancel:"Annuler",emailChanged:"E-mail change! Veuillez verifier votre nouvelle boite de reception pour la verification.",checkSpam:"Pas trouve? Verifiez votre dossier spam.",fillAllFields:"Veuillez remplir tous les champs"}};function An({isOpen:t,onClose:a,onVerified:i}){const{language:h}=ze(),{user:s,refreshUser:w}=Fr(),l=zs[h]||zs.en,[c,f]=g.useState("verify"),[v,$]=g.useState(!1),[O,S]=g.useState(!1),[y,D]=g.useState(""),[T,B]=g.useState(""),[x,A]=g.useState(!1),[H,z]=g.useState(0),[J,_]=g.useState(""),[F,ae]=g.useState(""),le=g.useRef(null),re=g.useRef(null),me=g.useRef(!1);if(g.useEffect(()=>(H>0&&(re.current=setTimeout(()=>{z(p=>p-1)},1e3)),()=>{re.current&&clearTimeout(re.current)}),[H]),g.useEffect(()=>{if(t&&!me.current&&!O){me.current=!0;const p=setTimeout(async()=>{$(!0);try{const pe=await Ie.post("/api/auth/send-verification",{});S(!0),B(l.emailSent),pe.cooldown&&z(pe.cooldown)}catch(pe){const X=pe;X.retryAfter?(z(X.retryAfter),S(!0)):D(X.message||"Failed to send verification email")}finally{$(!1)}},300);return()=>clearTimeout(p)}t||(me.current=!1)},[t,O,l.emailSent]),g.useEffect(()=>{if(!t){le.current&&(clearInterval(le.current),le.current=null);return}return A(!0),console.log("[EmailVerificationModal] Starting polling"),le.current=setInterval(async()=>{try{const p=await Ie.get("/api/auth/verification-status");console.log("[EmailVerificationModal] Poll result:",p.emailVerified),p.emailVerified&&(console.log("[EmailVerificationModal] Email verified! Refreshing user..."),await w(),console.log("[EmailVerificationModal] User refreshed, clearing interval"),le.current&&(clearInterval(le.current),le.current=null),A(!1),console.log("[EmailVerificationModal] Calling onVerified callback"),i==null||i(),console.log("[EmailVerificationModal] Calling onClose"),a())}catch(p){console.debug("Verification status poll error:",p)}},3e3),()=>{le.current&&(clearInterval(le.current),le.current=null)}},[t,w,i,a]),!t)return null;const ue=async()=>{$(!0),D("");try{const p=await Ie.post("/api/auth/send-verification",{});S(!0),B(l.emailSent),p.cooldown&&z(p.cooldown)}catch(p){const pe=p;pe.retryAfter?(z(pe.retryAfter),D(h==="de"?`Bitte warten Sie ${pe.retryAfter} Sekunden`:h==="fr"?`Veuillez patienter ${pe.retryAfter} secondes`:`Please wait ${pe.retryAfter} seconds`)):D(pe.message||"Failed to send verification email")}finally{$(!1)}},W=async()=>{if(!J||!F){D(l.fillAllFields);return}$(!0),D("");try{await Ie.post("/api/auth/change-email",{newEmail:J,password:F}),B(l.emailChanged),f("verify"),_(""),ae("")}catch(p){D(p instanceof Error?p.message:"Failed to change email")}finally{$(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-8 animate-fade-in relative",children:[e.jsx("button",{onClick:a,className:"absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:e.jsx(ot,{size:20})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Es,{className:"w-8 h-8 text-indigo-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:l.title}),e.jsx("p",{className:"text-gray-500",children:l.description})]}),y&&e.jsx(xs,{variant:"error",className:"mb-4",children:y}),T&&e.jsxs(xs,{variant:"success",className:"mb-4",children:[T,e.jsx("p",{className:"text-sm mt-1 opacity-80",children:l.checkSpam})]}),x&&O&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-indigo-600 mb-4",children:[e.jsx($t,{size:16,className:"animate-spin"}),e.jsx("span",{className:"text-sm",children:h==="de"?"Warte auf Best√§tigung...":h==="fr"?"En attente de verification...":"Waiting for verification..."})]}),c==="verify"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:l.currentEmail}),e.jsx("p",{className:"font-medium text-gray-800",children:s==null?void 0:s.email})]}),e.jsxs(ft,{onClick:ue,variant:"primary",loading:v,disabled:H>0,className:"w-full",children:[e.jsx(It,{size:16,className:"mr-2"}),H>0?`${h==="de"?"Warten":h==="fr"?"Patienter":"Wait"} ${H}s`:O?l.resendVerification:l.sendVerification]}),e.jsxs("button",{onClick:()=>{f("change"),D(""),B("")},className:"w-full text-center text-indigo-600 font-semibold hover:text-indigo-800 flex items-center justify-center gap-2",children:[e.jsx(Me,{size:16}),l.changeEmail]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(gs,{type:"email",label:l.newEmail,value:J,onChange:p=>_(p.target.value),placeholder:"your@newemail.com",disabled:v}),e.jsx(gs,{type:"password",label:l.currentPassword,value:F,onChange:p=>ae(p.target.value),placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",disabled:v}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ft,{onClick:()=>{f("verify"),D(""),_(""),ae("")},variant:"secondary",className:"flex-1",disabled:v,children:l.cancel}),e.jsx(ft,{onClick:W,variant:"primary",loading:v,className:"flex-1",children:l.confirmChange})]})]})]})})}function Pn(){const[t,a]=g.useState(()=>localStorage.getItem("developer_mode")==="true"),[i,h]=g.useState(null),[s,w]=g.useState("auto"),[l,c]=g.useState(!1),[f,v]=g.useState(!1),[$,O]=g.useState(!1),[S,y]=g.useState(!1),[D,T]=g.useState(!1),[B,x]=g.useState({ideaModel:null,outlineModel:null,textModel:null,sceneDescriptionModel:null,imageModel:null,coverImageModel:null,qualityModel:null});return g.useEffect(()=>{t?localStorage.setItem("developer_mode","true"):localStorage.removeItem("developer_mode")},[t]),{developerMode:t,setDeveloperMode:a,imageGenMode:i,setImageGenMode:h,generationMode:s,setGenerationMode:w,devSkipOutline:l,setDevSkipOutline:c,devSkipText:f,setDevSkipText:v,devSkipSceneDescriptions:$,setDevSkipSceneDescriptions:O,devSkipImages:S,setDevSkipImages:y,devSkipCovers:D,setDevSkipCovers:T,modelSelections:B,setModelSelections:x}}const I=Vr("StoryWizard");function qn(){const t=ka(),[a,i]=Ca(),{t:h,language:s}=ze(),{isAuthenticated:w,user:l,updateCredits:c,refreshUser:f,isLoading:v,isImpersonating:$}=Fr(),{showSuccess:O,showInfo:S,showError:y}=wa(),[D,T]=g.useState(()=>{if(new URLSearchParams(window.location.search).get("storyId"))return 6;const C=localStorage.getItem("wizard_step");return C?parseInt(C,10):1}),[B,x]=g.useState(()=>!!new URLSearchParams(window.location.search).get("storyId")),[A,H]=g.useState(null),{developerMode:z,setDeveloperMode:J,imageGenMode:_,setImageGenMode:F,generationMode:ae,setGenerationMode:le,devSkipOutline:re,setDevSkipOutline:me,devSkipText:ue,setDevSkipText:W,devSkipSceneDescriptions:p,setDevSkipSceneDescriptions:pe,devSkipImages:X,setDevSkipImages:Y,devSkipCovers:oe,setDevSkipCovers:ge,modelSelections:ye,setModelSelections:N}=Pn(),[L,U]=g.useState(()=>localStorage.getItem("story_type")||""),[K,Pe]=g.useState(()=>localStorage.getItem("story_category")||""),[je,dt]=g.useState(()=>localStorage.getItem("story_topic")||""),[Ce,n]=g.useState(()=>localStorage.getItem("story_theme")||""),[Ge,ne]=g.useState(()=>localStorage.getItem("story_custom_theme_text")||""),[fe,Z]=g.useState(()=>localStorage.getItem("story_art_style")||"watercolor"),[ee,xe]=g.useState([]),[se,ie]=g.useState(null),[rt,st]=g.useState(!1),[bt,Ee]=g.useState("photo"),[Tt,yt]=g.useState(!1),[vt,Ye]=g.useState(!1),[jt,Nt]=g.useState(!1),[_t,at]=g.useState(!1),[wt,He]=g.useState(void 0),[St,ct]=g.useState(void 0),Ot=g.useRef(null),[Se,mt]=g.useState({}),[qe,$e]=g.useState({}),[nt,Ft]=g.useState([]),zt=g.useRef(null),qt=g.useRef(!1),it=g.useRef(!1),[Ze,Mt]=g.useState(!1),[Xe,Ve]=g.useState(()=>{try{const o=localStorage.getItem("story_main_characters");return o?JSON.parse(o):[]}catch{return[]}}),[Ke,We]=g.useState(()=>{try{const o=localStorage.getItem("story_excluded_characters");return o?JSON.parse(o):[]}catch{return[]}}),[Te,et]=g.useState(()=>{try{return localStorage.getItem("story_language_level")||"standard"}catch{return"standard"}}),[lt,Qt]=g.useState(()=>{try{const o=localStorage.getItem("story_language");return o&&["de-ch","de-de","fr","en"].includes(o)?o:"de-ch"}catch{return"de-ch"}}),[Fe,tt]=g.useState(()=>{try{const o=localStorage.getItem("story_pages");return o?parseInt(o):30}catch{return 30}}),[Et,_e]=g.useState(()=>localStorage.getItem("story_dedication")||""),[Be,Oe]=g.useState(()=>localStorage.getItem("story_details")||""),[Bt,ut]=g.useState(!1),[kt,Ct]=g.useState(null),[Re,Ue]=g.useState(!1),[Ht,gt]=g.useState(!1),[M,r]=g.useState(!1),[E,k]=g.useState({current:0,total:0,message:""}),[u,Q]=g.useState(null),[de,ke]=g.useState(!1),[V,Ne]=g.useState(""),[At,Rt]=g.useState(""),[hr,rr]=g.useState(""),[pr,sr]=g.useState(""),[fr,Kr]=g.useState(""),[Os,Wr]=g.useState(),[qs,Ur]=g.useState(),[Hs,Jr]=g.useState([]),[Vs,ar]=g.useState(null),[Ks,Qr]=g.useState([]),[Ws,Yr]=g.useState([]),[Us,br]=g.useState([]),[Js,xt]=g.useState([]),[yr,Pt]=g.useState({frontCover:null,initialPage:null,backCover:null}),[he,Er]=g.useState(null),[Br,Rr]=g.useState(null),[Qs,Zr]=g.useState(!1),[Ys,Xr]=g.useState(),[Zs,es]=g.useState(),[Xs,ts]=g.useState(),[Je,Lr]=g.useState(null),[rs,Gr]=g.useState({}),[ea,vr]=g.useState(!1),[Ae,jr]=g.useState(null),[nr,ir]=g.useState("");g.useEffect(()=>{if(!v&&!w){if(!!localStorage.getItem("auth_token")){I.debug("Token found but not authenticated yet, waiting for state sync...");return}const C=window.location.pathname+window.location.search,d=encodeURIComponent(C);t(`/?login=true&redirect=${d}`)}},[w,v,t]),g.useEffect(()=>{if(a.get("new")==="true"){I.info("New story requested - resetting all story settings"),U(""),Pe(""),dt(""),n(""),ne(""),Z("watercolor"),et("standard"),tt(30),_e(""),Oe(""),Ve([]),We([]),localStorage.removeItem("story_type"),localStorage.removeItem("story_category"),localStorage.removeItem("story_topic"),localStorage.removeItem("story_theme"),localStorage.removeItem("story_custom_theme_text"),localStorage.removeItem("story_art_style"),localStorage.removeItem("story_language_level"),localStorage.removeItem("story_pages"),localStorage.removeItem("story_dedication"),localStorage.removeItem("story_details"),localStorage.removeItem("story_main_characters"),localStorage.removeItem("story_excluded_characters"),localStorage.removeItem("wizard_step");const C=new URLSearchParams(a);C.delete("new"),i(C,{replace:!0}),ie(null),Ee("photo"),T(1)}},[a,i]),g.useEffect(()=>{(async()=>{const C=a.get("storyId");if(!(!C||!w)){I.info("Loading saved story progressively:",C),x(!0),H(null),Q(null);try{await De.getStoryProgressively(C,(d,m)=>{I.info("Metadata loaded:",d.title,`(${m} images to load)`),Er(d.id),Ne(d.title||""),U(d.storyType||""),Z(d.artStyle||"pixar"),sr(d.outline||""),Kr(d.outlinePrompt||""),Wr(d.outlineModelId),Ur(d.outlineUsage),Jr(d.storyTextPrompts||[]),Qr(d.styledAvatarGeneration||[]),Yr(d.generationLog||[]),d.visualBible?ar({mainCharacters:d.visualBible.mainCharacters||[],secondaryCharacters:d.visualBible.secondaryCharacters||[],animals:d.visualBible.animals||[],artifacts:d.visualBible.artifacts||[],locations:d.visualBible.locations||[],vehicles:d.visualBible.vehicles||[],clothing:d.visualBible.clothing||[],changeLog:d.visualBible.changeLog||[]}):ar(null),xt(d.sceneImages||[]),br(d.sceneDescriptions||[]),Pt(d.coverImages||{frontCover:null,initialPage:null,backCover:null}),et(d.languageLevel||"standard"),d.language&&Qt(d.language),Ue(!1),Zr(d.isPartial||!1),Xr(d.failureReason),es(d.generatedPages),ts(d.totalPages),Rt(d.story||""),rr(d.originalStory||d.story||""),T(6),x(!1),H(null),m>0&&Q({loaded:0,total:m}),z&&De.getStoryDevMetadata(C).then(b=>{var P;b&&((P=b.sceneImages)!=null&&P.length&&xt(j=>j.map(R=>{const q=b.sceneImages.find(G=>G.pageNumber===R.pageNumber);return q?{...R,prompt:q.prompt??R.prompt,qualityReasoning:q.qualityReasoning??R.qualityReasoning,retryHistory:q.retryHistory??R.retryHistory,repairHistory:q.repairHistory??R.repairHistory,wasRegenerated:q.wasRegenerated??R.wasRegenerated,originalScore:q.originalScore??R.originalScore,originalReasoning:q.originalReasoning??R.originalReasoning,totalAttempts:q.totalAttempts??R.totalAttempts,faceEvaluation:q.faceEvaluation??R.faceEvaluation,referencePhotos:q.referencePhotos??R.referencePhotos}:R})),b.coverImages&&Pt(j=>{var G;const R={...j},q=["frontCover","initialPage","backCover"];for(const te of q){const ce=(G=b.coverImages)==null?void 0:G[te],we=j[te];ce&&typeof we=="object"&&we!==null&&(R[te]={...we,prompt:ce.prompt??we.prompt,qualityReasoning:ce.qualityReasoning??we.qualityReasoning,retryHistory:ce.retryHistory??we.retryHistory,referencePhotos:ce.referencePhotos??we.referencePhotos})}return R}),I.debug("Dev metadata merged into story"))}).catch(b=>{I.warn("Failed to load dev metadata:",b)})},(d,m,b,P)=>{if(typeof d=="number")xt(j=>j.map(R=>R.pageNumber===d?{...R,imageData:m,imageVersions:b}:R));else{const j=d;Pt(R=>{const q=R[j];return typeof q=="object"&&q!==null?{...R,[j]:{...q,imageData:m}}:{...R,[j]:m}})}P!==void 0&&Q(j=>j?{...j,loaded:P}:null)},()=>{I.info("All images loaded"),Q(null)})}catch(d){I.error("Failed to load story:",d),x(!1),H(null),Q(null)}}})()},[a,w]),g.useEffect(()=>{(async()=>{const C=a.get("payment"),d=a.get("session_id");if(C==="success"&&d){I.info("Payment successful! Checking order status..."),I.info("Session ID:",d);try{const P=await De.getOrderStatus(d);if(I.info("Order Status:",P),P.order){const j=`CHF ${(P.order.amount_total/100).toFixed(2)}`,R={en:"Payment Successful!",de:"Zahlung erfolgreich!",fr:"Paiement r√©ussi!"},q={en:"Your book order has been received and will be printed soon.",de:"Ihre Buchbestellung wurde entgegengenommen und wird bald gedruckt.",fr:"Votre commande de livre a √©t√© re√ßue et sera bient√¥t imprim√©e."},G=[`${s==="de"?"Kunde":s==="fr"?"Client":"Customer"}: ${P.order.customer_name}`,`Email: ${P.order.customer_email}`,`${s==="de"?"Betrag":s==="fr"?"Montant":"Amount"}: ${j}`,`${s==="de"?"Versand an":s==="fr"?"Exp√©di√© √†":"Shipping to"}: ${P.order.shipping_name}`,`${P.order.shipping_address_line1}`,`${P.order.shipping_postal_code} ${P.order.shipping_city}`,`${P.order.shipping_country}`];O(q[s]||q.en,R[s]||R.en,G)}}catch(P){I.error("Error checking order status:",P)}const b=new URLSearchParams(a);b.delete("payment"),b.delete("session_id"),i(b,{replace:!0})}else if(C==="cancelled"){I.info("Payment cancelled by user");const b={en:"Payment was cancelled. You can try again when ready.",de:"Zahlung wurde abgebrochen. Sie k√∂nnen es erneut versuchen.",fr:"Paiement annul√©. Vous pouvez r√©essayer quand vous √™tes pr√™t."};S(b[s]||b.en,s==="de"?"Abgebrochen":s==="fr"?"Annul√©":"Cancelled");const P=new URLSearchParams(a);P.delete("payment"),i(P,{replace:!0})}const m=a.get("credits_payment");if(m==="success"){I.info("Credits payment successful!"),await f();const b={en:"Credits Added!",de:"Credits hinzugefuegt!",fr:"Credits ajoutes!"},P={en:"100 credits have been added to your account.",de:"100 Credits wurden Ihrem Konto gutgeschrieben.",fr:"100 credits ont ete ajoutes a votre compte."};O(P[s]||P.en,b[s]||b.en);const j=new URLSearchParams(a);j.delete("credits_payment"),j.delete("session_id"),i(j,{replace:!0})}else if(m==="cancelled"){I.info("Credits payment cancelled by user");const b={en:"Credits purchase was cancelled.",de:"Kreditkauf wurde abgebrochen.",fr:"L'achat de credits a ete annule."};S(b[s]||b.en,s==="de"?"Abgebrochen":s==="fr"?"Annule":"Cancelled");const P=new URLSearchParams(a);P.delete("credits_payment"),i(P,{replace:!0})}})()},[a,i,s,O,S,f]);const Nr=g.useRef(!1);g.useEffect(()=>{if(a.get("autoGenerate")==="true"&&!Nr.current){Nr.current=!0;const C=localStorage.getItem("pending_story_type"),d=localStorage.getItem("pending_art_style");C&&(U(C),localStorage.removeItem("pending_story_type")),d&&(Z(d),localStorage.removeItem("pending_art_style")),T(6);const m=new URLSearchParams(a);m.delete("autoGenerate"),i(m,{replace:!0})}},[a,i]);const ss=o=>{if(o.length===0)return;const C=o.filter(d=>{const m=parseInt(d.age);return m>=1&&m<=10});if(C.length>0){const d=C.map(m=>m.id);Ve(d),I.info(`Auto-selected ${C.length} main character(s) aged 1-10`)}else{const d=o.reduce((m,b)=>{const P=parseInt(b.age)||999,j=parseInt(m.age)||999;return P<j?b:m});Ve([d.id]),I.info(`Auto-selected youngest character as main: ${d.name} (age ${d.age})`)}};g.useEffect(()=>{const o=async()=>{try{x(!0);const d=await ve.getCharacterData();I.info("Loaded character data from API:",{characters:d.characters.length,relationships:Object.keys(d.relationships).length}),xe(d.characters),Object.keys(d.relationships).length>0&&(mt(d.relationships),qt.current=!0),Object.keys(d.relationshipTexts).length>0&&$e(d.relationshipTexts),d.customRelationships.length>0&&Ft(d.customRelationships),d.characters.length>0&&ss(d.characters)}catch(d){I.error("Failed to load character data:",d)}finally{x(!1),Mt(!0)}};if(a.get("storyId")){Mt(!0);return}w?o():v||Mt(!0)},[w,v,a]),g.useEffect(()=>{D===1&&ee.length===0&&!se&&!B&&Ze&&os()},[D,ee.length,se,B,Ze]),g.useEffect(()=>{localStorage.setItem("story_main_characters",JSON.stringify(Xe))},[Xe]),g.useEffect(()=>{localStorage.setItem("story_excluded_characters",JSON.stringify(Ke))},[Ke]),g.useEffect(()=>{localStorage.setItem("story_language_level",Te)},[Te]),g.useEffect(()=>{localStorage.setItem("story_language",lt)},[lt]),g.useEffect(()=>{localStorage.setItem("story_pages",Fe.toString())},[Fe]),g.useEffect(()=>{localStorage.setItem("story_dedication",Et)},[Et]),g.useEffect(()=>{localStorage.setItem("story_details",Be)},[Be]),g.useEffect(()=>{localStorage.setItem("story_type",L)},[L]),g.useEffect(()=>{K?localStorage.setItem("story_category",K):localStorage.removeItem("story_category")},[K]),g.useEffect(()=>{je?localStorage.setItem("story_topic",je):localStorage.removeItem("story_topic")},[je]),g.useEffect(()=>{Ce?localStorage.setItem("story_theme",Ce):localStorage.removeItem("story_theme")},[Ce]),g.useEffect(()=>{Ge?localStorage.setItem("story_custom_theme_text",Ge):localStorage.removeItem("story_custom_theme_text")},[Ge]);const as=g.useRef(K),ns=g.useRef(je),is=g.useRef(Ce),ls=g.useRef(!0);g.useEffect(()=>{if(ls.current){ls.current=!1;return}const o=as.current!==K,C=ns.current!==je,d=is.current!==Ce;(o||C||d)&&(Oe(""),localStorage.removeItem("story_details")),as.current=K,ns.current=je,is.current=Ce},[K,je,Ce]),g.useEffect(()=>{localStorage.setItem("story_art_style",fe)},[fe]),g.useEffect(()=>{D>=1&&D<=5&&localStorage.setItem("wizard_step",D.toString())},[D]);const ta=o=>{Pe(o)},ra=o=>{n(o),(K==="adventure"&&o!==""||(K==="life-challenge"||K==="educational")&&je!==""&&o!==""&&o!=="realistic")&&Vt(4)},sa=o=>{dt(o)},aa=o=>{Z(o),Vt(5)};g.useEffect(()=>{if(D===2&&ee.length>=2&&!B){const o=ee.map(C=>C.id).sort().join("-");if(!zt.current||zt.current!==o){const d=Gs(s);I.debug("Initializing relationships for step 2",{charKey:o,existingCount:Object.keys(Se).length}),mt(m=>{const b={...m};let P=!1;return ee.forEach((j,R)=>{ee.forEach((q,G)=>{if(R!==G){const te=`${j.id}-${q.id}`;b[te]||(b[te]=d,P=!0,I.debug("Initializing missing relationship:",te))}})}),P?b:m}),zt.current=o}}},[D,ee,s,B]);const lr=()=>{if(ee.length<2)return!0;for(let o=0;o<ee.length;o++)for(let C=0;C<ee.length;C++)if(o!==C){const d=`${ee[o].id}-${ee[C].id}`,m=Se[d];if(!m||Ts(m))return!1}return!0},os=()=>{ie({id:Date.now(),name:"",gender:void 0,age:"",traits:{strengths:[],flaws:[],challenges:[]}}),Ee("photo"),st(!1)},na=(o,C=1500)=>new Promise(d=>{const m=new Image;m.onload=()=>{const b=document.createElement("canvas");let{width:P,height:j}=m;(P>C||j>C)&&(P>j?(j=Math.round(j*C/P),P=C):(P=Math.round(P*C/j),j=C)),b.width=P,b.height=j;const R=b.getContext("2d");R==null||R.drawImage(m,0,0,P,j),d(b.toDataURL("image/jpeg",.85))},m.onerror=()=>d(o),m.src=o}),ia=async o=>{const C=new FileReader;C.onload=async d=>{var b;const m=(b=d.target)==null?void 0:b.result;se&&(Ot.current={physical:se.physical,gender:se.gender,age:se.age}),He(void 0),yt(!0),Ee("name");try{const P=await na(m),j=Math.round(m.length/1024),R=Math.round(P.length/1024);I.info(`Starting photo analysis... (${j}KB -> ${R}KB)`);const q=await ve.analyzePhoto(P,s);if(q.success){I.info("Photo analysis complete:",{hasPhotos:!!q.photos,hasPhysical:!!q.physical,hasClothing:!!q.clothing,age:q.age,gender:q.gender}),q._debug&&(ct(q._debug),q._debug.rawResponse,q._debug.error&&console.warn("üì∏ [DEBUG] Gemini error:",q._debug.error)),ie(te=>{var ce,we,Lt,ht,or,Dt;return te?{...te,photos:{original:((ce=q.photos)==null?void 0:ce.face)||m,face:(we=q.photos)==null?void 0:we.face,body:((Lt=q.photos)==null?void 0:Lt.body)||m,bodyNoBg:(ht=q.photos)==null?void 0:ht.bodyNoBg,faceBox:(or=q.photos)==null?void 0:or.faceBox,bodyBox:(Dt=q.photos)==null?void 0:Dt.bodyBox},avatars:{status:"generating"}}:null}),I.info("üé® Auto-starting avatar generation in background..."),Ye(!0);const G=await new Promise(te=>{ie(ce=>(te(ce),ce))});G&&ve.generateAndSaveAvatarForCharacter(G).then(te=>{te.success&&te.character?(ie(ce=>ce?{...ce,avatars:te.character.avatars,physical:te.character.physical,clothing:te.character.clothing}:te.character),xe(ce=>ce.map(we=>we.id===te.character.id?te.character:we)),I.success(`‚úÖ Avatar generated and traits extracted for ${G.name}`)):(I.error(`‚ùå Avatar generation failed: ${te.error}`),ie(ce=>ce&&{...ce,avatars:{status:"failed"}}))}).catch(te=>{I.error("‚ùå Avatar generation error:",te),ie(ce=>ce&&{...ce,avatars:{status:"failed"}})}).finally(()=>{Ye(!1)})}else q.error==="no_face_detected"?(I.warn("No face detected in photo"),y(h.noFaceDetected)):(I.warn("Photo analysis returned no data, using original photo"),ie(G=>G?{...G,photos:{original:m},avatars:void 0}:null))}catch(P){I.error("Photo analysis error:",P),ie(j=>j?{...j,photos:{original:m},avatars:void 0}:null)}finally{yt(!1)}},C.readAsDataURL(o)},la=async()=>{if(se){ie(o=>o&&{...o,avatars:void 0}),Nt(!0);try{I.info(`üîÑ Regenerating avatars for ${se.name}...`);const o=await ve.regenerateAvatarsForCharacter(se.id,(C,d)=>I.info(`[${C}] ${d}`));if(o.success&&o.avatars){const C={...o.avatars,stale:!1};ie(d=>d&&{...d,avatars:C}),xe(d=>d.map(m=>m.id===se.id?{...m,avatars:C}:m)),I.success(`‚úÖ Avatars regenerated for ${se.name}`)}else I.error(`‚ùå Failed to regenerate avatars: ${o.error}`),y(`Failed to regenerate avatars: ${o.error||"Unknown error"}`)}catch(o){I.error(`‚ùå Failed to regenerate avatars for ${se.name}:`,o),y(`Failed to regenerate avatars: ${o instanceof Error?o.message:"Unknown error"}`)}finally{Nt(!1)}}},oa=async()=>{if(se){ie(o=>o&&{...o,avatars:void 0}),at(!0);try{I.info(`üîÑ Regenerating avatars WITH TRAITS for ${se.name}...`),I.info(`Physical traits: ${JSON.stringify(se.physical)}`);const o=await ve.generateClothingAvatarsWithTraits(se);if(o.success&&o.avatars){const C={...o.avatars,stale:!1,generatedAt:new Date().toISOString()};ie(d=>d&&{...d,avatars:C}),xe(d=>d.map(m=>m.id===se.id?{...m,avatars:C}:m)),I.success(`‚úÖ Avatars WITH TRAITS regenerated for ${se.name}`)}else I.error(`‚ùå Failed to regenerate avatars with traits: ${o.error}`),y(`Failed to regenerate avatars: ${o.error||"Unknown error"}`)}catch(o){I.error(`‚ùå Failed to regenerate avatars with traits for ${se.name}:`,o),y(`Failed to regenerate avatars: ${o instanceof Error?o.message:"Unknown error"}`)}finally{at(!1)}}},da=async()=>{if(!se)return;const o={...se},C=se.id;at(!0);try{I.info(`üíæ Saving character and regenerating avatars for ${o.name}...`),await Tr(),I.info(`üîÑ Regenerating avatars WITH TRAITS for ${o.name}...`);const m=(await new Promise(P=>{xe(j=>(P(j),j))})).find(P=>P.id===C);if(!m){I.warn("Character not found in characters array after save");return}const b=await ve.generateClothingAvatarsWithTraits(m);if(b.success&&b.avatars){const P={...b.avatars,stale:!1,generatedAt:new Date().toISOString()};ie(G=>G&&G.id===C?{...G,avatars:P}:G),xe(G=>G.map(te=>te.id===C?{...te,avatars:P}:te)),I.success(`‚úÖ Avatars regenerated for ${m.name}`);const j={...m,avatars:P},q=(await new Promise(G=>{xe(te=>(G(te),te))})).map(G=>G.id===C?j:G);await ve.saveCharacterData({characters:q,relationships:Se,relationshipTexts:qe,customRelationships:nt,customStrengths:[],customWeaknesses:[],customFears:[]}),I.success("üíæ Character saved with new avatars"),O(s==="de"?"Charakter gespeichert und Avatar regeneriert":"Character saved and avatar regenerated")}else I.error(`‚ùå Failed to regenerate avatars: ${b.error}`),y(`Failed to regenerate avatars: ${b.error||"Unknown error"}`)}catch(d){I.error("‚ùå Failed to save and regenerate:",d),y(`Failed: ${d instanceof Error?d.message:"Unknown error"}`)}finally{at(!1)}},ca=async()=>{if(se){He(void 0),Ee("traits"),Ye(!0),ie(o=>o&&{...o,avatars:{status:"generating"}}),I.info(`üé® Starting avatar generation for ${se.name}...`);try{const o=await ve.generateClothingAvatarsWithTraits(se);if(o.success&&o.avatars){const C={...o.avatars,stale:!1,generatedAt:new Date().toISOString()};ie(d=>d&&{...d,avatars:C}),xe(d=>d.map(m=>m.id===se.id?{...m,avatars:C}:m)),I.success(`‚úÖ Avatar generated for ${se.name}`)}else I.error(`‚ùå Failed to generate avatar: ${o.error}`),y(`Failed to generate avatar: ${o.error||"Unknown error"}`),ie(C=>C&&{...C,avatars:{status:"failed"}})}catch(o){I.error("‚ùå Avatar generation failed:",o),y(`Avatar generation failed: ${o instanceof Error?o.message:"Unknown error"}`),ie(C=>C&&{...C,avatars:{status:"failed"}})}finally{Ye(!1)}}},Tr=async()=>{if(se){x(!0);try{const o=await new Promise(P=>{ie(j=>(P(j),j))});if(!o){I.warn("No current character to save");return}const C=await new Promise(P=>{xe(j=>(P(j),j))}),m=o.id&&C.find(P=>P.id===o.id)?C.map(P=>P.id===o.id?o:P):[...C,o];I.info("Saving characters with relationships:",m.length),await ve.saveCharacterData({characters:m,relationships:Se,relationshipTexts:qe,customRelationships:nt,customStrengths:[],customWeaknesses:[],customFears:[]}),I.success("Character data saved successfully"),xe(m),ss(m);const b=m.find(P=>P.id===se.id);b&&ve.needsAvatars(b)&&(I.info(`üé® Starting background avatar generation for ${b.name}...`),ve.generateAndSaveAvatarForCharacter(b).then(P=>{P.success&&P.avatars?(xe(j=>j.map(R=>R.id===b.id?{...R,avatars:P.avatars}:R)),I.success(`‚úÖ Avatars saved for ${b.name}`)):P.skipped||I.warn(`Avatar generation failed for ${b.name}: ${P.error}`)})),ie(null),st(!0)}catch(o){I.error("Failed to save character:",o),y(s==="de"?"Charakter konnte nicht gespeichert werden. Bitte versuche es erneut.":s==="fr"?"√âchec de l'enregistrement du personnage. Veuillez r√©essayer.":"Failed to save character. Please try again.")}finally{x(!1)}}},ma=o=>{ie({...o}),Ee("traits"),st(!1)},ua=async o=>{const C=ee.filter(b=>b.id!==o),d={...Se},m={...qe};Object.keys(d).forEach(b=>{(b.includes(`${o}-`)||b.includes(`-${o}`))&&(delete d[b],delete m[b])});try{await ve.saveCharacterData({characters:C,relationships:d,relationshipTexts:m,customRelationships:nt,customStrengths:[],customWeaknesses:[],customFears:[]}),xe(C),mt(d),$e(m),Ve(b=>b.filter(P=>P!==o))}catch(b){I.error("Failed to delete character:",b)}},ga=(o,C,d)=>{const b=_s(d,s),P=`${o}-${C}`,j=`${C}-${o}`;I.debug("Updating relationship:",P,"=",d,", inverse:",j,"=",b),it.current=!0,mt(R=>({...R,[P]:d,[j]:b}))},xa=(o,C)=>{it.current=!0;const[d,m]=o.split("-").map(Number),b=`${m}-${d}`;$e(P=>({...P,[o]:C,[b]:C}))},ha=(o,C)=>{it.current=!0,Ft(d=>[...d,{forward:o,inverse:C}])},pa=(o,C)=>{C==="out"?(We(d=>d.includes(o)?d:[...d,o]),Ve(d=>d.filter(m=>m!==o))):C==="in"?(We(d=>d.filter(m=>m!==o)),Ve(d=>d.filter(m=>m!==o))):C==="main"&&(We(d=>d.filter(m=>m!==o)),Ve(d=>d.includes(o)?d:[...d,o]))},Vt=async o=>{o>=0&&o<=7&&(D===1&&se&&o!==1&&await Tr(),D===2&&o!==2&&await ba(),o===1&&D!==1&&ie(null),T(o),window.scrollTo(0,0))},fa=o=>o===1?!0:o===2||o===3?ee.length>0&&lr():o===4?ee.length>0&&lr()&&K!=="":o===5?ee.length>0&&lr()&&K!==""&&fe!=="":o===6?At!=="":!1,Kt=()=>D===1?ee.length>0&&lr():D===2?!0:D===3?!(!K||K==="adventure"&&!Ce||(K==="life-challenge"||K==="educational")&&!je):D===4?fe!=="":D===5?ee.filter(C=>!Ke.includes(C.id)).length>0&&Xe.length>0&&Be.trim().length>0:!1,ba=async()=>{const o=await new Promise(C=>{xe(d=>(C(d),d))});if(o.length!==0){if(!it.current){I.debug("Relationships not modified, skipping save");return}try{I.debug("Auto-saving character data with latest state..."),await ve.saveCharacterData({characters:o,relationships:Se,relationshipTexts:qe,customRelationships:nt,customStrengths:[],customWeaknesses:[],customFears:[]}),it.current=!1,I.debug("Character data auto-saved")}catch(C){I.error("Failed to auto-save character data:",C)}}},ya=async()=>{D<5&&Kt()&&await Vt(D+1)},ds=async()=>{D>0&&await Vt(D-1)},va=async()=>{ut(!0);try{const o=ee.filter(d=>!Ke.includes(d.id)),C=await De.generateStoryIdeas({storyType:L,storyTypeName:cs(),storyCategory:K||void 0,storyTopic:je||void 0,storyTheme:Ce||void 0,customThemeText:Ce==="custom"?Ge:void 0,language:lt,languageLevel:Te,characters:o.map(d=>({name:d.name,age:d.age,gender:d.gender,traits:d.traits,isMain:Xe.includes(d.id)})),relationships:Object.entries(Se).map(([d,m])=>{const[b,P]=d.split("-").map(Number),j=ee.find(q=>q.id===b),R=ee.find(q=>q.id===P);return{character1:(j==null?void 0:j.name)||"",character2:(R==null?void 0:R.name)||"",relationship:m}}).filter(d=>d.character1&&d.character2),ideaModel:(l==null?void 0:l.role)==="admin"?ye.ideaModel:void 0});C.storyIdea&&(Oe(C.storyIdea),localStorage.setItem("story_details",C.storyIdea)),C.prompt&&C.model&&Ct({prompt:C.prompt,model:C.model})}catch(o){I.error("Failed to generate story ideas:",o),y(s==="de"?"Fehler beim Generieren von Ideen. Bitte versuchen Sie es erneut.":s==="fr"?"Erreur lors de la g√©n√©ration d'id√©es. Veuillez r√©essayer.":"Failed to generate ideas. Please try again.")}finally{ut(!1)}},cs=()=>{const o=tr.find(C=>C.id===L);return o?o.name[s]:L},Yt=async o=>{if(console.log("[generateStory] Called with overrides:",o),console.log("[generateStory] user:",l==null?void 0:l.email,"emailVerified:",l==null?void 0:l.emailVerified,"isImpersonating:",$),!(o!=null&&o.skipEmailCheck)&&!$&&l&&l.emailVerified!==!0){console.log("[generateStory] Email not verified, showing modal"),localStorage.setItem("pendingStoryGeneration","true"),localStorage.setItem("pending_story_type",L),localStorage.setItem("pending_art_style",fe),r(!0);return}console.log("[generateStory] Starting generation, setting step to 6"),Ue(!0),T(6),Rt(""),Ne(""),xt([]),br([]),Lr(null),Gr({}),Pt({frontCover:null,initialPage:null,backCover:null});const C=ee.filter(d=>!Ke.includes(d.id)).filter(d=>!d.avatars||d.avatars.stale||d.avatars.status!=="complete");if(C.length>0){console.log("[generateStory] Characters needing avatar regeneration:",C.map(d=>d.name)),k({current:1,total:100,message:s==="de"?`Aktualisiere Avatare f√ºr ${C.length} Charakter(e)...`:s==="fr"?`Mise √† jour des avatars pour ${C.length} personnage(s)...`:`Updating avatars for ${C.length} character(s)...`});for(let d=0;d<C.length;d++){const m=C[d];try{console.log(`[generateStory] Regenerating avatars for ${m.name} (${d+1}/${C.length})`),k({current:2,total:100,message:s==="de"?`Generiere Avatare f√ºr ${m.name}...`:s==="fr"?`G√©n√©ration des avatars pour ${m.name}...`:`Generating avatars for ${m.name}...`});const b=await ve.generateClothingAvatarsWithTraits(m);if(b.success&&b.avatars){const P={...b.avatars,stale:!1,generatedAt:new Date().toISOString()};xe(j=>j.map(R=>R.id===m.id?{...R,avatars:P}:R)),ie(j=>j&&j.id===m.id?{...j,avatars:P}:j),xe(j=>{const R=j.map(q=>q.id===m.id?{...q,avatars:P}:q);return ve.saveCharacterData({characters:R,relationships:Se,relationshipTexts:qe,customRelationships:nt,customStrengths:[],customWeaknesses:[],customFears:[]}).catch(q=>console.error("Failed to save avatar update:",q)),R}),console.log(`[generateStory] ‚úÖ Avatars regenerated for ${m.name}`)}else console.warn(`[generateStory] ‚ö†Ô∏è Failed to regenerate avatars for ${m.name}: ${b.error}`)}catch(b){console.error(`[generateStory] ‚ùå Error regenerating avatars for ${m.name}:`,b)}}}k({current:5,total:100,message:s==="de"?"Starte Generierung...":s==="fr"?"D√©marrage de la g√©n√©ration...":"Starting generation..."});try{const d=ee.filter(G=>!Ke.includes(G.id)),{jobId:m,creditsRemaining:b}=await De.createStoryJob({storyType:L,storyTypeName:cs(),storyCategory:K||void 0,storyTopic:je||void 0,storyTheme:Ce||void 0,customThemeText:Ce==="custom"?Ge:void 0,artStyle:fe,language:lt,languageLevel:Te,pages:Fe,dedication:Et,storyDetails:Be,characters:d,mainCharacters:Xe,relationships:Se,relationshipTexts:qe,skipImages:(o==null?void 0:o.skipImages)??X,imageGenMode:_,generationMode:ae!=="auto"?ae:void 0,skipOutline:re,skipText:ue,skipSceneDescriptions:p,skipCovers:oe,modelOverrides:(l==null?void 0:l.role)==="admin"?{outlineModel:ye.outlineModel,textModel:ye.textModel,sceneDescriptionModel:ye.sceneDescriptionModel,imageModel:ye.imageModel,coverImageModel:ye.coverImageModel,qualityModel:ye.qualityModel}:void 0});Rr(m),I.info("Story job created:",m),b!=null&&c(b);let P=!1,j=0,R=Date.now();const q=180*1e3;for(ke(!1);!P;){await new Promise(te=>setTimeout(te,2e3));const G=await De.getJobStatus(m);if(G.progress&&(G.progress.current!==j?(I.debug(`Progress: ${G.progress.current}% - ${G.progress.message||""}`),j=G.progress.current,R=Date.now(),ke(!1)):Date.now()-R>=q&&ke(!0),k(te=>G.progress.current>=te.current?G.progress:G.progress.message?{...te,message:G.progress.message}:te)),G.partialCovers){let te=!1;Pt(ce=>{var Lt,ht,or;const we={...ce};if((Lt=G.partialCovers)!=null&&Lt.frontCover&&!ce.frontCover){we.frontCover=G.partialCovers.frontCover,I.debug("Front cover received during streaming");const Dt=G.partialCovers.frontCover;typeof Dt=="object"&&(Dt!=null&&Dt.storyTitle)&&(Ne(Dt.storyTitle),I.debug(`Story title from front cover: ${Dt.storyTitle}`)),te=!0}return(ht=G.partialCovers)!=null&&ht.initialPage&&!ce.initialPage&&(we.initialPage=G.partialCovers.initialPage,I.debug("Initial page cover received during streaming")),(or=G.partialCovers)!=null&&or.backCover&&!ce.backCover&&(we.backCover=G.partialCovers.backCover,I.debug("Back cover received during streaming")),we}),te&&(I.debug("Transitioning to StoryDisplay - front cover ready"),T(6))}if(G.storyText&&!Je&&(Lr(G.storyText),Ne(G.storyText.title),I.debug(`Story text received: ${G.storyText.totalPages} pages ready for display`)),G.partialPages&&G.partialPages.length>0&&Gr(te=>{var Lt;const ce={...te};let we=0;return(Lt=G.partialPages)==null||Lt.forEach(ht=>{ht.imageData&&!te[ht.pageNumber]&&(ce[ht.pageNumber]=ht.imageData,we++)}),we>0&&I.debug(`${we} new page images received (total: ${Object.keys(ce).length})`),ce}),G.status==="completed"&&G.result)Er(G.result.storyId),Ne(G.result.title),sr(G.result.outline),Kr(G.result.outlinePrompt||""),Wr(G.result.outlineModelId),Ur(G.result.outlineUsage),Jr(G.result.storyTextPrompts||[]),Qr(G.result.styledAvatarGeneration||[]),Yr(G.result.generationLog||[]),G.result.visualBible?ar({mainCharacters:G.result.visualBible.mainCharacters||[],secondaryCharacters:G.result.visualBible.secondaryCharacters||[],animals:G.result.visualBible.animals||[],artifacts:G.result.visualBible.artifacts||[],locations:G.result.visualBible.locations||[],vehicles:G.result.visualBible.vehicles||[],clothing:G.result.visualBible.clothing||[],changeLog:G.result.visualBible.changeLog||[]}):ar(null),Rt(G.result.story),rr(G.result.story),br(G.result.sceneDescriptions||[]),xt(G.result.sceneImages||[]),Pt(G.result.coverImages||{frontCover:null,initialPage:null,backCover:null}),Lr(null),Gr({}),P=!0,G.currentCredits!==null&&G.currentCredits!==void 0&&c(G.currentCredits),I.success("Story generation completed!");else if(G.status==="failed")throw new Error(G.error||"Story generation failed")}k({current:100,total:100,message:s==="de"?"Fertig!":s==="fr"?"Termin√©!":"Complete!"})}catch(d){I.error("Generation failed:",d);const m=d instanceof Error?d.message:String(d);if(m.includes("already in progress")){const b=m.match(/\|ACTIVE_JOB:(job_[a-z0-9_]+)/i),P=b?b[1]:null,j=s==="de"?"Eine Geschichte wird bereits erstellt. M√∂chtest du diese abbrechen und eine neue starten?":s==="fr"?"Une histoire est d√©j√† en cours de cr√©ation. Voulez-vous l'annuler et en commencer une nouvelle?":"A story is already being generated. Would you like to cancel it and start a new one?";if(P&&window.confirm(j))try{await De.cancelJob(P),I.info("Cancelled existing job:",P),await Yt(o);return}catch(R){I.error("Failed to cancel existing job:",R),y(s==="de"?"Abbrechen fehlgeschlagen. Bitte versuche es sp√§ter erneut.":s==="fr"?"√âchec de l'annulation. Veuillez r√©essayer plus tard.":"Failed to cancel. Please try again later.")}Ue(!1);return}else y(s==="de"?`Generierung fehlgeschlagen: ${m}`:s==="fr"?`√âchec de la g√©n√©ration: ${m}`:`Generation failed: ${m}`)}finally{ke(!1),setTimeout(()=>Ue(!1),500)}};g.useEffect(()=>{if(Nr.current&&w&&ee.length>0&&D===5&&!Re){Nr.current=!1;const o=localStorage.getItem("verificationGenerationStarted");if(o){const d=parseInt(o,10),m=Date.now()-120*1e3;if(d>m){console.log("Another window already started generation, skipping auto-generate");return}localStorage.removeItem("verificationGenerationStarted")}localStorage.setItem("verificationGenerationStarted",Date.now().toString()),(async()=>{await f(),setTimeout(()=>{Yt({skipEmailCheck:!0})},500)})()}},[w,ee,D,Re,f]);const ja=()=>{switch(D){case 1:return e.jsx(vn,{characters:ee,currentCharacter:se,characterStep:bt,showCharacterCreated:rt,isLoading:B,isAnalyzingPhoto:Tt,isGeneratingAvatar:vt,isRegeneratingAvatars:jt,isRegeneratingAvatarsWithTraits:_t,developerMode:z,changedTraits:wt,photoAnalysisDebug:St,mainCharacters:Xe,excludedCharacters:Ke,onCharacterRoleChange:pa,onCharacterChange:ie,onCharacterStepChange:Ee,onPhotoSelect:ia,onSaveAndGenerateAvatar:ca,onSaveCharacter:Tr,onEditCharacter:ma,onDeleteCharacter:ua,onStartNewCharacter:os,onRegenerateAvatars:la,onRegenerateAvatarsWithTraits:oa,onSaveAndRegenerateWithTraits:da,relationships:Se,relationshipTexts:qe,onRelationshipChange:ga,onRelationshipTextChange:xa,customRelationships:nt,onAddCustomRelationship:ha});case 2:return e.jsx(Nn,{languageLevel:Te,onLanguageLevelChange:et,pages:Fe,onPagesChange:tt,storyLanguage:lt,onStoryLanguageChange:Qt,developerMode:z});case 3:return e.jsx(wn,{storyCategory:K,storyTopic:je,storyTheme:Ce,customThemeText:Ge,onCategoryChange:ta,onTopicChange:sa,onThemeChange:ra,onCustomThemeTextChange:ne,onLegacyStoryTypeChange:U});case 4:return e.jsx(Sn,{artStyle:fe,onArtStyleChange:aa});case 5:return e.jsx(Cn,{characters:ee,mainCharacters:Xe,excludedCharacters:Ke,storyCategory:K,storyTopic:je,storyTheme:Ce,artStyle:fe,storyLanguage:lt,languageLevel:Te,pages:Fe,storyDetails:Be,onStoryDetailsChange:Oe,dedication:Et,onDedicationChange:_e,onGenerateIdeas:va,isGeneratingIdeas:Bt,ideaPrompt:kt,onEditStep:Vt,developerMode:z,imageGenMode:_,onImageGenModeChange:F,generationMode:ae,onGenerationModeChange:le});case 6:if(At||Je||Re&&yr.frontCover){const C=At?Js:Object.entries(rs).map(([m,b])=>{var P;return{pageNumber:parseInt(m),imageData:b,description:((P=Je==null?void 0:Je.sceneDescriptions.find(j=>j.pageNumber===parseInt(m)))==null?void 0:P.description)||""}}),d=At||Object.entries((Je==null?void 0:Je.pageTexts)||{}).sort(([m],[b])=>parseInt(m)-parseInt(b)).map(([m,b])=>`--- Page ${m} ---
${b}`).join(`

`);return e.jsxs(e.Fragment,{children:[u&&u.total>0&&e.jsxs("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 bg-white/95 backdrop-blur-sm rounded-full shadow-lg px-4 py-2 flex items-center gap-3 border border-indigo-100",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300 ease-out",style:{width:`${u.loaded/u.total*100}%`}})}),e.jsx("span",{className:"text-sm text-gray-600 whitespace-nowrap",children:s==="de"?`Bilder: ${u.loaded}/${u.total}`:s==="fr"?`Images: ${u.loaded}/${u.total}`:`Images: ${u.loaded}/${u.total}`})]}),e.jsx(Za,{title:V,story:d,originalStory:hr,outline:pr,outlinePrompt:fr,outlineModelId:Os,outlineUsage:qs,storyTextPrompts:Hs,visualBible:Vs||void 0,sceneImages:C,sceneDescriptions:(Je==null?void 0:Je.sceneDescriptions)||Us,progressiveMode:Re,progressiveData:Je||void 0,completedPageImages:rs,coverImages:yr,languageLevel:Te,storyLanguage:lt,isGenerating:Re,developerMode:z,styledAvatarGeneration:Ks,generationLog:Ws,storyId:he,onVisualBibleChange:he?async m=>{try{I.info("Updating Visual Bible for story:",he),await De.updateVisualBible(he,m),ar(m),I.success("Visual Bible updated successfully")}catch(b){I.error("Failed to update Visual Bible:",b),y(s==="de"?"Visual Bible konnte nicht aktualisiert werden":s==="fr"?"√âchec de la mise √† jour de la Bible Visuelle":"Failed to update Visual Bible")}}:void 0,onRegenerateImage:he?async(m,b)=>{var P;try{I.info("Regenerating image for page:",m,b?"(scene edited)":""),Ue(!0);const j=await De.regenerateImage(he,m,b);if(I.info("Regenerate result:",{hasImageData:!!(j!=null&&j.imageData),length:(P=j==null?void 0:j.imageData)==null?void 0:P.length,versionCount:j==null?void 0:j.versionCount,creditsRemaining:j==null?void 0:j.creditsRemaining}),!(j!=null&&j.imageData))throw I.error("No imageData in response!",j),new Error("No image data returned from server");xt(R=>R.map(q=>q.pageNumber===m?{...q,imageData:j.imageData,description:j.newDescription||q.description,prompt:j.newPrompt,qualityScore:j.qualityScore,qualityReasoning:j.qualityReasoning,totalAttempts:j.totalAttempts,retryHistory:j.retryHistory,wasRegenerated:!0,originalImage:j.originalImage,originalScore:j.originalScore,originalReasoning:j.originalReasoning,imageVersions:j.imageVersions}:q)),j.creditsRemaining!==void 0&&c&&c(j.creditsRemaining),I.info("Image regenerated successfully, updated state")}catch(j){I.error("Image regeneration failed:",j);const R=j instanceof Error?j.message:String(j);y(s==="de"?`Bildgenerierung fehlgeschlagen: ${R}`:s==="fr"?`√âchec de la r√©g√©n√©ration: ${R}`:`Image regeneration failed: ${R}`)}finally{Ue(!1)}}:void 0,onDownloadTxt:()=>{const m=new Blob([At],{type:"text/plain"}),b=URL.createObjectURL(m),P=document.createElement("a");P.href=b,P.download=`${V}.txt`,P.click(),URL.revokeObjectURL(b)},onDownloadPdf:he?async()=>{try{const m=await De.generatePdf(he),b=URL.createObjectURL(m),P=document.createElement("a");P.href=b,P.download=`${V}.pdf`,P.click(),URL.revokeObjectURL(b)}catch(m){I.error("PDF download failed:",m),y(s==="de"?"PDF-Download fehlgeschlagen":s==="fr"?"√âchec du t√©l√©chargement PDF":"PDF download failed")}}:void 0,onAddToBook:he?()=>{try{const m=sessionStorage.getItem("mystories_selected"),b=m?JSON.parse(m):[];b.includes(he)||(b.push(he),sessionStorage.setItem("mystories_selected",JSON.stringify(b))),I.info("Added story to book selection:",he),O(s==="de"?"Geschichte zum Buch hinzugef√ºgt. Du kannst weitere hinzuf√ºgen oder das Buch bestellen.":s==="fr"?"Histoire ajout√©e au livre. Vous pouvez en ajouter d'autres ou commander le livre.":"Story added to book. You can add more or order the book.",s==="de"?"Zum Buch hinzugef√ºgt":s==="fr"?"Ajout√© au livre":"Added to Book"),t("/stories")}catch(m){I.error("Failed to add story to selection:",m)}}:void 0,onPrintBook:he?async()=>{let m=await Oa.getShippingAddress();if(!m){const j=prompt(s==="de"?"Keine Adresse gespeichert. Bitte eingeben (Format: Vorname, Nachname, Strasse, PLZ, Ort, Land, Email):":s==="fr"?"Aucune adresse enregistr√©e. Veuillez entrer (Format: Pr√©nom, Nom, Rue, CP, Ville, Pays, Email):":"No saved address. Please enter (Format: FirstName, LastName, Street, PostCode, City, Country, Email):");if(!j)return;const R=j.split(",").map(q=>q.trim());if(R.length<7){y(s==="de"?"Ung√ºltiges Adressformat":s==="fr"?"Format d'adresse invalide":"Invalid address format");return}m={firstName:R[0],lastName:R[1],addressLine1:R[2],postCode:R[3],city:R[4],country:R[5],email:R[6]}}const b=`${m.firstName} ${m.lastName}
${m.addressLine1}
${m.postCode} ${m.city}
${m.country}`,P=s==="de"?`Druckauftrag an folgende Adresse senden?

${b}`:s==="fr"?`Envoyer la commande √† cette adresse?

${b}`:`Send print order to this address?

${b}`;if(confirm(P))try{I.info("Creating print order for story:",he);const j=await De.createPrintOrder(he,{firstName:m.firstName,lastName:m.lastName,addressLine1:m.addressLine1,city:m.city,postCode:m.postCode,country:m.country,email:m.email||""}),R=s==="de"?`‚úÖ Druckauftrag erfolgreich erstellt!

Order ID: ${j.orderId}
${j.isDraft?"(Entwurf - muss in Gelato best√§tigt werden)":""}

M√∂chten Sie das Gelato Dashboard √∂ffnen, um den Auftrag zu verfolgen?`:s==="fr"?`‚úÖ Commande d'impression cr√©√©e avec succ√®s!

ID de commande: ${j.orderId}
${j.isDraft?"(Brouillon - doit √™tre confirm√© dans Gelato)":""}

Voulez-vous ouvrir le tableau de bord Gelato pour suivre la commande?`:`‚úÖ Print order created successfully!

Order ID: ${j.orderId}
${j.isDraft?"(Draft - must be confirmed in Gelato)":""}

Would you like to open the Gelato dashboard to track your order?`;j.dashboardUrl&&confirm(R)?window.open(j.dashboardUrl,"_blank"):j.dashboardUrl||O(s==="de"?`Druckauftrag erstellt! Order ID: ${j.orderId}`:s==="fr"?`Commande cr√©√©e! ID: ${j.orderId}`:`Print order created! Order ID: ${j.orderId}`)}catch(j){I.error("Print order failed:",j);const R=j instanceof Error?j.message:String(j);y(s==="de"?`Druckauftrag fehlgeschlagen: ${R}`:s==="fr"?`√âchec de la commande d'impression: ${R}`:`Print order failed: ${R}`)}}:void 0,onCreateAnother:()=>{I.info("Creating new story - resetting settings"),Er(null),Rr(null);const m=new URLSearchParams(a);m.delete("storyId"),i(m,{replace:!0}),Rt(""),Ne(""),br([]),xt([]),Pt({frontCover:null,initialPage:null,backCover:null}),Zr(!1),Xr(void 0),es(void 0),ts(void 0),U(""),Pe(""),dt(""),n(""),Z("watercolor"),et("standard"),tt(30),_e(""),Oe(""),We([]),localStorage.removeItem("story_type"),localStorage.removeItem("story_category"),localStorage.removeItem("story_topic"),localStorage.removeItem("story_theme"),localStorage.removeItem("story_art_style"),localStorage.removeItem("story_language_level"),localStorage.removeItem("story_pages"),localStorage.removeItem("story_dedication"),localStorage.removeItem("story_details"),localStorage.removeItem("story_main_characters"),localStorage.removeItem("story_excluded_characters"),localStorage.removeItem("wizard_step"),localStorage.removeItem("verificationGenerationStarted"),ie(null),Ee("photo"),T(1)},onRegenerateCover:he?async m=>{try{I.info("Regenerating cover:",m),gt(!0);const b=await De.regenerateCover(he,m);Pt(P=>P&&{...P,[m==="front"?"frontCover":m==="back"?"backCover":"initialPage"]:{imageData:b.imageData,description:b.description,prompt:b.prompt,qualityScore:b.qualityScore,qualityReasoning:b.qualityReasoning,totalAttempts:b.totalAttempts,retryHistory:b.retryHistory}}),b.creditsRemaining!==void 0&&c&&c(b.creditsRemaining),I.info("Cover regenerated successfully")}catch(b){I.error("Cover regeneration failed:",b);const P=b instanceof Error?b.message:String(b);y(s==="de"?`Cover-Generierung fehlgeschlagen: ${P}`:s==="fr"?`√âchec de la r√©g√©n√©ration: ${P}`:`Cover regeneration failed: ${P}`)}finally{gt(!1)}}:void 0,onEditImage:m=>{jr({type:"image",pageNumber:m}),ir(""),vr(!0)},onEditCover:m=>{jr({type:"cover",coverType:m}),ir(""),vr(!0)},onRepairImage:he&&(l==null?void 0:l.role)==="admin"?async m=>{try{I.info("Starting auto-repair for page:",m);const b=await De.repairImage(he,m);b.repaired?(xt(P=>P.map(j=>j.pageNumber===m?{...j,imageData:b.imageData,wasAutoRepaired:!0,repairHistory:b.repairHistory,repairedAt:new Date().toISOString()}:j)),I.info("Auto-repair completed successfully:",{repaired:b.repaired,repairs:b.repairHistory.length})):b.noErrorsFound&&I.info("No physics errors detected in the image")}catch(b){throw I.error("Auto-repair failed:",b),b}}:void 0,onSaveStoryText:he?async m=>{try{I.info("Saving story text for story:",he),await De.saveStoryText(he,m),Rt(m),I.info("Story text saved successfully")}catch(b){throw I.error("Failed to save story text:",b),b}}:void 0,onSaveTitleChange:he?async m=>{try{I.info("Saving title for story:",he,m),await De.saveStoryTitle(he,m),Ne(m),I.info("Title saved successfully")}catch(b){throw I.error("Failed to save title:",b),b}}:void 0,userCredits:(l==null?void 0:l.credits)||0,imageRegenerationCost:5,isImpersonating:$,onSelectImageVersion:he?async(m,b)=>{try{I.info("Selecting image version:",{pageNumber:m,versionIndex:b});const P=await De.setActiveImage(he,m,b);xt(j=>j.map(R=>{if(R.pageNumber===m&&R.imageVersions){const q=R.imageVersions[b];return{...R,imageData:(q==null?void 0:q.imageData)||R.imageData,imageVersions:R.imageVersions.map((G,te)=>({...G,isActive:te===b}))}}return R})),I.info("Image version selected:",P)}catch(P){throw I.error("Failed to select image version:",P),P}}:void 0,isPartial:Qs,failureReason:Ys,generatedPages:Zs,totalPages:Xs})]})}return a.get("storyId")?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center",children:[e.jsx($t,{className:"w-12 h-12 text-indigo-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:s==="de"?"Geschichte wird geladen...":s==="fr"?"Chargement de l'histoire...":"Loading story..."})]}):Re?null:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Qe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:h.generateStory}),e.jsx("p",{className:"text-gray-600 mb-6",children:s==="de"?"Bereit, deine Geschichte zu erstellen!":s==="fr"?"Pr√™t √† cr√©er votre histoire!":"Ready to create your story!"}),e.jsxs(ft,{onClick:()=>Yt(),size:"lg",icon:Qe,children:[h.generateStory," (",Fe*10," Credits)"]})]});default:return null}};return w?e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(Aa,{currentStep:D,onStepClick:Vt,canAccessStep:fa,developerMode:z,onDeveloperModeChange:J}),e.jsx("div",{className:"px-3 md:px-8 mt-2 md:mt-8 flex-1",children:e.jsxs("div",{className:"md:bg-white md:rounded-2xl md:shadow-xl md:p-8",children:[B&&!Re?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center",children:[e.jsx($t,{className:"w-12 h-12 text-indigo-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium mb-2",children:A?s==="de"?"Geschichte wird geladen...":s==="fr"?"Chargement de l'histoire...":"Loading story...":s==="de"?"Wird geladen...":s==="fr"?"Chargement...":"Loading..."}),A&&e.jsxs("div",{className:"w-64 mt-2",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all duration-300 ease-out",style:{width:A.total?`${Math.min(100,A.loaded/A.total*100)}%`:"100%"}})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2 text-center",children:[(A.loaded/(1024*1024)).toFixed(1)," MB",A.total&&e.jsxs("span",{children:[" (",Math.round(A.loaded/A.total*100),"%)"]})]})]})]}):ja(),D<6&&!se&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[D!==5&&e.jsxs("div",{className:`flex ${D===1?"justify-end":"justify-between"}`,children:[D>1&&e.jsxs("button",{onClick:ds,className:"bg-transparent text-gray-800 hover:bg-gray-100 px-6 py-3 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(ps,{size:20})," ",h.back]}),e.jsxs("button",{onClick:ya,disabled:!Kt(),className:`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${Kt()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[h.next," ",e.jsx(Pr,{size:20})]})]}),D===5&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>Yt(),disabled:!Kt(),className:`w-full py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 ${Kt()?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-400 text-white cursor-not-allowed"}`,children:[e.jsx(Qe,{size:20})," ",h.generateStory," (",Fe*10," Credits)"]}),z&&e.jsxs("button",{onClick:()=>Yt({skipImages:!0}),disabled:!Kt(),className:`w-full py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 ${Kt()?"bg-yellow-500 text-white hover:bg-yellow-600":"bg-gray-400 text-white cursor-not-allowed"}`,children:[e.jsx(Qe,{size:20}),s==="de"?"Nur Text generieren (ohne Bilder)":s==="fr"?"G√©n√©rer le texte uniquement (sans images)":"Generate Text Only (no images)"]}),z&&e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg text-left",children:[e.jsxs("h3",{className:"text-sm font-semibold text-orange-700 mb-3",children:["üõ†Ô∏è ",s==="de"?"Entwickler-Optionen - Schritte √ºberspringen":s==="fr"?"Options d√©veloppeur - Sauter des √©tapes":"Developer Options - Skip Steps"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:re,onChange:o=>me(o.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Gliederung √ºberspringen":s==="fr"?"Sauter le plan":"Skip outline generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ue,onChange:o=>W(o.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Text √ºberspringen":s==="fr"?"Sauter le texte":"Skip text generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:o=>pe(o.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Szenenbeschreibungen √ºberspringen":s==="fr"?"Sauter les descriptions de sc√®nes":"Skip scene descriptions"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:X,onChange:o=>Y(o.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Bilder √ºberspringen":s==="fr"?"Sauter les images":"Skip image generation"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:oe,onChange:o=>ge(o.target.checked),className:"rounded border-orange-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:s==="de"?"Cover √ºberspringen":s==="fr"?"Sauter les couvertures":"Skip cover images"})]})]}),e.jsx("p",{className:"text-xs text-orange-600 mt-2",children:s==="de"?"Hinweis: √úbersprungene Schritte verwenden Platzhalter/leere Daten":s==="fr"?"Note: Les √©tapes saut√©es utiliseront des donn√©es vides/provisoires":"Note: Skipped steps will use placeholder/empty data"})]}),z&&((l==null?void 0:l.role)==="admin"||$)&&e.jsx(en,{selections:ye,onChange:N}),e.jsxs("button",{onClick:ds,className:"bg-transparent text-gray-800 hover:bg-gray-100 px-6 py-3 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(ps,{size:20})," ",h.back]})]})]})]})}),Re&&!At&&!Je&&!yr.frontCover&&e.jsx(Ua,{current:E.current,total:E.total,message:E.message,coverImages:yr,characters:ee,jobId:Br||void 0,isStalled:de,onDismissStalled:()=>ke(!1),onCancel:Br?async()=>{try{await De.cancelJob(Br),I.info("Job cancelled by user"),Ue(!1),Rr(null),ke(!1),k({current:0,total:0,message:""}),S(s==="de"?"Generierung abgebrochen":s==="fr"?"G√©n√©ration annul√©e":"Generation cancelled")}catch(o){I.error("Failed to cancel job:",o),y(s==="de"?"Abbruch fehlgeschlagen":s==="fr"?"√âchec de l'annulation":"Failed to cancel")}}:void 0}),Ht&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-sm w-full p-6 text-center",children:[e.jsx("div",{className:"relative inline-block mb-4",children:e.jsx($t,{size:40,className:"animate-spin text-indigo-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s==="de"?"Bild wird erstellt...":s==="fr"?"Cr√©ation de l'image...":"Generating image..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:s==="de"?"Dies dauert etwa 30 Sekunden":s==="fr"?"Cela prend environ 30 secondes":"This takes about 30 seconds"})]})}),ea&&Ae&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:s==="de"?"Bild bearbeiten":s==="fr"?"Modifier l'image":"Edit Image"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:Ae.type==="image"?s==="de"?`Seite ${Ae.pageNumber}`:s==="fr"?`Page ${Ae.pageNumber}`:`Page ${Ae.pageNumber}`:s==="de"?Ae.coverType==="front"?"Titelseite":Ae.coverType==="back"?"R√ºckseite":"Einleitungsseite":s==="fr"?Ae.coverType==="front"?"Couverture":Ae.coverType==="back"?"Dos":"Page de d√©dicace":Ae.coverType==="front"?"Front Cover":Ae.coverType==="back"?"Back Cover":"Dedication Page"}),e.jsx("textarea",{value:nr,onChange:o=>ir(o.target.value),placeholder:s==="de"?`Beschreibe die gew√ºnschte √Ñnderung...
z.B. "Mach den Himmel blauer" oder "F√ºge einen Schmetterling hinzu"`:s==="fr"?`D√©crivez le changement souhait√©...
par ex. "Rendre le ciel plus bleu" ou "Ajouter un papillon"`:`Describe what you want to change...
e.g. "Make the sky bluer" or "Add a butterfly"`,className:"w-full h-32 p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 resize-none"}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{vr(!1),jr(null),ir("")},className:"flex-1 px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:s==="de"?"Abbrechen":s==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:async()=>{if(!(!nr.trim()||!he)){vr(!1),gt(!0);try{if(Ae.type==="image"&&Ae.pageNumber){const o=await De.editImage(he,Ae.pageNumber,nr);if(I.info("Edit result:",{hasImageData:!!(o!=null&&o.imageData),score:o==null?void 0:o.qualityScore}),!(o!=null&&o.imageData))throw I.error("No imageData in edit response!",o),new Error("No image data returned from server");xt(C=>C.map(d=>d.pageNumber===Ae.pageNumber?{...d,imageData:o.imageData,qualityScore:o.qualityScore,qualityReasoning:o.qualityReasoning,wasEdited:!0,originalImage:o.originalImage,originalScore:o.originalScore,originalReasoning:o.originalReasoning}:d)),I.info("Image edited successfully, updated state with quality info")}else if(Ae.type==="cover"&&Ae.coverType){const o=await De.editCover(he,Ae.coverType,nr);Pt(C=>{if(!C)return C;const d=Ae.coverType==="front"?"frontCover":Ae.coverType==="back"?"backCover":"initialPage",m=C[d],b={...typeof m=="object"?m:{},imageData:o.imageData,qualityScore:o.qualityScore,qualityReasoning:o.qualityReasoning,wasEdited:!0,originalImage:o.originalImage,originalScore:o.originalScore,originalReasoning:o.originalReasoning};return{...C,[d]:b}}),I.info("Cover edited successfully with quality info")}}catch(o){I.error("Edit failed:",o),y(s==="de"?"Bearbeitung fehlgeschlagen. Bitte versuche es erneut.":s==="fr"?"√âchec de la modification. Veuillez r√©essayer.":"Edit failed. Please try again.")}finally{gt(!1),jr(null),ir("")}}},disabled:!nr.trim(),className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:s==="de"?"Bearbeiten":s==="fr"?"Modifier":"Edit"})]})]})}),e.jsx(An,{isOpen:M,onClose:()=>r(!1),onVerified:()=>{console.log("[EmailVerification] onVerified callback triggered");const o=localStorage.getItem("verificationGenerationStarted");if(o){const C=parseInt(o,10),d=Date.now()-120*1e3;if(C>d){console.log("[EmailVerification] Another window started recently, skipping"),r(!1);return}console.log("[EmailVerification] Clearing stale flag"),localStorage.removeItem("verificationGenerationStarted")}localStorage.setItem("verificationGenerationStarted",Date.now().toString()),localStorage.removeItem("pendingStoryGeneration"),localStorage.removeItem("pending_story_type"),localStorage.removeItem("pending_art_style"),console.log("[EmailVerification] Calling generateStory with skipEmailCheck: true"),Yt({skipEmailCheck:!0}),r(!1)}})]}):e.jsx(Sa,{fullScreen:!0})}export{qn as default};
