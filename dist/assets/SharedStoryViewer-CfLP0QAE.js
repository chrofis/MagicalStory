import{c as N,j as e,L as v,i as y}from"./index-DEbH-mIP.js";import{f as S,b as c,L as f}from"./vendor-react-CqfXSjHo.js";import{S as p}from"./sparkles-CUxyZEt2.js";import{B as k}from"./book-open-BYHR3SIQ.js";import{C as b}from"./chevron-right-710Pl1r8.js";import"./vendor-firebase-DTVMaYMy.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=N("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);function C(a,r){const h=c.useRef(null),g=c.useRef(null),m=50;return{onTouchStart:n=>{g.current=null,h.current=n.targetTouches[0].clientX},onTouchMove:n=>{g.current=n.targetTouches[0].clientX},onTouchEnd:()=>{if(!h.current||!g.current)return;const n=h.current-g.current,l=n>m,o=n<-m;l&&a(),o&&r()}}}function R(){const{shareToken:a}=S(),[r,h]=c.useState(null),[g,m]=c.useState(!0),[u,x]=c.useState(null),[t,n]=c.useState(0);c.useEffect(()=>{async function i(){if(!a){x("Invalid share link"),m(!1);return}try{const s=await fetch(`/api/shared/${a}`);if(!s.ok){s.status===404?x("This story is no longer available or the link is invalid."):x("Failed to load story. Please try again later."),m(!1);return}const d=await s.json();h(d)}catch{x("Failed to load story. Please check your connection.")}finally{m(!1)}}i()},[a]),c.useEffect(()=>{if(!r||!a)return;const i=[];if(t>0&&t<r.pages.length&&i.push(r.pages[t].pageNumber),t>1&&i.push(r.pages[t-2].pageNumber),t===1){const s=new Image;s.src=`/api/shared/${a}/cover-image/frontCover`}i.forEach(s=>{const d=new Image;d.src=`/api/shared/${a}/image/${s}`})},[t,r,a]);const l=r?r.pages.length+1:0,o=i=>{i>=0&&i<l&&n(i)},w=C(()=>o(t+1),()=>o(t-1));return g?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"w-12 h-12 animate-spin text-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-indigo-800",children:"Loading story..."})]})}):u?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-blue-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(y,{className:"w-16 h-16 text-indigo-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-indigo-900 mb-2",children:"Story Not Found"}),e.jsx("p",{className:"text-indigo-700 mb-6",children:u}),e.jsxs(f,{to:"/",className:"inline-flex items-center gap-2 bg-gradient-to-r from-indigo-500 to-blue-500 text-white px-6 py-3 rounded-full font-semibold hover:from-indigo-600 hover:to-blue-600 transition-all",children:[e.jsx(p,{className:"w-5 h-5"}),"Create Your Own Story"]})]})}):r?e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-blue-50 flex flex-col",children:[e.jsx("header",{className:"bg-white/80 backdrop-blur-sm border-b border-indigo-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-6 h-6 text-indigo-600"}),e.jsx("span",{className:"font-bold text-indigo-900 hidden sm:inline",children:"MagicalStory"})]}),e.jsxs(f,{to:"/",className:"inline-flex items-center gap-1 bg-gradient-to-r from-indigo-500 to-blue-500 text-white px-4 py-2 rounded-full text-sm font-semibold hover:from-indigo-600 hover:to-blue-600 transition-all",children:[e.jsx(p,{className:"w-4 h-4"}),"Create Your Own Story"]})]})}),e.jsxs("main",{className:"flex-1 flex items-center justify-center px-2 md:px-4 py-4 md:py-6",...w,children:[e.jsx("button",{onClick:()=>o(t-1),disabled:t===0,className:"hidden md:flex p-2 lg:p-3 rounded-full bg-white shadow-lg border border-indigo-200 text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed hover:bg-indigo-50 transition-colors mr-3 lg:mr-6 flex-shrink-0","aria-label":"Previous page",children:e.jsx(j,{className:"w-6 h-6 lg:w-8 lg:h-8"})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden border-2 border-indigo-200 flex-1 max-w-6xl",children:[t===0&&e.jsx("div",{className:"flex items-center justify-center bg-gradient-to-br from-indigo-100 to-blue-100 p-4",children:e.jsx("img",{src:`/api/shared/${a}/cover-image/frontCover`,alt:r.title,className:"max-h-[calc(100vh-200px)] max-w-full object-contain rounded-lg shadow-lg",loading:"eager",onError:i=>{i.currentTarget.style.display="none"}})}),t>0&&r.pages[t-1]&&e.jsxs("div",{className:"md:grid md:grid-cols-2 h-[calc(100vh-180px)] md:h-[calc(100vh-160px)] min-h-[400px] max-h-[800px]",children:[e.jsx("div",{className:"h-1/2 md:h-full bg-gradient-to-br from-indigo-50 to-blue-50 flex items-center justify-center",children:e.jsx("img",{src:`/api/shared/${a}/image/${r.pages[t-1].pageNumber}`,alt:`Page ${t}`,className:"w-full h-full object-contain",loading:"eager",onError:i=>{i.currentTarget.src="",i.currentTarget.alt="Image not available"}})}),e.jsxs("div",{className:"h-1/2 md:h-full p-4 md:p-5 lg:p-6 flex flex-col bg-indigo-50/50 overflow-hidden",children:[e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:e.jsx("p",{className:"text-sm md:text-base leading-relaxed text-gray-800 whitespace-pre-wrap",children:r.pages[t-1].text})}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-indigo-100 text-right text-indigo-400 text-xs flex-shrink-0",children:["Page ",t," of ",r.pages.length]})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 py-3 bg-white border-t border-indigo-100",children:Array.from({length:Math.min(l,12)}).map((i,s)=>{const d=l<=12||s<5?s:s===5?-1:l-(11-s);return d===-1?e.jsx("span",{className:"text-indigo-300 text-xs",children:"..."},s):e.jsx("button",{onClick:()=>o(d),className:`w-2.5 h-2.5 rounded-full transition-all ${t===d?"bg-indigo-500 scale-125":"bg-indigo-200 hover:bg-indigo-300"}`,"aria-label":`Go to page ${d}`},s)})})]}),e.jsx("button",{onClick:()=>o(t+1),disabled:t>=l-1,className:"hidden md:flex p-2 lg:p-3 rounded-full bg-white shadow-lg border border-indigo-200 text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed hover:bg-indigo-50 transition-colors ml-3 lg:ml-6 flex-shrink-0","aria-label":"Next page",children:e.jsx(b,{className:"w-6 h-6 lg:w-8 lg:h-8"})})]}),e.jsxs("div",{className:"md:hidden flex items-center justify-center gap-6 pb-4",children:[e.jsx("button",{onClick:()=>o(t-1),disabled:t===0,className:"p-3 rounded-full bg-white shadow-md border border-indigo-200 text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed","aria-label":"Previous page",children:e.jsx(j,{className:"w-6 h-6"})}),e.jsx("p",{className:"text-indigo-400 text-sm",children:"Swipe or tap"}),e.jsx("button",{onClick:()=>o(t+1),disabled:t>=l-1,className:"p-3 rounded-full bg-white shadow-md border border-indigo-200 text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed","aria-label":"Next page",children:e.jsx(b,{className:"w-6 h-6"})})]})]}):null}export{R as default};
