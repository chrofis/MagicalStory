import{c as N,j as e,L as v,i as y}from"./index-DzDSApCn.js";import{f as S,b as d,L as b}from"./vendor-react-CqfXSjHo.js";import{S as f}from"./sparkles-BeBhJt5_.js";import{B as k}from"./book-open-CVurMchB.js";import{C as p}from"./chevron-right-Bioc5pPv.js";import"./vendor-firebase-DTVMaYMy.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=N("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);function C(n,a){const x=d.useRef(null),c=d.useRef(null),m=50;return{onTouchStart:o=>{c.current=null,x.current=o.targetTouches[0].clientX},onTouchMove:o=>{c.current=o.targetTouches[0].clientX},onTouchEnd:()=>{if(!x.current||!c.current)return;const o=x.current-c.current,l=o>m,i=o<-m;l&&n(),i&&a()}}}function I(){const{shareToken:n}=S(),[a,x]=d.useState(null),[c,m]=d.useState(!0),[u,h]=d.useState(null),[t,o]=d.useState(0);d.useEffect(()=>{async function r(){if(!n){h("Invalid share link"),m(!1);return}try{const s=await fetch(`/api/shared/${n}`);if(!s.ok){s.status===404?h("This story is no longer available or the link is invalid."):h("Failed to load story. Please try again later."),m(!1);return}const g=await s.json();x(g)}catch{h("Failed to load story. Please check your connection.")}finally{m(!1)}}r()},[n]);const l=a?a.pages.length+1:0,i=r=>{r>=0&&r<l&&o(r)},w=C(()=>i(t+1),()=>i(t-1));return c?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"w-12 h-12 animate-spin text-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-indigo-800",children:"Loading story..."})]})}):u?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-blue-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(y,{className:"w-16 h-16 text-indigo-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-indigo-900 mb-2",children:"Story Not Found"}),e.jsx("p",{className:"text-indigo-700 mb-6",children:u}),e.jsxs(b,{to:"/",className:"inline-flex items-center gap-2 bg-gradient-to-r from-indigo-500 to-blue-500 text-white px-6 py-3 rounded-full font-semibold hover:from-indigo-600 hover:to-blue-600 transition-all",children:[e.jsx(f,{className:"w-5 h-5"}),"Create Your Own Story"]})]})}):a?e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-blue-50 flex flex-col",children:[e.jsx("header",{className:"bg-white/80 backdrop-blur-sm border-b border-indigo-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-6 h-6 text-indigo-600"}),e.jsx("span",{className:"font-bold text-indigo-900 hidden sm:inline",children:"MagicalStory"})]}),e.jsxs(b,{to:"/",className:"inline-flex items-center gap-1 bg-gradient-to-r from-indigo-500 to-blue-500 text-white px-4 py-2 rounded-full text-sm font-semibold hover:from-indigo-600 hover:to-blue-600 transition-all",children:[e.jsx(f,{className:"w-4 h-4"}),"Create Your Own Story"]})]})}),e.jsxs("main",{className:"flex-1 flex items-center justify-center px-2 md:px-4 py-4 md:py-6",...w,children:[e.jsx("button",{onClick:()=>i(t-1),disabled:t===0,className:"hidden md:flex p-2 lg:p-3 rounded-full bg-white shadow-lg border border-indigo-200 text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed hover:bg-indigo-50 transition-colors mr-3 lg:mr-6 flex-shrink-0","aria-label":"Previous page",children:e.jsx(j,{className:"w-6 h-6 lg:w-8 lg:h-8"})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden border-2 border-indigo-200 flex-1 max-w-6xl",children:[t===0&&e.jsxs("div",{className:"aspect-[3/4] md:aspect-[4/3] lg:aspect-[16/10] xl:aspect-[16/9] relative bg-gradient-to-br from-indigo-100 to-blue-100",children:[e.jsx("img",{src:`/api/shared/${n}/cover-image/frontCover`,alt:"Story Cover",className:"w-full h-full object-cover",onError:r=>{r.currentTarget.style.display="none"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-6",children:e.jsx("h1",{className:"text-2xl md:text-4xl font-bold text-white text-center drop-shadow-lg",children:a.title})})]}),t>0&&a.pages[t-1]&&e.jsxs("div",{className:"md:grid md:grid-cols-2 md:h-[500px] lg:h-[600px] xl:h-[650px]",children:[e.jsx("div",{className:"aspect-square md:aspect-auto md:h-full bg-gradient-to-br from-indigo-50 to-blue-50",children:e.jsx("img",{src:`/api/shared/${n}/image/${a.pages[t-1].pageNumber}`,alt:`Page ${t}`,className:"w-full h-full object-cover md:object-contain",loading:"lazy",onError:r=>{r.currentTarget.src="",r.currentTarget.alt="Image not available"}})}),e.jsxs("div",{className:"p-5 md:p-6 lg:p-8 flex flex-col bg-indigo-50/50 md:h-full",children:[e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("p",{className:"text-base md:text-lg leading-relaxed text-gray-800 whitespace-pre-wrap",children:a.pages[t-1].text})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-indigo-100 text-right text-indigo-400 text-sm flex-shrink-0",children:["Page ",t," of ",a.pages.length]})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 py-3 bg-white border-t border-indigo-100",children:Array.from({length:Math.min(l,12)}).map((r,s)=>{const g=l<=12||s<5?s:s===5?-1:l-(11-s);return g===-1?e.jsx("span",{className:"text-indigo-300 text-xs",children:"..."},s):e.jsx("button",{onClick:()=>i(g),className:`w-2.5 h-2.5 rounded-full transition-all ${t===g?"bg-indigo-500 scale-125":"bg-indigo-200 hover:bg-indigo-300"}`,"aria-label":`Go to page ${g}`},s)})})]}),e.jsx("button",{onClick:()=>i(t+1),disabled:t>=l-1,className:"hidden md:flex p-2 lg:p-3 rounded-full bg-white shadow-lg border border-indigo-200 text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed hover:bg-indigo-50 transition-colors ml-3 lg:ml-6 flex-shrink-0","aria-label":"Next page",children:e.jsx(p,{className:"w-6 h-6 lg:w-8 lg:h-8"})})]}),e.jsxs("div",{className:"md:hidden flex items-center justify-center gap-6 pb-4",children:[e.jsx("button",{onClick:()=>i(t-1),disabled:t===0,className:"p-3 rounded-full bg-white shadow-md border border-indigo-200 text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed","aria-label":"Previous page",children:e.jsx(j,{className:"w-6 h-6"})}),e.jsx("p",{className:"text-indigo-400 text-sm",children:"Swipe or tap"}),e.jsx("button",{onClick:()=>i(t+1),disabled:t>=l-1,className:"p-3 rounded-full bg-white shadow-md border border-indigo-200 text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed","aria-label":"Next page",children:e.jsx(p,{className:"w-6 h-6"})})]})]}):null}export{I as default};
